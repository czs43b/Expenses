import{i as $a,j as Xa,k as Ja}from"./chunk-O4VSYUAH.js";import{b as ja,c as I,d as we,g as Ga,h as ii,o as gt,p as ri,q as Dn,r as Ha,s as Ya}from"./chunk-FNW6C2EI.js";import{Ab as Ba,Ba as sa,Bb as Ua,Ca as ia,Cb as Va,D as Go,Db as Ka,Eb as qa,Fb as Qa,Gb as za,Hb as si,Ia as ra,Ja as oa,L as In,N as $o,O as Ys,Oa as aa,R as Xs,S as Ho,V as Yo,Wa as la,Y as Xo,_a as ca,a as Wo,aa as Jo,bb as ua,c as Bo,ca as Zo,db as ha,e as Uo,f as $e,gb as da,h as Qs,ha as Ae,hb as fa,ia as Pe,j as Vo,ja as Js,kb as pa,l as zs,m as Ko,n as qo,nb as ma,p as Qo,pa as ea,pb as Pa,q as zo,qa as ta,qb as Ra,r as A,rb as ka,sb as Ye,t as pt,tb as Da,u as js,ub as Ma,v as Gs,vb as Oa,w as B,wb as xa,x as $s,xb as La,y as jo,ya as He,yb as Fa,z as Hs,za as na,zb as Wa}from"./chunk-PTYEF7PQ.js";import{A as wa,B as Sa,C as ue,D as Oe,E as An,F as Ft,H as Ta,I as Ca,J as v,K as ee,L as K,M as ei,N as ba,O as Wt,P as te,Q as _t,R as Pn,S as ti,T as Ia,U as Rn,V as Na,W as Aa,Y as ni,Z as kn,a as ft,b as xo,c as Lo,e as Fo,j as m,k as mt,l as _a,m as ga,n as ya,o as H,p as va,r as Zs,s as Ea,t as Ee,y as Nn,z as U}from"./chunk-6H46YYVM.js";var Za="@firebase/database",el="1.0.8";var gr="";function yr(n){gr=n}var fi=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),U(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Nn(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var pi=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return ue(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var kl=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new fi(e)}}catch{}return new pi},Je=kl("localStorage"),mi=kl("sessionStorage");var wt=new Rn("@firebase/database"),Dl=function(){let n=1;return function(){return n++}}(),Ml=function(n){let e=ba(n),t=new Ca;t.update(e);let s=t.digest();return _a.encodeByteArray(s)},cn=function(...n){let e="";for(let t=0;t<n.length;t++){let s=n[t];Array.isArray(s)||s&&typeof s=="object"&&typeof s.length=="number"?e+=cn.apply(null,s):typeof s=="object"?e+=U(s):e+=s,e+=" "}return e},Ze=null,tl=!0,Ol=function(n,e){m(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(wt.logLevel=Ia.VERBOSE,Ze=wt.log.bind(wt),e&&mi.set("logging_enabled",!0)):typeof n=="function"?Ze=n:(Ze=null,mi.remove("logging_enabled"))},Q=function(...n){if(tl===!0&&(tl=!1,Ze===null&&mi.get("logging_enabled")===!0&&Ol(!0)),Ze){let e=cn.apply(null,n);Ze(e)}},un=function(n){return function(...e){Q(n,...e)}},_i=function(...n){let e="FIREBASE INTERNAL ERROR: "+cn(...n);wt.error(e)},Ce=function(...n){let e=`FIREBASE FATAL ERROR: ${cn(...n)}`;throw wt.error(e),new Error(e)},G=function(...n){let e="FIREBASE WARNING: "+cn(...n);wt.warn(e)},th=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&G("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},os=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},nh=function(n){if(Ee()||document.readyState==="complete")n();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},We="[MIN_NAME]",Re="[MAX_NAME]",tt=function(n,e){if(n===e)return 0;if(n===We||e===Re)return-1;if(e===We||n===Re)return 1;{let t=nl(n),s=nl(e);return t!==null?s!==null?t-s===0?n.length-e.length:t-s:-1:s!==null?1:n<e?-1:1}},sh=function(n,e){return n===e?0:n<e?-1:1},Bt=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+U(e))},vr=function(n){if(typeof n!="object"||n===null)return U(n);let e=[];for(let s in n)e.push(s);e.sort();let t="{";for(let s=0;s<e.length;s++)s!==0&&(t+=","),t+=U(e[s]),t+=":",t+=vr(n[e[s]]);return t+="}",t},xl=function(n,e){let t=n.length;if(t<=e)return[n];let s=[];for(let i=0;i<t;i+=e)i+e>t?s.push(n.substring(i,t)):s.push(n.substring(i,i+e));return s};function z(n,e){for(let t in n)n.hasOwnProperty(t)&&e(t,n[t])}var Ll=function(n){m(!os(n),"Invalid JSON number");let e=11,t=52,s=(1<<e-1)-1,i,r,o,a,l;n===0?(r=0,o=0,i=1/n===-1/0?1:0):(i=n<0,n=Math.abs(n),n>=Math.pow(2,1-s)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),s),r=a+s,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(r=0,o=Math.round(n/Math.pow(2,1-s-t))));let c=[];for(l=t;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)c.push(r%2?1:0),r=Math.floor(r/2);c.push(i?1:0),c.reverse();let u=c.join(""),h="";for(l=0;l<64;l+=8){let d=parseInt(u.substr(l,8),2).toString(16);d.length===1&&(d="0"+d),h=h+d}return h.toLowerCase()},ih=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},rh=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function oh(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");let s=new Error(n+" at "+e._path.toString()+": "+t);return s.code=n.toUpperCase(),s}var ah=new RegExp("^-?(0*)\\d{1,10}$"),lh=-2147483648,ch=2147483647,nl=function(n){if(ah.test(n)){let e=Number(n);if(e>=lh&&e<=ch)return e}return null},Rt=function(n){try{n()}catch(e){setTimeout(()=>{let t=e.stack||"";throw G("Exception was thrown by user callback.",t),e},Math.floor(0))}},uh=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},qt=function(n,e){let t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var gi=class{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(s=>this.appCheck=s)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,s)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(s=>s.addTokenListener(e))}notifyForInvalidToken(){G(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var yi=class{constructor(e,t,s){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Q("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,s)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',G(e)}},Qt=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),On="5",Fl="v",Wl="s",Bl="r",Ul="f",Vl=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Kl="ls",ql="p",vi="ac",Ql="websocket",zl="long_polling";var xn=class{constructor(e,t,s,i,r=!1,o="",a=!1,l=!1){this.secure=t,this.namespace=s,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Je.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Je.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function hh(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function jl(n,e,t){m(typeof e=="string","typeof type must == string"),m(typeof t=="object","typeof params must == object");let s;if(e===Ql)s=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===zl)s=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);hh(n)&&(t.ns=n.namespace);let i=[];return z(t,(r,o)=>{i.push(r+"="+o)}),s+i.join("&")}var Ei=class{constructor(){this.counters_={}}incrementCounter(e,t=1){ue(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return ya(this.counters_)}};var oi={},ai={};function Er(n){let e=n.toString();return oi[e]||(oi[e]=new Ei),oi[e]}function dh(n,e){let t=n.toString();return ai[t]||(ai[t]=e()),ai[t]}var wi=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let s=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<s.length;++i)s[i]&&Rt(()=>{this.onMessage_(s[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var sl="start",fh="close",ph="pLPCommand",mh="pRTLPCB",Gl="id",$l="pw",Hl="ser",_h="cb",gh="seg",yh="ts",vh="d",Eh="dframe",Yl=1870,Xl=30,wh=Yl-Xl,Sh=25e3,Th=3e4,$t=class n{constructor(e,t,s,i,r,o,a){this.connId=e,this.repoInfo=t,this.applicationId=s,this.appCheckToken=i,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=un(e),this.stats_=Er(t),this.urlFn=l=>(this.appCheckToken&&(l[vi]=this.appCheckToken),jl(t,zl,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new wi(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Th)),nh(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Si((...r)=>{let[o,a,l,c,u]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===sl)this.id=a,this.password=l;else if(o===fh)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{let[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let s={};s[sl]="t",s[Hl]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(s[_h]=this.scriptTagHolder.uniqueCallbackIdentifier),s[Fl]=On,this.transportSessionId&&(s[Wl]=this.transportSessionId),this.lastSessionId&&(s[Kl]=this.lastSessionId),this.applicationId&&(s[ql]=this.applicationId),this.appCheckToken&&(s[vi]=this.appCheckToken),typeof location<"u"&&location.hostname&&Vl.test(location.hostname)&&(s[Bl]=Ul);let i=this.urlFn(s);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return Ee()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!ih()&&!rh()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=U(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let s=ga(t),i=xl(s,wh);for(let r=0;r<i.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(Ee())return;this.myDisconnFrame=document.createElement("iframe");let s={};s[Eh]="t",s[Gl]=e,s[$l]=t,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=U(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},Si=class n{constructor(e,t,s,i){if(this.onDisconnect=s,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,Ee())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=Dl(),window[ph+this.uniqueCallbackIdentifier]=e,window[mh+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Q("frame writing exception"),a.stack&&Q(a.stack),Q(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Q("No IE domain setting required")}catch{let s=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[Gl]=this.myID,e[$l]=this.myPW,e[Hl]=this.currentSerial;let t=this.urlFn(e),s="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Xl+s.length<=Yl;){let o=this.pendingSegs.shift();s=s+"&"+gh+i+"="+o.seg+"&"+yh+i+"="+o.ts+"&"+vh+i+"="+o.d,i++}return t=t+s,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,s){this.pendingSegs.push({seg:e,ts:t,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let s=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(s,Math.floor(Sh)),r=()=>{clearTimeout(i),s()};this.addTag(e,r)}addTag(e,t){Ee()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=e,s.onload=s.onreadystatechange=function(){let i=s.readyState;(!i||i==="loaded"||i==="complete")&&(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),t())},s.onerror=()=>{Q("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch{}},Math.floor(1))}};var Ch=16384,bh=45e3,Ln=null;typeof MozWebSocket<"u"?Ln=MozWebSocket:typeof WebSocket<"u"&&(Ln=WebSocket);var vt=(()=>{class n{constructor(t,s,i,r,o,a,l){this.connId=t,this.applicationId=i,this.appCheckToken=r,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=un(this.connId),this.stats_=Er(s),this.connURL=n.connectionURL_(s,a,l,r,i),this.nodeAdmin=s.nodeAdmin}static connectionURL_(t,s,i,r,o){let a={};return a[Fl]=On,!Ee()&&typeof location<"u"&&location.hostname&&Vl.test(location.hostname)&&(a[Bl]=Ul),s&&(a[Wl]=s),i&&(a[Kl]=i),r&&(a[vi]=r),o&&(a[ql]=o),jl(t,Ql,a)}open(t,s){this.onDisconnect=s,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Je.set("previous_websocket_failure",!0);try{let i;if(Ee()){let r=this.nodeAdmin?"AdminNode":"Node";i={headers:{"User-Agent":`Firebase/${On}/${gr}/${process.platform}/${r}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(i.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(i.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(i.proxy={origin:a})}this.mySock=new Ln(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");let r=i.message||i.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");let r=i.message||i.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let s=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(s);i&&i.length>1&&parseFloat(i[1])<4.4&&(t=!0)}return!t&&Ln!==null&&!n.forceDisallow_}static previouslyFailed(){return Je.isInMemoryStorage||Je.get("previous_websocket_failure")===!0}markConnectionHealthy(){Je.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let s=this.frames.join("");this.frames=null;let i=Nn(s);this.onMessage(i)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(m(this.frames===null,"We already have a frame buffer"),t.length<=6){let s=Number(t);if(!isNaN(s))return this.handleNewFrameCount_(s),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let s=t.data;if(this.bytesReceived+=s.length,this.stats_.incrementCounter("bytes_received",s.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(s);else{let i=this.extractFrameCount_(s);i!==null&&this.appendFrame_(i)}}send(t){this.resetKeepAlive();let s=U(t);this.bytesSent+=s.length,this.stats_.incrementCounter("bytes_sent",s.length);let i=xl(s,Ch);i.length>1&&this.sendString_(String(i.length));for(let r=0;r<i.length;r++)this.sendString_(i[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(bh))}sendString_(t){try{this.mySock.send(t)}catch(s){this.log_("Exception thrown from WebSocket.send():",s.message||s.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4;return n})(),Jl=(()=>{class n{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[$t,vt]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){let s=vt&&vt.isAvailable(),i=s&&!vt.previouslyFailed();if(t.webSocketOnly&&(s||G("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[vt];else{let r=this.transports_=[];for(let o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&r.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),Ih=6e4,Nh=5e3,Ah=10*1024,Ph=100*1024,li="t",il="d",Rh="s",rl="r",kh="e",ol="o",al="a",ll="n",cl="p",Dh="h",Ti=class{constructor(e,t,s,i,r,o,a,l,c,u){this.id=e,this.repoInfo_=t,this.applicationId_=s,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=un("c:"+this.id+":"),this.transportManager_=new Jl(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,s)},Math.floor(0));let i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=qt(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>Ph?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>Ah?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(li in e){let t=e[li];t===al?this.upgradeIfSecondaryHealthy_():t===rl?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===ol&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=Bt("t",e),s=Bt("d",e);if(t==="c")this.onSecondaryControl_(s);else if(t==="d")this.pendingDataMessages.push(s);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:cl,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:al,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:ll,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=Bt("t",e),s=Bt("d",e);t==="c"?this.onControl_(s):t==="d"&&this.onDataMessage_(s)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=Bt(li,e);if(il in e){let s=e[il];if(t===Dh){let i=Object.assign({},s);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===ll){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===Rh?this.onConnectionShutdown_(s):t===rl?this.onReset_(s):t===kh?_i("Server Error: "+s):t===ol?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):_i("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,s=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),On!==s&&G("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,s),qt(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Ih))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):qt(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Nh))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:cl,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Je.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var Fn=class{put(e,t,s,i){}merge(e,t,s,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,s){}onDisconnectMerge(e,t,s){}onDisconnectCancel(e,t){}reportStats(e){}};var Wn=class{constructor(e){this.allowedEvents_=e,this.listeners_={},m(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let s=[...this.listeners_[e]];for(let i=0;i<s.length;i++)s[i].callback.apply(s[i].context,t)}}on(e,t,s){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:s});let i=this.getInitialEvent(e);i&&t.apply(s,i)}off(e,t,s){this.validateEventType_(e);let i=this.listeners_[e]||[];for(let r=0;r<i.length;r++)if(i[r].callback===t&&(!s||s===i[r].context)){i.splice(r,1);return}}validateEventType_(e){m(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var Bn=class n extends Wn{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Zs()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new n}getInitialEvent(e){return m(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var ul=32,hl=768,R=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let s=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[s]=this.pieces_[i],s++);this.pieces_.length=s,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function P(){return new R("")}function T(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Be(n){return n.pieces_.length-n.pieceNum_}function M(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new R(n.pieces_,e)}function wr(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function Mh(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Ht(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function Zl(n){if(n.pieceNum_>=n.pieces_.length)return null;let e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new R(e,0)}function x(n,e){let t=[];for(let s=n.pieceNum_;s<n.pieces_.length;s++)t.push(n.pieces_[s]);if(e instanceof R)for(let s=e.pieceNum_;s<e.pieces_.length;s++)t.push(e.pieces_[s]);else{let s=e.split("/");for(let i=0;i<s.length;i++)s[i].length>0&&t.push(s[i])}return new R(t,0)}function C(n){return n.pieceNum_>=n.pieces_.length}function Y(n,e){let t=T(n),s=T(e);if(t===null)return e;if(t===s)return Y(M(n),M(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function Oh(n,e){let t=Ht(n,0),s=Ht(e,0);for(let i=0;i<t.length&&i<s.length;i++){let r=tt(t[i],s[i]);if(r!==0)return r}return t.length===s.length?0:t.length<s.length?-1:1}function Sr(n,e){if(Be(n)!==Be(e))return!1;for(let t=n.pieceNum_,s=e.pieceNum_;t<=n.pieces_.length;t++,s++)if(n.pieces_[t]!==e.pieces_[s])return!1;return!0}function he(n,e){let t=n.pieceNum_,s=e.pieceNum_;if(Be(n)>Be(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[s])return!1;++t,++s}return!0}var Ci=class{constructor(e,t){this.errorPrefix_=t,this.parts_=Ht(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=Wt(this.parts_[s]);ec(this)}};function xh(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Wt(e),ec(n)}function Lh(n){let e=n.parts_.pop();n.byteLength_-=Wt(e),n.parts_.length>0&&(n.byteLength_-=1)}function ec(n){if(n.byteLength_>hl)throw new Error(n.errorPrefix_+"has a key path longer than "+hl+" bytes ("+n.byteLength_+").");if(n.parts_.length>ul)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+ul+") or object contains a cycle "+Xe(n))}function Xe(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var bi=class n extends Wn{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let s=!document[e];s!==this.visible_&&(this.visible_=s,this.trigger("visible",s))},!1)}static getInstance(){return new n}getInitialEvent(e){return m(e==="visible","Unknown event type: "+e),[this.visible_]}};var Ut=1e3,Fh=60*5*1e3,dl=30*1e3,Wh=1.3,Bh=3e4,Uh="server_kill",fl=3,Tr=(()=>{class n extends Fn{constructor(t,s,i,r,o,a,l,c){if(super(),this.repoInfo_=t,this.applicationId_=s,this.onDataUpdate_=i,this.onConnectStatus_=r,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=n.nextPersistentConnectionId_++,this.log_=un("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Ut,this.maxReconnectDelay_=Fh,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!Ee())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");bi.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&Bn.getInstance().on("online",this.onOnline_,this)}sendRequest(t,s,i){let r=++this.requestNumber_,o={r,a:t,b:s};this.log_(U(o)),m(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),i&&(this.requestCBHash_[r]=i)}get(t){this.initConnection_();let s=new H,r={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let l=a.d;a.s==="ok"?s.resolve(l):s.reject(l)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),s.promise}listen(t,s,i,r){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),m(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),m(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let l={onComplete:r,hashFn:s,query:t,tag:i};this.listens.get(a).set(o,l),this.connected_&&this.sendListen_(l)}sendGet_(t){let s=this.outstandingGets_[t];this.sendRequest("g",s.request,i=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),s.onComplete&&s.onComplete(i)})}sendListen_(t){let s=t.query,i=s._path.toString(),r=s._queryIdentifier;this.log_("Listen on "+i+" for "+r);let o={p:i},a="q";t.tag&&(o.q=s._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,l=>{let c=l.d,u=l.s;n.warnOnListenWarnings_(c,s),(this.listens.get(i)&&this.listens.get(i).get(r))===t&&(this.log_("listen response",l),u!=="ok"&&this.removeListen_(i,r),t.onComplete&&t.onComplete(u,c))})}static warnOnListenWarnings_(t,s){if(t&&typeof t=="object"&&ue(t,"w")){let i=Oe(t,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){let r='".indexOn": "'+s._queryParams.getIndex().toString()+'"',o=s._path.toString();G(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||Sa(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=dl)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,s=wa(t)?"auth":"gauth",i={cred:t};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(s,i,r=>{let o=r.s,a=r.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let s=t.s,i=t.d||"error";s==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(s,i)})}unlisten(t,s){let i=t._path.toString(),r=t._queryIdentifier;this.log_("Unlisten called for "+i+" "+r),m(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,r)&&this.connected_&&this.sendUnlisten_(i,r,t._queryObject,s)}sendUnlisten_(t,s,i,r){this.log_("Unlisten on "+t+" for "+s);let o={p:t},a="n";r&&(o.q=i,o.t=r),this.sendRequest(a,o)}onDisconnectPut(t,s,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,s,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:s,onComplete:i})}onDisconnectMerge(t,s,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,s,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:s,onComplete:i})}onDisconnectCancel(t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:s})}sendOnDisconnect_(t,s,i,r){let o={p:s,d:i};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{r&&setTimeout(()=>{r(a.s,a.d)},Math.floor(0))})}put(t,s,i,r){this.putInternal("p",t,s,i,r)}merge(t,s,i,r){this.putInternal("m",t,s,i,r)}putInternal(t,s,i,r,o){this.initConnection_();let a={p:s,d:i};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:r}),this.outstandingPutCount_++;let l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+s)}sendPut_(t){let s=this.outstandingPuts_[t].action,i=this.outstandingPuts_[t].request,r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(s,i,o=>{this.log_(s+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(o.s,o.d)})}reportStats(t){if(this.connected_){let s={c:t};this.log_("reportStats",s),this.sendRequest("s",s,i=>{if(i.s!=="ok"){let o=i.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+U(t));let s=t.r,i=this.requestCBHash_[s];i&&(delete this.requestCBHash_[s],i(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,s){this.log_("handleServerMessage",t,s),t==="d"?this.onDataUpdate_(s.p,s.d,!1,s.t):t==="m"?this.onDataUpdate_(s.p,s.d,!0,s.t):t==="c"?this.onListenRevoked_(s.p,s.q):t==="ac"?this.onAuthRevoked_(s.s,s.d):t==="apc"?this.onAppCheckRevoked_(s.s,s.d):t==="sd"?this.onSecurityDebugPacket_(s):_i("Unrecognized action received from server: "+U(t)+`
Are you using the latest client?`)}onReady_(t,s){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=s,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){m(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Ut,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=Ut,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Bh&&(this.reconnectDelay_=Ut),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=new Date().getTime()-this.lastConnectionAttemptTime_,s=Math.max(0,this.reconnectDelay_-t);s=Math.random()*s,this.log_("Trying to reconnect in "+s+"ms"),this.scheduleConnect_(s),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Wh)}this.onConnectStatus_(!1)}establishConnection_(){return Fo(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),s=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+n.nextConnectionId_++,o=this.lastSessionId,a=!1,l=null,c=function(){l?l.close():(a=!0,i())},u=function(d){m(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(d)};this.realtime_={close:c,sendRequest:u};let h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[d,f]=yield Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);a?Q("getToken() completed but was canceled"):(Q("getToken() completed. Creating connection."),this.authToken_=d&&d.accessToken,this.appCheckToken_=f&&f.token,l=new Ti(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,s,i,p=>{G(p+" ("+this.repoInfo_.toString()+")"),this.interrupt(Uh)},o))}catch(d){this.log_("Failed to get token: "+d),a||(this.repoInfo_.nodeAdmin&&G(d),c())}}})}interrupt(t){Q("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){Q("Resuming connection for reason: "+t),delete this.interruptReasons_[t],An(this.interruptReasons_)&&(this.reconnectDelay_=Ut,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let s=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:s})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let s=this.outstandingPuts_[t];s&&"h"in s.request&&s.queued&&(s.onComplete&&s.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,s){let i;s?i=s.map(o=>vr(o)).join("$"):i="default";let r=this.removeListen_(t,i);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(t,s){let i=new R(t).toString(),r;if(this.listens.has(i)){let o=this.listens.get(i);r=o.get(s),o.delete(s),o.size===0&&this.listens.delete(i)}else r=void 0;return r}onAuthRevoked_(t,s){Q("Auth token revoked: "+t+"/"+s),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=fl&&(this.reconnectDelay_=dl,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,s){Q("App check token revoked: "+t+"/"+s),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=fl&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let s of t.values())this.sendListen_(s);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},s="js";Ee()&&(this.repoInfo_.nodeAdmin?s="admin_node":s="node"),t["sdk."+s+"."+gr.replace(/\./g,"-")]=1,Zs()?t["framework.cordova"]=1:Ea()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=Bn.getInstance().currentlyOnline();return An(this.interruptReasons_)&&t}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),b=class n{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n(e,t)}};var St=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let s=new b(We,e),i=new b(We,t);return this.compare(s,i)!==0}minPost(){return b.MIN}};var Mn,Un=class extends St{static get __EMPTY_NODE(){return Mn}static set __EMPTY_NODE(e){Mn=e}compare(e,t){return tt(e.name,t.name)}isDefinedOn(e){throw mt("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return b.MIN}maxPost(){return new b(Re,Mn)}makePost(e,t){return m(typeof e=="string","KeyIndex indexValue must always be a string."),new b(e,Mn)}toString(){return".key"}},Te=new Un;var Et=class{constructor(e,t,s,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?s(e.key,t):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},me=(()=>{class n{constructor(t,s,i,r,o){this.key=t,this.value=s,this.color=i??n.RED,this.left=r??de.EMPTY_NODE,this.right=o??de.EMPTY_NODE}copy(t,s,i,r,o){return new n(t??this.key,s??this.value,i??this.color,r??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,s,i){let r=this,o=i(t,r.key);return o<0?r=r.copy(null,null,null,r.left.insert(t,s,i),null):o===0?r=r.copy(null,s,null,null,null):r=r.copy(null,null,null,null,r.right.insert(t,s,i)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return de.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,s){let i,r;if(i=this,s(t,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(t,s),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),s(t,i.key)===0){if(i.right.isEmpty())return de.EMPTY_NODE;r=i.right.min_(),i=i.copy(r.key,r.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(t,s))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),s=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,s)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),Ii=class{copy(e,t,s,i,r){return this}insert(e,t,s){return new me(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},de=class n{constructor(e,t=n.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,me.BLACK,null,null))}remove(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,me.BLACK,null,null))}get(e){let t,s=this.root_;for(;!s.isEmpty();){if(t=this.comparator_(e,s.key),t===0)return s.value;t<0?s=s.left:t>0&&(s=s.right)}return null}getPredecessorKey(e){let t,s=this.root_,i=null;for(;!s.isEmpty();)if(t=this.comparator_(e,s.key),t===0){if(s.left.isEmpty())return i?i.key:null;for(s=s.left;!s.right.isEmpty();)s=s.right;return s.key}else t<0?s=s.left:t>0&&(i=s,s=s.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Et(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Et(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Et(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Et(this.root_,null,this.comparator_,!0,e)}};de.EMPTY_NODE=new Ii;function Vh(n,e){return tt(n.name,e.name)}function Cr(n,e){return tt(n,e)}var Ni;function Kh(n){Ni=n}var tc=function(n){return typeof n=="number"?"number:"+Ll(n):"string:"+n},nc=function(n){if(n.isLeafNode()){let e=n.val();m(typeof e=="string"||typeof e=="number"||typeof e=="object"&&ue(e,".sv"),"Priority must be a string or number.")}else m(n===Ni||n.isEmpty(),"priority of unexpected type.");m(n===Ni||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var pl,Tt=(()=>{class n{constructor(t,s=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=s,this.lazyHash_=null,m(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),nc(this.priorityNode_)}static set __childrenNodeConstructor(t){pl=t}static get __childrenNodeConstructor(){return pl}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return C(t)?this:T(t)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,s){return null}updateImmediateChild(t,s){return t===".priority"?this.updatePriority(s):s.isEmpty()&&t!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,s).updatePriority(this.priorityNode_)}updateChild(t,s){let i=T(t);return i===null?s:s.isEmpty()&&i!==".priority"?this:(m(i!==".priority"||Be(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(M(t),s)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,s){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+tc(this.priorityNode_.val())+":");let s=typeof this.value_;t+=s+":",s==="number"?t+=Ll(this.value_):t+=this.value_,this.lazyHash_=Ml(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(m(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let s=typeof t.value_,i=typeof this.value_,r=n.VALUE_TYPE_ORDER.indexOf(s),o=n.VALUE_TYPE_ORDER.indexOf(i);return m(r>=0,"Unknown leaf type: "+s),m(o>=0,"Unknown leaf type: "+i),r===o?i==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-r}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let s=t;return this.value_===s.value_&&this.priorityNode_.equals(s.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),sc,ic;function qh(n){sc=n}function Qh(n){ic=n}var Ai=class extends St{compare(e,t){let s=e.node.getPriority(),i=t.node.getPriority(),r=s.compareTo(i);return r===0?tt(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return b.MIN}maxPost(){return new b(Re,new Tt("[PRIORITY-POST]",ic))}makePost(e,t){let s=sc(e);return new b(t,new Tt("[PRIORITY-POST]",s))}toString(){return".priority"}},O=new Ai;var zh=Math.log(2),Pi=class{constructor(e){let t=r=>parseInt(Math.log(r)/zh,10),s=r=>parseInt(Array(r+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let i=s(this.count);this.bits_=e+1&i}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},Vn=function(n,e,t,s){n.sort(e);let i=function(l,c){let u=c-l,h,d;if(u===0)return null;if(u===1)return h=n[l],d=t?t(h):h,new me(d,h.node,me.BLACK,null,null);{let f=parseInt(u/2,10)+l,p=i(l,f),_=i(f+1,c);return h=n[f],d=t?t(h):h,new me(d,h.node,me.BLACK,p,_)}},r=function(l){let c=null,u=null,h=n.length,d=function(p,_){let w=h-p,k=h;h-=p;let D=i(w+1,k),W=n[w],V=t?t(W):W;f(new me(V,W.node,_,null,D))},f=function(p){c?(c.left=p,c=p):(u=p,c=p)};for(let p=0;p<l.count;++p){let _=l.nextBitIsOne(),w=Math.pow(2,l.count-(p+1));_?d(w,me.BLACK):(d(w,me.BLACK),d(w,me.RED))}return u},o=new Pi(n.length),a=r(o);return new de(s||e,a)};var ci,yt={},Ct=class n{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return m(yt&&O,"ChildrenNode.ts has not been loaded"),ci=ci||new n({".priority":yt},{".priority":O}),ci}get(e){let t=Oe(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof de?t:null}hasIndex(e){return ue(this.indexSet_,e.toString())}addIndex(e,t){m(e!==Te,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let s=[],i=!1,r=t.getIterator(b.Wrap),o=r.getNext();for(;o;)i=i||e.isDefinedOn(o.node),s.push(o),o=r.getNext();let a;i?a=Vn(s,e.getCompare()):a=yt;let l=e.toString(),c=Object.assign({},this.indexSet_);c[l]=e;let u=Object.assign({},this.indexes_);return u[l]=a,new n(u,c)}addToIndexes(e,t){let s=Ft(this.indexes_,(i,r)=>{let o=Oe(this.indexSet_,r);if(m(o,"Missing index implementation for "+r),i===yt)if(o.isDefinedOn(e.node)){let a=[],l=t.getIterator(b.Wrap),c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),Vn(a,o.getCompare())}else return yt;else{let a=t.get(e.name),l=i;return a&&(l=l.remove(new b(e.name,a))),l.insert(e,e.node)}});return new n(s,this.indexSet_)}removeFromIndexes(e,t){let s=Ft(this.indexes_,i=>{if(i===yt)return i;{let r=t.get(e.name);return r?i.remove(new b(e.name,r)):i}});return new n(s,this.indexSet_)}};var Vt,S=(()=>{class n{constructor(t,s,i){this.children_=t,this.priorityNode_=s,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&nc(this.priorityNode_),this.children_.isEmpty()&&m(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Vt||(Vt=new n(new de(Cr),null,Ct.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Vt}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let s=this.children_.get(t);return s===null?Vt:s}}getChild(t){let s=T(t);return s===null?this:this.getImmediateChild(s).getChild(M(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,s){if(m(s,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(s);{let i=new b(t,s),r,o;s.isEmpty()?(r=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(i,this.children_)):(r=this.children_.insert(t,s),o=this.indexMap_.addToIndexes(i,this.children_));let a=r.isEmpty()?Vt:this.priorityNode_;return new n(r,a,o)}}updateChild(t,s){let i=T(t);if(i===null)return s;{m(T(t)!==".priority"||Be(t)===1,".priority must be the last token in a path");let r=this.getImmediateChild(i).updateChild(M(t),s);return this.updateImmediateChild(i,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let s={},i=0,r=0,o=!0;if(this.forEachChild(O,(a,l)=>{s[a]=l.val(t),i++,o&&n.INTEGER_REGEXP_.test(a)?r=Math.max(r,Number(a)):o=!1}),!t&&o&&r<2*i){let a=[];for(let l in s)a[l]=s[l];return a}else return t&&!this.getPriority().isEmpty()&&(s[".priority"]=this.getPriority().val()),s}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+tc(this.getPriority().val())+":"),this.forEachChild(O,(s,i)=>{let r=i.hash();r!==""&&(t+=":"+s+":"+r)}),this.lazyHash_=t===""?"":Ml(t)}return this.lazyHash_}getPredecessorChildName(t,s,i){let r=this.resolveIndex_(i);if(r){let o=r.getPredecessorKey(new b(t,s));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let s=this.resolveIndex_(t);if(s){let i=s.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(t){let s=this.getFirstChildName(t);return s?new b(s,this.children_.get(s)):null}getLastChildName(t){let s=this.resolveIndex_(t);if(s){let i=s.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(t){let s=this.getLastChildName(t);return s?new b(s,this.children_.get(s)):null}forEachChild(t,s){let i=this.resolveIndex_(t);return i?i.inorderTraversal(r=>s(r.name,r.node)):this.children_.inorderTraversal(s)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,s){let i=this.resolveIndex_(s);if(i)return i.getIteratorFrom(t,r=>r);{let r=this.children_.getIteratorFrom(t.name,b.Wrap),o=r.peek();for(;o!=null&&s.compare(o,t)<0;)r.getNext(),o=r.peek();return r}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,s){let i=this.resolveIndex_(s);if(i)return i.getReverseIteratorFrom(t,r=>r);{let r=this.children_.getReverseIteratorFrom(t.name,b.Wrap),o=r.peek();for(;o!=null&&s.compare(o,t)>0;)r.getNext(),o=r.peek();return r}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===hn?-1:0}withIndex(t){if(t===Te||this.indexMap_.hasIndex(t))return this;{let s=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,s)}}isIndexed(t){return t===Te||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let s=t;if(this.getPriority().equals(s.getPriority()))if(this.children_.count()===s.children_.count()){let i=this.getIterator(O),r=s.getIterator(O),o=i.getNext(),a=r.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=i.getNext(),a=r.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===Te?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),Ri=class extends S{constructor(){super(new de(Cr),S.EMPTY_NODE,Ct.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return S.EMPTY_NODE}isEmpty(){return!1}},hn=new Ri;Object.defineProperties(b,{MIN:{value:new b(We,S.EMPTY_NODE)},MAX:{value:new b(Re,hn)}});Un.__EMPTY_NODE=S.EMPTY_NODE;Tt.__childrenNodeConstructor=S;Kh(hn);Qh(hn);var jh=!0;function F(n,e=null){if(n===null)return S.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),m(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let t=n;return new Tt(t,F(e))}if(!(n instanceof Array)&&jh){let t=[],s=!1;if(z(n,(o,a)=>{if(o.substring(0,1)!=="."){let l=F(a);l.isEmpty()||(s=s||!l.getPriority().isEmpty(),t.push(new b(o,l)))}}),t.length===0)return S.EMPTY_NODE;let r=Vn(t,Vh,o=>o.name,Cr);if(s){let o=Vn(t,O.getCompare());return new S(r,F(e),new Ct({".priority":o},{".priority":O}))}else return new S(r,F(e),Ct.Default)}else{let t=S.EMPTY_NODE;return z(n,(s,i)=>{if(ue(n,s)&&s.substring(0,1)!=="."){let r=F(i);(r.isLeafNode()||!r.isEmpty())&&(t=t.updateImmediateChild(s,r))}}),t.updatePriority(F(e))}}qh(F);var Yt=class extends St{constructor(e){super(),this.indexPath_=e,m(!C(e)&&T(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let s=this.extractChild(e.node),i=this.extractChild(t.node),r=s.compareTo(i);return r===0?tt(e.name,t.name):r}makePost(e,t){let s=F(e),i=S.EMPTY_NODE.updateChild(this.indexPath_,s);return new b(t,i)}maxPost(){let e=S.EMPTY_NODE.updateChild(this.indexPath_,hn);return new b(Re,e)}toString(){return Ht(this.indexPath_,0).join("/")}};var ki=class extends St{compare(e,t){let s=e.node.compareTo(t.node);return s===0?tt(e.name,t.name):s}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return b.MIN}maxPost(){return b.MAX}makePost(e,t){let s=F(e);return new b(t,s)}toString(){return".value"}},br=new ki;function rc(n){return{type:"value",snapshotNode:n}}function bt(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Xt(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Jt(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function Gh(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}var Zt=class{constructor(e){this.index_=e}updateChild(e,t,s,i,r,o){m(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(i).equals(s.getChild(i))&&a.isEmpty()===s.isEmpty()||(o!=null&&(s.isEmpty()?e.hasChild(t)?o.trackChildChange(Xt(t,a)):m(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(bt(t,s)):o.trackChildChange(Jt(t,s,a))),e.isLeafNode()&&s.isEmpty())?e:e.updateImmediateChild(t,s).withIndex(this.index_)}updateFullNode(e,t,s){return s!=null&&(e.isLeafNode()||e.forEachChild(O,(i,r)=>{t.hasChild(i)||s.trackChildChange(Xt(i,r))}),t.isLeafNode()||t.forEachChild(O,(i,r)=>{if(e.hasChild(i)){let o=e.getImmediateChild(i);o.equals(r)||s.trackChildChange(Jt(i,r,o))}else s.trackChildChange(bt(i,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?S.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var Kn=class n{constructor(e){this.indexedFilter_=new Zt(e.getIndex()),this.index_=e.getIndex(),this.startPost_=n.getStartPost_(e),this.endPost_=n.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,s=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&s}updateChild(e,t,s,i,r,o){return this.matches(new b(t,s))||(s=S.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,s,i,r,o)}updateFullNode(e,t,s){t.isLeafNode()&&(t=S.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(S.EMPTY_NODE);let r=this;return t.forEachChild(O,(o,a)=>{r.matches(new b(o,a))||(i=i.updateImmediateChild(o,S.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,s)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var Di=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let s=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?s<=0:s<0},this.withinEndPost=t=>{let s=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?s<=0:s<0},this.rangedFilter_=new Kn(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,s,i,r,o){return this.rangedFilter_.matches(new b(t,s))||(s=S.EMPTY_NODE),e.getImmediateChild(t).equals(s)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,s,i,r,o):this.fullLimitUpdateChild_(e,t,s,r,o)}updateFullNode(e,t,s){let i;if(t.isLeafNode()||t.isEmpty())i=S.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){i=S.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){let a=r.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))i=i.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{i=t.withIndex(this.index_),i=i.updatePriority(S.EMPTY_NODE);let r;this.reverse_?r=i.getReverseIterator(this.index_):r=i.getIterator(this.index_);let o=0;for(;r.hasNext();){let a=r.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:i=i.updateImmediateChild(a.name,S.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,s)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,s,i,r){let o;if(this.reverse_){let h=this.index_.getCompare();o=(d,f)=>h(f,d)}else o=this.index_.getCompare();let a=e;m(a.numChildren()===this.limit_,"");let l=new b(t,s),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),u=this.rangedFilter_.matches(l);if(a.hasChild(t)){let h=a.getImmediateChild(t),d=i.getChildAfterChild(this.index_,c,this.reverse_);for(;d!=null&&(d.name===t||a.hasChild(d.name));)d=i.getChildAfterChild(this.index_,d,this.reverse_);let f=d==null?1:o(d,l);if(u&&!s.isEmpty()&&f>=0)return r?.trackChildChange(Jt(t,s,h)),a.updateImmediateChild(t,s);{r?.trackChildChange(Xt(t,h));let _=a.updateImmediateChild(t,S.EMPTY_NODE);return d!=null&&this.rangedFilter_.matches(d)?(r?.trackChildChange(bt(d.name,d.node)),_.updateImmediateChild(d.name,d.node)):_}}else return s.isEmpty()?e:u&&o(c,l)>=0?(r!=null&&(r.trackChildChange(Xt(c.name,c.node)),r.trackChildChange(bt(t,s))),a.updateImmediateChild(t,s).updateImmediateChild(c.name,S.EMPTY_NODE)):e}};var en=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=O}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return m(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return m(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:We}hasEnd(){return this.endSet_}getIndexEndValue(){return m(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return m(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Re}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return m(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===O}copy(){let e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function $h(n){return n.loadsAllData()?new Zt(n.getIndex()):n.hasLimit()?new Di(n):new Kn(n)}function Hh(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function Yh(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function Mi(n,e,t){let s=n.copy();return s.startSet_=!0,e===void 0&&(e=null),s.indexStartValue_=e,t!=null?(s.startNameSet_=!0,s.indexStartName_=t):(s.startNameSet_=!1,s.indexStartName_=""),s}function Xh(n,e,t){let s;return n.index_===Te||t?s=Mi(n,e,t):s=Mi(n,e,Re),s.startAfterSet_=!0,s}function Oi(n,e,t){let s=n.copy();return s.endSet_=!0,e===void 0&&(e=null),s.indexEndValue_=e,t!==void 0?(s.endNameSet_=!0,s.indexEndName_=t):(s.endNameSet_=!1,s.indexEndName_=""),s}function Jh(n,e,t){let s;return n.index_===Te||t?s=Oi(n,e,t):s=Oi(n,e,We),s.endBeforeSet_=!0,s}function as(n,e){let t=n.copy();return t.index_=e,t}function ml(n){let e={};if(n.isDefault())return e;let t;if(n.index_===O?t="$priority":n.index_===br?t="$value":n.index_===Te?t="$key":(m(n.index_ instanceof Yt,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=U(t),n.startSet_){let s=n.startAfterSet_?"startAfter":"startAt";e[s]=U(n.indexStartValue_),n.startNameSet_&&(e[s]+=","+U(n.indexStartName_))}if(n.endSet_){let s=n.endBeforeSet_?"endBefore":"endAt";e[s]=U(n.indexEndValue_),n.endNameSet_&&(e[s]+=","+U(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function _l(n){let e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==O&&(e.i=n.index_.toString()),e}var xi=class n extends Fn{constructor(e,t,s,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=s,this.appCheckTokenProvider_=i,this.log_=un("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(m(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,s,i){let r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);let o=n.getListenId_(e,s),a={};this.listens_[o]=a;let l=ml(e._queryParams);this.restRequest_(r+".json",l,(c,u)=>{let h=u;if(c===404&&(h=null,c=null),c===null&&this.onDataUpdate_(r,h,!1,s),Oe(this.listens_,o)===a){let d;c?c===401?d="permission_denied":d="rest_error:"+c:d="ok",i(d,null)}})}unlisten(e,t){let s=n.getListenId_(e,t);delete this.listens_[s]}get(e){let t=ml(e._queryParams),s=e._path.toString(),i=new H;return this.restRequest_(s+".json",t,(r,o)=>{let a=o;r===404&&(a=null,r=null),r===null?(this.onDataUpdate_(s,a,!1,null),i.resolve(a)):i.reject(new Error(a))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},s){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,r])=>{i&&i.accessToken&&(t.auth=i.accessToken),r&&r.token&&(t.ac=r.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Ta(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(s&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=Nn(a.responseText)}catch{G("Failed to parse JSON response for "+o+": "+a.responseText)}s(null,l)}else a.status!==401&&a.status!==404&&G("Got unsuccessful REST response for "+o+" Status: "+a.status),s(a.status);s=null}},a.open("GET",o,!0),a.send()})}};var Li=class{constructor(){this.rootNode_=S.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function qn(){return{value:null,children:new Map}}function kt(n,e,t){if(C(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{let s=T(e);n.children.has(s)||n.children.set(s,qn());let i=n.children.get(s);e=M(e),kt(i,e,t)}}function Fi(n,e){if(C(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{let t=n.value;return n.value=null,t.forEachChild(O,(s,i)=>{kt(n,new R(s),i)}),Fi(n,e)}}else if(n.children.size>0){let t=T(e);return e=M(e),n.children.has(t)&&Fi(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function Wi(n,e,t){n.value!==null?t(e,n.value):Zh(n,(s,i)=>{let r=new R(e.toString()+"/"+s);Wi(i,r,t)})}function Zh(n,e){n.children.forEach((t,s)=>{e(s,t)})}var Bi=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&z(this.last_,(s,i)=>{t[s]=t[s]-i}),this.last_=e,t}};var gl=10*1e3,ed=30*1e3,td=5*60*1e3,Ui=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Bi(e);let s=gl+(ed-gl)*Math.random();qt(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){let e=this.statsListener_.get(),t={},s=!1;z(e,(i,r)=>{r>0&&ue(this.statsToReport_,i)&&(t[i]=r,s=!0)}),s&&this.server_.reportStats(t),qt(this.reportStats_.bind(this),Math.floor(Math.random()*2*td))}};var Se=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(Se||{});function Ir(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Nr(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Ar(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var Vi=class n{constructor(e,t,s){this.path=e,this.affectedTree=t,this.revert=s,this.type=Se.ACK_USER_WRITE,this.source=Ir()}operationForChild(e){if(C(this.path)){if(this.affectedTree.value!=null)return m(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new R(e));return new n(P(),t,this.revert)}}else return m(T(this.path)===e,"operationForChild called for unrelated child."),new n(M(this.path),this.affectedTree,this.revert)}};var Qn=class n{constructor(e,t){this.source=e,this.path=t,this.type=Se.LISTEN_COMPLETE}operationForChild(e){return C(this.path)?new n(this.source,P()):new n(this.source,M(this.path))}};var It=class n{constructor(e,t,s){this.source=e,this.path=t,this.snap=s,this.type=Se.OVERWRITE}operationForChild(e){return C(this.path)?new n(this.source,P(),this.snap.getImmediateChild(e)):new n(this.source,M(this.path),this.snap)}};var tn=class n{constructor(e,t,s){this.source=e,this.path=t,this.children=s,this.type=Se.MERGE}operationForChild(e){if(C(this.path)){let t=this.children.subtree(new R(e));return t.isEmpty()?null:t.value?new It(this.source,P(),t.value):new n(this.source,P(),t)}else return m(T(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,M(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var be=class{constructor(e,t,s){this.node_=e,this.fullyInitialized_=t,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(C(e))return this.isFullyInitialized()&&!this.filtered_;let t=T(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var Ki=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function nd(n,e,t,s){let i=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(Gh(o.childName,o.snapshotNode))}),Kt(n,i,"child_removed",e,s,t),Kt(n,i,"child_added",e,s,t),Kt(n,i,"child_moved",r,s,t),Kt(n,i,"child_changed",e,s,t),Kt(n,i,"value",e,s,t),i}function Kt(n,e,t,s,i,r){let o=s.filter(a=>a.type===t);o.sort((a,l)=>id(n,a,l)),o.forEach(a=>{let l=sd(n,a,r);i.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,n.query_))})})}function sd(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function id(n,e,t){if(e.childName==null||t.childName==null)throw mt("Should only compare child_ events.");let s=new b(e.childName,e.snapshotNode),i=new b(t.childName,t.snapshotNode);return n.index_.compare(s,i)}function ls(n,e){return{eventCache:n,serverCache:e}}function zt(n,e,t,s){return ls(new be(e,t,s),n.serverCache)}function oc(n,e,t,s){return ls(n.eventCache,new be(e,t,s))}function zn(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function et(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var ui,rd=()=>(ui||(ui=new de(sh)),ui),X=class n{constructor(e,t=rd()){this.value=e,this.children=t}static fromObject(e){let t=new n(null);return z(e,(s,i)=>{t=t.set(new R(s),i)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:P(),value:this.value};if(C(e))return null;{let s=T(e),i=this.children.get(s);if(i!==null){let r=i.findRootMostMatchingPathAndValue(M(e),t);return r!=null?{path:x(new R(s),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(C(e))return this;{let t=T(e),s=this.children.get(t);return s!==null?s.subtree(M(e)):new n(null)}}set(e,t){if(C(e))return new n(t,this.children);{let s=T(e),r=(this.children.get(s)||new n(null)).set(M(e),t),o=this.children.insert(s,r);return new n(this.value,o)}}remove(e){if(C(e))return this.children.isEmpty()?new n(null):new n(null,this.children);{let t=T(e),s=this.children.get(t);if(s){let i=s.remove(M(e)),r;return i.isEmpty()?r=this.children.remove(t):r=this.children.insert(t,i),this.value===null&&r.isEmpty()?new n(null):new n(this.value,r)}else return this}}get(e){if(C(e))return this.value;{let t=T(e),s=this.children.get(t);return s?s.get(M(e)):null}}setTree(e,t){if(C(e))return t;{let s=T(e),r=(this.children.get(s)||new n(null)).setTree(M(e),t),o;return r.isEmpty()?o=this.children.remove(s):o=this.children.insert(s,r),new n(this.value,o)}}fold(e){return this.fold_(P(),e)}fold_(e,t){let s={};return this.children.inorderTraversal((i,r)=>{s[i]=r.fold_(x(e,i),t)}),t(e,this.value,s)}findOnPath(e,t){return this.findOnPath_(e,P(),t)}findOnPath_(e,t,s){let i=this.value?s(t,this.value):!1;if(i)return i;if(C(e))return null;{let r=T(e),o=this.children.get(r);return o?o.findOnPath_(M(e),x(t,r),s):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,P(),t)}foreachOnPath_(e,t,s){if(C(e))return this;{this.value&&s(t,this.value);let i=T(e),r=this.children.get(i);return r?r.foreachOnPath_(M(e),x(t,i),s):new n(null)}}foreach(e){this.foreach_(P(),e)}foreach_(e,t){this.children.inorderTraversal((s,i)=>{i.foreach_(x(e,s),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,s)=>{s.value&&e(t,s.value)})}};var _e=class n{constructor(e){this.writeTree_=e}static empty(){return new n(new X(null))}};function jt(n,e,t){if(C(e))return new _e(new X(t));{let s=n.writeTree_.findRootMostValueAndPath(e);if(s!=null){let i=s.path,r=s.value,o=Y(i,e);return r=r.updateChild(o,t),new _e(n.writeTree_.set(i,r))}else{let i=new X(t),r=n.writeTree_.setTree(e,i);return new _e(r)}}}function qi(n,e,t){let s=n;return z(t,(i,r)=>{s=jt(s,x(e,i),r)}),s}function yl(n,e){if(C(e))return _e.empty();{let t=n.writeTree_.setTree(e,new X(null));return new _e(t)}}function Qi(n,e){return nt(n,e)!=null}function nt(n,e){let t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(Y(t.path,e)):null}function vl(n){let e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(O,(s,i)=>{e.push(new b(s,i))}):n.writeTree_.children.inorderTraversal((s,i)=>{i.value!=null&&e.push(new b(s,i.value))}),e}function Le(n,e){if(C(e))return n;{let t=nt(n,e);return t!=null?new _e(new X(t)):new _e(n.writeTree_.subtree(e))}}function zi(n){return n.writeTree_.isEmpty()}function Nt(n,e){return ac(P(),n.writeTree_,e)}function ac(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let s=null;return e.children.inorderTraversal((i,r)=>{i===".priority"?(m(r.value!==null,"Priority writes must always be leaf nodes"),s=r.value):t=ac(x(n,i),r,t)}),!t.getChild(n).isEmpty()&&s!==null&&(t=t.updateChild(x(n,".priority"),s)),t}}function cs(n,e){return hc(e,n)}function od(n,e,t,s,i){m(s>n.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:s,visible:i}),i&&(n.visibleWrites=jt(n.visibleWrites,e,t)),n.lastWriteId=s}function ad(n,e,t,s){m(s>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:s,visible:!0}),n.visibleWrites=qi(n.visibleWrites,e,t),n.lastWriteId=s}function ld(n,e){for(let t=0;t<n.allWrites.length;t++){let s=n.allWrites[t];if(s.writeId===e)return s}return null}function cd(n,e){let t=n.allWrites.findIndex(a=>a.writeId===e);m(t>=0,"removeWrite called with nonexistent writeId.");let s=n.allWrites[t];n.allWrites.splice(t,1);let i=s.visible,r=!1,o=n.allWrites.length-1;for(;i&&o>=0;){let a=n.allWrites[o];a.visible&&(o>=t&&ud(a,s.path)?i=!1:he(s.path,a.path)&&(r=!0)),o--}if(i){if(r)return hd(n),!0;if(s.snap)n.visibleWrites=yl(n.visibleWrites,s.path);else{let a=s.children;z(a,l=>{n.visibleWrites=yl(n.visibleWrites,x(s.path,l))})}return!0}else return!1}function ud(n,e){if(n.snap)return he(n.path,e);for(let t in n.children)if(n.children.hasOwnProperty(t)&&he(x(n.path,t),e))return!0;return!1}function hd(n){n.visibleWrites=lc(n.allWrites,dd,P()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function dd(n){return n.visible}function lc(n,e,t){let s=_e.empty();for(let i=0;i<n.length;++i){let r=n[i];if(e(r)){let o=r.path,a;if(r.snap)he(t,o)?(a=Y(t,o),s=jt(s,a,r.snap)):he(o,t)&&(a=Y(o,t),s=jt(s,P(),r.snap.getChild(a)));else if(r.children){if(he(t,o))a=Y(t,o),s=qi(s,a,r.children);else if(he(o,t))if(a=Y(o,t),C(a))s=qi(s,P(),r.children);else{let l=Oe(r.children,T(a));if(l){let c=l.getChild(M(a));s=jt(s,P(),c)}}}else throw mt("WriteRecord should have .snap or .children")}}return s}function cc(n,e,t,s,i){if(!s&&!i){let r=nt(n.visibleWrites,e);if(r!=null)return r;{let o=Le(n.visibleWrites,e);if(zi(o))return t;if(t==null&&!Qi(o,P()))return null;{let a=t||S.EMPTY_NODE;return Nt(o,a)}}}else{let r=Le(n.visibleWrites,e);if(!i&&zi(r))return t;if(!i&&t==null&&!Qi(r,P()))return null;{let o=function(c){return(c.visible||i)&&(!s||!~s.indexOf(c.writeId))&&(he(c.path,e)||he(e,c.path))},a=lc(n.allWrites,o,e),l=t||S.EMPTY_NODE;return Nt(a,l)}}}function fd(n,e,t){let s=S.EMPTY_NODE,i=nt(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(O,(r,o)=>{s=s.updateImmediateChild(r,o)}),s;if(t){let r=Le(n.visibleWrites,e);return t.forEachChild(O,(o,a)=>{let l=Nt(Le(r,new R(o)),a);s=s.updateImmediateChild(o,l)}),vl(r).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}else{let r=Le(n.visibleWrites,e);return vl(r).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}}function pd(n,e,t,s,i){m(s||i,"Either existingEventSnap or existingServerSnap must exist");let r=x(e,t);if(Qi(n.visibleWrites,r))return null;{let o=Le(n.visibleWrites,r);return zi(o)?i.getChild(t):Nt(o,i.getChild(t))}}function md(n,e,t,s){let i=x(e,t),r=nt(n.visibleWrites,i);if(r!=null)return r;if(s.isCompleteForChild(t)){let o=Le(n.visibleWrites,i);return Nt(o,s.getNode().getImmediateChild(t))}else return null}function _d(n,e){return nt(n.visibleWrites,e)}function gd(n,e,t,s,i,r,o){let a,l=Le(n.visibleWrites,e),c=nt(l,P());if(c!=null)a=c;else if(t!=null)a=Nt(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let u=[],h=o.getCompare(),d=r?a.getReverseIteratorFrom(s,o):a.getIteratorFrom(s,o),f=d.getNext();for(;f&&u.length<i;)h(f,s)!==0&&u.push(f),f=d.getNext();return u}else return[]}function yd(){return{visibleWrites:_e.empty(),allWrites:[],lastWriteId:-1}}function jn(n,e,t,s){return cc(n.writeTree,n.treePath,e,t,s)}function Pr(n,e){return fd(n.writeTree,n.treePath,e)}function El(n,e,t,s){return pd(n.writeTree,n.treePath,e,t,s)}function Gn(n,e){return _d(n.writeTree,x(n.treePath,e))}function vd(n,e,t,s,i,r){return gd(n.writeTree,n.treePath,e,t,s,i,r)}function Rr(n,e,t){return md(n.writeTree,n.treePath,e,t)}function uc(n,e){return hc(x(n.treePath,e),n.writeTree)}function hc(n,e){return{treePath:n,writeTree:e}}var ji=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,s=e.childName;m(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),m(s!==".priority","Only non-priority child changes can be tracked.");let i=this.changeMap.get(s);if(i){let r=i.type;if(t==="child_added"&&r==="child_removed")this.changeMap.set(s,Jt(s,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&r==="child_added")this.changeMap.delete(s);else if(t==="child_removed"&&r==="child_changed")this.changeMap.set(s,Xt(s,i.oldSnap));else if(t==="child_changed"&&r==="child_added")this.changeMap.set(s,bt(s,e.snapshotNode));else if(t==="child_changed"&&r==="child_changed")this.changeMap.set(s,Jt(s,e.snapshotNode,i.oldSnap));else throw mt("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}};var Gi=class{getCompleteChild(e){return null}getChildAfterChild(e,t,s){return null}},dc=new Gi,nn=class{constructor(e,t,s=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=s}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let s=this.optCompleteServerCache_!=null?new be(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Rr(this.writes_,e,s)}}getChildAfterChild(e,t,s){let i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:et(this.viewCache_),r=vd(this.writes_,i,t,1,s,e);return r.length===0?null:r[0]}};function Ed(n){return{filter:n}}function wd(n,e){m(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),m(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function Sd(n,e,t,s,i){let r=new ji,o,a;if(t.type===Se.OVERWRITE){let c=t;c.source.fromUser?o=$i(n,e,c.path,c.snap,s,i,r):(m(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!C(c.path),o=$n(n,e,c.path,c.snap,s,i,a,r))}else if(t.type===Se.MERGE){let c=t;c.source.fromUser?o=Cd(n,e,c.path,c.children,s,i,r):(m(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=Hi(n,e,c.path,c.children,s,i,a,r))}else if(t.type===Se.ACK_USER_WRITE){let c=t;c.revert?o=Nd(n,e,c.path,s,i,r):o=bd(n,e,c.path,c.affectedTree,s,i,r)}else if(t.type===Se.LISTEN_COMPLETE)o=Id(n,e,t.path,s,r);else throw mt("Unknown operation type: "+t.type);let l=r.getChanges();return Td(e,o,l),{viewCache:o,changes:l}}function Td(n,e,t){let s=e.eventCache;if(s.isFullyInitialized()){let i=s.getNode().isLeafNode()||s.getNode().isEmpty(),r=zn(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!s.getNode().equals(r)||!s.getNode().getPriority().equals(r.getPriority()))&&t.push(rc(zn(e)))}}function fc(n,e,t,s,i,r){let o=e.eventCache;if(Gn(s,t)!=null)return e;{let a,l;if(C(t))if(m(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let c=et(e),u=c instanceof S?c:S.EMPTY_NODE,h=Pr(s,u);a=n.filter.updateFullNode(e.eventCache.getNode(),h,r)}else{let c=jn(s,et(e));a=n.filter.updateFullNode(e.eventCache.getNode(),c,r)}else{let c=T(t);if(c===".priority"){m(Be(t)===1,"Can't have a priority with additional path components");let u=o.getNode();l=e.serverCache.getNode();let h=El(s,t,u,l);h!=null?a=n.filter.updatePriority(u,h):a=o.getNode()}else{let u=M(t),h;if(o.isCompleteForChild(c)){l=e.serverCache.getNode();let d=El(s,t,o.getNode(),l);d!=null?h=o.getNode().getImmediateChild(c).updateChild(u,d):h=o.getNode().getImmediateChild(c)}else h=Rr(s,c,e.serverCache);h!=null?a=n.filter.updateChild(o.getNode(),c,h,u,i,r):a=o.getNode()}}return zt(e,a,o.isFullyInitialized()||C(t),n.filter.filtersNodes())}}function $n(n,e,t,s,i,r,o,a){let l=e.serverCache,c,u=o?n.filter:n.filter.getIndexedFilter();if(C(t))c=u.updateFullNode(l.getNode(),s,null);else if(u.filtersNodes()&&!l.isFiltered()){let f=l.getNode().updateChild(t,s);c=u.updateFullNode(l.getNode(),f,null)}else{let f=T(t);if(!l.isCompleteForPath(t)&&Be(t)>1)return e;let p=M(t),w=l.getNode().getImmediateChild(f).updateChild(p,s);f===".priority"?c=u.updatePriority(l.getNode(),w):c=u.updateChild(l.getNode(),f,w,p,dc,null)}let h=oc(e,c,l.isFullyInitialized()||C(t),u.filtersNodes()),d=new nn(i,h,r);return fc(n,h,t,i,d,a)}function $i(n,e,t,s,i,r,o){let a=e.eventCache,l,c,u=new nn(i,e,r);if(C(t))c=n.filter.updateFullNode(e.eventCache.getNode(),s,o),l=zt(e,c,!0,n.filter.filtersNodes());else{let h=T(t);if(h===".priority")c=n.filter.updatePriority(e.eventCache.getNode(),s),l=zt(e,c,a.isFullyInitialized(),a.isFiltered());else{let d=M(t),f=a.getNode().getImmediateChild(h),p;if(C(d))p=s;else{let _=u.getCompleteChild(h);_!=null?wr(d)===".priority"&&_.getChild(Zl(d)).isEmpty()?p=_:p=_.updateChild(d,s):p=S.EMPTY_NODE}if(f.equals(p))l=e;else{let _=n.filter.updateChild(a.getNode(),h,p,d,u,o);l=zt(e,_,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function wl(n,e){return n.eventCache.isCompleteForChild(e)}function Cd(n,e,t,s,i,r,o){let a=e;return s.foreach((l,c)=>{let u=x(t,l);wl(e,T(u))&&(a=$i(n,a,u,c,i,r,o))}),s.foreach((l,c)=>{let u=x(t,l);wl(e,T(u))||(a=$i(n,a,u,c,i,r,o))}),a}function Sl(n,e,t){return t.foreach((s,i)=>{e=e.updateChild(s,i)}),e}function Hi(n,e,t,s,i,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,c;C(t)?c=s:c=new X(null).setTree(t,s);let u=e.serverCache.getNode();return c.children.inorderTraversal((h,d)=>{if(u.hasChild(h)){let f=e.serverCache.getNode().getImmediateChild(h),p=Sl(n,f,d);l=$n(n,l,new R(h),p,i,r,o,a)}}),c.children.inorderTraversal((h,d)=>{let f=!e.serverCache.isCompleteForChild(h)&&d.value===null;if(!u.hasChild(h)&&!f){let p=e.serverCache.getNode().getImmediateChild(h),_=Sl(n,p,d);l=$n(n,l,new R(h),_,i,r,o,a)}}),l}function bd(n,e,t,s,i,r,o){if(Gn(i,t)!=null)return e;let a=e.serverCache.isFiltered(),l=e.serverCache;if(s.value!=null){if(C(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return $n(n,e,t,l.getNode().getChild(t),i,r,a,o);if(C(t)){let c=new X(null);return l.getNode().forEachChild(Te,(u,h)=>{c=c.set(new R(u),h)}),Hi(n,e,t,c,i,r,a,o)}else return e}else{let c=new X(null);return s.foreach((u,h)=>{let d=x(t,u);l.isCompleteForPath(d)&&(c=c.set(u,l.getNode().getChild(d)))}),Hi(n,e,t,c,i,r,a,o)}}function Id(n,e,t,s,i){let r=e.serverCache,o=oc(e,r.getNode(),r.isFullyInitialized()||C(t),r.isFiltered());return fc(n,o,t,s,dc,i)}function Nd(n,e,t,s,i,r){let o;if(Gn(s,t)!=null)return e;{let a=new nn(s,e,i),l=e.eventCache.getNode(),c;if(C(t)||T(t)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=jn(s,et(e));else{let h=e.serverCache.getNode();m(h instanceof S,"serverChildren would be complete if leaf node"),u=Pr(s,h)}u=u,c=n.filter.updateFullNode(l,u,r)}else{let u=T(t),h=Rr(s,u,e.serverCache);h==null&&e.serverCache.isCompleteForChild(u)&&(h=l.getImmediateChild(u)),h!=null?c=n.filter.updateChild(l,u,h,M(t),a,r):e.eventCache.getNode().hasChild(u)?c=n.filter.updateChild(l,u,S.EMPTY_NODE,M(t),a,r):c=l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=jn(s,et(e)),o.isLeafNode()&&(c=n.filter.updateFullNode(c,o,r)))}return o=e.serverCache.isFullyInitialized()||Gn(s,P())!=null,zt(e,c,o,n.filter.filtersNodes())}}var Yi=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let s=this.query_._queryParams,i=new Zt(s.getIndex()),r=$h(s);this.processor_=Ed(r);let o=t.serverCache,a=t.eventCache,l=i.updateFullNode(S.EMPTY_NODE,o.getNode(),null),c=r.updateFullNode(S.EMPTY_NODE,a.getNode(),null),u=new be(l,o.isFullyInitialized(),i.filtersNodes()),h=new be(c,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=ls(h,u),this.eventGenerator_=new Ki(this.query_)}get query(){return this.query_}};function Ad(n){return n.viewCache_.serverCache.getNode()}function Pd(n){return zn(n.viewCache_)}function Rd(n,e){let t=et(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!C(e)&&!t.getImmediateChild(T(e)).isEmpty())?t.getChild(e):null}function Tl(n){return n.eventRegistrations_.length===0}function kd(n,e){n.eventRegistrations_.push(e)}function Cl(n,e,t){let s=[];if(t){m(e==null,"A cancel should cancel all event registrations.");let i=n.query._path;n.eventRegistrations_.forEach(r=>{let o=r.createCancelEvent(t,i);o&&s.push(o)})}if(e){let i=[];for(let r=0;r<n.eventRegistrations_.length;++r){let o=n.eventRegistrations_[r];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(n.eventRegistrations_.slice(r+1));break}}n.eventRegistrations_=i}else n.eventRegistrations_=[];return s}function bl(n,e,t,s){e.type===Se.MERGE&&e.source.queryId!==null&&(m(et(n.viewCache_),"We should always have a full cache before handling merges"),m(zn(n.viewCache_),"Missing event cache, even though we have a server cache"));let i=n.viewCache_,r=Sd(n.processor_,i,e,t,s);return wd(n.processor_,r.viewCache),m(r.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=r.viewCache,pc(n,r.changes,r.viewCache.eventCache.getNode(),null)}function Dd(n,e){let t=n.viewCache_.eventCache,s=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(O,(r,o)=>{s.push(bt(r,o))}),t.isFullyInitialized()&&s.push(rc(t.getNode())),pc(n,s,t.getNode(),e)}function pc(n,e,t,s){let i=s?[s]:n.eventRegistrations_;return nd(n.eventGenerator_,e,t,i)}var Hn,Yn=class{constructor(){this.views=new Map}};function Md(n){m(!Hn,"__referenceConstructor has already been defined"),Hn=n}function Od(){return m(Hn,"Reference.ts has not been loaded"),Hn}function xd(n){return n.views.size===0}function kr(n,e,t,s){let i=e.source.queryId;if(i!==null){let r=n.views.get(i);return m(r!=null,"SyncTree gave us an op for an invalid query."),bl(r,e,t,s)}else{let r=[];for(let o of n.views.values())r=r.concat(bl(o,e,t,s));return r}}function mc(n,e,t,s,i){let r=e._queryIdentifier,o=n.views.get(r);if(!o){let a=jn(t,i?s:null),l=!1;a?l=!0:s instanceof S?(a=Pr(t,s),l=!1):(a=S.EMPTY_NODE,l=!1);let c=ls(new be(a,l,!1),new be(s,i,!1));return new Yi(e,c)}return o}function Ld(n,e,t,s,i,r){let o=mc(n,e,s,i,r);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),kd(o,t),Dd(o,t)}function Fd(n,e,t,s){let i=e._queryIdentifier,r=[],o=[],a=Ue(n);if(i==="default")for(let[l,c]of n.views.entries())o=o.concat(Cl(c,t,s)),Tl(c)&&(n.views.delete(l),c.query._queryParams.loadsAllData()||r.push(c.query));else{let l=n.views.get(i);l&&(o=o.concat(Cl(l,t,s)),Tl(l)&&(n.views.delete(i),l.query._queryParams.loadsAllData()||r.push(l.query)))}return a&&!Ue(n)&&r.push(new(Od())(e._repo,e._path)),{removed:r,events:o}}function _c(n){let e=[];for(let t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Fe(n,e){let t=null;for(let s of n.views.values())t=t||Rd(s,e);return t}function gc(n,e){if(e._queryParams.loadsAllData())return us(n);{let s=e._queryIdentifier;return n.views.get(s)}}function yc(n,e){return gc(n,e)!=null}function Ue(n){return us(n)!=null}function us(n){for(let e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var Xn;function Wd(n){m(!Xn,"__referenceConstructor has already been defined"),Xn=n}function Bd(){return m(Xn,"Reference.ts has not been loaded"),Xn}var Ud=1,Jn=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new X(null),this.pendingWriteTree_=yd(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function Dr(n,e,t,s,i){return od(n.pendingWriteTree_,e,t,s,i),i?Dt(n,new It(Ir(),e,t)):[]}function Vd(n,e,t,s){ad(n.pendingWriteTree_,e,t,s);let i=X.fromObject(t);return Dt(n,new tn(Ir(),e,i))}function xe(n,e,t=!1){let s=ld(n.pendingWriteTree_,e);if(cd(n.pendingWriteTree_,e)){let r=new X(null);return s.snap!=null?r=r.set(P(),!0):z(s.children,o=>{r=r.set(new R(o),!0)}),Dt(n,new Vi(s.path,r,t))}else return[]}function dn(n,e,t){return Dt(n,new It(Nr(),e,t))}function Kd(n,e,t){let s=X.fromObject(t);return Dt(n,new tn(Nr(),e,s))}function qd(n,e){return Dt(n,new Qn(Nr(),e))}function Qd(n,e,t){let s=Mr(n,t);if(s){let i=Or(s),r=i.path,o=i.queryId,a=Y(r,e),l=new Qn(Ar(o),a);return xr(n,r,l)}else return[]}function Zn(n,e,t,s,i=!1){let r=e._path,o=n.syncPointTree_.get(r),a=[];if(o&&(e._queryIdentifier==="default"||yc(o,e))){let l=Fd(o,e,t,s);xd(o)&&(n.syncPointTree_=n.syncPointTree_.remove(r));let c=l.removed;if(a=l.events,!i){let u=c.findIndex(d=>d._queryParams.loadsAllData())!==-1,h=n.syncPointTree_.findOnPath(r,(d,f)=>Ue(f));if(u&&!h){let d=n.syncPointTree_.subtree(r);if(!d.isEmpty()){let f=Gd(d);for(let p=0;p<f.length;++p){let _=f[p],w=_.query,k=Sc(n,_);n.listenProvider_.startListening(Gt(w),sn(n,w),k.hashFn,k.onComplete)}}}!h&&c.length>0&&!s&&(u?n.listenProvider_.stopListening(Gt(e),null):c.forEach(d=>{let f=n.queryToTagMap.get(ds(d));n.listenProvider_.stopListening(Gt(d),f)}))}$d(n,c)}return a}function vc(n,e,t,s){let i=Mr(n,s);if(i!=null){let r=Or(i),o=r.path,a=r.queryId,l=Y(o,e),c=new It(Ar(a),l,t);return xr(n,o,c)}else return[]}function zd(n,e,t,s){let i=Mr(n,s);if(i){let r=Or(i),o=r.path,a=r.queryId,l=Y(o,e),c=X.fromObject(t),u=new tn(Ar(a),l,c);return xr(n,o,u)}else return[]}function Xi(n,e,t,s=!1){let i=e._path,r=null,o=!1;n.syncPointTree_.foreachOnPath(i,(d,f)=>{let p=Y(d,i);r=r||Fe(f,p),o=o||Ue(f)});let a=n.syncPointTree_.get(i);a?(o=o||Ue(a),r=r||Fe(a,P())):(a=new Yn,n.syncPointTree_=n.syncPointTree_.set(i,a));let l;r!=null?l=!0:(l=!1,r=S.EMPTY_NODE,n.syncPointTree_.subtree(i).foreachChild((f,p)=>{let _=Fe(p,P());_&&(r=r.updateImmediateChild(f,_))}));let c=yc(a,e);if(!c&&!e._queryParams.loadsAllData()){let d=ds(e);m(!n.queryToTagMap.has(d),"View does not exist, but we have a tag");let f=Hd();n.queryToTagMap.set(d,f),n.tagToQueryMap.set(f,d)}let u=cs(n.pendingWriteTree_,i),h=Ld(a,e,t,u,r,l);if(!c&&!o&&!s){let d=gc(a,e);h=h.concat(Yd(n,e,d))}return h}function hs(n,e,t){let i=n.pendingWriteTree_,r=n.syncPointTree_.findOnPath(e,(o,a)=>{let l=Y(o,e),c=Fe(a,l);if(c)return c});return cc(i,e,r,t,!0)}function jd(n,e){let t=e._path,s=null;n.syncPointTree_.foreachOnPath(t,(c,u)=>{let h=Y(c,t);s=s||Fe(u,h)});let i=n.syncPointTree_.get(t);i?s=s||Fe(i,P()):(i=new Yn,n.syncPointTree_=n.syncPointTree_.set(t,i));let r=s!=null,o=r?new be(s,!0,!1):null,a=cs(n.pendingWriteTree_,e._path),l=mc(i,e,a,r?o.getNode():S.EMPTY_NODE,r);return Pd(l)}function Dt(n,e){return Ec(e,n.syncPointTree_,null,cs(n.pendingWriteTree_,P()))}function Ec(n,e,t,s){if(C(n.path))return wc(n,e,t,s);{let i=e.get(P());t==null&&i!=null&&(t=Fe(i,P()));let r=[],o=T(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){let c=t?t.getImmediateChild(o):null,u=uc(s,o);r=r.concat(Ec(a,l,c,u))}return i&&(r=r.concat(kr(i,n,s,t))),r}}function wc(n,e,t,s){let i=e.get(P());t==null&&i!=null&&(t=Fe(i,P()));let r=[];return e.children.inorderTraversal((o,a)=>{let l=t?t.getImmediateChild(o):null,c=uc(s,o),u=n.operationForChild(o);u&&(r=r.concat(wc(u,a,l,c)))}),i&&(r=r.concat(kr(i,n,s,t))),r}function Sc(n,e){let t=e.query,s=sn(n,t);return{hashFn:()=>(Ad(e)||S.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return s?Qd(n,t._path,s):qd(n,t._path);{let r=oh(i,t);return Zn(n,t,null,r)}}}}function sn(n,e){let t=ds(e);return n.queryToTagMap.get(t)}function ds(n){return n._path.toString()+"$"+n._queryIdentifier}function Mr(n,e){return n.tagToQueryMap.get(e)}function Or(n){let e=n.indexOf("$");return m(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new R(n.substr(0,e))}}function xr(n,e,t){let s=n.syncPointTree_.get(e);m(s,"Missing sync point for query tag that we're tracking");let i=cs(n.pendingWriteTree_,e);return kr(s,t,i,null)}function Gd(n){return n.fold((e,t,s)=>{if(t&&Ue(t))return[us(t)];{let i=[];return t&&(i=_c(t)),z(s,(r,o)=>{i=i.concat(o)}),i}})}function Gt(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(Bd())(n._repo,n._path):n}function $d(n,e){for(let t=0;t<e.length;++t){let s=e[t];if(!s._queryParams.loadsAllData()){let i=ds(s),r=n.queryToTagMap.get(i);n.queryToTagMap.delete(i),n.tagToQueryMap.delete(r)}}}function Hd(){return Ud++}function Yd(n,e,t){let s=e._path,i=sn(n,e),r=Sc(n,t),o=n.listenProvider_.startListening(Gt(e),i,r.hashFn,r.onComplete),a=n.syncPointTree_.subtree(s);if(i)m(!Ue(a.value),"If we're adding a query, it shouldn't be shadowed");else{let l=a.fold((c,u,h)=>{if(!C(c)&&u&&Ue(u))return[us(u).query];{let d=[];return u&&(d=d.concat(_c(u).map(f=>f.query))),z(h,(f,p)=>{d=d.concat(p)}),d}});for(let c=0;c<l.length;++c){let u=l[c];n.listenProvider_.stopListening(Gt(u),sn(n,u))}}return o}var Ji=class n{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new n(t)}node(){return this.node_}},Zi=class n{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=x(this.path_,e);return new n(this.syncTree_,t)}node(){return hs(this.syncTree_,this.path_)}},Xd=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},Il=function(n,e,t){if(!n||typeof n!="object")return n;if(m(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return Jd(n[".sv"],e,t);if(typeof n[".sv"]=="object")return Zd(n[".sv"],e);m(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},Jd=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:m(!1,"Unexpected server value: "+n)}},Zd=function(n,e,t){n.hasOwnProperty("increment")||m(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let s=n.increment;typeof s!="number"&&m(!1,"Unexpected increment value: "+s);let i=e.node();if(m(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return s;let o=i.getValue();return typeof o!="number"?s:o+s},Tc=function(n,e,t,s){return Fr(e,new Zi(t,n),s)},Lr=function(n,e,t){return Fr(n,new Ji(e),t)};function Fr(n,e,t){let s=n.getPriority().val(),i=Il(s,e.getImmediateChild(".priority"),t),r;if(n.isLeafNode()){let o=n,a=Il(o.getValue(),e,t);return a!==o.getValue()||i!==o.getPriority().val()?new Tt(a,F(i)):n}else{let o=n;return r=o,i!==o.getPriority().val()&&(r=r.updatePriority(new Tt(i))),o.forEachChild(O,(a,l)=>{let c=Fr(l,e.getImmediateChild(a),t);c!==l&&(r=r.updateImmediateChild(a,c))}),r}}var rn=class{constructor(e="",t=null,s={children:{},childCount:0}){this.name=e,this.parent=t,this.node=s}};function fs(n,e){let t=e instanceof R?e:new R(e),s=n,i=T(t);for(;i!==null;){let r=Oe(s.node.children,i)||{children:{},childCount:0};s=new rn(i,s,r),t=M(t),i=T(t)}return s}function st(n){return n.node.value}function Wr(n,e){n.node.value=e,er(n)}function Cc(n){return n.node.childCount>0}function ef(n){return st(n)===void 0&&!Cc(n)}function ps(n,e){z(n.node.children,(t,s)=>{e(new rn(t,n,s))})}function bc(n,e,t,s){t&&!s&&e(n),ps(n,i=>{bc(i,e,!0,s)}),t&&s&&e(n)}function tf(n,e,t){let s=t?n:n.parent;for(;s!==null;){if(e(s))return!0;s=s.parent}return!1}function fn(n){return new R(n.parent===null?n.name:fn(n.parent)+"/"+n.name)}function er(n){n.parent!==null&&nf(n.parent,n.name,n)}function nf(n,e,t){let s=ef(t),i=ue(n.node.children,e);s&&i?(delete n.node.children[e],n.node.childCount--,er(n)):!s&&!i&&(n.node.children[e]=t.node,n.node.childCount++,er(n))}var sf=/[\[\].#$\/\u0000-\u001F\u007F]/,rf=/[\[\].#$\u0000-\u001F\u007F]/,hi=10*1024*1024,ms=function(n){return typeof n=="string"&&n.length!==0&&!sf.test(n)},Ic=function(n){return typeof n=="string"&&n.length!==0&&!rf.test(n)},of=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Ic(n)},on=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!os(n)||n&&typeof n=="object"&&ue(n,".sv")},Ie=function(n,e,t,s){s&&e===void 0||pn(ee(n,"value"),e,t)},pn=function(n,e,t){let s=t instanceof R?new Ci(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+Xe(s));if(typeof e=="function")throw new Error(n+"contains a function "+Xe(s)+" with contents = "+e.toString());if(os(e))throw new Error(n+"contains "+e.toString()+" "+Xe(s));if(typeof e=="string"&&e.length>hi/3&&Wt(e)>hi)throw new Error(n+"contains a string greater than "+hi+" utf8 bytes "+Xe(s)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,r=!1;if(z(e,(o,a)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!ms(o)))throw new Error(n+" contains an invalid key ("+o+") "+Xe(s)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);xh(s,o),pn(n,a,s),Lh(s)}),i&&r)throw new Error(n+' contains ".value" child '+Xe(s)+" in addition to actual children.")}},af=function(n,e){let t,s;for(t=0;t<e.length;t++){s=e[t];let r=Ht(s);for(let o=0;o<r.length;o++)if(!(r[o]===".priority"&&o===r.length-1)){if(!ms(r[o]))throw new Error(n+"contains an invalid key ("+r[o]+") in path "+s.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(Oh);let i=null;for(t=0;t<e.length;t++){if(s=e[t],i!==null&&he(i,s))throw new Error(n+"contains a path "+i.toString()+" that is ancestor of another path "+s.toString());i=s}},Nc=function(n,e,t,s){if(s&&e===void 0)return;let i=ee(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");let r=[];z(e,(o,a)=>{let l=new R(o);if(pn(i,a,x(t,l)),wr(l)===".priority"&&!on(a))throw new Error(i+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(l)}),af(i,r)},Br=function(n,e,t){if(!(t&&e===void 0)){if(os(e))throw new Error(ee(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!on(e))throw new Error(ee(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},mn=function(n,e,t,s){if(!(s&&t===void 0)&&!ms(t))throw new Error(ee(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},Mt=function(n,e,t,s){if(!(s&&t===void 0)&&!Ic(t))throw new Error(ee(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},lf=function(n,e,t,s){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Mt(n,e,t,s)},se=function(n,e){if(T(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},Ac=function(n,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!ms(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!of(t))throw new Error(ee(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var tr=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function _s(n,e){let t=null;for(let s=0;s<e.length;s++){let i=e[s],r=i.getPath();t!==null&&!Sr(r,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:r}),t.events.push(i)}t&&n.eventLists_.push(t)}function Pc(n,e,t){_s(n,t),Rc(n,s=>Sr(s,e))}function ie(n,e,t){_s(n,t),Rc(n,s=>he(s,e)||he(e,s))}function Rc(n,e){n.recursionDepth_++;let t=!0;for(let s=0;s<n.eventLists_.length;s++){let i=n.eventLists_[s];if(i){let r=i.path;e(r)?(cf(n.eventLists_[s]),n.eventLists_[s]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function cf(n){for(let e=0;e<n.events.length;e++){let t=n.events[e];if(t!==null){n.events[e]=null;let s=t.getEventRunner();Ze&&Q("event: "+t.toString()),Rt(s)}}}var kc="repo_interrupt",uf=25,nr=class{constructor(e,t,s,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=s,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new tr,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=qn(),this.transactionQueueTree_=new rn,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function hf(n,e,t){if(n.stats_=Er(n.repoInfo_),n.forceRestClient_||uh())n.server_=new xi(n.repoInfo_,(s,i,r,o)=>{Nl(n,s,i,r,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Al(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{U(t)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}n.persistentConnection_=new Tr(n.repoInfo_,e,(s,i,r,o)=>{Nl(n,s,i,r,o)},s=>{Al(n,s)},s=>{df(n,s)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(s=>{n.server_.refreshAuthToken(s)}),n.appCheckProvider_.addTokenChangeListener(s=>{n.server_.refreshAppCheckToken(s.token)}),n.statsReporter_=dh(n.repoInfo_,()=>new Ui(n.stats_,n.server_)),n.infoData_=new Li,n.infoSyncTree_=new Jn({startListening:(s,i,r,o)=>{let a=[],l=n.infoData_.getNode(s._path);return l.isEmpty()||(a=dn(n.infoSyncTree_,s._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Ur(n,"connected",!1),n.serverSyncTree_=new Jn({startListening:(s,i,r,o)=>(n.server_.listen(s,r,i,(a,l)=>{let c=o(a,l);ie(n.eventQueue_,s._path,c)}),[]),stopListening:(s,i)=>{n.server_.unlisten(s,i)}})}function Dc(n){let t=n.infoData_.getNode(new R(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function _n(n){return Xd({timestamp:Dc(n)})}function Nl(n,e,t,s,i){n.dataUpdateCount++;let r=new R(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(i)if(s){let l=Ft(t,c=>F(c));o=zd(n.serverSyncTree_,r,l,i)}else{let l=F(t);o=vc(n.serverSyncTree_,r,l,i)}else if(s){let l=Ft(t,c=>F(c));o=Kd(n.serverSyncTree_,r,l)}else{let l=F(t);o=dn(n.serverSyncTree_,r,l)}let a=r;o.length>0&&(a=At(n,r)),ie(n.eventQueue_,a,o)}function Al(n,e){Ur(n,"connected",e),e===!1&&mf(n)}function df(n,e){z(e,(t,s)=>{Ur(n,t,s)})}function Ur(n,e,t){let s=new R("/.info/"+e),i=F(t);n.infoData_.updateSnapshot(s,i);let r=dn(n.infoSyncTree_,s,i);ie(n.eventQueue_,s,r)}function gs(n){return n.nextWriteId_++}function ff(n,e,t){let s=jd(n.serverSyncTree_,e);return s!=null?Promise.resolve(s):n.server_.get(e).then(i=>{let r=F(i).withIndex(e._queryParams.getIndex());Xi(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=dn(n.serverSyncTree_,e._path,r);else{let a=sn(n.serverSyncTree_,e);o=vc(n.serverSyncTree_,e._path,r,a)}return ie(n.eventQueue_,e._path,o),Zn(n.serverSyncTree_,e,t,null,!0),r},i=>(Ot(n,"get for query "+U(e)+" failed: "+i),Promise.reject(new Error(i))))}function Vr(n,e,t,s,i){Ot(n,"set",{path:e.toString(),value:t,priority:s});let r=_n(n),o=F(t,s),a=hs(n.serverSyncTree_,e),l=Lr(o,a,r),c=gs(n),u=Dr(n.serverSyncTree_,e,l,c,!0);_s(n.eventQueue_,u),n.server_.put(e.toString(),o.val(!0),(d,f)=>{let p=d==="ok";p||G("set at "+e+" failed: "+d);let _=xe(n.serverSyncTree_,c,!p);ie(n.eventQueue_,e,_),Ve(n,i,d,f)});let h=qr(n,e);At(n,h),ie(n.eventQueue_,h,[])}function pf(n,e,t,s){Ot(n,"update",{path:e.toString(),value:t});let i=!0,r=_n(n),o={};if(z(t,(a,l)=>{i=!1,o[a]=Tc(x(e,a),F(l),n.serverSyncTree_,r)}),i)Q("update() called with empty data.  Don't do anything."),Ve(n,s,"ok",void 0);else{let a=gs(n),l=Vd(n.serverSyncTree_,e,o,a);_s(n.eventQueue_,l),n.server_.merge(e.toString(),t,(c,u)=>{let h=c==="ok";h||G("update at "+e+" failed: "+c);let d=xe(n.serverSyncTree_,a,!h),f=d.length>0?At(n,e):e;ie(n.eventQueue_,f,d),Ve(n,s,c,u)}),z(t,c=>{let u=qr(n,x(e,c));At(n,u)}),ie(n.eventQueue_,e,[])}}function mf(n){Ot(n,"onDisconnectEvents");let e=_n(n),t=qn();Wi(n.onDisconnect_,P(),(i,r)=>{let o=Tc(i,r,n.serverSyncTree_,e);kt(t,i,o)});let s=[];Wi(t,P(),(i,r)=>{s=s.concat(dn(n.serverSyncTree_,i,r));let o=qr(n,i);At(n,o)}),n.onDisconnect_=qn(),ie(n.eventQueue_,P(),s)}function _f(n,e,t){n.server_.onDisconnectCancel(e.toString(),(s,i)=>{s==="ok"&&Fi(n.onDisconnect_,e),Ve(n,t,s,i)})}function Pl(n,e,t,s){let i=F(t);n.server_.onDisconnectPut(e.toString(),i.val(!0),(r,o)=>{r==="ok"&&kt(n.onDisconnect_,e,i),Ve(n,s,r,o)})}function gf(n,e,t,s,i){let r=F(t,s);n.server_.onDisconnectPut(e.toString(),r.val(!0),(o,a)=>{o==="ok"&&kt(n.onDisconnect_,e,r),Ve(n,i,o,a)})}function yf(n,e,t,s){if(An(t)){Q("onDisconnect().update() called with empty data.  Don't do anything."),Ve(n,s,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(i,r)=>{i==="ok"&&z(t,(o,a)=>{let l=F(a);kt(n.onDisconnect_,x(e,o),l)}),Ve(n,s,i,r)})}function vf(n,e,t){let s;T(e._path)===".info"?s=Xi(n.infoSyncTree_,e,t):s=Xi(n.serverSyncTree_,e,t),Pc(n.eventQueue_,e._path,s)}function sr(n,e,t){let s;T(e._path)===".info"?s=Zn(n.infoSyncTree_,e,t):s=Zn(n.serverSyncTree_,e,t),Pc(n.eventQueue_,e._path,s)}function Mc(n){n.persistentConnection_&&n.persistentConnection_.interrupt(kc)}function Ef(n){n.persistentConnection_&&n.persistentConnection_.resume(kc)}function Ot(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Q(t,...e)}function Ve(n,e,t,s){e&&Rt(()=>{if(t==="ok")e(null);else{let i=(t||"error").toUpperCase(),r=i;s&&(r+=": "+s);let o=new Error(r);o.code=i,e(o)}})}function wf(n,e,t,s,i,r){Ot(n,"transaction on "+e);let o={path:e,update:t,onComplete:s,status:null,order:Dl(),applyLocally:r,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=Kr(n,e,void 0);o.currentInputSnapshot=a;let l=o.update(a.val());if(l===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{pn("transaction failed: Data returned ",l,o.path),o.status=0;let c=fs(n.transactionQueueTree_,e),u=st(c)||[];u.push(o),Wr(c,u);let h;typeof l=="object"&&l!==null&&ue(l,".priority")?(h=Oe(l,".priority"),m(on(h),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):h=(hs(n.serverSyncTree_,e)||S.EMPTY_NODE).getPriority().val();let d=_n(n),f=F(l,h),p=Lr(f,a,d);o.currentOutputSnapshotRaw=f,o.currentOutputSnapshotResolved=p,o.currentWriteId=gs(n);let _=Dr(n.serverSyncTree_,e,p,o.currentWriteId,o.applyLocally);ie(n.eventQueue_,e,_),ys(n,n.transactionQueueTree_)}}function Kr(n,e,t){return hs(n.serverSyncTree_,e,t)||S.EMPTY_NODE}function ys(n,e=n.transactionQueueTree_){if(e||vs(n,e),st(e)){let t=xc(n,e);m(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&Sf(n,fn(e),t)}else Cc(e)&&ps(e,t=>{ys(n,t)})}function Sf(n,e,t){let s=t.map(c=>c.currentWriteId),i=Kr(n,e,s),r=i,o=i.hash();for(let c=0;c<t.length;c++){let u=t[c];m(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;let h=Y(e,u.path);r=r.updateChild(h,u.currentOutputSnapshotRaw)}let a=r.val(!0),l=e;n.server_.put(l.toString(),a,c=>{Ot(n,"transaction put response",{path:l.toString(),status:c});let u=[];if(c==="ok"){let h=[];for(let d=0;d<t.length;d++)t[d].status=2,u=u.concat(xe(n.serverSyncTree_,t[d].currentWriteId)),t[d].onComplete&&h.push(()=>t[d].onComplete(null,!0,t[d].currentOutputSnapshotResolved)),t[d].unwatcher();vs(n,fs(n.transactionQueueTree_,e)),ys(n,n.transactionQueueTree_),ie(n.eventQueue_,e,u);for(let d=0;d<h.length;d++)Rt(h[d])}else{if(c==="datastale")for(let h=0;h<t.length;h++)t[h].status===3?t[h].status=4:t[h].status=0;else{G("transaction at "+l.toString()+" failed: "+c);for(let h=0;h<t.length;h++)t[h].status=4,t[h].abortReason=c}At(n,e)}},o)}function At(n,e){let t=Oc(n,e),s=fn(t),i=xc(n,t);return Tf(n,i,s),s}function Tf(n,e,t){if(e.length===0)return;let s=[],i=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let l=e[a],c=Y(t,l.path),u=!1,h;if(m(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)u=!0,h=l.abortReason,i=i.concat(xe(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=uf)u=!0,h="maxretry",i=i.concat(xe(n.serverSyncTree_,l.currentWriteId,!0));else{let d=Kr(n,l.path,o);l.currentInputSnapshot=d;let f=e[a].update(d.val());if(f!==void 0){pn("transaction failed: Data returned ",f,l.path);let p=F(f);typeof f=="object"&&f!=null&&ue(f,".priority")||(p=p.updatePriority(d.getPriority()));let w=l.currentWriteId,k=_n(n),D=Lr(p,d,k);l.currentOutputSnapshotRaw=p,l.currentOutputSnapshotResolved=D,l.currentWriteId=gs(n),o.splice(o.indexOf(w),1),i=i.concat(Dr(n.serverSyncTree_,l.path,D,l.currentWriteId,l.applyLocally)),i=i.concat(xe(n.serverSyncTree_,w,!0))}else u=!0,h="nodata",i=i.concat(xe(n.serverSyncTree_,l.currentWriteId,!0))}ie(n.eventQueue_,t,i),i=[],u&&(e[a].status=2,function(d){setTimeout(d,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(h==="nodata"?s.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):s.push(()=>e[a].onComplete(new Error(h),!1,null))))}vs(n,n.transactionQueueTree_);for(let a=0;a<s.length;a++)Rt(s[a]);ys(n,n.transactionQueueTree_)}function Oc(n,e){let t,s=n.transactionQueueTree_;for(t=T(e);t!==null&&st(s)===void 0;)s=fs(s,t),e=M(e),t=T(e);return s}function xc(n,e){let t=[];return Lc(n,e,t),t.sort((s,i)=>s.order-i.order),t}function Lc(n,e,t){let s=st(e);if(s)for(let i=0;i<s.length;i++)t.push(s[i]);ps(e,i=>{Lc(n,i,t)})}function vs(n,e){let t=st(e);if(t){let s=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[s]=t[i],s++);t.length=s,Wr(e,t.length>0?t:void 0)}ps(e,s=>{vs(n,s)})}function qr(n,e){let t=fn(Oc(n,e)),s=fs(n.transactionQueueTree_,e);return tf(s,i=>{di(n,i)}),di(n,s),bc(s,i=>{di(n,i)}),t}function di(n,e){let t=st(e);if(t){let s=[],i=[],r=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(m(r===o-1,"All SENT items should be at beginning of queue."),r=o,t[o].status=3,t[o].abortReason="set"):(m(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),i=i.concat(xe(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&s.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?Wr(e,void 0):t.length=r+1,ie(n.eventQueue_,fn(e),i);for(let o=0;o<s.length;o++)Rt(s[o])}}function Cf(n){let e="",t=n.split("/");for(let s=0;s<t.length;s++)if(t[s].length>0){let i=t[s];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function bf(n){let e={};n.charAt(0)==="?"&&(n=n.substring(1));for(let t of n.split("&")){if(t.length===0)continue;let s=t.split("=");s.length===2?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):G(`Invalid query segment '${t}' in query '${n}'`)}return e}var ir=function(n,e){let t=If(n),s=t.namespace;t.domain==="firebase.com"&&Ce(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!s||s==="undefined")&&t.domain!=="localhost"&&Ce("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||th();let i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new xn(t.host,t.secure,s,i,e,"",s!==t.subdomain),path:new R(t.pathString)}},If=function(n){let e="",t="",s="",i="",r="",o=!0,a="https",l=443;if(typeof n=="string"){let c=n.indexOf("//");c>=0&&(a=n.substring(0,c-1),n=n.substring(c+2));let u=n.indexOf("/");u===-1&&(u=n.length);let h=n.indexOf("?");h===-1&&(h=n.length),e=n.substring(0,Math.min(u,h)),u<h&&(i=Cf(n.substring(u,h)));let d=bf(n.substring(Math.min(n.length,h)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(c+1),10)):c=e.length;let f=e.slice(0,c);if(f.toLowerCase()==="localhost")t="localhost";else if(f.split(".").length<=2)t=f;else{let p=e.indexOf(".");s=e.substring(0,p).toLowerCase(),t=e.substring(p+1),r=s}"ns"in d&&(r=d.ns)}return{host:e,port:l,domain:t,subdomain:s,secure:o,scheme:a,pathString:i,namespace:r}};var Rl="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Nf=function(){let n=0,e=[];return function(t){let s=t===n;n=t;let i,r=new Array(8);for(i=7;i>=0;i--)r[i]=Rl.charAt(t%64),t=Math.floor(t/64);m(t===0,"Cannot push at time == 0");let o=r.join("");if(s){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)o+=Rl.charAt(e[i]);return m(o.length===20,"nextPushId: Length should be 20."),o}}();var es=class{constructor(e,t,s,i){this.eventType=e,this.eventRegistration=t,this.snapshot=s,this.prevName=i}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+U(this.snapshot.exportVal())}},ts=class{constructor(e,t,s){this.eventRegistration=e,this.error=t,this.path=s}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var an=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return m(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var ns=class{constructor(e,t){this._repo=e,this._path=t}cancel(){let e=new H;return _f(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){se("OnDisconnect.remove",this._path);let e=new H;return Pl(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){se("OnDisconnect.set",this._path),Ie("OnDisconnect.set",e,this._path,!1);let t=new H;return Pl(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){se("OnDisconnect.setWithPriority",this._path),Ie("OnDisconnect.setWithPriority",e,this._path,!1),Br("OnDisconnect.setWithPriority",t,!1);let s=new H;return gf(this._repo,this._path,e,t,s.wrapCallback(()=>{})),s.promise}update(e){se("OnDisconnect.update",this._path),Nc("OnDisconnect.update",e,this._path,!1);let t=new H;return yf(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};var J=class n{constructor(e,t,s,i){this._repo=e,this._path=t,this._queryParams=s,this._orderByCalled=i}get key(){return C(this._path)?null:wr(this._path)}get ref(){return new re(this._repo,this._path)}get _queryIdentifier(){let e=_l(this._queryParams),t=vr(e);return t==="{}"?"default":t}get _queryObject(){return _l(this._queryParams)}isEqual(e){if(e=te(e),!(e instanceof n))return!1;let t=this._repo===e._repo,s=Sr(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&s&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+Mh(this._path)}};function Es(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function qe(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===Te){let s="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==We)throw new Error(s);if(typeof e!="string")throw new Error(i)}if(n.hasEnd()){if(n.getIndexEndName()!==Re)throw new Error(s);if(typeof t!="string")throw new Error(i)}}else if(n.getIndex()===O){if(e!=null&&!on(e)||t!=null&&!on(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(m(n.getIndex()instanceof Yt||n.getIndex()===br,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function ws(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var re=class n extends J{constructor(e,t){super(e,t,new en,!1)}get parent(){let e=Zl(this._path);return e===null?null:new n(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},Pt=class n{constructor(e,t,s){this._node=e,this.ref=t,this._index=s}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new R(e),s=Ke(this.ref,e);return new n(this._node.getChild(t),s,O)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(s,i)=>e(new n(i,Ke(this.ref,s),O)))}hasChild(e){let t=new R(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function Qr(n,e){return n=te(n),n._checkNotDeleted("ref"),e!==void 0?Ke(n._root,e):n._root}function zr(n,e){n=te(n),n._checkNotDeleted("refFromURL");let t=ir(e,n._repo.repoInfo_.nodeAdmin);Ac("refFromURL",t);let s=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&s.host!==n._repo.repoInfo_.host&&Ce("refFromURL: Host name does not match the current database: (found "+s.host+" but expected "+n._repo.repoInfo_.host+")"),Qr(n,t.path.toString())}function Ke(n,e){return n=te(n),T(n._path)===null?lf("child","path",e,!1):Mt("child","path",e,!1),new re(n._repo,x(n._path,e))}function Fc(n,e){n=te(n),se("push",n._path),Ie("push",e,n._path,!0);let t=Dc(n._repo),s=Nf(t),i=Ke(n,s),r=Ke(n,s),o;return e!=null?o=Ss(r,e).then(()=>r):o=Promise.resolve(r),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}function Wc(n){return se("remove",n._path),Ss(n,null)}function Ss(n,e){n=te(n),se("set",n._path),Ie("set",e,n._path,!1);let t=new H;return Vr(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function Bc(n,e){n=te(n),se("setPriority",n._path),Br("setPriority",e,!1);let t=new H;return Vr(n._repo,x(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function Uc(n,e,t){if(se("setWithPriority",n._path),Ie("setWithPriority",e,n._path,!1),Br("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";let s=new H;return Vr(n._repo,n._path,e,t,s.wrapCallback(()=>{})),s.promise}function Vc(n,e){Nc("update",e,n._path,!1);let t=new H;return pf(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function Kc(n){n=te(n);let e=new an(()=>{}),t=new ln(e);return ff(n._repo,n,t).then(s=>new Pt(s,new re(n._repo,n._path),n._queryParams.getIndex()))}var ln=class n{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let s=t._queryParams.getIndex();return new es("value",this,new Pt(e.snapshotNode,new re(t._repo,t._path),s))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new ts(this,e,t):null}matches(e){return e instanceof n?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},ss=class n{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new ts(this,e,t):null}createEvent(e,t){m(e.childName!=null,"Child events should have a childName.");let s=Ke(new re(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new es(e.type,this,new Pt(e.snapshotNode,s,i),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof n?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function gn(n,e,t,s,i){let r;if(typeof s=="object"&&(r=void 0,i=s),typeof s=="function"&&(r=s),i&&i.onlyOnce){let l=t,c=(u,h)=>{sr(n._repo,n,a),l(u,h)};c.userCallback=t.userCallback,c.context=t.context,t=c}let o=new an(t,r||void 0),a=e==="value"?new ln(o):new ss(e,o);return vf(n._repo,n,a),()=>sr(n._repo,n,a)}function Ts(n,e,t,s){return gn(n,"value",e,t,s)}function jr(n,e,t,s){return gn(n,"child_added",e,t,s)}function Gr(n,e,t,s){return gn(n,"child_changed",e,t,s)}function $r(n,e,t,s){return gn(n,"child_moved",e,t,s)}function Hr(n,e,t,s){return gn(n,"child_removed",e,t,s)}function Yr(n,e,t){let s=null,i=t?new an(t):null;e==="value"?s=new ln(i):e&&(s=new ss(e,i)),sr(n._repo,n,s)}var oe=class{},is=class extends oe{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){Ie("endAt",this._value,e._path,!0);let t=Oi(e._queryParams,this._value,this._key);if(ws(t),qe(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new J(e._repo,e._path,t,e._orderByCalled)}};function qc(n,e){return mn("endAt","key",e,!0),new is(n,e)}var rr=class extends oe{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){Ie("endBefore",this._value,e._path,!1);let t=Jh(e._queryParams,this._value,this._key);if(ws(t),qe(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new J(e._repo,e._path,t,e._orderByCalled)}};function Qc(n,e){return mn("endBefore","key",e,!0),new rr(n,e)}var rs=class extends oe{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){Ie("startAt",this._value,e._path,!0);let t=Mi(e._queryParams,this._value,this._key);if(ws(t),qe(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new J(e._repo,e._path,t,e._orderByCalled)}};function zc(n=null,e){return mn("startAt","key",e,!0),new rs(n,e)}var or=class extends oe{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){Ie("startAfter",this._value,e._path,!1);let t=Xh(e._queryParams,this._value,this._key);if(ws(t),qe(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new J(e._repo,e._path,t,e._orderByCalled)}};function jc(n,e){return mn("startAfter","key",e,!0),new or(n,e)}var ar=class extends oe{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new J(e._repo,e._path,Hh(e._queryParams,this._limit),e._orderByCalled)}};function Gc(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new ar(n)}var lr=class extends oe{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new J(e._repo,e._path,Yh(e._queryParams,this._limit),e._orderByCalled)}};function $c(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new lr(n)}var cr=class extends oe{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){Es(e,"orderByChild");let t=new R(this._path);if(C(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let s=new Yt(t),i=as(e._queryParams,s);return qe(i),new J(e._repo,e._path,i,!0)}};function Hc(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Mt("orderByChild","path",n,!1),new cr(n)}var ur=class extends oe{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){Es(e,"orderByKey");let t=as(e._queryParams,Te);return qe(t),new J(e._repo,e._path,t,!0)}};function Yc(){return new ur}var hr=class extends oe{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){Es(e,"orderByPriority");let t=as(e._queryParams,O);return qe(t),new J(e._repo,e._path,t,!0)}};function Xc(){return new hr}var dr=class extends oe{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){Es(e,"orderByValue");let t=as(e._queryParams,br);return qe(t),new J(e._repo,e._path,t,!0)}};function Jc(){return new dr}var fr=class extends oe{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(Ie("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new is(this._value,this._key)._apply(new rs(this._value,this._key)._apply(e))}};function Zc(n,e){return mn("equalTo","key",e,!0),new fr(n,e)}function fe(n,...e){let t=te(n);for(let s of e)t=s._apply(t);return t}Md(re);Wd(re);var Af="FIREBASE_DATABASE_EMULATOR_HOST",pr={},Pf=!1;function Rf(n,e,t,s){n.repoInfo_=new xn(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),s&&(n.authTokenProvider_=s)}function Xr(n,e,t,s,i){let r=s||n.options.databaseURL;r===void 0&&(n.options.projectId||Ce("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Q("Using default host for project ",n.options.projectId),r=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=ir(r,i),a=o.repoInfo,l,c;typeof process<"u"&&process.env&&(c=process.env[Af]),c?(l=!0,r=`http://${c}?ns=${a.namespace}`,o=ir(r,i),a=o.repoInfo):l=!o.repoInfo.secure;let u=i&&l?new Qt(Qt.OWNER):new yi(n.name,n.options,e);Ac("Invalid Firebase Database URL",o),C(o.path)||Ce("Database URL must point to the root of a Firebase Database (not including a child path).");let h=Df(a,n,u,new gi(n.name,t));return new mr(h,n)}function kf(n,e){let t=pr[e];(!t||t[n.key]!==n)&&Ce(`Database ${e}(${n.repoInfo_}) has already been deleted.`),Mc(n),delete t[n.key]}function Df(n,e,t,s){let i=pr[e.name];i||(i={},pr[e.name]=i);let r=i[n.toURLString()];return r&&Ce("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new nr(n,Pf,t,s),i[n.toURLString()]=r,r}var mr=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(hf(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new re(this._repo,P())),this._rootInternal}_delete(){return this._rootInternal!==null&&(kf(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Ce("Cannot call "+e+" on a deleted database.")}};function eu(){Jl.IS_TRANSPORT_INITIALIZED&&G("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function tu(){eu(),$t.forceDisallow()}function nu(){eu(),vt.forceDisallow(),$t.forceAllow()}function su(n,e,t,s={}){n=te(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&Ce("Cannot call useEmulator() after instance has already been initialized.");let i=n._repoInternal,r;if(i.repoInfo_.nodeAdmin)s.mockUserToken&&Ce('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new Qt(Qt.OWNER);else if(s.mockUserToken){let o=typeof s.mockUserToken=="string"?s.mockUserToken:va(s.mockUserToken,n.app.options.projectId);r=new Qt(o)}Rf(i,e,t,r)}function iu(n){n=te(n),n._checkNotDeleted("goOffline"),Mc(n._repo)}function ru(n){n=te(n),n._checkNotDeleted("goOnline"),Ef(n._repo)}function ou(n,e){Ol(n,e)}function Mf(n){yr(Aa),Na(new _t("database",(e,{instanceIdentifier:t})=>{let s=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return Xr(s,i,r,t)},"PUBLIC").setMultipleInstances(!0)),ni(Za,el,n),ni(Za,el,"esm2017")}var Of={".sv":"timestamp"};function au(){return Of}function lu(n){return{".sv":{increment:n}}}var _r=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function cu(n,e,t){var s;if(n=te(n),se("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";let i=(s=t?.applyLocally)!==null&&s!==void 0?s:!0,r=new H,o=(l,c,u)=>{let h=null;l?r.reject(l):(h=new Pt(u,new re(n._repo,n._path),O),r.resolve(new _r(c,h)))},a=Ts(n,()=>{});return wf(n._repo,n._path,e,o,a,i),r.promise}Tr.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Tr.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};Mf();var xf="@firebase/database-compat",Lf="1.0.8";var Ff=new Rn("@firebase/database-compat"),uu=function(n){let e="FIREBASE WARNING: "+n;Ff.warn(e)};var Wf=function(n,e,t,s){if(!(s&&t===void 0)&&typeof t!="boolean")throw new Error(ee(n,e)+"must be a boolean.")},Bf=function(n,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(ee(n,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var Jr=class{constructor(e){this._delegate=e}cancel(e){v("OnDisconnect.cancel",0,1,arguments.length),K("OnDisconnect.cancel","onComplete",e,!0);let t=this._delegate.cancel();return e&&t.then(()=>e(null),s=>e(s)),t}remove(e){v("OnDisconnect.remove",0,1,arguments.length),K("OnDisconnect.remove","onComplete",e,!0);let t=this._delegate.remove();return e&&t.then(()=>e(null),s=>e(s)),t}set(e,t){v("OnDisconnect.set",1,2,arguments.length),K("OnDisconnect.set","onComplete",t,!0);let s=this._delegate.set(e);return t&&s.then(()=>t(null),i=>t(i)),s}setWithPriority(e,t,s){v("OnDisconnect.setWithPriority",2,3,arguments.length),K("OnDisconnect.setWithPriority","onComplete",s,!0);let i=this._delegate.setWithPriority(e,t);return s&&i.then(()=>s(null),r=>s(r)),i}update(e,t){if(v("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let r=0;r<e.length;++r)i[""+r]=e[r];e=i,uu("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}K("OnDisconnect.update","onComplete",t,!0);let s=this._delegate.update(e);return t&&s.then(()=>t(null),i=>t(i)),s}};var Zr=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return v("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}};var it=class n{constructor(e,t){this._database=e,this._delegate=t}val(){return v("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return v("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return v("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return v("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return v("DataSnapshot.child",0,1,arguments.length),e=String(e),Mt("DataSnapshot.child","path",e,!1),new n(this._database,this._delegate.child(e))}hasChild(e){return v("DataSnapshot.hasChild",1,1,arguments.length),Mt("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return v("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return v("DataSnapshot.forEach",1,1,arguments.length),K("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new n(this._database,t)))}hasChildren(){return v("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return v("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return v("DataSnapshot.ref",0,0,arguments.length),new ke(this._database,this._delegate.ref)}get ref(){return this.getRef()}},Cs=class n{constructor(e,t){this.database=e,this._delegate=t}on(e,t,s,i){var r;v("Query.on",2,4,arguments.length),K("Query.on","callback",t,!1);let o=n.getCancelAndContextArgs_("Query.on",s,i),a=(c,u)=>{t.call(o.context,new it(this.database,c),u)};a.userCallback=t,a.context=o.context;let l=(r=o.cancel)===null||r===void 0?void 0:r.bind(o.context);switch(e){case"value":return Ts(this._delegate,a,l),t;case"child_added":return jr(this._delegate,a,l),t;case"child_removed":return Hr(this._delegate,a,l),t;case"child_changed":return Gr(this._delegate,a,l),t;case"child_moved":return $r(this._delegate,a,l),t;default:throw new Error(ee("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,s){if(v("Query.off",0,3,arguments.length),Bf("Query.off",e,!0),K("Query.off","callback",t,!0),ei("Query.off","context",s,!0),t){let i=()=>{};i.userCallback=t,i.context=s,Yr(this._delegate,e,i)}else Yr(this._delegate,e)}get(){return Kc(this._delegate).then(e=>new it(this.database,e))}once(e,t,s,i){v("Query.once",1,4,arguments.length),K("Query.once","callback",t,!0);let r=n.getCancelAndContextArgs_("Query.once",s,i),o=new H,a=(c,u)=>{let h=new it(this.database,c);t&&t.call(r.context,h,u),o.resolve(h)};a.userCallback=t,a.context=r.context;let l=c=>{r.cancel&&r.cancel.call(r.context,c),o.reject(c)};switch(e){case"value":Ts(this._delegate,a,l,{onlyOnce:!0});break;case"child_added":jr(this._delegate,a,l,{onlyOnce:!0});break;case"child_removed":Hr(this._delegate,a,l,{onlyOnce:!0});break;case"child_changed":Gr(this._delegate,a,l,{onlyOnce:!0});break;case"child_moved":$r(this._delegate,a,l,{onlyOnce:!0});break;default:throw new Error(ee("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return v("Query.limitToFirst",1,1,arguments.length),new n(this.database,fe(this._delegate,Gc(e)))}limitToLast(e){return v("Query.limitToLast",1,1,arguments.length),new n(this.database,fe(this._delegate,$c(e)))}orderByChild(e){return v("Query.orderByChild",1,1,arguments.length),new n(this.database,fe(this._delegate,Hc(e)))}orderByKey(){return v("Query.orderByKey",0,0,arguments.length),new n(this.database,fe(this._delegate,Yc()))}orderByPriority(){return v("Query.orderByPriority",0,0,arguments.length),new n(this.database,fe(this._delegate,Xc()))}orderByValue(){return v("Query.orderByValue",0,0,arguments.length),new n(this.database,fe(this._delegate,Jc()))}startAt(e=null,t){return v("Query.startAt",0,2,arguments.length),new n(this.database,fe(this._delegate,zc(e,t)))}startAfter(e=null,t){return v("Query.startAfter",0,2,arguments.length),new n(this.database,fe(this._delegate,jc(e,t)))}endAt(e=null,t){return v("Query.endAt",0,2,arguments.length),new n(this.database,fe(this._delegate,qc(e,t)))}endBefore(e=null,t){return v("Query.endBefore",0,2,arguments.length),new n(this.database,fe(this._delegate,Qc(e,t)))}equalTo(e,t){return v("Query.equalTo",1,2,arguments.length),new n(this.database,fe(this._delegate,Zc(e,t)))}toString(){return v("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return v("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(v("Query.isEqual",1,1,arguments.length),!(e instanceof n)){let t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,s){let i={cancel:void 0,context:void 0};if(t&&s)i.cancel=t,K(e,"cancel",i.cancel,!0),i.context=s,ei(e,"context",i.context,!0);else if(t)if(typeof t=="object"&&t!==null)i.context=t;else if(typeof t=="function")i.cancel=t;else throw new Error(ee(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return i}get ref(){return new ke(this.database,new re(this._delegate._repo,this._delegate._path))}},ke=class n extends Cs{constructor(e,t){super(e,new J(t._repo,t._path,new en,!1)),this.database=e,this._delegate=t}getKey(){return v("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return v("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new n(this.database,Ke(this._delegate,e))}getParent(){v("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new n(this.database,e):null}getRoot(){return v("Reference.root",0,0,arguments.length),new n(this.database,this._delegate.root)}set(e,t){v("Reference.set",1,2,arguments.length),K("Reference.set","onComplete",t,!0);let s=Ss(this._delegate,e);return t&&s.then(()=>t(null),i=>t(i)),s}update(e,t){if(v("Reference.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let r=0;r<e.length;++r)i[""+r]=e[r];e=i,uu("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}se("Reference.update",this._delegate._path),K("Reference.update","onComplete",t,!0);let s=Vc(this._delegate,e);return t&&s.then(()=>t(null),i=>t(i)),s}setWithPriority(e,t,s){v("Reference.setWithPriority",2,3,arguments.length),K("Reference.setWithPriority","onComplete",s,!0);let i=Uc(this._delegate,e,t);return s&&i.then(()=>s(null),r=>s(r)),i}remove(e){v("Reference.remove",0,1,arguments.length),K("Reference.remove","onComplete",e,!0);let t=Wc(this._delegate);return e&&t.then(()=>e(null),s=>e(s)),t}transaction(e,t,s){v("Reference.transaction",1,3,arguments.length),K("Reference.transaction","transactionUpdate",e,!1),K("Reference.transaction","onComplete",t,!0),Wf("Reference.transaction","applyLocally",s,!0);let i=cu(this._delegate,e,{applyLocally:s}).then(r=>new Zr(r.committed,new it(this.database,r.snapshot)));return t&&i.then(r=>t(null,r.committed,r.snapshot),r=>t(r,!1,null)),i}setPriority(e,t){v("Reference.setPriority",1,2,arguments.length),K("Reference.setPriority","onComplete",t,!0);let s=Bc(this._delegate,e);return t&&s.then(()=>t(null),i=>t(i)),s}push(e,t){v("Reference.push",0,2,arguments.length),K("Reference.push","onComplete",t,!0);let s=Fc(this._delegate,e),i=s.then(o=>new n(this.database,o));t&&i.then(()=>t(null),o=>t(o));let r=new n(this.database,s);return r.then=i.then.bind(i),r.catch=i.catch.bind(i,void 0),r}onDisconnect(){return se("Reference.onDisconnect",this._delegate._path),new Jr(new ns(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};var rt=class{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:tu,forceLongPolling:nu}}useEmulator(e,t,s={}){su(this._delegate,e,t,s)}ref(e){if(v("database.ref",0,1,arguments.length),e instanceof ke){let t=zr(this._delegate,e.toString());return new ke(this,t)}else{let t=Qr(this._delegate,e);return new ke(this,t)}}refFromURL(e){v("database.refFromURL",1,1,arguments.length);let s=zr(this._delegate,e);return new ke(this,s)}goOffline(){return v("database.goOffline",0,0,arguments.length),iu(this._delegate)}goOnline(){return v("database.goOnline",0,0,arguments.length),ru(this._delegate)}};rt.ServerValue={TIMESTAMP:au(),increment:n=>lu(n)};function Uf({app:n,url:e,version:t,customAuthImpl:s,customAppCheckImpl:i,namespace:r,nodeAdmin:o=!1}){yr(t);let a=new ti("database-standalone"),l=new Pn("auth-internal",a);l.setComponent(new _t("auth-internal",()=>s,"PRIVATE"));let c;return i&&(c=new Pn("app-check-internal",a),c.setComponent(new _t("app-check-internal",()=>i,"PRIVATE"))),{instance:new rt(Xr(n,l,c,e,o),n),namespace:r}}var Vf=Object.freeze({__proto__:null,initStandalone:Uf});var Kf=rt.ServerValue;function qf(n){n.INTERNAL.registerComponent(new _t("database-compat",(e,{instanceIdentifier:t})=>{let s=e.getProvider("app-compat").getImmediate(),i=e.getProvider("database").getImmediate({identifier:t});return new rt(i,s)},"PUBLIC").setServiceProps({Reference:ke,Query:Cs,Database:rt,DataSnapshot:it,enableLogging:ou,INTERNAL:Vf,ServerValue:Kf}).setMultipleInstances(!0)),n.registerVersion(xf,Lf)}qf(kn);function yn(n,e,t="on",s=Bo){return new Wo(i=>{let r=null;return r=n[t](e,(o,a)=>{s.schedule(()=>{i.next({snapshot:o,prevKey:a})}),t==="once"&&s.schedule(()=>i.complete())},o=>{s.schedule(()=>i.error(o))}),t==="on"?{unsubscribe(){r!=null&&n.off(e,r)}}:{unsubscribe(){}}}).pipe($e(i=>{let{snapshot:r,prevKey:o}=i,a=null;return r.exists()&&(a=r.key),{type:e,payload:r,prevKey:o,key:a}}),Ko())}function Qf(n){return typeof n=="string"}function zf(n){return typeof n.exportVal=="function"}function mu(n){return n==null}function _u(n){return typeof n.set=="function"}function hu(n,e){return _u(e)?e:n.ref(e)}function gu(n,e){if(Qf(n))return e.stringCase();if(_u(n))return e.firebaseCase();if(zf(n))return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof n}`)}function yu(n){return(mu(n)||n.length===0)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function vu(n,e,t){e=yu(e);let s=e.map(i=>yn(n,i,"on",t));return Qs(...s)}function jf(n,e,t){let s=vu(n,e).pipe(zs((i,r)=>[...i,r],[]));return $f(n,s,t)}function Gf(n,e){return yn(n,"value","on",e).pipe($e(t=>{let s;return t.payload.forEach(i=>(s=i.key,!1)),{data:t,lastKeyToLoad:s}}))}function $f(n,e,t){return Gf(n,t).pipe(zo(e),$e(([i,r])=>{let o=i.lastKeyToLoad,a=r.map(l=>l.key);return{actions:r,lastKeyToLoad:o,loadedKeys:a}}),qo(i=>i.loadedKeys.indexOf(i.lastKeyToLoad)===-1),$e(i=>i.actions))}function du(n,e){return function(s,i){return gu(s,{stringCase:()=>n.child(s)[e](i),firebaseCase:()=>s[e](i),snapshotCase:()=>s.ref[e](i)})}}function Hf(n){return function(t){return t?gu(t,{stringCase:()=>n.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):n.remove()}}function Yf(n,e,t){return yn(n,"value","once",t).pipe(Qo(s=>{let i=[Uo(s)];return e.forEach(r=>i.push(yn(n,r,"on",t))),Qs(...i).pipe(zs(Jf,[]))}),Vo())}function Eu(n,e){let t=n.length;for(let s=0;s<t;s++)if(n[s].payload.key===e)return s;return-1}function Xf(n,e){if(mu(e))return 0;{let t=Eu(n,e);return t===-1?n.length:t+1}}function Jf(n,e){let{payload:t,prevKey:s,key:i}=e,r=Eu(n,i),o=Xf(n,s);switch(e.type){case"value":if(e.payload?.exists()){let a=null;e.payload.forEach(l=>{let c={payload:l,type:"value",prevKey:a,key:l.key};return a=l.key,n=[...n,c],!1})}return n;case"child_added":if(r>-1)(n[r-1]?.key||null)!==s&&(n=n.filter(l=>l.payload.key!==t.key),n.splice(o,0,e));else{if(s==null)return[e,...n];n=n.slice(),n.splice(o,0,e)}return n;case"child_removed":return n.filter(a=>a.payload.key!==t.key);case"child_changed":return n.map(a=>a.payload.key===i?e:a);case"child_moved":if(r>-1){let a=n.splice(r,1)[0];return n=n.slice(),n.splice(o,0,a),n}return n;default:return n}}function fu(n,e,t){return e=yu(e),Yf(n,e,t)}function Zf(n,e){let t=e.schedulers.outsideAngular,s=e.schedulers.ngZone.run(()=>n.ref);return{query:n,update:du(s,"update"),set:du(s,"set"),push:i=>s.push(i),remove:Hf(s),snapshotChanges(i){return fu(n,i,t).pipe(Ye)},stateChanges(i){return vu(n,i,t).pipe(Ye)},auditTrail(i){return jf(n,i,t).pipe(Ye)},valueChanges(i,r){return fu(n,i,t).pipe($e(a=>a.map(l=>r&&r.idField?xo(ft({},l.payload.val()),{[r.idField]:l.key}):l.payload.val())),Ye)}}}function pu(n,e){return function(){return yn(n,"value","on",e)}}function ep(n,e){return{query:n,snapshotChanges(){return pu(n,e.schedulers.outsideAngular)().pipe(Ye)},update(t){return n.ref.update(t)},set(t){return n.ref.set(t)},remove(){return n.ref.remove()},valueChanges(){return pu(n,e.schedulers.outsideAngular)().pipe(Ye,$e(s=>s.payload.exists()?s.payload.val():null))}}}var tp=new Gs("angularfire2.realtimeDatabaseURL"),np=new Gs("angularfire2.database.use-emulator"),sp=(()=>{class n{schedulers;database;constructor(t,s,i,r,o,a,l,c,u,h,d,f,p,_,w){this.schedulers=a;let k=l,D=Oa(t,o,s);c&&qa(D,o,u,d,f,p,h,_),this.database=La(`${D.name}.database.${i}`,"AngularFireDatabase",D.name,()=>{let W=o.runOutsideAngular(()=>D.database(i||void 0));return k&&W.useEmulator(...k),W},[k])}list(t,s){let i=this.schedulers.ngZone.runOutsideAngular(()=>hu(this.database,t)),r=i;return s&&(r=s(i)),Zf(r,this)}object(t){let s=this.schedulers.ngZone.runOutsideAngular(()=>hu(this.database,t));return ep(s,this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}static \u0275fac=function(s){return new(s||n)(B(Da),B(Ma,8),B(tp,8),B($o),B(In),B(ka),B(np,8),B(Qa,8),B(Fa,8),B(Wa,8),B(Ba,8),B(Ua,8),B(Va,8),B(Ka,8),B(Ra,8))};static \u0275prov=pt({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),wu=(()=>{class n{constructor(){kn.registerVersion("angularfire",Pa.full,"rtdb-compat")}static \u0275fac=function(s){return new(s||n)};static \u0275mod=Hs({type:n});static \u0275inj=js({providers:[sp]})}return n})();var Su=[{path:"",loadComponent:()=>import("./chunk-AVDLWTMK.js").then(n=>n.ExpenseComponent)},{path:"expense-form",loadComponent:()=>import("./chunk-TOBNHMTX.js").then(n=>n.ExpenseFormComponent)},{path:"expense-form/:id",loadComponent:()=>import("./chunk-TOBNHMTX.js").then(n=>n.ExpenseFormComponent)},{path:"login",loadComponent:()=>import("./chunk-DYIMXQBJ.js").then(n=>n.LoginComponent)},{path:"signup",loadComponent:()=>import("./chunk-PFO4DPSH.js").then(n=>n.SignupComponent)},{path:"reset",loadComponent:()=>import("./chunk-SJC2Y3IA.js").then(n=>n.ResetComponent)}];function Tu(n){return new A(3e3,!1)}function ip(){return new A(3100,!1)}function rp(){return new A(3101,!1)}function op(n){return new A(3001,!1)}function ap(n){return new A(3003,!1)}function lp(n){return new A(3004,!1)}function cp(n,e){return new A(3005,!1)}function up(){return new A(3006,!1)}function hp(){return new A(3007,!1)}function dp(n,e){return new A(3008,!1)}function fp(n){return new A(3002,!1)}function pp(n,e,t,s,i){return new A(3010,!1)}function mp(){return new A(3011,!1)}function _p(){return new A(3012,!1)}function gp(){return new A(3200,!1)}function yp(){return new A(3202,!1)}function vp(){return new A(3013,!1)}function Ep(n){return new A(3014,!1)}function wp(n){return new A(3015,!1)}function Sp(n){return new A(3016,!1)}function Tp(n,e){return new A(3404,!1)}function Cp(n){return new A(3502,!1)}function bp(n){return new A(3503,!1)}function Ip(){return new A(3300,!1)}function Np(n){return new A(3504,!1)}function Ap(n){return new A(3301,!1)}function Pp(n,e){return new A(3302,!1)}function Rp(n){return new A(3303,!1)}function kp(n,e){return new A(3400,!1)}function Dp(n){return new A(3401,!1)}function Mp(n){return new A(3402,!1)}function Op(n,e){return new A(3505,!1)}function Qe(n){switch(n.length){case 0:return new gt;case 1:return n[0];default:return new ri(n)}}function Fu(n,e,t=new Map,s=new Map){let i=[],r=[],o=-1,a=null;if(e.forEach(l=>{let c=l.get("offset"),u=c==o,h=u&&a||new Map;l.forEach((d,f)=>{let p=f,_=d;if(f!=="offset")switch(p=n.normalizePropertyName(p,i),_){case Dn:_=t.get(f);break;case we:_=s.get(f);break;default:_=n.normalizeStyleValue(f,p,_,i);break}h.set(p,_)}),u||r.push(h),a=h,o=c}),i.length)throw Cp(i);return r}function Co(n,e,t,s){switch(e){case"start":n.onStart(()=>s(t&&to(t,"start",n)));break;case"done":n.onDone(()=>s(t&&to(t,"done",n)));break;case"destroy":n.onDestroy(()=>s(t&&to(t,"destroy",n)));break}}function to(n,e,t){let s=t.totalTime,i=!!t.disabled,r=bo(n.element,n.triggerName,n.fromState,n.toState,e||n.phaseName,s??n.totalTime,i),o=n._data;return o!=null&&(r._data=o),r}function bo(n,e,t,s,i="",r=0,o){return{element:n,triggerName:e,fromState:t,toState:s,phaseName:i,totalTime:r,disabled:!!o}}function le(n,e,t){let s=n.get(e);return s||n.set(e,s=t),s}function Cu(n){let e=n.indexOf(":"),t=n.substring(1,e),s=n.slice(e+1);return[t,s]}var xp=typeof document>"u"?null:document.documentElement;function Io(n){let e=n.parentNode||n.host||null;return e===xp?null:e}function Lp(n){return n.substring(1,6)=="ebkit"}var ot=null,bu=!1;function Fp(n){ot||(ot=Wp()||{},bu=ot.style?"WebkitAppearance"in ot.style:!1);let e=!0;return ot.style&&!Lp(n)&&(e=n in ot.style,!e&&bu&&(e="Webkit"+n.charAt(0).toUpperCase()+n.slice(1)in ot.style)),e}function Wp(){return typeof document<"u"?document.body:null}function Wu(n,e){for(;e;){if(e===n)return!0;e=Io(e)}return!1}function Bu(n,e,t){if(t)return Array.from(n.querySelectorAll(e));let s=n.querySelector(e);return s?[s]:[]}var No=(()=>{class n{validateStyleProperty(t){return Fp(t)}containsElement(t,s){return Wu(t,s)}getParentElement(t){return Io(t)}query(t,s,i){return Bu(t,s,i)}computeStyle(t,s,i){return i||""}animate(t,s,i,r,o,a=[],l){return new gt(i,r)}static{this.\u0275fac=function(s){return new(s||n)}}static{this.\u0275prov=pt({token:n,factory:n.\u0275fac})}}return n})(),ct=class{static{this.NOOP=new No}},ut=class{};var Bp=1e3,Uu="{{",Up="}}",Vu="ng-enter",ao="ng-leave",bs="ng-trigger",Rs=".ng-trigger",Iu="ng-animating",lo=".ng-animating";function De(n){if(typeof n=="number")return n;let e=n.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:co(parseFloat(e[1]),e[2])}function co(n,e){switch(e){case"s":return n*Bp;default:return n}}function ks(n,e,t){return n.hasOwnProperty("duration")?n:Vp(n,e,t)}function Vp(n,e,t){let s=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i,i,r=0,o="";if(typeof n=="string"){let a=n.match(s);if(a===null)return e.push(Tu(n)),{duration:0,delay:0,easing:""};i=co(parseFloat(a[1]),a[2]);let l=a[3];l!=null&&(r=co(parseFloat(l),a[4]));let c=a[5];c&&(o=c)}else i=n;if(!t){let a=!1,l=e.length;i<0&&(e.push(ip()),a=!0),r<0&&(e.push(rp()),a=!0),a&&e.splice(l,0,Tu(n))}return{duration:i,delay:r,easing:o}}function Kp(n){return n.length?n[0]instanceof Map?n:n.map(e=>new Map(Object.entries(e))):[]}function Ne(n,e,t){e.forEach((s,i)=>{let r=Ao(i);t&&!t.has(i)&&t.set(i,n.style[r]),n.style[r]=s})}function lt(n,e){e.forEach((t,s)=>{let i=Ao(s);n.style[i]=""})}function vn(n){return Array.isArray(n)?n.length==1?n[0]:Ga(n):n}function qp(n,e,t){let s=e.params||{},i=Ku(n);i.length&&i.forEach(r=>{s.hasOwnProperty(r)||t.push(op(r))})}var uo=new RegExp(`${Uu}\\s*(.+?)\\s*${Up}`,"g");function Ku(n){let e=[];if(typeof n=="string"){let t;for(;t=uo.exec(n);)e.push(t[1]);uo.lastIndex=0}return e}function wn(n,e,t){let s=`${n}`,i=s.replace(uo,(r,o)=>{let a=e[o];return a==null&&(t.push(ap(o)),a=""),a.toString()});return i==s?n:i}var Qp=/-+([a-z0-9])/g;function Ao(n){return n.replace(Qp,(...e)=>e[1].toUpperCase())}function zp(n,e){return n===0||e===0}function jp(n,e,t){if(t.size&&e.length){let s=e[0],i=[];if(t.forEach((r,o)=>{s.has(o)||i.push(o),s.set(o,r)}),i.length)for(let r=1;r<e.length;r++){let o=e[r];i.forEach(a=>o.set(a,Po(n,a)))}}return e}function ae(n,e,t){switch(e.type){case I.Trigger:return n.visitTrigger(e,t);case I.State:return n.visitState(e,t);case I.Transition:return n.visitTransition(e,t);case I.Sequence:return n.visitSequence(e,t);case I.Group:return n.visitGroup(e,t);case I.Animate:return n.visitAnimate(e,t);case I.Keyframes:return n.visitKeyframes(e,t);case I.Style:return n.visitStyle(e,t);case I.Reference:return n.visitReference(e,t);case I.AnimateChild:return n.visitAnimateChild(e,t);case I.AnimateRef:return n.visitAnimateRef(e,t);case I.Query:return n.visitQuery(e,t);case I.Stagger:return n.visitStagger(e,t);default:throw lp(e.type)}}function Po(n,e){return window.getComputedStyle(n)[e]}var Gp=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]),Ds=class extends ut{normalizePropertyName(e,t){return Ao(e)}normalizeStyleValue(e,t,s,i){let r="",o=s.toString().trim();if(Gp.has(t)&&s!==0&&s!=="0")if(typeof s=="number")r="px";else{let a=s.match(/^[+-]?[\d\.]+([a-z]*)$/);a&&a[1].length==0&&i.push(cp(e,s))}return o+r}};var Ms="*";function $p(n,e){let t=[];return typeof n=="string"?n.split(/\s*,\s*/).forEach(s=>Hp(s,t,e)):t.push(n),t}function Hp(n,e,t){if(n[0]==":"){let l=Yp(n,t);if(typeof l=="function"){e.push(l);return}n=l}let s=n.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(s==null||s.length<4)return t.push(wp(n)),e;let i=s[1],r=s[2],o=s[3];e.push(Nu(i,o));let a=i==Ms&&o==Ms;r[0]=="<"&&!a&&e.push(Nu(o,i))}function Yp(n,e){switch(n){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,s)=>parseFloat(s)>parseFloat(t);case":decrement":return(t,s)=>parseFloat(s)<parseFloat(t);default:return e.push(Sp(n)),"* => *"}}var Is=new Set(["true","1"]),Ns=new Set(["false","0"]);function Nu(n,e){let t=Is.has(n)||Ns.has(n),s=Is.has(e)||Ns.has(e);return(i,r)=>{let o=n==Ms||n==i,a=e==Ms||e==r;return!o&&t&&typeof i=="boolean"&&(o=i?Is.has(n):Ns.has(n)),!a&&s&&typeof r=="boolean"&&(a=r?Is.has(e):Ns.has(e)),o&&a}}var qu=":self",Xp=new RegExp(`s*${qu}s*,?`,"g");function Qu(n,e,t,s){return new ho(n).build(e,t,s)}var Au="",ho=class{constructor(e){this._driver=e}build(e,t,s){let i=new fo(t);return this._resetContextStyleTimingState(i),ae(this,vn(e),i)}_resetContextStyleTimingState(e){e.currentQuerySelector=Au,e.collectedStyles=new Map,e.collectedStyles.set(Au,new Map),e.currentTime=0}visitTrigger(e,t){let s=t.queryCount=0,i=t.depCount=0,r=[],o=[];return e.name.charAt(0)=="@"&&t.errors.push(up()),e.definitions.forEach(a=>{if(this._resetContextStyleTimingState(t),a.type==I.State){let l=a,c=l.name;c.toString().split(/\s*,\s*/).forEach(u=>{l.name=u,r.push(this.visitState(l,t))}),l.name=c}else if(a.type==I.Transition){let l=this.visitTransition(a,t);s+=l.queryCount,i+=l.depCount,o.push(l)}else t.errors.push(hp())}),{type:I.Trigger,name:e.name,states:r,transitions:o,queryCount:s,depCount:i,options:null}}visitState(e,t){let s=this.visitStyle(e.styles,t),i=e.options&&e.options.params||null;if(s.containsDynamicStyles){let r=new Set,o=i||{};s.styles.forEach(a=>{a instanceof Map&&a.forEach(l=>{Ku(l).forEach(c=>{o.hasOwnProperty(c)||r.add(c)})})}),r.size&&t.errors.push(dp(e.name,[...r.values()]))}return{type:I.State,name:e.name,style:s,options:i?{params:i}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;let s=ae(this,vn(e.animation),t),i=$p(e.expr,t.errors);return{type:I.Transition,matchers:i,animation:s,queryCount:t.queryCount,depCount:t.depCount,options:at(e.options)}}visitSequence(e,t){return{type:I.Sequence,steps:e.steps.map(s=>ae(this,s,t)),options:at(e.options)}}visitGroup(e,t){let s=t.currentTime,i=0,r=e.steps.map(o=>{t.currentTime=s;let a=ae(this,o,t);return i=Math.max(i,t.currentTime),a});return t.currentTime=i,{type:I.Group,steps:r,options:at(e.options)}}visitAnimate(e,t){let s=tm(e.timings,t.errors);t.currentAnimateTimings=s;let i,r=e.styles?e.styles:ii({});if(r.type==I.Keyframes)i=this.visitKeyframes(r,t);else{let o=e.styles,a=!1;if(!o){a=!0;let c={};s.easing&&(c.easing=s.easing),o=ii(c)}t.currentTime+=s.duration+s.delay;let l=this.visitStyle(o,t);l.isEmptyStep=a,i=l}return t.currentAnimateTimings=null,{type:I.Animate,timings:s,style:i,options:null}}visitStyle(e,t){let s=this._makeStyleAst(e,t);return this._validateStyleAst(s,t),s}_makeStyleAst(e,t){let s=[],i=Array.isArray(e.styles)?e.styles:[e.styles];for(let a of i)typeof a=="string"?a===we?s.push(a):t.errors.push(fp(a)):s.push(new Map(Object.entries(a)));let r=!1,o=null;return s.forEach(a=>{if(a instanceof Map&&(a.has("easing")&&(o=a.get("easing"),a.delete("easing")),!r)){for(let l of a.values())if(l.toString().indexOf(Uu)>=0){r=!0;break}}}),{type:I.Style,styles:s,easing:o,offset:e.offset,containsDynamicStyles:r,options:null}}_validateStyleAst(e,t){let s=t.currentAnimateTimings,i=t.currentTime,r=t.currentTime;s&&r>0&&(r-=s.duration+s.delay),e.styles.forEach(o=>{typeof o!="string"&&o.forEach((a,l)=>{let c=t.collectedStyles.get(t.currentQuerySelector),u=c.get(l),h=!0;u&&(r!=i&&r>=u.startTime&&i<=u.endTime&&(t.errors.push(pp(l,u.startTime,u.endTime,r,i)),h=!1),r=u.startTime),h&&c.set(l,{startTime:r,endTime:i}),t.options&&qp(a,t.options,t.errors)})})}visitKeyframes(e,t){let s={type:I.Keyframes,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push(mp()),s;let i=1,r=0,o=[],a=!1,l=!1,c=0,u=e.steps.map(k=>{let D=this._makeStyleAst(k,t),W=D.offset!=null?D.offset:em(D.styles),V=0;return W!=null&&(r++,V=D.offset=W),l=l||V<0||V>1,a=a||V<c,c=V,o.push(V),D});l&&t.errors.push(_p()),a&&t.errors.push(gp());let h=e.steps.length,d=0;r>0&&r<h?t.errors.push(yp()):r==0&&(d=i/(h-1));let f=h-1,p=t.currentTime,_=t.currentAnimateTimings,w=_.duration;return u.forEach((k,D)=>{let W=d>0?D==f?1:d*D:o[D],V=W*w;t.currentTime=p+_.delay+V,_.duration=V,this._validateStyleAst(k,t),k.offset=W,s.styles.push(k)}),s}visitReference(e,t){return{type:I.Reference,animation:ae(this,vn(e.animation),t),options:at(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:I.AnimateChild,options:at(e.options)}}visitAnimateRef(e,t){return{type:I.AnimateRef,animation:this.visitReference(e.animation,t),options:at(e.options)}}visitQuery(e,t){let s=t.currentQuerySelector,i=e.options||{};t.queryCount++,t.currentQuery=e;let[r,o]=Jp(e.selector);t.currentQuerySelector=s.length?s+" "+r:r,le(t.collectedStyles,t.currentQuerySelector,new Map);let a=ae(this,vn(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=s,{type:I.Query,selector:r,limit:i.limit||0,optional:!!i.optional,includeSelf:o,animation:a,originalSelector:e.selector,options:at(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push(vp());let s=e.timings==="full"?{duration:0,delay:0,easing:"full"}:ks(e.timings,t.errors,!0);return{type:I.Stagger,animation:ae(this,vn(e.animation),t),timings:s,options:null}}};function Jp(n){let e=!!n.split(/\s*,\s*/).find(t=>t==qu);return e&&(n=n.replace(Xp,"")),n=n.replace(/@\*/g,Rs).replace(/@\w+/g,t=>Rs+"-"+t.slice(1)).replace(/:animating/g,lo),[n,e]}function Zp(n){return n?ft({},n):null}var fo=class{constructor(e){this.errors=e,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}};function em(n){if(typeof n=="string")return null;let e=null;if(Array.isArray(n))n.forEach(t=>{if(t instanceof Map&&t.has("offset")){let s=t;e=parseFloat(s.get("offset")),s.delete("offset")}});else if(n instanceof Map&&n.has("offset")){let t=n;e=parseFloat(t.get("offset")),t.delete("offset")}return e}function tm(n,e){if(n.hasOwnProperty("duration"))return n;if(typeof n=="number"){let r=ks(n,e).duration;return no(r,0,"")}let t=n;if(t.split(/\s+/).some(r=>r.charAt(0)=="{"&&r.charAt(1)=="{")){let r=no(0,0,"");return r.dynamic=!0,r.strValue=t,r}let i=ks(t,e);return no(i.duration,i.delay,i.easing)}function at(n){return n?(n=ft({},n),n.params&&(n.params=Zp(n.params))):n={},n}function no(n,e,t){return{duration:n,delay:e,easing:t}}function Ro(n,e,t,s,i,r,o=null,a=!1){return{type:1,element:n,keyframes:e,preStyleProps:t,postStyleProps:s,duration:i,delay:r,totalTime:i+r,easing:o,subTimeline:a}}var Sn=class{constructor(){this._map=new Map}get(e){return this._map.get(e)||[]}append(e,t){let s=this._map.get(e);s||this._map.set(e,s=[]),s.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}},nm=1,sm=":enter",im=new RegExp(sm,"g"),rm=":leave",om=new RegExp(rm,"g");function zu(n,e,t,s,i,r=new Map,o=new Map,a,l,c=[]){return new po().buildKeyframes(n,e,t,s,i,r,o,a,l,c)}var po=class{buildKeyframes(e,t,s,i,r,o,a,l,c,u=[]){c=c||new Sn;let h=new mo(e,t,c,i,r,u,[]);h.options=l;let d=l.delay?De(l.delay):0;h.currentTimeline.delayNextStep(d),h.currentTimeline.setStyles([o],null,h.errors,l),ae(this,s,h);let f=h.timelines.filter(p=>p.containsAnimation());if(f.length&&a.size){let p;for(let _=f.length-1;_>=0;_--){let w=f[_];if(w.element===t){p=w;break}}p&&!p.allowOnlyTimelineStyles()&&p.setStyles([a],null,h.errors,l)}return f.length?f.map(p=>p.buildKeyframes()):[Ro(t,[],[],[],0,d,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){let s=t.subInstructions.get(t.element);if(s){let i=t.createSubContext(e.options),r=t.currentTimeline.currentTime,o=this._visitSubInstructions(s,i,i.options);r!=o&&t.transformIntoNewTimeline(o)}t.previousNode=e}visitAnimateRef(e,t){let s=t.createSubContext(e.options);s.transformIntoNewTimeline(),this._applyAnimationRefDelays([e.options,e.animation.options],t,s),this.visitReference(e.animation,s),t.transformIntoNewTimeline(s.currentTimeline.currentTime),t.previousNode=e}_applyAnimationRefDelays(e,t,s){for(let i of e){let r=i?.delay;if(r){let o=typeof r=="number"?r:De(wn(r,i?.params??{},t.errors));s.delayNextStep(o)}}}_visitSubInstructions(e,t,s){let r=t.currentTimeline.currentTime,o=s.duration!=null?De(s.duration):null,a=s.delay!=null?De(s.delay):null;return o!==0&&e.forEach(l=>{let c=t.appendInstructionToTimeline(l,o,a);r=Math.max(r,c.duration+c.delay)}),r}visitReference(e,t){t.updateOptions(e.options,!0),ae(this,e.animation,t),t.previousNode=e}visitSequence(e,t){let s=t.subContextCount,i=t,r=e.options;if(r&&(r.params||r.delay)&&(i=t.createSubContext(r),i.transformIntoNewTimeline(),r.delay!=null)){i.previousNode.type==I.Style&&(i.currentTimeline.snapshotCurrentStyles(),i.previousNode=Os);let o=De(r.delay);i.delayNextStep(o)}e.steps.length&&(e.steps.forEach(o=>ae(this,o,i)),i.currentTimeline.applyStylesToKeyframe(),i.subContextCount>s&&i.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){let s=[],i=t.currentTimeline.currentTime,r=e.options&&e.options.delay?De(e.options.delay):0;e.steps.forEach(o=>{let a=t.createSubContext(e.options);r&&a.delayNextStep(r),ae(this,o,a),i=Math.max(i,a.currentTimeline.currentTime),s.push(a.currentTimeline)}),s.forEach(o=>t.currentTimeline.mergeTimelineCollectedStyles(o)),t.transformIntoNewTimeline(i),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){let s=e.strValue,i=t.params?wn(s,t.params,t.errors):s;return ks(i,t.errors)}else return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){let s=t.currentAnimateTimings=this._visitTiming(e.timings,t),i=t.currentTimeline;s.delay&&(t.incrementTime(s.delay),i.snapshotCurrentStyles());let r=e.style;r.type==I.Keyframes?this.visitKeyframes(r,t):(t.incrementTime(s.duration),this.visitStyle(r,t),i.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){let s=t.currentTimeline,i=t.currentAnimateTimings;!i&&s.hasCurrentStyleProperties()&&s.forwardFrame();let r=i&&i.easing||e.easing;e.isEmptyStep?s.applyEmptyStep(r):s.setStyles(e.styles,r,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){let s=t.currentAnimateTimings,i=t.currentTimeline.duration,r=s.duration,a=t.createSubContext().currentTimeline;a.easing=s.easing,e.styles.forEach(l=>{let c=l.offset||0;a.forwardTime(c*r),a.setStyles(l.styles,l.easing,t.errors,t.options),a.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(a),t.transformIntoNewTimeline(i+r),t.previousNode=e}visitQuery(e,t){let s=t.currentTimeline.currentTime,i=e.options||{},r=i.delay?De(i.delay):0;r&&(t.previousNode.type===I.Style||s==0&&t.currentTimeline.hasCurrentStyleProperties())&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=Os);let o=s,a=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!i.optional,t.errors);t.currentQueryTotal=a.length;let l=null;a.forEach((c,u)=>{t.currentQueryIndex=u;let h=t.createSubContext(e.options,c);r&&h.delayNextStep(r),c===t.element&&(l=h.currentTimeline),ae(this,e.animation,h),h.currentTimeline.applyStylesToKeyframe();let d=h.currentTimeline.currentTime;o=Math.max(o,d)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(o),l&&(t.currentTimeline.mergeTimelineCollectedStyles(l),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){let s=t.parentContext,i=t.currentTimeline,r=e.timings,o=Math.abs(r.duration),a=o*(t.currentQueryTotal-1),l=o*t.currentQueryIndex;switch(r.duration<0?"reverse":r.easing){case"reverse":l=a-l;break;case"full":l=s.currentStaggerTime;break}let u=t.currentTimeline;l&&u.delayNextStep(l);let h=u.currentTime;ae(this,e.animation,t),t.previousNode=e,s.currentStaggerTime=i.currentTime-h+(i.startTime-s.currentTimeline.startTime)}},Os={},mo=class n{constructor(e,t,s,i,r,o,a,l){this._driver=e,this.element=t,this.subInstructions=s,this._enterClassName=i,this._leaveClassName=r,this.errors=o,this.timelines=a,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=Os,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=l||new xs(this._driver,t,0),a.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;let s=e,i=this.options;s.duration!=null&&(i.duration=De(s.duration)),s.delay!=null&&(i.delay=De(s.delay));let r=s.params;if(r){let o=i.params;o||(o=this.options.params={}),Object.keys(r).forEach(a=>{(!t||!o.hasOwnProperty(a))&&(o[a]=wn(r[a],o,this.errors))})}}_copyOptions(){let e={};if(this.options){let t=this.options.params;if(t){let s=e.params={};Object.keys(t).forEach(i=>{s[i]=t[i]})}}return e}createSubContext(e=null,t,s){let i=t||this.element,r=new n(this._driver,i,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(i,s||0));return r.previousNode=this.previousNode,r.currentAnimateTimings=this.currentAnimateTimings,r.options=this._copyOptions(),r.updateOptions(e),r.currentQueryIndex=this.currentQueryIndex,r.currentQueryTotal=this.currentQueryTotal,r.parentContext=this,this.subContextCount++,r}transformIntoNewTimeline(e){return this.previousNode=Os,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,s){let i={duration:t??e.duration,delay:this.currentTimeline.currentTime+(s??0)+e.delay,easing:""},r=new _o(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,i,e.stretchStartingKeyframe);return this.timelines.push(r),i}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,s,i,r,o){let a=[];if(i&&a.push(this.element),e.length>0){e=e.replace(im,"."+this._enterClassName),e=e.replace(om,"."+this._leaveClassName);let l=s!=1,c=this._driver.query(this.element,e,l);s!==0&&(c=s<0?c.slice(c.length+s,c.length):c.slice(0,s)),a.push(...c)}return!r&&a.length==0&&o.push(Ep(t)),a}},xs=class n{constructor(e,t,s,i){this._driver=e,this.element=t,this.startTime=s,this._elementTimelineStylesLookup=i,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(e){let t=this._keyframes.size===1&&this._pendingStyles.size;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new n(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=nm,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles.set(e,t),this._globalTimelineStyles.set(e,t),this._styleSummary.set(e,{time:this.currentTime,value:t})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&this._previousKeyframe.set("easing",e);for(let[t,s]of this._globalTimelineStyles)this._backFill.set(t,s||we),this._currentKeyframe.set(t,we);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,s,i){t&&this._previousKeyframe.set("easing",t);let r=i&&i.params||{},o=am(e,this._globalTimelineStyles);for(let[a,l]of o){let c=wn(l,r,s);this._pendingStyles.set(a,c),this._localTimelineStyles.has(a)||this._backFill.set(a,this._globalTimelineStyles.get(a)??we),this._updateStyle(a,c)}}applyStylesToKeyframe(){this._pendingStyles.size!=0&&(this._pendingStyles.forEach((e,t)=>{this._currentKeyframe.set(t,e)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((e,t)=>{this._currentKeyframe.has(t)||this._currentKeyframe.set(t,e)}))}snapshotCurrentStyles(){for(let[e,t]of this._localTimelineStyles)this._pendingStyles.set(e,t),this._updateStyle(e,t)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){let e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){e._styleSummary.forEach((t,s)=>{let i=this._styleSummary.get(s);(!i||t.time>i.time)&&this._updateStyle(s,t.value)})}buildKeyframes(){this.applyStylesToKeyframe();let e=new Set,t=new Set,s=this._keyframes.size===1&&this.duration===0,i=[];this._keyframes.forEach((a,l)=>{let c=new Map([...this._backFill,...a]);c.forEach((u,h)=>{u===Dn?e.add(h):u===we&&t.add(h)}),s||c.set("offset",l/this.duration),i.push(c)});let r=[...e.values()],o=[...t.values()];if(s){let a=i[0],l=new Map(a);a.set("offset",0),l.set("offset",1),i=[a,l]}return Ro(this.element,i,r,o,this.duration,this.startTime,this.easing,!1)}},_o=class extends xs{constructor(e,t,s,i,r,o,a=!1){super(e,t,o.delay),this.keyframes=s,this.preStyleProps=i,this.postStyleProps=r,this._stretchStartingKeyframe=a,this.timings={duration:o.duration,delay:o.delay,easing:o.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:s,easing:i}=this.timings;if(this._stretchStartingKeyframe&&t){let r=[],o=s+t,a=t/o,l=new Map(e[0]);l.set("offset",0),r.push(l);let c=new Map(e[0]);c.set("offset",Pu(a)),r.push(c);let u=e.length-1;for(let h=1;h<=u;h++){let d=new Map(e[h]),f=d.get("offset"),p=t+f*s;d.set("offset",Pu(p/o)),r.push(d)}s=o,t=0,i="",e=r}return Ro(this.element,e,this.preStyleProps,this.postStyleProps,s,t,i,!0)}};function Pu(n,e=3){let t=Math.pow(10,e-1);return Math.round(n*t)/t}function am(n,e){let t=new Map,s;return n.forEach(i=>{if(i==="*"){s??=e.keys();for(let r of s)t.set(r,we)}else for(let[r,o]of i)t.set(r,o)}),t}function Ru(n,e,t,s,i,r,o,a,l,c,u,h,d){return{type:0,element:n,triggerName:e,isRemovalTransition:i,fromState:t,fromStyles:r,toState:s,toStyles:o,timelines:a,queriedElements:l,preStyleProps:c,postStyleProps:u,totalTime:h,errors:d}}var so={},Ls=class{constructor(e,t,s){this._triggerName=e,this.ast=t,this._stateStyles=s}match(e,t,s,i){return lm(this.ast.matchers,e,t,s,i)}buildStyles(e,t,s){let i=this._stateStyles.get("*");return e!==void 0&&(i=this._stateStyles.get(e?.toString())||i),i?i.buildStyles(t,s):new Map}build(e,t,s,i,r,o,a,l,c,u){let h=[],d=this.ast.options&&this.ast.options.params||so,f=a&&a.params||so,p=this.buildStyles(s,f,h),_=l&&l.params||so,w=this.buildStyles(i,_,h),k=new Set,D=new Map,W=new Map,V=i==="void",ht={params:ju(_,d),delay:this.ast.options?.delay},ye=u?[]:zu(e,t,this.ast.animation,r,o,p,w,ht,c,h),$=0;return ye.forEach(Z=>{$=Math.max(Z.duration+Z.delay,$)}),h.length?Ru(t,this._triggerName,s,i,V,p,w,[],[],D,W,$,h):(ye.forEach(Z=>{let ze=Z.element,dt=le(D,ze,new Set);Z.preStyleProps.forEach(je=>dt.add(je));let ko=le(W,ze,new Set);Z.postStyleProps.forEach(je=>ko.add(je)),ze!==t&&k.add(ze)}),Ru(t,this._triggerName,s,i,V,p,w,ye,[...k.values()],D,W,$))}};function lm(n,e,t,s,i){return n.some(r=>r(e,t,s,i))}function ju(n,e){let t=ft({},e);return Object.entries(n).forEach(([s,i])=>{i!=null&&(t[s]=i)}),t}var go=class{constructor(e,t,s){this.styles=e,this.defaultParams=t,this.normalizer=s}buildStyles(e,t){let s=new Map,i=ju(e,this.defaultParams);return this.styles.styles.forEach(r=>{typeof r!="string"&&r.forEach((o,a)=>{o&&(o=wn(o,i,t));let l=this.normalizer.normalizePropertyName(a,t);o=this.normalizer.normalizeStyleValue(a,l,o,t),s.set(a,o)})}),s}};function cm(n,e,t){return new yo(n,e,t)}var yo=class{constructor(e,t,s){this.name=e,this.ast=t,this._normalizer=s,this.transitionFactories=[],this.states=new Map,t.states.forEach(i=>{let r=i.options&&i.options.params||{};this.states.set(i.name,new go(i.style,r,s))}),ku(this.states,"true","1"),ku(this.states,"false","0"),t.transitions.forEach(i=>{this.transitionFactories.push(new Ls(e,i,this.states))}),this.fallbackTransition=um(e,this.states,this._normalizer)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,s,i){return this.transitionFactories.find(o=>o.match(e,t,s,i))||null}matchStyles(e,t,s){return this.fallbackTransition.buildStyles(e,t,s)}};function um(n,e,t){let s=[(o,a)=>!0],i={type:I.Sequence,steps:[],options:null},r={type:I.Transition,animation:i,matchers:s,options:null,queryCount:0,depCount:0};return new Ls(n,r,e)}function ku(n,e,t){n.has(e)?n.has(t)||n.set(t,n.get(e)):n.has(t)&&n.set(e,n.get(t))}var hm=new Sn,vo=class{constructor(e,t,s){this.bodyNode=e,this._driver=t,this._normalizer=s,this._animations=new Map,this._playersById=new Map,this.players=[]}register(e,t){let s=[],i=[],r=Qu(this._driver,t,s,i);if(s.length)throw bp(s);i.length&&void 0,this._animations.set(e,r)}_buildPlayer(e,t,s){let i=e.element,r=Fu(this._normalizer,e.keyframes,t,s);return this._driver.animate(i,r,e.duration,e.delay,e.easing,[],!0)}create(e,t,s={}){let i=[],r=this._animations.get(e),o,a=new Map;if(r?(o=zu(this._driver,t,r,Vu,ao,new Map,new Map,s,hm,i),o.forEach(u=>{let h=le(a,u.element,new Map);u.postStyleProps.forEach(d=>h.set(d,null))})):(i.push(Ip()),o=[]),i.length)throw Np(i);a.forEach((u,h)=>{u.forEach((d,f)=>{u.set(f,this._driver.computeStyle(h,f,we))})});let l=o.map(u=>{let h=a.get(u.element);return this._buildPlayer(u,new Map,h)}),c=Qe(l);return this._playersById.set(e,c),c.onDestroy(()=>this.destroy(e)),this.players.push(c),c}destroy(e){let t=this._getPlayer(e);t.destroy(),this._playersById.delete(e);let s=this.players.indexOf(t);s>=0&&this.players.splice(s,1)}_getPlayer(e){let t=this._playersById.get(e);if(!t)throw Ap(e);return t}listen(e,t,s,i){let r=bo(t,"","","");return Co(this._getPlayer(e),s,r,i),()=>{}}command(e,t,s,i){if(s=="register"){this.register(e,i[0]);return}if(s=="create"){let o=i[0]||{};this.create(e,t,o);return}let r=this._getPlayer(e);switch(s){case"play":r.play();break;case"pause":r.pause();break;case"reset":r.reset();break;case"restart":r.restart();break;case"finish":r.finish();break;case"init":r.init();break;case"setPosition":r.setPosition(parseFloat(i[0]));break;case"destroy":this.destroy(e);break}}},Du="ng-animate-queued",dm=".ng-animate-queued",io="ng-animate-disabled",fm=".ng-animate-disabled",pm="ng-star-inserted",mm=".ng-star-inserted",_m=[],Gu={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},gm={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},ge="__ng_removed",Tn=class{get params(){return this.options.params}constructor(e,t=""){this.namespaceId=t;let s=e&&e.hasOwnProperty("value"),i=s?e.value:e;if(this.value=vm(i),s){let r=e,{value:o}=r,a=Lo(r,["value"]);this.options=a}else this.options={};this.options.params||(this.options.params={})}absorbOptions(e){let t=e.params;if(t){let s=this.options.params;Object.keys(t).forEach(i=>{s[i]==null&&(s[i]=t[i])})}}},En="void",ro=new Tn(En),Eo=class{constructor(e,t,s){this.id=e,this.hostElement=t,this._engine=s,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+e,pe(t,this._hostClassName)}listen(e,t,s,i){if(!this._triggers.has(t))throw Pp(s,t);if(s==null||s.length==0)throw Rp(t);if(!Em(s))throw kp(s,t);let r=le(this._elementListeners,e,[]),o={name:t,phase:s,callback:i};r.push(o);let a=le(this._engine.statesByElement,e,new Map);return a.has(t)||(pe(e,bs),pe(e,bs+"-"+t),a.set(t,ro)),()=>{this._engine.afterFlush(()=>{let l=r.indexOf(o);l>=0&&r.splice(l,1),this._triggers.has(t)||a.delete(t)})}}register(e,t){return this._triggers.has(e)?!1:(this._triggers.set(e,t),!0)}_getTrigger(e){let t=this._triggers.get(e);if(!t)throw Dp(e);return t}trigger(e,t,s,i=!0){let r=this._getTrigger(t),o=new Cn(this.id,t,e),a=this._engine.statesByElement.get(e);a||(pe(e,bs),pe(e,bs+"-"+t),this._engine.statesByElement.set(e,a=new Map));let l=a.get(t),c=new Tn(s,this.id);if(!(s&&s.hasOwnProperty("value"))&&l&&c.absorbOptions(l.options),a.set(t,c),l||(l=ro),!(c.value===En)&&l.value===c.value){if(!Tm(l.params,c.params)){let _=[],w=r.matchStyles(l.value,l.params,_),k=r.matchStyles(c.value,c.params,_);_.length?this._engine.reportError(_):this._engine.afterFlush(()=>{lt(e,w),Ne(e,k)})}return}let d=le(this._engine.playersByElement,e,[]);d.forEach(_=>{_.namespaceId==this.id&&_.triggerName==t&&_.queued&&_.destroy()});let f=r.matchTransition(l.value,c.value,e,c.params),p=!1;if(!f){if(!i)return;f=r.fallbackTransition,p=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:f,fromState:l,toState:c,player:o,isFallbackTransition:p}),p||(pe(e,Du),o.onStart(()=>{xt(e,Du)})),o.onDone(()=>{let _=this.players.indexOf(o);_>=0&&this.players.splice(_,1);let w=this._engine.playersByElement.get(e);if(w){let k=w.indexOf(o);k>=0&&w.splice(k,1)}}),this.players.push(o),d.push(o),o}deregister(e){this._triggers.delete(e),this._engine.statesByElement.forEach(t=>t.delete(e)),this._elementListeners.forEach((t,s)=>{this._elementListeners.set(s,t.filter(i=>i.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);let t=this._engine.playersByElement.get(e);t&&(t.forEach(s=>s.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){let s=this._engine.driver.query(e,Rs,!0);s.forEach(i=>{if(i[ge])return;let r=this._engine.fetchNamespacesByElement(i);r.size?r.forEach(o=>o.triggerLeaveAnimation(i,t,!1,!0)):this.clearElementCache(i)}),this._engine.afterFlushAnimationsDone(()=>s.forEach(i=>this.clearElementCache(i)))}triggerLeaveAnimation(e,t,s,i){let r=this._engine.statesByElement.get(e),o=new Map;if(r){let a=[];if(r.forEach((l,c)=>{if(o.set(c,l.value),this._triggers.has(c)){let u=this.trigger(e,c,En,i);u&&a.push(u)}}),a.length)return this._engine.markElementAsRemoved(this.id,e,!0,t,o),s&&Qe(a).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){let t=this._elementListeners.get(e),s=this._engine.statesByElement.get(e);if(t&&s){let i=new Set;t.forEach(r=>{let o=r.name;if(i.has(o))return;i.add(o);let l=this._triggers.get(o).fallbackTransition,c=s.get(o)||ro,u=new Tn(En),h=new Cn(this.id,o,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:o,transition:l,fromState:c,toState:u,player:h,isFallbackTransition:!0})})}}removeNode(e,t){let s=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let i=!1;if(s.totalAnimations){let r=s.players.length?s.playersByQueriedElement.get(e):[];if(r&&r.length)i=!0;else{let o=e;for(;o=o.parentNode;)if(s.statesByElement.get(o)){i=!0;break}}}if(this.prepareLeaveAnimationListeners(e),i)s.markElementAsRemoved(this.id,e,!1,t);else{let r=e[ge];(!r||r===Gu)&&(s.afterFlush(()=>this.clearElementCache(e)),s.destroyInnerAnimations(e),s._onRemovalComplete(e,t))}}insertNode(e,t){pe(e,this._hostClassName)}drainQueuedTransitions(e){let t=[];return this._queue.forEach(s=>{let i=s.player;if(i.destroyed)return;let r=s.element,o=this._elementListeners.get(r);o&&o.forEach(a=>{if(a.name==s.triggerName){let l=bo(r,s.triggerName,s.fromState.value,s.toState.value);l._data=e,Co(s.player,a.phase,l,a.callback)}}),i.markedForDestroy?this._engine.afterFlush(()=>{i.destroy()}):t.push(s)}),this._queue=[],t.sort((s,i)=>{let r=s.transition.ast.depCount,o=i.transition.ast.depCount;return r==0||o==0?r-o:this._engine.driver.containsElement(s.element,i.element)?1:-1})}destroy(e){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}},wo=class{_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}constructor(e,t,s){this.bodyNode=e,this.driver=t,this._normalizer=s,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(i,r)=>{}}get queuedPlayers(){let e=[];return this._namespaceList.forEach(t=>{t.players.forEach(s=>{s.queued&&e.push(s)})}),e}createNamespace(e,t){let s=new Eo(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(s,t):(this.newHostElements.set(t,s),this.collectEnterElement(t)),this._namespaceLookup[e]=s}_balanceNamespaceList(e,t){let s=this._namespaceList,i=this.namespacesByHostElement;if(s.length-1>=0){let o=!1,a=this.driver.getParentElement(t);for(;a;){let l=i.get(a);if(l){let c=s.indexOf(l);s.splice(c+1,0,e),o=!0;break}a=this.driver.getParentElement(a)}o||s.unshift(e)}else s.push(e);return i.set(t,e),e}register(e,t){let s=this._namespaceLookup[e];return s||(s=this.createNamespace(e,t)),s}registerTrigger(e,t,s){let i=this._namespaceLookup[e];i&&i.register(t,s)&&this.totalAnimations++}destroy(e,t){e&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{let s=this._fetchNamespace(e);this.namespacesByHostElement.delete(s.hostElement);let i=this._namespaceList.indexOf(s);i>=0&&this._namespaceList.splice(i,1),s.destroy(t),delete this._namespaceLookup[e]}))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){let t=new Set,s=this.statesByElement.get(e);if(s){for(let i of s.values())if(i.namespaceId){let r=this._fetchNamespace(i.namespaceId);r&&t.add(r)}}return t}trigger(e,t,s,i){if(As(t)){let r=this._fetchNamespace(e);if(r)return r.trigger(t,s,i),!0}return!1}insertNode(e,t,s,i){if(!As(t))return;let r=t[ge];if(r&&r.setForRemoval){r.setForRemoval=!1,r.setForMove=!0;let o=this.collectedLeaveElements.indexOf(t);o>=0&&this.collectedLeaveElements.splice(o,1)}if(e){let o=this._fetchNamespace(e);o&&o.insertNode(t,s)}i&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),pe(e,io)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),xt(e,io))}removeNode(e,t,s){if(As(t)){let i=e?this._fetchNamespace(e):null;i?i.removeNode(t,s):this.markElementAsRemoved(e,t,!1,s);let r=this.namespacesByHostElement.get(t);r&&r.id!==e&&r.removeNode(t,s)}else this._onRemovalComplete(t,s)}markElementAsRemoved(e,t,s,i,r){this.collectedLeaveElements.push(t),t[ge]={namespaceId:e,setForRemoval:i,hasAnimation:s,removedBeforeQueried:!1,previousTriggersValues:r}}listen(e,t,s,i,r){return As(t)?this._fetchNamespace(e).listen(t,s,i,r):()=>{}}_buildInstruction(e,t,s,i,r){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,s,i,e.fromState.options,e.toState.options,t,r)}destroyInnerAnimations(e){let t=this.driver.query(e,Rs,!0);t.forEach(s=>this.destroyActiveAnimationsForElement(s)),this.playersByQueriedElement.size!=0&&(t=this.driver.query(e,lo,!0),t.forEach(s=>this.finishActiveQueriedAnimationOnElement(s)))}destroyActiveAnimationsForElement(e){let t=this.playersByElement.get(e);t&&t.forEach(s=>{s.queued?s.markedForDestroy=!0:s.destroy()})}finishActiveQueriedAnimationOnElement(e){let t=this.playersByQueriedElement.get(e);t&&t.forEach(s=>s.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return Qe(this.players).onDone(()=>e());e()})}processLeaveNode(e){let t=e[ge];if(t&&t.setForRemoval){if(e[ge]=Gu,t.namespaceId){this.destroyInnerAnimations(e);let s=this._fetchNamespace(t.namespaceId);s&&s.clearElementCache(e)}this._onRemovalComplete(e,t.setForRemoval)}e.classList?.contains(io)&&this.markElementAsDisabled(e,!1),this.driver.query(e,fm,!0).forEach(s=>{this.markElementAsDisabled(s,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((s,i)=>this._balanceNamespaceList(s,i)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let s=0;s<this.collectedEnterElements.length;s++){let i=this.collectedEnterElements[s];pe(i,pm)}if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){let s=[];try{t=this._flushAnimations(s,e)}finally{for(let i=0;i<s.length;i++)s[i]()}}else for(let s=0;s<this.collectedLeaveElements.length;s++){let i=this.collectedLeaveElements[s];this.processLeaveNode(i)}if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(s=>s()),this._flushFns=[],this._whenQuietFns.length){let s=this._whenQuietFns;this._whenQuietFns=[],t.length?Qe(t).onDone(()=>{s.forEach(i=>i())}):s.forEach(i=>i())}}reportError(e){throw Mp(e)}_flushAnimations(e,t){let s=new Sn,i=[],r=new Map,o=[],a=new Map,l=new Map,c=new Map,u=new Set;this.disabledNodes.forEach(g=>{u.add(g);let y=this.driver.query(g,dm,!0);for(let E=0;E<y.length;E++)u.add(y[E])});let h=this.bodyNode,d=Array.from(this.statesByElement.keys()),f=xu(d,this.collectedEnterElements),p=new Map,_=0;f.forEach((g,y)=>{let E=Vu+_++;p.set(y,E),g.forEach(N=>pe(N,E))});let w=[],k=new Set,D=new Set;for(let g=0;g<this.collectedLeaveElements.length;g++){let y=this.collectedLeaveElements[g],E=y[ge];E&&E.setForRemoval&&(w.push(y),k.add(y),E.hasAnimation?this.driver.query(y,mm,!0).forEach(N=>k.add(N)):D.add(y))}let W=new Map,V=xu(d,Array.from(k));V.forEach((g,y)=>{let E=ao+_++;W.set(y,E),g.forEach(N=>pe(N,E))}),e.push(()=>{f.forEach((g,y)=>{let E=p.get(y);g.forEach(N=>xt(N,E))}),V.forEach((g,y)=>{let E=W.get(y);g.forEach(N=>xt(N,E))}),w.forEach(g=>{this.processLeaveNode(g)})});let ht=[],ye=[];for(let g=this._namespaceList.length-1;g>=0;g--)this._namespaceList[g].drainQueuedTransitions(t).forEach(E=>{let N=E.player,q=E.element;if(ht.push(N),this.collectedEnterElements.length){let j=q[ge];if(j&&j.setForMove){if(j.previousTriggersValues&&j.previousTriggersValues.has(E.triggerName)){let Ge=j.previousTriggersValues.get(E.triggerName),ce=this.statesByElement.get(E.element);if(ce&&ce.has(E.triggerName)){let bn=ce.get(E.triggerName);bn.value=Ge,ce.set(E.triggerName,bn)}}N.destroy();return}}let ve=!h||!this.driver.containsElement(h,q),ne=W.get(q),Me=p.get(q),L=this._buildInstruction(E,s,Me,ne,ve);if(L.errors&&L.errors.length){ye.push(L);return}if(ve){N.onStart(()=>lt(q,L.fromStyles)),N.onDestroy(()=>Ne(q,L.toStyles)),i.push(N);return}if(E.isFallbackTransition){N.onStart(()=>lt(q,L.fromStyles)),N.onDestroy(()=>Ne(q,L.toStyles)),i.push(N);return}let Oo=[];L.timelines.forEach(j=>{j.stretchStartingKeyframe=!0,this.disabledNodes.has(j.element)||Oo.push(j)}),L.timelines=Oo,s.append(q,L.timelines);let eh={instruction:L,player:N,element:q};o.push(eh),L.queriedElements.forEach(j=>le(a,j,[]).push(N)),L.preStyleProps.forEach((j,Ge)=>{if(j.size){let ce=l.get(Ge);ce||l.set(Ge,ce=new Set),j.forEach((bn,qs)=>ce.add(qs))}}),L.postStyleProps.forEach((j,Ge)=>{let ce=c.get(Ge);ce||c.set(Ge,ce=new Set),j.forEach((bn,qs)=>ce.add(qs))})});if(ye.length){let g=[];ye.forEach(y=>{g.push(Op(y.triggerName,y.errors))}),ht.forEach(y=>y.destroy()),this.reportError(g)}let $=new Map,Z=new Map;o.forEach(g=>{let y=g.element;s.has(y)&&(Z.set(y,y),this._beforeAnimationBuild(g.player.namespaceId,g.instruction,$))}),i.forEach(g=>{let y=g.element;this._getPreviousPlayers(y,!1,g.namespaceId,g.triggerName,null).forEach(N=>{le($,y,[]).push(N),N.destroy()})});let ze=w.filter(g=>Lu(g,l,c)),dt=new Map;Ou(dt,this.driver,D,c,we).forEach(g=>{Lu(g,l,c)&&ze.push(g)});let je=new Map;f.forEach((g,y)=>{Ou(je,this.driver,new Set(g),l,Dn)}),ze.forEach(g=>{let y=dt.get(g),E=je.get(g);dt.set(g,new Map([...y?.entries()??[],...E?.entries()??[]]))});let Ks=[],Do=[],Mo={};o.forEach(g=>{let{element:y,player:E,instruction:N}=g;if(s.has(y)){if(u.has(y)){E.onDestroy(()=>Ne(y,N.toStyles)),E.disabled=!0,E.overrideTotalTime(N.totalTime),i.push(E);return}let q=Mo;if(Z.size>1){let ne=y,Me=[];for(;ne=ne.parentNode;){let L=Z.get(ne);if(L){q=L;break}Me.push(ne)}Me.forEach(L=>Z.set(L,q))}let ve=this._buildAnimation(E.namespaceId,N,$,r,je,dt);if(E.setRealPlayer(ve),q===Mo)Ks.push(E);else{let ne=this.playersByElement.get(q);ne&&ne.length&&(E.parentPlayer=Qe(ne)),i.push(E)}}else lt(y,N.fromStyles),E.onDestroy(()=>Ne(y,N.toStyles)),Do.push(E),u.has(y)&&i.push(E)}),Do.forEach(g=>{let y=r.get(g.element);if(y&&y.length){let E=Qe(y);g.setRealPlayer(E)}}),i.forEach(g=>{g.parentPlayer?g.syncPlayerEvents(g.parentPlayer):g.destroy()});for(let g=0;g<w.length;g++){let y=w[g],E=y[ge];if(xt(y,ao),E&&E.hasAnimation)continue;let N=[];if(a.size){let ve=a.get(y);ve&&ve.length&&N.push(...ve);let ne=this.driver.query(y,lo,!0);for(let Me=0;Me<ne.length;Me++){let L=a.get(ne[Me]);L&&L.length&&N.push(...L)}}let q=N.filter(ve=>!ve.destroyed);q.length?wm(this,y,q):this.processLeaveNode(y)}return w.length=0,Ks.forEach(g=>{this.players.push(g),g.onDone(()=>{g.destroy();let y=this.players.indexOf(g);this.players.splice(y,1)}),g.play()}),Ks}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,s,i,r){let o=[];if(t){let a=this.playersByQueriedElement.get(e);a&&(o=a)}else{let a=this.playersByElement.get(e);if(a){let l=!r||r==En;a.forEach(c=>{c.queued||!l&&c.triggerName!=i||o.push(c)})}}return(s||i)&&(o=o.filter(a=>!(s&&s!=a.namespaceId||i&&i!=a.triggerName))),o}_beforeAnimationBuild(e,t,s){let i=t.triggerName,r=t.element,o=t.isRemovalTransition?void 0:e,a=t.isRemovalTransition?void 0:i;for(let l of t.timelines){let c=l.element,u=c!==r,h=le(s,c,[]);this._getPreviousPlayers(c,u,o,a,t.toState).forEach(f=>{let p=f.getRealPlayer();p.beforeDestroy&&p.beforeDestroy(),f.destroy(),h.push(f)})}lt(r,t.fromStyles)}_buildAnimation(e,t,s,i,r,o){let a=t.triggerName,l=t.element,c=[],u=new Set,h=new Set,d=t.timelines.map(p=>{let _=p.element;u.add(_);let w=_[ge];if(w&&w.removedBeforeQueried)return new gt(p.duration,p.delay);let k=_!==l,D=Sm((s.get(_)||_m).map($=>$.getRealPlayer())).filter($=>{let Z=$;return Z.element?Z.element===_:!1}),W=r.get(_),V=o.get(_),ht=Fu(this._normalizer,p.keyframes,W,V),ye=this._buildPlayer(p,ht,D);if(p.subTimeline&&i&&h.add(_),k){let $=new Cn(e,a,_);$.setRealPlayer(ye),c.push($)}return ye});c.forEach(p=>{le(this.playersByQueriedElement,p.element,[]).push(p),p.onDone(()=>ym(this.playersByQueriedElement,p.element,p))}),u.forEach(p=>pe(p,Iu));let f=Qe(d);return f.onDestroy(()=>{u.forEach(p=>xt(p,Iu)),Ne(l,t.toStyles)}),h.forEach(p=>{le(i,p,[]).push(f)}),f}_buildPlayer(e,t,s){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,s):new gt(e.duration,e.delay)}},Cn=class{constructor(e,t,s){this.namespaceId=e,this.triggerName=t,this.element=s,this._player=new gt,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(e){this._containsRealPlayer||(this._player=e,this._queuedCallbacks.forEach((t,s)=>{t.forEach(i=>Co(e,s,void 0,i))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){let t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){le(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return this.queued?!1:this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){let t=this._player;t.triggerCallback&&t.triggerCallback(e)}};function ym(n,e,t){let s=n.get(e);if(s){if(s.length){let i=s.indexOf(t);s.splice(i,1)}s.length==0&&n.delete(e)}return s}function vm(n){return n??null}function As(n){return n&&n.nodeType===1}function Em(n){return n=="start"||n=="done"}function Mu(n,e){let t=n.style.display;return n.style.display=e??"none",t}function Ou(n,e,t,s,i){let r=[];t.forEach(l=>r.push(Mu(l)));let o=[];s.forEach((l,c)=>{let u=new Map;l.forEach(h=>{let d=e.computeStyle(c,h,i);u.set(h,d),(!d||d.length==0)&&(c[ge]=gm,o.push(c))}),n.set(c,u)});let a=0;return t.forEach(l=>Mu(l,r[a++])),o}function xu(n,e){let t=new Map;if(n.forEach(a=>t.set(a,[])),e.length==0)return t;let s=1,i=new Set(e),r=new Map;function o(a){if(!a)return s;let l=r.get(a);if(l)return l;let c=a.parentNode;return t.has(c)?l=c:i.has(c)?l=s:l=o(c),r.set(a,l),l}return e.forEach(a=>{let l=o(a);l!==s&&t.get(l).push(a)}),t}function pe(n,e){n.classList?.add(e)}function xt(n,e){n.classList?.remove(e)}function wm(n,e,t){Qe(t).onDone(()=>n.processLeaveNode(e))}function Sm(n){let e=[];return $u(n,e),e}function $u(n,e){for(let t=0;t<n.length;t++){let s=n[t];s instanceof ri?$u(s.players,e):e.push(s)}}function Tm(n,e){let t=Object.keys(n),s=Object.keys(e);if(t.length!=s.length)return!1;for(let i=0;i<t.length;i++){let r=t[i];if(!e.hasOwnProperty(r)||n[r]!==e[r])return!1}return!0}function Lu(n,e,t){let s=t.get(n);if(!s)return!1;let i=e.get(n);return i?s.forEach(r=>i.add(r)):e.set(n,s),t.delete(n),!0}var Lt=class{constructor(e,t,s){this._driver=t,this._normalizer=s,this._triggerCache={},this.onRemovalComplete=(i,r)=>{},this._transitionEngine=new wo(e.body,t,s),this._timelineEngine=new vo(e.body,t,s),this._transitionEngine.onRemovalComplete=(i,r)=>this.onRemovalComplete(i,r)}registerTrigger(e,t,s,i,r){let o=e+"-"+i,a=this._triggerCache[o];if(!a){let l=[],c=[],u=Qu(this._driver,r,l,c);if(l.length)throw Tp(i,l);c.length&&void 0,a=cm(i,u,this._normalizer),this._triggerCache[o]=a}this._transitionEngine.registerTrigger(t,i,a)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,s,i){this._transitionEngine.insertNode(e,t,s,i)}onRemove(e,t,s){this._transitionEngine.removeNode(e,t,s)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,s,i){if(s.charAt(0)=="@"){let[r,o]=Cu(s),a=i;this._timelineEngine.command(r,t,o,a)}else this._transitionEngine.trigger(e,t,s,i)}listen(e,t,s,i,r){if(s.charAt(0)=="@"){let[o,a]=Cu(s);return this._timelineEngine.listen(o,t,a,r)}return this._transitionEngine.listen(e,t,s,i,r)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(e){this._transitionEngine.afterFlushAnimationsDone(e)}};function Cm(n,e){let t=null,s=null;return Array.isArray(e)&&e.length?(t=oo(e[0]),e.length>1&&(s=oo(e[e.length-1]))):e instanceof Map&&(t=oo(e)),t||s?new So(n,t,s):null}var So=class n{static{this.initialStylesByElement=new WeakMap}constructor(e,t,s){this._element=e,this._startStyles=t,this._endStyles=s,this._state=0;let i=n.initialStylesByElement.get(e);i||n.initialStylesByElement.set(e,i=new Map),this._initialStyles=i}start(){this._state<1&&(this._startStyles&&Ne(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Ne(this._element,this._initialStyles),this._endStyles&&(Ne(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(n.initialStylesByElement.delete(this._element),this._startStyles&&(lt(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(lt(this._element,this._endStyles),this._endStyles=null),Ne(this._element,this._initialStyles),this._state=3)}};function oo(n){let e=null;return n.forEach((t,s)=>{bm(s)&&(e=e||new Map,e.set(s,t))}),e}function bm(n){return n==="display"||n==="position"}var Fs=class{constructor(e,t,s,i){this.element=e,this.keyframes=t,this.options=s,this._specialStyles=i,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=s.duration,this._delay=s.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;let e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:new Map;let t=()=>this._onFinish();this.domPlayer.addEventListener("finish",t),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",t)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(e){let t=[];return e.forEach(s=>{t.push(Object.fromEntries(s))}),t}_triggerWebAnimation(e,t,s){return e.animate(this._convertKeyframesToObject(t),s)}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){this.domPlayer===void 0&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){let e=new Map;this.hasStarted()&&this._finalKeyframe.forEach((s,i)=>{i!=="offset"&&e.set(i,this._finished?s:Po(this.element,i))}),this.currentSnapshot=e}triggerCallback(e){let t=e==="start"?this._onStartFns:this._onDoneFns;t.forEach(s=>s()),t.length=0}},Ws=class{validateStyleProperty(e){return!0}validateAnimatableStyleProperty(e){return!0}containsElement(e,t){return Wu(e,t)}getParentElement(e){return Io(e)}query(e,t,s){return Bu(e,t,s)}computeStyle(e,t,s){return Po(e,t)}animate(e,t,s,i,r,o=[]){let a=i==0?"both":"forwards",l={duration:s,delay:i,fill:a};r&&(l.easing=r);let c=new Map,u=o.filter(f=>f instanceof Fs);zp(s,i)&&u.forEach(f=>{f.currentSnapshot.forEach((p,_)=>c.set(_,p))});let h=Kp(t).map(f=>new Map(f));h=jp(e,h,c);let d=Cm(e,h);return new Fs(e,h,l,d)}};var Ps="@",Hu="@.disabled",Bs=class{constructor(e,t,s,i){this.namespaceId=e,this.delegate=t,this.engine=s,this._onDestroy=i,this.\u0275type=0}get data(){return this.delegate.data}destroyNode(e){this.delegate.destroyNode?.(e)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,s,i=!0){this.delegate.insertBefore(e,t,s),this.engine.onInsert(this.namespaceId,t,e,i)}removeChild(e,t,s){this.parentNode(t)&&this.engine.onRemove(this.namespaceId,t,this.delegate)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,s,i){this.delegate.setAttribute(e,t,s,i)}removeAttribute(e,t,s){this.delegate.removeAttribute(e,t,s)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,s,i){this.delegate.setStyle(e,t,s,i)}removeStyle(e,t,s){this.delegate.removeStyle(e,t,s)}setProperty(e,t,s){t.charAt(0)==Ps&&t==Hu?this.disableAnimations(e,!!s):this.delegate.setProperty(e,t,s)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,s){return this.delegate.listen(e,t,s)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}},To=class extends Bs{constructor(e,t,s,i,r){super(t,s,i,r),this.factory=e,this.namespaceId=t}setProperty(e,t,s){t.charAt(0)==Ps?t.charAt(1)=="."&&t==Hu?(s=s===void 0?!0:!!s,this.disableAnimations(e,s)):this.engine.process(this.namespaceId,e,t.slice(1),s):this.delegate.setProperty(e,t,s)}listen(e,t,s){if(t.charAt(0)==Ps){let i=Im(e),r=t.slice(1),o="";return r.charAt(0)!=Ps&&([r,o]=Nm(r)),this.engine.listen(this.namespaceId,i,r,o,a=>{let l=a._data||-1;this.factory.scheduleListenerCallback(l,s,a)})}return this.delegate.listen(e,t,s)}};function Im(n){switch(n){case"body":return document.body;case"document":return document;case"window":return window;default:return n}}function Nm(n){let e=n.indexOf("."),t=n.substring(0,e),s=n.slice(e+1);return[t,s]}var Us=class{constructor(e,t,s){this.delegate=e,this.engine=t,this._zone=s,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,t.onRemovalComplete=(i,r)=>{r?.removeChild(null,i)}}createRenderer(e,t){let s="",i=this.delegate.createRenderer(e,t);if(!e||!t?.data?.animation){let c=this._rendererCache,u=c.get(i);if(!u){let h=()=>c.delete(i);u=new Bs(s,i,this.engine,h),c.set(i,u)}return u}let r=t.id,o=t.id+"-"+this._currentId;this._currentId++,this.engine.register(o,e);let a=c=>{Array.isArray(c)?c.forEach(a):this.engine.registerTrigger(r,o,e,c.name,c)};return t.data.animation.forEach(a),new To(this,o,i,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(e,t,s){if(e>=0&&e<this._microtaskId){this._zone.run(()=>t(s));return}let i=this._animationCallbacksBuffer;i.length==0&&queueMicrotask(()=>{this._zone.run(()=>{i.forEach(r=>{let[o,a]=r;o(a)}),this._animationCallbacksBuffer=[]})}),i.push([t,s])}end(){this._cdRecurDepth--,this._cdRecurDepth==0&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}};var Pm=(()=>{class n extends Lt{constructor(t,s,i){super(t,s,i)}ngOnDestroy(){this.flush()}static{this.\u0275fac=function(s){return new(s||n)(B(la),B(ct),B(ut))}}static{this.\u0275prov=pt({token:n,factory:n.\u0275fac})}}return n})();function Rm(){return new Ds}function km(n,e,t){return new Us(n,e,t)}var Yu=[{provide:ut,useFactory:Rm},{provide:Lt,useClass:Pm},{provide:Yo,useFactory:km,deps:[da,Lt,In]}],Dm=[{provide:ct,useFactory:()=>new Ws},{provide:Ys,useValue:"BrowserAnimations"},...Yu],N_=[{provide:ct,useClass:No},{provide:Ys,useValue:"NoopAnimations"},...Yu];function Xu(){return Xo("NgEagerAnimations"),[...Dm]}var Ju={apiKey:"AIzaSyAdWLVOkP8pLrNZkELpC8Mm1fVdbkd1kEk",authDomain:"expenses-5d437.firebaseapp.com",projectId:"expenses-5d437",storageBucket:"expenses-5d437.appspot.com",messagingSenderId:"202582971776",appId:"1:202582971776:web:6b55340bb59e17d4565d65"};var Zu={providers:[aa({eventCoalescing:!0}),ma(Su),Go([xa.initializeApp(Ju),za,wu,ja,$a]),Xu(),Ya()]};function Mm(n,e){if(n&1&&(Ae(0,"div",13),He(1,"Logged on user: "),Ae(2,"strong"),He(3),Pe()()),n&2){let t=ta();Xs(3),na(t.user)}}var Vs=class n{constructor(e){this.toastr=e}title="expenses";auth=$s(si);isLoginFormModelOpen=!1;isLoggedIn=$s(si).isLoggedIn();user;logOut(){this.auth.logout().then(()=>{this.toastr.warning("Logged out","User logged out successfully",{timeOut:5e3,positionClass:"toast-top-right",closeButton:!0,progressBar:!0})})}ngOnInit(){this.isLoggedIn.subscribe(e=>{if(e){let t=localStorage.getItem("user");if(t){let s=JSON.parse(t);this.user=s.email,this.toastr.success(this.user,"User logged in successfully",{timeOut:5e3,positionClass:"toast-top-right",closeButton:!0,progressBar:!0})}}})}static \u0275fac=function(t){return new(t||n)(Ho(Ha))};static \u0275cmp=jo({type:n,selectors:[["app-root"]],standalone:!0,features:[sa([Ja]),ia],decls:21,vars:3,consts:[[1,"navbar","navbar-expand-lg","border-bottom","sticky-top","navbar-light","bg-light"],[1,"container-fluid"],["href","#",1,"navbar-brand"],["type","button","data-bs-toggle","collapse","data-bs-target","#navbarSupportedContent","aria-controls","navbarSupportedContent","aria-expanded","false","aria-label","Toggle navigation",1,"navbar-toggler"],[1,"navbar-toggler-icon"],["id","navbarSupportedContent",1,"collapse","navbar-collapse"],[1,"navbar-nav","me-auto","mb-2","mb-lg-0"],[1,"nav-item"],["aria-current","page","href","/",1,"nav-link","active"],["aria-current","page","href","/login",1,"nav-link","active"],["aria-current","page","href","/",1,"nav-link","active",3,"click"],["class","align-items-center",4,"ngIf"],[1,"container","my-4"],[1,"align-items-center"]],template:function(t,s){t&1&&(Ae(0,"nav",0)(1,"div",1)(2,"a",2),He(3,"Expense Tracker"),Pe(),Ae(4,"button",3),Js(5,"span",4),Pe(),Ae(6,"div",5)(7,"ul",6)(8,"li",7)(9,"a",8),He(10,"Home"),Pe()(),Ae(11,"li",7)(12,"a",9),He(13,"Login"),Pe()(),Ae(14,"li",7)(15,"a",10),ea("click",function(){return s.logOut()}),He(16,"Logout"),Pe()()(),Jo(17,Mm,4,1,"div",11),ra(18,"async"),Pe()()(),Ae(19,"div",12),Js(20,"router-outlet"),Pe()),t&2&&(Xs(17),Zo("ngIf",oa(18,1,s.isLoggedIn)))},dependencies:[pa,ha,ca,ua,Xa]})};fa(Vs,Zu).catch(n=>console.error(n));

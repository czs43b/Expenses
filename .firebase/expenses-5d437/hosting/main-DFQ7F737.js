import{a as Av,b as Cv,c as Cl,d as Rv,e as Pv,f as Rl,g as Nv,h as xv,i as Pl,j as ew}from"./chunk-5GOXMGS2.js";import{$ as js,$a as To,$b as tt,Ab as Tv,B as vl,G as wl,H as Ki,Ha as pv,I as av,Ia as vo,Ib as So,J as lv,K as El,L as uv,La as ce,Ma as Ze,O as cv,Oa as gv,P as pe,Pa as _v,Pb as Iv,Q as Rt,Qb as Hi,R as qs,Rb as Al,Sa as yv,Sb as Sv,T as hn,Ta as wo,Tb as zs,V as J,Vb as bv,W as vt,Xa as ft,Yb as Vl,Za as Eo,Zb as Fl,_ as en,_a as Pe,_b as Ll,ab as Ln,ac as Bl,ba as hv,bb as Qi,bc as Ul,c as _l,ca as dv,cb as ee,cc as ql,da as fv,db as X,dc as zv,eb as Pt,ec as jl,f as ri,fb as hd,fc as zl,gb as dd,gc as Gl,h as yl,hb as Wi,hc as Kl,ia as oi,ib as vv,ic as Ql,j as _o,ja as ai,jb as at,jc as Wl,k as yo,kb as We,kc as $l,lb as wv,lc as Hl,ma as Tl,mb as Ev,mc as Yl,nb as ue,nc as Gv,o as Qe,oa as mv,ob as Sl,oc as Bn,pa as Fn,pb as dn,pc as Kv,qb as tn,qc as vd,rb as $i,rc as Qv,sb as Io,sc as Wv,tb as fd,tc as Jl,u as ld,uc as $v,v as ud,va as Il,vc as Hv,wa as cd,wc as Yv,xc as Jv,yb as bl,yc as Xv,zc as Zv}from"./chunk-LENTWRMZ.js";import{A as Lv,B as Bv,C as zt,D as li,E as Dl,F as Ao,G as gd,H as Uv,I as qv,J as Y,K as Nt,L as et,M as _d,N as jv,O as Co,P as he,Q as mn,R as kl,S as yd,T as Gt,U as Ks,V as Ol,W as Ml,Y as Qs,Z as ui,a as xe,b as Zt,c as ov,d as ad,e as D,j as M,k as Gs,l as Dv,m as kv,n as Ov,o as wt,p as Nl,q as bo,r as md,s as Mv,t as fn,u as pd,v as Vv,w as Fv,y as xl,z as $e}from"./chunk-6H46YYVM.js";var tw="@firebase/database",nw="1.0.8";var Df="";function kf(i){Df=i}var Cd=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),$e(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:xl(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var Rd=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return zt(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var kw=function(i){try{if(typeof window<"u"&&typeof window[i]<"u"){let e=window[i];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Cd(e)}}catch{}return new Rd},Ji=kw("localStorage"),Pd=kw("sessionStorage");var Ys=new Ks("@firebase/database"),Ow=function(){let i=1;return function(){return i++}}(),Mw=function(i){let e=jv(i),t=new qv;t.update(e);let n=t.digest();return Dv.encodeByteArray(n)},Jo=function(...i){let e="";for(let t=0;t<i.length;t++){let n=i[t];Array.isArray(n)||n&&typeof n=="object"&&typeof n.length=="number"?e+=Jo.apply(null,n):typeof n=="object"?e+=$e(n):e+=n,e+=" "}return e},Xi=null,iw=!0,Vw=function(i,e){M(!e||i===!0||i===!1,"Can't turn on custom loggers persistently."),i===!0?(Ys.logLevel=Gt.VERBOSE,Xi=Ys.log.bind(Ys),e&&Pd.set("logging_enabled",!0)):typeof i=="function"?Xi=i:(Xi=null,Pd.remove("logging_enabled"))},st=function(...i){if(iw===!0&&(iw=!1,Xi===null&&Pd.get("logging_enabled")===!0&&Vw(!0)),Xi){let e=Jo.apply(null,i);Xi(e)}},Xo=function(i){return function(...e){st(i,...e)}},Nd=function(...i){let e="FIREBASE INTERNAL ERROR: "+Jo(...i);Ys.error(e)},_n=function(...i){let e=`FIREBASE FATAL ERROR: ${Jo(...i)}`;throw Ys.error(e),new Error(e)},mt=function(...i){let e="FIREBASE WARNING: "+Jo(...i);Ys.warn(e)},SA=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&mt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},bu=function(i){return typeof i=="number"&&(i!==i||i===Number.POSITIVE_INFINITY||i===Number.NEGATIVE_INFINITY)},bA=function(i){if(fn()||document.readyState==="complete")i();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,i())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},fi="[MIN_NAME]",Un="[MAX_NAME]",es=function(i,e){if(i===e)return 0;if(i===fi||e===Un)return-1;if(e===fi||i===Un)return 1;{let t=sw(i),n=sw(e);return t!==null?n!==null?t-n===0?i.length-e.length:t-n:-1:n!==null?1:i<e?-1:1}},AA=function(i,e){return i===e?0:i<e?-1:1},Ro=function(i,e){if(e&&i in e)return e[i];throw new Error("Missing required key ("+i+") in object: "+$e(e))},Of=function(i){if(typeof i!="object"||i===null)return $e(i);let e=[];for(let n in i)e.push(n);e.sort();let t="{";for(let n=0;n<e.length;n++)n!==0&&(t+=","),t+=$e(e[n]),t+=":",t+=Of(i[e[n]]);return t+="}",t},Fw=function(i,e){let t=i.length;if(t<=e)return[i];let n=[];for(let s=0;s<t;s+=e)s+e>t?n.push(i.substring(s,t)):n.push(i.substring(s,s+e));return n};function rt(i,e){for(let t in i)i.hasOwnProperty(t)&&e(t,i[t])}var Lw=function(i){M(!bu(i),"Invalid JSON number");let e=11,t=52,n=(1<<e-1)-1,s,r,o,a,u;i===0?(r=0,o=0,s=1/i===-1/0?1:0):(s=i<0,i=Math.abs(i),i>=Math.pow(2,1-n)?(a=Math.min(Math.floor(Math.log(i)/Math.LN2),n),r=a+n,o=Math.round(i*Math.pow(2,t-a)-Math.pow(2,t))):(r=0,o=Math.round(i/Math.pow(2,1-n-t))));let c=[];for(u=t;u;u-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(u=e;u;u-=1)c.push(r%2?1:0),r=Math.floor(r/2);c.push(s?1:0),c.reverse();let d=c.join(""),f="";for(u=0;u<64;u+=8){let p=parseInt(d.substr(u,8),2).toString(16);p.length===1&&(p="0"+p),f=f+p}return f.toLowerCase()},CA=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},RA=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function PA(i,e){let t="Unknown Error";i==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":i==="permission_denied"?t="Client doesn't have permission to access the desired data.":i==="unavailable"&&(t="The service is unavailable");let n=new Error(i+" at "+e._path.toString()+": "+t);return n.code=i.toUpperCase(),n}var NA=new RegExp("^-?(0*)\\d{1,10}$"),xA=-2147483648,DA=2147483647,sw=function(i){if(NA.test(i)){let e=Number(i);if(e>=xA&&e<=DA)return e}return null},rr=function(i){try{i()}catch(e){setTimeout(()=>{let t=e.stack||"";throw mt("Exception was thrown by user callback.",t),e},Math.floor(0))}},kA=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Do=function(i,e){let t=setTimeout(i,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var xd=class{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(n=>this.appCheck=n)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(n=>n.addTokenListener(e))}notifyForInvalidToken(){mt(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var Dd=class{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(st("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',mt(e)}},ko=(()=>{class i{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}i.OWNER="owner";return i})(),Zl="5",Bw="v",Uw="s",qw="r",jw="f",zw=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Gw="ls",Kw="p",kd="ac",Qw="websocket",Ww="long_polling";var eu=class{constructor(e,t,n,s,r=!1,o="",a=!1,u=!1){this.secure=t,this.namespace=n,this.webSocketOnly=s,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ji.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Ji.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function OA(i){return i.host!==i.internalHost||i.isCustomHost()||i.includeNamespaceInQueryParams}function $w(i,e,t){M(typeof e=="string","typeof type must == string"),M(typeof t=="object","typeof params must == object");let n;if(e===Qw)n=(i.secure?"wss://":"ws://")+i.internalHost+"/.ws?";else if(e===Ww)n=(i.secure?"https://":"http://")+i.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);OA(i)&&(t.ns=i.namespace);let s=[];return rt(t,(r,o)=>{s.push(r+"="+o)}),n+s.join("&")}var Od=class{constructor(){this.counters_={}}incrementCounter(e,t=1){zt(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Ov(this.counters_)}};var wd={},Ed={};function Mf(i){let e=i.toString();return wd[e]||(wd[e]=new Od),wd[e]}function MA(i,e){let t=i.toString();return Ed[t]||(Ed[t]=e()),Ed[t]}var Md=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let n=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<n.length;++s)n[s]&&rr(()=>{this.onMessage_(n[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var rw="start",VA="close",FA="pLPCommand",LA="pRTLPCB",Hw="id",Yw="pw",Jw="ser",BA="cb",UA="seg",qA="ts",jA="d",zA="dframe",Xw=1870,Zw=30,GA=Xw-Zw,KA=25e3,QA=3e4,Fo=class i{constructor(e,t,n,s,r,o,a){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=s,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Xo(e),this.stats_=Mf(t),this.urlFn=u=>(this.appCheckToken&&(u[kd]=this.appCheckToken),$w(t,Ww,u))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Md(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(QA)),bA(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Vd((...r)=>{let[o,a,u,c,d]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===rw)this.id=a,this.password=u;else if(o===VA)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{let[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let n={};n[rw]="t",n[Jw]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(n[BA]=this.scriptTagHolder.uniqueCallbackIdentifier),n[Bw]=Zl,this.transportSessionId&&(n[Uw]=this.transportSessionId),this.lastSessionId&&(n[Gw]=this.lastSessionId),this.applicationId&&(n[Kw]=this.applicationId),this.appCheckToken&&(n[kd]=this.appCheckToken),typeof location<"u"&&location.hostname&&zw.test(location.hostname)&&(n[qw]=jw);let s=this.urlFn(n);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){i.forceAllow_=!0}static forceDisallow(){i.forceDisallow_=!0}static isAvailable(){return fn()?!1:i.forceAllow_?!0:!i.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!CA()&&!RA()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=$e(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=kv(t),s=Fw(n,GA);for(let r=0;r<s.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(fn())return;this.myDisconnFrame=document.createElement("iframe");let n={};n[zA]="t",n[Hw]=e,n[Yw]=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=$e(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},Vd=class i{constructor(e,t,n,s){if(this.onDisconnect=n,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,fn())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=Ow(),window[FA+this.uniqueCallbackIdentifier]=e,window[LA+this.uniqueCallbackIdentifier]=t,this.myIFrame=i.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){st("frame writing exception"),a.stack&&st(a.stack),st(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||st("No IE domain setting required")}catch{let n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[Hw]=this.myID,e[Yw]=this.myPW,e[Jw]=this.currentSerial;let t=this.urlFn(e),n="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Zw+n.length<=Xw;){let o=this.pendingSegs.shift();n=n+"&"+UA+s+"="+o.seg+"&"+qA+s+"="+o.ts+"&"+jA+s+"="+o.d,s++}return t=t+n,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(n,Math.floor(KA)),r=()=>{clearTimeout(s),n()};this.addTag(e,r)}addTag(e,t){fn()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){let s=n.readyState;(!s||s==="loaded"||s==="complete")&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{st("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch{}},Math.floor(1))}};var WA=16384,$A=45e3,tu=null;typeof MozWebSocket<"u"?tu=MozWebSocket:typeof WebSocket<"u"&&(tu=WebSocket);var $s=(()=>{class i{constructor(t,n,s,r,o,a,u){this.connId=t,this.applicationId=s,this.appCheckToken=r,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Xo(this.connId),this.stats_=Mf(n),this.connURL=i.connectionURL_(n,a,u,r,s),this.nodeAdmin=n.nodeAdmin}static connectionURL_(t,n,s,r,o){let a={};return a[Bw]=Zl,!fn()&&typeof location<"u"&&location.hostname&&zw.test(location.hostname)&&(a[qw]=jw),n&&(a[Uw]=n),s&&(a[Gw]=s),r&&(a[kd]=r),o&&(a[Kw]=o),$w(t,Qw,a)}open(t,n){this.onDisconnect=n,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ji.set("previous_websocket_failure",!0);try{let s;if(fn()){let r=this.nodeAdmin?"AdminNode":"Node";s={headers:{"User-Agent":`Firebase/${Zl}/${Df}/${process.platform}/${r}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(s.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(s.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(s.proxy={origin:a})}this.mySock=new tu(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");let r=s.message||s.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");let r=s.message||s.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){i.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let n=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(n);s&&s.length>1&&parseFloat(s[1])<4.4&&(t=!0)}return!t&&tu!==null&&!i.forceDisallow_}static previouslyFailed(){return Ji.isInMemoryStorage||Ji.get("previous_websocket_failure")===!0}markConnectionHealthy(){Ji.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let n=this.frames.join("");this.frames=null;let s=xl(n);this.onMessage(s)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(M(this.frames===null,"We already have a frame buffer"),t.length<=6){let n=Number(t);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let n=t.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{let s=this.extractFrameCount_(n);s!==null&&this.appendFrame_(s)}}send(t){this.resetKeepAlive();let n=$e(t);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);let s=Fw(n,WA);s.length>1&&this.sendString_(String(s.length));for(let r=0;r<s.length;r++)this.sendString_(s[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor($A))}sendString_(t){try{this.mySock.send(t)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}i.responsesRequiredToBeHealthy=2,i.healthyTimeout=3e4;return i})(),eE=(()=>{class i{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[Fo,$s]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){let n=$s&&$s.isAvailable(),s=n&&!$s.previouslyFailed();if(t.webSocketOnly&&(n||mt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[$s];else{let r=this.transports_=[];for(let o of i.ALL_TRANSPORTS)o&&o.isAvailable()&&r.push(o);i.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}i.globalTransportInitialized_=!1;return i})(),HA=6e4,YA=5e3,JA=10*1024,XA=100*1024,Td="t",ow="d",ZA="s",aw="r",eC="e",lw="o",uw="a",cw="n",hw="p",tC="h",Fd=class{constructor(e,t,n,s,r,o,a,u,c,d){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=s,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=u,this.onKill_=c,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Xo("c:"+this.id+":"),this.transportManager_=new eE(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));let s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=Do(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>XA?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>JA?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Td in e){let t=e[Td];t===uw?this.upgradeIfSecondaryHealthy_():t===aw?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===lw&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=Ro("t",e),n=Ro("d",e);if(t==="c")this.onSecondaryControl_(n);else if(t==="d")this.pendingDataMessages.push(n);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:hw,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:uw,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:cw,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=Ro("t",e),n=Ro("d",e);t==="c"?this.onControl_(n):t==="d"&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=Ro(Td,e);if(ow in e){let n=e[ow];if(t===tC){let s=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(t===cw){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===ZA?this.onConnectionShutdown_(n):t===aw?this.onReset_(n):t===eC?Nd("Server Error: "+n):t===lw?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Nd("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,n=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Zl!==n&&mt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),Do(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(HA))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Do(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(YA))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:hw,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ji.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var nu=class{put(e,t,n,s){}merge(e,t,n,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}};var iu=class{constructor(e){this.allowedEvents_=e,this.listeners_={},M(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let n=[...this.listeners_[e]];for(let s=0;s<n.length;s++)n[s].callback.apply(n[s].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});let s=this.getInitialEvent(e);s&&t.apply(n,s)}off(e,t,n){this.validateEventType_(e);let s=this.listeners_[e]||[];for(let r=0;r<s.length;r++)if(s[r].callback===t&&(!n||n===s[r].context)){s.splice(r,1);return}}validateEventType_(e){M(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var su=class i extends iu{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!md()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new i}getInitialEvent(e){return M(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var dw=32,fw=768,ve=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let n=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[n]=this.pieces_[s],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function ye(){return new ve("")}function re(i){return i.pieceNum_>=i.pieces_.length?null:i.pieces_[i.pieceNum_]}function mi(i){return i.pieces_.length-i.pieceNum_}function Te(i){let e=i.pieceNum_;return e<i.pieces_.length&&e++,new ve(i.pieces_,e)}function Vf(i){return i.pieceNum_<i.pieces_.length?i.pieces_[i.pieces_.length-1]:null}function nC(i){let e="";for(let t=i.pieceNum_;t<i.pieces_.length;t++)i.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(i.pieces_[t])));return e||"/"}function Lo(i,e=0){return i.pieces_.slice(i.pieceNum_+e)}function tE(i){if(i.pieceNum_>=i.pieces_.length)return null;let e=[];for(let t=i.pieceNum_;t<i.pieces_.length-1;t++)e.push(i.pieces_[t]);return new ve(e,0)}function De(i,e){let t=[];for(let n=i.pieceNum_;n<i.pieces_.length;n++)t.push(i.pieces_[n]);if(e instanceof ve)for(let n=e.pieceNum_;n<e.pieces_.length;n++)t.push(e.pieces_[n]);else{let n=e.split("/");for(let s=0;s<n.length;s++)n[s].length>0&&t.push(n[s])}return new ve(t,0)}function oe(i){return i.pieceNum_>=i.pieces_.length}function Et(i,e){let t=re(i),n=re(e);if(t===null)return e;if(t===n)return Et(Te(i),Te(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+i+")")}function iC(i,e){let t=Lo(i,0),n=Lo(e,0);for(let s=0;s<t.length&&s<n.length;s++){let r=es(t[s],n[s]);if(r!==0)return r}return t.length===n.length?0:t.length<n.length?-1:1}function Ff(i,e){if(mi(i)!==mi(e))return!1;for(let t=i.pieceNum_,n=e.pieceNum_;t<=i.pieces_.length;t++,n++)if(i.pieces_[t]!==e.pieces_[n])return!1;return!0}function Kt(i,e){let t=i.pieceNum_,n=e.pieceNum_;if(mi(i)>mi(e))return!1;for(;t<i.pieces_.length;){if(i.pieces_[t]!==e.pieces_[n])return!1;++t,++n}return!0}var Ld=class{constructor(e,t){this.errorPrefix_=t,this.parts_=Lo(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=Co(this.parts_[n]);nE(this)}};function sC(i,e){i.parts_.length>0&&(i.byteLength_+=1),i.parts_.push(e),i.byteLength_+=Co(e),nE(i)}function rC(i){let e=i.parts_.pop();i.byteLength_-=Co(e),i.parts_.length>0&&(i.byteLength_-=1)}function nE(i){if(i.byteLength_>fw)throw new Error(i.errorPrefix_+"has a key path longer than "+fw+" bytes ("+i.byteLength_+").");if(i.parts_.length>dw)throw new Error(i.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+dw+") or object contains a cycle "+Yi(i))}function Yi(i){return i.parts_.length===0?"":"in property '"+i.parts_.join(".")+"'"}var Bd=class i extends iu{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let n=!document[e];n!==this.visible_&&(this.visible_=n,this.trigger("visible",n))},!1)}static getInstance(){return new i}getInitialEvent(e){return M(e==="visible","Unknown event type: "+e),[this.visible_]}};var Po=1e3,oC=60*5*1e3,mw=30*1e3,aC=1.3,lC=3e4,uC="server_kill",pw=3,Lf=(()=>{class i extends nu{constructor(t,n,s,r,o,a,u,c){if(super(),this.repoInfo_=t,this.applicationId_=n,this.onDataUpdate_=s,this.onConnectStatus_=r,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=u,this.authOverride_=c,this.id=i.nextPersistentConnectionId_++,this.log_=Xo("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Po,this.maxReconnectDelay_=oC,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!fn())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Bd.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&su.getInstance().on("online",this.onOnline_,this)}sendRequest(t,n,s){let r=++this.requestNumber_,o={r,a:t,b:n};this.log_($e(o)),M(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),s&&(this.requestCBHash_[r]=s)}get(t){this.initConnection_();let n=new wt,r={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let u=a.d;a.s==="ok"?n.resolve(u):n.reject(u)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),n.promise}listen(t,n,s,r){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),M(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),M(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let u={onComplete:r,hashFn:n,query:t,tag:s};this.listens.get(a).set(o,u),this.connected_&&this.sendListen_(u)}sendGet_(t){let n=this.outstandingGets_[t];this.sendRequest("g",n.request,s=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(s)})}sendListen_(t){let n=t.query,s=n._path.toString(),r=n._queryIdentifier;this.log_("Listen on "+s+" for "+r);let o={p:s},a="q";t.tag&&(o.q=n._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,u=>{let c=u.d,d=u.s;i.warnOnListenWarnings_(c,n),(this.listens.get(s)&&this.listens.get(s).get(r))===t&&(this.log_("listen response",u),d!=="ok"&&this.removeListen_(s,r),t.onComplete&&t.onComplete(d,c))})}static warnOnListenWarnings_(t,n){if(t&&typeof t=="object"&&zt(t,"w")){let s=li(t,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){let r='".indexOn": "'+n._queryParams.getIndex().toString()+'"',o=n._path.toString();mt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||Bv(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=mw)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,n=Lv(t)?"auth":"gauth",s={cred:t};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(n,s,r=>{let o=r.s,a=r.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let n=t.s,s=t.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,s)})}unlisten(t,n){let s=t._path.toString(),r=t._queryIdentifier;this.log_("Unlisten called for "+s+" "+r),M(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,r)&&this.connected_&&this.sendUnlisten_(s,r,t._queryObject,n)}sendUnlisten_(t,n,s,r){this.log_("Unlisten on "+t+" for "+n);let o={p:t},a="n";r&&(o.q=s,o.t=r),this.sendRequest(a,o)}onDisconnectPut(t,n,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,n,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:n,onComplete:s})}onDisconnectMerge(t,n,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,n,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:n,onComplete:s})}onDisconnectCancel(t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(t,n,s,r){let o={p:n,d:s};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{r&&setTimeout(()=>{r(a.s,a.d)},Math.floor(0))})}put(t,n,s,r){this.putInternal("p",t,n,s,r)}merge(t,n,s,r){this.putInternal("m",t,n,s,r)}putInternal(t,n,s,r,o){this.initConnection_();let a={p:n,d:s};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:r}),this.outstandingPutCount_++;let u=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(u):this.log_("Buffering put: "+n)}sendPut_(t){let n=this.outstandingPuts_[t].action,s=this.outstandingPuts_[t].request,r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,s,o=>{this.log_(n+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(o.s,o.d)})}reportStats(t){if(this.connected_){let n={c:t};this.log_("reportStats",n),this.sendRequest("s",n,s=>{if(s.s!=="ok"){let o=s.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+$e(t));let n=t.r,s=this.requestCBHash_[n];s&&(delete this.requestCBHash_[n],s(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,n){this.log_("handleServerMessage",t,n),t==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):t==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):t==="c"?this.onListenRevoked_(n.p,n.q):t==="ac"?this.onAuthRevoked_(n.s,n.d):t==="apc"?this.onAppCheckRevoked_(n.s,n.d):t==="sd"?this.onSecurityDebugPacket_(n):Nd("Unrecognized action received from server: "+$e(t)+`
Are you using the latest client?`)}onReady_(t,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){M(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Po,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=Po,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>lC&&(this.reconnectDelay_=Po),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=new Date().getTime()-this.lastConnectionAttemptTime_,n=Math.max(0,this.reconnectDelay_-t);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*aC)}this.onConnectStatus_(!1)}establishConnection_(){return D(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+i.nextConnectionId_++,o=this.lastSessionId,a=!1,u=null,c=function(){u?u.close():(a=!0,s())},d=function(p){M(u,"sendRequest call when we're not connected not allowed."),u.sendRequest(p)};this.realtime_={close:c,sendRequest:d};let f=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[p,_]=yield Promise.all([this.authTokenProvider_.getToken(f),this.appCheckTokenProvider_.getToken(f)]);a?st("getToken() completed but was canceled"):(st("getToken() completed. Creating connection."),this.authToken_=p&&p.accessToken,this.appCheckToken_=_&&_.token,u=new Fd(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,n,s,E=>{mt(E+" ("+this.repoInfo_.toString()+")"),this.interrupt(uC)},o))}catch(p){this.log_("Failed to get token: "+p),a||(this.repoInfo_.nodeAdmin&&mt(p),c())}}})}interrupt(t){st("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){st("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Dl(this.interruptReasons_)&&(this.reconnectDelay_=Po,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let n=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let n=this.outstandingPuts_[t];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,n){let s;n?s=n.map(o=>Of(o)).join("$"):s="default";let r=this.removeListen_(t,s);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(t,n){let s=new ve(t).toString(),r;if(this.listens.has(s)){let o=this.listens.get(s);r=o.get(n),o.delete(n),o.size===0&&this.listens.delete(s)}else r=void 0;return r}onAuthRevoked_(t,n){st("Auth token revoked: "+t+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=pw&&(this.reconnectDelay_=mw,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,n){st("App check token revoked: "+t+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=pw&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let n of t.values())this.sendListen_(n);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},n="js";fn()&&(this.repoInfo_.nodeAdmin?n="admin_node":n="node"),t["sdk."+n+"."+Df.replace(/\./g,"-")]=1,md()?t["framework.cordova"]=1:Mv()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=su.getInstance().currentlyOnline();return Dl(this.interruptReasons_)&&t}}i.nextPersistentConnectionId_=0,i.nextConnectionId_=0;return i})(),ae=class i{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new i(e,t)}};var Js=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let n=new ae(fi,e),s=new ae(fi,t);return this.compare(n,s)!==0}minPost(){return ae.MIN}};var Xl,ru=class extends Js{static get __EMPTY_NODE(){return Xl}static set __EMPTY_NODE(e){Xl=e}compare(e,t){return es(e.name,t.name)}isDefinedOn(e){throw Gs("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return ae.MIN}maxPost(){return new ae(Un,Xl)}makePost(e,t){return M(typeof e=="string","KeyIndex indexValue must always be a string."),new ae(e,Xl)}toString(){return".key"}},gn=new ru;var Hs=class{constructor(e,t,n,s,r=null){this.isReverse_=s,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?n(e.key,t):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},nn=(()=>{class i{constructor(t,n,s,r,o){this.key=t,this.value=n,this.color=s??i.RED,this.left=r??Qt.EMPTY_NODE,this.right=o??Qt.EMPTY_NODE}copy(t,n,s,r,o){return new i(t??this.key,n??this.value,s??this.color,r??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,n,s){let r=this,o=s(t,r.key);return o<0?r=r.copy(null,null,null,r.left.insert(t,n,s),null):o===0?r=r.copy(null,n,null,null,null):r=r.copy(null,null,null,null,r.right.insert(t,n,s)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return Qt.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,n){let s,r;if(s=this,n(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(t,n),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),n(t,s.key)===0){if(s.right.isEmpty())return Qt.EMPTY_NODE;r=s.right.min_(),s=s.copy(r.key,r.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(t,n))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,i.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,i.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,n)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return i.RED=!0,i.BLACK=!1,i})(),Ud=class{copy(e,t,n,s,r){return this}insert(e,t,n){return new nn(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},Qt=class i{constructor(e,t=i.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new i(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,nn.BLACK,null,null))}remove(e){return new i(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,nn.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),t===0)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,s=null;for(;!n.isEmpty();)if(t=this.comparator_(e,n.key),t===0){if(n.left.isEmpty())return s?s.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}else t<0?n=n.left:t>0&&(s=n,n=n.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Hs(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Hs(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Hs(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Hs(this.root_,null,this.comparator_,!0,e)}};Qt.EMPTY_NODE=new Ud;function cC(i,e){return es(i.name,e.name)}function Bf(i,e){return es(i,e)}var qd;function hC(i){qd=i}var iE=function(i){return typeof i=="number"?"number:"+Lw(i):"string:"+i},sE=function(i){if(i.isLeafNode()){let e=i.val();M(typeof e=="string"||typeof e=="number"||typeof e=="object"&&zt(e,".sv"),"Priority must be a string or number.")}else M(i===qd||i.isEmpty(),"priority of unexpected type.");M(i===qd||i.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var gw,Xs=(()=>{class i{constructor(t,n=i.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=n,this.lazyHash_=null,M(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),sE(this.priorityNode_)}static set __childrenNodeConstructor(t){gw=t}static get __childrenNodeConstructor(){return gw}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new i(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:i.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return oe(t)?this:re(t)===".priority"?this.priorityNode_:i.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,n){return null}updateImmediateChild(t,n){return t===".priority"?this.updatePriority(n):n.isEmpty()&&t!==".priority"?this:i.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)}updateChild(t,n){let s=re(t);return s===null?n:n.isEmpty()&&s!==".priority"?this:(M(s!==".priority"||mi(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,i.__childrenNodeConstructor.EMPTY_NODE.updateChild(Te(t),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,n){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+iE(this.priorityNode_.val())+":");let n=typeof this.value_;t+=n+":",n==="number"?t+=Lw(this.value_):t+=this.value_,this.lazyHash_=Mw(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===i.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof i.__childrenNodeConstructor?-1:(M(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let n=typeof t.value_,s=typeof this.value_,r=i.VALUE_TYPE_ORDER.indexOf(n),o=i.VALUE_TYPE_ORDER.indexOf(s);return M(r>=0,"Unknown leaf type: "+n),M(o>=0,"Unknown leaf type: "+s),r===o?s==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-r}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let n=t;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}i.VALUE_TYPE_ORDER=["object","boolean","number","string"];return i})(),rE,oE;function dC(i){rE=i}function fC(i){oE=i}var jd=class extends Js{compare(e,t){let n=e.node.getPriority(),s=t.node.getPriority(),r=n.compareTo(s);return r===0?es(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return ae.MIN}maxPost(){return new ae(Un,new Xs("[PRIORITY-POST]",oE))}makePost(e,t){let n=rE(e);return new ae(t,new Xs("[PRIORITY-POST]",n))}toString(){return".priority"}},Se=new jd;var mC=Math.log(2),zd=class{constructor(e){let t=r=>parseInt(Math.log(r)/mC,10),n=r=>parseInt(Array(r+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let s=n(this.count);this.bits_=e+1&s}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},ou=function(i,e,t,n){i.sort(e);let s=function(u,c){let d=c-u,f,p;if(d===0)return null;if(d===1)return f=i[u],p=t?t(f):f,new nn(p,f.node,nn.BLACK,null,null);{let _=parseInt(d/2,10)+u,E=s(u,_),S=s(_+1,c);return f=i[_],p=t?t(f):f,new nn(p,f.node,nn.BLACK,E,S)}},r=function(u){let c=null,d=null,f=i.length,p=function(E,S){let R=f-E,V=f;f-=E;let B=s(R+1,V),F=i[R],K=t?t(F):F;_(new nn(K,F.node,S,null,B))},_=function(E){c?(c.left=E,c=E):(d=E,c=E)};for(let E=0;E<u.count;++E){let S=u.nextBitIsOne(),R=Math.pow(2,u.count-(E+1));S?p(R,nn.BLACK):(p(R,nn.BLACK),p(R,nn.RED))}return d},o=new zd(i.length),a=r(o);return new Qt(n||e,a)};var Id,Ws={},Zs=class i{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return M(Ws&&Se,"ChildrenNode.ts has not been loaded"),Id=Id||new i({".priority":Ws},{".priority":Se}),Id}get(e){let t=li(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Qt?t:null}hasIndex(e){return zt(this.indexSet_,e.toString())}addIndex(e,t){M(e!==gn,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let n=[],s=!1,r=t.getIterator(ae.Wrap),o=r.getNext();for(;o;)s=s||e.isDefinedOn(o.node),n.push(o),o=r.getNext();let a;s?a=ou(n,e.getCompare()):a=Ws;let u=e.toString(),c=Object.assign({},this.indexSet_);c[u]=e;let d=Object.assign({},this.indexes_);return d[u]=a,new i(d,c)}addToIndexes(e,t){let n=Ao(this.indexes_,(s,r)=>{let o=li(this.indexSet_,r);if(M(o,"Missing index implementation for "+r),s===Ws)if(o.isDefinedOn(e.node)){let a=[],u=t.getIterator(ae.Wrap),c=u.getNext();for(;c;)c.name!==e.name&&a.push(c),c=u.getNext();return a.push(e),ou(a,o.getCompare())}else return Ws;else{let a=t.get(e.name),u=s;return a&&(u=u.remove(new ae(e.name,a))),u.insert(e,e.node)}});return new i(n,this.indexSet_)}removeFromIndexes(e,t){let n=Ao(this.indexes_,s=>{if(s===Ws)return s;{let r=t.get(e.name);return r?s.remove(new ae(e.name,r)):s}});return new i(n,this.indexSet_)}};var No,te=(()=>{class i{constructor(t,n,s){this.children_=t,this.priorityNode_=n,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&sE(this.priorityNode_),this.children_.isEmpty()&&M(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return No||(No=new i(new Qt(Bf),null,Zs.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||No}updatePriority(t){return this.children_.isEmpty()?this:new i(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let n=this.children_.get(t);return n===null?No:n}}getChild(t){let n=re(t);return n===null?this:this.getImmediateChild(n).getChild(Te(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,n){if(M(n,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(n);{let s=new ae(t,n),r,o;n.isEmpty()?(r=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(s,this.children_)):(r=this.children_.insert(t,n),o=this.indexMap_.addToIndexes(s,this.children_));let a=r.isEmpty()?No:this.priorityNode_;return new i(r,a,o)}}updateChild(t,n){let s=re(t);if(s===null)return n;{M(re(t)!==".priority"||mi(t)===1,".priority must be the last token in a path");let r=this.getImmediateChild(s).updateChild(Te(t),n);return this.updateImmediateChild(s,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let n={},s=0,r=0,o=!0;if(this.forEachChild(Se,(a,u)=>{n[a]=u.val(t),s++,o&&i.INTEGER_REGEXP_.test(a)?r=Math.max(r,Number(a)):o=!1}),!t&&o&&r<2*s){let a=[];for(let u in n)a[u]=n[u];return a}else return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+iE(this.getPriority().val())+":"),this.forEachChild(Se,(n,s)=>{let r=s.hash();r!==""&&(t+=":"+n+":"+r)}),this.lazyHash_=t===""?"":Mw(t)}return this.lazyHash_}getPredecessorChildName(t,n,s){let r=this.resolveIndex_(s);if(r){let o=r.getPredecessorKey(new ae(t,n));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let n=this.resolveIndex_(t);if(n){let s=n.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(t){let n=this.getFirstChildName(t);return n?new ae(n,this.children_.get(n)):null}getLastChildName(t){let n=this.resolveIndex_(t);if(n){let s=n.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(t){let n=this.getLastChildName(t);return n?new ae(n,this.children_.get(n)):null}forEachChild(t,n){let s=this.resolveIndex_(t);return s?s.inorderTraversal(r=>n(r.name,r.node)):this.children_.inorderTraversal(n)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,n){let s=this.resolveIndex_(n);if(s)return s.getIteratorFrom(t,r=>r);{let r=this.children_.getIteratorFrom(t.name,ae.Wrap),o=r.peek();for(;o!=null&&n.compare(o,t)<0;)r.getNext(),o=r.peek();return r}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,n){let s=this.resolveIndex_(n);if(s)return s.getReverseIteratorFrom(t,r=>r);{let r=this.children_.getReverseIteratorFrom(t.name,ae.Wrap),o=r.peek();for(;o!=null&&n.compare(o,t)>0;)r.getNext(),o=r.peek();return r}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Zo?-1:0}withIndex(t){if(t===gn||this.indexMap_.hasIndex(t))return this;{let n=this.indexMap_.addIndex(t,this.children_);return new i(this.children_,this.priorityNode_,n)}}isIndexed(t){return t===gn||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let n=t;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){let s=this.getIterator(Se),r=n.getIterator(Se),o=s.getNext(),a=r.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=s.getNext(),a=r.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===gn?null:this.indexMap_.get(t.toString())}}return i.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,i})(),Gd=class extends te{constructor(){super(new Qt(Bf),te.EMPTY_NODE,Zs.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return te.EMPTY_NODE}isEmpty(){return!1}},Zo=new Gd;Object.defineProperties(ae,{MIN:{value:new ae(fi,te.EMPTY_NODE)},MAX:{value:new ae(Un,Zo)}});ru.__EMPTY_NODE=te.EMPTY_NODE;Xs.__childrenNodeConstructor=te;hC(Zo);fC(Zo);var pC=!0;function Oe(i,e=null){if(i===null)return te.EMPTY_NODE;if(typeof i=="object"&&".priority"in i&&(e=i[".priority"]),M(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof i=="object"&&".value"in i&&i[".value"]!==null&&(i=i[".value"]),typeof i!="object"||".sv"in i){let t=i;return new Xs(t,Oe(e))}if(!(i instanceof Array)&&pC){let t=[],n=!1;if(rt(i,(o,a)=>{if(o.substring(0,1)!=="."){let u=Oe(a);u.isEmpty()||(n=n||!u.getPriority().isEmpty(),t.push(new ae(o,u)))}}),t.length===0)return te.EMPTY_NODE;let r=ou(t,cC,o=>o.name,Bf);if(n){let o=ou(t,Se.getCompare());return new te(r,Oe(e),new Zs({".priority":o},{".priority":Se}))}else return new te(r,Oe(e),Zs.Default)}else{let t=te.EMPTY_NODE;return rt(i,(n,s)=>{if(zt(i,n)&&n.substring(0,1)!=="."){let r=Oe(s);(r.isLeafNode()||!r.isEmpty())&&(t=t.updateImmediateChild(n,r))}}),t.updatePriority(Oe(e))}}dC(Oe);var Bo=class extends Js{constructor(e){super(),this.indexPath_=e,M(!oe(e)&&re(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let n=this.extractChild(e.node),s=this.extractChild(t.node),r=n.compareTo(s);return r===0?es(e.name,t.name):r}makePost(e,t){let n=Oe(e),s=te.EMPTY_NODE.updateChild(this.indexPath_,n);return new ae(t,s)}maxPost(){let e=te.EMPTY_NODE.updateChild(this.indexPath_,Zo);return new ae(Un,e)}toString(){return Lo(this.indexPath_,0).join("/")}};var Kd=class extends Js{compare(e,t){let n=e.node.compareTo(t.node);return n===0?es(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return ae.MIN}maxPost(){return ae.MAX}makePost(e,t){let n=Oe(e);return new ae(t,n)}toString(){return".value"}},Uf=new Kd;function aE(i){return{type:"value",snapshotNode:i}}function er(i,e){return{type:"child_added",snapshotNode:e,childName:i}}function Uo(i,e){return{type:"child_removed",snapshotNode:e,childName:i}}function qo(i,e,t){return{type:"child_changed",snapshotNode:e,childName:i,oldSnap:t}}function gC(i,e){return{type:"child_moved",snapshotNode:e,childName:i}}var jo=class{constructor(e){this.index_=e}updateChild(e,t,n,s,r,o){M(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(s).equals(n.getChild(s))&&a.isEmpty()===n.isEmpty()||(o!=null&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(Uo(t,a)):M(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(er(t,n)):o.trackChildChange(qo(t,n,a))),e.isLeafNode()&&n.isEmpty())?e:e.updateImmediateChild(t,n).withIndex(this.index_)}updateFullNode(e,t,n){return n!=null&&(e.isLeafNode()||e.forEachChild(Se,(s,r)=>{t.hasChild(s)||n.trackChildChange(Uo(s,r))}),t.isLeafNode()||t.forEachChild(Se,(s,r)=>{if(e.hasChild(s)){let o=e.getImmediateChild(s);o.equals(r)||n.trackChildChange(qo(s,r,o))}else n.trackChildChange(er(s,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?te.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var au=class i{constructor(e){this.indexedFilter_=new jo(e.getIndex()),this.index_=e.getIndex(),this.startPost_=i.getStartPost_(e),this.endPost_=i.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,s,r,o){return this.matches(new ae(t,n))||(n=te.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,s,r,o)}updateFullNode(e,t,n){t.isLeafNode()&&(t=te.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(te.EMPTY_NODE);let r=this;return t.forEachChild(Se,(o,a)=>{r.matches(new ae(o,a))||(s=s.updateImmediateChild(o,te.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var Qd=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let n=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?n<=0:n<0},this.withinEndPost=t=>{let n=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?n<=0:n<0},this.rangedFilter_=new au(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,s,r,o){return this.rangedFilter_.matches(new ae(t,n))||(n=te.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,s,r,o):this.fullLimitUpdateChild_(e,t,n,r,o)}updateFullNode(e,t,n){let s;if(t.isLeafNode()||t.isEmpty())s=te.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){s=te.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){let a=r.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=t.withIndex(this.index_),s=s.updatePriority(te.EMPTY_NODE);let r;this.reverse_?r=s.getReverseIterator(this.index_):r=s.getIterator(this.index_);let o=0;for(;r.hasNext();){let a=r.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,te.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,s,r){let o;if(this.reverse_){let f=this.index_.getCompare();o=(p,_)=>f(_,p)}else o=this.index_.getCompare();let a=e;M(a.numChildren()===this.limit_,"");let u=new ae(t,n),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),d=this.rangedFilter_.matches(u);if(a.hasChild(t)){let f=a.getImmediateChild(t),p=s.getChildAfterChild(this.index_,c,this.reverse_);for(;p!=null&&(p.name===t||a.hasChild(p.name));)p=s.getChildAfterChild(this.index_,p,this.reverse_);let _=p==null?1:o(p,u);if(d&&!n.isEmpty()&&_>=0)return r?.trackChildChange(qo(t,n,f)),a.updateImmediateChild(t,n);{r?.trackChildChange(Uo(t,f));let S=a.updateImmediateChild(t,te.EMPTY_NODE);return p!=null&&this.rangedFilter_.matches(p)?(r?.trackChildChange(er(p.name,p.node)),S.updateImmediateChild(p.name,p.node)):S}}else return n.isEmpty()?e:d&&o(c,u)>=0?(r!=null&&(r.trackChildChange(Uo(c.name,c.node)),r.trackChildChange(er(t,n))),a.updateImmediateChild(t,n).updateImmediateChild(c.name,te.EMPTY_NODE)):e}};var zo=class i{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Se}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return M(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return M(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:fi}hasEnd(){return this.endSet_}getIndexEndValue(){return M(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return M(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Un}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return M(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Se}copy(){let e=new i;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function _C(i){return i.loadsAllData()?new jo(i.getIndex()):i.hasLimit()?new Qd(i):new au(i)}function yC(i,e){let t=i.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function vC(i,e){let t=i.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function Wd(i,e,t){let n=i.copy();return n.startSet_=!0,e===void 0&&(e=null),n.indexStartValue_=e,t!=null?(n.startNameSet_=!0,n.indexStartName_=t):(n.startNameSet_=!1,n.indexStartName_=""),n}function wC(i,e,t){let n;return i.index_===gn||t?n=Wd(i,e,t):n=Wd(i,e,Un),n.startAfterSet_=!0,n}function $d(i,e,t){let n=i.copy();return n.endSet_=!0,e===void 0&&(e=null),n.indexEndValue_=e,t!==void 0?(n.endNameSet_=!0,n.indexEndName_=t):(n.endNameSet_=!1,n.indexEndName_=""),n}function EC(i,e,t){let n;return i.index_===gn||t?n=$d(i,e,t):n=$d(i,e,fi),n.endBeforeSet_=!0,n}function Au(i,e){let t=i.copy();return t.index_=e,t}function _w(i){let e={};if(i.isDefault())return e;let t;if(i.index_===Se?t="$priority":i.index_===Uf?t="$value":i.index_===gn?t="$key":(M(i.index_ instanceof Bo,"Unrecognized index type!"),t=i.index_.toString()),e.orderBy=$e(t),i.startSet_){let n=i.startAfterSet_?"startAfter":"startAt";e[n]=$e(i.indexStartValue_),i.startNameSet_&&(e[n]+=","+$e(i.indexStartName_))}if(i.endSet_){let n=i.endBeforeSet_?"endBefore":"endAt";e[n]=$e(i.indexEndValue_),i.endNameSet_&&(e[n]+=","+$e(i.indexEndName_))}return i.limitSet_&&(i.isViewFromLeft()?e.limitToFirst=i.limit_:e.limitToLast=i.limit_),e}function yw(i){let e={};if(i.startSet_&&(e.sp=i.indexStartValue_,i.startNameSet_&&(e.sn=i.indexStartName_),e.sin=!i.startAfterSet_),i.endSet_&&(e.ep=i.indexEndValue_,i.endNameSet_&&(e.en=i.indexEndName_),e.ein=!i.endBeforeSet_),i.limitSet_){e.l=i.limit_;let t=i.viewFrom_;t===""&&(i.isViewFromLeft()?t="l":t="r"),e.vf=t}return i.index_!==Se&&(e.i=i.index_.toString()),e}var Hd=class i extends nu{constructor(e,t,n,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=s,this.log_=Xo("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(M(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,s){let r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);let o=i.getListenId_(e,n),a={};this.listens_[o]=a;let u=_w(e._queryParams);this.restRequest_(r+".json",u,(c,d)=>{let f=d;if(c===404&&(f=null,c=null),c===null&&this.onDataUpdate_(r,f,!1,n),li(this.listens_,o)===a){let p;c?c===401?p="permission_denied":p="rest_error:"+c:p="ok",s(p,null)}})}unlisten(e,t){let n=i.getListenId_(e,t);delete this.listens_[n]}get(e){let t=_w(e._queryParams),n=e._path.toString(),s=new wt;return this.restRequest_(n+".json",t,(r,o)=>{let a=o;r===404&&(a=null,r=null),r===null?(this.onDataUpdate_(n,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,r])=>{s&&s.accessToken&&(t.auth=s.accessToken),r&&r.token&&(t.ac=r.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Uv(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(n&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let u=null;if(a.status>=200&&a.status<300){try{u=xl(a.responseText)}catch{mt("Failed to parse JSON response for "+o+": "+a.responseText)}n(null,u)}else a.status!==401&&a.status!==404&&mt("Got unsuccessful REST response for "+o+" Status: "+a.status),n(a.status);n=null}},a.open("GET",o,!0),a.send()})}};var Yd=class{constructor(){this.rootNode_=te.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function lu(){return{value:null,children:new Map}}function or(i,e,t){if(oe(e))i.value=t,i.children.clear();else if(i.value!==null)i.value=i.value.updateChild(e,t);else{let n=re(e);i.children.has(n)||i.children.set(n,lu());let s=i.children.get(n);e=Te(e),or(s,e,t)}}function Jd(i,e){if(oe(e))return i.value=null,i.children.clear(),!0;if(i.value!==null){if(i.value.isLeafNode())return!1;{let t=i.value;return i.value=null,t.forEachChild(Se,(n,s)=>{or(i,new ve(n),s)}),Jd(i,e)}}else if(i.children.size>0){let t=re(e);return e=Te(e),i.children.has(t)&&Jd(i.children.get(t),e)&&i.children.delete(t),i.children.size===0}else return!0}function Xd(i,e,t){i.value!==null?t(e,i.value):TC(i,(n,s)=>{let r=new ve(e.toString()+"/"+n);Xd(s,r,t)})}function TC(i,e){i.children.forEach((t,n)=>{e(n,t)})}var Zd=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&rt(this.last_,(n,s)=>{t[n]=t[n]-s}),this.last_=e,t}};var vw=10*1e3,IC=30*1e3,SC=5*60*1e3,ef=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Zd(e);let n=vw+(IC-vw)*Math.random();Do(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){let e=this.statsListener_.get(),t={},n=!1;rt(e,(s,r)=>{r>0&&zt(this.statsToReport_,s)&&(t[s]=r,n=!0)}),n&&this.server_.reportStats(t),Do(this.reportStats_.bind(this),Math.floor(Math.random()*2*SC))}};var pn=function(i){return i[i.OVERWRITE=0]="OVERWRITE",i[i.MERGE=1]="MERGE",i[i.ACK_USER_WRITE=2]="ACK_USER_WRITE",i[i.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",i}(pn||{});function qf(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function jf(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function zf(i){return{fromUser:!1,fromServer:!0,queryId:i,tagged:!0}}var tf=class i{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=pn.ACK_USER_WRITE,this.source=qf()}operationForChild(e){if(oe(this.path)){if(this.affectedTree.value!=null)return M(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new ve(e));return new i(ye(),t,this.revert)}}else return M(re(this.path)===e,"operationForChild called for unrelated child."),new i(Te(this.path),this.affectedTree,this.revert)}};var uu=class i{constructor(e,t){this.source=e,this.path=t,this.type=pn.LISTEN_COMPLETE}operationForChild(e){return oe(this.path)?new i(this.source,ye()):new i(this.source,Te(this.path))}};var tr=class i{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=pn.OVERWRITE}operationForChild(e){return oe(this.path)?new i(this.source,ye(),this.snap.getImmediateChild(e)):new i(this.source,Te(this.path),this.snap)}};var Go=class i{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=pn.MERGE}operationForChild(e){if(oe(this.path)){let t=this.children.subtree(new ve(e));return t.isEmpty()?null:t.value?new tr(this.source,ye(),t.value):new i(this.source,ye(),t)}else return M(re(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new i(this.source,Te(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var yn=class{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(oe(e))return this.isFullyInitialized()&&!this.filtered_;let t=re(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var nf=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function bC(i,e,t,n){let s=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&i.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(gC(o.childName,o.snapshotNode))}),xo(i,s,"child_removed",e,n,t),xo(i,s,"child_added",e,n,t),xo(i,s,"child_moved",r,n,t),xo(i,s,"child_changed",e,n,t),xo(i,s,"value",e,n,t),s}function xo(i,e,t,n,s,r){let o=n.filter(a=>a.type===t);o.sort((a,u)=>CC(i,a,u)),o.forEach(a=>{let u=AC(i,a,r);s.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(u,i.query_))})})}function AC(i,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,i.index_)),e}function CC(i,e,t){if(e.childName==null||t.childName==null)throw Gs("Should only compare child_ events.");let n=new ae(e.childName,e.snapshotNode),s=new ae(t.childName,t.snapshotNode);return i.index_.compare(n,s)}function Cu(i,e){return{eventCache:i,serverCache:e}}function Oo(i,e,t,n){return Cu(new yn(e,t,n),i.serverCache)}function lE(i,e,t,n){return Cu(i.eventCache,new yn(e,t,n))}function cu(i){return i.eventCache.isFullyInitialized()?i.eventCache.getNode():null}function Zi(i){return i.serverCache.isFullyInitialized()?i.serverCache.getNode():null}var Sd,RC=()=>(Sd||(Sd=new Qt(AA)),Sd),Tt=class i{constructor(e,t=RC()){this.value=e,this.children=t}static fromObject(e){let t=new i(null);return rt(e,(n,s)=>{t=t.set(new ve(n),s)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:ye(),value:this.value};if(oe(e))return null;{let n=re(e),s=this.children.get(n);if(s!==null){let r=s.findRootMostMatchingPathAndValue(Te(e),t);return r!=null?{path:De(new ve(n),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(oe(e))return this;{let t=re(e),n=this.children.get(t);return n!==null?n.subtree(Te(e)):new i(null)}}set(e,t){if(oe(e))return new i(t,this.children);{let n=re(e),r=(this.children.get(n)||new i(null)).set(Te(e),t),o=this.children.insert(n,r);return new i(this.value,o)}}remove(e){if(oe(e))return this.children.isEmpty()?new i(null):new i(null,this.children);{let t=re(e),n=this.children.get(t);if(n){let s=n.remove(Te(e)),r;return s.isEmpty()?r=this.children.remove(t):r=this.children.insert(t,s),this.value===null&&r.isEmpty()?new i(null):new i(this.value,r)}else return this}}get(e){if(oe(e))return this.value;{let t=re(e),n=this.children.get(t);return n?n.get(Te(e)):null}}setTree(e,t){if(oe(e))return t;{let n=re(e),r=(this.children.get(n)||new i(null)).setTree(Te(e),t),o;return r.isEmpty()?o=this.children.remove(n):o=this.children.insert(n,r),new i(this.value,o)}}fold(e){return this.fold_(ye(),e)}fold_(e,t){let n={};return this.children.inorderTraversal((s,r)=>{n[s]=r.fold_(De(e,s),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,ye(),t)}findOnPath_(e,t,n){let s=this.value?n(t,this.value):!1;if(s)return s;if(oe(e))return null;{let r=re(e),o=this.children.get(r);return o?o.findOnPath_(Te(e),De(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,ye(),t)}foreachOnPath_(e,t,n){if(oe(e))return this;{this.value&&n(t,this.value);let s=re(e),r=this.children.get(s);return r?r.foreachOnPath_(Te(e),De(t,s),n):new i(null)}}foreach(e){this.foreach_(ye(),e)}foreach_(e,t){this.children.inorderTraversal((n,s)=>{s.foreach_(De(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}};var sn=class i{constructor(e){this.writeTree_=e}static empty(){return new i(new Tt(null))}};function Mo(i,e,t){if(oe(e))return new sn(new Tt(t));{let n=i.writeTree_.findRootMostValueAndPath(e);if(n!=null){let s=n.path,r=n.value,o=Et(s,e);return r=r.updateChild(o,t),new sn(i.writeTree_.set(s,r))}else{let s=new Tt(t),r=i.writeTree_.setTree(e,s);return new sn(r)}}}function sf(i,e,t){let n=i;return rt(t,(s,r)=>{n=Mo(n,De(e,s),r)}),n}function ww(i,e){if(oe(e))return sn.empty();{let t=i.writeTree_.setTree(e,new Tt(null));return new sn(t)}}function rf(i,e){return ts(i,e)!=null}function ts(i,e){let t=i.writeTree_.findRootMostValueAndPath(e);return t!=null?i.writeTree_.get(t.path).getChild(Et(t.path,e)):null}function Ew(i){let e=[],t=i.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(Se,(n,s)=>{e.push(new ae(n,s))}):i.writeTree_.children.inorderTraversal((n,s)=>{s.value!=null&&e.push(new ae(n,s.value))}),e}function hi(i,e){if(oe(e))return i;{let t=ts(i,e);return t!=null?new sn(new Tt(t)):new sn(i.writeTree_.subtree(e))}}function of(i){return i.writeTree_.isEmpty()}function nr(i,e){return uE(ye(),i.writeTree_,e)}function uE(i,e,t){if(e.value!=null)return t.updateChild(i,e.value);{let n=null;return e.children.inorderTraversal((s,r)=>{s===".priority"?(M(r.value!==null,"Priority writes must always be leaf nodes"),n=r.value):t=uE(De(i,s),r,t)}),!t.getChild(i).isEmpty()&&n!==null&&(t=t.updateChild(De(i,".priority"),n)),t}}function Ru(i,e){return fE(e,i)}function PC(i,e,t,n,s){M(n>i.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),i.allWrites.push({path:e,snap:t,writeId:n,visible:s}),s&&(i.visibleWrites=Mo(i.visibleWrites,e,t)),i.lastWriteId=n}function NC(i,e,t,n){M(n>i.lastWriteId,"Stacking an older merge on top of newer ones"),i.allWrites.push({path:e,children:t,writeId:n,visible:!0}),i.visibleWrites=sf(i.visibleWrites,e,t),i.lastWriteId=n}function xC(i,e){for(let t=0;t<i.allWrites.length;t++){let n=i.allWrites[t];if(n.writeId===e)return n}return null}function DC(i,e){let t=i.allWrites.findIndex(a=>a.writeId===e);M(t>=0,"removeWrite called with nonexistent writeId.");let n=i.allWrites[t];i.allWrites.splice(t,1);let s=n.visible,r=!1,o=i.allWrites.length-1;for(;s&&o>=0;){let a=i.allWrites[o];a.visible&&(o>=t&&kC(a,n.path)?s=!1:Kt(n.path,a.path)&&(r=!0)),o--}if(s){if(r)return OC(i),!0;if(n.snap)i.visibleWrites=ww(i.visibleWrites,n.path);else{let a=n.children;rt(a,u=>{i.visibleWrites=ww(i.visibleWrites,De(n.path,u))})}return!0}else return!1}function kC(i,e){if(i.snap)return Kt(i.path,e);for(let t in i.children)if(i.children.hasOwnProperty(t)&&Kt(De(i.path,t),e))return!0;return!1}function OC(i){i.visibleWrites=cE(i.allWrites,MC,ye()),i.allWrites.length>0?i.lastWriteId=i.allWrites[i.allWrites.length-1].writeId:i.lastWriteId=-1}function MC(i){return i.visible}function cE(i,e,t){let n=sn.empty();for(let s=0;s<i.length;++s){let r=i[s];if(e(r)){let o=r.path,a;if(r.snap)Kt(t,o)?(a=Et(t,o),n=Mo(n,a,r.snap)):Kt(o,t)&&(a=Et(o,t),n=Mo(n,ye(),r.snap.getChild(a)));else if(r.children){if(Kt(t,o))a=Et(t,o),n=sf(n,a,r.children);else if(Kt(o,t))if(a=Et(o,t),oe(a))n=sf(n,ye(),r.children);else{let u=li(r.children,re(a));if(u){let c=u.getChild(Te(a));n=Mo(n,ye(),c)}}}else throw Gs("WriteRecord should have .snap or .children")}}return n}function hE(i,e,t,n,s){if(!n&&!s){let r=ts(i.visibleWrites,e);if(r!=null)return r;{let o=hi(i.visibleWrites,e);if(of(o))return t;if(t==null&&!rf(o,ye()))return null;{let a=t||te.EMPTY_NODE;return nr(o,a)}}}else{let r=hi(i.visibleWrites,e);if(!s&&of(r))return t;if(!s&&t==null&&!rf(r,ye()))return null;{let o=function(c){return(c.visible||s)&&(!n||!~n.indexOf(c.writeId))&&(Kt(c.path,e)||Kt(e,c.path))},a=cE(i.allWrites,o,e),u=t||te.EMPTY_NODE;return nr(a,u)}}}function VC(i,e,t){let n=te.EMPTY_NODE,s=ts(i.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(Se,(r,o)=>{n=n.updateImmediateChild(r,o)}),n;if(t){let r=hi(i.visibleWrites,e);return t.forEachChild(Se,(o,a)=>{let u=nr(hi(r,new ve(o)),a);n=n.updateImmediateChild(o,u)}),Ew(r).forEach(o=>{n=n.updateImmediateChild(o.name,o.node)}),n}else{let r=hi(i.visibleWrites,e);return Ew(r).forEach(o=>{n=n.updateImmediateChild(o.name,o.node)}),n}}function FC(i,e,t,n,s){M(n||s,"Either existingEventSnap or existingServerSnap must exist");let r=De(e,t);if(rf(i.visibleWrites,r))return null;{let o=hi(i.visibleWrites,r);return of(o)?s.getChild(t):nr(o,s.getChild(t))}}function LC(i,e,t,n){let s=De(e,t),r=ts(i.visibleWrites,s);if(r!=null)return r;if(n.isCompleteForChild(t)){let o=hi(i.visibleWrites,s);return nr(o,n.getNode().getImmediateChild(t))}else return null}function BC(i,e){return ts(i.visibleWrites,e)}function UC(i,e,t,n,s,r,o){let a,u=hi(i.visibleWrites,e),c=ts(u,ye());if(c!=null)a=c;else if(t!=null)a=nr(u,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let d=[],f=o.getCompare(),p=r?a.getReverseIteratorFrom(n,o):a.getIteratorFrom(n,o),_=p.getNext();for(;_&&d.length<s;)f(_,n)!==0&&d.push(_),_=p.getNext();return d}else return[]}function qC(){return{visibleWrites:sn.empty(),allWrites:[],lastWriteId:-1}}function hu(i,e,t,n){return hE(i.writeTree,i.treePath,e,t,n)}function Gf(i,e){return VC(i.writeTree,i.treePath,e)}function Tw(i,e,t,n){return FC(i.writeTree,i.treePath,e,t,n)}function du(i,e){return BC(i.writeTree,De(i.treePath,e))}function jC(i,e,t,n,s,r){return UC(i.writeTree,i.treePath,e,t,n,s,r)}function Kf(i,e,t){return LC(i.writeTree,i.treePath,e,t)}function dE(i,e){return fE(De(i.treePath,e),i.writeTree)}function fE(i,e){return{treePath:i,writeTree:e}}var af=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,n=e.childName;M(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),M(n!==".priority","Only non-priority child changes can be tracked.");let s=this.changeMap.get(n);if(s){let r=s.type;if(t==="child_added"&&r==="child_removed")this.changeMap.set(n,qo(n,e.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&r==="child_added")this.changeMap.delete(n);else if(t==="child_removed"&&r==="child_changed")this.changeMap.set(n,Uo(n,s.oldSnap));else if(t==="child_changed"&&r==="child_added")this.changeMap.set(n,er(n,e.snapshotNode));else if(t==="child_changed"&&r==="child_changed")this.changeMap.set(n,qo(n,e.snapshotNode,s.oldSnap));else throw Gs("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}};var lf=class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}},mE=new lf,Ko=class{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let n=this.optCompleteServerCache_!=null?new yn(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Kf(this.writes_,e,n)}}getChildAfterChild(e,t,n){let s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Zi(this.viewCache_),r=jC(this.writes_,s,t,1,n,e);return r.length===0?null:r[0]}};function zC(i){return{filter:i}}function GC(i,e){M(e.eventCache.getNode().isIndexed(i.filter.getIndex()),"Event snap not indexed"),M(e.serverCache.getNode().isIndexed(i.filter.getIndex()),"Server snap not indexed")}function KC(i,e,t,n,s){let r=new af,o,a;if(t.type===pn.OVERWRITE){let c=t;c.source.fromUser?o=uf(i,e,c.path,c.snap,n,s,r):(M(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!oe(c.path),o=fu(i,e,c.path,c.snap,n,s,a,r))}else if(t.type===pn.MERGE){let c=t;c.source.fromUser?o=WC(i,e,c.path,c.children,n,s,r):(M(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=cf(i,e,c.path,c.children,n,s,a,r))}else if(t.type===pn.ACK_USER_WRITE){let c=t;c.revert?o=YC(i,e,c.path,n,s,r):o=$C(i,e,c.path,c.affectedTree,n,s,r)}else if(t.type===pn.LISTEN_COMPLETE)o=HC(i,e,t.path,n,r);else throw Gs("Unknown operation type: "+t.type);let u=r.getChanges();return QC(e,o,u),{viewCache:o,changes:u}}function QC(i,e,t){let n=e.eventCache;if(n.isFullyInitialized()){let s=n.getNode().isLeafNode()||n.getNode().isEmpty(),r=cu(i);(t.length>0||!i.eventCache.isFullyInitialized()||s&&!n.getNode().equals(r)||!n.getNode().getPriority().equals(r.getPriority()))&&t.push(aE(cu(e)))}}function pE(i,e,t,n,s,r){let o=e.eventCache;if(du(n,t)!=null)return e;{let a,u;if(oe(t))if(M(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let c=Zi(e),d=c instanceof te?c:te.EMPTY_NODE,f=Gf(n,d);a=i.filter.updateFullNode(e.eventCache.getNode(),f,r)}else{let c=hu(n,Zi(e));a=i.filter.updateFullNode(e.eventCache.getNode(),c,r)}else{let c=re(t);if(c===".priority"){M(mi(t)===1,"Can't have a priority with additional path components");let d=o.getNode();u=e.serverCache.getNode();let f=Tw(n,t,d,u);f!=null?a=i.filter.updatePriority(d,f):a=o.getNode()}else{let d=Te(t),f;if(o.isCompleteForChild(c)){u=e.serverCache.getNode();let p=Tw(n,t,o.getNode(),u);p!=null?f=o.getNode().getImmediateChild(c).updateChild(d,p):f=o.getNode().getImmediateChild(c)}else f=Kf(n,c,e.serverCache);f!=null?a=i.filter.updateChild(o.getNode(),c,f,d,s,r):a=o.getNode()}}return Oo(e,a,o.isFullyInitialized()||oe(t),i.filter.filtersNodes())}}function fu(i,e,t,n,s,r,o,a){let u=e.serverCache,c,d=o?i.filter:i.filter.getIndexedFilter();if(oe(t))c=d.updateFullNode(u.getNode(),n,null);else if(d.filtersNodes()&&!u.isFiltered()){let _=u.getNode().updateChild(t,n);c=d.updateFullNode(u.getNode(),_,null)}else{let _=re(t);if(!u.isCompleteForPath(t)&&mi(t)>1)return e;let E=Te(t),R=u.getNode().getImmediateChild(_).updateChild(E,n);_===".priority"?c=d.updatePriority(u.getNode(),R):c=d.updateChild(u.getNode(),_,R,E,mE,null)}let f=lE(e,c,u.isFullyInitialized()||oe(t),d.filtersNodes()),p=new Ko(s,f,r);return pE(i,f,t,s,p,a)}function uf(i,e,t,n,s,r,o){let a=e.eventCache,u,c,d=new Ko(s,e,r);if(oe(t))c=i.filter.updateFullNode(e.eventCache.getNode(),n,o),u=Oo(e,c,!0,i.filter.filtersNodes());else{let f=re(t);if(f===".priority")c=i.filter.updatePriority(e.eventCache.getNode(),n),u=Oo(e,c,a.isFullyInitialized(),a.isFiltered());else{let p=Te(t),_=a.getNode().getImmediateChild(f),E;if(oe(p))E=n;else{let S=d.getCompleteChild(f);S!=null?Vf(p)===".priority"&&S.getChild(tE(p)).isEmpty()?E=S:E=S.updateChild(p,n):E=te.EMPTY_NODE}if(_.equals(E))u=e;else{let S=i.filter.updateChild(a.getNode(),f,E,p,d,o);u=Oo(e,S,a.isFullyInitialized(),i.filter.filtersNodes())}}}return u}function Iw(i,e){return i.eventCache.isCompleteForChild(e)}function WC(i,e,t,n,s,r,o){let a=e;return n.foreach((u,c)=>{let d=De(t,u);Iw(e,re(d))&&(a=uf(i,a,d,c,s,r,o))}),n.foreach((u,c)=>{let d=De(t,u);Iw(e,re(d))||(a=uf(i,a,d,c,s,r,o))}),a}function Sw(i,e,t){return t.foreach((n,s)=>{e=e.updateChild(n,s)}),e}function cf(i,e,t,n,s,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let u=e,c;oe(t)?c=n:c=new Tt(null).setTree(t,n);let d=e.serverCache.getNode();return c.children.inorderTraversal((f,p)=>{if(d.hasChild(f)){let _=e.serverCache.getNode().getImmediateChild(f),E=Sw(i,_,p);u=fu(i,u,new ve(f),E,s,r,o,a)}}),c.children.inorderTraversal((f,p)=>{let _=!e.serverCache.isCompleteForChild(f)&&p.value===null;if(!d.hasChild(f)&&!_){let E=e.serverCache.getNode().getImmediateChild(f),S=Sw(i,E,p);u=fu(i,u,new ve(f),S,s,r,o,a)}}),u}function $C(i,e,t,n,s,r,o){if(du(s,t)!=null)return e;let a=e.serverCache.isFiltered(),u=e.serverCache;if(n.value!=null){if(oe(t)&&u.isFullyInitialized()||u.isCompleteForPath(t))return fu(i,e,t,u.getNode().getChild(t),s,r,a,o);if(oe(t)){let c=new Tt(null);return u.getNode().forEachChild(gn,(d,f)=>{c=c.set(new ve(d),f)}),cf(i,e,t,c,s,r,a,o)}else return e}else{let c=new Tt(null);return n.foreach((d,f)=>{let p=De(t,d);u.isCompleteForPath(p)&&(c=c.set(d,u.getNode().getChild(p)))}),cf(i,e,t,c,s,r,a,o)}}function HC(i,e,t,n,s){let r=e.serverCache,o=lE(e,r.getNode(),r.isFullyInitialized()||oe(t),r.isFiltered());return pE(i,o,t,n,mE,s)}function YC(i,e,t,n,s,r){let o;if(du(n,t)!=null)return e;{let a=new Ko(n,e,s),u=e.eventCache.getNode(),c;if(oe(t)||re(t)===".priority"){let d;if(e.serverCache.isFullyInitialized())d=hu(n,Zi(e));else{let f=e.serverCache.getNode();M(f instanceof te,"serverChildren would be complete if leaf node"),d=Gf(n,f)}d=d,c=i.filter.updateFullNode(u,d,r)}else{let d=re(t),f=Kf(n,d,e.serverCache);f==null&&e.serverCache.isCompleteForChild(d)&&(f=u.getImmediateChild(d)),f!=null?c=i.filter.updateChild(u,d,f,Te(t),a,r):e.eventCache.getNode().hasChild(d)?c=i.filter.updateChild(u,d,te.EMPTY_NODE,Te(t),a,r):c=u,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=hu(n,Zi(e)),o.isLeafNode()&&(c=i.filter.updateFullNode(c,o,r)))}return o=e.serverCache.isFullyInitialized()||du(n,ye())!=null,Oo(e,c,o,i.filter.filtersNodes())}}var hf=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let n=this.query_._queryParams,s=new jo(n.getIndex()),r=_C(n);this.processor_=zC(r);let o=t.serverCache,a=t.eventCache,u=s.updateFullNode(te.EMPTY_NODE,o.getNode(),null),c=r.updateFullNode(te.EMPTY_NODE,a.getNode(),null),d=new yn(u,o.isFullyInitialized(),s.filtersNodes()),f=new yn(c,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=Cu(f,d),this.eventGenerator_=new nf(this.query_)}get query(){return this.query_}};function JC(i){return i.viewCache_.serverCache.getNode()}function XC(i){return cu(i.viewCache_)}function ZC(i,e){let t=Zi(i.viewCache_);return t&&(i.query._queryParams.loadsAllData()||!oe(e)&&!t.getImmediateChild(re(e)).isEmpty())?t.getChild(e):null}function bw(i){return i.eventRegistrations_.length===0}function eR(i,e){i.eventRegistrations_.push(e)}function Aw(i,e,t){let n=[];if(t){M(e==null,"A cancel should cancel all event registrations.");let s=i.query._path;i.eventRegistrations_.forEach(r=>{let o=r.createCancelEvent(t,s);o&&n.push(o)})}if(e){let s=[];for(let r=0;r<i.eventRegistrations_.length;++r){let o=i.eventRegistrations_[r];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(i.eventRegistrations_.slice(r+1));break}}i.eventRegistrations_=s}else i.eventRegistrations_=[];return n}function Cw(i,e,t,n){e.type===pn.MERGE&&e.source.queryId!==null&&(M(Zi(i.viewCache_),"We should always have a full cache before handling merges"),M(cu(i.viewCache_),"Missing event cache, even though we have a server cache"));let s=i.viewCache_,r=KC(i.processor_,s,e,t,n);return GC(i.processor_,r.viewCache),M(r.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),i.viewCache_=r.viewCache,gE(i,r.changes,r.viewCache.eventCache.getNode(),null)}function tR(i,e){let t=i.viewCache_.eventCache,n=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(Se,(r,o)=>{n.push(er(r,o))}),t.isFullyInitialized()&&n.push(aE(t.getNode())),gE(i,n,t.getNode(),e)}function gE(i,e,t,n){let s=n?[n]:i.eventRegistrations_;return bC(i.eventGenerator_,e,t,s)}var mu,pu=class{constructor(){this.views=new Map}};function nR(i){M(!mu,"__referenceConstructor has already been defined"),mu=i}function iR(){return M(mu,"Reference.ts has not been loaded"),mu}function sR(i){return i.views.size===0}function Qf(i,e,t,n){let s=e.source.queryId;if(s!==null){let r=i.views.get(s);return M(r!=null,"SyncTree gave us an op for an invalid query."),Cw(r,e,t,n)}else{let r=[];for(let o of i.views.values())r=r.concat(Cw(o,e,t,n));return r}}function _E(i,e,t,n,s){let r=e._queryIdentifier,o=i.views.get(r);if(!o){let a=hu(t,s?n:null),u=!1;a?u=!0:n instanceof te?(a=Gf(t,n),u=!1):(a=te.EMPTY_NODE,u=!1);let c=Cu(new yn(a,u,!1),new yn(n,s,!1));return new hf(e,c)}return o}function rR(i,e,t,n,s,r){let o=_E(i,e,n,s,r);return i.views.has(e._queryIdentifier)||i.views.set(e._queryIdentifier,o),eR(o,t),tR(o,t)}function oR(i,e,t,n){let s=e._queryIdentifier,r=[],o=[],a=pi(i);if(s==="default")for(let[u,c]of i.views.entries())o=o.concat(Aw(c,t,n)),bw(c)&&(i.views.delete(u),c.query._queryParams.loadsAllData()||r.push(c.query));else{let u=i.views.get(s);u&&(o=o.concat(Aw(u,t,n)),bw(u)&&(i.views.delete(s),u.query._queryParams.loadsAllData()||r.push(u.query)))}return a&&!pi(i)&&r.push(new(iR())(e._repo,e._path)),{removed:r,events:o}}function yE(i){let e=[];for(let t of i.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function di(i,e){let t=null;for(let n of i.views.values())t=t||ZC(n,e);return t}function vE(i,e){if(e._queryParams.loadsAllData())return Pu(i);{let n=e._queryIdentifier;return i.views.get(n)}}function wE(i,e){return vE(i,e)!=null}function pi(i){return Pu(i)!=null}function Pu(i){for(let e of i.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var gu;function aR(i){M(!gu,"__referenceConstructor has already been defined"),gu=i}function lR(){return M(gu,"Reference.ts has not been loaded"),gu}var uR=1,_u=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Tt(null),this.pendingWriteTree_=qC(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function Wf(i,e,t,n,s){return PC(i.pendingWriteTree_,e,t,n,s),s?ar(i,new tr(qf(),e,t)):[]}function cR(i,e,t,n){NC(i.pendingWriteTree_,e,t,n);let s=Tt.fromObject(t);return ar(i,new Go(qf(),e,s))}function ci(i,e,t=!1){let n=xC(i.pendingWriteTree_,e);if(DC(i.pendingWriteTree_,e)){let r=new Tt(null);return n.snap!=null?r=r.set(ye(),!0):rt(n.children,o=>{r=r.set(new ve(o),!0)}),ar(i,new tf(n.path,r,t))}else return[]}function ea(i,e,t){return ar(i,new tr(jf(),e,t))}function hR(i,e,t){let n=Tt.fromObject(t);return ar(i,new Go(jf(),e,n))}function dR(i,e){return ar(i,new uu(jf(),e))}function fR(i,e,t){let n=$f(i,t);if(n){let s=Hf(n),r=s.path,o=s.queryId,a=Et(r,e),u=new uu(zf(o),a);return Yf(i,r,u)}else return[]}function yu(i,e,t,n,s=!1){let r=e._path,o=i.syncPointTree_.get(r),a=[];if(o&&(e._queryIdentifier==="default"||wE(o,e))){let u=oR(o,e,t,n);sR(o)&&(i.syncPointTree_=i.syncPointTree_.remove(r));let c=u.removed;if(a=u.events,!s){let d=c.findIndex(p=>p._queryParams.loadsAllData())!==-1,f=i.syncPointTree_.findOnPath(r,(p,_)=>pi(_));if(d&&!f){let p=i.syncPointTree_.subtree(r);if(!p.isEmpty()){let _=gR(p);for(let E=0;E<_.length;++E){let S=_[E],R=S.query,V=SE(i,S);i.listenProvider_.startListening(Vo(R),Qo(i,R),V.hashFn,V.onComplete)}}}!f&&c.length>0&&!n&&(d?i.listenProvider_.stopListening(Vo(e),null):c.forEach(p=>{let _=i.queryToTagMap.get(xu(p));i.listenProvider_.stopListening(Vo(p),_)}))}_R(i,c)}return a}function EE(i,e,t,n){let s=$f(i,n);if(s!=null){let r=Hf(s),o=r.path,a=r.queryId,u=Et(o,e),c=new tr(zf(a),u,t);return Yf(i,o,c)}else return[]}function mR(i,e,t,n){let s=$f(i,n);if(s){let r=Hf(s),o=r.path,a=r.queryId,u=Et(o,e),c=Tt.fromObject(t),d=new Go(zf(a),u,c);return Yf(i,o,d)}else return[]}function df(i,e,t,n=!1){let s=e._path,r=null,o=!1;i.syncPointTree_.foreachOnPath(s,(p,_)=>{let E=Et(p,s);r=r||di(_,E),o=o||pi(_)});let a=i.syncPointTree_.get(s);a?(o=o||pi(a),r=r||di(a,ye())):(a=new pu,i.syncPointTree_=i.syncPointTree_.set(s,a));let u;r!=null?u=!0:(u=!1,r=te.EMPTY_NODE,i.syncPointTree_.subtree(s).foreachChild((_,E)=>{let S=di(E,ye());S&&(r=r.updateImmediateChild(_,S))}));let c=wE(a,e);if(!c&&!e._queryParams.loadsAllData()){let p=xu(e);M(!i.queryToTagMap.has(p),"View does not exist, but we have a tag");let _=yR();i.queryToTagMap.set(p,_),i.tagToQueryMap.set(_,p)}let d=Ru(i.pendingWriteTree_,s),f=rR(a,e,t,d,r,u);if(!c&&!o&&!n){let p=vE(a,e);f=f.concat(vR(i,e,p))}return f}function Nu(i,e,t){let s=i.pendingWriteTree_,r=i.syncPointTree_.findOnPath(e,(o,a)=>{let u=Et(o,e),c=di(a,u);if(c)return c});return hE(s,e,r,t,!0)}function pR(i,e){let t=e._path,n=null;i.syncPointTree_.foreachOnPath(t,(c,d)=>{let f=Et(c,t);n=n||di(d,f)});let s=i.syncPointTree_.get(t);s?n=n||di(s,ye()):(s=new pu,i.syncPointTree_=i.syncPointTree_.set(t,s));let r=n!=null,o=r?new yn(n,!0,!1):null,a=Ru(i.pendingWriteTree_,e._path),u=_E(s,e,a,r?o.getNode():te.EMPTY_NODE,r);return XC(u)}function ar(i,e){return TE(e,i.syncPointTree_,null,Ru(i.pendingWriteTree_,ye()))}function TE(i,e,t,n){if(oe(i.path))return IE(i,e,t,n);{let s=e.get(ye());t==null&&s!=null&&(t=di(s,ye()));let r=[],o=re(i.path),a=i.operationForChild(o),u=e.children.get(o);if(u&&a){let c=t?t.getImmediateChild(o):null,d=dE(n,o);r=r.concat(TE(a,u,c,d))}return s&&(r=r.concat(Qf(s,i,n,t))),r}}function IE(i,e,t,n){let s=e.get(ye());t==null&&s!=null&&(t=di(s,ye()));let r=[];return e.children.inorderTraversal((o,a)=>{let u=t?t.getImmediateChild(o):null,c=dE(n,o),d=i.operationForChild(o);d&&(r=r.concat(IE(d,a,u,c)))}),s&&(r=r.concat(Qf(s,i,n,t))),r}function SE(i,e){let t=e.query,n=Qo(i,t);return{hashFn:()=>(JC(e)||te.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return n?fR(i,t._path,n):dR(i,t._path);{let r=PA(s,t);return yu(i,t,null,r)}}}}function Qo(i,e){let t=xu(e);return i.queryToTagMap.get(t)}function xu(i){return i._path.toString()+"$"+i._queryIdentifier}function $f(i,e){return i.tagToQueryMap.get(e)}function Hf(i){let e=i.indexOf("$");return M(e!==-1&&e<i.length-1,"Bad queryKey."),{queryId:i.substr(e+1),path:new ve(i.substr(0,e))}}function Yf(i,e,t){let n=i.syncPointTree_.get(e);M(n,"Missing sync point for query tag that we're tracking");let s=Ru(i.pendingWriteTree_,e);return Qf(n,t,s,null)}function gR(i){return i.fold((e,t,n)=>{if(t&&pi(t))return[Pu(t)];{let s=[];return t&&(s=yE(t)),rt(n,(r,o)=>{s=s.concat(o)}),s}})}function Vo(i){return i._queryParams.loadsAllData()&&!i._queryParams.isDefault()?new(lR())(i._repo,i._path):i}function _R(i,e){for(let t=0;t<e.length;++t){let n=e[t];if(!n._queryParams.loadsAllData()){let s=xu(n),r=i.queryToTagMap.get(s);i.queryToTagMap.delete(s),i.tagToQueryMap.delete(r)}}}function yR(){return uR++}function vR(i,e,t){let n=e._path,s=Qo(i,e),r=SE(i,t),o=i.listenProvider_.startListening(Vo(e),s,r.hashFn,r.onComplete),a=i.syncPointTree_.subtree(n);if(s)M(!pi(a.value),"If we're adding a query, it shouldn't be shadowed");else{let u=a.fold((c,d,f)=>{if(!oe(c)&&d&&pi(d))return[Pu(d).query];{let p=[];return d&&(p=p.concat(yE(d).map(_=>_.query))),rt(f,(_,E)=>{p=p.concat(E)}),p}});for(let c=0;c<u.length;++c){let d=u[c];i.listenProvider_.stopListening(Vo(d),Qo(i,d))}}return o}var ff=class i{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new i(t)}node(){return this.node_}},mf=class i{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=De(this.path_,e);return new i(this.syncTree_,t)}node(){return Nu(this.syncTree_,this.path_)}},wR=function(i){return i=i||{},i.timestamp=i.timestamp||new Date().getTime(),i},Rw=function(i,e,t){if(!i||typeof i!="object")return i;if(M(".sv"in i,"Unexpected leaf node or priority contents"),typeof i[".sv"]=="string")return ER(i[".sv"],e,t);if(typeof i[".sv"]=="object")return TR(i[".sv"],e);M(!1,"Unexpected server value: "+JSON.stringify(i,null,2))},ER=function(i,e,t){switch(i){case"timestamp":return t.timestamp;default:M(!1,"Unexpected server value: "+i)}},TR=function(i,e,t){i.hasOwnProperty("increment")||M(!1,"Unexpected server value: "+JSON.stringify(i,null,2));let n=i.increment;typeof n!="number"&&M(!1,"Unexpected increment value: "+n);let s=e.node();if(M(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return n;let o=s.getValue();return typeof o!="number"?n:o+n},bE=function(i,e,t,n){return Xf(e,new mf(t,i),n)},Jf=function(i,e,t){return Xf(i,new ff(e),t)};function Xf(i,e,t){let n=i.getPriority().val(),s=Rw(n,e.getImmediateChild(".priority"),t),r;if(i.isLeafNode()){let o=i,a=Rw(o.getValue(),e,t);return a!==o.getValue()||s!==o.getPriority().val()?new Xs(a,Oe(s)):i}else{let o=i;return r=o,s!==o.getPriority().val()&&(r=r.updatePriority(new Xs(s))),o.forEachChild(Se,(a,u)=>{let c=Xf(u,e.getImmediateChild(a),t);c!==u&&(r=r.updateImmediateChild(a,c))}),r}}var Wo=class{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}};function Du(i,e){let t=e instanceof ve?e:new ve(e),n=i,s=re(t);for(;s!==null;){let r=li(n.node.children,s)||{children:{},childCount:0};n=new Wo(s,n,r),t=Te(t),s=re(t)}return n}function ns(i){return i.node.value}function Zf(i,e){i.node.value=e,pf(i)}function AE(i){return i.node.childCount>0}function IR(i){return ns(i)===void 0&&!AE(i)}function ku(i,e){rt(i.node.children,(t,n)=>{e(new Wo(t,i,n))})}function CE(i,e,t,n){t&&!n&&e(i),ku(i,s=>{CE(s,e,!0,n)}),t&&n&&e(i)}function SR(i,e,t){let n=t?i:i.parent;for(;n!==null;){if(e(n))return!0;n=n.parent}return!1}function ta(i){return new ve(i.parent===null?i.name:ta(i.parent)+"/"+i.name)}function pf(i){i.parent!==null&&bR(i.parent,i.name,i)}function bR(i,e,t){let n=IR(t),s=zt(i.node.children,e);n&&s?(delete i.node.children[e],i.node.childCount--,pf(i)):!n&&!s&&(i.node.children[e]=t.node,i.node.childCount++,pf(i))}var AR=/[\[\].#$\/\u0000-\u001F\u007F]/,CR=/[\[\].#$\u0000-\u001F\u007F]/,bd=10*1024*1024,Ou=function(i){return typeof i=="string"&&i.length!==0&&!AR.test(i)},RE=function(i){return typeof i=="string"&&i.length!==0&&!CR.test(i)},RR=function(i){return i&&(i=i.replace(/^\/*\.info(\/|$)/,"/")),RE(i)},$o=function(i){return i===null||typeof i=="string"||typeof i=="number"&&!bu(i)||i&&typeof i=="object"&&zt(i,".sv")},vn=function(i,e,t,n){n&&e===void 0||na(Nt(i,"value"),e,t)},na=function(i,e,t){let n=t instanceof ve?new Ld(t,i):t;if(e===void 0)throw new Error(i+"contains undefined "+Yi(n));if(typeof e=="function")throw new Error(i+"contains a function "+Yi(n)+" with contents = "+e.toString());if(bu(e))throw new Error(i+"contains "+e.toString()+" "+Yi(n));if(typeof e=="string"&&e.length>bd/3&&Co(e)>bd)throw new Error(i+"contains a string greater than "+bd+" utf8 bytes "+Yi(n)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,r=!1;if(rt(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!Ou(o)))throw new Error(i+" contains an invalid key ("+o+") "+Yi(n)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);sC(n,o),na(i,a,n),rC(n)}),s&&r)throw new Error(i+' contains ".value" child '+Yi(n)+" in addition to actual children.")}},PR=function(i,e){let t,n;for(t=0;t<e.length;t++){n=e[t];let r=Lo(n);for(let o=0;o<r.length;o++)if(!(r[o]===".priority"&&o===r.length-1)){if(!Ou(r[o]))throw new Error(i+"contains an invalid key ("+r[o]+") in path "+n.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(iC);let s=null;for(t=0;t<e.length;t++){if(n=e[t],s!==null&&Kt(s,n))throw new Error(i+"contains a path "+s.toString()+" that is ancestor of another path "+n.toString());s=n}},PE=function(i,e,t,n){if(n&&e===void 0)return;let s=Nt(i,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");let r=[];rt(e,(o,a)=>{let u=new ve(o);if(na(s,a,De(t,u)),Vf(u)===".priority"&&!$o(a))throw new Error(s+"contains an invalid value for '"+u.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(u)}),PR(s,r)},em=function(i,e,t){if(!(t&&e===void 0)){if(bu(e))throw new Error(Nt(i,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!$o(e))throw new Error(Nt(i,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},ia=function(i,e,t,n){if(!(n&&t===void 0)&&!Ou(t))throw new Error(Nt(i,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},lr=function(i,e,t,n){if(!(n&&t===void 0)&&!RE(t))throw new Error(Nt(i,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},NR=function(i,e,t,n){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),lr(i,e,t,n)},kt=function(i,e){if(re(e)===".info")throw new Error(i+" failed = Can't modify data under /.info/")},NE=function(i,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Ou(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!RR(t))throw new Error(Nt(i,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var gf=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function Mu(i,e){let t=null;for(let n=0;n<e.length;n++){let s=e[n],r=s.getPath();t!==null&&!Ff(r,t.path)&&(i.eventLists_.push(t),t=null),t===null&&(t={events:[],path:r}),t.events.push(s)}t&&i.eventLists_.push(t)}function xE(i,e,t){Mu(i,t),DE(i,n=>Ff(n,e))}function Ot(i,e,t){Mu(i,t),DE(i,n=>Kt(n,e)||Kt(e,n))}function DE(i,e){i.recursionDepth_++;let t=!0;for(let n=0;n<i.eventLists_.length;n++){let s=i.eventLists_[n];if(s){let r=s.path;e(r)?(xR(i.eventLists_[n]),i.eventLists_[n]=null):t=!1}}t&&(i.eventLists_=[]),i.recursionDepth_--}function xR(i){for(let e=0;e<i.events.length;e++){let t=i.events[e];if(t!==null){i.events[e]=null;let n=t.getEventRunner();Xi&&st("event: "+t.toString()),rr(n)}}}var kE="repo_interrupt",DR=25,_f=class{constructor(e,t,n,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new gf,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=lu(),this.transactionQueueTree_=new Wo,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function kR(i,e,t){if(i.stats_=Mf(i.repoInfo_),i.forceRestClient_||kA())i.server_=new Hd(i.repoInfo_,(n,s,r,o)=>{Pw(i,n,s,r,o)},i.authTokenProvider_,i.appCheckProvider_),setTimeout(()=>Nw(i,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{$e(t)}catch(n){throw new Error("Invalid authOverride provided: "+n)}}i.persistentConnection_=new Lf(i.repoInfo_,e,(n,s,r,o)=>{Pw(i,n,s,r,o)},n=>{Nw(i,n)},n=>{OR(i,n)},i.authTokenProvider_,i.appCheckProvider_,t),i.server_=i.persistentConnection_}i.authTokenProvider_.addTokenChangeListener(n=>{i.server_.refreshAuthToken(n)}),i.appCheckProvider_.addTokenChangeListener(n=>{i.server_.refreshAppCheckToken(n.token)}),i.statsReporter_=MA(i.repoInfo_,()=>new ef(i.stats_,i.server_)),i.infoData_=new Yd,i.infoSyncTree_=new _u({startListening:(n,s,r,o)=>{let a=[],u=i.infoData_.getNode(n._path);return u.isEmpty()||(a=ea(i.infoSyncTree_,n._path,u),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),tm(i,"connected",!1),i.serverSyncTree_=new _u({startListening:(n,s,r,o)=>(i.server_.listen(n,r,s,(a,u)=>{let c=o(a,u);Ot(i.eventQueue_,n._path,c)}),[]),stopListening:(n,s)=>{i.server_.unlisten(n,s)}})}function OE(i){let t=i.infoData_.getNode(new ve(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function sa(i){return wR({timestamp:OE(i)})}function Pw(i,e,t,n,s){i.dataUpdateCount++;let r=new ve(e);t=i.interceptServerDataCallback_?i.interceptServerDataCallback_(e,t):t;let o=[];if(s)if(n){let u=Ao(t,c=>Oe(c));o=mR(i.serverSyncTree_,r,u,s)}else{let u=Oe(t);o=EE(i.serverSyncTree_,r,u,s)}else if(n){let u=Ao(t,c=>Oe(c));o=hR(i.serverSyncTree_,r,u)}else{let u=Oe(t);o=ea(i.serverSyncTree_,r,u)}let a=r;o.length>0&&(a=ir(i,r)),Ot(i.eventQueue_,a,o)}function Nw(i,e){tm(i,"connected",e),e===!1&&FR(i)}function OR(i,e){rt(e,(t,n)=>{tm(i,t,n)})}function tm(i,e,t){let n=new ve("/.info/"+e),s=Oe(t);i.infoData_.updateSnapshot(n,s);let r=ea(i.infoSyncTree_,n,s);Ot(i.eventQueue_,n,r)}function Vu(i){return i.nextWriteId_++}function MR(i,e,t){let n=pR(i.serverSyncTree_,e);return n!=null?Promise.resolve(n):i.server_.get(e).then(s=>{let r=Oe(s).withIndex(e._queryParams.getIndex());df(i.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=ea(i.serverSyncTree_,e._path,r);else{let a=Qo(i.serverSyncTree_,e);o=EE(i.serverSyncTree_,e._path,r,a)}return Ot(i.eventQueue_,e._path,o),yu(i.serverSyncTree_,e,t,null,!0),r},s=>(ur(i,"get for query "+$e(e)+" failed: "+s),Promise.reject(new Error(s))))}function nm(i,e,t,n,s){ur(i,"set",{path:e.toString(),value:t,priority:n});let r=sa(i),o=Oe(t,n),a=Nu(i.serverSyncTree_,e),u=Jf(o,a,r),c=Vu(i),d=Wf(i.serverSyncTree_,e,u,c,!0);Mu(i.eventQueue_,d),i.server_.put(e.toString(),o.val(!0),(p,_)=>{let E=p==="ok";E||mt("set at "+e+" failed: "+p);let S=ci(i.serverSyncTree_,c,!E);Ot(i.eventQueue_,e,S),gi(i,s,p,_)});let f=sm(i,e);ir(i,f),Ot(i.eventQueue_,f,[])}function VR(i,e,t,n){ur(i,"update",{path:e.toString(),value:t});let s=!0,r=sa(i),o={};if(rt(t,(a,u)=>{s=!1,o[a]=bE(De(e,a),Oe(u),i.serverSyncTree_,r)}),s)st("update() called with empty data.  Don't do anything."),gi(i,n,"ok",void 0);else{let a=Vu(i),u=cR(i.serverSyncTree_,e,o,a);Mu(i.eventQueue_,u),i.server_.merge(e.toString(),t,(c,d)=>{let f=c==="ok";f||mt("update at "+e+" failed: "+c);let p=ci(i.serverSyncTree_,a,!f),_=p.length>0?ir(i,e):e;Ot(i.eventQueue_,_,p),gi(i,n,c,d)}),rt(t,c=>{let d=sm(i,De(e,c));ir(i,d)}),Ot(i.eventQueue_,e,[])}}function FR(i){ur(i,"onDisconnectEvents");let e=sa(i),t=lu();Xd(i.onDisconnect_,ye(),(s,r)=>{let o=bE(s,r,i.serverSyncTree_,e);or(t,s,o)});let n=[];Xd(t,ye(),(s,r)=>{n=n.concat(ea(i.serverSyncTree_,s,r));let o=sm(i,s);ir(i,o)}),i.onDisconnect_=lu(),Ot(i.eventQueue_,ye(),n)}function LR(i,e,t){i.server_.onDisconnectCancel(e.toString(),(n,s)=>{n==="ok"&&Jd(i.onDisconnect_,e),gi(i,t,n,s)})}function xw(i,e,t,n){let s=Oe(t);i.server_.onDisconnectPut(e.toString(),s.val(!0),(r,o)=>{r==="ok"&&or(i.onDisconnect_,e,s),gi(i,n,r,o)})}function BR(i,e,t,n,s){let r=Oe(t,n);i.server_.onDisconnectPut(e.toString(),r.val(!0),(o,a)=>{o==="ok"&&or(i.onDisconnect_,e,r),gi(i,s,o,a)})}function UR(i,e,t,n){if(Dl(t)){st("onDisconnect().update() called with empty data.  Don't do anything."),gi(i,n,"ok",void 0);return}i.server_.onDisconnectMerge(e.toString(),t,(s,r)=>{s==="ok"&&rt(t,(o,a)=>{let u=Oe(a);or(i.onDisconnect_,De(e,o),u)}),gi(i,n,s,r)})}function qR(i,e,t){let n;re(e._path)===".info"?n=df(i.infoSyncTree_,e,t):n=df(i.serverSyncTree_,e,t),xE(i.eventQueue_,e._path,n)}function yf(i,e,t){let n;re(e._path)===".info"?n=yu(i.infoSyncTree_,e,t):n=yu(i.serverSyncTree_,e,t),xE(i.eventQueue_,e._path,n)}function ME(i){i.persistentConnection_&&i.persistentConnection_.interrupt(kE)}function jR(i){i.persistentConnection_&&i.persistentConnection_.resume(kE)}function ur(i,...e){let t="";i.persistentConnection_&&(t=i.persistentConnection_.id+":"),st(t,...e)}function gi(i,e,t,n){e&&rr(()=>{if(t==="ok")e(null);else{let s=(t||"error").toUpperCase(),r=s;n&&(r+=": "+n);let o=new Error(r);o.code=s,e(o)}})}function zR(i,e,t,n,s,r){ur(i,"transaction on "+e);let o={path:e,update:t,onComplete:n,status:null,order:Ow(),applyLocally:r,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=im(i,e,void 0);o.currentInputSnapshot=a;let u=o.update(a.val());if(u===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{na("transaction failed: Data returned ",u,o.path),o.status=0;let c=Du(i.transactionQueueTree_,e),d=ns(c)||[];d.push(o),Zf(c,d);let f;typeof u=="object"&&u!==null&&zt(u,".priority")?(f=li(u,".priority"),M($o(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):f=(Nu(i.serverSyncTree_,e)||te.EMPTY_NODE).getPriority().val();let p=sa(i),_=Oe(u,f),E=Jf(_,a,p);o.currentOutputSnapshotRaw=_,o.currentOutputSnapshotResolved=E,o.currentWriteId=Vu(i);let S=Wf(i.serverSyncTree_,e,E,o.currentWriteId,o.applyLocally);Ot(i.eventQueue_,e,S),Fu(i,i.transactionQueueTree_)}}function im(i,e,t){return Nu(i.serverSyncTree_,e,t)||te.EMPTY_NODE}function Fu(i,e=i.transactionQueueTree_){if(e||Lu(i,e),ns(e)){let t=FE(i,e);M(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&GR(i,ta(e),t)}else AE(e)&&ku(e,t=>{Fu(i,t)})}function GR(i,e,t){let n=t.map(c=>c.currentWriteId),s=im(i,e,n),r=s,o=s.hash();for(let c=0;c<t.length;c++){let d=t[c];M(d.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;let f=Et(e,d.path);r=r.updateChild(f,d.currentOutputSnapshotRaw)}let a=r.val(!0),u=e;i.server_.put(u.toString(),a,c=>{ur(i,"transaction put response",{path:u.toString(),status:c});let d=[];if(c==="ok"){let f=[];for(let p=0;p<t.length;p++)t[p].status=2,d=d.concat(ci(i.serverSyncTree_,t[p].currentWriteId)),t[p].onComplete&&f.push(()=>t[p].onComplete(null,!0,t[p].currentOutputSnapshotResolved)),t[p].unwatcher();Lu(i,Du(i.transactionQueueTree_,e)),Fu(i,i.transactionQueueTree_),Ot(i.eventQueue_,e,d);for(let p=0;p<f.length;p++)rr(f[p])}else{if(c==="datastale")for(let f=0;f<t.length;f++)t[f].status===3?t[f].status=4:t[f].status=0;else{mt("transaction at "+u.toString()+" failed: "+c);for(let f=0;f<t.length;f++)t[f].status=4,t[f].abortReason=c}ir(i,e)}},o)}function ir(i,e){let t=VE(i,e),n=ta(t),s=FE(i,t);return KR(i,s,n),n}function KR(i,e,t){if(e.length===0)return;let n=[],s=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let u=e[a],c=Et(t,u.path),d=!1,f;if(M(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),u.status===4)d=!0,f=u.abortReason,s=s.concat(ci(i.serverSyncTree_,u.currentWriteId,!0));else if(u.status===0)if(u.retryCount>=DR)d=!0,f="maxretry",s=s.concat(ci(i.serverSyncTree_,u.currentWriteId,!0));else{let p=im(i,u.path,o);u.currentInputSnapshot=p;let _=e[a].update(p.val());if(_!==void 0){na("transaction failed: Data returned ",_,u.path);let E=Oe(_);typeof _=="object"&&_!=null&&zt(_,".priority")||(E=E.updatePriority(p.getPriority()));let R=u.currentWriteId,V=sa(i),B=Jf(E,p,V);u.currentOutputSnapshotRaw=E,u.currentOutputSnapshotResolved=B,u.currentWriteId=Vu(i),o.splice(o.indexOf(R),1),s=s.concat(Wf(i.serverSyncTree_,u.path,B,u.currentWriteId,u.applyLocally)),s=s.concat(ci(i.serverSyncTree_,R,!0))}else d=!0,f="nodata",s=s.concat(ci(i.serverSyncTree_,u.currentWriteId,!0))}Ot(i.eventQueue_,t,s),s=[],d&&(e[a].status=2,function(p){setTimeout(p,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(f==="nodata"?n.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):n.push(()=>e[a].onComplete(new Error(f),!1,null))))}Lu(i,i.transactionQueueTree_);for(let a=0;a<n.length;a++)rr(n[a]);Fu(i,i.transactionQueueTree_)}function VE(i,e){let t,n=i.transactionQueueTree_;for(t=re(e);t!==null&&ns(n)===void 0;)n=Du(n,t),e=Te(e),t=re(e);return n}function FE(i,e){let t=[];return LE(i,e,t),t.sort((n,s)=>n.order-s.order),t}function LE(i,e,t){let n=ns(e);if(n)for(let s=0;s<n.length;s++)t.push(n[s]);ku(e,s=>{LE(i,s,t)})}function Lu(i,e){let t=ns(e);if(t){let n=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[n]=t[s],n++);t.length=n,Zf(e,t.length>0?t:void 0)}ku(e,n=>{Lu(i,n)})}function sm(i,e){let t=ta(VE(i,e)),n=Du(i.transactionQueueTree_,e);return SR(n,s=>{Ad(i,s)}),Ad(i,n),CE(n,s=>{Ad(i,s)}),t}function Ad(i,e){let t=ns(e);if(t){let n=[],s=[],r=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(M(r===o-1,"All SENT items should be at beginning of queue."),r=o,t[o].status=3,t[o].abortReason="set"):(M(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),s=s.concat(ci(i.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&n.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?Zf(e,void 0):t.length=r+1,Ot(i.eventQueue_,ta(e),s);for(let o=0;o<n.length;o++)rr(n[o])}}function QR(i){let e="",t=i.split("/");for(let n=0;n<t.length;n++)if(t[n].length>0){let s=t[n];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function WR(i){let e={};i.charAt(0)==="?"&&(i=i.substring(1));for(let t of i.split("&")){if(t.length===0)continue;let n=t.split("=");n.length===2?e[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):mt(`Invalid query segment '${t}' in query '${i}'`)}return e}var vf=function(i,e){let t=$R(i),n=t.namespace;t.domain==="firebase.com"&&_n(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!n||n==="undefined")&&t.domain!=="localhost"&&_n("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||SA();let s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new eu(t.host,t.secure,n,s,e,"",n!==t.subdomain),path:new ve(t.pathString)}},$R=function(i){let e="",t="",n="",s="",r="",o=!0,a="https",u=443;if(typeof i=="string"){let c=i.indexOf("//");c>=0&&(a=i.substring(0,c-1),i=i.substring(c+2));let d=i.indexOf("/");d===-1&&(d=i.length);let f=i.indexOf("?");f===-1&&(f=i.length),e=i.substring(0,Math.min(d,f)),d<f&&(s=QR(i.substring(d,f)));let p=WR(i.substring(Math.min(i.length,f)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",u=parseInt(e.substring(c+1),10)):c=e.length;let _=e.slice(0,c);if(_.toLowerCase()==="localhost")t="localhost";else if(_.split(".").length<=2)t=_;else{let E=e.indexOf(".");n=e.substring(0,E).toLowerCase(),t=e.substring(E+1),r=n}"ns"in p&&(r=p.ns)}return{host:e,port:u,domain:t,subdomain:n,secure:o,scheme:a,pathString:s,namespace:r}};var Dw="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",HR=function(){let i=0,e=[];return function(t){let n=t===i;i=t;let s,r=new Array(8);for(s=7;s>=0;s--)r[s]=Dw.charAt(t%64),t=Math.floor(t/64);M(t===0,"Cannot push at time == 0");let o=r.join("");if(n){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=Dw.charAt(e[s]);return M(o.length===20,"nextPushId: Length should be 20."),o}}();var vu=class{constructor(e,t,n,s){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=s}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+$e(this.snapshot.exportVal())}},wu=class{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var Ho=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return M(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var Eu=class{constructor(e,t){this._repo=e,this._path=t}cancel(){let e=new wt;return LR(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){kt("OnDisconnect.remove",this._path);let e=new wt;return xw(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){kt("OnDisconnect.set",this._path),vn("OnDisconnect.set",e,this._path,!1);let t=new wt;return xw(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){kt("OnDisconnect.setWithPriority",this._path),vn("OnDisconnect.setWithPriority",e,this._path,!1),em("OnDisconnect.setWithPriority",t,!1);let n=new wt;return BR(this._repo,this._path,e,t,n.wrapCallback(()=>{})),n.promise}update(e){kt("OnDisconnect.update",this._path),PE("OnDisconnect.update",e,this._path,!1);let t=new wt;return UR(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};var It=class i{constructor(e,t,n,s){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=s}get key(){return oe(this._path)?null:Vf(this._path)}get ref(){return new Mt(this._repo,this._path)}get _queryIdentifier(){let e=yw(this._queryParams),t=Of(e);return t==="{}"?"default":t}get _queryObject(){return yw(this._queryParams)}isEqual(e){if(e=he(e),!(e instanceof i))return!1;let t=this._repo===e._repo,n=Ff(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&n&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+nC(this._path)}};function Bu(i,e){if(i._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function yi(i){let e=null,t=null;if(i.hasStart()&&(e=i.getIndexStartValue()),i.hasEnd()&&(t=i.getIndexEndValue()),i.getIndex()===gn){let n="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",s="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(i.hasStart()){if(i.getIndexStartName()!==fi)throw new Error(n);if(typeof e!="string")throw new Error(s)}if(i.hasEnd()){if(i.getIndexEndName()!==Un)throw new Error(n);if(typeof t!="string")throw new Error(s)}}else if(i.getIndex()===Se){if(e!=null&&!$o(e)||t!=null&&!$o(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(M(i.getIndex()instanceof Bo||i.getIndex()===Uf,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Uu(i){if(i.hasStart()&&i.hasEnd()&&i.hasLimit()&&!i.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var Mt=class i extends It{constructor(e,t){super(e,t,new zo,!1)}get parent(){let e=tE(this._path);return e===null?null:new i(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},sr=class i{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new ve(e),n=_i(this.ref,e);return new i(this._node.getChild(t),n,Se)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(n,s)=>e(new i(s,_i(this.ref,n),Se)))}hasChild(e){let t=new ve(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function rm(i,e){return i=he(i),i._checkNotDeleted("ref"),e!==void 0?_i(i._root,e):i._root}function om(i,e){i=he(i),i._checkNotDeleted("refFromURL");let t=vf(e,i._repo.repoInfo_.nodeAdmin);NE("refFromURL",t);let n=t.repoInfo;return!i._repo.repoInfo_.isCustomHost()&&n.host!==i._repo.repoInfo_.host&&_n("refFromURL: Host name does not match the current database: (found "+n.host+" but expected "+i._repo.repoInfo_.host+")"),rm(i,t.path.toString())}function _i(i,e){return i=he(i),re(i._path)===null?NR("child","path",e,!1):lr("child","path",e,!1),new Mt(i._repo,De(i._path,e))}function BE(i,e){i=he(i),kt("push",i._path),vn("push",e,i._path,!0);let t=OE(i._repo),n=HR(t),s=_i(i,n),r=_i(i,n),o;return e!=null?o=qu(r,e).then(()=>r):o=Promise.resolve(r),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function UE(i){return kt("remove",i._path),qu(i,null)}function qu(i,e){i=he(i),kt("set",i._path),vn("set",e,i._path,!1);let t=new wt;return nm(i._repo,i._path,e,null,t.wrapCallback(()=>{})),t.promise}function qE(i,e){i=he(i),kt("setPriority",i._path),em("setPriority",e,!1);let t=new wt;return nm(i._repo,De(i._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function jE(i,e,t){if(kt("setWithPriority",i._path),vn("setWithPriority",e,i._path,!1),em("setWithPriority",t,!1),i.key===".length"||i.key===".keys")throw"setWithPriority failed: "+i.key+" is a read-only object.";let n=new wt;return nm(i._repo,i._path,e,t,n.wrapCallback(()=>{})),n.promise}function zE(i,e){PE("update",e,i._path,!1);let t=new wt;return VR(i._repo,i._path,e,t.wrapCallback(()=>{})),t.promise}function GE(i){i=he(i);let e=new Ho(()=>{}),t=new Yo(e);return MR(i._repo,i,t).then(n=>new sr(n,new Mt(i._repo,i._path),i._queryParams.getIndex()))}var Yo=class i{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let n=t._queryParams.getIndex();return new vu("value",this,new sr(e.snapshotNode,new Mt(t._repo,t._path),n))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new wu(this,e,t):null}matches(e){return e instanceof i?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},Tu=class i{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new wu(this,e,t):null}createEvent(e,t){M(e.childName!=null,"Child events should have a childName.");let n=_i(new Mt(t._repo,t._path),e.childName),s=t._queryParams.getIndex();return new vu(e.type,this,new sr(e.snapshotNode,n,s),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof i?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function ra(i,e,t,n,s){let r;if(typeof n=="object"&&(r=void 0,s=n),typeof n=="function"&&(r=n),s&&s.onlyOnce){let u=t,c=(d,f)=>{yf(i._repo,i,a),u(d,f)};c.userCallback=t.userCallback,c.context=t.context,t=c}let o=new Ho(t,r||void 0),a=e==="value"?new Yo(o):new Tu(e,o);return qR(i._repo,i,a),()=>yf(i._repo,i,a)}function ju(i,e,t,n){return ra(i,"value",e,t,n)}function am(i,e,t,n){return ra(i,"child_added",e,t,n)}function lm(i,e,t,n){return ra(i,"child_changed",e,t,n)}function um(i,e,t,n){return ra(i,"child_moved",e,t,n)}function cm(i,e,t,n){return ra(i,"child_removed",e,t,n)}function hm(i,e,t){let n=null,s=t?new Ho(t):null;e==="value"?n=new Yo(s):e&&(n=new Tu(e,s)),yf(i._repo,i,n)}var Vt=class{},Iu=class extends Vt{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){vn("endAt",this._value,e._path,!0);let t=$d(e._queryParams,this._value,this._key);if(Uu(t),yi(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new It(e._repo,e._path,t,e._orderByCalled)}};function KE(i,e){return ia("endAt","key",e,!0),new Iu(i,e)}var wf=class extends Vt{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){vn("endBefore",this._value,e._path,!1);let t=EC(e._queryParams,this._value,this._key);if(Uu(t),yi(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new It(e._repo,e._path,t,e._orderByCalled)}};function QE(i,e){return ia("endBefore","key",e,!0),new wf(i,e)}var Su=class extends Vt{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){vn("startAt",this._value,e._path,!0);let t=Wd(e._queryParams,this._value,this._key);if(Uu(t),yi(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new It(e._repo,e._path,t,e._orderByCalled)}};function WE(i=null,e){return ia("startAt","key",e,!0),new Su(i,e)}var Ef=class extends Vt{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){vn("startAfter",this._value,e._path,!1);let t=wC(e._queryParams,this._value,this._key);if(Uu(t),yi(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new It(e._repo,e._path,t,e._orderByCalled)}};function $E(i,e){return ia("startAfter","key",e,!0),new Ef(i,e)}var Tf=class extends Vt{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new It(e._repo,e._path,yC(e._queryParams,this._limit),e._orderByCalled)}};function HE(i){if(typeof i!="number"||Math.floor(i)!==i||i<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new Tf(i)}var If=class extends Vt{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new It(e._repo,e._path,vC(e._queryParams,this._limit),e._orderByCalled)}};function YE(i){if(typeof i!="number"||Math.floor(i)!==i||i<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new If(i)}var Sf=class extends Vt{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){Bu(e,"orderByChild");let t=new ve(this._path);if(oe(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let n=new Bo(t),s=Au(e._queryParams,n);return yi(s),new It(e._repo,e._path,s,!0)}};function JE(i){if(i==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(i==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(i==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return lr("orderByChild","path",i,!1),new Sf(i)}var bf=class extends Vt{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){Bu(e,"orderByKey");let t=Au(e._queryParams,gn);return yi(t),new It(e._repo,e._path,t,!0)}};function XE(){return new bf}var Af=class extends Vt{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){Bu(e,"orderByPriority");let t=Au(e._queryParams,Se);return yi(t),new It(e._repo,e._path,t,!0)}};function ZE(){return new Af}var Cf=class extends Vt{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){Bu(e,"orderByValue");let t=Au(e._queryParams,Uf);return yi(t),new It(e._repo,e._path,t,!0)}};function eT(){return new Cf}var Rf=class extends Vt{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(vn("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Iu(this._value,this._key)._apply(new Su(this._value,this._key)._apply(e))}};function tT(i,e){return ia("equalTo","key",e,!0),new Rf(i,e)}function Wt(i,...e){let t=he(i);for(let n of e)t=n._apply(t);return t}nR(Mt);aR(Mt);var YR="FIREBASE_DATABASE_EMULATOR_HOST",Pf={},JR=!1;function XR(i,e,t,n){i.repoInfo_=new eu(`${e}:${t}`,!1,i.repoInfo_.namespace,i.repoInfo_.webSocketOnly,i.repoInfo_.nodeAdmin,i.repoInfo_.persistenceKey,i.repoInfo_.includeNamespaceInQueryParams,!0),n&&(i.authTokenProvider_=n)}function dm(i,e,t,n,s){let r=n||i.options.databaseURL;r===void 0&&(i.options.projectId||_n("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),st("Using default host for project ",i.options.projectId),r=`${i.options.projectId}-default-rtdb.firebaseio.com`);let o=vf(r,s),a=o.repoInfo,u,c;typeof process<"u"&&process.env&&(c=process.env[YR]),c?(u=!0,r=`http://${c}?ns=${a.namespace}`,o=vf(r,s),a=o.repoInfo):u=!o.repoInfo.secure;let d=s&&u?new ko(ko.OWNER):new Dd(i.name,i.options,e);NE("Invalid Firebase Database URL",o),oe(o.path)||_n("Database URL must point to the root of a Firebase Database (not including a child path).");let f=eP(a,i,d,new xd(i.name,t));return new Nf(f,i)}function ZR(i,e){let t=Pf[e];(!t||t[i.key]!==i)&&_n(`Database ${e}(${i.repoInfo_}) has already been deleted.`),ME(i),delete t[i.key]}function eP(i,e,t,n){let s=Pf[e.name];s||(s={},Pf[e.name]=s);let r=s[i.toURLString()];return r&&_n("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new _f(i,JR,t,n),s[i.toURLString()]=r,r}var Nf=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(kR(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Mt(this._repo,ye())),this._rootInternal}_delete(){return this._rootInternal!==null&&(ZR(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&_n("Cannot call "+e+" on a deleted database.")}};function nT(){eE.IS_TRANSPORT_INITIALIZED&&mt("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function iT(){nT(),Fo.forceDisallow()}function sT(){nT(),$s.forceDisallow(),Fo.forceAllow()}function rT(i,e,t,n={}){i=he(i),i._checkNotDeleted("useEmulator"),i._instanceStarted&&_n("Cannot call useEmulator() after instance has already been initialized.");let s=i._repoInternal,r;if(s.repoInfo_.nodeAdmin)n.mockUserToken&&_n('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new ko(ko.OWNER);else if(n.mockUserToken){let o=typeof n.mockUserToken=="string"?n.mockUserToken:Nl(n.mockUserToken,i.app.options.projectId);r=new ko(o)}XR(s,e,t,r)}function oT(i){i=he(i),i._checkNotDeleted("goOffline"),ME(i._repo)}function aT(i){i=he(i),i._checkNotDeleted("goOnline"),jR(i._repo)}function lT(i,e){Vw(i,e)}function tP(i){kf(Ml),Ol(new mn("database",(e,{instanceIdentifier:t})=>{let n=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return dm(n,s,r,t)},"PUBLIC").setMultipleInstances(!0)),Qs(tw,nw,i),Qs(tw,nw,"esm2017")}var nP={".sv":"timestamp"};function uT(){return nP}function cT(i){return{".sv":{increment:i}}}var xf=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function hT(i,e,t){var n;if(i=he(i),kt("Reference.transaction",i._path),i.key===".length"||i.key===".keys")throw"Reference.transaction failed: "+i.key+" is a read-only object.";let s=(n=t?.applyLocally)!==null&&n!==void 0?n:!0,r=new wt,o=(u,c,d)=>{let f=null;u?r.reject(u):(f=new sr(d,new Mt(i._repo,i._path),Se),r.resolve(new xf(c,f)))},a=ju(i,()=>{});return zR(i._repo,i._path,e,o,a,s),r.promise}Lf.prototype.simpleListen=function(i,e){this.sendRequest("q",{p:i},e)};Lf.prototype.echo=function(i,e){this.sendRequest("echo",{d:i},e)};tP();var iP="@firebase/database-compat",sP="1.0.8";var rP=new Ks("@firebase/database-compat"),dT=function(i){let e="FIREBASE WARNING: "+i;rP.warn(e)};var oP=function(i,e,t,n){if(!(n&&t===void 0)&&typeof t!="boolean")throw new Error(Nt(i,e)+"must be a boolean.")},aP=function(i,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Nt(i,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var fm=class{constructor(e){this._delegate=e}cancel(e){Y("OnDisconnect.cancel",0,1,arguments.length),et("OnDisconnect.cancel","onComplete",e,!0);let t=this._delegate.cancel();return e&&t.then(()=>e(null),n=>e(n)),t}remove(e){Y("OnDisconnect.remove",0,1,arguments.length),et("OnDisconnect.remove","onComplete",e,!0);let t=this._delegate.remove();return e&&t.then(()=>e(null),n=>e(n)),t}set(e,t){Y("OnDisconnect.set",1,2,arguments.length),et("OnDisconnect.set","onComplete",t,!0);let n=this._delegate.set(e);return t&&n.then(()=>t(null),s=>t(s)),n}setWithPriority(e,t,n){Y("OnDisconnect.setWithPriority",2,3,arguments.length),et("OnDisconnect.setWithPriority","onComplete",n,!0);let s=this._delegate.setWithPriority(e,t);return n&&s.then(()=>n(null),r=>n(r)),s}update(e,t){if(Y("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let s={};for(let r=0;r<e.length;++r)s[""+r]=e[r];e=s,dT("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}et("OnDisconnect.update","onComplete",t,!0);let n=this._delegate.update(e);return t&&n.then(()=>t(null),s=>t(s)),n}};var mm=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return Y("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}};var is=class i{constructor(e,t){this._database=e,this._delegate=t}val(){return Y("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return Y("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return Y("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return Y("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return Y("DataSnapshot.child",0,1,arguments.length),e=String(e),lr("DataSnapshot.child","path",e,!1),new i(this._database,this._delegate.child(e))}hasChild(e){return Y("DataSnapshot.hasChild",1,1,arguments.length),lr("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return Y("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return Y("DataSnapshot.forEach",1,1,arguments.length),et("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new i(this._database,t)))}hasChildren(){return Y("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return Y("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return Y("DataSnapshot.ref",0,0,arguments.length),new qn(this._database,this._delegate.ref)}get ref(){return this.getRef()}},zu=class i{constructor(e,t){this.database=e,this._delegate=t}on(e,t,n,s){var r;Y("Query.on",2,4,arguments.length),et("Query.on","callback",t,!1);let o=i.getCancelAndContextArgs_("Query.on",n,s),a=(c,d)=>{t.call(o.context,new is(this.database,c),d)};a.userCallback=t,a.context=o.context;let u=(r=o.cancel)===null||r===void 0?void 0:r.bind(o.context);switch(e){case"value":return ju(this._delegate,a,u),t;case"child_added":return am(this._delegate,a,u),t;case"child_removed":return cm(this._delegate,a,u),t;case"child_changed":return lm(this._delegate,a,u),t;case"child_moved":return um(this._delegate,a,u),t;default:throw new Error(Nt("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,n){if(Y("Query.off",0,3,arguments.length),aP("Query.off",e,!0),et("Query.off","callback",t,!0),_d("Query.off","context",n,!0),t){let s=()=>{};s.userCallback=t,s.context=n,hm(this._delegate,e,s)}else hm(this._delegate,e)}get(){return GE(this._delegate).then(e=>new is(this.database,e))}once(e,t,n,s){Y("Query.once",1,4,arguments.length),et("Query.once","callback",t,!0);let r=i.getCancelAndContextArgs_("Query.once",n,s),o=new wt,a=(c,d)=>{let f=new is(this.database,c);t&&t.call(r.context,f,d),o.resolve(f)};a.userCallback=t,a.context=r.context;let u=c=>{r.cancel&&r.cancel.call(r.context,c),o.reject(c)};switch(e){case"value":ju(this._delegate,a,u,{onlyOnce:!0});break;case"child_added":am(this._delegate,a,u,{onlyOnce:!0});break;case"child_removed":cm(this._delegate,a,u,{onlyOnce:!0});break;case"child_changed":lm(this._delegate,a,u,{onlyOnce:!0});break;case"child_moved":um(this._delegate,a,u,{onlyOnce:!0});break;default:throw new Error(Nt("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return Y("Query.limitToFirst",1,1,arguments.length),new i(this.database,Wt(this._delegate,HE(e)))}limitToLast(e){return Y("Query.limitToLast",1,1,arguments.length),new i(this.database,Wt(this._delegate,YE(e)))}orderByChild(e){return Y("Query.orderByChild",1,1,arguments.length),new i(this.database,Wt(this._delegate,JE(e)))}orderByKey(){return Y("Query.orderByKey",0,0,arguments.length),new i(this.database,Wt(this._delegate,XE()))}orderByPriority(){return Y("Query.orderByPriority",0,0,arguments.length),new i(this.database,Wt(this._delegate,ZE()))}orderByValue(){return Y("Query.orderByValue",0,0,arguments.length),new i(this.database,Wt(this._delegate,eT()))}startAt(e=null,t){return Y("Query.startAt",0,2,arguments.length),new i(this.database,Wt(this._delegate,WE(e,t)))}startAfter(e=null,t){return Y("Query.startAfter",0,2,arguments.length),new i(this.database,Wt(this._delegate,$E(e,t)))}endAt(e=null,t){return Y("Query.endAt",0,2,arguments.length),new i(this.database,Wt(this._delegate,KE(e,t)))}endBefore(e=null,t){return Y("Query.endBefore",0,2,arguments.length),new i(this.database,Wt(this._delegate,QE(e,t)))}equalTo(e,t){return Y("Query.equalTo",1,2,arguments.length),new i(this.database,Wt(this._delegate,tT(e,t)))}toString(){return Y("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return Y("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(Y("Query.isEqual",1,1,arguments.length),!(e instanceof i)){let t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,n){let s={cancel:void 0,context:void 0};if(t&&n)s.cancel=t,et(e,"cancel",s.cancel,!0),s.context=n,_d(e,"context",s.context,!0);else if(t)if(typeof t=="object"&&t!==null)s.context=t;else if(typeof t=="function")s.cancel=t;else throw new Error(Nt(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return s}get ref(){return new qn(this.database,new Mt(this._delegate._repo,this._delegate._path))}},qn=class i extends zu{constructor(e,t){super(e,new It(t._repo,t._path,new zo,!1)),this.database=e,this._delegate=t}getKey(){return Y("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return Y("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new i(this.database,_i(this._delegate,e))}getParent(){Y("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new i(this.database,e):null}getRoot(){return Y("Reference.root",0,0,arguments.length),new i(this.database,this._delegate.root)}set(e,t){Y("Reference.set",1,2,arguments.length),et("Reference.set","onComplete",t,!0);let n=qu(this._delegate,e);return t&&n.then(()=>t(null),s=>t(s)),n}update(e,t){if(Y("Reference.update",1,2,arguments.length),Array.isArray(e)){let s={};for(let r=0;r<e.length;++r)s[""+r]=e[r];e=s,dT("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}kt("Reference.update",this._delegate._path),et("Reference.update","onComplete",t,!0);let n=zE(this._delegate,e);return t&&n.then(()=>t(null),s=>t(s)),n}setWithPriority(e,t,n){Y("Reference.setWithPriority",2,3,arguments.length),et("Reference.setWithPriority","onComplete",n,!0);let s=jE(this._delegate,e,t);return n&&s.then(()=>n(null),r=>n(r)),s}remove(e){Y("Reference.remove",0,1,arguments.length),et("Reference.remove","onComplete",e,!0);let t=UE(this._delegate);return e&&t.then(()=>e(null),n=>e(n)),t}transaction(e,t,n){Y("Reference.transaction",1,3,arguments.length),et("Reference.transaction","transactionUpdate",e,!1),et("Reference.transaction","onComplete",t,!0),oP("Reference.transaction","applyLocally",n,!0);let s=hT(this._delegate,e,{applyLocally:n}).then(r=>new mm(r.committed,new is(this.database,r.snapshot)));return t&&s.then(r=>t(null,r.committed,r.snapshot),r=>t(r,!1,null)),s}setPriority(e,t){Y("Reference.setPriority",1,2,arguments.length),et("Reference.setPriority","onComplete",t,!0);let n=qE(this._delegate,e);return t&&n.then(()=>t(null),s=>t(s)),n}push(e,t){Y("Reference.push",0,2,arguments.length),et("Reference.push","onComplete",t,!0);let n=BE(this._delegate,e),s=n.then(o=>new i(this.database,o));t&&s.then(()=>t(null),o=>t(o));let r=new i(this.database,n);return r.then=s.then.bind(s),r.catch=s.catch.bind(s,void 0),r}onDisconnect(){return kt("Reference.onDisconnect",this._delegate._path),new fm(new Eu(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};var ss=class{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:iT,forceLongPolling:sT}}useEmulator(e,t,n={}){rT(this._delegate,e,t,n)}ref(e){if(Y("database.ref",0,1,arguments.length),e instanceof qn){let t=om(this._delegate,e.toString());return new qn(this,t)}else{let t=rm(this._delegate,e);return new qn(this,t)}}refFromURL(e){Y("database.refFromURL",1,1,arguments.length);let n=om(this._delegate,e);return new qn(this,n)}goOffline(){return Y("database.goOffline",0,0,arguments.length),oT(this._delegate)}goOnline(){return Y("database.goOnline",0,0,arguments.length),aT(this._delegate)}};ss.ServerValue={TIMESTAMP:uT(),increment:i=>cT(i)};function lP({app:i,url:e,version:t,customAuthImpl:n,customAppCheckImpl:s,namespace:r,nodeAdmin:o=!1}){kf(t);let a=new yd("database-standalone"),u=new kl("auth-internal",a);u.setComponent(new mn("auth-internal",()=>n,"PRIVATE"));let c;return s&&(c=new kl("app-check-internal",a),c.setComponent(new mn("app-check-internal",()=>s,"PRIVATE"))),{instance:new ss(dm(i,u,c,e,o),i),namespace:r}}var uP=Object.freeze({__proto__:null,initStandalone:lP});var cP=ss.ServerValue;function hP(i){i.INTERNAL.registerComponent(new mn("database-compat",(e,{instanceIdentifier:t})=>{let n=e.getProvider("app-compat").getImmediate(),s=e.getProvider("database").getImmediate({identifier:t});return new ss(s,n)},"PUBLIC").setServiceProps({Reference:qn,Query:zu,Database:ss,DataSnapshot:is,enableLogging:lT,INTERNAL:uP,ServerValue:cP}).setMultipleInstances(!0)),i.registerVersion(iP,sP)}hP(ui);function oa(i,e,t="on",n=yl){return new _l(s=>{let r=null;return r=i[t](e,(o,a)=>{n.schedule(()=>{s.next({snapshot:o,prevKey:a})}),t==="once"&&n.schedule(()=>s.complete())},o=>{n.schedule(()=>s.error(o))}),t==="on"?{unsubscribe(){r!=null&&i.off(e,r)}}:{unsubscribe(){}}}).pipe(Qe(s=>{let{snapshot:r,prevKey:o}=s,a=null;return r.exists()&&(a=r.key),{type:e,payload:r,prevKey:o,key:a}}),av())}function pP(i){return typeof i=="string"}function gP(i){return typeof i.exportVal=="function"}function _T(i){return i==null}function yT(i){return typeof i.set=="function"}function fT(i,e){return yT(e)?e:i.ref(e)}function vT(i,e){if(pP(i))return e.stringCase();if(yT(i))return e.firebaseCase();if(gP(i))return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof i}`)}function wT(i){return(_T(i)||i.length===0)&&(i=["child_added","child_removed","child_changed","child_moved"]),i}function ET(i,e,t){e=wT(e);let n=e.map(s=>oa(i,s,"on",t));return ld(...n)}function _P(i,e,t){let n=ET(i,e).pipe(Ki((s,r)=>[...s,r],[]));return vP(i,n,t)}function yP(i,e){return oa(i,"value","on",e).pipe(Qe(t=>{let n;return t.payload.forEach(s=>(n=s.key,!1)),{data:t,lastKeyToLoad:n}}))}function vP(i,e,t){return yP(i,t).pipe(cv(e),Qe(([s,r])=>{let o=s.lastKeyToLoad,a=r.map(u=>u.key);return{actions:r,lastKeyToLoad:o,loadedKeys:a}}),lv(s=>s.loadedKeys.indexOf(s.lastKeyToLoad)===-1),Qe(s=>s.actions))}function mT(i,e){return function(n,s){return vT(n,{stringCase:()=>i.child(n)[e](s),firebaseCase:()=>n[e](s),snapshotCase:()=>n.ref[e](s)})}}function wP(i){return function(t){return t?vT(t,{stringCase:()=>i.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):i.remove()}}function EP(i,e,t){return oa(i,"value","once",t).pipe(uv(n=>{let s=[yo(n)];return e.forEach(r=>s.push(oa(i,r,"on",t))),ld(...s).pipe(Ki(IP,[]))}),vl())}function TT(i,e){let t=i.length;for(let n=0;n<t;n++)if(i[n].payload.key===e)return n;return-1}function TP(i,e){if(_T(e))return 0;{let t=TT(i,e);return t===-1?i.length:t+1}}function IP(i,e){let{payload:t,prevKey:n,key:s}=e,r=TT(i,s),o=TP(i,n);switch(e.type){case"value":if(e.payload?.exists()){let a=null;e.payload.forEach(u=>{let c={payload:u,type:"value",prevKey:a,key:u.key};return a=u.key,i=[...i,c],!1})}return i;case"child_added":if(r>-1)(i[r-1]?.key||null)!==n&&(i=i.filter(u=>u.payload.key!==t.key),i.splice(o,0,e));else{if(n==null)return[e,...i];i=i.slice(),i.splice(o,0,e)}return i;case"child_removed":return i.filter(a=>a.payload.key!==t.key);case"child_changed":return i.map(a=>a.payload.key===s?e:a);case"child_moved":if(r>-1){let a=i.splice(r,1)[0];return i=i.slice(),i.splice(o,0,a),i}return i;default:return i}}function pT(i,e,t){return e=wT(e),EP(i,e,t)}function SP(i,e){let t=e.schedulers.outsideAngular,n=e.schedulers.ngZone.run(()=>i.ref);return{query:i,update:mT(n,"update"),set:mT(n,"set"),push:s=>n.push(s),remove:wP(n),snapshotChanges(s){return pT(i,s,t).pipe(tt)},stateChanges(s){return ET(i,s,t).pipe(tt)},auditTrail(s){return _P(i,s,t).pipe(tt)},valueChanges(s,r){return pT(i,s,t).pipe(Qe(a=>a.map(u=>r&&r.idField?Zt(xe({},u.payload.val()),{[r.idField]:u.key}):u.payload.val())),tt)}}}function gT(i,e){return function(){return oa(i,"value","on",e)}}function bP(i,e){return{query:i,snapshotChanges(){return gT(i,e.schedulers.outsideAngular)().pipe(tt)},update(t){return i.ref.update(t)},set(t){return i.ref.set(t)},remove(){return i.ref.remove()},valueChanges(){return gT(i,e.schedulers.outsideAngular)().pipe(tt,Qe(n=>n.payload.exists()?n.payload.val():null))}}}var AP=new hn("angularfire2.realtimeDatabaseURL"),CP=new hn("angularfire2.database.use-emulator"),RP=(()=>{class i{schedulers;database;constructor(t,n,s,r,o,a,u,c,d,f,p,_,E,S,R){this.schedulers=a;let V=u,B=ql(t,o,n);c&&Hl(B,o,d,p,_,E,f,S),this.database=jl(`${B.name}.database.${s}`,"AngularFireDatabase",B.name,()=>{let F=o.runOutsideAngular(()=>B.database(s||void 0));return V&&F.useEmulator(...V),F},[V])}list(t,n){let s=this.schedulers.ngZone.runOutsideAngular(()=>fT(this.database,t)),r=s;return n&&(r=n(s)),SP(r,this)}object(t){let n=this.schedulers.ngZone.runOutsideAngular(()=>fT(this.database,t));return bP(n,this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}static \u0275fac=function(n){return new(n||i)(J(Bl),J(Ul,8),J(AP,8),J(Il),J(Fn),J(Ll),J(CP,8),J(Yl,8),J(zl,8),J(Gl,8),J(Kl,8),J(Ql,8),J(Wl,8),J($l,8),J(Fl,8))};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"any"})}return i})(),IT=(()=>{class i{constructor(){ui.registerVersion("angularfire",Vl.full,"rtdb-compat")}static \u0275fac=function(n){return new(n||i)};static \u0275mod=js({type:i});static \u0275inj=qs({providers:[RP]})}return i})();var ST=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},bT={};var vi,pm;(function(){var i;function e(T,y){function w(){}w.prototype=y.prototype,T.D=y.prototype,T.prototype=new w,T.prototype.constructor=T,T.C=function(I,b,C){for(var v=Array(arguments.length-2),qt=2;qt<arguments.length;qt++)v[qt-2]=arguments[qt];return y.prototype[b].apply(I,v)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(T,y,w){w||(w=0);var I=Array(16);if(typeof y=="string")for(var b=0;16>b;++b)I[b]=y.charCodeAt(w++)|y.charCodeAt(w++)<<8|y.charCodeAt(w++)<<16|y.charCodeAt(w++)<<24;else for(b=0;16>b;++b)I[b]=y[w++]|y[w++]<<8|y[w++]<<16|y[w++]<<24;y=T.g[0],w=T.g[1],b=T.g[2];var C=T.g[3],v=y+(C^w&(b^C))+I[0]+3614090360&4294967295;y=w+(v<<7&4294967295|v>>>25),v=C+(b^y&(w^b))+I[1]+3905402710&4294967295,C=y+(v<<12&4294967295|v>>>20),v=b+(w^C&(y^w))+I[2]+606105819&4294967295,b=C+(v<<17&4294967295|v>>>15),v=w+(y^b&(C^y))+I[3]+3250441966&4294967295,w=b+(v<<22&4294967295|v>>>10),v=y+(C^w&(b^C))+I[4]+4118548399&4294967295,y=w+(v<<7&4294967295|v>>>25),v=C+(b^y&(w^b))+I[5]+1200080426&4294967295,C=y+(v<<12&4294967295|v>>>20),v=b+(w^C&(y^w))+I[6]+2821735955&4294967295,b=C+(v<<17&4294967295|v>>>15),v=w+(y^b&(C^y))+I[7]+4249261313&4294967295,w=b+(v<<22&4294967295|v>>>10),v=y+(C^w&(b^C))+I[8]+1770035416&4294967295,y=w+(v<<7&4294967295|v>>>25),v=C+(b^y&(w^b))+I[9]+2336552879&4294967295,C=y+(v<<12&4294967295|v>>>20),v=b+(w^C&(y^w))+I[10]+4294925233&4294967295,b=C+(v<<17&4294967295|v>>>15),v=w+(y^b&(C^y))+I[11]+2304563134&4294967295,w=b+(v<<22&4294967295|v>>>10),v=y+(C^w&(b^C))+I[12]+1804603682&4294967295,y=w+(v<<7&4294967295|v>>>25),v=C+(b^y&(w^b))+I[13]+4254626195&4294967295,C=y+(v<<12&4294967295|v>>>20),v=b+(w^C&(y^w))+I[14]+2792965006&4294967295,b=C+(v<<17&4294967295|v>>>15),v=w+(y^b&(C^y))+I[15]+1236535329&4294967295,w=b+(v<<22&4294967295|v>>>10),v=y+(b^C&(w^b))+I[1]+4129170786&4294967295,y=w+(v<<5&4294967295|v>>>27),v=C+(w^b&(y^w))+I[6]+3225465664&4294967295,C=y+(v<<9&4294967295|v>>>23),v=b+(y^w&(C^y))+I[11]+643717713&4294967295,b=C+(v<<14&4294967295|v>>>18),v=w+(C^y&(b^C))+I[0]+3921069994&4294967295,w=b+(v<<20&4294967295|v>>>12),v=y+(b^C&(w^b))+I[5]+3593408605&4294967295,y=w+(v<<5&4294967295|v>>>27),v=C+(w^b&(y^w))+I[10]+38016083&4294967295,C=y+(v<<9&4294967295|v>>>23),v=b+(y^w&(C^y))+I[15]+3634488961&4294967295,b=C+(v<<14&4294967295|v>>>18),v=w+(C^y&(b^C))+I[4]+3889429448&4294967295,w=b+(v<<20&4294967295|v>>>12),v=y+(b^C&(w^b))+I[9]+568446438&4294967295,y=w+(v<<5&4294967295|v>>>27),v=C+(w^b&(y^w))+I[14]+3275163606&4294967295,C=y+(v<<9&4294967295|v>>>23),v=b+(y^w&(C^y))+I[3]+4107603335&4294967295,b=C+(v<<14&4294967295|v>>>18),v=w+(C^y&(b^C))+I[8]+1163531501&4294967295,w=b+(v<<20&4294967295|v>>>12),v=y+(b^C&(w^b))+I[13]+2850285829&4294967295,y=w+(v<<5&4294967295|v>>>27),v=C+(w^b&(y^w))+I[2]+4243563512&4294967295,C=y+(v<<9&4294967295|v>>>23),v=b+(y^w&(C^y))+I[7]+1735328473&4294967295,b=C+(v<<14&4294967295|v>>>18),v=w+(C^y&(b^C))+I[12]+2368359562&4294967295,w=b+(v<<20&4294967295|v>>>12),v=y+(w^b^C)+I[5]+4294588738&4294967295,y=w+(v<<4&4294967295|v>>>28),v=C+(y^w^b)+I[8]+2272392833&4294967295,C=y+(v<<11&4294967295|v>>>21),v=b+(C^y^w)+I[11]+1839030562&4294967295,b=C+(v<<16&4294967295|v>>>16),v=w+(b^C^y)+I[14]+4259657740&4294967295,w=b+(v<<23&4294967295|v>>>9),v=y+(w^b^C)+I[1]+2763975236&4294967295,y=w+(v<<4&4294967295|v>>>28),v=C+(y^w^b)+I[4]+1272893353&4294967295,C=y+(v<<11&4294967295|v>>>21),v=b+(C^y^w)+I[7]+4139469664&4294967295,b=C+(v<<16&4294967295|v>>>16),v=w+(b^C^y)+I[10]+3200236656&4294967295,w=b+(v<<23&4294967295|v>>>9),v=y+(w^b^C)+I[13]+681279174&4294967295,y=w+(v<<4&4294967295|v>>>28),v=C+(y^w^b)+I[0]+3936430074&4294967295,C=y+(v<<11&4294967295|v>>>21),v=b+(C^y^w)+I[3]+3572445317&4294967295,b=C+(v<<16&4294967295|v>>>16),v=w+(b^C^y)+I[6]+76029189&4294967295,w=b+(v<<23&4294967295|v>>>9),v=y+(w^b^C)+I[9]+3654602809&4294967295,y=w+(v<<4&4294967295|v>>>28),v=C+(y^w^b)+I[12]+3873151461&4294967295,C=y+(v<<11&4294967295|v>>>21),v=b+(C^y^w)+I[15]+530742520&4294967295,b=C+(v<<16&4294967295|v>>>16),v=w+(b^C^y)+I[2]+3299628645&4294967295,w=b+(v<<23&4294967295|v>>>9),v=y+(b^(w|~C))+I[0]+4096336452&4294967295,y=w+(v<<6&4294967295|v>>>26),v=C+(w^(y|~b))+I[7]+1126891415&4294967295,C=y+(v<<10&4294967295|v>>>22),v=b+(y^(C|~w))+I[14]+2878612391&4294967295,b=C+(v<<15&4294967295|v>>>17),v=w+(C^(b|~y))+I[5]+4237533241&4294967295,w=b+(v<<21&4294967295|v>>>11),v=y+(b^(w|~C))+I[12]+1700485571&4294967295,y=w+(v<<6&4294967295|v>>>26),v=C+(w^(y|~b))+I[3]+2399980690&4294967295,C=y+(v<<10&4294967295|v>>>22),v=b+(y^(C|~w))+I[10]+4293915773&4294967295,b=C+(v<<15&4294967295|v>>>17),v=w+(C^(b|~y))+I[1]+2240044497&4294967295,w=b+(v<<21&4294967295|v>>>11),v=y+(b^(w|~C))+I[8]+1873313359&4294967295,y=w+(v<<6&4294967295|v>>>26),v=C+(w^(y|~b))+I[15]+4264355552&4294967295,C=y+(v<<10&4294967295|v>>>22),v=b+(y^(C|~w))+I[6]+2734768916&4294967295,b=C+(v<<15&4294967295|v>>>17),v=w+(C^(b|~y))+I[13]+1309151649&4294967295,w=b+(v<<21&4294967295|v>>>11),v=y+(b^(w|~C))+I[4]+4149444226&4294967295,y=w+(v<<6&4294967295|v>>>26),v=C+(w^(y|~b))+I[11]+3174756917&4294967295,C=y+(v<<10&4294967295|v>>>22),v=b+(y^(C|~w))+I[2]+718787259&4294967295,b=C+(v<<15&4294967295|v>>>17),v=w+(C^(b|~y))+I[9]+3951481745&4294967295,T.g[0]=T.g[0]+y&4294967295,T.g[1]=T.g[1]+(b+(v<<21&4294967295|v>>>11))&4294967295,T.g[2]=T.g[2]+b&4294967295,T.g[3]=T.g[3]+C&4294967295}n.prototype.u=function(T,y){y===void 0&&(y=T.length);for(var w=y-this.blockSize,I=this.B,b=this.h,C=0;C<y;){if(b==0)for(;C<=w;)s(this,T,C),C+=this.blockSize;if(typeof T=="string"){for(;C<y;)if(I[b++]=T.charCodeAt(C++),b==this.blockSize){s(this,I),b=0;break}}else for(;C<y;)if(I[b++]=T[C++],b==this.blockSize){s(this,I),b=0;break}}this.h=b,this.o+=y},n.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var y=1;y<T.length-8;++y)T[y]=0;var w=8*this.o;for(y=T.length-8;y<T.length;++y)T[y]=w&255,w/=256;for(this.u(T),T=Array(16),y=w=0;4>y;++y)for(var I=0;32>I;I+=8)T[w++]=this.g[y]>>>I&255;return T};function r(T,y){var w=a;return Object.prototype.hasOwnProperty.call(w,T)?w[T]:w[T]=y(T)}function o(T,y){this.h=y;for(var w=[],I=!0,b=T.length-1;0<=b;b--){var C=T[b]|0;I&&C==y||(w[b]=C,I=!1)}this.g=w}var a={};function u(T){return-128<=T&&128>T?r(T,function(y){return new o([y|0],0>y?-1:0)}):new o([T|0],0>T?-1:0)}function c(T){if(isNaN(T)||!isFinite(T))return f;if(0>T)return R(c(-T));for(var y=[],w=1,I=0;T>=w;I++)y[I]=T/w|0,w*=4294967296;return new o(y,0)}function d(T,y){if(T.length==0)throw Error("number format error: empty string");if(y=y||10,2>y||36<y)throw Error("radix out of range: "+y);if(T.charAt(0)=="-")return R(d(T.substring(1),y));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=c(Math.pow(y,8)),I=f,b=0;b<T.length;b+=8){var C=Math.min(8,T.length-b),v=parseInt(T.substring(b,b+C),y);8>C?(C=c(Math.pow(y,C)),I=I.j(C).add(c(v))):(I=I.j(w),I=I.add(c(v)))}return I}var f=u(0),p=u(1),_=u(16777216);i=o.prototype,i.m=function(){if(S(this))return-R(this).m();for(var T=0,y=1,w=0;w<this.g.length;w++){var I=this.i(w);T+=(0<=I?I:4294967296+I)*y,y*=4294967296}return T},i.toString=function(T){if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(E(this))return"0";if(S(this))return"-"+R(this).toString(T);for(var y=c(Math.pow(T,6)),w=this,I="";;){var b=K(w,y).g;w=V(w,b.j(y));var C=((0<w.g.length?w.g[0]:w.h)>>>0).toString(T);if(w=b,E(w))return C+I;for(;6>C.length;)C="0"+C;I=C+I}},i.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h};function E(T){if(T.h!=0)return!1;for(var y=0;y<T.g.length;y++)if(T.g[y]!=0)return!1;return!0}function S(T){return T.h==-1}i.l=function(T){return T=V(this,T),S(T)?-1:E(T)?0:1};function R(T){for(var y=T.g.length,w=[],I=0;I<y;I++)w[I]=~T.g[I];return new o(w,~T.h).add(p)}i.abs=function(){return S(this)?R(this):this},i.add=function(T){for(var y=Math.max(this.g.length,T.g.length),w=[],I=0,b=0;b<=y;b++){var C=I+(this.i(b)&65535)+(T.i(b)&65535),v=(C>>>16)+(this.i(b)>>>16)+(T.i(b)>>>16);I=v>>>16,C&=65535,v&=65535,w[b]=v<<16|C}return new o(w,w[w.length-1]&-2147483648?-1:0)};function V(T,y){return T.add(R(y))}i.j=function(T){if(E(this)||E(T))return f;if(S(this))return S(T)?R(this).j(R(T)):R(R(this).j(T));if(S(T))return R(this.j(R(T)));if(0>this.l(_)&&0>T.l(_))return c(this.m()*T.m());for(var y=this.g.length+T.g.length,w=[],I=0;I<2*y;I++)w[I]=0;for(I=0;I<this.g.length;I++)for(var b=0;b<T.g.length;b++){var C=this.i(I)>>>16,v=this.i(I)&65535,qt=T.i(b)>>>16,Zn=T.i(b)&65535;w[2*I+2*b]+=v*Zn,B(w,2*I+2*b),w[2*I+2*b+1]+=C*Zn,B(w,2*I+2*b+1),w[2*I+2*b+1]+=v*qt,B(w,2*I+2*b+1),w[2*I+2*b+2]+=C*qt,B(w,2*I+2*b+2)}for(I=0;I<y;I++)w[I]=w[2*I+1]<<16|w[2*I];for(I=y;I<2*y;I++)w[I]=0;return new o(w,0)};function B(T,y){for(;(T[y]&65535)!=T[y];)T[y+1]+=T[y]>>>16,T[y]&=65535,y++}function F(T,y){this.g=T,this.h=y}function K(T,y){if(E(y))throw Error("division by zero");if(E(T))return new F(f,f);if(S(T))return y=K(R(T),y),new F(R(y.g),R(y.h));if(S(y))return y=K(T,R(y)),new F(R(y.g),y.h);if(30<T.g.length){if(S(T)||S(y))throw Error("slowDivide_ only works with positive integers.");for(var w=p,I=y;0>=I.l(T);)w=ne(w),I=ne(I);var b=H(w,1),C=H(I,1);for(I=H(I,2),w=H(w,2);!E(I);){var v=C.add(I);0>=v.l(T)&&(b=b.add(w),C=v),I=H(I,1),w=H(w,1)}return y=V(T,b.j(y)),new F(b,y)}for(b=f;0<=T.l(y);){for(w=Math.max(1,Math.floor(T.m()/y.m())),I=Math.ceil(Math.log(w)/Math.LN2),I=48>=I?1:Math.pow(2,I-48),C=c(w),v=C.j(y);S(v)||0<v.l(T);)w-=I,C=c(w),v=C.j(y);E(C)&&(C=p),b=b.add(C),T=V(T,v)}return new F(b,T)}i.A=function(T){return K(this,T).h},i.and=function(T){for(var y=Math.max(this.g.length,T.g.length),w=[],I=0;I<y;I++)w[I]=this.i(I)&T.i(I);return new o(w,this.h&T.h)},i.or=function(T){for(var y=Math.max(this.g.length,T.g.length),w=[],I=0;I<y;I++)w[I]=this.i(I)|T.i(I);return new o(w,this.h|T.h)},i.xor=function(T){for(var y=Math.max(this.g.length,T.g.length),w=[],I=0;I<y;I++)w[I]=this.i(I)^T.i(I);return new o(w,this.h^T.h)};function ne(T){for(var y=T.g.length+1,w=[],I=0;I<y;I++)w[I]=T.i(I)<<1|T.i(I-1)>>>31;return new o(w,T.h)}function H(T,y){var w=y>>5;y%=32;for(var I=T.g.length-w,b=[],C=0;C<I;C++)b[C]=0<y?T.i(C+w)>>>y|T.i(C+w+1)<<32-y:T.i(C+w);return new o(b,T.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,pm=bT.Md5=n,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=d,vi=bT.Integer=o}).apply(typeof ST<"u"?ST:typeof self<"u"?self:typeof window<"u"?window:{});var Gu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},jn={};var gm,PP,cr,_m,aa,Ku,ym,vm,wm;(function(){var i,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(l,h,m){return l==Array.prototype||l==Object.prototype||(l[h]=m.value),l};function t(l){l=[typeof globalThis=="object"&&globalThis,l,typeof window=="object"&&window,typeof self=="object"&&self,typeof Gu=="object"&&Gu];for(var h=0;h<l.length;++h){var m=l[h];if(m&&m.Math==Math)return m}throw Error("Cannot find global object")}var n=t(this);function s(l,h){if(h)e:{var m=n;l=l.split(".");for(var g=0;g<l.length-1;g++){var A=l[g];if(!(A in m))break e;m=m[A]}l=l[l.length-1],g=m[l],h=h(g),h!=g&&h!=null&&e(m,l,{configurable:!0,writable:!0,value:h})}}function r(l,h){l instanceof String&&(l+="");var m=0,g=!1,A={next:function(){if(!g&&m<l.length){var N=m++;return{value:h(N,l[N]),done:!1}}return g=!0,{done:!0,value:void 0}}};return A[Symbol.iterator]=function(){return A},A}s("Array.prototype.values",function(l){return l||function(){return r(this,function(h,m){return m})}});var o=o||{},a=this||self;function u(l){var h=typeof l;return h=h!="object"?h:l?Array.isArray(l)?"array":h:"null",h=="array"||h=="object"&&typeof l.length=="number"}function c(l){var h=typeof l;return h=="object"&&l!=null||h=="function"}function d(l,h,m){return l.call.apply(l.bind,arguments)}function f(l,h,m){if(!l)throw Error();if(2<arguments.length){var g=Array.prototype.slice.call(arguments,2);return function(){var A=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(A,g),l.apply(h,A)}}return function(){return l.apply(h,arguments)}}function p(l,h,m){return p=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:f,p.apply(null,arguments)}function _(l,h){var m=Array.prototype.slice.call(arguments,1);return function(){var g=m.slice();return g.push.apply(g,arguments),l.apply(this,g)}}function E(l,h){function m(){}m.prototype=h.prototype,l.aa=h.prototype,l.prototype=new m,l.prototype.constructor=l,l.Qb=function(g,A,N){for(var L=Array(arguments.length-2),Ee=2;Ee<arguments.length;Ee++)L[Ee-2]=arguments[Ee];return h.prototype[A].apply(g,L)}}function S(l){let h=l.length;if(0<h){let m=Array(h);for(let g=0;g<h;g++)m[g]=l[g];return m}return[]}function R(l,h){for(let m=1;m<arguments.length;m++){let g=arguments[m];if(u(g)){let A=l.length||0,N=g.length||0;l.length=A+N;for(let L=0;L<N;L++)l[A+L]=g[L]}else l.push(g)}}class V{constructor(h,m){this.i=h,this.j=m,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function B(l){return/^[\s\xa0]*$/.test(l)}function F(){var l=a.navigator;return l&&(l=l.userAgent)?l:""}function K(l){return K[" "](l),l}K[" "]=function(){};var ne=F().indexOf("Gecko")!=-1&&!(F().toLowerCase().indexOf("webkit")!=-1&&F().indexOf("Edge")==-1)&&!(F().indexOf("Trident")!=-1||F().indexOf("MSIE")!=-1)&&F().indexOf("Edge")==-1;function H(l,h,m){for(let g in l)h.call(m,l[g],g,l)}function T(l,h){for(let m in l)h.call(void 0,l[m],m,l)}function y(l){let h={};for(let m in l)h[m]=l[m];return h}let w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function I(l,h){let m,g;for(let A=1;A<arguments.length;A++){g=arguments[A];for(m in g)l[m]=g[m];for(let N=0;N<w.length;N++)m=w[N],Object.prototype.hasOwnProperty.call(g,m)&&(l[m]=g[m])}}function b(l){var h=1;l=l.split(":");let m=[];for(;0<h&&l.length;)m.push(l.shift()),h--;return l.length&&m.push(l.join(":")),m}function C(l){a.setTimeout(()=>{throw l},0)}function v(){var l=le;let h=null;return l.g&&(h=l.g,l.g=l.g.next,l.g||(l.h=null),h.next=null),h}class qt{constructor(){this.h=this.g=null}add(h,m){let g=Zn.get();g.set(h,m),this.h?this.h.next=g:this.g=g,this.h=g}}var Zn=new V(()=>new z,l=>l.reset());class z{constructor(){this.next=this.g=this.h=null}set(h,m){this.h=h,this.g=m,this.next=null}reset(){this.next=this.g=this.h=null}}let Q,$=!1,le=new qt,qe=()=>{let l=a.Promise.resolve(void 0);Q=()=>{l.then(jt)}};var jt=()=>{for(var l;l=v();){try{l.h.call(l.g)}catch(m){C(m)}var h=Zn;h.j(l),100>h.h&&(h.h++,l.next=h.g,h.g=l)}$=!1};function Fe(){this.s=this.s,this.C=this.C}Fe.prototype.s=!1,Fe.prototype.ma=function(){this.s||(this.s=!0,this.N())},Fe.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ae(l,h){this.type=l,this.g=this.target=h,this.defaultPrevented=!1}Ae.prototype.h=function(){this.defaultPrevented=!0};var Ce=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var l=!1,h=Object.defineProperty({},"passive",{get:function(){l=!0}});try{let m=()=>{};a.addEventListener("test",m,h),a.removeEventListener("test",m,h)}catch{}return l}();function ei(l,h){if(Ae.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l){var m=this.type=l.type,g=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;if(this.target=l.target||l.srcElement,this.g=h,h=l.relatedTarget){if(ne){e:{try{K(h.nodeName);var A=!0;break e}catch{}A=!1}A||(h=null)}}else m=="mouseover"?h=l.fromElement:m=="mouseout"&&(h=l.toElement);this.relatedTarget=h,g?(this.clientX=g.clientX!==void 0?g.clientX:g.pageX,this.clientY=g.clientY!==void 0?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0):(this.clientX=l.clientX!==void 0?l.clientX:l.pageX,this.clientY=l.clientY!==void 0?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType=typeof l.pointerType=="string"?l.pointerType:Vh[l.pointerType]||"",this.state=l.state,this.i=l,l.defaultPrevented&&ei.aa.h.call(this)}}E(ei,Ae);var Vh={2:"touch",3:"pen",4:"mouse"};ei.prototype.h=function(){ei.aa.h.call(this);var l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var Le="closure_listenable_"+(1e6*Math.random()|0),kn=0;function Ct(l,h,m,g,A){this.listener=l,this.proxy=null,this.src=h,this.type=m,this.capture=!!g,this.ha=A,this.key=++kn,this.da=this.fa=!1}function On(l){l.da=!0,l.listener=null,l.proxy=null,l.src=null,l.ha=null}function ti(l){this.src=l,this.g={},this.h=0}ti.prototype.add=function(l,h,m,g,A){var N=l.toString();l=this.g[N],l||(l=this.g[N]=[],this.h++);var L=Lh(l,h,g,A);return-1<L?(h=l[L],m||(h.fa=!1)):(h=new Ct(h,this.src,N,!!g,A),h.fa=m,l.push(h)),h};function Fh(l,h){var m=h.type;if(m in l.g){var g=l.g[m],A=Array.prototype.indexOf.call(g,h,void 0),N;(N=0<=A)&&Array.prototype.splice.call(g,A,1),N&&(On(h),l.g[m].length==0&&(delete l.g[m],l.h--))}}function Lh(l,h,m,g){for(var A=0;A<l.length;++A){var N=l[A];if(!N.da&&N.listener==h&&N.capture==!!m&&N.ha==g)return A}return-1}var Bh="closure_lm_"+(1e6*Math.random()|0),Uh={};function oy(l,h,m,g,A){if(g&&g.once)return ly(l,h,m,g,A);if(Array.isArray(h)){for(var N=0;N<h.length;N++)oy(l,h[N],m,g,A);return null}return m=Gh(m),l&&l[Le]?l.K(h,m,c(g)?!!g.capture:!!g,A):ay(l,h,m,!1,g,A)}function ay(l,h,m,g,A,N){if(!h)throw Error("Invalid event type");var L=c(A)?!!A.capture:!!A,Ee=jh(l);if(Ee||(l[Bh]=Ee=new ti(l)),m=Ee.add(h,m,g,L,N),m.proxy)return m;if(g=Wb(),m.proxy=g,g.src=l,g.listener=m,l.addEventListener)Ce||(A=L),A===void 0&&(A=!1),l.addEventListener(h.toString(),g,A);else if(l.attachEvent)l.attachEvent(cy(h.toString()),g);else if(l.addListener&&l.removeListener)l.addListener(g);else throw Error("addEventListener and attachEvent are unavailable.");return m}function Wb(){function l(m){return h.call(l.src,l.listener,m)}let h=$b;return l}function ly(l,h,m,g,A){if(Array.isArray(h)){for(var N=0;N<h.length;N++)ly(l,h[N],m,g,A);return null}return m=Gh(m),l&&l[Le]?l.L(h,m,c(g)?!!g.capture:!!g,A):ay(l,h,m,!0,g,A)}function uy(l,h,m,g,A){if(Array.isArray(h))for(var N=0;N<h.length;N++)uy(l,h[N],m,g,A);else g=c(g)?!!g.capture:!!g,m=Gh(m),l&&l[Le]?(l=l.i,h=String(h).toString(),h in l.g&&(N=l.g[h],m=Lh(N,m,g,A),-1<m&&(On(N[m]),Array.prototype.splice.call(N,m,1),N.length==0&&(delete l.g[h],l.h--)))):l&&(l=jh(l))&&(h=l.g[h.toString()],l=-1,h&&(l=Lh(h,m,g,A)),(m=-1<l?h[l]:null)&&qh(m))}function qh(l){if(typeof l!="number"&&l&&!l.da){var h=l.src;if(h&&h[Le])Fh(h.i,l);else{var m=l.type,g=l.proxy;h.removeEventListener?h.removeEventListener(m,g,l.capture):h.detachEvent?h.detachEvent(cy(m),g):h.addListener&&h.removeListener&&h.removeListener(g),(m=jh(h))?(Fh(m,l),m.h==0&&(m.src=null,h[Bh]=null)):On(l)}}}function cy(l){return l in Uh?Uh[l]:Uh[l]="on"+l}function $b(l,h){if(l.da)l=!0;else{h=new ei(h,this);var m=l.listener,g=l.ha||l.src;l.fa&&qh(l),l=m.call(g,h)}return l}function jh(l){return l=l[Bh],l instanceof ti?l:null}var zh="__closure_events_fn_"+(1e9*Math.random()>>>0);function Gh(l){return typeof l=="function"?l:(l[zh]||(l[zh]=function(h){return l.handleEvent(h)}),l[zh])}function ct(){Fe.call(this),this.i=new ti(this),this.M=this,this.F=null}E(ct,Fe),ct.prototype[Le]=!0,ct.prototype.removeEventListener=function(l,h,m,g){uy(this,l,h,m,g)};function _t(l,h){var m,g=l.F;if(g)for(m=[];g;g=g.F)m.push(g);if(l=l.M,g=h.type||h,typeof h=="string")h=new Ae(h,l);else if(h instanceof Ae)h.target=h.target||l;else{var A=h;h=new Ae(g,l),I(h,A)}if(A=!0,m)for(var N=m.length-1;0<=N;N--){var L=h.g=m[N];A=nl(L,g,!0,h)&&A}if(L=h.g=l,A=nl(L,g,!0,h)&&A,A=nl(L,g,!1,h)&&A,m)for(N=0;N<m.length;N++)L=h.g=m[N],A=nl(L,g,!1,h)&&A}ct.prototype.N=function(){if(ct.aa.N.call(this),this.i){var l=this.i,h;for(h in l.g){for(var m=l.g[h],g=0;g<m.length;g++)On(m[g]);delete l.g[h],l.h--}}this.F=null},ct.prototype.K=function(l,h,m,g){return this.i.add(String(l),h,!1,m,g)},ct.prototype.L=function(l,h,m,g){return this.i.add(String(l),h,!0,m,g)};function nl(l,h,m,g){if(h=l.i.g[String(h)],!h)return!0;h=h.concat();for(var A=!0,N=0;N<h.length;++N){var L=h[N];if(L&&!L.da&&L.capture==m){var Ee=L.listener,ot=L.ha||L.src;L.fa&&Fh(l.i,L),A=Ee.call(ot,g)!==!1&&A}}return A&&!g.defaultPrevented}function hy(l,h,m){if(typeof l=="function")m&&(l=p(l,m));else if(l&&typeof l.handleEvent=="function")l=p(l.handleEvent,l);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:a.setTimeout(l,h||0)}function dy(l){l.g=hy(()=>{l.g=null,l.i&&(l.i=!1,dy(l))},l.l);let h=l.h;l.h=null,l.m.apply(null,h)}class Hb extends Fe{constructor(h,m){super(),this.m=h,this.l=m,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:dy(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function no(l){Fe.call(this),this.h=l,this.g={}}E(no,Fe);var fy=[];function my(l){H(l.g,function(h,m){this.g.hasOwnProperty(m)&&qh(h)},l),l.g={}}no.prototype.N=function(){no.aa.N.call(this),my(this)},no.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Kh=a.JSON.stringify,Yb=a.JSON.parse,Jb=class{stringify(l){return a.JSON.stringify(l,void 0)}parse(l){return a.JSON.parse(l,void 0)}};function Qh(){}Qh.prototype.h=null;function py(l){return l.h||(l.h=l.i())}function gy(){}var io={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Wh(){Ae.call(this,"d")}E(Wh,Ae);function $h(){Ae.call(this,"c")}E($h,Ae);var qi={},_y=null;function il(){return _y=_y||new ct}qi.La="serverreachability";function yy(l){Ae.call(this,qi.La,l)}E(yy,Ae);function so(l){let h=il();_t(h,new yy(h))}qi.STAT_EVENT="statevent";function vy(l,h){Ae.call(this,qi.STAT_EVENT,l),this.stat=h}E(vy,Ae);function yt(l){let h=il();_t(h,new vy(h,l))}qi.Ma="timingevent";function wy(l,h){Ae.call(this,qi.Ma,l),this.size=h}E(wy,Ae);function ro(l,h){if(typeof l!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){l()},h)}function oo(){this.g=!0}oo.prototype.xa=function(){this.g=!1};function Xb(l,h,m,g,A,N){l.info(function(){if(l.g)if(N)for(var L="",Ee=N.split("&"),ot=0;ot<Ee.length;ot++){var _e=Ee[ot].split("=");if(1<_e.length){var ht=_e[0];_e=_e[1];var dt=ht.split("_");L=2<=dt.length&&dt[1]=="type"?L+(ht+"="+_e+"&"):L+(ht+"=redacted&")}}else L=null;else L=N;return"XMLHTTP REQ ("+g+") [attempt "+A+"]: "+h+`
`+m+`
`+L})}function Zb(l,h,m,g,A,N,L){l.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+A+"]: "+h+`
`+m+`
`+N+" "+L})}function Fs(l,h,m,g){l.info(function(){return"XMLHTTP TEXT ("+h+"): "+tA(l,m)+(g?" "+g:"")})}function eA(l,h){l.info(function(){return"TIMEOUT: "+h})}oo.prototype.info=function(){};function tA(l,h){if(!l.g)return h;if(!h)return null;try{var m=JSON.parse(h);if(m){for(l=0;l<m.length;l++)if(Array.isArray(m[l])){var g=m[l];if(!(2>g.length)){var A=g[1];if(Array.isArray(A)&&!(1>A.length)){var N=A[0];if(N!="noop"&&N!="stop"&&N!="close")for(var L=1;L<A.length;L++)A[L]=""}}}}return Kh(m)}catch{return h}}var sl={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Ey={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Hh;function rl(){}E(rl,Qh),rl.prototype.g=function(){return new XMLHttpRequest},rl.prototype.i=function(){return{}},Hh=new rl;function ni(l,h,m,g){this.j=l,this.i=h,this.l=m,this.R=g||1,this.U=new no(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ty}function Ty(){this.i=null,this.g="",this.h=!1}var Iy={},Yh={};function Jh(l,h,m){l.L=1,l.v=ul(Mn(h)),l.m=m,l.P=!0,Sy(l,null)}function Sy(l,h){l.F=Date.now(),ol(l),l.A=Mn(l.v);var m=l.A,g=l.R;Array.isArray(g)||(g=[String(g)]),Ly(m.i,"t",g),l.C=0,m=l.j.J,l.h=new Ty,l.g=nv(l.j,m?h:null,!l.m),0<l.O&&(l.M=new Hb(p(l.Y,l,l.g),l.O)),h=l.U,m=l.g,g=l.ca;var A="readystatechange";Array.isArray(A)||(A&&(fy[0]=A.toString()),A=fy);for(var N=0;N<A.length;N++){var L=oy(m,A[N],g||h.handleEvent,!1,h.h||h);if(!L)break;h.g[L.key]=L}h=l.H?y(l.H):{},l.m?(l.u||(l.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",l.g.ea(l.A,l.u,l.m,h)):(l.u="GET",l.g.ea(l.A,l.u,null,h)),so(),Xb(l.i,l.u,l.A,l.l,l.R,l.m)}ni.prototype.ca=function(l){l=l.target;let h=this.M;h&&Vn(l)==3?h.j():this.Y(l)},ni.prototype.Y=function(l){try{if(l==this.g)e:{let dt=Vn(this.g);var h=this.g.Ba();let Us=this.g.Z();if(!(3>dt)&&(dt!=3||this.g&&(this.h.h||this.g.oa()||Ky(this.g)))){this.J||dt!=4||h==7||(h==8||0>=Us?so(3):so(2)),Xh(this);var m=this.g.Z();this.X=m;t:if(by(this)){var g=Ky(this.g);l="";var A=g.length,N=Vn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ji(this),ao(this);var L="";break t}this.h.i=new a.TextDecoder}for(h=0;h<A;h++)this.h.h=!0,l+=this.h.i.decode(g[h],{stream:!(N&&h==A-1)});g.length=0,this.h.g+=l,this.C=0,L=this.h.g}else L=this.g.oa();if(this.o=m==200,Zb(this.i,this.u,this.A,this.l,this.R,dt,m),this.o){if(this.T&&!this.K){t:{if(this.g){var Ee,ot=this.g;if((Ee=ot.g?ot.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!B(Ee)){var _e=Ee;break t}}_e=null}if(m=_e)Fs(this.i,this.l,m,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Zh(this,m);else{this.o=!1,this.s=3,yt(12),ji(this),ao(this);break e}}if(this.P){m=!0;let Xt;for(;!this.J&&this.C<L.length;)if(Xt=nA(this,L),Xt==Yh){dt==4&&(this.s=4,yt(14),m=!1),Fs(this.i,this.l,null,"[Incomplete Response]");break}else if(Xt==Iy){this.s=4,yt(15),Fs(this.i,this.l,L,"[Invalid Chunk]"),m=!1;break}else Fs(this.i,this.l,Xt,null),Zh(this,Xt);if(by(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),dt!=4||L.length!=0||this.h.h||(this.s=1,yt(16),m=!1),this.o=this.o&&m,!m)Fs(this.i,this.l,L,"[Invalid Chunked Response]"),ji(this),ao(this);else if(0<L.length&&!this.W){this.W=!0;var ht=this.j;ht.g==this&&ht.ba&&!ht.M&&(ht.j.info("Great, no buffering proxy detected. Bytes received: "+L.length),rd(ht),ht.M=!0,yt(11))}}else Fs(this.i,this.l,L,null),Zh(this,L);dt==4&&ji(this),this.o&&!this.J&&(dt==4?Xy(this.j,this):(this.o=!1,ol(this)))}else vA(this.g),m==400&&0<L.indexOf("Unknown SID")?(this.s=3,yt(12)):(this.s=0,yt(13)),ji(this),ao(this)}}}catch{}finally{}};function by(l){return l.g?l.u=="GET"&&l.L!=2&&l.j.Ca:!1}function nA(l,h){var m=l.C,g=h.indexOf(`
`,m);return g==-1?Yh:(m=Number(h.substring(m,g)),isNaN(m)?Iy:(g+=1,g+m>h.length?Yh:(h=h.slice(g,g+m),l.C=g+m,h)))}ni.prototype.cancel=function(){this.J=!0,ji(this)};function ol(l){l.S=Date.now()+l.I,Ay(l,l.I)}function Ay(l,h){if(l.B!=null)throw Error("WatchDog timer not null");l.B=ro(p(l.ba,l),h)}function Xh(l){l.B&&(a.clearTimeout(l.B),l.B=null)}ni.prototype.ba=function(){this.B=null;let l=Date.now();0<=l-this.S?(eA(this.i,this.A),this.L!=2&&(so(),yt(17)),ji(this),this.s=2,ao(this)):Ay(this,this.S-l)};function ao(l){l.j.G==0||l.J||Xy(l.j,l)}function ji(l){Xh(l);var h=l.M;h&&typeof h.ma=="function"&&h.ma(),l.M=null,my(l.U),l.g&&(h=l.g,l.g=null,h.abort(),h.ma())}function Zh(l,h){try{var m=l.j;if(m.G!=0&&(m.g==l||ed(m.h,l))){if(!l.K&&ed(m.h,l)&&m.G==3){try{var g=m.Da.g.parse(h)}catch{g=null}if(Array.isArray(g)&&g.length==3){var A=g;if(A[0]==0){e:if(!m.u){if(m.g)if(m.g.F+3e3<l.F)ml(m),dl(m);else break e;sd(m),yt(18)}}else m.za=A[1],0<m.za-m.T&&37500>A[2]&&m.F&&m.v==0&&!m.C&&(m.C=ro(p(m.Za,m),6e3));if(1>=Py(m.h)&&m.ca){try{m.ca()}catch{}m.ca=void 0}}else Gi(m,11)}else if((l.K||m.g==l)&&ml(m),!B(h))for(A=m.Da.g.parse(h),h=0;h<A.length;h++){let _e=A[h];if(m.T=_e[0],_e=_e[1],m.G==2)if(_e[0]=="c"){m.K=_e[1],m.ia=_e[2];let ht=_e[3];ht!=null&&(m.la=ht,m.j.info("VER="+m.la));let dt=_e[4];dt!=null&&(m.Aa=dt,m.j.info("SVER="+m.Aa));let Us=_e[5];Us!=null&&typeof Us=="number"&&0<Us&&(g=1.5*Us,m.L=g,m.j.info("backChannelRequestTimeoutMs_="+g)),g=m;let Xt=l.g;if(Xt){let gl=Xt.g?Xt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(gl){var N=g.h;N.g||gl.indexOf("spdy")==-1&&gl.indexOf("quic")==-1&&gl.indexOf("h2")==-1||(N.j=N.l,N.g=new Set,N.h&&(td(N,N.h),N.h=null))}if(g.D){let od=Xt.g?Xt.g.getResponseHeader("X-HTTP-Session-Id"):null;od&&(g.ya=od,Re(g.I,g.D,od))}}m.G=3,m.l&&m.l.ua(),m.ba&&(m.R=Date.now()-l.F,m.j.info("Handshake RTT: "+m.R+"ms")),g=m;var L=l;if(g.qa=tv(g,g.J?g.ia:null,g.W),L.K){Ny(g.h,L);var Ee=L,ot=g.L;ot&&(Ee.I=ot),Ee.B&&(Xh(Ee),ol(Ee)),g.g=L}else Yy(g);0<m.i.length&&fl(m)}else _e[0]!="stop"&&_e[0]!="close"||Gi(m,7);else m.G==3&&(_e[0]=="stop"||_e[0]=="close"?_e[0]=="stop"?Gi(m,7):id(m):_e[0]!="noop"&&m.l&&m.l.ta(_e),m.v=0)}}so(4)}catch{}}var iA=class{constructor(l,h){this.g=l,this.map=h}};function Cy(l){this.l=l||10,a.PerformanceNavigationTiming?(l=a.performance.getEntriesByType("navigation"),l=0<l.length&&(l[0].nextHopProtocol=="hq"||l[0].nextHopProtocol=="h2")):l=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=l?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ry(l){return l.h?!0:l.g?l.g.size>=l.j:!1}function Py(l){return l.h?1:l.g?l.g.size:0}function ed(l,h){return l.h?l.h==h:l.g?l.g.has(h):!1}function td(l,h){l.g?l.g.add(h):l.h=h}function Ny(l,h){l.h&&l.h==h?l.h=null:l.g&&l.g.has(h)&&l.g.delete(h)}Cy.prototype.cancel=function(){if(this.i=xy(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let l of this.g.values())l.cancel();this.g.clear()}};function xy(l){if(l.h!=null)return l.i.concat(l.h.D);if(l.g!=null&&l.g.size!==0){let h=l.i;for(let m of l.g.values())h=h.concat(m.D);return h}return S(l.i)}function sA(l){if(l.V&&typeof l.V=="function")return l.V();if(typeof Map<"u"&&l instanceof Map||typeof Set<"u"&&l instanceof Set)return Array.from(l.values());if(typeof l=="string")return l.split("");if(u(l)){for(var h=[],m=l.length,g=0;g<m;g++)h.push(l[g]);return h}h=[],m=0;for(g in l)h[m++]=l[g];return h}function rA(l){if(l.na&&typeof l.na=="function")return l.na();if(!l.V||typeof l.V!="function"){if(typeof Map<"u"&&l instanceof Map)return Array.from(l.keys());if(!(typeof Set<"u"&&l instanceof Set)){if(u(l)||typeof l=="string"){var h=[];l=l.length;for(var m=0;m<l;m++)h.push(m);return h}h=[],m=0;for(let g in l)h[m++]=g;return h}}}function Dy(l,h){if(l.forEach&&typeof l.forEach=="function")l.forEach(h,void 0);else if(u(l)||typeof l=="string")Array.prototype.forEach.call(l,h,void 0);else for(var m=rA(l),g=sA(l),A=g.length,N=0;N<A;N++)h.call(void 0,g[N],m&&m[N],l)}var ky=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function oA(l,h){if(l){l=l.split("&");for(var m=0;m<l.length;m++){var g=l[m].indexOf("="),A=null;if(0<=g){var N=l[m].substring(0,g);A=l[m].substring(g+1)}else N=l[m];h(N,A?decodeURIComponent(A.replace(/\+/g," ")):"")}}}function zi(l){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,l instanceof zi){this.h=l.h,al(this,l.j),this.o=l.o,this.g=l.g,ll(this,l.s),this.l=l.l;var h=l.i,m=new co;m.i=h.i,h.g&&(m.g=new Map(h.g),m.h=h.h),Oy(this,m),this.m=l.m}else l&&(h=String(l).match(ky))?(this.h=!1,al(this,h[1]||"",!0),this.o=lo(h[2]||""),this.g=lo(h[3]||"",!0),ll(this,h[4]),this.l=lo(h[5]||"",!0),Oy(this,h[6]||"",!0),this.m=lo(h[7]||"")):(this.h=!1,this.i=new co(null,this.h))}zi.prototype.toString=function(){var l=[],h=this.j;h&&l.push(uo(h,My,!0),":");var m=this.g;return(m||h=="file")&&(l.push("//"),(h=this.o)&&l.push(uo(h,My,!0),"@"),l.push(encodeURIComponent(String(m)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m=this.s,m!=null&&l.push(":",String(m))),(m=this.l)&&(this.g&&m.charAt(0)!="/"&&l.push("/"),l.push(uo(m,m.charAt(0)=="/"?uA:lA,!0))),(m=this.i.toString())&&l.push("?",m),(m=this.m)&&l.push("#",uo(m,hA)),l.join("")};function Mn(l){return new zi(l)}function al(l,h,m){l.j=m?lo(h,!0):h,l.j&&(l.j=l.j.replace(/:$/,""))}function ll(l,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);l.s=h}else l.s=null}function Oy(l,h,m){h instanceof co?(l.i=h,dA(l.i,l.h)):(m||(h=uo(h,cA)),l.i=new co(h,l.h))}function Re(l,h,m){l.i.set(h,m)}function ul(l){return Re(l,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),l}function lo(l,h){return l?h?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function uo(l,h,m){return typeof l=="string"?(l=encodeURI(l).replace(h,aA),m&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function aA(l){return l=l.charCodeAt(0),"%"+(l>>4&15).toString(16)+(l&15).toString(16)}var My=/[#\/\?@]/g,lA=/[#\?:]/g,uA=/[#\?]/g,cA=/[#\?@]/g,hA=/#/g;function co(l,h){this.h=this.g=null,this.i=l||null,this.j=!!h}function ii(l){l.g||(l.g=new Map,l.h=0,l.i&&oA(l.i,function(h,m){l.add(decodeURIComponent(h.replace(/\+/g," ")),m)}))}i=co.prototype,i.add=function(l,h){ii(this),this.i=null,l=Ls(this,l);var m=this.g.get(l);return m||this.g.set(l,m=[]),m.push(h),this.h+=1,this};function Vy(l,h){ii(l),h=Ls(l,h),l.g.has(h)&&(l.i=null,l.h-=l.g.get(h).length,l.g.delete(h))}function Fy(l,h){return ii(l),h=Ls(l,h),l.g.has(h)}i.forEach=function(l,h){ii(this),this.g.forEach(function(m,g){m.forEach(function(A){l.call(h,A,g,this)},this)},this)},i.na=function(){ii(this);let l=Array.from(this.g.values()),h=Array.from(this.g.keys()),m=[];for(let g=0;g<h.length;g++){let A=l[g];for(let N=0;N<A.length;N++)m.push(h[g])}return m},i.V=function(l){ii(this);let h=[];if(typeof l=="string")Fy(this,l)&&(h=h.concat(this.g.get(Ls(this,l))));else{l=Array.from(this.g.values());for(let m=0;m<l.length;m++)h=h.concat(l[m])}return h},i.set=function(l,h){return ii(this),this.i=null,l=Ls(this,l),Fy(this,l)&&(this.h-=this.g.get(l).length),this.g.set(l,[h]),this.h+=1,this},i.get=function(l,h){return l?(l=this.V(l),0<l.length?String(l[0]):h):h};function Ly(l,h,m){Vy(l,h),0<m.length&&(l.i=null,l.g.set(Ls(l,h),S(m)),l.h+=m.length)}i.toString=function(){if(this.i)return this.i;if(!this.g)return"";let l=[],h=Array.from(this.g.keys());for(var m=0;m<h.length;m++){var g=h[m];let N=encodeURIComponent(String(g)),L=this.V(g);for(g=0;g<L.length;g++){var A=N;L[g]!==""&&(A+="="+encodeURIComponent(String(L[g]))),l.push(A)}}return this.i=l.join("&")};function Ls(l,h){return h=String(h),l.j&&(h=h.toLowerCase()),h}function dA(l,h){h&&!l.j&&(ii(l),l.i=null,l.g.forEach(function(m,g){var A=g.toLowerCase();g!=A&&(Vy(this,g),Ly(this,A,m))},l)),l.j=h}function fA(l,h){let m=new oo;if(a.Image){let g=new Image;g.onload=_(si,m,"TestLoadImage: loaded",!0,h,g),g.onerror=_(si,m,"TestLoadImage: error",!1,h,g),g.onabort=_(si,m,"TestLoadImage: abort",!1,h,g),g.ontimeout=_(si,m,"TestLoadImage: timeout",!1,h,g),a.setTimeout(function(){g.ontimeout&&g.ontimeout()},1e4),g.src=l}else h(!1)}function mA(l,h){let m=new oo,g=new AbortController,A=setTimeout(()=>{g.abort(),si(m,"TestPingServer: timeout",!1,h)},1e4);fetch(l,{signal:g.signal}).then(N=>{clearTimeout(A),N.ok?si(m,"TestPingServer: ok",!0,h):si(m,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(A),si(m,"TestPingServer: error",!1,h)})}function si(l,h,m,g,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),g(m)}catch{}}function pA(){this.g=new Jb}function gA(l,h,m){let g=m||"";try{Dy(l,function(A,N){let L=A;c(A)&&(L=Kh(A)),h.push(g+N+"="+encodeURIComponent(L))})}catch(A){throw h.push(g+"type="+encodeURIComponent("_badmap")),A}}function ho(l){this.l=l.Ub||null,this.j=l.eb||!1}E(ho,Qh),ho.prototype.g=function(){return new cl(this.l,this.j)},ho.prototype.i=function(l){return function(){return l}}({});function cl(l,h){ct.call(this),this.D=l,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}E(cl,ct),i=cl.prototype,i.open=function(l,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=l,this.A=h,this.readyState=1,mo(this)},i.send=function(l){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};l&&(h.body=l),(this.D||a).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},i.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,fo(this)),this.readyState=0},i.Sa=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,mo(this)),this.g&&(this.readyState=3,mo(this),this.g)))if(this.responseType==="arraybuffer")l.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in l){if(this.j=l.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;By(this)}else l.text().then(this.Ra.bind(this),this.ga.bind(this))};function By(l){l.j.read().then(l.Pa.bind(l)).catch(l.ga.bind(l))}i.Pa=function(l){if(this.g){if(this.o&&l.value)this.response.push(l.value);else if(!this.o){var h=l.value?l.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!l.done}))&&(this.response=this.responseText+=h)}l.done?fo(this):mo(this),this.readyState==3&&By(this)}},i.Ra=function(l){this.g&&(this.response=this.responseText=l,fo(this))},i.Qa=function(l){this.g&&(this.response=l,fo(this))},i.ga=function(){this.g&&fo(this)};function fo(l){l.readyState=4,l.l=null,l.j=null,l.v=null,mo(l)}i.setRequestHeader=function(l,h){this.u.append(l,h)},i.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},i.getAllResponseHeaders=function(){if(!this.h)return"";let l=[],h=this.h.entries();for(var m=h.next();!m.done;)m=m.value,l.push(m[0]+": "+m[1]),m=h.next();return l.join(`\r
`)};function mo(l){l.onreadystatechange&&l.onreadystatechange.call(l)}Object.defineProperty(cl.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(l){this.m=l?"include":"same-origin"}});function Uy(l){let h="";return H(l,function(m,g){h+=g,h+=":",h+=m,h+=`\r
`}),h}function nd(l,h,m){e:{for(g in m){var g=!1;break e}g=!0}g||(m=Uy(m),typeof l=="string"?m!=null&&encodeURIComponent(String(m)):Re(l,h,m))}function Be(l){ct.call(this),this.headers=new Map,this.o=l||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}E(Be,ct);var _A=/^https?$/i,yA=["POST","PUT"];i=Be.prototype,i.Ha=function(l){this.J=l},i.ea=function(l,h,m,g){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+l);h=h?h.toUpperCase():"GET",this.D=l,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Hh.g(),this.v=this.o?py(this.o):py(Hh),this.g.onreadystatechange=p(this.Ea,this);try{this.B=!0,this.g.open(h,String(l),!0),this.B=!1}catch(N){qy(this,N);return}if(l=m||"",m=new Map(this.headers),g)if(Object.getPrototypeOf(g)===Object.prototype)for(var A in g)m.set(A,g[A]);else if(typeof g.keys=="function"&&typeof g.get=="function")for(let N of g.keys())m.set(N,g.get(N));else throw Error("Unknown input type for opt_headers: "+String(g));g=Array.from(m.keys()).find(N=>N.toLowerCase()=="content-type"),A=a.FormData&&l instanceof a.FormData,!(0<=Array.prototype.indexOf.call(yA,h,void 0))||g||A||m.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[N,L]of m)this.g.setRequestHeader(N,L);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Gy(this),this.u=!0,this.g.send(l),this.u=!1}catch(N){qy(this,N)}};function qy(l,h){l.h=!1,l.g&&(l.j=!0,l.g.abort(),l.j=!1),l.l=h,l.m=5,jy(l),hl(l)}function jy(l){l.A||(l.A=!0,_t(l,"complete"),_t(l,"error"))}i.abort=function(l){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=l||7,_t(this,"complete"),_t(this,"abort"),hl(this))},i.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),hl(this,!0)),Be.aa.N.call(this)},i.Ea=function(){this.s||(this.B||this.u||this.j?zy(this):this.bb())},i.bb=function(){zy(this)};function zy(l){if(l.h&&typeof o<"u"&&(!l.v[1]||Vn(l)!=4||l.Z()!=2)){if(l.u&&Vn(l)==4)hy(l.Ea,0,l);else if(_t(l,"readystatechange"),Vn(l)==4){l.h=!1;try{let L=l.Z();e:switch(L){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var m;if(!(m=h)){var g;if(g=L===0){var A=String(l.D).match(ky)[1]||null;!A&&a.self&&a.self.location&&(A=a.self.location.protocol.slice(0,-1)),g=!_A.test(A?A.toLowerCase():"")}m=g}if(m)_t(l,"complete"),_t(l,"success");else{l.m=6;try{var N=2<Vn(l)?l.g.statusText:""}catch{N=""}l.l=N+" ["+l.Z()+"]",jy(l)}}finally{hl(l)}}}}function hl(l,h){if(l.g){Gy(l);let m=l.g,g=l.v[0]?()=>{}:null;l.g=null,l.v=null,h||_t(l,"ready");try{m.onreadystatechange=g}catch{}}}function Gy(l){l.I&&(a.clearTimeout(l.I),l.I=null)}i.isActive=function(){return!!this.g};function Vn(l){return l.g?l.g.readyState:0}i.Z=function(){try{return 2<Vn(this)?this.g.status:-1}catch{return-1}},i.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},i.Oa=function(l){if(this.g){var h=this.g.responseText;return l&&h.indexOf(l)==0&&(h=h.substring(l.length)),Yb(h)}};function Ky(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.H){case"":case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch{return null}}function vA(l){let h={};l=(l.g&&2<=Vn(l)&&l.g.getAllResponseHeaders()||"").split(`\r
`);for(let g=0;g<l.length;g++){if(B(l[g]))continue;var m=b(l[g]);let A=m[0];if(m=m[1],typeof m!="string")continue;m=m.trim();let N=h[A]||[];h[A]=N,N.push(m)}T(h,function(g){return g.join(", ")})}i.Ba=function(){return this.m},i.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function po(l,h,m){return m&&m.internalChannelParams&&m.internalChannelParams[l]||h}function Qy(l){this.Aa=0,this.i=[],this.j=new oo,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=po("failFast",!1,l),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=po("baseRetryDelayMs",5e3,l),this.cb=po("retryDelaySeedMs",1e4,l),this.Wa=po("forwardChannelMaxRetries",2,l),this.wa=po("forwardChannelRequestTimeoutMs",2e4,l),this.pa=l&&l.xmlHttpFactory||void 0,this.Xa=l&&l.Tb||void 0,this.Ca=l&&l.useFetchStreams||!1,this.L=void 0,this.J=l&&l.supportsCrossDomainXhr||!1,this.K="",this.h=new Cy(l&&l.concurrentRequestLimit),this.Da=new pA,this.P=l&&l.fastHandshake||!1,this.O=l&&l.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=l&&l.Rb||!1,l&&l.xa&&this.j.xa(),l&&l.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&l&&l.detectBufferingProxy||!1,this.ja=void 0,l&&l.longPollingTimeout&&0<l.longPollingTimeout&&(this.ja=l.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}i=Qy.prototype,i.la=8,i.G=1,i.connect=function(l,h,m,g){yt(0),this.W=l,this.H=h||{},m&&g!==void 0&&(this.H.OSID=m,this.H.OAID=g),this.F=this.X,this.I=tv(this,null,this.W),fl(this)};function id(l){if(Wy(l),l.G==3){var h=l.U++,m=Mn(l.I);if(Re(m,"SID",l.K),Re(m,"RID",h),Re(m,"TYPE","terminate"),go(l,m),h=new ni(l,l.j,h),h.L=2,h.v=ul(Mn(m)),m=!1,a.navigator&&a.navigator.sendBeacon)try{m=a.navigator.sendBeacon(h.v.toString(),"")}catch{}!m&&a.Image&&(new Image().src=h.v,m=!0),m||(h.g=nv(h.j,null),h.g.ea(h.v)),h.F=Date.now(),ol(h)}ev(l)}function dl(l){l.g&&(rd(l),l.g.cancel(),l.g=null)}function Wy(l){dl(l),l.u&&(a.clearTimeout(l.u),l.u=null),ml(l),l.h.cancel(),l.s&&(typeof l.s=="number"&&a.clearTimeout(l.s),l.s=null)}function fl(l){if(!Ry(l.h)&&!l.s){l.s=!0;var h=l.Ga;Q||qe(),$||(Q(),$=!0),le.add(h,l),l.B=0}}function wA(l,h){return Py(l.h)>=l.h.j-(l.s?1:0)?!1:l.s?(l.i=h.D.concat(l.i),!0):l.G==1||l.G==2||l.B>=(l.Va?0:l.Wa)?!1:(l.s=ro(p(l.Ga,l,h),Zy(l,l.B)),l.B++,!0)}i.Ga=function(l){if(this.s)if(this.s=null,this.G==1){if(!l){this.U=Math.floor(1e5*Math.random()),l=this.U++;let A=new ni(this,this.j,l),N=this.o;if(this.S&&(N?(N=y(N),I(N,this.S)):N=this.S),this.m!==null||this.O||(A.H=N,N=null),this.P)e:{for(var h=0,m=0;m<this.i.length;m++){t:{var g=this.i[m];if("__data__"in g.map&&(g=g.map.__data__,typeof g=="string")){g=g.length;break t}g=void 0}if(g===void 0)break;if(h+=g,4096<h){h=m;break e}if(h===4096||m===this.i.length-1){h=m+1;break e}}h=1e3}else h=1e3;h=Hy(this,A,h),m=Mn(this.I),Re(m,"RID",l),Re(m,"CVER",22),this.D&&Re(m,"X-HTTP-Session-Id",this.D),go(this,m),N&&(this.O?h="headers="+encodeURIComponent(String(Uy(N)))+"&"+h:this.m&&nd(m,this.m,N)),td(this.h,A),this.Ua&&Re(m,"TYPE","init"),this.P?(Re(m,"$req",h),Re(m,"SID","null"),A.T=!0,Jh(A,m,null)):Jh(A,m,h),this.G=2}}else this.G==3&&(l?$y(this,l):this.i.length==0||Ry(this.h)||$y(this))};function $y(l,h){var m;h?m=h.l:m=l.U++;let g=Mn(l.I);Re(g,"SID",l.K),Re(g,"RID",m),Re(g,"AID",l.T),go(l,g),l.m&&l.o&&nd(g,l.m,l.o),m=new ni(l,l.j,m,l.B+1),l.m===null&&(m.H=l.o),h&&(l.i=h.D.concat(l.i)),h=Hy(l,m,1e3),m.I=Math.round(.5*l.wa)+Math.round(.5*l.wa*Math.random()),td(l.h,m),Jh(m,g,h)}function go(l,h){l.H&&H(l.H,function(m,g){Re(h,g,m)}),l.l&&Dy({},function(m,g){Re(h,g,m)})}function Hy(l,h,m){m=Math.min(l.i.length,m);var g=l.l?p(l.l.Na,l.l,l):null;e:{var A=l.i;let N=-1;for(;;){let L=["count="+m];N==-1?0<m?(N=A[0].g,L.push("ofs="+N)):N=0:L.push("ofs="+N);let Ee=!0;for(let ot=0;ot<m;ot++){let _e=A[ot].g,ht=A[ot].map;if(_e-=N,0>_e)N=Math.max(0,A[ot].g-100),Ee=!1;else try{gA(ht,L,"req"+_e+"_")}catch{g&&g(ht)}}if(Ee){g=L.join("&");break e}}}return l=l.i.splice(0,m),h.D=l,g}function Yy(l){if(!l.g&&!l.u){l.Y=1;var h=l.Fa;Q||qe(),$||(Q(),$=!0),le.add(h,l),l.v=0}}function sd(l){return l.g||l.u||3<=l.v?!1:(l.Y++,l.u=ro(p(l.Fa,l),Zy(l,l.v)),l.v++,!0)}i.Fa=function(){if(this.u=null,Jy(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var l=2*this.R;this.j.info("BP detection timer enabled: "+l),this.A=ro(p(this.ab,this),l)}},i.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,yt(10),dl(this),Jy(this))};function rd(l){l.A!=null&&(a.clearTimeout(l.A),l.A=null)}function Jy(l){l.g=new ni(l,l.j,"rpc",l.Y),l.m===null&&(l.g.H=l.o),l.g.O=0;var h=Mn(l.qa);Re(h,"RID","rpc"),Re(h,"SID",l.K),Re(h,"AID",l.T),Re(h,"CI",l.F?"0":"1"),!l.F&&l.ja&&Re(h,"TO",l.ja),Re(h,"TYPE","xmlhttp"),go(l,h),l.m&&l.o&&nd(h,l.m,l.o),l.L&&(l.g.I=l.L);var m=l.g;l=l.ia,m.L=1,m.v=ul(Mn(h)),m.m=null,m.P=!0,Sy(m,l)}i.Za=function(){this.C!=null&&(this.C=null,dl(this),sd(this),yt(19))};function ml(l){l.C!=null&&(a.clearTimeout(l.C),l.C=null)}function Xy(l,h){var m=null;if(l.g==h){ml(l),rd(l),l.g=null;var g=2}else if(ed(l.h,h))m=h.D,Ny(l.h,h),g=1;else return;if(l.G!=0){if(h.o)if(g==1){m=h.m?h.m.length:0,h=Date.now()-h.F;var A=l.B;g=il(),_t(g,new wy(g,m)),fl(l)}else Yy(l);else if(A=h.s,A==3||A==0&&0<h.X||!(g==1&&wA(l,h)||g==2&&sd(l)))switch(m&&0<m.length&&(h=l.h,h.i=h.i.concat(m)),A){case 1:Gi(l,5);break;case 4:Gi(l,10);break;case 3:Gi(l,6);break;default:Gi(l,2)}}}function Zy(l,h){let m=l.Ta+Math.floor(Math.random()*l.cb);return l.isActive()||(m*=2),m*h}function Gi(l,h){if(l.j.info("Error code "+h),h==2){var m=p(l.fb,l),g=l.Xa;let A=!g;g=new zi(g||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||al(g,"https"),ul(g),A?fA(g.toString(),m):mA(g.toString(),m)}else yt(2);l.G=0,l.l&&l.l.sa(h),ev(l),Wy(l)}i.fb=function(l){l?(this.j.info("Successfully pinged google.com"),yt(2)):(this.j.info("Failed to ping google.com"),yt(1))};function ev(l){if(l.G=0,l.ka=[],l.l){let h=xy(l.h);(h.length!=0||l.i.length!=0)&&(R(l.ka,h),R(l.ka,l.i),l.h.i.length=0,S(l.i),l.i.length=0),l.l.ra()}}function tv(l,h,m){var g=m instanceof zi?Mn(m):new zi(m);if(g.g!="")h&&(g.g=h+"."+g.g),ll(g,g.s);else{var A=a.location;g=A.protocol,h=h?h+"."+A.hostname:A.hostname,A=+A.port;var N=new zi(null);g&&al(N,g),h&&(N.g=h),A&&ll(N,A),m&&(N.l=m),g=N}return m=l.D,h=l.ya,m&&h&&Re(g,m,h),Re(g,"VER",l.la),go(l,g),g}function nv(l,h,m){if(h&&!l.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=l.Ca&&!l.pa?new Be(new ho({eb:m})):new Be(l.pa),h.Ha(l.J),h}i.isActive=function(){return!!this.l&&this.l.isActive(this)};function iv(){}i=iv.prototype,i.ua=function(){},i.ta=function(){},i.sa=function(){},i.ra=function(){},i.isActive=function(){return!0},i.Na=function(){};function pl(){}pl.prototype.g=function(l,h){return new Dt(l,h)};function Dt(l,h){ct.call(this),this.g=new Qy(h),this.l=l,this.h=h&&h.messageUrlParams||null,l=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.o=l,l=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(l?l["X-WebChannel-Content-Type"]=h.messageContentType:l={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(l?l["X-WebChannel-Client-Profile"]=h.va:l={"X-WebChannel-Client-Profile":h.va}),this.g.S=l,(l=h&&h.Sb)&&!B(l)&&(this.g.m=l),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!B(h)&&(this.g.D=h,l=this.h,l!==null&&h in l&&(l=this.h,h in l&&delete l[h])),this.j=new Bs(this)}E(Dt,ct),Dt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Dt.prototype.close=function(){id(this.g)},Dt.prototype.o=function(l){var h=this.g;if(typeof l=="string"){var m={};m.__data__=l,l=m}else this.u&&(m={},m.__data__=Kh(l),l=m);h.i.push(new iA(h.Ya++,l)),h.G==3&&fl(h)},Dt.prototype.N=function(){this.g.l=null,delete this.j,id(this.g),delete this.g,Dt.aa.N.call(this)};function sv(l){Wh.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var h=l.__sm__;if(h){e:{for(let m in h){l=m;break e}l=void 0}(this.i=l)&&(l=this.i,h=h!==null&&l in h?h[l]:void 0),this.data=h}else this.data=l}E(sv,Wh);function rv(){$h.call(this),this.status=1}E(rv,$h);function Bs(l){this.g=l}E(Bs,iv),Bs.prototype.ua=function(){_t(this.g,"a")},Bs.prototype.ta=function(l){_t(this.g,new sv(l))},Bs.prototype.sa=function(l){_t(this.g,new rv)},Bs.prototype.ra=function(){_t(this.g,"b")},pl.prototype.createWebChannel=pl.prototype.g,Dt.prototype.send=Dt.prototype.o,Dt.prototype.open=Dt.prototype.m,Dt.prototype.close=Dt.prototype.close,wm=jn.createWebChannelTransport=function(){return new pl},vm=jn.getStatEventTarget=function(){return il()},ym=jn.Event=qi,Ku=jn.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},sl.NO_ERROR=0,sl.TIMEOUT=8,sl.HTTP_ERROR=6,aa=jn.ErrorCode=sl,Ey.COMPLETE="complete",_m=jn.EventType=Ey,gy.EventType=io,io.OPEN="a",io.CLOSE="b",io.ERROR="c",io.MESSAGE="d",ct.prototype.listen=ct.prototype.K,cr=jn.WebChannel=gy,PP=jn.FetchXmlHttpFactory=ho,Be.prototype.listenOnce=Be.prototype.L,Be.prototype.getLastError=Be.prototype.Ka,Be.prototype.getLastErrorCode=Be.prototype.Ba,Be.prototype.getStatus=Be.prototype.Z,Be.prototype.getResponseJson=Be.prototype.Oa,Be.prototype.getResponseText=Be.prototype.oa,Be.prototype.send=Be.prototype.ea,Be.prototype.setWithCredentials=Be.prototype.Ha,gm=jn.XhrIo=Be}).apply(typeof Gu<"u"?Gu:typeof self<"u"?self:typeof window<"u"?window:{});var AT="@firebase/firestore";var Je=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Je.UNAUTHENTICATED=new Je(null),Je.GOOGLE_CREDENTIALS=new Je("google-credentials-uid"),Je.FIRST_PARTY=new Je("first-party-uid"),Je.MOCK_USER=new Je("mock-user");var qr="10.14.0";var Ai=new Ks("@firebase/firestore");function pr(){return Ai.logLevel}function PI(i){Ai.setLogLevel(i)}function O(i,...e){if(Ai.logLevel<=Gt.DEBUG){let t=e.map(bg);Ai.debug(`Firestore (${qr}): ${i}`,...t)}}function je(i,...e){if(Ai.logLevel<=Gt.ERROR){let t=e.map(bg);Ai.error(`Firestore (${qr}): ${i}`,...t)}}function rn(i,...e){if(Ai.logLevel<=Gt.WARN){let t=e.map(bg);Ai.warn(`Firestore (${qr}): ${i}`,...t)}}function bg(i){if(typeof i=="string")return i;try{return function(t){return JSON.stringify(t)}(i)}catch{return i}}function j(i="Unexpected state"){let e=`FIRESTORE (${qr}) INTERNAL ASSERTION FAILED: `+i;throw je(e),new Error(e)}function G(i,e){i||j()}function NI(i,e){i||j()}function U(i,e){return i}var x={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},k=class extends Fv{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var nt=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var tc=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Am=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Je.UNAUTHENTICATED))}shutdown(){}},Cm=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Rm=class{constructor(e){this.t=e,this.currentUser=Je.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){G(this.o===void 0);let n=this.i,s=u=>this.i!==n?(n=this.i,t(u)):Promise.resolve(),r=new nt;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new nt,e.enqueueRetryable(()=>s(this.currentUser))};let o=()=>{let u=r;e.enqueueRetryable(()=>D(this,null,function*(){yield u.promise,yield s(this.currentUser)}))},a=u=>{O("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(u=>a(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?a(u):(O("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new nt)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(O("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(G(typeof n.accessToken=="string"),new tc(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return G(e===null||typeof e=="string"),new Je(e)}},Pm=class{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Je.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},Nm=class{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new Pm(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Je.FIRST_PARTY))}shutdown(){}invalidateToken(){}},xm=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Dm=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){G(this.o===void 0);let n=r=>{r.error!=null&&O("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${r.error.message}`);let o=r.token!==this.R;return this.R=r.token,O("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(r.token):Promise.resolve()};this.o=r=>{e.enqueueRetryable(()=>n(r))};let s=r=>{O("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=r,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(r=>s(r)),setTimeout(()=>{if(!this.appCheck){let r=this.A.getImmediate({optional:!0});r?s(r):O("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(G(typeof t.token=="string"),this.R=t.token,new xm(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function NP(i){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(i);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<i;n++)t[n]=Math.floor(256*Math.random());return t}var nc=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";for(;n.length<20;){let s=NP(40);for(let r=0;r<s.length;++r)n.length<20&&s[r]<t&&(n+=e.charAt(s[r]%e.length))}return n}};function Z(i,e){return i<e?-1:i>e?1:0}function Sr(i,e,t){return i.length===e.length&&i.every((n,s)=>t(n,e[s]))}function xI(i){return i+"\0"}var Me=class i{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new k(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new k(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new k(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new k(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return i.fromMillis(Date.now())}static fromDate(e){return i.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new i(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Z(this.nanoseconds,e.nanoseconds):Z(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var W=class i{constructor(e){this.timestamp=e}static fromTimestamp(e){return new i(e)}static min(){return new i(new Me(0,0))}static max(){return new i(new Me(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var ic=class i{constructor(e,t,n){t===void 0?t=0:t>e.length&&j(),n===void 0?n=e.length-t:n>e.length-t&&j(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return i.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof i?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let s=0;s<n;s++){let r=e.get(s),o=t.get(s);if(r<o)return-1;if(r>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},me=class i extends ic{construct(e,t,n){return new i(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new k(x.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(s=>s.length>0))}return new i(t)}static emptyPath(){return new i([])}},xP=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ze=class i extends ic{construct(e,t,n){return new i(e,t,n)}static isValidIdentifier(e){return xP.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),i.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new i(["__name__"])}static fromServerFormat(e){let t=[],n="",s=0,r=()=>{if(n.length===0)throw new k(x.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},o=!1;for(;s<e.length;){let a=e[s];if(a==="\\"){if(s+1===e.length)throw new k(x.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let u=e[s+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new k(x.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=u,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(n+=a,s++):(r(),s++)}if(r(),o)throw new k(x.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new i(t)}static emptyPath(){return new i([])}};var q=class i{constructor(e){this.path=e}static fromPath(e){return new i(me.fromString(e))}static fromName(e){return new i(me.fromString(e).popFirst(5))}static empty(){return new i(me.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&me.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return me.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new i(new me(e.slice()))}};var br=class{constructor(e,t,n,s){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=s}};function km(i){return i.fields.find(e=>e.kind===2)}function os(i){return i.fields.filter(e=>e.kind!==2)}br.UNKNOWN_ID=-1;var Er=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var va=class i{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new i(0,Ht.min())}};function DI(i,e){let t=i.toTimestamp().seconds,n=i.toTimestamp().nanoseconds+1,s=W.fromTimestamp(n===1e9?new Me(t+1,0):new Me(t,n));return new Ht(s,q.empty(),e)}function kI(i){return new Ht(i.readTime,i.key,-1)}var Ht=class i{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new i(W.min(),q.empty(),-1)}static max(){return new i(W.max(),q.empty(),-1)}};function Ag(i,e){let t=i.readTime.compareTo(e.readTime);return t!==0?t:(t=q.comparator(i.documentKey,e.documentKey),t!==0?t:Z(i.largestBatchId,e.largestBatchId))}var OI="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",sc=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Vi(i){return D(this,null,function*(){if(i.code!==x.FAILED_PRECONDITION||i.message!==OI)throw i;O("LocalStore","Unexpectedly lost primary lease")})}var P=class i{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&j(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new i((n,s)=>{this.nextCallback=r=>{this.wrapSuccess(e,r).next(n,s)},this.catchCallback=r=>{this.wrapFailure(t,r).next(n,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof i?t:i.resolve(t)}catch(t){return i.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):i.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):i.reject(t)}static resolve(e){return new i((t,n)=>{t(e)})}static reject(e){return new i((t,n)=>{n(e)})}static waitFor(e){return new i((t,n)=>{let s=0,r=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++r,o&&r===s&&t()},u=>n(u))}),o=!0,r===s&&t()})}static or(e){let t=i.resolve(!1);for(let n of e)t=t.next(s=>s?i.resolve(s):n());return t}static forEach(e,t){let n=[];return e.forEach((s,r)=>{n.push(t.call(this,s,r))}),this.waitFor(n)}static mapArray(e,t){return new i((n,s)=>{let r=e.length,o=new Array(r),a=0;for(let u=0;u<r;u++){let c=u;t(e[c]).next(d=>{o[c]=d,++a,a===r&&n(o)},d=>s(d))}})}static doWhile(e,t){return new i((n,s)=>{let r=()=>{e()===!0?t().next(()=>{r()},s):n()};r()})}};var rc=class i{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new nt,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new ds(e,t.error)):this.V.resolve()},this.transaction.onerror=n=>{let s=Cg(n.target.error);this.V.reject(new ds(e,s))}}static open(e,t,n,s){try{return new i(t,e.transaction(s,n))}catch(r){throw new ds(t,r)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(O("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new Mm(t)}},Ci=class i{constructor(e,t,n){this.name=e,this.version=t,this.p=n,i.S(bo())===12.2&&je("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return O("SimpleDb","Removing database:",e),as(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!Vv())return!1;if(i.v())return!0;let e=bo(),t=i.S(e),n=0<t&&t<10,s=MI(e),r=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||r)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}M(e){return D(this,null,function*(){return this.db||(O("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,n)=>{let s=indexedDB.open(this.name,this.version);s.onsuccess=r=>{let o=r.target.result;t(o)},s.onblocked=()=>{n(new ds(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=r=>{let o=r.target.error;o.name==="VersionError"?n(new k(x.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?n(new k(x.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):n(new ds(e,o))},s.onupgradeneeded=r=>{O("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',r.oldVersion);let o=r.target.result;this.p.O(o,s.transaction,r.oldVersion,this.version).next(()=>{O("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db})}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,n,s){return D(this,null,function*(){let r=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.M(e);let a=rc.open(this.db,e,r?"readonly":"readwrite",n),u=s(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),P.reject(c))).toPromise();return u.catch(()=>{}),yield a.m,u}catch(a){let u=a,c=u.name!=="FirebaseError"&&o<3;if(O("SimpleDb","Transaction failed with error:",u.message,"Retrying:",c),this.close(),!c)return Promise.reject(u)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function MI(i){let e=i.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var Om=class{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return as(this.B.delete())}},ds=class extends k{constructor(e,t){super(x.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function Fi(i){return i.name==="IndexedDbTransactionError"}var Mm=class{constructor(e){this.store=e}put(e,t){let n;return t!==void 0?(O("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(O("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),as(n)}add(e){return O("SimpleDb","ADD",this.store.name,e,e),as(this.store.add(e))}get(e){return as(this.store.get(e)).next(t=>(t===void 0&&(t=null),O("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return O("SimpleDb","DELETE",this.store.name,e),as(this.store.delete(e))}count(){return O("SimpleDb","COUNT",this.store.name),as(this.store.count())}U(e,t){let n=this.options(e,t),s=n.index?this.store.index(n.index):this.store;if(typeof s.getAll=="function"){let r=s.getAll(n.range);return new P((o,a)=>{r.onerror=u=>{a(u.target.error)},r.onsuccess=u=>{o(u.target.result)}})}{let r=this.cursor(n),o=[];return this.W(r,(a,u)=>{o.push(u)}).next(()=>o)}}G(e,t){let n=this.store.getAll(e,t===null?void 0:t);return new P((s,r)=>{n.onerror=o=>{r(o.target.error)},n.onsuccess=o=>{s(o.target.result)}})}j(e,t){O("SimpleDb","DELETE ALL",this.store.name);let n=this.options(e,t);n.H=!1;let s=this.cursor(n);return this.W(s,(r,o,a)=>a.delete())}J(e,t){let n;t?n=e:(n={},t=e);let s=this.cursor(n);return this.W(s,t)}Y(e){let t=this.cursor({});return new P((n,s)=>{t.onerror=r=>{let o=Cg(r.target.error);s(o)},t.onsuccess=r=>{let o=r.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():n()}):n()}})}W(e,t){let n=[];return new P((s,r)=>{e.onerror=o=>{r(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a)return void s();let u=new Om(a),c=t(a.primaryKey,a.value,u);if(c instanceof P){let d=c.catch(f=>(u.done(),P.reject(f)));n.push(d)}u.isDone?s():u.K===null?a.continue():a.continue(u.K)}}).next(()=>P.waitFor(n))}options(e,t){let n;return e!==void 0&&(typeof e=="string"?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function as(i){return new P((e,t)=>{i.onsuccess=n=>{let s=n.target.result;e(s)},i.onerror=n=>{let s=Cg(n.target.error);t(s)}})}var CT=!1;function Cg(i){let e=Ci.S(bo());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(i.message.indexOf(t)>=0){let n=new k("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return CT||(CT=!0,setTimeout(()=>{throw n},0)),n}}return i}var Vm=class{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){O("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>D(this,null,function*(){this.task=null;try{O("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(t){Fi(t)?O("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield Vi(t)}yield this.X(6e4)}))}},Fm=class{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){return D(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))})}te(e,t){let n=new Set,s=t,r=!0;return P.doWhile(()=>r===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!n.has(o))return O("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,s).next(a=>{s-=a,n.add(o)});r=!1})).next(()=>t-s)}ne(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,n).next(r=>{let o=r.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(s,r)).next(a=>(O("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let n=e;return t.changes.forEach((s,r)=>{let o=kI(r);Ag(o,n)>0&&(n=o)}),new Ht(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}};var Ft=(()=>{class i{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=s=>this.ie(s),this.se=s=>n.writeSequenceNumber(s))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return i.oe=-1,i})();function Ua(i){return i==null}function wa(i){return i===0&&1/i==-1/0}function VI(i){return typeof i=="number"&&Number.isInteger(i)&&!wa(i)&&i<=Number.MAX_SAFE_INTEGER&&i>=Number.MIN_SAFE_INTEGER}function St(i){let e="";for(let t=0;t<i.length;t++)e.length>0&&(e=RT(e)),e=DP(i.get(t),e);return RT(e)}function DP(i,e){let t=e,n=i.length;for(let s=0;s<n;s++){let r=i.charAt(s);switch(r){case"\0":t+="";break;case"":t+="";break;default:t+=r}}return t}function RT(i){return i+""}function En(i){let e=i.length;if(G(e>=2),e===2)return G(i.charAt(0)===""&&i.charAt(1)===""),me.emptyPath();let t=e-2,n=[],s="";for(let r=0;r<e;){let o=i.indexOf("",r);switch((o<0||o>t)&&j(),i.charAt(o+1)){case"":let a=i.substring(r,o),u;s.length===0?u=a:(s+=a,u=s,s=""),n.push(u);break;case"":s+=i.substring(r,o),s+="\0";break;case"":s+=i.substring(r,o+1);break;default:j()}r=o+2}return new me(n)}var PT=["userId","batchId"];function Yu(i,e){return[i,St(e)]}function FI(i,e,t){return[i,St(e),t]}var kP={},OP=["prefixPath","collectionGroup","readTime","documentId"],MP=["prefixPath","collectionGroup","documentId"],VP=["collectionGroup","readTime","prefixPath","documentId"],FP=["canonicalId","targetId"],LP=["targetId","path"],BP=["path","targetId"],UP=["collectionId","parent"],qP=["indexId","uid"],jP=["uid","sequenceNumber"],zP=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],GP=["indexId","uid","orderedDocumentKey"],KP=["userId","collectionPath","documentId"],QP=["userId","collectionPath","largestBatchId"],WP=["userId","collectionGroup","largestBatchId"],LI=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],$P=[...LI,"documentOverlays"],BI=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],UI=BI,Rg=[...UI,"indexConfiguration","indexState","indexEntries"],HP=Rg,YP=[...Rg,"globals"];var Ea=class extends sc{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}};function it(i,e){let t=U(i);return Ci.F(t._e,e)}function NT(i){let e=0;for(let t in i)Object.prototype.hasOwnProperty.call(i,t)&&e++;return e}function Ss(i,e){for(let t in i)Object.prototype.hasOwnProperty.call(i,t)&&e(t,i[t])}function qI(i){for(let e in i)if(Object.prototype.hasOwnProperty.call(i,e))return!1;return!0}var Ne=class i{constructor(e,t){this.comparator=e,this.root=t||In.EMPTY}insert(e,t){return new i(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,In.BLACK,null,null))}remove(e){return new i(this.comparator,this.root.remove(e,this.comparator).copy(null,null,In.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let s=this.comparator(e,n.key);if(s===0)return t+n.left.size;s<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new wr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new wr(this.root,e,this.comparator,!1)}getReverseIterator(){return new wr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new wr(this.root,e,this.comparator,!0)}},wr=class{constructor(e,t,n,s){this.isReverse=s,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,t&&s&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(r===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},In=class i{constructor(e,t,n,s,r){this.key=e,this.value=t,this.color=n??i.RED,this.left=s??i.EMPTY,this.right=r??i.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,s,r){return new i(e??this.key,t??this.value,n??this.color,s??this.left,r??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let s=this,r=n(e,s.key);return s=r<0?s.copy(null,null,null,s.left.insert(e,t,n),null):r===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return i.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return i.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,i.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,i.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw j();let e=this.left.check();if(e!==this.right.check())throw j();return e+(this.isRed()?0:1)}};In.EMPTY=null,In.RED=!0,In.BLACK=!1;In.EMPTY=new class{constructor(){this.size=0}get key(){throw j()}get value(){throw j()}get color(){throw j()}get left(){throw j()}get right(){throw j()}copy(e,t,n,s,r){return this}insert(e,t,n){return new In(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var Ie=class i{constructor(e){this.comparator=e,this.data=new Ne(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let s=n.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new oc(this.data.getIterator())}getIteratorFrom(e){return new oc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof i)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let s=t.getNext().key,r=n.getNext().key;if(this.comparator(s,r)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new i(this.comparator);return t.data=e,t}},oc=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function hr(i){return i.hasNext()?i.getNext():void 0}var Lt=class i{constructor(e){this.fields=e,e.sort(ze.comparator)}static empty(){return new i([])}unionWith(e){let t=new Ie(ze.comparator);for(let n of this.fields)t=t.add(n);for(let n of e)t=t.add(n);return new i(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Sr(this.fields,e.fields,(t,n)=>t.isEqual(n))}};var ac=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function jI(){return typeof atob<"u"}var Ke=class i{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(s){try{return atob(s)}catch(r){throw typeof DOMException<"u"&&r instanceof DOMException?new ac("Invalid base64 string: "+r):r}}(e);return new i(t)}static fromUint8Array(e){let t=function(s){let r="";for(let o=0;o<s.length;++o)r+=String.fromCharCode(s[o]);return r}(e);return new i(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let n=new Uint8Array(t.length);for(let s=0;s<t.length;s++)n[s]=t.charCodeAt(s);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Z(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Ke.EMPTY_BYTE_STRING=new Ke("");var JP=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Kn(i){if(G(!!i),typeof i=="string"){let e=0,t=JP.exec(i);if(G(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}let n=new Date(i);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:ke(i.seconds),nanos:ke(i.nanos)}}function ke(i){return typeof i=="number"?i:typeof i=="string"?Number(i):0}function Ri(i){return typeof i=="string"?Ke.fromBase64String(i):Ke.fromUint8Array(i)}function Xc(i){var e,t;return((t=(((e=i?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Pg(i){let e=i.mapValue.fields.__previous_value__;return Xc(e)?Pg(e):e}function Ta(i){let e=Kn(i.mapValue.fields.__local_write_time__.timestampValue);return new Me(e.seconds,e.nanos)}var Lm=class{constructor(e,t,n,s,r,o,a,u,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=s,this.ssl=r,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=c}},Pi=class i{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new i("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof i&&e.projectId===this.projectId&&e.database===this.database}};var Si={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Ju={nullValue:"NULL_VALUE"};function fs(i){return"nullValue"in i?0:"booleanValue"in i?1:"integerValue"in i||"doubleValue"in i?2:"timestampValue"in i?3:"stringValue"in i?5:"bytesValue"in i?6:"referenceValue"in i?7:"geoPointValue"in i?8:"arrayValue"in i?9:"mapValue"in i?Xc(i)?4:zI(i)?9007199254740991:Zc(i)?10:11:j()}function An(i,e){if(i===e)return!0;let t=fs(i);if(t!==fs(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return i.booleanValue===e.booleanValue;case 4:return Ta(i).isEqual(Ta(e));case 3:return function(s,r){if(typeof s.timestampValue=="string"&&typeof r.timestampValue=="string"&&s.timestampValue.length===r.timestampValue.length)return s.timestampValue===r.timestampValue;let o=Kn(s.timestampValue),a=Kn(r.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(i,e);case 5:return i.stringValue===e.stringValue;case 6:return function(s,r){return Ri(s.bytesValue).isEqual(Ri(r.bytesValue))}(i,e);case 7:return i.referenceValue===e.referenceValue;case 8:return function(s,r){return ke(s.geoPointValue.latitude)===ke(r.geoPointValue.latitude)&&ke(s.geoPointValue.longitude)===ke(r.geoPointValue.longitude)}(i,e);case 2:return function(s,r){if("integerValue"in s&&"integerValue"in r)return ke(s.integerValue)===ke(r.integerValue);if("doubleValue"in s&&"doubleValue"in r){let o=ke(s.doubleValue),a=ke(r.doubleValue);return o===a?wa(o)===wa(a):isNaN(o)&&isNaN(a)}return!1}(i,e);case 9:return Sr(i.arrayValue.values||[],e.arrayValue.values||[],An);case 10:case 11:return function(s,r){let o=s.mapValue.fields||{},a=r.mapValue.fields||{};if(NT(o)!==NT(a))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(a[u]===void 0||!An(o[u],a[u])))return!1;return!0}(i,e);default:return j()}}function Ia(i,e){return(i.values||[]).find(t=>An(t,e))!==void 0}function Ni(i,e){if(i===e)return 0;let t=fs(i),n=fs(e);if(t!==n)return Z(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return Z(i.booleanValue,e.booleanValue);case 2:return function(r,o){let a=ke(r.integerValue||r.doubleValue),u=ke(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(i,e);case 3:return xT(i.timestampValue,e.timestampValue);case 4:return xT(Ta(i),Ta(e));case 5:return Z(i.stringValue,e.stringValue);case 6:return function(r,o){let a=Ri(r),u=Ri(o);return a.compareTo(u)}(i.bytesValue,e.bytesValue);case 7:return function(r,o){let a=r.split("/"),u=o.split("/");for(let c=0;c<a.length&&c<u.length;c++){let d=Z(a[c],u[c]);if(d!==0)return d}return Z(a.length,u.length)}(i.referenceValue,e.referenceValue);case 8:return function(r,o){let a=Z(ke(r.latitude),ke(o.latitude));return a!==0?a:Z(ke(r.longitude),ke(o.longitude))}(i.geoPointValue,e.geoPointValue);case 9:return DT(i.arrayValue,e.arrayValue);case 10:return function(r,o){var a,u,c,d;let f=r.fields||{},p=o.fields||{},_=(a=f.value)===null||a===void 0?void 0:a.arrayValue,E=(u=p.value)===null||u===void 0?void 0:u.arrayValue,S=Z(((c=_?.values)===null||c===void 0?void 0:c.length)||0,((d=E?.values)===null||d===void 0?void 0:d.length)||0);return S!==0?S:DT(_,E)}(i.mapValue,e.mapValue);case 11:return function(r,o){if(r===Si.mapValue&&o===Si.mapValue)return 0;if(r===Si.mapValue)return 1;if(o===Si.mapValue)return-1;let a=r.fields||{},u=Object.keys(a),c=o.fields||{},d=Object.keys(c);u.sort(),d.sort();for(let f=0;f<u.length&&f<d.length;++f){let p=Z(u[f],d[f]);if(p!==0)return p;let _=Ni(a[u[f]],c[d[f]]);if(_!==0)return _}return Z(u.length,d.length)}(i.mapValue,e.mapValue);default:throw j()}}function xT(i,e){if(typeof i=="string"&&typeof e=="string"&&i.length===e.length)return Z(i,e);let t=Kn(i),n=Kn(e),s=Z(t.seconds,n.seconds);return s!==0?s:Z(t.nanos,n.nanos)}function DT(i,e){let t=i.values||[],n=e.values||[];for(let s=0;s<t.length&&s<n.length;++s){let r=Ni(t[s],n[s]);if(r)return r}return Z(t.length,n.length)}function Ar(i){return Bm(i)}function Bm(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?function(t){let n=Kn(t);return`time(${n.seconds},${n.nanos})`}(i.timestampValue):"stringValue"in i?i.stringValue:"bytesValue"in i?function(t){return Ri(t).toBase64()}(i.bytesValue):"referenceValue"in i?function(t){return q.fromName(t).toString()}(i.referenceValue):"geoPointValue"in i?function(t){return`geo(${t.latitude},${t.longitude})`}(i.geoPointValue):"arrayValue"in i?function(t){let n="[",s=!0;for(let r of t.values||[])s?s=!1:n+=",",n+=Bm(r);return n+"]"}(i.arrayValue):"mapValue"in i?function(t){let n=Object.keys(t.fields||{}).sort(),s="{",r=!0;for(let o of n)r?r=!1:s+=",",s+=`${o}:${Bm(t.fields[o])}`;return s+"}"}(i.mapValue):j()}function ms(i,e){return{referenceValue:`projects/${i.projectId}/databases/${i.database}/documents/${e.path.canonicalString()}`}}function Um(i){return!!i&&"integerValue"in i}function Sa(i){return!!i&&"arrayValue"in i}function kT(i){return!!i&&"nullValue"in i}function OT(i){return!!i&&"doubleValue"in i&&isNaN(Number(i.doubleValue))}function Xu(i){return!!i&&"mapValue"in i}function Zc(i){var e,t;return((t=(((e=i?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function ma(i){if(i.geoPointValue)return{geoPointValue:Object.assign({},i.geoPointValue)};if(i.timestampValue&&typeof i.timestampValue=="object")return{timestampValue:Object.assign({},i.timestampValue)};if(i.mapValue){let e={mapValue:{fields:{}}};return Ss(i.mapValue.fields,(t,n)=>e.mapValue.fields[t]=ma(n)),e}if(i.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(i.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ma(i.arrayValue.values[t]);return e}return Object.assign({},i)}function zI(i){return(((i.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var GI={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function XP(i){return"nullValue"in i?Ju:"booleanValue"in i?{booleanValue:!1}:"integerValue"in i||"doubleValue"in i?{doubleValue:NaN}:"timestampValue"in i?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in i?{stringValue:""}:"bytesValue"in i?{bytesValue:""}:"referenceValue"in i?ms(Pi.empty(),q.empty()):"geoPointValue"in i?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in i?{arrayValue:{}}:"mapValue"in i?Zc(i)?GI:{mapValue:{}}:j()}function ZP(i){return"nullValue"in i?{booleanValue:!1}:"booleanValue"in i?{doubleValue:NaN}:"integerValue"in i||"doubleValue"in i?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in i?{stringValue:""}:"stringValue"in i?{bytesValue:""}:"bytesValue"in i?ms(Pi.empty(),q.empty()):"referenceValue"in i?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in i?{arrayValue:{}}:"arrayValue"in i?GI:"mapValue"in i?Zc(i)?{mapValue:{}}:Si:j()}function MT(i,e){let t=Ni(i.value,e.value);return t!==0?t:i.inclusive&&!e.inclusive?-1:!i.inclusive&&e.inclusive?1:0}function VT(i,e){let t=Ni(i.value,e.value);return t!==0?t:i.inclusive&&!e.inclusive?1:!i.inclusive&&e.inclusive?-1:0}var gt=class i{constructor(e){this.value=e}static empty(){return new i({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Xu(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ma(t)}setAll(e){let t=ze.emptyPath(),n={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let u=this.getFieldsMap(t);this.applyChanges(u,n,s),n={},s=[],t=a.popLast()}o?n[a.lastSegment()]=ma(o):s.push(a.lastSegment())});let r=this.getFieldsMap(t);this.applyChanges(r,n,s)}delete(e){let t=this.field(e.popLast());Xu(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return An(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let s=t.mapValue.fields[e.get(n)];Xu(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,n){Ss(t,(s,r)=>e[s]=r);for(let s of n)delete e[s]}clone(){return new i(ma(this.value))}};function KI(i){let e=[];return Ss(i.fields,(t,n)=>{let s=new ze([t]);if(Xu(n)){let r=KI(n.mapValue).fields;if(r.length===0)e.push(s);else for(let o of r)e.push(s.child(o))}else e.push(s)}),new Lt(e)}var Xe=class i{constructor(e,t,n,s,r,o,a){this.key=e,this.documentType=t,this.version=n,this.readTime=s,this.createTime=r,this.data=o,this.documentState=a}static newInvalidDocument(e){return new i(e,0,W.min(),W.min(),W.min(),gt.empty(),0)}static newFoundDocument(e,t,n,s){return new i(e,1,t,W.min(),n,s,0)}static newNoDocument(e,t){return new i(e,2,t,W.min(),W.min(),gt.empty(),0)}static newUnknownDocument(e,t){return new i(e,3,t,W.min(),W.min(),gt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(W.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=gt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=gt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=W.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof i&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new i(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Cn=class{constructor(e,t){this.position=e,this.inclusive=t}};function FT(i,e,t){let n=0;for(let s=0;s<i.position.length;s++){let r=e[s],o=i.position[s];if(r.field.isKeyField()?n=q.comparator(q.fromName(o.referenceValue),t.key):n=Ni(o,t.data.field(r.field)),r.dir==="desc"&&(n*=-1),n!==0)break}return n}function LT(i,e){if(i===null)return e===null;if(e===null||i.inclusive!==e.inclusive||i.position.length!==e.position.length)return!1;for(let t=0;t<i.position.length;t++)if(!An(i.position[t],e.position[t]))return!1;return!0}var ps=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function eN(i,e){return i.dir===e.dir&&i.field.isEqual(e.field)}var lc=class{},de=class i extends lc{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new zm(e,t,n):t==="array-contains"?new Qm(e,n):t==="in"?new uc(e,n):t==="not-in"?new Wm(e,n):t==="array-contains-any"?new $m(e,n):new i(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new Gm(e,n):new Km(e,n)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Ni(t,this.value)):t!==null&&fs(this.value)===fs(t)&&this.matchesComparison(Ni(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return j()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},we=class i extends lc{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new i(e,t)}matches(e){return Cr(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function Cr(i){return i.op==="and"}function qm(i){return i.op==="or"}function Ng(i){return QI(i)&&Cr(i)}function QI(i){for(let e of i.filters)if(e instanceof we)return!1;return!0}function jm(i){if(i instanceof de)return i.field.canonicalString()+i.op.toString()+Ar(i.value);if(Ng(i))return i.filters.map(e=>jm(e)).join(",");{let e=i.filters.map(t=>jm(t)).join(",");return`${i.op}(${e})`}}function WI(i,e){return i instanceof de?function(n,s){return s instanceof de&&n.op===s.op&&n.field.isEqual(s.field)&&An(n.value,s.value)}(i,e):i instanceof we?function(n,s){return s instanceof we&&n.op===s.op&&n.filters.length===s.filters.length?n.filters.reduce((r,o,a)=>r&&WI(o,s.filters[a]),!0):!1}(i,e):void j()}function $I(i,e){let t=i.filters.concat(e);return we.create(t,i.op)}function HI(i){return i instanceof de?function(t){return`${t.field.canonicalString()} ${t.op} ${Ar(t.value)}`}(i):i instanceof we?function(t){return t.op.toString()+" {"+t.getFilters().map(HI).join(" ,")+"}"}(i):"Filter"}var zm=class extends de{constructor(e,t,n){super(e,t,n),this.key=q.fromName(n.referenceValue)}matches(e){let t=q.comparator(e.key,this.key);return this.matchesComparison(t)}},Gm=class extends de{constructor(e,t){super(e,"in",t),this.keys=YI("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Km=class extends de{constructor(e,t){super(e,"not-in",t),this.keys=YI("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function YI(i,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(n=>q.fromName(n.referenceValue))}var Qm=class extends de{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Sa(t)&&Ia(t.arrayValue,this.value)}},uc=class extends de{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Ia(this.value.arrayValue,t)}},Wm=class extends de{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ia(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!Ia(this.value.arrayValue,t)}},$m=class extends de{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Sa(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>Ia(this.value.arrayValue,n))}};var Hm=class{constructor(e,t=null,n=[],s=[],r=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=s,this.limit=r,this.startAt=o,this.endAt=a,this.ue=null}};function Ym(i,e=null,t=[],n=[],s=null,r=null,o=null){return new Hm(i,e,t,n,s,r,o)}function gs(i){let e=U(i);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>jm(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>function(r){return r.field.canonicalString()+r.dir}(n)).join(","),Ua(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>Ar(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>Ar(n)).join(",")),e.ue=t}return e.ue}function qa(i,e){if(i.limit!==e.limit||i.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<i.orderBy.length;t++)if(!eN(i.orderBy[t],e.orderBy[t]))return!1;if(i.filters.length!==e.filters.length)return!1;for(let t=0;t<i.filters.length;t++)if(!WI(i.filters[t],e.filters[t]))return!1;return i.collectionGroup===e.collectionGroup&&!!i.path.isEqual(e.path)&&!!LT(i.startAt,e.startAt)&&LT(i.endAt,e.endAt)}function cc(i){return q.isDocumentKey(i.path)&&i.collectionGroup===null&&i.filters.length===0}function hc(i,e){return i.filters.filter(t=>t instanceof de&&t.field.isEqual(e))}function BT(i,e,t){let n=Ju,s=!0;for(let r of hc(i,e)){let o=Ju,a=!0;switch(r.op){case"<":case"<=":o=XP(r.value);break;case"==":case"in":case">=":o=r.value;break;case">":o=r.value,a=!1;break;case"!=":case"not-in":o=Ju}MT({value:n,inclusive:s},{value:o,inclusive:a})<0&&(n=o,s=a)}if(t!==null){for(let r=0;r<i.orderBy.length;++r)if(i.orderBy[r].field.isEqual(e)){let o=t.position[r];MT({value:n,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(n=o,s=t.inclusive);break}}return{value:n,inclusive:s}}function UT(i,e,t){let n=Si,s=!0;for(let r of hc(i,e)){let o=Si,a=!0;switch(r.op){case">=":case">":o=ZP(r.value),a=!1;break;case"==":case"in":case"<=":o=r.value;break;case"<":o=r.value,a=!1;break;case"!=":case"not-in":o=Si}VT({value:n,inclusive:s},{value:o,inclusive:a})>0&&(n=o,s=a)}if(t!==null){for(let r=0;r<i.orderBy.length;++r)if(i.orderBy[r].field.isEqual(e)){let o=t.position[r];VT({value:n,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(n=o,s=t.inclusive);break}}return{value:n,inclusive:s}}var on=class{constructor(e,t=null,n=[],s=[],r=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=s,this.limit=r,this.limitType=o,this.startAt=a,this.endAt=u,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function JI(i,e,t,n,s,r,o,a){return new on(i,e,t,n,s,r,o,a)}function jr(i){return new on(i)}function qT(i){return i.filters.length===0&&i.limit===null&&i.startAt==null&&i.endAt==null&&(i.explicitOrderBy.length===0||i.explicitOrderBy.length===1&&i.explicitOrderBy[0].field.isKeyField())}function xg(i){return i.collectionGroup!==null}function Tr(i){let e=U(i);if(e.ce===null){e.ce=[];let t=new Set;for(let r of e.explicitOrderBy)e.ce.push(r),t.add(r.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Ie(ze.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(r=>{t.has(r.canonicalString())||r.isKeyField()||e.ce.push(new ps(r,n))}),t.has(ze.keyField().canonicalString())||e.ce.push(new ps(ze.keyField(),n))}return e.ce}function bt(i){let e=U(i);return e.le||(e.le=tN(e,Tr(i))),e.le}function tN(i,e){if(i.limitType==="F")return Ym(i.path,i.collectionGroup,e,i.filters,i.limit,i.startAt,i.endAt);{e=e.map(s=>{let r=s.dir==="desc"?"asc":"desc";return new ps(s.field,r)});let t=i.endAt?new Cn(i.endAt.position,i.endAt.inclusive):null,n=i.startAt?new Cn(i.startAt.position,i.startAt.inclusive):null;return Ym(i.path,i.collectionGroup,e,i.filters,i.limit,t,n)}}function Jm(i,e){let t=i.filters.concat([e]);return new on(i.path,i.collectionGroup,i.explicitOrderBy.slice(),t,i.limit,i.limitType,i.startAt,i.endAt)}function dc(i,e,t){return new on(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),e,t,i.startAt,i.endAt)}function ja(i,e){return qa(bt(i),bt(e))&&i.limitType===e.limitType}function XI(i){return`${gs(bt(i))}|lt:${i.limitType}`}function gr(i){return`Query(target=${function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(s=>HI(s)).join(", ")}]`),Ua(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(s=>Ar(s)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(s=>Ar(s)).join(",")),`Target(${n})`}(bt(i))}; limitType=${i.limitType})`}function za(i,e){return e.isFoundDocument()&&function(n,s){let r=s.key.path;return n.collectionGroup!==null?s.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(r):q.isDocumentKey(n.path)?n.path.isEqual(r):n.path.isImmediateParentOf(r)}(i,e)&&function(n,s){for(let r of Tr(n))if(!r.field.isKeyField()&&s.data.field(r.field)===null)return!1;return!0}(i,e)&&function(n,s){for(let r of n.filters)if(!r.matches(s))return!1;return!0}(i,e)&&function(n,s){return!(n.startAt&&!function(o,a,u){let c=FT(o,a,u);return o.inclusive?c<=0:c<0}(n.startAt,Tr(n),s)||n.endAt&&!function(o,a,u){let c=FT(o,a,u);return o.inclusive?c>=0:c>0}(n.endAt,Tr(n),s))}(i,e)}function ZI(i){return i.collectionGroup||(i.path.length%2==1?i.path.lastSegment():i.path.get(i.path.length-2))}function e0(i){return(e,t)=>{let n=!1;for(let s of Tr(i)){let r=nN(s,e,t);if(r!==0)return r;n=n||s.field.isKeyField()}return 0}}function nN(i,e,t){let n=i.field.isKeyField()?q.comparator(e.key,t.key):function(r,o,a){let u=o.data.field(r),c=a.data.field(r);return u!==null&&c!==null?Ni(u,c):j()}(i.field,e,t);switch(i.dir){case"asc":return n;case"desc":return-1*n;default:return j()}}var Rn=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(let[s,r]of n)if(this.equalsFn(s,e))return r}}has(e){return this.get(e)!==void 0}set(e,t){let n=this.mapKeyFn(e),s=this.inner[n];if(s===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return void(s[r]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],e))return n.length===1?delete this.inner[t]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Ss(this.inner,(t,n)=>{for(let[s,r]of n)e(s,r)})}isEmpty(){return qI(this.inner)}size(){return this.innerSize}};var iN=new Ne(q.comparator);function xt(){return iN}var t0=new Ne(q.comparator);function da(...i){let e=t0;for(let t of i)e=e.insert(t.key,t);return e}function n0(i){let e=t0;return i.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function Tn(){return pa()}function i0(){return pa()}function pa(){return new Rn(i=>i.toString(),(i,e)=>i.isEqual(e))}var sN=new Ne(q.comparator),rN=new Ie(q.comparator);function ie(...i){let e=rN;for(let t of i)e=e.add(t);return e}var oN=new Ie(Z);function Dg(){return oN}function kg(i,e){if(i.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:wa(e)?"-0":e}}function s0(i){return{integerValue:""+i}}function r0(i,e){return VI(e)?s0(e):kg(i,e)}var Rr=class{constructor(){this._=void 0}};function aN(i,e,t){return i instanceof xi?function(s,r){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return r&&Xc(r)&&(r=Pg(r)),r&&(o.fields.__previous_value__=r),{mapValue:o}}(t,e):i instanceof Qn?a0(i,e):i instanceof Wn?l0(i,e):function(s,r){let o=o0(s,r),a=jT(o)+jT(s.Pe);return Um(o)&&Um(s.Pe)?s0(a):kg(s.serializer,a)}(i,e)}function lN(i,e,t){return i instanceof Qn?a0(i,e):i instanceof Wn?l0(i,e):t}function o0(i,e){return i instanceof Di?function(n){return Um(n)||function(r){return!!r&&"doubleValue"in r}(n)}(e)?e:{integerValue:0}:null}var xi=class extends Rr{},Qn=class extends Rr{constructor(e){super(),this.elements=e}};function a0(i,e){let t=u0(e);for(let n of i.elements)t.some(s=>An(s,n))||t.push(n);return{arrayValue:{values:t}}}var Wn=class extends Rr{constructor(e){super(),this.elements=e}};function l0(i,e){let t=u0(e);for(let n of i.elements)t=t.filter(s=>!An(s,n));return{arrayValue:{values:t}}}var Di=class extends Rr{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function jT(i){return ke(i.integerValue||i.doubleValue)}function u0(i){return Sa(i)&&i.arrayValue.values?i.arrayValue.values.slice():[]}var _s=class{constructor(e,t){this.field=e,this.transform=t}};function uN(i,e){return i.field.isEqual(e.field)&&function(n,s){return n instanceof Qn&&s instanceof Qn||n instanceof Wn&&s instanceof Wn?Sr(n.elements,s.elements,An):n instanceof Di&&s instanceof Di?An(n.Pe,s.Pe):n instanceof xi&&s instanceof xi}(i.transform,e.transform)}var Xm=class{constructor(e,t){this.version=e,this.transformResults=t}},Ue=class i{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new i}static exists(e){return new i(void 0,e)}static updateTime(e){return new i(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Zu(i,e){return i.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(i.updateTime):i.exists===void 0||i.exists===e.isFoundDocument()}var Pr=class{};function c0(i,e){if(!i.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return i.isNoDocument()?new Oi(i.key,Ue.none()):new ki(i.key,i.data,Ue.none());{let t=i.data,n=gt.empty(),s=new Ie(ze.comparator);for(let r of e.fields)if(!s.has(r)){let o=t.field(r);o===null&&r.length>1&&(r=r.popLast(),o=t.field(r)),o===null?n.delete(r):n.set(r,o),s=s.add(r)}return new an(i.key,n,new Lt(s.toArray()),Ue.none())}}function cN(i,e,t){i instanceof ki?function(s,r,o){let a=s.value.clone(),u=GT(s.fieldTransforms,r,o.transformResults);a.setAll(u),r.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(i,e,t):i instanceof an?function(s,r,o){if(!Zu(s.precondition,r))return void r.convertToUnknownDocument(o.version);let a=GT(s.fieldTransforms,r,o.transformResults),u=r.data;u.setAll(h0(s)),u.setAll(a),r.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(i,e,t):function(s,r,o){r.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function ga(i,e,t,n){return i instanceof ki?function(r,o,a,u){if(!Zu(r.precondition,o))return a;let c=r.value.clone(),d=KT(r.fieldTransforms,u,o);return c.setAll(d),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(i,e,t,n):i instanceof an?function(r,o,a,u){if(!Zu(r.precondition,o))return a;let c=KT(r.fieldTransforms,u,o),d=o.data;return d.setAll(h0(r)),d.setAll(c),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(r.fieldMask.fields).unionWith(r.fieldTransforms.map(f=>f.field))}(i,e,t,n):function(r,o,a){return Zu(r.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(i,e,t)}function hN(i,e){let t=null;for(let n of i.fieldTransforms){let s=e.data.field(n.field),r=o0(n.transform,s||null);r!=null&&(t===null&&(t=gt.empty()),t.set(n.field,r))}return t||null}function zT(i,e){return i.type===e.type&&!!i.key.isEqual(e.key)&&!!i.precondition.isEqual(e.precondition)&&!!function(n,s){return n===void 0&&s===void 0||!(!n||!s)&&Sr(n,s,(r,o)=>uN(r,o))}(i.fieldTransforms,e.fieldTransforms)&&(i.type===0?i.value.isEqual(e.value):i.type!==1||i.data.isEqual(e.data)&&i.fieldMask.isEqual(e.fieldMask))}var ki=class extends Pr{constructor(e,t,n,s=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}},an=class extends Pr{constructor(e,t,n,s,r=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=s,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}};function h0(i){let e=new Map;return i.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let n=i.data.field(t);e.set(t,n)}}),e}function GT(i,e,t){let n=new Map;G(i.length===t.length);for(let s=0;s<t.length;s++){let r=i[s],o=r.transform,a=e.data.field(r.field);n.set(r.field,lN(o,a,t[s]))}return n}function KT(i,e,t){let n=new Map;for(let s of i){let r=s.transform,o=t.data.field(s.field);n.set(s.field,aN(r,o,e))}return n}var Oi=class extends Pr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},ba=class extends Pr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Aa=class{constructor(e,t,n,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let s=0;s<this.mutations.length;s++){let r=this.mutations[s];r.key.isEqual(e.key)&&cN(r,e,n[s])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=ga(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=ga(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=i0();return this.mutations.forEach(s=>{let r=e.get(s.key),o=r.overlayedDocument,a=this.applyToLocalView(o,r.mutatedFields);a=t.has(s.key)?null:a;let u=c0(o,a);u!==null&&n.set(s.key,u),o.isValidDocument()||o.convertToNoDocument(W.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ie())}isEqual(e){return this.batchId===e.batchId&&Sr(this.mutations,e.mutations,(t,n)=>zT(t,n))&&Sr(this.baseMutations,e.baseMutations,(t,n)=>zT(t,n))}},Zm=class i{constructor(e,t,n,s){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=s}static from(e,t,n){G(e.mutations.length===n.length);let s=function(){return sN}(),r=e.mutations;for(let o=0;o<r.length;o++)s=s.insert(r[o].key,n[o].version);return new i(e,t,n,s)}};var Ca=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var ep=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var He,fe;function d0(i){switch(i){default:return j();case x.CANCELLED:case x.UNKNOWN:case x.DEADLINE_EXCEEDED:case x.RESOURCE_EXHAUSTED:case x.INTERNAL:case x.UNAVAILABLE:case x.UNAUTHENTICATED:return!1;case x.INVALID_ARGUMENT:case x.NOT_FOUND:case x.ALREADY_EXISTS:case x.PERMISSION_DENIED:case x.FAILED_PRECONDITION:case x.ABORTED:case x.OUT_OF_RANGE:case x.UNIMPLEMENTED:case x.DATA_LOSS:return!0}}function f0(i){if(i===void 0)return je("GRPC error has no .code"),x.UNKNOWN;switch(i){case He.OK:return x.OK;case He.CANCELLED:return x.CANCELLED;case He.UNKNOWN:return x.UNKNOWN;case He.DEADLINE_EXCEEDED:return x.DEADLINE_EXCEEDED;case He.RESOURCE_EXHAUSTED:return x.RESOURCE_EXHAUSTED;case He.INTERNAL:return x.INTERNAL;case He.UNAVAILABLE:return x.UNAVAILABLE;case He.UNAUTHENTICATED:return x.UNAUTHENTICATED;case He.INVALID_ARGUMENT:return x.INVALID_ARGUMENT;case He.NOT_FOUND:return x.NOT_FOUND;case He.ALREADY_EXISTS:return x.ALREADY_EXISTS;case He.PERMISSION_DENIED:return x.PERMISSION_DENIED;case He.FAILED_PRECONDITION:return x.FAILED_PRECONDITION;case He.ABORTED:return x.ABORTED;case He.OUT_OF_RANGE:return x.OUT_OF_RANGE;case He.UNIMPLEMENTED:return x.UNIMPLEMENTED;case He.DATA_LOSS:return x.DATA_LOSS;default:return j()}}(fe=He||(He={}))[fe.OK=0]="OK",fe[fe.CANCELLED=1]="CANCELLED",fe[fe.UNKNOWN=2]="UNKNOWN",fe[fe.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",fe[fe.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",fe[fe.NOT_FOUND=5]="NOT_FOUND",fe[fe.ALREADY_EXISTS=6]="ALREADY_EXISTS",fe[fe.PERMISSION_DENIED=7]="PERMISSION_DENIED",fe[fe.UNAUTHENTICATED=16]="UNAUTHENTICATED",fe[fe.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",fe[fe.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",fe[fe.ABORTED=10]="ABORTED",fe[fe.OUT_OF_RANGE=11]="OUT_OF_RANGE",fe[fe.UNIMPLEMENTED=12]="UNIMPLEMENTED",fe[fe.INTERNAL=13]="INTERNAL",fe[fe.UNAVAILABLE=14]="UNAVAILABLE",fe[fe.DATA_LOSS=15]="DATA_LOSS";var QT=null;function m0(){return new TextEncoder}var dN=new vi([4294967295,4294967295],0);function WT(i){let e=m0().encode(i),t=new pm;return t.update(e),new Uint8Array(t.digest())}function $T(i){let e=new DataView(i.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),s=e.getUint32(8,!0),r=e.getUint32(12,!0);return[new vi([t,n],0),new vi([s,r],0)]}var tp=class i{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new hs(`Invalid padding: ${t}`);if(n<0)throw new hs(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new hs(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new hs(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=vi.fromNumber(this.Ie)}Ee(e,t,n){let s=e.add(t.multiply(vi.fromNumber(n)));return s.compare(dN)===1&&(s=new vi([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=WT(e),[n,s]=$T(t);for(let r=0;r<this.hashCount;r++){let o=this.Ee(n,s,r);if(!this.de(o))return!1}return!0}static create(e,t,n){let s=e%8==0?0:8-e%8,r=new Uint8Array(Math.ceil(e/8)),o=new i(r,s,t);return n.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;let t=WT(e),[n,s]=$T(t);for(let r=0;r<this.hashCount;r++){let o=this.Ee(n,s,r);this.Ae(o)}}Ae(e){let t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}},hs=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Ra=class i{constructor(e,t,n,s,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let s=new Map;return s.set(e,Pa.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new i(W.min(),s,new Ne(Z),xt(),ie())}},Pa=class i{constructor(e,t,n,s,r){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new i(n,t,ie(),ie(),ie())}};var Ir=class{constructor(e,t,n,s){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=s}},fc=class{constructor(e,t){this.targetId=e,this.me=t}},mc=class{constructor(e,t,n=Ke.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=s}},pc=class{constructor(){this.fe=0,this.ge=YT(),this.pe=Ke.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=ie(),t=ie(),n=ie();return this.ge.forEach((s,r)=>{switch(r){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:n=n.add(s);break;default:j()}}),new Pa(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=YT()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,G(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},np=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=xt(),this.qe=HT(),this.Qe=new Ne(Z)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:j()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,s)=>{this.ze(s)&&t(s)})}He(e){let t=e.targetId,n=e.me.count,s=this.Je(t);if(s){let r=s.target;if(cc(r))if(n===0){let o=new q(r.path);this.Ue(t,o,Xe.newNoDocument(o,W.min()))}else G(n===1);else{let o=this.Ye(t);if(o!==n){let a=this.Ze(e),u=a?this.Xe(a,e,o):1;if(u!==0){this.je(t);let c=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}QT?.et(function(d,f,p,_,E){var S,R,V,B,F,K;let ne={localCacheCount:d,existenceFilterCount:f.count,databaseId:p.database,projectId:p.projectId},H=f.unchangedNames;return H&&(ne.bloomFilter={applied:E===0,hashCount:(S=H?.hashCount)!==null&&S!==void 0?S:0,bitmapLength:(B=(V=(R=H?.bits)===null||R===void 0?void 0:R.bitmap)===null||V===void 0?void 0:V.length)!==null&&B!==void 0?B:0,padding:(K=(F=H?.bits)===null||F===void 0?void 0:F.padding)!==null&&K!==void 0?K:0,mightContain:T=>{var y;return(y=_?.mightContain(T))!==null&&y!==void 0&&y}}),ne}(o,e.me,this.Le.tt(),a,u))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:n="",padding:s=0},hashCount:r=0}=t,o,a;try{o=Ri(n).toUint8Array()}catch(u){if(u instanceof ac)return rn("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new tp(o,s,r)}catch(u){return rn(u instanceof hs?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return a.Ie===0?null:a}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){let n=this.Le.getRemoteKeysForTarget(t),s=0;return n.forEach(r=>{let o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${r.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,r,null),s++)}),s}rt(e){let t=new Map;this.Be.forEach((r,o)=>{let a=this.Je(o);if(a){if(r.current&&cc(a.target)){let u=new q(a.target.path);this.ke.get(u)!==null||this.it(o,u)||this.Ue(o,u,Xe.newNoDocument(u,e))}r.be&&(t.set(o,r.ve()),r.Ce())}});let n=ie();this.qe.forEach((r,o)=>{let a=!0;o.forEachWhile(u=>{let c=this.Je(u);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(n=n.add(r))}),this.ke.forEach((r,o)=>o.setReadTime(e));let s=new Ra(e,t,this.Qe,this.ke,n);return this.ke=xt(),this.qe=HT(),this.Qe=new Ne(Z),s}$e(e,t){if(!this.ze(e))return;let n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;let s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new pc,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Ie(Z),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||O("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new pc),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function HT(){return new Ne(q.comparator)}function YT(){return new Ne(q.comparator)}var fN={asc:"ASCENDING",desc:"DESCENDING"},mN={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},pN={and:"AND",or:"OR"},ip=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function sp(i,e){return i.useProto3Json||Ua(e)?e:{value:e}}function Nr(i,e){return i.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function p0(i,e){return i.useProto3Json?e.toBase64():e.toUint8Array()}function gN(i,e){return Nr(i,e.toTimestamp())}function Ge(i){return G(!!i),W.fromTimestamp(function(t){let n=Kn(t);return new Me(n.seconds,n.nanos)}(i))}function Og(i,e){return rp(i,e).canonicalString()}function rp(i,e){let t=function(s){return new me(["projects",s.projectId,"databases",s.database])}(i).child("documents");return e===void 0?t:t.child(e)}function g0(i){let e=me.fromString(i);return G(A0(e)),e}function Na(i,e){return Og(i.databaseId,e.path)}function Sn(i,e){let t=g0(e);if(t.get(1)!==i.databaseId.projectId)throw new k(x.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+i.databaseId.projectId);if(t.get(3)!==i.databaseId.database)throw new k(x.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+i.databaseId.database);return new q(v0(t))}function _0(i,e){return Og(i.databaseId,e)}function y0(i){let e=g0(i);return e.length===4?me.emptyPath():v0(e)}function op(i){return new me(["projects",i.databaseId.projectId,"databases",i.databaseId.database]).canonicalString()}function v0(i){return G(i.length>4&&i.get(4)==="documents"),i.popFirst(5)}function JT(i,e,t){return{name:Na(i,e),fields:t.value.mapValue.fields}}function w0(i,e,t){let n=Sn(i,e.name),s=Ge(e.updateTime),r=e.createTime?Ge(e.createTime):W.min(),o=new gt({mapValue:{fields:e.fields}}),a=Xe.newFoundDocument(n,s,r,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function _N(i,e){return"found"in e?function(n,s){G(!!s.found),s.found.name,s.found.updateTime;let r=Sn(n,s.found.name),o=Ge(s.found.updateTime),a=s.found.createTime?Ge(s.found.createTime):W.min(),u=new gt({mapValue:{fields:s.found.fields}});return Xe.newFoundDocument(r,o,a,u)}(i,e):"missing"in e?function(n,s){G(!!s.missing),G(!!s.readTime);let r=Sn(n,s.missing),o=Ge(s.readTime);return Xe.newNoDocument(r,o)}(i,e):j()}function yN(i,e){let t;if("targetChange"in e){e.targetChange;let n=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:j()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],r=function(c,d){return c.useProto3Json?(G(d===void 0||typeof d=="string"),Ke.fromBase64String(d||"")):(G(d===void 0||d instanceof Buffer||d instanceof Uint8Array),Ke.fromUint8Array(d||new Uint8Array))}(i,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){let d=c.code===void 0?x.UNKNOWN:f0(c.code);return new k(d,c.message||"")}(o);t=new mc(n,s,r,a||null)}else if("documentChange"in e){e.documentChange;let n=e.documentChange;n.document,n.document.name,n.document.updateTime;let s=Sn(i,n.document.name),r=Ge(n.document.updateTime),o=n.document.createTime?Ge(n.document.createTime):W.min(),a=new gt({mapValue:{fields:n.document.fields}}),u=Xe.newFoundDocument(s,r,o,a),c=n.targetIds||[],d=n.removedTargetIds||[];t=new Ir(c,d,u.key,u)}else if("documentDelete"in e){e.documentDelete;let n=e.documentDelete;n.document;let s=Sn(i,n.document),r=n.readTime?Ge(n.readTime):W.min(),o=Xe.newNoDocument(s,r),a=n.removedTargetIds||[];t=new Ir([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let n=e.documentRemove;n.document;let s=Sn(i,n.document),r=n.removedTargetIds||[];t=new Ir([],r,s,null)}else{if(!("filter"in e))return j();{e.filter;let n=e.filter;n.targetId;let{count:s=0,unchangedNames:r}=n,o=new ep(s,r),a=n.targetId;t=new fc(a,o)}}return t}function xa(i,e){let t;if(e instanceof ki)t={update:JT(i,e.key,e.value)};else if(e instanceof Oi)t={delete:Na(i,e.key)};else if(e instanceof an)t={update:JT(i,e.key,e.data),updateMask:SN(e.fieldMask)};else{if(!(e instanceof ba))return j();t={verify:Na(i,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(r,o){let a=o.transform;if(a instanceof xi)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Qn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Wn)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Di)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw j()}(0,n))),e.precondition.isNone||(t.currentDocument=function(s,r){return r.updateTime!==void 0?{updateTime:gN(s,r.updateTime)}:r.exists!==void 0?{exists:r.exists}:j()}(i,e.precondition)),t}function ap(i,e){let t=e.currentDocument?function(r){return r.updateTime!==void 0?Ue.updateTime(Ge(r.updateTime)):r.exists!==void 0?Ue.exists(r.exists):Ue.none()}(e.currentDocument):Ue.none(),n=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let u=null;if("setToServerValue"in a)G(a.setToServerValue==="REQUEST_TIME"),u=new xi;else if("appendMissingElements"in a){let d=a.appendMissingElements.values||[];u=new Qn(d)}else if("removeAllFromArray"in a){let d=a.removeAllFromArray.values||[];u=new Wn(d)}else"increment"in a?u=new Di(o,a.increment):j();let c=ze.fromServerFormat(a.fieldPath);return new _s(c,u)}(i,s)):[];if(e.update){e.update.name;let s=Sn(i,e.update.name),r=new gt({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(u){let c=u.fieldPaths||[];return new Lt(c.map(d=>ze.fromServerFormat(d)))}(e.updateMask);return new an(s,r,o,t,n)}return new ki(s,r,t,n)}if(e.delete){let s=Sn(i,e.delete);return new Oi(s,t)}if(e.verify){let s=Sn(i,e.verify);return new ba(s,t)}return j()}function vN(i,e){return i&&i.length>0?(G(e!==void 0),i.map(t=>function(s,r){let o=s.updateTime?Ge(s.updateTime):Ge(r);return o.isEqual(W.min())&&(o=Ge(r)),new Xm(o,s.transformResults||[])}(t,e))):[]}function E0(i,e){return{documents:[_0(i,e.path)]}}function T0(i,e){let t={structuredQuery:{}},n=e.path,s;e.collectionGroup!==null?(s=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=_0(i,s);let r=function(c){if(c.length!==0)return b0(we.create(c,"and"))}(e.filters);r&&(t.structuredQuery.where=r);let o=function(c){if(c.length!==0)return c.map(d=>function(p){return{field:_r(p.field),direction:EN(p.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=sp(i,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:s}}function I0(i){let e=y0(i.parent),t=i.structuredQuery,n=t.from?t.from.length:0,s=null;if(n>0){G(n===1);let d=t.from[0];d.allDescendants?s=d.collectionId:e=e.child(d.collectionId)}let r=[];t.where&&(r=function(f){let p=S0(f);return p instanceof we&&Ng(p)?p.getFilters():[p]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(p=>function(E){return new ps(yr(E.field),function(R){switch(R){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(E.direction))}(p))}(t.orderBy));let a=null;t.limit&&(a=function(f){let p;return p=typeof f=="object"?f.value:f,Ua(p)?null:p}(t.limit));let u=null;t.startAt&&(u=function(f){let p=!!f.before,_=f.values||[];return new Cn(_,p)}(t.startAt));let c=null;return t.endAt&&(c=function(f){let p=!f.before,_=f.values||[];return new Cn(_,p)}(t.endAt)),JI(e,s,o,r,a,"F",u,c)}function wN(i,e){let t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return j()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function S0(i){return i.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let n=yr(t.unaryFilter.field);return de.create(n,"==",{doubleValue:NaN});case"IS_NULL":let s=yr(t.unaryFilter.field);return de.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=yr(t.unaryFilter.field);return de.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=yr(t.unaryFilter.field);return de.create(o,"!=",{nullValue:"NULL_VALUE"});default:return j()}}(i):i.fieldFilter!==void 0?function(t){return de.create(yr(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return j()}}(t.fieldFilter.op),t.fieldFilter.value)}(i):i.compositeFilter!==void 0?function(t){return we.create(t.compositeFilter.filters.map(n=>S0(n)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return j()}}(t.compositeFilter.op))}(i):j()}function EN(i){return fN[i]}function TN(i){return mN[i]}function IN(i){return pN[i]}function _r(i){return{fieldPath:i.canonicalString()}}function yr(i){return ze.fromServerFormat(i.fieldPath)}function b0(i){return i instanceof de?function(t){if(t.op==="=="){if(OT(t.value))return{unaryFilter:{field:_r(t.field),op:"IS_NAN"}};if(kT(t.value))return{unaryFilter:{field:_r(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(OT(t.value))return{unaryFilter:{field:_r(t.field),op:"IS_NOT_NAN"}};if(kT(t.value))return{unaryFilter:{field:_r(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:_r(t.field),op:TN(t.op),value:t.value}}}(i):i instanceof we?function(t){let n=t.getFilters().map(s=>b0(s));return n.length===1?n[0]:{compositeFilter:{op:IN(t.op),filters:n}}}(i):j()}function SN(i){let e=[];return i.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function A0(i){return i.length>=4&&i.get(0)==="projects"&&i.get(2)==="databases"}var xr=class i{constructor(e,t,n,s,r=W.min(),o=W.min(),a=Ke.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(e){return new i(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new i(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new i(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new i(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var gc=class{constructor(e){this.ct=e}};function bN(i,e){let t;if(e.document)t=w0(i.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let n=q.fromSegments(e.noDocument.path),s=vs(e.noDocument.readTime);t=Xe.newNoDocument(n,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return j();{let n=q.fromSegments(e.unknownDocument.path),s=vs(e.unknownDocument.version);t=Xe.newUnknownDocument(n,s)}}return e.readTime&&t.setReadTime(function(s){let r=new Me(s[0],s[1]);return W.fromTimestamp(r)}(e.readTime)),t}function XT(i,e){let t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:_c(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document=function(r,o){return{name:Na(r,o.key),fields:o.data.value.mapValue.fields,updateTime:Nr(r,o.version.toTimestamp()),createTime:Nr(r,o.createTime.toTimestamp())}}(i.ct,e);else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:ys(e.version)};else{if(!e.isUnknownDocument())return j();n.unknownDocument={path:t.path.toArray(),version:ys(e.version)}}return n}function _c(i){let e=i.toTimestamp();return[e.seconds,e.nanoseconds]}function ys(i){let e=i.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function vs(i){let e=new Me(i.seconds,i.nanoseconds);return W.fromTimestamp(e)}function ls(i,e){let t=(e.baseMutations||[]).map(r=>ap(i.ct,r));for(let r=0;r<e.mutations.length-1;++r){let o=e.mutations[r];if(r+1<e.mutations.length&&e.mutations[r+1].transform!==void 0){let a=e.mutations[r+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(r+1,1),++r}}let n=e.mutations.map(r=>ap(i.ct,r)),s=Me.fromMillis(e.localWriteTimeMs);return new Aa(e.batchId,s,t,n)}function fa(i){let e=vs(i.readTime),t=i.lastLimboFreeSnapshotVersion!==void 0?vs(i.lastLimboFreeSnapshotVersion):W.min(),n;return n=function(r){return r.documents!==void 0}(i.query)?function(r){return G(r.documents.length===1),bt(jr(y0(r.documents[0])))}(i.query):function(r){return bt(I0(r))}(i.query),new xr(n,i.targetId,"TargetPurposeListen",i.lastListenSequenceNumber,e,t,Ke.fromBase64String(i.resumeToken))}function C0(i,e){let t=ys(e.snapshotVersion),n=ys(e.lastLimboFreeSnapshotVersion),s;s=cc(e.target)?E0(i.ct,e.target):T0(i.ct,e.target)._t;let r=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:gs(e.target),readTime:t,resumeToken:r,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:s}}function Mg(i){let e=I0({parent:i.parent,structuredQuery:i.structuredQuery});return i.limitType==="LAST"?dc(e,e.limit,"L"):e}function Em(i,e){return new Ca(e.largestBatchId,ap(i.ct,e.overlayMutation))}function ZT(i,e){let t=e.path.lastSegment();return[i,St(e.path.popLast()),t]}function eI(i,e,t,n){return{indexId:i,uid:e,sequenceNumber:t,readTime:ys(n.readTime),documentKey:St(n.documentKey.path),largestBatchId:n.largestBatchId}}var lp=class{getBundleMetadata(e,t){return tI(e).get(t).next(n=>{if(n)return function(r){return{id:r.bundleId,createTime:vs(r.createTime),version:r.version}}(n)})}saveBundleMetadata(e,t){return tI(e).put(function(s){return{bundleId:s.id,createTime:ys(Ge(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return nI(e).get(t).next(n=>{if(n)return function(r){return{name:r.name,query:Mg(r.bundledQuery),readTime:vs(r.readTime)}}(n)})}saveNamedQuery(e,t){return nI(e).put(function(s){return{name:s.name,readTime:ys(Ge(s.readTime)),bundledQuery:s.bundledQuery}}(t))}};function tI(i){return it(i,"bundles")}function nI(i){return it(i,"namedQueries")}var yc=class i{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){let n=t.uid||"";return new i(e,n)}getOverlay(e,t){return la(e).get(ZT(this.userId,t)).next(n=>n?Em(this.serializer,n):null)}getOverlays(e,t){let n=Tn();return P.forEach(t,s=>this.getOverlay(e,s).next(r=>{r!==null&&n.set(s,r)})).next(()=>n)}saveOverlays(e,t,n){let s=[];return n.forEach((r,o)=>{let a=new Ca(t,o);s.push(this.ht(e,a))}),P.waitFor(s)}removeOverlaysForBatchId(e,t,n){let s=new Set;t.forEach(o=>s.add(St(o.getCollectionPath())));let r=[];return s.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,n],[this.userId,o,n+1],!1,!0);r.push(la(e).j("collectionPathOverlayIndex",a))}),P.waitFor(r)}getOverlaysForCollection(e,t,n){let s=Tn(),r=St(t),o=IDBKeyRange.bound([this.userId,r,n],[this.userId,r,Number.POSITIVE_INFINITY],!0);return la(e).U("collectionPathOverlayIndex",o).next(a=>{for(let u of a){let c=Em(this.serializer,u);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,t,n,s){let r=Tn(),o,a=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return la(e).J({index:"collectionGroupOverlayIndex",range:a},(u,c,d)=>{let f=Em(this.serializer,c);r.size()<s||f.largestBatchId===o?(r.set(f.getKey(),f),o=f.largestBatchId):d.done()}).next(()=>r)}ht(e,t){return la(e).put(function(s,r,o){let[a,u,c]=ZT(r,o.mutation.key);return{userId:r,collectionPath:u,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:xa(s.ct,o.mutation)}}(this.serializer,this.userId,t))}};function la(i){return it(i,"documentOverlays")}var up=class{Pt(e){return it(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{let n=t?.value;return n?Ke.fromUint8Array(n):Ke.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}};var zn=class{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(ke(e.integerValue));else if("doubleValue"in e){let n=ke(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),wa(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),typeof n=="string"&&(n=Kn(n)),t.Rt(`${n.seconds||""}`),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(Ri(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?zI(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Zc(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):j()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){let n=e.fields||{};this.dt(t,55);for(let s of Object.keys(n))this.Vt(s,t),this.Tt(n[s],t)}wt(e,t){var n,s;let r=e.fields||{};this.dt(t,53);let o="value",a=((s=(n=r[o].arrayValue)===null||n===void 0?void 0:n.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At(ke(a)),this.Vt(o,t),this.Tt(r[o],t)}bt(e,t){let n=e.values||[];this.dt(t,50);for(let s of n)this.Tt(s,t)}yt(e,t){this.dt(t,37),q.fromName(e).path.forEach(n=>{this.dt(t,60),this.Dt(n,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}};zn.vt=new zn;function AN(i){if(i===0)return 8;let e=0;return!(i>>4)&&(e+=4,i<<=4),!(i>>6)&&(e+=2,i<<=2),!(i>>7)&&(e+=1),e}function iI(i){let e=64-function(n){let s=0;for(let r=0;r<8;++r){let o=AN(255&n[r]);if(s+=o,o!==8)break}return s}(i);return Math.ceil(e/8)}var cp=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Ft(n.value),n=t.next();this.Mt()}xt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Ot(n.value),n=t.next();this.Nt()}Lt(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.Ft(n);else if(n<2048)this.Ft(960|n>>>6),this.Ft(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|n>>>12),this.Ft(128|63&n>>>6),this.Ft(128|63&n);else{let s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.Ot(n);else if(n<2048)this.Ot(960|n>>>6),this.Ot(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|n>>>12),this.Ot(128|63&n>>>6),this.Ot(128|63&n);else{let s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){let t=this.qt(e),n=iI(t);this.Qt(1+n),this.buffer[this.position++]=255&n;for(let s=t.length-n;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){let t=this.qt(e),n=iI(t);this.Qt(1+n),this.buffer[this.position++]=~(255&n);for(let s=t.length-n;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){let t=function(r){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,r,!1),new Uint8Array(o.buffer)}(e),n=(128&t[0])!=0;t[0]^=n?255:128;for(let s=1;s<t.length;++s)t[s]^=n?255:0;return t}Ft(e){let t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){let t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let s=new Uint8Array(n);s.set(this.buffer),this.buffer=s}},hp=class{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}},dp=class{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}},us=class{constructor(){this.jt=new cp,this.Ht=new hp(this.jt),this.Jt=new dp(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}};var cs=class i{constructor(e,t,n,s){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=s}Zt(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new i(this.indexId,this.documentKey,this.arrayValue,n)}};function wi(i,e){let t=i.indexId-e.indexId;return t!==0?t:(t=sI(i.arrayValue,e.arrayValue),t!==0?t:(t=sI(i.directionalValue,e.directionalValue),t!==0?t:q.comparator(i.documentKey,e.documentKey)))}function sI(i,e){for(let t=0;t<i.length&&t<e.length;++t){let n=i[t]-e[t];if(n!==0)return n}return i.length-e.length}var vc=class{constructor(e){this.Xt=new Ie((t,n)=>ze.comparator(t.field,n.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(let t of e.filters){let n=t;n.isInequality()?this.Xt=this.Xt.add(n):this.tn.push(n)}}get nn(){return this.Xt.size>1}rn(e){if(G(e.collectionGroup===this.collectionId),this.nn)return!1;let t=km(e);if(t!==void 0&&!this.sn(t))return!1;let n=os(e),s=new Set,r=0,o=0;for(;r<n.length&&this.sn(n[r]);++r)s=s.add(n[r].fieldPath.canonicalString());if(r===n.length)return!0;if(this.Xt.size>0){let a=this.Xt.getIterator().getNext();if(!s.has(a.field.canonicalString())){let u=n[r];if(!this.on(a,u)||!this._n(this.en[o++],u))return!1}++r}for(;r<n.length;++r){let a=n[r];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new Ie(ze.comparator),t=[];for(let n of this.tn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")t.push(new Er(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new Er(n.field,0))}for(let n of this.en)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new Er(n.field,n.dir==="asc"?0:1)));return new br(br.UNKNOWN_ID,this.collectionId,t,va.empty())}sn(e){for(let t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let n=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===n}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function R0(i){var e,t;if(G(i instanceof de||i instanceof we),i instanceof de){if(i instanceof uc){let s=((t=(e=i.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(r=>de.create(i.field,"==",r)))||[];return we.create(s,"or")}return i}let n=i.filters.map(s=>R0(s));return we.create(n,i.op)}function CN(i){if(i.getFilters().length===0)return[];let e=pp(R0(i));return G(P0(e)),fp(e)||mp(e)?[e]:e.getFilters()}function fp(i){return i instanceof de}function mp(i){return i instanceof we&&Ng(i)}function P0(i){return fp(i)||mp(i)||function(t){if(t instanceof we&&qm(t)){for(let n of t.getFilters())if(!fp(n)&&!mp(n))return!1;return!0}return!1}(i)}function pp(i){if(G(i instanceof de||i instanceof we),i instanceof de)return i;if(i.filters.length===1)return pp(i.filters[0]);let e=i.filters.map(n=>pp(n)),t=we.create(e,i.op);return t=wc(t),P0(t)?t:(G(t instanceof we),G(Cr(t)),G(t.filters.length>1),t.filters.reduce((n,s)=>Vg(n,s)))}function Vg(i,e){let t;return G(i instanceof de||i instanceof we),G(e instanceof de||e instanceof we),t=i instanceof de?e instanceof de?function(s,r){return we.create([s,r],"and")}(i,e):rI(i,e):e instanceof de?rI(e,i):function(s,r){if(G(s.filters.length>0&&r.filters.length>0),Cr(s)&&Cr(r))return $I(s,r.getFilters());let o=qm(s)?s:r,a=qm(s)?r:s,u=o.filters.map(c=>Vg(c,a));return we.create(u,"or")}(i,e),wc(t)}function rI(i,e){if(Cr(e))return $I(e,i.getFilters());{let t=e.filters.map(n=>Vg(i,n));return we.create(t,"or")}}function wc(i){if(G(i instanceof de||i instanceof we),i instanceof de)return i;let e=i.getFilters();if(e.length===1)return wc(e[0]);if(QI(i))return i;let t=e.map(s=>wc(s)),n=[];return t.forEach(s=>{s instanceof de?n.push(s):s instanceof we&&(s.op===i.op?n.push(...s.filters):n.push(s))}),n.length===1?n[0]:we.create(n,i.op)}var gp=class{constructor(){this.un=new Da}addToCollectionParentIndex(e,t){return this.un.add(t),P.resolve()}getCollectionParents(e,t){return P.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return P.resolve()}deleteFieldIndex(e,t){return P.resolve()}deleteAllFieldIndexes(e){return P.resolve()}createTargetIndexes(e,t){return P.resolve()}getDocumentsMatchingTarget(e,t){return P.resolve(null)}getIndexType(e,t){return P.resolve(0)}getFieldIndexes(e,t){return P.resolve([])}getNextCollectionGroupToUpdate(e){return P.resolve(null)}getMinOffset(e,t){return P.resolve(Ht.min())}getMinOffsetFromCollectionGroup(e,t){return P.resolve(Ht.min())}updateCollectionGroup(e,t,n){return P.resolve()}updateIndexEntries(e,t){return P.resolve()}},Da=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),s=this.index[t]||new Ie(me.comparator),r=!s.has(n);return this.index[t]=s.add(n),r}has(e){let t=e.lastSegment(),n=e.popLast(),s=this.index[t];return s&&s.has(n)}getEntries(e){return(this.index[e]||new Ie(me.comparator)).toArray()}};var Qu=new Uint8Array(0),_p=class{constructor(e,t){this.databaseId=t,this.cn=new Da,this.ln=new Rn(n=>gs(n),(n,s)=>qa(n,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){let n=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});let r={collectionId:n,parent:St(s)};return oI(e).put(r)}return P.resolve()}getCollectionParents(e,t){let n=[],s=IDBKeyRange.bound([t,""],[xI(t),""],!1,!0);return oI(e).U(s).next(r=>{for(let o of r){if(o.collectionId!==t)break;n.push(En(o.parent))}return n})}addFieldIndex(e,t){let n=ua(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(t);delete s.indexId;let r=n.add(s);if(t.indexState){let o=fr(e);return r.next(a=>{o.put(eI(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return r.next()}deleteFieldIndex(e,t){let n=ua(e),s=fr(e),r=dr(e);return n.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=ua(e),n=dr(e),s=fr(e);return t.j().next(()=>n.j()).next(()=>s.j())}createTargetIndexes(e,t){return P.forEach(this.hn(t),n=>this.getIndexType(e,n).next(s=>{if(s===0||s===1){let r=new vc(n).an();if(r!=null)return this.addFieldIndex(e,r)}}))}getDocumentsMatchingTarget(e,t){let n=dr(e),s=!0,r=new Map;return P.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{s&&(s=!!a),r.set(o,a)})).next(()=>{if(s){let o=ie(),a=[];return P.forEach(r,(u,c)=>{O("IndexedDbIndexManager",`Using index ${function(F){return`id=${F.indexId}|cg=${F.collectionGroup}|f=${F.fields.map(K=>`${K.fieldPath}:${K.kind}`).join(",")}`}(u)} to execute ${gs(t)}`);let d=function(F,K){let ne=km(K);if(ne===void 0)return null;for(let H of hc(F,ne.fieldPath))switch(H.op){case"array-contains-any":return H.value.arrayValue.values||[];case"array-contains":return[H.value]}return null}(c,u),f=function(F,K){let ne=new Map;for(let H of os(K))for(let T of hc(F,H.fieldPath))switch(T.op){case"==":case"in":ne.set(H.fieldPath.canonicalString(),T.value);break;case"not-in":case"!=":return ne.set(H.fieldPath.canonicalString(),T.value),Array.from(ne.values())}return null}(c,u),p=function(F,K){let ne=[],H=!0;for(let T of os(K)){let y=T.kind===0?BT(F,T.fieldPath,F.startAt):UT(F,T.fieldPath,F.startAt);ne.push(y.value),H&&(H=y.inclusive)}return new Cn(ne,H)}(c,u),_=function(F,K){let ne=[],H=!0;for(let T of os(K)){let y=T.kind===0?UT(F,T.fieldPath,F.endAt):BT(F,T.fieldPath,F.endAt);ne.push(y.value),H&&(H=y.inclusive)}return new Cn(ne,H)}(c,u),E=this.In(u,c,p),S=this.In(u,c,_),R=this.Tn(u,c,f),V=this.En(u.indexId,d,E,p.inclusive,S,_.inclusive,R);return P.forEach(V,B=>n.G(B,t.limit).next(F=>{F.forEach(K=>{let ne=q.fromSegments(K.documentKey);o.has(ne)||(o=o.add(ne),a.push(ne))})}))}).next(()=>a)}return P.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=CN(we.create(e.filters,"and")).map(n=>Ym(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,n,s,r,o,a){let u=(t!=null?t.length:1)*Math.max(n.length,r.length),c=u/(t!=null?t.length:1),d=[];for(let f=0;f<u;++f){let p=t?this.dn(t[f/c]):Qu,_=this.An(e,p,n[f%c],s),E=this.Rn(e,p,r[f%c],o),S=a.map(R=>this.An(e,p,R,!0));d.push(...this.createRange(_,E,S))}return d}An(e,t,n,s){let r=new cs(e,q.empty(),t,n);return s?r:r.Zt()}Rn(e,t,n,s){let r=new cs(e,q.empty(),t,n);return s?r.Zt():r}Pn(e,t){let n=new vc(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(r=>{let o=null;for(let a of r)n.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let n=2,s=this.hn(t);return P.forEach(s,r=>this.Pn(e,r).next(o=>{o?n!==0&&o.fields.length<function(u){let c=new Ie(ze.comparator),d=!1;for(let f of u.filters)for(let p of f.getFlattenedFilters())p.field.isKeyField()||(p.op==="array-contains"||p.op==="array-contains-any"?d=!0:c=c.add(p.field));for(let f of u.orderBy)f.field.isKeyField()||(c=c.add(f.field));return c.size+(d?1:0)}(r)&&(n=1):n=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&n===2?1:n)}Vn(e,t){let n=new us;for(let s of os(e)){let r=t.data.field(s.fieldPath);if(r==null)return null;let o=n.Yt(s.kind);zn.vt.It(r,o)}return n.zt()}dn(e){let t=new us;return zn.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){let n=new us;return zn.vt.It(ms(this.databaseId,t),n.Yt(function(r){let o=os(r);return o.length===0?0:o[o.length-1].kind}(e))),n.zt()}Tn(e,t,n){if(n===null)return[];let s=[];s.push(new us);let r=0;for(let o of os(e)){let a=n[r++];for(let u of s)if(this.fn(t,o.fieldPath)&&Sa(a))s=this.gn(s,o,a);else{let c=u.Yt(o.kind);zn.vt.It(a,c)}}return this.pn(s)}In(e,t,n){return this.Tn(e,t,n.position)}pn(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].zt();return t}gn(e,t,n){let s=[...e],r=[];for(let o of n.arrayValue.values||[])for(let a of s){let u=new us;u.seed(a.zt()),zn.vt.It(o,u.Yt(t.kind)),r.push(u)}return r}fn(e,t){return!!e.filters.find(n=>n instanceof de&&n.field.isEqual(t)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(e,t){let n=ua(e),s=fr(e);return(t?n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.U()).next(r=>{let o=[];return P.forEach(r,a=>s.get([a.indexId,this.uid]).next(u=>{o.push(function(d,f){let p=f?new va(f.sequenceNumber,new Ht(vs(f.readTime),new q(En(f.documentKey)),f.largestBatchId)):va.empty(),_=d.fields.map(([E,S])=>new Er(ze.fromServerFormat(E),S));return new br(d.indexId,d.collectionGroup,_,p)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((n,s)=>{let r=n.indexState.sequenceNumber-s.indexState.sequenceNumber;return r!==0?r:Z(n.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,n){let s=ua(e),r=fr(e);return this.yn(e).next(o=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>P.forEach(a,u=>r.put(eI(u.indexId,this.uid,o,n)))))}updateIndexEntries(e,t){let n=new Map;return P.forEach(t,(s,r)=>{let o=n.get(s.collectionGroup);return(o?P.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(n.set(s.collectionGroup,a),P.forEach(a,u=>this.wn(e,s,u).next(c=>{let d=this.Sn(r,u);return c.isEqual(d)?P.resolve():this.bn(e,r,u,c,d)}))))})}Dn(e,t,n,s){return dr(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(n,t.key),documentKey:t.key.path.toArray()})}vn(e,t,n,s){return dr(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(n,t.key),t.key.path.toArray()])}wn(e,t,n){let s=dr(e),r=new Ie(wi);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.mn(n,t)])},(o,a)=>{r=r.add(new cs(n.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>r)}Sn(e,t){let n=new Ie(wi),s=this.Vn(t,e);if(s==null)return n;let r=km(t);if(r!=null){let o=e.data.field(r.fieldPath);if(Sa(o))for(let a of o.arrayValue.values||[])n=n.add(new cs(t.indexId,e.key,this.dn(a),s))}else n=n.add(new cs(t.indexId,e.key,Qu,s));return n}bn(e,t,n,s,r){O("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let o=[];return function(u,c,d,f,p){let _=u.getIterator(),E=c.getIterator(),S=hr(_),R=hr(E);for(;S||R;){let V=!1,B=!1;if(S&&R){let F=d(S,R);F<0?B=!0:F>0&&(V=!0)}else S!=null?B=!0:V=!0;V?(f(R),R=hr(E)):B?(p(S),S=hr(_)):(S=hr(_),R=hr(E))}}(s,r,wi,a=>{o.push(this.Dn(e,t,n,a))},a=>{o.push(this.vn(e,t,n,a))}),P.waitFor(o)}yn(e){let t=1;return fr(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,s,r)=>{r.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((o,a)=>wi(o,a)).filter((o,a,u)=>!a||wi(o,u[a-1])!==0);let s=[];s.push(e);for(let o of n){let a=wi(o,e),u=wi(o,t);if(a===0)s[0]=e.Zt();else if(a>0&&u<0)s.push(o),s.push(o.Zt());else if(u>0)break}s.push(t);let r=[];for(let o=0;o<s.length;o+=2){if(this.Cn(s[o],s[o+1]))return[];let a=[s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,Qu,[]],u=[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,Qu,[]];r.push(IDBKeyRange.bound(a,u))}return r}Cn(e,t){return wi(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(aI)}getMinOffset(e,t){return P.mapArray(this.hn(t),n=>this.Pn(e,n).next(s=>s||j())).next(aI)}};function oI(i){return it(i,"collectionParents")}function dr(i){return it(i,"indexEntries")}function ua(i){return it(i,"indexConfiguration")}function fr(i){return it(i,"indexState")}function aI(i){G(i.length!==0);let e=i[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<i.length;n++){let s=i[n].indexState.offset;Ag(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new Ht(e.readTime,e.documentKey,t)}var lI={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},$t=class i{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new i(e,i.DEFAULT_COLLECTION_PERCENTILE,i.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function N0(i,e,t){let n=i.store("mutations"),s=i.store("documentMutations"),r=[],o=IDBKeyRange.only(t.batchId),a=0,u=n.J({range:o},(d,f,p)=>(a++,p.delete()));r.push(u.next(()=>{G(a===1)}));let c=[];for(let d of t.mutations){let f=FI(e,d.key.path,t.batchId);r.push(s.delete(f)),c.push(d.key)}return P.waitFor(r).next(()=>c)}function Ec(i){if(!i)return 0;let e;if(i.document)e=i.document;else if(i.unknownDocument)e=i.unknownDocument;else{if(!i.noDocument)throw j();e=i.noDocument}return JSON.stringify(e).length}$t.DEFAULT_COLLECTION_PERCENTILE=10,$t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,$t.DEFAULT=new $t(41943040,$t.DEFAULT_COLLECTION_PERCENTILE,$t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),$t.DISABLED=new $t(-1,0,0);var Tc=class i{constructor(e,t,n,s){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=s,this.Fn={}}static lt(e,t,n,s){G(e.uid!=="");let r=e.isAuthenticated()?e.uid:"";return new i(r,t,n,s)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ei(e).J({index:"userMutationsIndex",range:n},(s,r,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,n,s){let r=vr(e),o=Ei(e);return o.add({}).next(a=>{G(typeof a=="number");let u=new Aa(a,t,n,s),c=function(_,E,S){let R=S.baseMutations.map(B=>xa(_.ct,B)),V=S.mutations.map(B=>xa(_.ct,B));return{userId:E,batchId:S.batchId,localWriteTimeMs:S.localWriteTime.toMillis(),baseMutations:R,mutations:V}}(this.serializer,this.userId,u),d=[],f=new Ie((p,_)=>Z(p.canonicalString(),_.canonicalString()));for(let p of s){let _=FI(this.userId,p.key.path,a);f=f.add(p.key.path.popLast()),d.push(o.put(c)),d.push(r.put(_,kP))}return f.forEach(p=>{d.push(this.indexManager.addToCollectionParentIndex(e,p))}),e.addOnCommittedListener(()=>{this.Fn[a]=u.keys()}),P.waitFor(d).next(()=>u)})}lookupMutationBatch(e,t){return Ei(e).get(t).next(n=>n?(G(n.userId===this.userId),ls(this.serializer,n)):null)}Mn(e,t){return this.Fn[t]?P.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(n=>{if(n){let s=n.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,s=IDBKeyRange.lowerBound([this.userId,n]),r=null;return Ei(e).J({index:"userMutationsIndex",range:s},(o,a,u)=>{a.userId===this.userId&&(G(a.batchId>=n),r=ls(this.serializer,a)),u.done()}).next(()=>r)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Ei(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,r,o)=>{n=r.batchId,o.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ei(e).U("userMutationsIndex",t).next(n=>n.map(s=>ls(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=Yu(this.userId,t.path),s=IDBKeyRange.lowerBound(n),r=[];return vr(e).J({range:s},(o,a,u)=>{let[c,d,f]=o,p=En(d);if(c===this.userId&&t.path.isEqual(p))return Ei(e).get(f).next(_=>{if(!_)throw j();G(_.userId===this.userId),r.push(ls(this.serializer,_))});u.done()}).next(()=>r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Ie(Z),s=[];return t.forEach(r=>{let o=Yu(this.userId,r.path),a=IDBKeyRange.lowerBound(o),u=vr(e).J({range:a},(c,d,f)=>{let[p,_,E]=c,S=En(_);p===this.userId&&r.path.isEqual(S)?n=n.add(E):f.done()});s.push(u)}),P.waitFor(s).next(()=>this.xn(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,s=n.length+1,r=Yu(this.userId,n),o=IDBKeyRange.lowerBound(r),a=new Ie(Z);return vr(e).J({range:o},(u,c,d)=>{let[f,p,_]=u,E=En(p);f===this.userId&&n.isPrefixOf(E)?E.length===s&&(a=a.add(_)):d.done()}).next(()=>this.xn(e,a))}xn(e,t){let n=[],s=[];return t.forEach(r=>{s.push(Ei(e).get(r).next(o=>{if(o===null)throw j();G(o.userId===this.userId),n.push(ls(this.serializer,o))}))}),P.waitFor(s).next(()=>n)}removeMutationBatch(e,t){return N0(e._e,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),P.forEach(n,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return P.resolve();let n=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return vr(e).J({range:n},(r,o,a)=>{if(r[0]===this.userId){let u=En(r[1]);s.push(u)}else a.done()}).next(()=>{G(s.length===0)})})}containsKey(e,t){return x0(e,this.userId,t)}Nn(e){return D0(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function x0(i,e,t){let n=Yu(e,t.path),s=n[1],r=IDBKeyRange.lowerBound(n),o=!1;return vr(i).J({range:r,H:!0},(a,u,c)=>{let[d,f,p]=a;d===e&&f===s&&(o=!0),c.done()}).next(()=>o)}function Ei(i){return it(i,"mutations")}function vr(i){return it(i,"documentMutations")}function D0(i){return it(i,"mutationQueues")}var Dr=class i{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new i(0)}static kn(){return new i(-1)}};var yp=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{let n=new Dr(t.highestTargetId);return t.highestTargetId=n.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>W.fromTimestamp(new Me(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,n&&(s.lastRemoteSnapshotVersion=n.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(n=>(n.targetCount+=1,this.$n(t,n),this.Qn(e,n))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>mr(e).delete(t.targetId)).next(()=>this.qn(e)).next(n=>(G(n.targetCount>0),n.targetCount-=1,this.Qn(e,n)))}removeTargets(e,t,n){let s=0,r=[];return mr(e).J((o,a)=>{let u=fa(a);u.sequenceNumber<=t&&n.get(u.targetId)===null&&(s++,r.push(this.removeTargetData(e,u)))}).next(()=>P.waitFor(r)).next(()=>s)}forEachTarget(e,t){return mr(e).J((n,s)=>{let r=fa(s);t(r)})}qn(e){return uI(e).get("targetGlobalKey").next(t=>(G(t!==null),t))}Qn(e,t){return uI(e).put("targetGlobalKey",t)}Kn(e,t){return mr(e).put(C0(this.serializer,t))}$n(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){let n=gs(t),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),r=null;return mr(e).J({range:s,index:"queryTargetsIndex"},(o,a,u)=>{let c=fa(a);qa(t,c.target)&&(r=c,u.done())}).next(()=>r)}addMatchingKeys(e,t,n){let s=[],r=Ti(e);return t.forEach(o=>{let a=St(o.path);s.push(r.put({targetId:n,path:a})),s.push(this.referenceDelegate.addReference(e,n,o))}),P.waitFor(s)}removeMatchingKeys(e,t,n){let s=Ti(e);return P.forEach(t,r=>{let o=St(r.path);return P.waitFor([s.delete([n,o]),this.referenceDelegate.removeReference(e,n,r)])})}removeMatchingKeysForTargetId(e,t){let n=Ti(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(s)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),s=Ti(e),r=ie();return s.J({range:n,H:!0},(o,a,u)=>{let c=En(o[1]),d=new q(c);r=r.add(d)}).next(()=>r)}containsKey(e,t){let n=St(t.path),s=IDBKeyRange.bound([n],[xI(n)],!1,!0),r=0;return Ti(e).J({index:"documentTargetsIndex",H:!0,range:s},([o,a],u,c)=>{o!==0&&(r++,c.done())}).next(()=>r>0)}ot(e,t){return mr(e).get(t).next(n=>n?fa(n):null)}};function mr(i){return it(i,"targets")}function uI(i){return it(i,"targetGlobal")}function Ti(i){return it(i,"targetDocuments")}function cI([i,e],[t,n]){let s=Z(i,t);return s===0?Z(e,n):s}var vp=class{constructor(e){this.Un=e,this.buffer=new Ie(cI),this.Wn=0}Gn(){return++this.Wn}zn(e){let t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{let n=this.buffer.last();cI(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}},wp=class{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){O("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>D(this,null,function*(){this.jn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Fi(t)?O("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield Vi(t)}yield this.Hn(3e5)}))}},Ep=class{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(t===0)return P.resolve(Ft.oe);let n=new vp(t);return this.Jn.forEachTarget(e,s=>n.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>n.zn(s))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(O("LruGarbageCollector","Garbage collection skipped; disabled"),P.resolve(lI)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(O("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),lI):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let n,s,r,o,a,u,c,d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(O("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(n=f,a=Date.now(),this.removeTargets(e,n,t))).next(f=>(r=f,u=Date.now(),this.removeOrphanedDocuments(e,n))).next(f=>(c=Date.now(),pr()<=Gt.DEBUG&&O("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${r} targets in `+(u-a)+`ms
	Removed ${f} documents in `+(c-u)+`ms
Total Duration: ${c-d}ms`),P.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:r,documentsRemoved:f})))}};function RN(i,e){return new Ep(i,e)}var Tp=class{constructor(e,t){this.db=e,this.garbageCollector=RN(this,t)}Yn(e){let t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(n=>t.next(s=>n+s))}er(e){let t=0;return this.Zn(e,n=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(n,s)=>t(s))}addReference(e,t,n){return Wu(e,n)}removeReference(e,t,n){return Wu(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Wu(e,t)}nr(e,t){return function(s,r){let o=!1;return D0(s).Y(a=>x0(s,a,r).next(u=>(u&&(o=!0),P.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],r=0;return this.tr(e,(o,a)=>{if(a<=t){let u=this.nr(e,o).next(c=>{if(!c)return r++,n.getEntry(e,o).next(()=>(n.removeEntry(o,W.min()),Ti(e).delete(function(f){return[0,St(f.path)]}(o))))});s.push(u)}}).next(()=>P.waitFor(s)).next(()=>n.apply(e)).next(()=>r)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Wu(e,t)}tr(e,t){let n=Ti(e),s,r=Ft.oe;return n.J({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:c})=>{o===0?(r!==Ft.oe&&t(new q(En(s)),r),r=c,s=u):r=Ft.oe}).next(()=>{r!==Ft.oe&&t(new q(En(s)),r)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function Wu(i,e){return Ti(i).put(function(n,s){return{targetId:0,path:St(n.path),sequenceNumber:s}}(e,i.currentSequenceNumber))}var Ic=class{constructor(){this.changes=new Rn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Xe.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return n!==void 0?P.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Ip=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return rs(e).put(n)}removeEntry(e,t,n){return rs(e).delete(function(r,o){let a=r.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],_c(o),a[a.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.rr(e,n)))}getEntry(e,t){let n=Xe.newInvalidDocument(t);return rs(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(ca(t))},(s,r)=>{n=this.ir(t,r)}).next(()=>n)}sr(e,t){let n={size:0,document:Xe.newInvalidDocument(t)};return rs(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(ca(t))},(s,r)=>{n={document:this.ir(t,r),size:Ec(r)}}).next(()=>n)}getEntries(e,t){let n=xt();return this._r(e,t,(s,r)=>{let o=this.ir(s,r);n=n.insert(s,o)}).next(()=>n)}ar(e,t){let n=xt(),s=new Ne(q.comparator);return this._r(e,t,(r,o)=>{let a=this.ir(r,o);n=n.insert(r,a),s=s.insert(r,Ec(o))}).next(()=>({documents:n,ur:s}))}_r(e,t,n){if(t.isEmpty())return P.resolve();let s=new Ie(fI);t.forEach(u=>s=s.add(u));let r=IDBKeyRange.bound(ca(s.first()),ca(s.last())),o=s.getIterator(),a=o.getNext();return rs(e).J({index:"documentKeyIndex",range:r},(u,c,d)=>{let f=q.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&fI(a,f)<0;)n(a,null),a=o.getNext();a&&a.isEqual(f)&&(n(a,c),a=o.hasNext()?o.getNext():null),a?d.$(ca(a)):d.done()}).next(()=>{for(;a;)n(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,n,s,r){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),_c(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return rs(e).U(IDBKeyRange.bound(a,u,!0)).next(c=>{r?.incrementDocumentReadCount(c.length);let d=xt();for(let f of c){let p=this.ir(q.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);p.isFoundDocument()&&(za(t,p)||s.has(p.key))&&(d=d.insert(p.key,p))}return d})}getAllFromCollectionGroup(e,t,n,s){let r=xt(),o=dI(t,n),a=dI(t,Ht.max());return rs(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,c,d)=>{let f=this.ir(q.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);r=r.insert(f.key,f),r.size===s&&d.done()}).next(()=>r)}newChangeBuffer(e){return new Sp(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return hI(e).get("remoteDocumentGlobalKey").next(t=>(G(!!t),t))}rr(e,t){return hI(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){let n=bN(this.serializer,t);if(!(n.isNoDocument()&&n.version.isEqual(W.min())))return n}return Xe.newInvalidDocument(e)}};function k0(i){return new Ip(i)}var Sp=class extends Ic{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new Rn(n=>n.toString(),(n,s)=>n.isEqual(s))}applyChanges(e){let t=[],n=0,s=new Ie((r,o)=>Z(r.canonicalString(),o.canonicalString()));return this.changes.forEach((r,o)=>{let a=this.lr.get(r);if(t.push(this.cr.removeEntry(e,r,a.readTime)),o.isValidDocument()){let u=XT(this.cr.serializer,o);s=s.add(r.path.popLast());let c=Ec(u);n+=c-a.size,t.push(this.cr.addEntry(e,r,u))}else if(n-=a.size,this.trackRemovals){let u=XT(this.cr.serializer,o.convertToNoDocument(W.min()));t.push(this.cr.addEntry(e,r,u))}}),s.forEach(r=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,r))}),t.push(this.cr.updateMetadata(e,n)),P.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(n=>(this.lr.set(t,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:n,ur:s})=>(s.forEach((r,o)=>{this.lr.set(r,{size:o,readTime:n.get(r).readTime})}),n))}};function hI(i){return it(i,"remoteDocumentGlobal")}function rs(i){return it(i,"remoteDocumentsV14")}function ca(i){let e=i.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function dI(i,e){let t=e.documentKey.path.toArray();return[i,_c(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function fI(i,e){let t=i.path.toArray(),n=e.path.toArray(),s=0;for(let r=0;r<t.length-2&&r<n.length-2;++r)if(s=Z(t[r],n[r]),s)return s;return s=Z(t.length,n.length),s||(s=Z(t[t.length-2],n[n.length-2]),s||Z(t[t.length-1],n[n.length-1]))}var bp=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Sc=class{constructor(e,t,n,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=s}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(n=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(n!==null&&ga(n.mutation,s,Lt.empty(),Me.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,ie()).next(()=>n))}getLocalViewOfDocuments(e,t,n=ie()){let s=Tn();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,n).next(r=>{let o=da();return r.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let n=Tn();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,ie()))}populateOverlays(e,t,n){let s=[];return n.forEach(r=>{t.has(r)||s.push(r)}),this.documentOverlayCache.getOverlays(e,s).next(r=>{r.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,n,s){let r=xt(),o=pa(),a=function(){return pa()}();return t.forEach((u,c)=>{let d=n.get(c.key);s.has(c.key)&&(d===void 0||d.mutation instanceof an)?r=r.insert(c.key,c):d!==void 0?(o.set(c.key,d.mutation.getFieldMask()),ga(d.mutation,c,d.mutation.getFieldMask(),Me.now())):o.set(c.key,Lt.empty())}),this.recalculateAndSaveOverlays(e,r).next(u=>(u.forEach((c,d)=>o.set(c,d)),t.forEach((c,d)=>{var f;return a.set(c,new bp(d,(f=o.get(c))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){let n=pa(),s=new Ne((o,a)=>o-a),r=ie();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(u=>{let c=t.get(u);if(c===null)return;let d=n.get(u)||Lt.empty();d=a.applyToLocalView(c,d),n.set(u,d);let f=(s.get(a.batchId)||ie()).add(u);s=s.insert(a.batchId,f)})}).next(()=>{let o=[],a=s.getReverseIterator();for(;a.hasNext();){let u=a.getNext(),c=u.key,d=u.value,f=i0();d.forEach(p=>{if(!r.has(p)){let _=c0(t.get(p),n.get(p));_!==null&&f.set(p,_),r=r.add(p)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,f))}return P.waitFor(o)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,s){return function(o){return q.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):xg(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,s):this.getDocumentsMatchingCollectionQuery(e,t,n,s)}getNextDocuments(e,t,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,s).next(r=>{let o=s-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,s-r.size):P.resolve(Tn()),a=-1,u=r;return o.next(c=>P.forEach(c,(d,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),r.get(d)?P.resolve():this.remoteDocumentCache.getEntry(e,d).next(p=>{u=u.insert(d,p)}))).next(()=>this.populateOverlays(e,c,r)).next(()=>this.computeViews(e,u,c,ie())).next(d=>({batchId:a,changes:n0(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new q(t)).next(n=>{let s=da();return n.isFoundDocument()&&(s=s.insert(n.key,n)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,n,s){let r=t.collectionGroup,o=da();return this.indexManager.getCollectionParents(e,r).next(a=>P.forEach(a,u=>{let c=function(f,p){return new on(p,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,u.child(r));return this.getDocumentsMatchingCollectionQuery(e,c,n,s).next(d=>{d.forEach((f,p)=>{o=o.insert(f,p)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,n,s){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(o=>(r=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r,s))).next(o=>{r.forEach((u,c)=>{let d=c.getKey();o.get(d)===null&&(o=o.insert(d,Xe.newInvalidDocument(d)))});let a=da();return o.forEach((u,c)=>{let d=r.get(u);d!==void 0&&ga(d.mutation,c,Lt.empty(),Me.now()),za(t,c)&&(a=a.insert(u,c))}),a})}};var Ap=class{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return P.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:Ge(s.createTime)}}(t)),P.resolve()}getNamedQuery(e,t){return P.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:Mg(s.bundledQuery),readTime:Ge(s.readTime)}}(t)),P.resolve()}};var Cp=class{constructor(){this.overlays=new Ne(q.comparator),this.Ir=new Map}getOverlay(e,t){return P.resolve(this.overlays.get(t))}getOverlays(e,t){let n=Tn();return P.forEach(t,s=>this.getOverlay(e,s).next(r=>{r!==null&&n.set(s,r)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((s,r)=>{this.ht(e,t,r)}),P.resolve()}removeOverlaysForBatchId(e,t,n){let s=this.Ir.get(n);return s!==void 0&&(s.forEach(r=>this.overlays=this.overlays.remove(r)),this.Ir.delete(n)),P.resolve()}getOverlaysForCollection(e,t,n){let s=Tn(),r=t.length+1,o=new q(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let u=a.getNext().value,c=u.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===r&&u.largestBatchId>n&&s.set(u.getKey(),u)}return P.resolve(s)}getOverlaysForCollectionGroup(e,t,n,s){let r=new Ne((c,d)=>c-d),o=this.overlays.getIterator();for(;o.hasNext();){let c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>n){let d=r.get(c.largestBatchId);d===null&&(d=Tn(),r=r.insert(c.largestBatchId,d)),d.set(c.getKey(),c)}}let a=Tn(),u=r.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,d)=>a.set(c,d)),!(a.size()>=s)););return P.resolve(a)}ht(e,t,n){let s=this.overlays.get(n.key);if(s!==null){let o=this.Ir.get(s.largestBatchId).delete(n.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(n.key,new Ca(t,n));let r=this.Ir.get(t);r===void 0&&(r=ie(),this.Ir.set(t,r)),this.Ir.set(t,r.add(n.key))}};var Rp=class{constructor(){this.sessionToken=Ke.EMPTY_BYTE_STRING}getSessionToken(e){return P.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,P.resolve()}};var ka=class{constructor(){this.Tr=new Ie(Ye.Er),this.dr=new Ie(Ye.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){let n=new Ye(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Vr(new Ye(e,t))}mr(e,t){e.forEach(n=>this.removeReference(n,t))}gr(e){let t=new q(new me([])),n=new Ye(t,e),s=new Ye(t,e+1),r=[];return this.dr.forEachInRange([n,s],o=>{this.Vr(o),r.push(o.key)}),r}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){let t=new q(new me([])),n=new Ye(t,e),s=new Ye(t,e+1),r=ie();return this.dr.forEachInRange([n,s],o=>{r=r.add(o.key)}),r}containsKey(e){let t=new Ye(e,0),n=this.Tr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}},Ye=class{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return q.comparator(e.key,t.key)||Z(e.wr,t.wr)}static Ar(e,t){return Z(e.wr,t.wr)||q.comparator(e.key,t.key)}};var Pp=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Ie(Ye.Er)}checkEmpty(e){return P.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,s){let r=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new Aa(r,t,n,s);this.mutationQueue.push(o);for(let a of s)this.br=this.br.add(new Ye(a.key,r)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return P.resolve(o)}lookupMutationBatch(e,t){return P.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){let n=t+1,s=this.vr(n),r=s<0?0:s;return P.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new Ye(t,0),s=new Ye(t,Number.POSITIVE_INFINITY),r=[];return this.br.forEachInRange([n,s],o=>{let a=this.Dr(o.wr);r.push(a)}),P.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Ie(Z);return t.forEach(s=>{let r=new Ye(s,0),o=new Ye(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([r,o],a=>{n=n.add(a.wr)})}),P.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,s=n.length+1,r=n;q.isDocumentKey(r)||(r=r.child(""));let o=new Ye(new q(r),0),a=new Ie(Z);return this.br.forEachWhile(u=>{let c=u.key.path;return!!n.isPrefixOf(c)&&(c.length===s&&(a=a.add(u.wr)),!0)},o),P.resolve(this.Cr(a))}Cr(e){let t=[];return e.forEach(n=>{let s=this.Dr(n);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){G(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let n=this.br;return P.forEach(t.mutations,s=>{let r=new Ye(s.key,t.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){let n=new Ye(t,0),s=this.br.firstAfterOrEqual(n);return P.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,P.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){let t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var Np=class{constructor(e){this.Mr=e,this.docs=function(){return new Ne(q.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,s=this.docs.get(n),r=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-r,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return P.resolve(n?n.document.mutableCopy():Xe.newInvalidDocument(t))}getEntries(e,t){let n=xt();return t.forEach(s=>{let r=this.docs.get(s);n=n.insert(s,r?r.document.mutableCopy():Xe.newInvalidDocument(s))}),P.resolve(n)}getDocumentsMatchingQuery(e,t,n,s){let r=xt(),o=t.path,a=new q(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){let{key:c,value:{document:d}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||Ag(kI(d),n)<=0||(s.has(d.key)||za(t,d))&&(r=r.insert(d.key,d.mutableCopy()))}return P.resolve(r)}getAllFromCollectionGroup(e,t,n,s){j()}Or(e,t){return P.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new xp(this)}getSize(e){return P.resolve(this.size)}},xp=class extends Ic{constructor(e){super(),this.cr=e}applyChanges(e){let t=[];return this.changes.forEach((n,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(n)}),P.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}};var Dp=class{constructor(e){this.persistence=e,this.Nr=new Rn(t=>gs(t),qa),this.lastRemoteSnapshotVersion=W.min(),this.highestTargetId=0,this.Lr=0,this.Br=new ka,this.targetCount=0,this.kr=Dr.Bn()}forEachTarget(e,t){return this.Nr.forEach((n,s)=>t(s)),P.resolve()}getLastRemoteSnapshotVersion(e){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return P.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),P.resolve()}Kn(e){this.Nr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.kr=new Dr(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,P.resolve()}updateTargetData(e,t){return this.Kn(t),P.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,P.resolve()}removeTargets(e,t,n){let s=0,r=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&n.get(a.targetId)===null&&(this.Nr.delete(o),r.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),P.waitFor(r).next(()=>s)}getTargetCount(e){return P.resolve(this.targetCount)}getTargetData(e,t){let n=this.Nr.get(t)||null;return P.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),P.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);let s=this.persistence.referenceDelegate,r=[];return s&&t.forEach(o=>{r.push(s.markPotentiallyOrphaned(e,o))}),P.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),P.resolve()}getMatchingKeysForTargetId(e,t){let n=this.Br.yr(t);return P.resolve(n)}containsKey(e,t){return P.resolve(this.Br.containsKey(t))}};var bc=class{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Ft(0),this.Kr=!1,this.Kr=!0,this.$r=new Rp,this.referenceDelegate=e(this),this.Ur=new Dp(this),this.indexManager=new gp,this.remoteDocumentCache=function(s){return new Np(s)}(n=>this.referenceDelegate.Wr(n)),this.serializer=new gc(t),this.Gr=new Ap(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Cp,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new Pp(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){O("MemoryPersistence","Starting transaction:",e);let s=new kp(this.Qr.next());return this.referenceDelegate.zr(),n(s).next(r=>this.referenceDelegate.jr(s).next(()=>r)).toPromise().then(r=>(s.raiseOnCommittedEvent(),r))}Hr(e,t){return P.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}},kp=class extends sc{constructor(e){super(),this.currentSequenceNumber=e}},Ac=class i{constructor(e){this.persistence=e,this.Jr=new ka,this.Yr=null}static Zr(e){return new i(e)}get Xr(){if(this.Yr)return this.Yr;throw j()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),P.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),P.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),P.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(r=>this.Xr.add(r.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.Xr,n=>{let s=q.fromPath(n);return this.ei(e,s).next(r=>{r||t.removeEntry(s,W.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(n=>{n?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return P.or([()=>P.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}};var Op=class{constructor(e){this.serializer=e}O(e,t,n,s){let r=new rc("createOrUpgrade",t);n<1&&s>=1&&(function(u){u.createObjectStore("owner")}(e),function(u){u.createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",PT,{unique:!0}),u.createObjectStore("documentMutations")}(e),mI(e),function(u){u.createObjectStore("remoteDocuments")}(e));let o=P.resolve();return n<3&&s>=3&&(n!==0&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(e),mI(e)),o=o.next(()=>function(u){let c=u.store("targetGlobal"),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:W.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",d)}(r))),n<4&&s>=4&&(n!==0&&(o=o.next(()=>function(u,c){return c.store("mutations").U().next(d=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",PT,{unique:!0});let f=c.store("mutations"),p=d.map(_=>f.put(_));return P.waitFor(p)})}(e,r))),o=o.next(()=>{(function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),n<5&&s>=5&&(o=o.next(()=>this.ni(r))),n<6&&s>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(e),this.ri(r)))),n<7&&s>=7&&(o=o.next(()=>this.ii(r))),n<8&&s>=8&&(o=o.next(()=>this.si(e,r))),n<9&&s>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(e)})),n<10&&s>=10&&(o=o.next(()=>this.oi(r))),n<11&&s>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&s>=12&&(o=o.next(()=>{(function(u){let c=u.createObjectStore("documentOverlays",{keyPath:KP});c.createIndex("collectionPathOverlayIndex",QP,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",WP,{unique:!1})})(e)})),n<13&&s>=13&&(o=o.next(()=>function(u){let c=u.createObjectStore("remoteDocumentsV14",{keyPath:OP});c.createIndex("documentKeyIndex",MP),c.createIndex("collectionGroupIndex",VP)}(e)).next(()=>this._i(e,r)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&s>=14&&(o=o.next(()=>this.ai(e,r))),n<15&&s>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:qP}).createIndex("sequenceNumberIndex",jP,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:zP}).createIndex("documentKeyIndex",GP,{unique:!1})}(e))),n<16&&s>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),n<17&&s>=17&&(o=o.next(()=>{(function(u){u.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((n,s)=>{t+=Ec(s)}).next(()=>{let n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}ni(e){let t=e.store("mutationQueues"),n=e.store("mutations");return t.U().next(s=>P.forEach(s,r=>{let o=IDBKeyRange.bound([r.userId,-1],[r.userId,r.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",o).next(a=>P.forEach(a,u=>{G(u.userId===r.userId);let c=ls(this.serializer,u);return N0(e,r.userId,c).next(()=>{})}))}))}ii(e){let t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{let r=[];return n.J((o,a)=>{let u=new me(o),c=function(f){return[0,St(f)]}(u);r.push(t.get(c).next(d=>d?P.resolve():(f=>t.put({targetId:0,path:St(f),sequenceNumber:s.highestListenSequenceNumber}))(u)))}).next(()=>P.waitFor(r))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:UP});let n=t.store("collectionParents"),s=new Da,r=o=>{if(s.add(o)){let a=o.lastSegment(),u=o.popLast();return n.put({collectionId:a,parent:St(u)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{let u=new me(o);return r(u.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,u],c)=>{let d=En(a);return r(d.popLast())}))}oi(e){let t=e.store("targets");return t.J((n,s)=>{let r=fa(s),o=C0(this.serializer,r);return t.put(o)})}_i(e,t){let n=t.store("remoteDocuments"),s=[];return n.J((r,o)=>{let a=t.store("remoteDocumentsV14"),u=function(f){return f.document?new q(me.fromString(f.document.name).popFirst(5)):f.noDocument?q.fromSegments(f.noDocument.path):f.unknownDocument?q.fromSegments(f.unknownDocument.path):j()}(o).path.toArray(),c={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(c))}).next(()=>P.waitFor(s))}ai(e,t){let n=t.store("mutations"),s=k0(this.serializer),r=new bc(Ac.Zr,this.serializer.ct);return n.U().next(o=>{let a=new Map;return o.forEach(u=>{var c;let d=(c=a.get(u.userId))!==null&&c!==void 0?c:ie();ls(this.serializer,u).keys().forEach(f=>d=d.add(f)),a.set(u.userId,d)}),P.forEach(a,(u,c)=>{let d=new Je(c),f=yc.lt(this.serializer,d),p=r.getIndexManager(d),_=Tc.lt(d,this.serializer,p,r.referenceDelegate);return new Sc(s,_,f,p).recalculateAndSaveOverlaysForDocumentKeys(new Ea(t,Ft.oe),u).next()})})}};function mI(i){i.createObjectStore("targetDocuments",{keyPath:LP}).createIndex("documentTargetsIndex",BP,{unique:!0}),i.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",FP,{unique:!0}),i.createObjectStore("targetGlobal")}var Tm="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Mp=class i{constructor(e,t,n,s,r,o,a,u,c,d,f=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.ui=r,this.window=o,this.document=a,this.ci=c,this.li=d,this.hi=f,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=p=>Promise.resolve(),!i.D())throw new k(x.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Tp(this,s),this.Ai=t+"main",this.serializer=new gc(u),this.Ri=new Ci(this.Ai,this.hi,new Op(this.serializer)),this.$r=new up,this.Ur=new yp(this.referenceDelegate,this.serializer),this.remoteDocumentCache=k0(this.serializer),this.Gr=new lp,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,d===!1&&je("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new k(x.FAILED_PRECONDITION,Tm);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new Ft(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=t=>D(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(t=>D(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(()=>D(this,null,function*(){this.started&&(yield this.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>$u(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(Fi(e))return O("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return O("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return ha(e).get("owner").next(t=>P.resolve(this.vi(t)))}Ci(e){return $u(e).delete(this.clientId)}Fi(){return D(this,null,function*(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let n=it(t,"clientMetadata");return n.U().next(s=>{let r=this.xi(s,18e5),o=s.filter(a=>r.indexOf(a)===-1);return P.forEach(o,a=>n.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(let t of e)this.Vi.removeItem(this.Oi(t.clientId))}})}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?P.resolve(!0):ha(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new k(x.FAILED_PRECONDITION,Tm);return!1}}return!(!this.networkEnabled||!this.inForeground)||$u(e).U().next(n=>this.xi(n,5e3).find(s=>{if(this.clientId!==s.clientId){let r=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(r||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&O("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return D(this,null,function*(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),yield this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new Ea(e,Ft.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()})}xi(e,t){return e.filter(n=>this.Mi(n.updateTimeMs,t)&&!this.Ni(n.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>$u(e).U().next(t=>this.xi(t,18e5).map(n=>n.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return Tc.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new _p(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return yc.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,n){O("IndexedDbPersistence","Starting transaction:",e);let s=t==="readonly"?"readonly":"readwrite",r=function(u){return u===17?YP:u===16?HP:u===15?Rg:u===14?UI:u===13?BI:u===12?$P:u===11?LI:void j()}(this.hi),o;return this.Ri.runTransaction(e,s,r,a=>(o=new Ea(a,this.Qr?this.Qr.next():Ft.oe),t==="readwrite-primary"?this.wi(o).next(u=>!!u||this.Si(o)).next(u=>{if(!u)throw je(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new k(x.FAILED_PRECONDITION,OI);return n(o)}).next(u=>this.Di(o).next(()=>u)):this.Ki(o).next(()=>n(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return ha(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new k(x.FAILED_PRECONDITION,Tm)})}Di(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return ha(e).put("owner",t)}static D(){return Ci.D()}bi(e){let t=ha(e);return t.get("owner").next(n=>this.vi(n)?(O("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):P.resolve())}Mi(e,t){let n=Date.now();return!(e<n-t)&&(!(e>n)||(je(`Detected an update time that is in the future: ${e} > ${n}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();let t=/(?:Version|Mobile)\/1[456]/;pd()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{let n=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return O("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return je("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){je("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function ha(i){return it(i,"owner")}function $u(i){return it(i,"clientMetadata")}function Fg(i,e){let t=i.projectId;return i.isDefaultDatabase||(t+="."+i.database),"firestore/"+e+"/"+t+"/"}var Vp=class i{constructor(e,t,n,s){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=s}static Wi(e,t){let n=ie(),s=ie();for(let r of t.docChanges)switch(r.type){case 0:n=n.add(r.doc.key);break;case 1:s=s.add(r.doc.key)}return new i(e,t.fromCache,n,s)}};var Fp=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Cc=class{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return pd()?8:MI(bo())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,s){let r={result:null};return this.Yi(e,t).next(o=>{r.result=o}).next(()=>{if(!r.result)return this.Zi(e,t,s,n).next(o=>{r.result=o})}).next(()=>{if(r.result)return;let o=new Fp;return this.Xi(e,t,o).next(a=>{if(r.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>r.result)}es(e,t,n,s){return n.documentReadCount<this.ji?(pr()<=Gt.DEBUG&&O("QueryEngine","SDK will not create cache indexes for query:",gr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),P.resolve()):(pr()<=Gt.DEBUG&&O("QueryEngine","Query:",gr(t),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.Hi*s?(pr()<=Gt.DEBUG&&O("QueryEngine","The SDK decides to create cache indexes for query:",gr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,bt(t))):P.resolve())}Yi(e,t){if(qT(t))return P.resolve(null);let n=bt(t);return this.indexManager.getIndexType(e,n).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=dc(t,null,"F"),n=bt(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{let o=ie(...r);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,n).next(u=>{let c=this.ts(t,a);return this.ns(t,c,o,u.readTime)?this.Yi(e,dc(t,null,"F")):this.rs(e,c,t,u)}))})))}Zi(e,t,n,s){return qT(t)||s.isEqual(W.min())?P.resolve(null):this.Ji.getDocuments(e,n).next(r=>{let o=this.ts(t,r);return this.ns(t,o,n,s)?P.resolve(null):(pr()<=Gt.DEBUG&&O("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),gr(t)),this.rs(e,o,t,DI(s,-1)).next(a=>a))})}ts(e,t){let n=new Ie(e0(e));return t.forEach((s,r)=>{za(e,r)&&(n=n.add(r))}),n}ns(e,t,n,s){if(e.limit===null)return!1;if(n.size!==t.size)return!0;let r=e.limitType==="F"?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(s)>0)}Xi(e,t,n){return pr()<=Gt.DEBUG&&O("QueryEngine","Using full collection scan to execute query:",gr(t)),this.Ji.getDocumentsMatchingQuery(e,t,Ht.min(),n)}rs(e,t,n,s){return this.Ji.getDocumentsMatchingQuery(e,n,s).next(r=>(t.forEach(o=>{r=r.insert(o.key,o)}),r))}};var Lp=class{constructor(e,t,n,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new Ne(Z),this._s=new Rn(r=>gs(r),qa),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Sc(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}};function O0(i,e,t,n){return new Lp(i,e,t,n)}function M0(i,e){return D(this,null,function*(){let t=U(i);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let s;return t.mutationQueue.getAllMutationBatches(n).next(r=>(s=r,t.ls(e),t.mutationQueue.getAllMutationBatches(n))).next(r=>{let o=[],a=[],u=ie();for(let c of s){o.push(c.batchId);for(let d of c.mutations)u=u.add(d.key)}for(let c of r){a.push(c.batchId);for(let d of c.mutations)u=u.add(d.key)}return t.localDocuments.getDocuments(n,u).next(c=>({hs:c,removedBatchIds:o,addedBatchIds:a}))})})})}function PN(i,e){let t=U(i);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let s=e.batch.keys(),r=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,u,c,d){let f=c.batch,p=f.keys(),_=P.resolve();return p.forEach(E=>{_=_.next(()=>d.getEntry(u,E)).next(S=>{let R=c.docVersions.get(E);G(R!==null),S.version.compareTo(R)<0&&(f.applyToRemoteDocument(S,c),S.isValidDocument()&&(S.setReadTime(c.commitVersion),d.addEntry(S)))})}),_.next(()=>a.mutationQueue.removeMutationBatch(u,f))}(t,n,e,r).next(()=>r.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(a){let u=ie();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(u=u.add(a.batch.mutations[c].key));return u}(e))).next(()=>t.localDocuments.getDocuments(n,s))})}function V0(i){let e=U(i);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function NN(i,e){let t=U(i),n=e.snapshotVersion,s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",r=>{let o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;let a=[];e.targetChanges.forEach((d,f)=>{let p=s.get(f);if(!p)return;a.push(t.Ur.removeMatchingKeys(r,d.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(r,d.addedDocuments,f)));let _=p.withSequenceNumber(r.currentSequenceNumber);e.targetMismatches.get(f)!==null?_=_.withResumeToken(Ke.EMPTY_BYTE_STRING,W.min()).withLastLimboFreeSnapshotVersion(W.min()):d.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(d.resumeToken,n)),s=s.insert(f,_),function(S,R,V){return S.resumeToken.approximateByteSize()===0||R.snapshotVersion.toMicroseconds()-S.snapshotVersion.toMicroseconds()>=3e8?!0:V.addedDocuments.size+V.modifiedDocuments.size+V.removedDocuments.size>0}(p,_,d)&&a.push(t.Ur.updateTargetData(r,_))});let u=xt(),c=ie();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(r,d))}),a.push(F0(r,o,e.documentUpdates).next(d=>{u=d.Ps,c=d.Is})),!n.isEqual(W.min())){let d=t.Ur.getLastRemoteSnapshotVersion(r).next(f=>t.Ur.setTargetsMetadata(r,r.currentSequenceNumber,n));a.push(d)}return P.waitFor(a).next(()=>o.apply(r)).next(()=>t.localDocuments.getLocalViewOfDocuments(r,u,c)).next(()=>u)}).then(r=>(t.os=s,r))}function F0(i,e,t){let n=ie(),s=ie();return t.forEach(r=>n=n.add(r)),e.getEntries(i,n).next(r=>{let o=xt();return t.forEach((a,u)=>{let c=r.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),u.isNoDocument()&&u.version.isEqual(W.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||u.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):O("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{Ps:o,Is:s}})}function xN(i,e){let t=U(i);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function kr(i,e){let t=U(i);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let s;return t.Ur.getTargetData(n,e).next(r=>r?(s=r,P.resolve(s)):t.Ur.allocateTargetId(n).next(o=>(s=new xr(e,o,"TargetPurposeListen",n.currentSequenceNumber),t.Ur.addTargetData(n,s).next(()=>s))))}).then(n=>{let s=t.os.get(n.targetId);return(s===null||n.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(n.targetId,n),t._s.set(e,n.targetId)),n})}function Or(i,e,t){return D(this,null,function*(){let n=U(i),s=n.os.get(e),r=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",r,o=>n.persistence.referenceDelegate.removeTarget(o,s)))}catch(o){if(!Fi(o))throw o;O("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}n.os=n.os.remove(e),n._s.delete(s.target)})}function Rc(i,e,t){let n=U(i),s=W.min(),r=ie();return n.persistence.runTransaction("Execute query","readwrite",o=>function(u,c,d){let f=U(u),p=f._s.get(d);return p!==void 0?P.resolve(f.os.get(p)):f.Ur.getTargetData(c,d)}(n,o,bt(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(o,a.targetId).next(u=>{r=u})}).next(()=>n.ss.getDocumentsMatchingQuery(o,e,t?s:W.min(),t?r:ie())).next(a=>(U0(n,ZI(e),a),{documents:a,Ts:r})))}function L0(i,e){let t=U(i),n=U(t.Ur),s=t.os.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",r=>n.ot(r,e).next(o=>o?o.target:null))}function B0(i,e){let t=U(i),n=t.us.get(e)||W.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.cs.getAllFromCollectionGroup(s,e,DI(n,-1),Number.MAX_SAFE_INTEGER)).then(s=>(U0(t,e,s),s))}function U0(i,e,t){let n=i.us.get(e)||W.min();t.forEach((s,r)=>{r.readTime.compareTo(n)>0&&(n=r.readTime)}),i.us.set(e,n)}function DN(i,e,t,n){return D(this,null,function*(){let s=U(i),r=ie(),o=xt();for(let c of t){let d=e.Es(c.metadata.name);c.document&&(r=r.add(d));let f=e.ds(c);f.setReadTime(e.As(c.metadata.readTime)),o=o.insert(d,f)}let a=s.cs.newChangeBuffer({trackRemovals:!0}),u=yield kr(s,function(d){return bt(jr(me.fromString(`__bundle__/docs/${d}`)))}(n));return s.persistence.runTransaction("Apply bundle documents","readwrite",c=>F0(c,a,o).next(d=>(a.apply(c),d)).next(d=>s.Ur.removeMatchingKeysForTargetId(c,u.targetId).next(()=>s.Ur.addMatchingKeys(c,r,u.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(c,d.Ps,d.Is)).next(()=>d.Ps)))})}function kN(n,s){return D(this,arguments,function*(i,e,t=ie()){let r=yield kr(i,bt(Mg(e.bundledQuery))),o=U(i);return o.persistence.runTransaction("Save named query","readwrite",a=>{let u=Ge(e.readTime);if(r.snapshotVersion.compareTo(u)>=0)return o.Gr.saveNamedQuery(a,e);let c=r.withResumeToken(Ke.EMPTY_BYTE_STRING,u);return o.os=o.os.insert(c.targetId,c),o.Ur.updateTargetData(a,c).next(()=>o.Ur.removeMatchingKeysForTargetId(a,r.targetId)).next(()=>o.Ur.addMatchingKeys(a,t,r.targetId)).next(()=>o.Gr.saveNamedQuery(a,e))})})}function pI(i,e){return`firestore_clients_${i}_${e}`}function gI(i,e,t){let n=`firestore_mutations_${i}_${t}`;return e.isAuthenticated()&&(n+=`_${e.uid}`),n}function Im(i,e){return`firestore_targets_${i}_${e}`}var Pc=class i{constructor(e,t,n,s){this.user=e,this.batchId=t,this.state=n,this.error=s}static Rs(e,t,n){let s=JSON.parse(n),r,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(r=new k(s.error.code,s.error.message))),o?new i(e,t,s.state,r):(je("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},_a=class i{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Rs(e,t){let n=JSON.parse(t),s,r=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return r&&n.error&&(r=typeof n.error.message=="string"&&typeof n.error.code=="string",r&&(s=new k(n.error.code,n.error.message))),r?new i(e,n.state,s):(je("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Nc=class i{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){let n=JSON.parse(t),s=typeof n=="object"&&n.activeTargetIds instanceof Array,r=Dg();for(let o=0;s&&o<n.activeTargetIds.length;++o)s=VI(n.activeTargetIds[o]),r=r.add(n.activeTargetIds[o]);return s?new i(e,r):(je("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},Bp=class i{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new i(t.clientId,t.onlineState):(je("SharedClientState",`Failed to parse online state: ${e}`),null)}},Oa=class{constructor(){this.activeTargetIds=Dg()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},ya=class{constructor(e,t,n,s,r){this.window=e,this.ui=t,this.persistenceKey=n,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Ne(Z),this.started=!1,this.bs=[];let o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=r,this.Ds=pI(this.persistenceKey,this.ps),this.vs=function(u){return`firestore_sequence_number_${u}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new Oa),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(u){return`firestore_online_state_${u}`}(this.persistenceKey),this.Os=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}start(){return D(this,null,function*(){let e=yield this.syncEngine.Qi();for(let n of e){if(n===this.ps)continue;let s=this.getItem(pI(this.persistenceKey,n));if(s){let r=Nc.Rs(n,s);r&&(this.Ss=this.Ss.insert(r.clientId,r))}}this.Ns();let t=this.storage.getItem(this.xs);if(t){let n=this.Ls(t);n&&this.Bs(n)}for(let n of this.bs)this.ws(n);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((n,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,n){this.qs(e,t,n),this.Qs(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){let s=this.storage.getItem(Im(this.persistenceKey,e));if(s){let r=_a.Rs(e,s);r&&(n=r.state)}}return t&&this.Ks.fs(e),this.Ns(),n}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Im(this.persistenceKey,e))}updateQueryState(e,t,n){this.$s(e,t,n)}handleUserChange(e,t,n){t.forEach(s=>{this.Qs(s)}),this.currentUser=e,n.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return O("SharedClientState","READ",e,t),t}setItem(e,t){O("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){O("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){let t=e;if(t.storageArea===this.storage){if(O("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void je("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(()=>D(this,null,function*(){if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){let n=this.Gs(t.key);return this.zs(n,null)}{let n=this.js(t.key,t.newValue);if(n)return this.zs(n.clientId,n)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){let n=this.Hs(t.key,t.newValue);if(n)return this.Js(n)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){let n=this.Ys(t.key,t.newValue);if(n)return this.Zs(n)}}else if(t.key===this.xs){if(t.newValue!==null){let n=this.Ls(t.newValue);if(n)return this.Bs(n)}}else if(t.key===this.vs){let n=function(r){let o=Ft.oe;if(r!=null)try{let a=JSON.parse(r);G(typeof a=="number"),o=a}catch(a){je("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);n!==Ft.oe&&this.sequenceNumberHandler(n)}else if(t.key===this.Os){let n=this.Xs(t.newValue);yield Promise.all(n.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(t)}))}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,n){let s=new Pc(this.currentUser,e,t,n),r=gI(this.persistenceKey,this.currentUser,e);this.setItem(r,s.Vs())}Qs(e){let t=gI(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){let t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,n){let s=Im(this.persistenceKey,e),r=new _a(e,t,n);this.setItem(s,r.Vs())}Ws(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){let t=this.Cs.exec(e);return t?t[1]:null}js(e,t){let n=this.Gs(e);return Nc.Rs(n,t)}Hs(e,t){let n=this.Fs.exec(e),s=Number(n[1]),r=n[2]!==void 0?n[2]:null;return Pc.Rs(new Je(r),s,t)}Ys(e,t){let n=this.Ms.exec(e),s=Number(n[1]);return _a.Rs(s,t)}Ls(e){return Bp.Rs(e)}Xs(e){return JSON.parse(e)}Js(e){return D(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);O("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){let n=t?this.Ss.insert(e,t):this.Ss.remove(e),s=this.ks(this.Ss),r=this.ks(n),o=[],a=[];return r.forEach(u=>{s.has(u)||o.push(u)}),s.forEach(u=>{r.has(u)||a.push(u)}),this.syncEngine.io(o,a).then(()=>{this.Ss=n})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Dg();return e.forEach((n,s)=>{t=t.unionWith(s.activeTargetIds)}),t}},xc=class{constructor(){this.so=new Oa,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Oa,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Up=class{_o(e){}shutdown(){}};var Dc=class{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){O("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.ho)e(0)}lo(){O("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Hu=null;function Sm(){return Hu===null?Hu=function(){return 268435456+Math.round(2147483648*Math.random())}():Hu++,"0x"+Hu.toString(16)}var ON={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var qp=class{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}};var pt="WebChannelConnection",jp=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let n=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+t.host,this.vo=`projects/${s}/databases/${r}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${r}`}get Fo(){return!1}Mo(t,n,s,r,o){let a=Sm(),u=this.xo(t,n.toUriEncodedString());O("RestConnection",`Sending RPC '${t}' ${a}:`,u,s);let c={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(c,r,o),this.No(t,u,c,s).then(d=>(O("RestConnection",`Received RPC '${t}' ${a}: `,d),d),d=>{throw rn("RestConnection",`RPC '${t}' ${a} failed with error: `,d,"url: ",u,"request:",s),d})}Lo(t,n,s,r,o,a){return this.Mo(t,n,s,r,o)}Oo(t,n,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+qr}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((r,o)=>t[o]=r),s&&s.headers.forEach((r,o)=>t[o]=r)}xo(t,n){let s=ON[t];return`${this.Do}/v1/${n}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,s){let r=Sm();return new Promise((o,a)=>{let u=new gm;u.setWithCredentials(!0),u.listenOnce(_m.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case aa.NO_ERROR:let d=u.getResponseJson();O(pt,`XHR for RPC '${e}' ${r} received:`,JSON.stringify(d)),o(d);break;case aa.TIMEOUT:O(pt,`RPC '${e}' ${r} timed out`),a(new k(x.DEADLINE_EXCEEDED,"Request time out"));break;case aa.HTTP_ERROR:let f=u.getStatus();if(O(pt,`RPC '${e}' ${r} failed with status:`,f,"response text:",u.getResponseText()),f>0){let p=u.getResponseJson();Array.isArray(p)&&(p=p[0]);let _=p?.error;if(_&&_.status&&_.message){let E=function(R){let V=R.toLowerCase().replace(/_/g,"-");return Object.values(x).indexOf(V)>=0?V:x.UNKNOWN}(_.status);a(new k(E,_.message))}else a(new k(x.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new k(x.UNAVAILABLE,"Connection failed."));break;default:j()}}finally{O(pt,`RPC '${e}' ${r} completed.`)}});let c=JSON.stringify(s);O(pt,`RPC '${e}' ${r} sending request:`,s),u.send(t,"POST",c,n,15)})}Bo(e,t,n){let s=Sm(),r=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=wm(),a=vm(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Oo(u.initMessageHeaders,t,n),u.encodeInitMessageHeaders=!0;let d=r.join("");O(pt,`Creating RPC '${e}' stream ${s}: ${d}`,u);let f=o.createWebChannel(d,u),p=!1,_=!1,E=new qp({Io:R=>{_?O(pt,`Not sending because RPC '${e}' stream ${s} is closed:`,R):(p||(O(pt,`Opening RPC '${e}' stream ${s} transport.`),f.open(),p=!0),O(pt,`RPC '${e}' stream ${s} sending:`,R),f.send(R))},To:()=>f.close()}),S=(R,V,B)=>{R.listen(V,F=>{try{B(F)}catch(K){setTimeout(()=>{throw K},0)}})};return S(f,cr.EventType.OPEN,()=>{_||(O(pt,`RPC '${e}' stream ${s} transport opened.`),E.yo())}),S(f,cr.EventType.CLOSE,()=>{_||(_=!0,O(pt,`RPC '${e}' stream ${s} transport closed`),E.So())}),S(f,cr.EventType.ERROR,R=>{_||(_=!0,rn(pt,`RPC '${e}' stream ${s} transport errored:`,R),E.So(new k(x.UNAVAILABLE,"The operation could not be completed")))}),S(f,cr.EventType.MESSAGE,R=>{var V;if(!_){let B=R.data[0];G(!!B);let F=B,K=F.error||((V=F[0])===null||V===void 0?void 0:V.error);if(K){O(pt,`RPC '${e}' stream ${s} received error:`,K);let ne=K.status,H=function(w){let I=He[w];if(I!==void 0)return f0(I)}(ne),T=K.message;H===void 0&&(H=x.INTERNAL,T="Unknown error status: "+ne+" with message "+K.message),_=!0,E.So(new k(H,T)),f.close()}else O(pt,`RPC '${e}' stream ${s} received:`,B),E.bo(B)}}),S(a,ym.STAT_EVENT,R=>{R.stat===Ku.PROXY?O(pt,`RPC '${e}' stream ${s} detected buffering proxy`):R.stat===Ku.NOPROXY&&O(pt,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{E.wo()},0),E}};function q0(){return typeof window<"u"?window:null}function ec(){return typeof document<"u"?document:null}function Ga(i){return new ip(i,!0)}var Ma=class{constructor(e,t,n=1e3,s=1.5,r=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=s,this.Qo=r,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();let t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-n);s>0&&O("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}};var kc=class{constructor(e,t,n,s,r,o,a,u){this.ui=e,this.Ho=n,this.Jo=s,this.connection=r,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Ma(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}stop(){return D(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){return D(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){return D(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===x.RESOURCE_EXHAUSTED?(je(t.toString()),je("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===x.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.mo(t)})}l_(){}auth(){this.state=1;let e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,s])=>{this.Yo===t&&this.P_(n,s)},n=>{e(()=>{let s=new k(x.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(s)})})}P_(e,t){let n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{n(()=>this.I_(s))}),this.stream.onMessage(s=>{n(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(()=>D(this,null,function*(){this.state=0,this.start()}))}I_(e){return O("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(O("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},zp=class extends kc{constructor(e,t,n,s,r,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,s,o),this.serializer=r}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();let t=yN(this.serializer,e),n=function(r){if(!("targetChange"in r))return W.min();let o=r.targetChange;return o.targetIds&&o.targetIds.length?W.min():o.readTime?Ge(o.readTime):W.min()}(e);return this.listener.d_(t,n)}A_(e){let t={};t.database=op(this.serializer),t.addTarget=function(r,o){let a,u=o.target;if(a=cc(u)?{documents:E0(r,u)}:{query:T0(r,u)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=p0(r,o.resumeToken);let c=sp(r,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(W.min())>0){a.readTime=Nr(r,o.snapshotVersion.toTimestamp());let c=sp(r,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);let n=wN(this.serializer,e);n&&(t.labels=n),this.a_(t)}R_(e){let t={};t.database=op(this.serializer),t.removeTarget=e,this.a_(t)}},Gp=class extends kc{constructor(e,t,n,s,r,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,s,o),this.serializer=r}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return G(!!e.streamToken),this.lastStreamToken=e.streamToken,G(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){G(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();let t=vN(e.writeResults,e.commitTime),n=Ge(e.commitTime);return this.listener.g_(n,t)}p_(){let e={};e.database=op(this.serializer),this.a_(e)}m_(e){let t={streamToken:this.lastStreamToken,writes:e.map(n=>xa(this.serializer,n))};this.a_(t)}};var Kp=class extends class{}{constructor(e,t,n,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new k(x.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,o])=>this.connection.Mo(e,rp(t,n),s,r,o)).catch(r=>{throw r.name==="FirebaseError"?(r.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new k(x.UNKNOWN,r.toString())})}Lo(e,t,n,s,r){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,rp(t,n),s,o,a,r)).catch(o=>{throw o.name==="FirebaseError"?(o.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new k(x.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}},Qp=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(je(t),this.D_=!1):O("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}};var Wp=class{constructor(e,t,n,s,r){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=r,this.k_._o(o=>{n.enqueueAndForget(()=>D(this,null,function*(){Li(this)&&(O("RemoteStore","Restarting streams for network reachability change."),yield function(u){return D(this,null,function*(){let c=U(u);c.L_.add(4),yield zr(c),c.q_.set("Unknown"),c.L_.delete(4),yield Ka(c)})}(this))}))}),this.q_=new Qp(n,s)}};function Ka(i){return D(this,null,function*(){if(Li(i))for(let e of i.B_)yield e(!0)})}function zr(i){return D(this,null,function*(){for(let e of i.B_)yield e(!1)})}function eh(i,e){let t=U(i);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Ug(t)?Bg(t):Kr(t).r_()&&Lg(t,e))}function Mr(i,e){let t=U(i),n=Kr(t);t.N_.delete(e),n.r_()&&j0(t,e),t.N_.size===0&&(n.r_()?n.o_():Li(t)&&t.q_.set("Unknown"))}function Lg(i,e){if(i.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(W.min())>0){let t=i.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Kr(i).A_(e)}function j0(i,e){i.Q_.xe(e),Kr(i).R_(e)}function Bg(i){i.Q_=new np({getRemoteKeysForTarget:e=>i.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>i.N_.get(e)||null,tt:()=>i.datastore.serializer.databaseId}),Kr(i).start(),i.q_.v_()}function Ug(i){return Li(i)&&!Kr(i).n_()&&i.N_.size>0}function Li(i){return U(i).L_.size===0}function z0(i){i.Q_=void 0}function MN(i){return D(this,null,function*(){i.q_.set("Online")})}function VN(i){return D(this,null,function*(){i.N_.forEach((e,t)=>{Lg(i,e)})})}function FN(i,e){return D(this,null,function*(){z0(i),Ug(i)?(i.q_.M_(e),Bg(i)):i.q_.set("Unknown")})}function LN(i,e,t){return D(this,null,function*(){if(i.q_.set("Online"),e instanceof mc&&e.state===2&&e.cause)try{yield function(s,r){return D(this,null,function*(){let o=r.cause;for(let a of r.targetIds)s.N_.has(a)&&(yield s.remoteSyncer.rejectListen(a,o),s.N_.delete(a),s.Q_.removeTarget(a))})}(i,e)}catch(n){O("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield Oc(i,n)}else if(e instanceof Ir?i.Q_.Ke(e):e instanceof fc?i.Q_.He(e):i.Q_.We(e),!t.isEqual(W.min()))try{let n=yield V0(i.localStore);t.compareTo(n)>=0&&(yield function(r,o){let a=r.Q_.rt(o);return a.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){let d=r.N_.get(c);d&&r.N_.set(c,d.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,c)=>{let d=r.N_.get(u);if(!d)return;r.N_.set(u,d.withResumeToken(Ke.EMPTY_BYTE_STRING,d.snapshotVersion)),j0(r,u);let f=new xr(d.target,u,c,d.sequenceNumber);Lg(r,f)}),r.remoteSyncer.applyRemoteEvent(a)}(i,t))}catch(n){O("RemoteStore","Failed to raise snapshot:",n),yield Oc(i,n)}})}function Oc(i,e,t){return D(this,null,function*(){if(!Fi(e))throw e;i.L_.add(1),yield zr(i),i.q_.set("Offline"),t||(t=()=>V0(i.localStore)),i.asyncQueue.enqueueRetryable(()=>D(this,null,function*(){O("RemoteStore","Retrying IndexedDB access"),yield t(),i.L_.delete(1),yield Ka(i)}))})}function G0(i,e){return e().catch(t=>Oc(i,t,e))}function Gr(i){return D(this,null,function*(){let e=U(i),t=Mi(e),n=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;BN(e);)try{let s=yield xN(e.localStore,n);if(s===null){e.O_.length===0&&t.o_();break}n=s.batchId,UN(e,s)}catch(s){yield Oc(e,s)}K0(e)&&Q0(e)})}function BN(i){return Li(i)&&i.O_.length<10}function UN(i,e){i.O_.push(e);let t=Mi(i);t.r_()&&t.V_&&t.m_(e.mutations)}function K0(i){return Li(i)&&!Mi(i).n_()&&i.O_.length>0}function Q0(i){Mi(i).start()}function qN(i){return D(this,null,function*(){Mi(i).p_()})}function jN(i){return D(this,null,function*(){let e=Mi(i);for(let t of i.O_)e.m_(t.mutations)})}function zN(i,e,t){return D(this,null,function*(){let n=i.O_.shift(),s=Zm.from(n,e,t);yield G0(i,()=>i.remoteSyncer.applySuccessfulWrite(s)),yield Gr(i)})}function GN(i,e){return D(this,null,function*(){e&&Mi(i).V_&&(yield function(n,s){return D(this,null,function*(){if(function(o){return d0(o)&&o!==x.ABORTED}(s.code)){let r=n.O_.shift();Mi(n).s_(),yield G0(n,()=>n.remoteSyncer.rejectFailedWrite(r.batchId,s)),yield Gr(n)}})}(i,e)),K0(i)&&Q0(i)})}function _I(i,e){return D(this,null,function*(){let t=U(i);t.asyncQueue.verifyOperationInProgress(),O("RemoteStore","RemoteStore received new credentials");let n=Li(t);t.L_.add(3),yield zr(t),n&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield Ka(t)})}function $p(i,e){return D(this,null,function*(){let t=U(i);e?(t.L_.delete(2),yield Ka(t)):e||(t.L_.add(2),yield zr(t),t.q_.set("Unknown"))})}function Kr(i){return i.K_||(i.K_=function(t,n,s){let r=U(t);return r.w_(),new zp(n,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,s)}(i.datastore,i.asyncQueue,{Eo:MN.bind(null,i),Ro:VN.bind(null,i),mo:FN.bind(null,i),d_:LN.bind(null,i)}),i.B_.push(e=>D(this,null,function*(){e?(i.K_.s_(),Ug(i)?Bg(i):i.q_.set("Unknown")):(yield i.K_.stop(),z0(i))}))),i.K_}function Mi(i){return i.U_||(i.U_=function(t,n,s){let r=U(t);return r.w_(),new Gp(n,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,s)}(i.datastore,i.asyncQueue,{Eo:()=>Promise.resolve(),Ro:qN.bind(null,i),mo:GN.bind(null,i),f_:jN.bind(null,i),g_:zN.bind(null,i)}),i.B_.push(e=>D(this,null,function*(){e?(i.U_.s_(),yield Gr(i)):(yield i.U_.stop(),i.O_.length>0&&(O("RemoteStore",`Stopping write stream with ${i.O_.length} pending writes`),i.O_=[]))}))),i.U_}var Hp=class i{constructor(e,t,n,s,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=s,this.removalCallback=r,this.deferred=new nt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,s,r){let o=Date.now()+n,a=new i(e,t,o,s,r);return a.start(n),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new k(x.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Qr(i,e){if(je("AsyncQueue",`${e}: ${i}`),Fi(i))return new k(x.UNAVAILABLE,`${e}: ${i}`);throw i}var Mc=class i{constructor(e){this.comparator=e?(t,n)=>e(t,n)||q.comparator(t.key,n.key):(t,n)=>q.comparator(t.key,n.key),this.keyedMap=da(),this.sortedSet=new Ne(this.comparator)}static emptySet(e){return new i(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof i)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let s=t.getNext().key,r=n.getNext().key;if(!s.isEqual(r))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let n=new i;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}};var Vc=class{constructor(){this.W_=new Ne(q.comparator)}track(e){let t=e.doc.key,n=this.W_.get(t);n?e.type!==0&&n.type===3?this.W_=this.W_.insert(t,e):e.type===3&&n.type!==1?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.W_=this.W_.remove(t):e.type===1&&n.type===2?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):j():this.W_=this.W_.insert(t,e)}G_(){let e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}},Vr=class i{constructor(e,t,n,s,r,o,a,u,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=r,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,s,r){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new i(e,t,Mc.emptySet(t),o,n,s,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ja(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==n[s].type||!t[s].doc.isEqual(n[s].doc))return!1;return!0}};var Yp=class{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}},Jp=class{constructor(){this.queries=yI(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,n){let s=U(t),r=s.queries;s.queries=yI(),r.forEach((o,a)=>{for(let u of a.j_)u.onError(n)})})(this,new k(x.ABORTED,"Firestore shutting down"))}};function yI(){return new Rn(i=>XI(i),ja)}function qg(i,e){return D(this,null,function*(){let t=U(i),n=3,s=e.query,r=t.queries.get(s);r?!r.H_()&&e.J_()&&(n=2):(r=new Yp,n=e.J_()?0:1);try{switch(n){case 0:r.z_=yield t.onListen(s,!0);break;case 1:r.z_=yield t.onListen(s,!1);break;case 2:yield t.onFirstRemoteStoreListen(s)}}catch(o){let a=Qr(o,`Initialization of query '${gr(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,r),r.j_.push(e),e.Z_(t.onlineState),r.z_&&e.X_(r.z_)&&zg(t)})}function jg(i,e){return D(this,null,function*(){let t=U(i),n=e.query,s=3,r=t.queries.get(n);if(r){let o=r.j_.indexOf(e);o>=0&&(r.j_.splice(o,1),r.j_.length===0?s=e.J_()?0:1:!r.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})}function KN(i,e){let t=U(i),n=!1;for(let s of e){let r=s.query,o=t.queries.get(r);if(o){for(let a of o.j_)a.X_(s)&&(n=!0);o.z_=s}}n&&zg(t)}function QN(i,e,t){let n=U(i),s=n.queries.get(e);if(s)for(let r of s.j_)r.onError(t);n.queries.delete(e)}function zg(i){i.Y_.forEach(e=>{e.next()})}var Xp,vI;(vI=Xp||(Xp={})).ea="default",vI.Cache="cache";var Va=class{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){let n=[];for(let s of e.docChanges)s.type!==3&&n.push(s);e=new Vr(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;let n=t!=="Offline";return(!this.options._a||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;let t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Vr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Xp.Cache}};var Zp=class{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}};var Fc=class{constructor(e){this.serializer=e}Es(e){return Sn(this.serializer,e)}ds(e){return e.metadata.exists?w0(this.serializer,e.document,!1):Xe.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return Ge(e)}},eg=class{constructor(e,t,n){this.ca=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=W0(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;let n=me.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){let t=new Map,n=new Fc(this.serializer);for(let s of e)if(s.metadata.queries){let r=n.Es(s.metadata.name);for(let o of s.metadata.queries){let a=(t.get(o)||ie()).add(r);t.set(o,a)}}return t}complete(){return D(this,null,function*(){let e=yield DN(this.localStore,new Fc(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(let n of this.queries)yield kN(this.localStore,n,t.get(n.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}})}};function W0(i){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:i.totalDocuments,totalBytes:i.totalBytes}}var Lc=class{constructor(e){this.key=e}},Bc=class{constructor(e){this.key=e}},Uc=class{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=ie(),this.mutatedKeys=ie(),this.Aa=e0(e),this.Ra=new Mc(this.Aa)}get Va(){return this.Ta}ma(e,t){let n=t?t.fa:new Vc,s=t?t.Ra:this.Ra,r=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1,u=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,c=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((d,f)=>{let p=s.get(d),_=za(this.query,f)?f:null,E=!!p&&this.mutatedKeys.has(p.key),S=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations),R=!1;p&&_?p.data.isEqual(_.data)?E!==S&&(n.track({type:3,doc:_}),R=!0):this.ga(p,_)||(n.track({type:2,doc:_}),R=!0,(u&&this.Aa(_,u)>0||c&&this.Aa(_,c)<0)&&(a=!0)):!p&&_?(n.track({type:0,doc:_}),R=!0):p&&!_&&(n.track({type:1,doc:p}),R=!0,(u||c)&&(a=!0)),R&&(_?(o=o.add(_),r=S?r.add(d):r.delete(d)):(o=o.delete(d),r=r.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),r=r.delete(d.key),n.track({type:1,doc:d})}return{Ra:o,fa:n,ns:a,mutatedKeys:r}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,s){let r=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;let o=e.fa.G_();o.sort((d,f)=>function(_,E){let S=R=>{switch(R){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return j()}};return S(_)-S(E)}(d.type,f.type)||this.Aa(d.doc,f.doc)),this.pa(n),s=s!=null&&s;let a=t&&!s?this.ya():[],u=this.da.size===0&&this.current&&!s?1:0,c=u!==this.Ea;return this.Ea=u,o.length!==0||c?{snapshot:new Vr(this.query,e.Ra,r,o,e.mutatedKeys,u===0,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Vc,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];let e=this.da;this.da=ie(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});let t=[];return e.forEach(n=>{this.da.has(n)||t.push(new Bc(n))}),this.da.forEach(n=>{e.has(n)||t.push(new Lc(n))}),t}ba(e){this.Ta=e.Ts,this.da=ie();let t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Vr.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}},tg=class{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}},ng=class{constructor(e){this.key=e,this.va=!1}},ig=class{constructor(e,t,n,s,r,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=s,this.currentUser=r,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Rn(a=>XI(a),ja),this.Ma=new Map,this.xa=new Set,this.Oa=new Ne(q.comparator),this.Na=new Map,this.La=new ka,this.Ba={},this.ka=new Map,this.qa=Dr.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}};function WN(i,e,t=!0){return D(this,null,function*(){let n=th(i),s,r=n.Fa.get(e);return r?(n.sharedClientState.addLocalQueryTarget(r.targetId),s=r.view.Da()):s=yield $0(n,e,t,!0),s})}function $N(i,e){return D(this,null,function*(){let t=th(i);yield $0(t,e,!0,!1)})}function $0(i,e,t,n){return D(this,null,function*(){let s=yield kr(i.localStore,bt(e)),r=s.targetId,o=i.sharedClientState.addLocalQueryTarget(r,t),a;return n&&(a=yield Gg(i,e,r,o==="current",s.resumeToken)),i.isPrimaryClient&&t&&eh(i.remoteStore,s),a})}function Gg(i,e,t,n,s){return D(this,null,function*(){i.Ka=(f,p,_)=>function(S,R,V,B){return D(this,null,function*(){let F=R.view.ma(V);F.ns&&(F=yield Rc(S.localStore,R.query,!1).then(({documents:T})=>R.view.ma(T,F)));let K=B&&B.targetChanges.get(R.targetId),ne=B&&B.targetMismatches.get(R.targetId)!=null,H=R.view.applyChanges(F,S.isPrimaryClient,K,ne);return sg(S,R.targetId,H.wa),H.snapshot})}(i,f,p,_);let r=yield Rc(i.localStore,e,!0),o=new Uc(e,r.Ts),a=o.ma(r.documents),u=Pa.createSynthesizedTargetChangeForCurrentChange(t,n&&i.onlineState!=="Offline",s),c=o.applyChanges(a,i.isPrimaryClient,u);sg(i,t,c.wa);let d=new tg(e,t,o);return i.Fa.set(e,d),i.Ma.has(t)?i.Ma.get(t).push(e):i.Ma.set(t,[e]),c.snapshot})}function HN(i,e,t){return D(this,null,function*(){let n=U(i),s=n.Fa.get(e),r=n.Ma.get(s.targetId);if(r.length>1)return n.Ma.set(s.targetId,r.filter(o=>!ja(o,e))),void n.Fa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||(yield Or(n.localStore,s.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(s.targetId),t&&Mr(n.remoteStore,s.targetId),Fr(n,s.targetId)}).catch(Vi))):(Fr(n,s.targetId),yield Or(n.localStore,s.targetId,!0))})}function YN(i,e){return D(this,null,function*(){let t=U(i),n=t.Fa.get(e),s=t.Ma.get(n.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Mr(t.remoteStore,n.targetId))})}function JN(i,e,t){return D(this,null,function*(){let n=$g(i);try{let s=yield function(o,a){let u=U(o),c=Me.now(),d=a.reduce((_,E)=>_.add(E.key),ie()),f,p;return u.persistence.runTransaction("Locally write mutations","readwrite",_=>{let E=xt(),S=ie();return u.cs.getEntries(_,d).next(R=>{E=R,E.forEach((V,B)=>{B.isValidDocument()||(S=S.add(V))})}).next(()=>u.localDocuments.getOverlayedDocuments(_,E)).next(R=>{f=R;let V=[];for(let B of a){let F=hN(B,f.get(B.key).overlayedDocument);F!=null&&V.push(new an(B.key,F,KI(F.value.mapValue),Ue.exists(!0)))}return u.mutationQueue.addMutationBatch(_,c,V,a)}).next(R=>{p=R;let V=R.applyToLocalDocumentSet(f,S);return u.documentOverlayCache.saveOverlays(_,R.batchId,V)})}).then(()=>({batchId:p.batchId,changes:n0(f)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(s.batchId),function(o,a,u){let c=o.Ba[o.currentUser.toKey()];c||(c=new Ne(Z)),c=c.insert(a,u),o.Ba[o.currentUser.toKey()]=c}(n,s.batchId,t),yield Yn(n,s.changes),yield Gr(n.remoteStore)}catch(s){let r=Qr(s,"Failed to persist write");t.reject(r)}})}function H0(i,e){return D(this,null,function*(){let t=U(i);try{let n=yield NN(t.localStore,e);e.targetChanges.forEach((s,r)=>{let o=t.Na.get(r);o&&(G(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?G(o.va):s.removedDocuments.size>0&&(G(o.va),o.va=!1))}),yield Yn(t,n,e)}catch(n){yield Vi(n)}})}function wI(i,e,t){let n=U(i);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){let s=[];n.Fa.forEach((r,o)=>{let a=o.view.Z_(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){let u=U(o);u.onlineState=a;let c=!1;u.queries.forEach((d,f)=>{for(let p of f.j_)p.Z_(a)&&(c=!0)}),c&&zg(u)}(n.eventManager,e),s.length&&n.Ca.d_(s),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function XN(i,e,t){return D(this,null,function*(){let n=U(i);n.sharedClientState.updateQueryState(e,"rejected",t);let s=n.Na.get(e),r=s&&s.key;if(r){let o=new Ne(q.comparator);o=o.insert(r,Xe.newNoDocument(r,W.min()));let a=ie().add(r),u=new Ra(W.min(),new Map,new Ne(Z),o,a);yield H0(n,u),n.Oa=n.Oa.remove(r),n.Na.delete(e),Wg(n)}else yield Or(n.localStore,e,!1).then(()=>Fr(n,e,t)).catch(Vi)})}function ZN(i,e){return D(this,null,function*(){let t=U(i),n=e.batch.batchId;try{let s=yield PN(t.localStore,e);Qg(t,n,null),Kg(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield Yn(t,s)}catch(s){yield Vi(s)}})}function ex(i,e,t){return D(this,null,function*(){let n=U(i);try{let s=yield function(o,a){let u=U(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let d;return u.mutationQueue.lookupMutationBatch(c,a).next(f=>(G(f!==null),d=f.keys(),u.mutationQueue.removeMutationBatch(c,f))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,d,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,d)).next(()=>u.localDocuments.getDocuments(c,d))})}(n.localStore,e);Qg(n,e,t),Kg(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield Yn(n,s)}catch(s){yield Vi(s)}})}function tx(i,e){return D(this,null,function*(){let t=U(i);Li(t.remoteStore)||O("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let n=yield function(o){let a=U(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>a.mutationQueue.getHighestUnacknowledgedBatchId(u))}(t.localStore);if(n===-1)return void e.resolve();let s=t.ka.get(n)||[];s.push(e),t.ka.set(n,s)}catch(n){let s=Qr(n,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}})}function Kg(i,e){(i.ka.get(e)||[]).forEach(t=>{t.resolve()}),i.ka.delete(e)}function Qg(i,e,t){let n=U(i),s=n.Ba[n.currentUser.toKey()];if(s){let r=s.get(e);r&&(t?r.reject(t):r.resolve(),s=s.remove(e)),n.Ba[n.currentUser.toKey()]=s}}function Fr(i,e,t=null){i.sharedClientState.removeLocalQueryTarget(e);for(let n of i.Ma.get(e))i.Fa.delete(n),t&&i.Ca.$a(n,t);i.Ma.delete(e),i.isPrimaryClient&&i.La.gr(e).forEach(n=>{i.La.containsKey(n)||Y0(i,n)})}function Y0(i,e){i.xa.delete(e.path.canonicalString());let t=i.Oa.get(e);t!==null&&(Mr(i.remoteStore,t),i.Oa=i.Oa.remove(e),i.Na.delete(t),Wg(i))}function sg(i,e,t){for(let n of t)n instanceof Lc?(i.La.addReference(n.key,e),nx(i,n)):n instanceof Bc?(O("SyncEngine","Document no longer in limbo: "+n.key),i.La.removeReference(n.key,e),i.La.containsKey(n.key)||Y0(i,n.key)):j()}function nx(i,e){let t=e.key,n=t.path.canonicalString();i.Oa.get(t)||i.xa.has(n)||(O("SyncEngine","New document in limbo: "+t),i.xa.add(n),Wg(i))}function Wg(i){for(;i.xa.size>0&&i.Oa.size<i.maxConcurrentLimboResolutions;){let e=i.xa.values().next().value;i.xa.delete(e);let t=new q(me.fromString(e)),n=i.qa.next();i.Na.set(n,new ng(t)),i.Oa=i.Oa.insert(t,n),eh(i.remoteStore,new xr(bt(jr(t.path)),n,"TargetPurposeLimboResolution",Ft.oe))}}function Yn(i,e,t){return D(this,null,function*(){let n=U(i),s=[],r=[],o=[];n.Fa.isEmpty()||(n.Fa.forEach((a,u)=>{o.push(n.Ka(u,e,t).then(c=>{var d;if((c||t)&&n.isPrimaryClient){let f=c?!c.fromCache:(d=t?.targetChanges.get(u.targetId))===null||d===void 0?void 0:d.current;n.sharedClientState.updateQueryState(u.targetId,f?"current":"not-current")}if(c){s.push(c);let f=Vp.Wi(u.targetId,c);r.push(f)}}))}),yield Promise.all(o),n.Ca.d_(s),yield function(u,c){return D(this,null,function*(){let d=U(u);try{yield d.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>P.forEach(c,p=>P.forEach(p.$i,_=>d.persistence.referenceDelegate.addReference(f,p.targetId,_)).next(()=>P.forEach(p.Ui,_=>d.persistence.referenceDelegate.removeReference(f,p.targetId,_)))))}catch(f){if(!Fi(f))throw f;O("LocalStore","Failed to update sequence numbers: "+f)}for(let f of c){let p=f.targetId;if(!f.fromCache){let _=d.os.get(p),E=_.snapshotVersion,S=_.withLastLimboFreeSnapshotVersion(E);d.os=d.os.insert(p,S)}}})}(n.localStore,r))})}function ix(i,e){return D(this,null,function*(){let t=U(i);if(!t.currentUser.isEqual(e)){O("SyncEngine","User change. New user:",e.toKey());let n=yield M0(t.localStore,e);t.currentUser=e,function(r,o){r.ka.forEach(a=>{a.forEach(u=>{u.reject(new k(x.CANCELLED,o))})}),r.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield Yn(t,n.hs)}})}function sx(i,e){let t=U(i),n=t.Na.get(e);if(n&&n.va)return ie().add(n.key);{let s=ie(),r=t.Ma.get(e);if(!r)return s;for(let o of r){let a=t.Fa.get(o);s=s.unionWith(a.view.Va)}return s}}function rx(i,e){return D(this,null,function*(){let t=U(i),n=yield Rc(t.localStore,e.query,!0),s=e.view.ba(n);return t.isPrimaryClient&&sg(t,e.targetId,s.wa),s})}function ox(i,e){return D(this,null,function*(){let t=U(i);return B0(t.localStore,e).then(n=>Yn(t,n))})}function ax(i,e,t,n){return D(this,null,function*(){let s=U(i),r=yield function(a,u){let c=U(a),d=U(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",f=>d.Mn(f,u).next(p=>p?c.localDocuments.getDocuments(f,p):P.resolve(null)))}(s.localStore,e);r!==null?(t==="pending"?yield Gr(s.remoteStore):t==="acknowledged"||t==="rejected"?(Qg(s,e,n||null),Kg(s,e),function(a,u){U(U(a).mutationQueue).On(u)}(s.localStore,e)):j(),yield Yn(s,r)):O("SyncEngine","Cannot apply mutation batch with id: "+e)})}function lx(i,e){return D(this,null,function*(){let t=U(i);if(th(t),$g(t),e===!0&&t.Qa!==!0){let n=t.sharedClientState.getAllActiveQueryTargets(),s=yield EI(t,n.toArray());t.Qa=!0,yield $p(t.remoteStore,!0);for(let r of s)eh(t.remoteStore,r)}else if(e===!1&&t.Qa!==!1){let n=[],s=Promise.resolve();t.Ma.forEach((r,o)=>{t.sharedClientState.isLocalQueryTarget(o)?n.push(o):s=s.then(()=>(Fr(t,o),Or(t.localStore,o,!0))),Mr(t.remoteStore,o)}),yield s,yield EI(t,n),function(o){let a=U(o);a.Na.forEach((u,c)=>{Mr(a.remoteStore,c)}),a.La.pr(),a.Na=new Map,a.Oa=new Ne(q.comparator)}(t),t.Qa=!1,yield $p(t.remoteStore,!1)}})}function EI(i,e,t){return D(this,null,function*(){let n=U(i),s=[],r=[];for(let o of e){let a,u=n.Ma.get(o);if(u&&u.length!==0){a=yield kr(n.localStore,bt(u[0]));for(let c of u){let d=n.Fa.get(c),f=yield rx(n,d);f.snapshot&&r.push(f.snapshot)}}else{let c=yield L0(n.localStore,o);a=yield kr(n.localStore,c),yield Gg(n,J0(c),o,!1,a.resumeToken)}s.push(a)}return n.Ca.d_(r),s})}function J0(i){return JI(i.path,i.collectionGroup,i.orderBy,i.filters,i.limit,"F",i.startAt,i.endAt)}function ux(i){return function(t){return U(U(t).persistence).Qi()}(U(i).localStore)}function cx(i,e,t,n){return D(this,null,function*(){let s=U(i);if(s.Qa)return void O("SyncEngine","Ignoring unexpected query state notification.");let r=s.Ma.get(e);if(r&&r.length>0)switch(t){case"current":case"not-current":{let o=yield B0(s.localStore,ZI(r[0])),a=Ra.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Ke.EMPTY_BYTE_STRING);yield Yn(s,o,a);break}case"rejected":yield Or(s.localStore,e,!0),Fr(s,e,n);break;default:j()}})}function hx(i,e,t){return D(this,null,function*(){let n=th(i);if(n.Qa){for(let s of e){if(n.Ma.has(s)&&n.sharedClientState.isActiveQueryTarget(s)){O("SyncEngine","Adding an already active target "+s);continue}let r=yield L0(n.localStore,s),o=yield kr(n.localStore,r);yield Gg(n,J0(r),o.targetId,!1,o.resumeToken),eh(n.remoteStore,o)}for(let s of t)n.Ma.has(s)&&(yield Or(n.localStore,s,!1).then(()=>{Mr(n.remoteStore,s),Fr(n,s)}).catch(Vi))}})}function th(i){let e=U(i);return e.remoteStore.remoteSyncer.applyRemoteEvent=H0.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=sx.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=XN.bind(null,e),e.Ca.d_=KN.bind(null,e.eventManager),e.Ca.$a=QN.bind(null,e.eventManager),e}function $g(i){let e=U(i);return e.remoteStore.remoteSyncer.applySuccessfulWrite=ZN.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=ex.bind(null,e),e}function dx(i,e,t){let n=U(i);(function(r,o,a){return D(this,null,function*(){try{let u=yield o.getMetadata();if(yield function(_,E){let S=U(_),R=Ge(E.createTime);return S.persistence.runTransaction("hasNewerBundle","readonly",V=>S.Gr.getBundleMetadata(V,E.id)).then(V=>!!V&&V.createTime.compareTo(R)>=0)}(r.localStore,u))return yield o.close(),a._completeWith(function(_){return{taskState:"Success",documentsLoaded:_.totalDocuments,bytesLoaded:_.totalBytes,totalDocuments:_.totalDocuments,totalBytes:_.totalBytes}}(u)),Promise.resolve(new Set);a._updateProgress(W0(u));let c=new eg(u,r.localStore,o.serializer),d=yield o.Ua();for(;d;){let p=yield c.la(d);p&&a._updateProgress(p),d=yield o.Ua()}let f=yield c.complete();return yield Yn(r,f.Ia,void 0),yield function(_,E){let S=U(_);return S.persistence.runTransaction("Save bundle","readwrite",R=>S.Gr.saveBundleMetadata(R,E))}(r.localStore,u),a._completeWith(f.progress),Promise.resolve(f.Pa)}catch(u){return rn("SyncEngine",`Loading bundle failed with ${u}`),a._failWith(u),Promise.resolve(new Set)}})})(n,e,t).then(s=>{n.sharedClientState.notifyBundleLoaded(s)})}var rg=(()=>{class i{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return D(this,null,function*(){this.serializer=Ga(t.databaseInfo.databaseId),this.sharedClientState=this.Wa(t),this.persistence=this.Ga(t),yield this.persistence.start(),this.localStore=this.za(t),this.gcScheduler=this.ja(t,this.localStore),this.indexBackfillerScheduler=this.Ha(t,this.localStore)})}ja(t,n){return null}Ha(t,n){return null}za(t){return O0(this.persistence,new Cc,t.initialUser,this.serializer)}Ga(t){return new bc(Ac.Zr,this.serializer)}Wa(t){return new xc}terminate(){return D(this,null,function*(){var t,n;(t=this.gcScheduler)===null||t===void 0||t.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return i.provider={build:()=>new i},i})();var qc=class i extends rg{constructor(e,t,n){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return D(this,null,function*(){yield ad(i.prototype,this,"initialize").call(this,e),yield this.Ja.initialize(this,e),yield $g(this.Ja.syncEngine),yield Gr(this.Ja.remoteStore),yield this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}za(e){return O0(this.persistence,new Cc,e.initialUser,this.serializer)}ja(e,t){let n=this.persistence.referenceDelegate.garbageCollector;return new wp(n,e.asyncQueue,t)}Ha(e,t){let n=new Fm(t,this.persistence);return new Vm(e.asyncQueue,n)}Ga(e){let t=Fg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?$t.withCacheSize(this.cacheSizeBytes):$t.DEFAULT;return new Mp(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,q0(),ec(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new xc}},og=class i extends qc{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return D(this,null,function*(){yield ad(i.prototype,this,"initialize").call(this,e);let t=this.Ja.syncEngine;this.sharedClientState instanceof ya&&(this.sharedClientState.syncEngine={no:ax.bind(null,t),ro:cx.bind(null,t),io:hx.bind(null,t),Qi:ux.bind(null,t),eo:ox.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.yi(n=>D(this,null,function*(){yield lx(this.Ja.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())}))})}Wa(e){let t=q0();if(!ya.D(t))throw new k(x.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=Fg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new ya(t,e.asyncQueue,n,e.clientId,e.initialUser)}},Hg=(()=>{class i{initialize(t,n){return D(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>wI(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=ix.bind(null,this.syncEngine),yield $p(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new Jp}()}createDatastore(t){let n=Ga(t.databaseInfo.databaseId),s=function(o){return new jp(o)}(t.databaseInfo);return function(o,a,u,c){return new Kp(o,a,u,c)}(t.authCredentials,t.appCheckCredentials,s,n)}createRemoteStore(t){return function(s,r,o,a,u){return new Wp(s,r,o,a,u)}(this.localStore,this.datastore,t.asyncQueue,n=>wI(this.syncEngine,n,0),function(){return Dc.D()?new Dc:new Up}())}createSyncEngine(t,n){return function(r,o,a,u,c,d,f){let p=new ig(r,o,a,u,c,d);return f&&(p.Qa=!0),p}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,n)}terminate(){return D(this,null,function*(){var t,n;yield function(r){return D(this,null,function*(){let o=U(r);O("RemoteStore","RemoteStore shutting down."),o.L_.add(5),yield zr(o),o.k_.shutdown(),o.q_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()})}}return i.provider={build:()=>new i},i})();function TI(i,e=10240){let t=0;return{read(){return D(this,null,function*(){if(t<i.byteLength){let s={value:i.slice(t,t+e),done:!1};return t+=e,s}return{done:!0}})},cancel(){return D(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var Lr=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):je("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var ag=class{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new nt,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(n=>{n&&n.ua()?this.metadata.resolve(n.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(n?.aa)}`))},n=>this.metadata.reject(n))}close(){return this.Xa.cancel()}getMetadata(){return D(this,null,function*(){return this.metadata.promise})}Ua(){return D(this,null,function*(){return yield this.getMetadata(),this.tu()})}tu(){return D(this,null,function*(){let e=yield this.nu();if(e===null)return null;let t=this.eu.decode(e),n=Number(t);isNaN(n)&&this.ru(`length string (${t}) is not valid number`);let s=yield this.iu(n);return new Zp(JSON.parse(s),e.length+n)})}su(){return this.buffer.findIndex(e=>e===123)}nu(){return D(this,null,function*(){for(;this.su()<0&&!(yield this.ou()););if(this.buffer.length===0)return null;let e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}iu(e){return D(this,null,function*(){for(;this.buffer.length<e;)(yield this.ou())&&this.ru("Reached the end of bundle when more is expected.");let t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}ou(){return D(this,null,function*(){let e=yield this.Xa.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var lg=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return D(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new k(x.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(s,r){return D(this,null,function*(){let o=U(s),a={documents:r.map(f=>Na(o.serializer,f))},u=yield o.Lo("BatchGetDocuments",o.serializer.databaseId,me.emptyPath(),a,r.length),c=new Map;u.forEach(f=>{let p=_N(o.serializer,f);c.set(p.key.toString(),p)});let d=[];return r.forEach(f=>{let p=c.get(f.toString());G(!!p),d.push(p)}),d})}(this.datastore,e);return t.forEach(n=>this.recordVersion(n)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(e.toString())}delete(e){this.write(new Oi(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return D(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,n)=>{let s=q.fromPath(n);this.mutations.push(new ba(s,this.precondition(s)))}),yield function(n,s){return D(this,null,function*(){let r=U(n),o={writes:s.map(a=>xa(r.serializer,a))};yield r.Mo("Commit",r.serializer.databaseId,me.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw j();t=W.min()}let n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new k(x.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(W.min())?Ue.exists(!1):Ue.updateTime(t):Ue.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(W.min()))throw new k(x.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ue.updateTime(t)}return Ue.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var ug=class{constructor(e,t,n,s,r){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=s,this.deferred=r,this._u=n.maxAttempts,this.t_=new Ma(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(()=>D(this,null,function*(){let e=new lg(this.datastore),t=this.cu(e);t&&t.then(n=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(n)}).catch(s=>{this.lu(s)}))}).catch(n=>{this.lu(n)})}))}cu(e){try{let t=this.updateFunction(e);return!Ua(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!d0(t)}return!1}};var cg=class{constructor(e,t,n,s,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=s,this.user=Je.UNAUTHENTICATED,this.clientId=nc.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=r,this.authCredentials.start(n,o=>D(this,null,function*(){O("FirestoreClient","Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(n,o=>(O("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new nt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>D(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let n=Qr(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}};function bm(i,e){return D(this,null,function*(){i.asyncQueue.verifyOperationInProgress(),O("FirestoreClient","Initializing OfflineComponentProvider");let t=i.configuration;yield e.initialize(t);let n=t.initialUser;i.setCredentialChangeListener(s=>D(this,null,function*(){n.isEqual(s)||(yield M0(e.localStore,s),n=s)})),e.persistence.setDatabaseDeletedListener(()=>i.terminate()),i._offlineComponents=e})}function II(i,e){return D(this,null,function*(){i.asyncQueue.verifyOperationInProgress();let t=yield Yg(i);O("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,i.configuration),i.setCredentialChangeListener(n=>_I(e.remoteStore,n)),i.setAppCheckTokenChangeListener((n,s)=>_I(e.remoteStore,s)),i._onlineComponents=e})}function Yg(i){return D(this,null,function*(){if(!i._offlineComponents)if(i._uninitializedComponentsProvider){O("FirestoreClient","Using user provided OfflineComponentProvider");try{yield bm(i,i._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(s){return s.name==="FirebaseError"?s.code===x.FAILED_PRECONDITION||s.code===x.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;rn("Error using user provided cache. Falling back to memory cache: "+t),yield bm(i,new rg)}}else O("FirestoreClient","Using default OfflineComponentProvider"),yield bm(i,new rg);return i._offlineComponents})}function nh(i){return D(this,null,function*(){return i._onlineComponents||(i._uninitializedComponentsProvider?(O("FirestoreClient","Using user provided OnlineComponentProvider"),yield II(i,i._uninitializedComponentsProvider._online)):(O("FirestoreClient","Using default OnlineComponentProvider"),yield II(i,new Hg))),i._onlineComponents})}function X0(i){return Yg(i).then(e=>e.persistence)}function Jg(i){return Yg(i).then(e=>e.localStore)}function Z0(i){return nh(i).then(e=>e.remoteStore)}function Xg(i){return nh(i).then(e=>e.syncEngine)}function fx(i){return nh(i).then(e=>e.datastore)}function Br(i){return D(this,null,function*(){let e=yield nh(i),t=e.eventManager;return t.onListen=WN.bind(null,e.syncEngine),t.onUnlisten=HN.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=$N.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=YN.bind(null,e.syncEngine),t})}function mx(i){return i.asyncQueue.enqueue(()=>D(this,null,function*(){let e=yield X0(i),t=yield Z0(i);return e.setNetworkEnabled(!0),function(s){let r=U(s);return r.L_.delete(0),Ka(r)}(t)}))}function px(i){return i.asyncQueue.enqueue(()=>D(this,null,function*(){let e=yield X0(i),t=yield Z0(i);return e.setNetworkEnabled(!1),function(s){return D(this,null,function*(){let r=U(s);r.L_.add(0),yield zr(r),r.q_.set("Offline")})}(t)}))}function gx(i,e){let t=new nt;return i.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(s,r,o){return D(this,null,function*(){try{let a=yield function(c,d){let f=U(c);return f.persistence.runTransaction("read document","readonly",p=>f.localDocuments.getDocument(p,d))}(s,r);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new k(x.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let u=Qr(a,`Failed to get document '${r} from cache`);o.reject(u)}})}(yield Jg(i),e,t)})),t.promise}function eS(i,e,t={}){let n=new nt;return i.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(r,o,a,u,c){let d=new Lr({next:p=>{d.Za(),o.enqueueAndForget(()=>jg(r,f));let _=p.docs.has(a);!_&&p.fromCache?c.reject(new k(x.UNAVAILABLE,"Failed to get document because the client is offline.")):_&&p.fromCache&&u&&u.source==="server"?c.reject(new k(x.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(p)},error:p=>c.reject(p)}),f=new Va(jr(a.path),d,{includeMetadataChanges:!0,_a:!0});return qg(r,f)}(yield Br(i),i.asyncQueue,e,t,n)})),n.promise}function _x(i,e){let t=new nt;return i.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(s,r,o){return D(this,null,function*(){try{let a=yield Rc(s,r,!0),u=new Uc(r,a.Ts),c=u.ma(a.documents),d=u.applyChanges(c,!1);o.resolve(d.snapshot)}catch(a){let u=Qr(a,`Failed to execute query '${r} against cache`);o.reject(u)}})}(yield Jg(i),e,t)})),t.promise}function tS(i,e,t={}){let n=new nt;return i.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(r,o,a,u,c){let d=new Lr({next:p=>{d.Za(),o.enqueueAndForget(()=>jg(r,f)),p.fromCache&&u.source==="server"?c.reject(new k(x.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(p)},error:p=>c.reject(p)}),f=new Va(a,d,{includeMetadataChanges:!0,_a:!0});return qg(r,f)}(yield Br(i),i.asyncQueue,e,t,n)})),n.promise}function yx(i,e){let t=new Lr(e);return i.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(s,r){U(s).Y_.add(r),r.next()}(yield Br(i),t)})),()=>{t.Za(),i.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(s,r){U(s).Y_.delete(r)}(yield Br(i),t)}))}}function vx(i,e,t,n){let s=function(o,a){let u;return u=typeof o=="string"?m0().encode(o):o,function(d,f){return new ag(d,f)}(function(d,f){if(d instanceof Uint8Array)return TI(d,f);if(d instanceof ArrayBuffer)return TI(new Uint8Array(d),f);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),a)}(t,Ga(e));i.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){dx(yield Xg(i),s,n)}))}function wx(i,e){return i.asyncQueue.enqueue(()=>D(this,null,function*(){return function(n,s){let r=U(n);return r.persistence.runTransaction("Get named query","readonly",o=>r.Gr.getNamedQuery(o,s))}(yield Jg(i),e)}))}function nS(i){let e={};return i.timeoutSeconds!==void 0&&(e.timeoutSeconds=i.timeoutSeconds),e}var SI=new Map;function Zg(i,e,t){if(!t)throw new k(x.INVALID_ARGUMENT,`Function ${i}() cannot be called with an empty ${e}.`)}function e_(i,e,t,n){if(e===!0&&n===!0)throw new k(x.INVALID_ARGUMENT,`${i} and ${t} cannot be used together.`)}function bI(i){if(!q.isDocumentKey(i))throw new k(x.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${i} has ${i.length}.`)}function AI(i){if(q.isDocumentKey(i))throw new k(x.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${i} has ${i.length}.`)}function ih(i){if(i===void 0)return"undefined";if(i===null)return"null";if(typeof i=="string")return i.length>20&&(i=`${i.substring(0,20)}...`),JSON.stringify(i);if(typeof i=="number"||typeof i=="boolean")return""+i;if(typeof i=="object"){if(i instanceof Array)return"an array";{let e=function(n){return n.constructor?n.constructor.name:null}(i);return e?`a custom ${e} object`:"an object"}}return typeof i=="function"?"a function":j()}function ge(i,e){if("_delegate"in i&&(i=i._delegate),!(i instanceof e)){if(e.name===i.constructor.name)throw new k(x.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=ih(i);throw new k(x.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return i}function iS(i,e){if(e<=0)throw new k(x.INVALID_ARGUMENT,`Function ${i}() requires a positive number, but it was: ${e}.`)}var jc=class{constructor(e){var t,n;if(e.host===void 0){if(e.ssl!==void 0)throw new k(x.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new k(x.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}e_("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=nS((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new k(x.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new k(x.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new k(x.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,s){return n.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},ws=class{constructor(e,t,n,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new jc({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new k(x.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new k(x.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new jc(e),e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new Am;switch(n.type){case"firstParty":return new Nm(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new k(x.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return D(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let n=SI.get(t);n&&(O("ComponentProvider","Removing Datastore"),SI.delete(t),n.terminate())}(this),Promise.resolve()}};function sS(i,e,t,n={}){var s;let r=(i=ge(i,ws))._getSettings(),o=`${e}:${t}`;if(r.host!=="firestore.googleapis.com"&&r.host!==o&&rn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),i._setSettings(Object.assign(Object.assign({},r),{host:o,ssl:!1})),n.mockUserToken){let a,u;if(typeof n.mockUserToken=="string")a=n.mockUserToken,u=Je.MOCK_USER;else{a=Nl(n.mockUserToken,(s=i._app)===null||s===void 0?void 0:s.options.projectId);let c=n.mockUserToken.sub||n.mockUserToken.user_id;if(!c)throw new k(x.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new Je(c)}i._authCredentials=new Cm(new tc(a,u))}}var lt=class i{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new i(this.firestore,e,this._query)}},be=class i{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new bn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new i(this.firestore,e,this._key)}},bn=class i extends lt{constructor(e,t,n){super(e,t,jr(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new be(this.firestore,null,new q(e))}withConverter(e){return new i(this.firestore,e,this._path)}};function t_(i,e,...t){if(i=he(i),Zg("collection","path",e),i instanceof ws){let n=me.fromString(e,...t);return AI(n),new bn(i,null,n)}{if(!(i instanceof be||i instanceof bn))throw new k(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=i._path.child(me.fromString(e,...t));return AI(n),new bn(i.firestore,null,n)}}function rS(i,e){if(i=ge(i,ws),Zg("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new k(x.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new lt(i,null,function(n){return new on(me.emptyPath(),n)}(e))}function Qa(i,e,...t){if(i=he(i),arguments.length===1&&(e=nc.newId()),Zg("doc","path",e),i instanceof ws){let n=me.fromString(e,...t);return bI(n),new be(i,null,new q(n))}{if(!(i instanceof be||i instanceof bn))throw new k(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=i._path.child(me.fromString(e,...t));return bI(n),new be(i.firestore,i instanceof bn?i.converter:null,new q(n))}}function n_(i,e){return i=he(i),e=he(e),(i instanceof be||i instanceof bn)&&(e instanceof be||e instanceof bn)&&i.firestore===e.firestore&&i.path===e.path&&i.converter===e.converter}function i_(i,e){return i=he(i),e=he(e),i instanceof lt&&e instanceof lt&&i.firestore===e.firestore&&ja(i._query,e._query)&&i.converter===e.converter}var zc=class{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Ma(this,"async_queue_retry"),this.Vu=()=>{let n=ec();n&&O("AsyncQueue","Visibility state changed to "+n.visibilityState),this.t_.jo()},this.mu=e;let t=ec();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;let t=ec();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});let t=new nt;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}pu(){return D(this,null,function*(){if(this.Pu.length!==0){try{yield this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Fi(e))throw e;O("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}})}gu(e){let t=this.mu.then(()=>(this.du=!0,e().catch(n=>{this.Eu=n,this.du=!1;let s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(n);throw je("INTERNAL UNHANDLED ERROR: ",s),n}).then(n=>(this.du=!1,n))));return this.mu=t,t}enqueueAfterDelay(e,t,n){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);let s=Hp.createAndSchedule(this,e,t,n,r=>this.yu(r));return this.Tu.push(s),s}fu(){this.Eu&&j()}verifyOperationInProgress(){}wu(){return D(this,null,function*(){let e;do e=this.mu,yield e;while(e!==this.mu)})}Su(e){for(let t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(let t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){let t=this.Tu.indexOf(e);this.Tu.splice(t,1)}};function hg(i){return function(t,n){if(typeof t!="object"||t===null)return!1;let s=t;for(let r of n)if(r in s&&typeof s[r]=="function")return!0;return!1}(i,["next","error","complete"])}var dg=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new nt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var oS=-1,Ve=class extends ws{constructor(e,t,n,s){super(e,t,n,s),this.type="firestore",this._queue=new zc,this._persistenceKey=s?.name||"[DEFAULT]"}_terminate(){return D(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new zc(e),this._firestoreClient=void 0,yield e}})}};function ut(i){if(i._terminated)throw new k(x.FAILED_PRECONDITION,"The client has already been terminated.");return i._firestoreClient||aS(i),i._firestoreClient}function aS(i){var e,t,n;let s=i._freezeSettings(),r=function(a,u,c,d){return new Lm(a,u,c,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,nS(d.experimentalLongPollingOptions),d.useFetchStreams)}(i._databaseId,((e=i._app)===null||e===void 0?void 0:e.options.appId)||"",i._persistenceKey,s);i._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((n=s.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(i._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),i._firestoreClient=new cg(i._authCredentials,i._appCheckCredentials,i._queue,r,i._componentsProvider&&function(a){let u=a?._online.build();return{_offline:a?._offline.build(u),_online:u}}(i._componentsProvider))}function lS(i,e){rn("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=i._freezeSettings();return cS(i,Hg.provider,{build:n=>new qc(n,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}function uS(i){return D(this,null,function*(){rn("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=i._freezeSettings();cS(i,Hg.provider,{build:t=>new og(t,e.cacheSizeBytes)})})}function cS(i,e,t){if((i=ge(i,Ve))._firestoreClient||i._terminated)throw new k(x.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(i._componentsProvider||i._getSettings().localCache)throw new k(x.FAILED_PRECONDITION,"SDK cache is already specified.");i._componentsProvider={_online:e,_offline:t},aS(i)}function hS(i){if(i._initialized&&!i._terminated)throw new k(x.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new nt;return i._queue.enqueueAndForgetEvenWhileRestricted(()=>D(this,null,function*(){try{yield function(n){return D(this,null,function*(){if(!Ci.D())return Promise.resolve();let s=n+"main";yield Ci.delete(s)})}(Fg(i._databaseId,i._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function dS(i){return function(t){let n=new nt;return t.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return tx(yield Xg(t),n)})),n.promise}(ut(i=ge(i,Ve)))}function fS(i){return mx(ut(i=ge(i,Ve)))}function mS(i){return px(ut(i=ge(i,Ve)))}function pS(i,e){let t=ut(i=ge(i,Ve)),n=new dg;return vx(t,i._databaseId,e,n),n}function gS(i,e){return wx(ut(i=ge(i,Ve)),e).then(t=>t?new lt(i,null,t.query):null)}var Pn=class i{constructor(e){this._byteString=e}static fromBase64String(e){try{return new i(Ke.fromBase64String(e))}catch(t){throw new k(x.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new i(Ke.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var ln=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new k(x.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ze(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var $n=class{constructor(e){this._methodName=e}};var Es=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new k(x.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new k(x.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Z(this._lat,e._lat)||Z(this._long,e._long)}};var Fa=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,s){if(n.length!==s.length)return!1;for(let r=0;r<n.length;++r)if(n[r]!==s[r])return!1;return!0}(this._values,e._values)}};var Ex=/^__.*__$/,fg=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new an(e,this.data,this.fieldMask,t,this.fieldTransforms):new ki(e,this.data,t,this.fieldTransforms)}},Gc=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new an(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function _S(i){switch(i){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw j()}}var Kc=class i{constructor(e,t,n,s,r,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=s,r===void 0&&this.vu(),this.fieldTransforms=r||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new i(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:n,xu:!1});return s.Ou(e),s}Nu(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:n,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Qc(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(_S(this.Cu)&&Ex.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}},mg=class{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Ga(e)}Qu(e,t,n,s=!1){return new Kc({Cu:e,methodName:t,qu:n,path:ze.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function bs(i){let e=i._freezeSettings(),t=Ga(i._databaseId);return new mg(i._databaseId,!!e.ignoreUndefinedProperties,t)}function sh(i,e,t,n,s,r={}){let o=i.Qu(r.merge||r.mergeFields?2:0,e,t,s);o_("Data must be an object, but it was:",o,n);let a=wS(n,o),u,c;if(r.merge)u=new Lt(o.fieldMask),c=o.fieldTransforms;else if(r.mergeFields){let d=[];for(let f of r.mergeFields){let p=vg(e,f,t);if(!o.contains(p))throw new k(x.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);TS(d,p)||d.push(p)}u=new Lt(d),c=o.fieldTransforms.filter(f=>u.covers(f.field))}else u=null,c=o.fieldTransforms;return new fg(new gt(a),u,c)}var La=class i extends $n{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof i}};function yS(i,e,t){return new Kc({Cu:3,qu:e.settings.qu,methodName:i._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var pg=class i extends $n{_toFieldTransform(e){return new _s(e.path,new xi)}isEqual(e){return e instanceof i}},gg=class i extends $n{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){let t=yS(this,e,!0),n=this.Ku.map(r=>As(r,t)),s=new Qn(n);return new _s(e.path,s)}isEqual(e){return e instanceof i&&gd(this.Ku,e.Ku)}},_g=class i extends $n{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){let t=yS(this,e,!0),n=this.Ku.map(r=>As(r,t)),s=new Wn(n);return new _s(e.path,s)}isEqual(e){return e instanceof i&&gd(this.Ku,e.Ku)}},yg=class i extends $n{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){let t=new Di(e.serializer,r0(e.serializer,this.$u));return new _s(e.path,t)}isEqual(e){return e instanceof i&&this.$u===e.$u}};function s_(i,e,t,n){let s=i.Qu(1,e,t);o_("Data must be an object, but it was:",s,n);let r=[],o=gt.empty();Ss(n,(u,c)=>{let d=a_(e,u,t);c=he(c);let f=s.Nu(d);if(c instanceof La)r.push(d);else{let p=As(c,f);p!=null&&(r.push(d),o.set(d,p))}});let a=new Lt(r);return new Gc(o,a,s.fieldTransforms)}function r_(i,e,t,n,s,r){let o=i.Qu(1,e,t),a=[vg(e,n,t)],u=[s];if(r.length%2!=0)throw new k(x.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<r.length;p+=2)a.push(vg(e,r[p])),u.push(r[p+1]);let c=[],d=gt.empty();for(let p=a.length-1;p>=0;--p)if(!TS(c,a[p])){let _=a[p],E=u[p];E=he(E);let S=o.Nu(_);if(E instanceof La)c.push(_);else{let R=As(E,S);R!=null&&(c.push(_),d.set(_,R))}}let f=new Lt(c);return new Gc(d,f,o.fieldTransforms)}function vS(i,e,t,n=!1){return As(t,i.Qu(n?4:3,e))}function As(i,e){if(ES(i=he(i)))return o_("Unsupported field value:",e,i),wS(i,e);if(i instanceof $n)return function(n,s){if(!_S(s.Cu))throw s.Bu(`${n._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${n._methodName}() is not currently supported inside arrays`);let r=n._toFieldTransform(s);r&&s.fieldTransforms.push(r)}(i,e),null;if(i===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),i instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(n,s){let r=[],o=0;for(let a of n){let u=As(a,s.Lu(o));u==null&&(u={nullValue:"NULL_VALUE"}),r.push(u),o++}return{arrayValue:{values:r}}}(i,e)}return function(n,s){if((n=he(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return r0(s.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let r=Me.fromDate(n);return{timestampValue:Nr(s.serializer,r)}}if(n instanceof Me){let r=new Me(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Nr(s.serializer,r)}}if(n instanceof Es)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Pn)return{bytesValue:p0(s.serializer,n._byteString)};if(n instanceof be){let r=s.databaseId,o=n.firestore._databaseId;if(!o.isEqual(r))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:Og(n.firestore._databaseId||s.databaseId,n._key.path)}}if(n instanceof Fa)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw a.Bu("VectorValues must only contain numeric values.");return kg(a.serializer,u)})}}}}}}(n,s);throw s.Bu(`Unsupported field value: ${ih(n)}`)}(i,e)}function wS(i,e){let t={};return qI(i)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ss(i,(n,s)=>{let r=As(s,e.Mu(n));r!=null&&(t[n]=r)}),{mapValue:{fields:t}}}function ES(i){return!(typeof i!="object"||i===null||i instanceof Array||i instanceof Date||i instanceof Me||i instanceof Es||i instanceof Pn||i instanceof be||i instanceof $n||i instanceof Fa)}function o_(i,e,t){if(!ES(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){let n=ih(t);throw n==="an object"?e.Bu(i+" a custom object"):e.Bu(i+" "+n)}}function vg(i,e,t){if((e=he(e))instanceof ln)return e._internalPath;if(typeof e=="string")return a_(i,e);throw Qc("Field path arguments must be of type string or ",i,!1,void 0,t)}var Tx=new RegExp("[~\\*/\\[\\]]");function a_(i,e,t){if(e.search(Tx)>=0)throw Qc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,i,!1,void 0,t);try{return new ln(...e.split("."))._internalPath}catch{throw Qc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,i,!1,void 0,t)}}function Qc(i,e,t,n,s){let r=n&&!n.isEmpty(),o=s!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(r||o)&&(u+=" (found",r&&(u+=` in field ${n}`),o&&(u+=` in document ${s}`),u+=")"),new k(x.INVALID_ARGUMENT,a+i+u)}function TS(i,e){return i.some(t=>t.isEqual(e))}var Ts=class{constructor(e,t,n,s,r){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=s,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new be(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new wg(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(rh("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},wg=class extends Ts{data(){return super.data()}};function rh(i,e){return typeof e=="string"?a_(i,e):e instanceof ln?e._internalPath:e._delegate._internalPath}function IS(i){if(i.limitType==="L"&&i.explicitOrderBy.length===0)throw new k(x.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Ba=class{},Is=class extends Ba{};function Jn(i,e,...t){let n=[];e instanceof Ba&&n.push(e),n=n.concat(t),function(r){let o=r.filter(u=>u instanceof Eg).length,a=r.filter(u=>u instanceof Wc).length;if(o>1||o>0&&a>0)throw new k(x.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(let s of n)i=s._apply(i);return i}var Wc=class i extends Is{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new i(e,t,n)}_apply(e){let t=this._parse(e);return kS(e._query,t),new lt(e.firestore,e.converter,Jm(e._query,t))}_parse(e){let t=bs(e.firestore);return function(r,o,a,u,c,d,f){let p;if(c.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new k(x.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){RI(f,d);let _=[];for(let E of f)_.push(CI(u,r,E));p={arrayValue:{values:_}}}else p=CI(u,r,f)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||RI(f,d),p=vS(a,o,f,d==="in"||d==="not-in");return de.create(c,d,p)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function SS(i,e,t){let n=e,s=rh("where",i);return Wc._create(s,n,t)}var Eg=class i extends Ba{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new i(e,t)}_parse(e){let t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return t.length===1?t[0]:we.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(s,r){let o=s,a=r.getFlattenedFilters();for(let u of a)kS(o,u),o=Jm(o,u)}(e._query,t),new lt(e.firestore,e.converter,Jm(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Tg=class i extends Is{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new i(e,t)}_apply(e){let t=function(s,r,o){if(s.startAt!==null)throw new k(x.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new k(x.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ps(r,o)}(e._query,this._field,this._direction);return new lt(e.firestore,e.converter,function(s,r){let o=s.explicitOrderBy.concat([r]);return new on(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}};function bS(i,e="asc"){let t=e,n=rh("orderBy",i);return Tg._create(n,t)}var $c=class i extends Is{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new i(e,t,n)}_apply(e){return new lt(e.firestore,e.converter,dc(e._query,this._limit,this._limitType))}};function AS(i){return iS("limit",i),$c._create("limit",i,"F")}function CS(i){return iS("limitToLast",i),$c._create("limitToLast",i,"L")}var Hc=class i extends Is{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new i(e,t,n)}_apply(e){let t=DS(e,this.type,this._docOrFields,this._inclusive);return new lt(e.firestore,e.converter,function(s,r){return new on(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,r,s.endAt)}(e._query,t))}};function RS(...i){return Hc._create("startAt",i,!0)}function PS(...i){return Hc._create("startAfter",i,!1)}var Yc=class i extends Is{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new i(e,t,n)}_apply(e){let t=DS(e,this.type,this._docOrFields,this._inclusive);return new lt(e.firestore,e.converter,function(s,r){return new on(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,r)}(e._query,t))}};function NS(...i){return Yc._create("endBefore",i,!1)}function xS(...i){return Yc._create("endAt",i,!0)}function DS(i,e,t,n){if(t[0]=he(t[0]),t[0]instanceof Ts)return function(r,o,a,u,c){if(!u)throw new k(x.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let d=[];for(let f of Tr(r))if(f.field.isKeyField())d.push(ms(o,u.key));else{let p=u.data.field(f.field);if(Xc(p))throw new k(x.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(p===null){let _=f.field.canonicalString();throw new k(x.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${_}' (used as the orderBy) does not exist.`)}d.push(p)}return new Cn(d,c)}(i._query,i.firestore._databaseId,e,t[0]._document,n);{let s=bs(i.firestore);return function(o,a,u,c,d,f){let p=o.explicitOrderBy;if(d.length>p.length)throw new k(x.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let _=[];for(let E=0;E<d.length;E++){let S=d[E];if(p[E].field.isKeyField()){if(typeof S!="string")throw new k(x.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof S}`);if(!xg(o)&&S.indexOf("/")!==-1)throw new k(x.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${S}' contains a slash.`);let R=o.path.child(me.fromString(S));if(!q.isDocumentKey(R))throw new k(x.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${R}' is not because it contains an odd number of segments.`);let V=new q(R);_.push(ms(a,V))}else{let R=vS(u,c,S);_.push(R)}}return new Cn(_,f)}(i._query,i.firestore._databaseId,s,e,t,n)}}function CI(i,e,t){if(typeof(t=he(t))=="string"){if(t==="")throw new k(x.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!xg(e)&&t.indexOf("/")!==-1)throw new k(x.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let n=e.path.child(me.fromString(t));if(!q.isDocumentKey(n))throw new k(x.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return ms(i,new q(n))}if(t instanceof be)return ms(i,t._key);throw new k(x.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ih(t)}.`)}function RI(i,e){if(!Array.isArray(i)||i.length===0)throw new k(x.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function kS(i,e){let t=function(s,r){for(let o of s)for(let a of o.getFlattenedFilters())if(r.indexOf(a.op)>=0)return a.op;return null}(i.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new k(x.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new k(x.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var Ur=class{convertValue(e,t="none"){switch(fs(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ke(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ri(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw j()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return Ss(e,(s,r)=>{n[s]=this.convertValue(r,t)}),n}convertVectorValue(e){var t,n,s;let r=(s=(n=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||n===void 0?void 0:n.values)===null||s===void 0?void 0:s.map(o=>ke(o.doubleValue));return new Fa(r)}convertGeoPoint(e){return new Es(ke(e.latitude),ke(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=Pg(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Ta(e));default:return null}}convertTimestamp(e){let t=Kn(e);return new Me(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=me.fromString(e);G(A0(n));let s=new Pi(n.get(1),n.get(3)),r=new q(n.popFirst(5));return s.isEqual(t)||je(`Document ${r} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}};function oh(i,e,t){let n;return n=i?t&&(t.merge||t.mergeFields)?i.toFirestore(e,t):i.toFirestore(e):e,n}var Ig=class extends Ur{constructor(e){super(),this.firestore=e}convertBytes(e){return new Pn(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new be(this.firestore,null,t)}};var Gn=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Yt=class extends Ts{constructor(e,t,n,s,r,o){super(e,t,n,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new bi(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(rh("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}},bi=class extends Yt{data(e={}){return super.data(e)}},un=class{constructor(e,t,n,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Gn(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new bi(this._firestore,this._userDataWriter,n.key,n,new Gn(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new k(x.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,r){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{let u=new bi(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Gn(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>r||a.type!==3).map(a=>{let u=new bi(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Gn(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter),c=-1,d=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:Ix(a.type),doc:u,oldIndex:c,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function Ix(i){switch(i){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return j()}}function l_(i,e){return i instanceof Yt&&e instanceof Yt?i._firestore===e._firestore&&i._key.isEqual(e._key)&&(i._document===null?e._document===null:i._document.isEqual(e._document))&&i._converter===e._converter:i instanceof un&&e instanceof un&&i._firestore===e._firestore&&i_(i.query,e.query)&&i.metadata.isEqual(e.metadata)&&i._snapshot.isEqual(e._snapshot)}function OS(i){i=ge(i,be);let e=ge(i.firestore,Ve);return eS(ut(e),i._key).then(t=>d_(e,i,t))}var Hn=class extends Ur{constructor(e){super(),this.firestore=e}convertBytes(e){return new Pn(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new be(this.firestore,null,t)}};function MS(i){i=ge(i,be);let e=ge(i.firestore,Ve),t=ut(e),n=new Hn(e);return gx(t,i._key).then(s=>new Yt(e,n,i._key,s,new Gn(s!==null&&s.hasLocalMutations,!0),i.converter))}function VS(i){i=ge(i,be);let e=ge(i.firestore,Ve);return eS(ut(e),i._key,{source:"server"}).then(t=>d_(e,i,t))}function FS(i){i=ge(i,lt);let e=ge(i.firestore,Ve),t=ut(e),n=new Hn(e);return IS(i._query),tS(t,i._query).then(s=>new un(e,n,i,s))}function LS(i){i=ge(i,lt);let e=ge(i.firestore,Ve),t=ut(e),n=new Hn(e);return _x(t,i._query).then(s=>new un(e,n,i,s))}function BS(i){i=ge(i,lt);let e=ge(i.firestore,Ve),t=ut(e),n=new Hn(e);return tS(t,i._query,{source:"server"}).then(s=>new un(e,n,i,s))}function u_(i,e,t){i=ge(i,be);let n=ge(i.firestore,Ve),s=oh(i.converter,e,t);return Wr(n,[sh(bs(n),"setDoc",i._key,s,i.converter!==null,t).toMutation(i._key,Ue.none())])}function c_(i,e,t,...n){i=ge(i,be);let s=ge(i.firestore,Ve),r=bs(s),o;return o=typeof(e=he(e))=="string"||e instanceof ln?r_(r,"updateDoc",i._key,e,t,n):s_(r,"updateDoc",i._key,e),Wr(s,[o.toMutation(i._key,Ue.exists(!0))])}function US(i){return Wr(ge(i.firestore,Ve),[new Oi(i._key,Ue.none())])}function qS(i,e){let t=ge(i.firestore,Ve),n=Qa(i),s=oh(i.converter,e);return Wr(t,[sh(bs(i.firestore),"addDoc",n._key,s,i.converter!==null,{}).toMutation(n._key,Ue.exists(!1))]).then(()=>n)}function h_(i,...e){var t,n,s;i=he(i);let r={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||hg(e[o])||(r=e[o],o++);let a={includeMetadataChanges:r.includeMetadataChanges,source:r.source};if(hg(e[o])){let f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(n=f.error)===null||n===void 0?void 0:n.bind(f),e[o+2]=(s=f.complete)===null||s===void 0?void 0:s.bind(f)}let u,c,d;if(i instanceof be)c=ge(i.firestore,Ve),d=jr(i._key.path),u={next:f=>{e[o]&&e[o](d_(c,i,f))},error:e[o+1],complete:e[o+2]};else{let f=ge(i,lt);c=ge(f.firestore,Ve),d=f._query;let p=new Hn(c);u={next:_=>{e[o]&&e[o](new un(c,p,f,_))},error:e[o+1],complete:e[o+2]},IS(i._query)}return function(p,_,E,S){let R=new Lr(S),V=new Va(_,R,E);return p.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return qg(yield Br(p),V)})),()=>{R.Za(),p.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return jg(yield Br(p),V)}))}}(ut(c),d,a,u)}function jS(i,e){return yx(ut(i=ge(i,Ve)),hg(e)?e:{next:e})}function Wr(i,e){return function(n,s){let r=new nt;return n.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return JN(yield Xg(n),s,r)})),r.promise}(ut(i),e)}function d_(i,e,t){let n=t.docs.get(e._key),s=new Hn(i);return new Yt(i,s,e._key,n,new Gn(t.hasPendingWrites,t.fromCache),e.converter)}var Sx={maxAttempts:5};var Jc=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=bs(e)}set(e,t,n){this._verifyNotCommitted();let s=Ii(e,this._firestore),r=oh(s.converter,t,n),o=sh(this._dataReader,"WriteBatch.set",s._key,r,s.converter!==null,n);return this._mutations.push(o.toMutation(s._key,Ue.none())),this}update(e,t,n,...s){this._verifyNotCommitted();let r=Ii(e,this._firestore),o;return o=typeof(t=he(t))=="string"||t instanceof ln?r_(this._dataReader,"WriteBatch.update",r._key,t,n,s):s_(this._dataReader,"WriteBatch.update",r._key,t),this._mutations.push(o.toMutation(r._key,Ue.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Ii(e,this._firestore);return this._mutations=this._mutations.concat(new Oi(t._key,Ue.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new k(x.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Ii(i,e){if((i=he(i)).firestore!==e)throw new k(x.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return i}var Sg=class extends class{constructor(t,n){this._firestore=t,this._transaction=n,this._dataReader=bs(t)}get(t){let n=Ii(t,this._firestore),s=new Ig(this._firestore);return this._transaction.lookup([n._key]).then(r=>{if(!r||r.length!==1)return j();let o=r[0];if(o.isFoundDocument())return new Ts(this._firestore,s,o.key,o,n.converter);if(o.isNoDocument())return new Ts(this._firestore,s,n._key,null,n.converter);throw j()})}set(t,n,s){let r=Ii(t,this._firestore),o=oh(r.converter,n,s),a=sh(this._dataReader,"Transaction.set",r._key,o,r.converter!==null,s);return this._transaction.set(r._key,a),this}update(t,n,s,...r){let o=Ii(t,this._firestore),a;return a=typeof(n=he(n))=="string"||n instanceof ln?r_(this._dataReader,"Transaction.update",o._key,n,s,r):s_(this._dataReader,"Transaction.update",o._key,n),this._transaction.update(o._key,a),this}delete(t){let n=Ii(t,this._firestore);return this._transaction.delete(n._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Ii(e,this._firestore),n=new Hn(this._firestore);return super.get(e).then(s=>new Yt(this._firestore,n,t._key,s._document,new Gn(!1,!1),t.converter))}};function zS(i,e,t){i=ge(i,Ve);let n=Object.assign(Object.assign({},Sx),t);return function(r){if(r.maxAttempts<1)throw new k(x.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(r,o,a){let u=new nt;return r.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){let c=yield fx(r);new ug(r.asyncQueue,c,a,o,u).au()})),u.promise}(ut(i),s=>e(new Sg(i,s)),n)}function GS(){return new La("deleteField")}function KS(){return new pg("serverTimestamp")}function QS(...i){return new gg("arrayUnion",i)}function WS(...i){return new _g("arrayRemove",i)}function $S(i){return new yg("increment",i)}(function(e,t=!0){(function(s){qr=s})(Ml),Ol(new mn("firestore",(n,{instanceIdentifier:s,options:r})=>{let o=n.getProvider("app").getImmediate(),a=new Ve(new Rm(n.getProvider("auth-internal")),new Dm(n.getProvider("app-check-internal")),function(c,d){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new k(x.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Pi(c.options.projectId,d)}(o,s),o);return r=Object.assign({useFetchStreams:t},r),a._setSettings(r),a},"PUBLIC").setMultipleInstances(!0)),Qs(AT,"4.7.3",e),Qs(AT,"4.7.3","esm2017")})();var bx="@firebase/firestore-compat",Ax="0.3.38";function y_(i,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new k("invalid-argument",`Invalid options passed to function ${i}(): You cannot specify both "merge" and "mergeFields".`);return e}function HS(){if(typeof Uint8Array>"u")throw new k("unimplemented","Uint8Arrays are not available in this environment.")}function YS(){if(!jI())throw new k("unimplemented","Blobs are unavailable in Firestore in this environment.")}var ah=class i{constructor(e){this._delegate=e}static fromBase64String(e){return YS(),new i(Pn.fromBase64String(e))}static fromUint8Array(e){return HS(),new i(Pn.fromUint8Array(e))}toBase64(){return YS(),this._delegate.toBase64()}toUint8Array(){return HS(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function f_(i){return Cx(i,["next","error","complete"])}function Cx(i,e){if(typeof i!="object"||i===null)return!1;let t=i;for(let n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}var m_=class{enableIndexedDbPersistence(e,t){return lS(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return uS(e._delegate)}clearIndexedDbPersistence(e){return hS(e._delegate)}},lh=class{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof Pi||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&rn("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,n={}){sS(this._delegate,e,t,n)}enableNetwork(){return fS(this._delegate)}disableNetwork(){return mS(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,e_("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return dS(this._delegate)}onSnapshotsInSync(e){return jS(this._delegate,e)}get app(){if(!this._appCompat)throw new k("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Yr(this,t_(this._delegate,e))}catch(t){throw At(t,"collection()","Firestore.collection()")}}doc(e){try{return new Nn(this,Qa(this._delegate,e))}catch(t){throw At(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Ns(this,rS(this._delegate,e))}catch(t){throw At(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return zS(this._delegate,t=>e(new uh(this,t)))}batch(){return ut(this._delegate),new ch(new Jc(this._delegate,e=>Wr(this._delegate,e)))}loadBundle(e){return pS(this._delegate,e)}namedQuery(e){return gS(this._delegate,e).then(t=>t?new Ns(this,t):null)}},$r=class extends Ur{constructor(e){super(),this.firestore=e}convertBytes(e){return new ah(new Pn(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return Nn.forKey(t,this.firestore,null)}};function Rx(i){PI(i)}var uh=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new $r(e)}get(e){let t=Cs(e);return this._delegate.get(t).then(n=>new Rs(this._firestore,new Yt(this._firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,t.converter)))}set(e,t,n){let s=Cs(e);return n?(y_("Transaction.set",n),this._delegate.set(s,t,n)):this._delegate.set(s,t),this}update(e,t,n,...s){let r=Cs(e);return arguments.length===2?this._delegate.update(r,t):this._delegate.update(r,t,n,...s),this}delete(e){let t=Cs(e);return this._delegate.delete(t),this}},ch=class{constructor(e){this._delegate=e}set(e,t,n){let s=Cs(e);return n?(y_("WriteBatch.set",n),this._delegate.set(s,t,n)):this._delegate.set(s,t),this}update(e,t,n,...s){let r=Cs(e);return arguments.length===2?this._delegate.update(r,t):this._delegate.update(r,t,n,...s),this}delete(e){let t=Cs(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},Hr=class i{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){let n=new bi(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Ps(this._firestore,n),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let n=i.INSTANCES,s=n.get(e);s||(s=new WeakMap,n.set(e,s));let r=s.get(t);return r||(r=new i(e,new $r(e),t),s.set(t,r)),r}};Hr.INSTANCES=new WeakMap;var Nn=class i{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new $r(e)}static forPath(e,t,n){if(e.length%2!==0)throw new k("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new i(t,new be(t._delegate,n,new q(e)))}static forKey(e,t,n){return new i(t,new be(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new Yr(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Yr(this.firestore,t_(this._delegate,e))}catch(t){throw At(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=he(e),e instanceof be?n_(this._delegate,e):!1}set(e,t){t=y_("DocumentReference.set",t);try{return t?u_(this._delegate,e,t):u_(this._delegate,e)}catch(n){throw At(n,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return arguments.length===1?c_(this._delegate,e):c_(this._delegate,e,t,...n)}catch(s){throw At(s,"updateDoc()","DocumentReference.update()")}}delete(){return US(this._delegate)}onSnapshot(...e){let t=JS(e),n=XS(e,s=>new Rs(this.firestore,new Yt(this.firestore._delegate,this._userDataWriter,s._key,s._document,s.metadata,this._delegate.converter)));return h_(this._delegate,t,n)}get(e){let t;return e?.source==="cache"?t=MS(this._delegate):e?.source==="server"?t=VS(this._delegate):t=OS(this._delegate),t.then(n=>new Rs(this.firestore,new Yt(this.firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,this._delegate.converter)))}withConverter(e){return new i(this.firestore,e?this._delegate.withConverter(Hr.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function At(i,e,t){return i.message=i.message.replace(e,t),i}function JS(i){for(let e of i)if(typeof e=="object"&&!f_(e))return e;return{}}function XS(i,e){var t,n;let s;return f_(i[0])?s=i[0]:f_(i[1])?s=i[1]:typeof i[0]=="function"?s={next:i[0],error:i[1],complete:i[2]}:s={next:i[1],error:i[2],complete:i[3]},{next:r=>{s.next&&s.next(e(r))},error:(t=s.error)===null||t===void 0?void 0:t.bind(s),complete:(n=s.complete)===null||n===void 0?void 0:n.bind(s)}}var Rs=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Nn(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return l_(this._delegate,e._delegate)}},Ps=class extends Rs{data(e){let t=this._delegate.data(e);return this._delegate._converter||NI(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},Ns=class i{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new $r(e)}where(e,t,n){try{return new i(this.firestore,Jn(this._delegate,SS(e,t,n)))}catch(s){throw At(s,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new i(this.firestore,Jn(this._delegate,bS(e,t)))}catch(n){throw At(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new i(this.firestore,Jn(this._delegate,AS(e)))}catch(t){throw At(t,"limit()","Query.limit()")}}limitToLast(e){try{return new i(this.firestore,Jn(this._delegate,CS(e)))}catch(t){throw At(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new i(this.firestore,Jn(this._delegate,RS(...e)))}catch(t){throw At(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new i(this.firestore,Jn(this._delegate,PS(...e)))}catch(t){throw At(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new i(this.firestore,Jn(this._delegate,NS(...e)))}catch(t){throw At(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new i(this.firestore,Jn(this._delegate,xS(...e)))}catch(t){throw At(t,"endAt()","Query.endAt()")}}isEqual(e){return i_(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=LS(this._delegate):e?.source==="server"?t=BS(this._delegate):t=FS(this._delegate),t.then(n=>new Wa(this.firestore,new un(this.firestore._delegate,this._userDataWriter,this._delegate,n._snapshot)))}onSnapshot(...e){let t=JS(e),n=XS(e,s=>new Wa(this.firestore,new un(this.firestore._delegate,this._userDataWriter,this._delegate,s._snapshot)));return h_(this._delegate,t,n)}withConverter(e){return new i(this.firestore,e?this._delegate.withConverter(Hr.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},p_=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Ps(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},Wa=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Ns(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Ps(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new p_(this._firestore,t))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new Ps(this._firestore,n))})}isEqual(e){return l_(this._delegate,e._delegate)}},Yr=class i extends Ns{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new Nn(this.firestore,e):null}doc(e){try{return e===void 0?new Nn(this.firestore,Qa(this._delegate)):new Nn(this.firestore,Qa(this._delegate,e))}catch(t){throw At(t,"doc()","CollectionReference.doc()")}}add(e){return qS(this._delegate,e).then(t=>new Nn(this.firestore,t))}isEqual(e){return n_(this._delegate,e._delegate)}withConverter(e){return new i(this.firestore,e?this._delegate.withConverter(Hr.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Cs(i){return ge(i,be)}var g_=class i{constructor(...e){this._delegate=new ln(...e)}static documentId(){return new i(ze.keyField().canonicalString())}isEqual(e){return e=he(e),e instanceof ln?this._delegate._internalPath.isEqual(e._internalPath):!1}};var __=class i{constructor(e){this._delegate=e}static serverTimestamp(){let e=KS();return e._methodName="FieldValue.serverTimestamp",new i(e)}static delete(){let e=GS();return e._methodName="FieldValue.delete",new i(e)}static arrayUnion(...e){let t=QS(...e);return t._methodName="FieldValue.arrayUnion",new i(t)}static arrayRemove(...e){let t=WS(...e);return t._methodName="FieldValue.arrayRemove",new i(t)}static increment(e){let t=$S(e);return t._methodName="FieldValue.increment",new i(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var Px={Firestore:lh,GeoPoint:Es,Timestamp:Me,Blob:ah,Transaction:uh,WriteBatch:ch,DocumentReference:Nn,DocumentSnapshot:Rs,Query:Ns,QueryDocumentSnapshot:Ps,QuerySnapshot:Wa,CollectionReference:Yr,FieldPath:g_,FieldValue:__,setLogLevel:Rx,CACHE_SIZE_UNLIMITED:oS};function Nx(i,e){i.INTERNAL.registerComponent(new mn("firestore-compat",t=>{let n=t.getProvider("app-compat").getImmediate(),s=t.getProvider("firestore").getImmediate();return e(n,s)},"PUBLIC").setServiceProps(Object.assign({},Px)))}function xx(i){Nx(i,(e,t)=>new lh(e,t,new m_)),i.registerVersion(bx,Ax)}xx(ui);function Dx(i,e=yl){return new _l(t=>{let n;return e!=null?e.schedule(()=>{n=i.onSnapshot({includeMetadataChanges:!0},t)}):n=i.onSnapshot({includeMetadataChanges:!0},t),()=>{n?.()}})}function ZS(i,e){return Dx(i,e)}function kx(i,e){return ZS(i,e).pipe(El(void 0),wl(),Qe(t=>{let[n,s]=t;return s.exists?n?.exists?{payload:s,type:"modified"}:{payload:s,type:"added"}:{payload:s,type:"removed"}}))}function E_(i,e){return ZS(i,e).pipe(Qe(t=>({payload:t,type:"query"})))}var hh=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let n=this.ref.collection(e),{ref:s,query:r}=sb(n,t);return new fh(s,r,this.afs)}snapshotChanges(){return kx(this.ref,this.afs.schedulers.outsideAngular).pipe(tt)}valueChanges(e={}){return this.snapshotChanges().pipe(Qe(({payload:t})=>e.idField?Zt(xe({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return _o(this.ref.get(e)).pipe(tt)}};function dh(i,e){return E_(i,e).pipe(El(void 0),wl(),Qe(t=>{let[n,s]=t,r=s.payload.docChanges(),o=r.map(a=>({type:a.type,payload:a}));return n&&JSON.stringify(n.payload.metadata)!==JSON.stringify(s.payload.metadata)&&s.payload.docs.forEach((a,u)=>{let c=r.find(f=>f.doc.ref.isEqual(a.ref)),d=n?.payload.docs.find(f=>f.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&d&&JSON.stringify(d.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:u,newIndex:u,type:"modified",doc:a}})}),o}))}function eb(i,e,t){return dh(i,t).pipe(Ki((n,s)=>Ox(n,s.map(r=>r.payload),e),[]),vl(),Qe(n=>n.map(s=>({type:s.type,payload:s}))))}function Ox(i,e,t){return e.forEach(n=>{t.indexOf(n.type)>-1&&(i=Mx(i,n))}),i}function v_(i,e,t,...n){let s=i.slice();return s.splice(e,t,...n),s}function Mx(i,e){switch(e.type){case"added":if(!(i[e.newIndex]&&i[e.newIndex].doc.ref.isEqual(e.doc.ref)))return v_(i,e.newIndex,0,e);break;case"modified":if(i[e.oldIndex]==null||i[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=i.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return v_(i,e.newIndex,1,e);break;case"removed":if(i[e.oldIndex]&&i[e.oldIndex].doc.ref.isEqual(e.doc.ref))return v_(i,e.oldIndex,1);break}return i}function tb(i){return(!i||i.length===0)&&(i=["added","removed","modified"]),i}var fh=class{ref;query;afs;constructor(e,t,n){this.ref=e,this.query=t,this.afs=n}stateChanges(e){let t=dh(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(Qe(n=>n.filter(s=>e.indexOf(s.type)>-1)))),t.pipe(El(void 0),wl(),ud(([n,s])=>s.length>0||!n),Qe(([,n])=>n),tt)}auditTrail(e){return this.stateChanges(e).pipe(Ki((t,n)=>[...t,...n],[]))}snapshotChanges(e){let t=tb(e);return eb(this.query,t,this.afs.schedulers.outsideAngular).pipe(tt)}valueChanges(e={}){return E_(this.query,this.afs.schedulers.outsideAngular).pipe(Qe(t=>t.payload.docs.map(n=>e.idField?Zt(xe({},n.data()),{[e.idField]:n.id}):n.data())),tt)}get(e){return _o(this.query.get(e)).pipe(tt)}add(e){return this.ref.add(e)}doc(e){return new hh(this.ref.doc(e),this.afs)}},w_=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?dh(this.query,this.afs.schedulers.outsideAngular).pipe(tt):dh(this.query,this.afs.schedulers.outsideAngular).pipe(Qe(t=>t.filter(n=>e.indexOf(n.type)>-1)),ud(t=>t.length>0),tt)}auditTrail(e){return this.stateChanges(e).pipe(Ki((t,n)=>[...t,...n],[]))}snapshotChanges(e){let t=tb(e);return eb(this.query,t,this.afs.schedulers.outsideAngular).pipe(tt)}valueChanges(e={}){return E_(this.query,this.afs.schedulers.outsideAngular).pipe(Qe(n=>n.payload.docs.map(s=>e.idField?xe({[e.idField]:s.id},s.data()):s.data())),tt)}get(e){return _o(this.query.get(e)).pipe(tt)}},nb=new hn("angularfire2.enableFirestorePersistence"),ib=new hn("angularfire2.firestore.persistenceSettings"),Vx=new hn("angularfire2.firestore.settings"),Fx=new hn("angularfire2.firestore.use-emulator");function sb(i,e=t=>t){return{query:e(i),ref:i}}var T_=(()=>{class i{schedulers;firestore;persistenceEnabled$;constructor(t,n,s,r,o,a,u,c,d,f,p,_,E,S,R,V,B){this.schedulers=u;let F=ql(t,a,n),K=d;f&&Hl(F,a,p,E,S,R,_,V),[this.firestore,this.persistenceEnabled$]=jl(`${F.name}.firestore`,"AngularFirestore",F.name,()=>{let ne=a.runOutsideAngular(()=>F.firestore());if(r&&ne.settings(r),K&&ne.useEmulator(...K),s&&!bv(o)){let H=()=>{try{return _o(ne.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(T){return typeof console<"u"&&console.warn(T),yo(!1)}};return[ne,a.runOutsideAngular(H)]}else return[ne,yo(!1)]},[r,K,s])}collection(t,n){let s;typeof t=="string"?s=this.firestore.collection(t):s=t;let{ref:r,query:o}=sb(s,n),a=this.schedulers.ngZone.run(()=>r);return new fh(a,o,this)}collectionGroup(t,n){let s=n||(o=>o),r=this.firestore.collectionGroup(t);return new w_(s(r),this)}doc(t){let n;typeof t=="string"?n=this.firestore.doc(t):n=t;let s=this.schedulers.ngZone.run(()=>n);return new hh(s,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(n){return new(n||i)(J(Bl),J(Ul,8),J(nb,8),J(Vx,8),J(Il),J(Fn),J(Ll),J(ib,8),J(Fx,8),J(Yl,8),J(zl,8),J(Gl,8),J(Kl,8),J(Ql,8),J(Wl,8),J($l,8),J(Fl,8))};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"any"})}return i})(),rb=(()=>{class i{constructor(){ui.registerVersion("angularfire",Vl.full,"fst-compat")}static enablePersistence(t){return{ngModule:i,providers:[{provide:nb,useValue:!0},{provide:ib,useValue:t}]}}static \u0275fac=function(n){return new(n||i)};static \u0275mod=js({type:i});static \u0275inj=qs({providers:[T_]})}return i})();var Bx=["*"];function Ux(i,e){if(i&1){let t=Wi();ee(0,"div",1)(1,"div",2)(2,"span",3)(3,"button",4),at("click",function(){oi(t);let s=We();return ai(s.onClose())}),ue(4,"\xD7"),X()(),Ev(5),X()()}}var mh=class i{showModal=!1;closeModal=new mv;onClose(){this.closeModal.emit()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=en({type:i,selectors:[["app-modal"]],inputs:{showModal:"showModal"},outputs:{closeModal:"closeModal"},standalone:!0,features:[tn],ngContentSelectors:Bx,decls:1,vars:1,consts:[["class","fixed inset-0 z-50 overflow-auto bg-gray-900/60 flex",4,"ngIf"],[1,"fixed","inset-0","z-50","overflow-auto","bg-gray-900/60","flex"],[1,"relative","p-8","bg-white","w-full","max-w-md","m-auto","flex-col","flex","rounded-lg"],[1,"absolute","top-0","right-0","p-4"],[1,"text-black",3,"click"]],template:function(t,n){t&1&&(wv(),ft(0,Ux,6,0,"div",0)),t&2&&Pe("ngIf",n.showModal)},dependencies:[Hi]})};var ph=class i{constructor(e){this.sanitizer=e}transform(e){return this.sanitizer.bypassSecurityTrustHtml(e)}static \u0275fac=function(t){return new(t||i)(Ze(Cl,16))};static \u0275pipe=hv({name:"safeHtml",type:i,pure:!0,standalone:!0})};var se=function(i){return i[i.State=0]="State",i[i.Transition=1]="Transition",i[i.Sequence=2]="Sequence",i[i.Group=3]="Group",i[i.Animate=4]="Animate",i[i.Keyframes=5]="Keyframes",i[i.Style=6]="Style",i[i.Trigger=7]="Trigger",i[i.Reference=8]="Reference",i[i.AnimateChild=9]="AnimateChild",i[i.AnimateRef=10]="AnimateRef",i[i.Query=11]="Query",i[i.Stagger=12]="Stagger",i}(se||{}),xn="*";function ob(i,e){return{type:se.Trigger,name:i,definitions:e,options:{}}}function S_(i,e=null){return{type:se.Animate,styles:e,timings:i}}function ab(i,e=null){return{type:se.Sequence,steps:i,options:e}}function xs(i){return{type:se.Style,styles:i,offset:null}}function gh(i,e,t){return{type:se.State,name:i,styles:e,options:t}}function b_(i,e,t=null){return{type:se.Transition,expr:i,animation:e,options:t}}var Bi=class{constructor(e=0,t=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=e+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){let t=e=="start"?this._onStartFns:this._onDoneFns;t.forEach(n=>n()),t.length=0}},$a=class{constructor(e){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=e;let t=0,n=0,s=0,r=this.players.length;r==0?queueMicrotask(()=>this._onFinish()):this.players.forEach(o=>{o.onDone(()=>{++t==r&&this._onFinish()}),o.onDestroy(()=>{++n==r&&this._onDestroy()}),o.onStart(()=>{++s==r&&this._onStart()})}),this.totalTime=this.players.reduce((o,a)=>Math.max(o,a.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){let t=e*this.totalTime;this.players.forEach(n=>{let s=n.totalTime?Math.min(1,t/n.totalTime):1;n.setPosition(s)})}getPosition(){let e=this.players.reduce((t,n)=>t===null||n.totalTime>t.totalTime?n:t,null);return e!=null?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){let t=e=="start"?this._onStartFns:this._onDoneFns;t.forEach(n=>n()),t.length=0}},_h="!";var lb=["toast-component",""];function jx(i,e){if(i&1){let t=Wi();ee(0,"button",5),at("click",function(){oi(t);let s=We();return ai(s.remove())}),ee(1,"span",6),ue(2,"\xD7"),X()()}}function zx(i,e){if(i&1&&(hd(0),ue(1),dd()),i&2){let t=We(2);ce(),dn("[",t.duplicatesCount+1,"]")}}function Gx(i,e){if(i&1&&(ee(0,"div"),ue(1),ft(2,zx,2,1,"ng-container",4),X()),i&2){let t=We();Ln(t.options.titleClass),Eo("aria-label",t.title),ce(),dn(" ",t.title," "),ce(),Pe("ngIf",t.duplicatesCount)}}function Kx(i,e){if(i&1&&Pt(0,"div",7),i&2){let t=We();Ln(t.options.messageClass),Pe("innerHTML",t.message,vo)}}function Qx(i,e){if(i&1&&(ee(0,"div",8),ue(1),X()),i&2){let t=We();Ln(t.options.messageClass),Eo("aria-label",t.message),ce(),dn(" ",t.message," ")}}function Wx(i,e){if(i&1&&(ee(0,"div"),Pt(1,"div",9),X()),i&2){let t=We();ce(),To("width",t.width()+"%")}}function $x(i,e){if(i&1){let t=Wi();ee(0,"button",5),at("click",function(){oi(t);let s=We();return ai(s.remove())}),ee(1,"span",6),ue(2,"\xD7"),X()()}}function Hx(i,e){if(i&1&&(hd(0),ue(1),dd()),i&2){let t=We(2);ce(),dn("[",t.duplicatesCount+1,"]")}}function Yx(i,e){if(i&1&&(ee(0,"div"),ue(1),ft(2,Hx,2,1,"ng-container",4),X()),i&2){let t=We();Ln(t.options.titleClass),Eo("aria-label",t.title),ce(),dn(" ",t.title," "),ce(),Pe("ngIf",t.duplicatesCount)}}function Jx(i,e){if(i&1&&Pt(0,"div",7),i&2){let t=We();Ln(t.options.messageClass),Pe("innerHTML",t.message,vo)}}function Xx(i,e){if(i&1&&(ee(0,"div",8),ue(1),X()),i&2){let t=We();Ln(t.options.messageClass),Eo("aria-label",t.message),ce(),dn(" ",t.message," ")}}function Zx(i,e){if(i&1&&(ee(0,"div"),Pt(1,"div",9),X()),i&2){let t=We();ce(),To("width",t.width()+"%")}}var A_=class{_attachedHost;component;viewContainerRef;injector;constructor(e,t){this.component=e,this.injector=t}attach(e,t){return this._attachedHost=e,e.attach(this,t)}detach(){let e=this._attachedHost;if(e)return this._attachedHost=void 0,e.detach()}get isAttached(){return this._attachedHost!=null}setAttachedHost(e){this._attachedHost=e}},C_=class{_attachedPortal;_disposeFn;attach(e,t){return this._attachedPortal=e,this.attachComponentPortal(e,t)}detach(){this._attachedPortal&&this._attachedPortal.setAttachedHost(),this._attachedPortal=void 0,this._disposeFn&&(this._disposeFn(),this._disposeFn=void 0)}setDisposeFn(e){this._disposeFn=e}},R_=class{_overlayRef;componentInstance;duplicatesCount=0;_afterClosed=new ri;_activate=new ri;_manualClose=new ri;_resetTimeout=new ri;_countDuplicate=new ri;constructor(e){this._overlayRef=e}manualClose(){this._manualClose.next(),this._manualClose.complete()}manualClosed(){return this._manualClose.asObservable()}timeoutReset(){return this._resetTimeout.asObservable()}countDuplicate(){return this._countDuplicate.asObservable()}close(){this._overlayRef.detach(),this._afterClosed.next(),this._manualClose.next(),this._afterClosed.complete(),this._manualClose.complete(),this._activate.complete(),this._resetTimeout.complete(),this._countDuplicate.complete()}afterClosed(){return this._afterClosed.asObservable()}isInactive(){return this._activate.isStopped}activate(){this._activate.next(),this._activate.complete()}afterActivate(){return this._activate.asObservable()}onDuplicate(e,t){e&&this._resetTimeout.next(),t&&this._countDuplicate.next(++this.duplicatesCount)}},Jr=class{toastId;config;message;title;toastType;toastRef;_onTap=new ri;_onAction=new ri;constructor(e,t,n,s,r,o){this.toastId=e,this.config=t,this.message=n,this.title=s,this.toastType=r,this.toastRef=o,this.toastRef.afterClosed().subscribe(()=>{this._onAction.complete(),this._onTap.complete()})}triggerTap(){this._onTap.next(),this.config.tapToDismiss&&this._onTap.complete()}onTap(){return this._onTap.asObservable()}triggerAction(e){this._onAction.next(e)}onAction(){return this._onAction.asObservable()}},ub={maxOpened:0,autoDismiss:!1,newestOnTop:!0,preventDuplicates:!1,countDuplicates:!1,resetTimeoutOnDuplicate:!1,includeTitleDuplicates:!1,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},closeButton:!1,disableTimeOut:!1,timeOut:5e3,extendedTimeOut:1e3,enableHtml:!1,progressBar:!1,toastClass:"ngx-toastr",positionClass:"toast-top-right",titleClass:"toast-title",messageClass:"toast-message",easing:"ease-in",easeTime:300,tapToDismiss:!0,onActivateTick:!1,progressAnimation:"decreasing"},cb=new hn("ToastConfig"),P_=class extends C_{_hostDomElement;_componentFactoryResolver;_appRef;constructor(e,t,n){super(),this._hostDomElement=e,this._componentFactoryResolver=t,this._appRef=n}attachComponentPortal(e,t){let n=this._componentFactoryResolver.resolveComponentFactory(e.component),s;return s=n.create(e.injector),this._appRef.attachView(s.hostView),this.setDisposeFn(()=>{this._appRef.detachView(s.hostView),s.destroy()}),t?this._hostDomElement.insertBefore(this._getComponentRootNode(s),this._hostDomElement.firstChild):this._hostDomElement.appendChild(this._getComponentRootNode(s)),s}_getComponentRootNode(e){return e.hostView.rootNodes[0]}},eD=(()=>{class i{_document=vt(So);_containerElement;ngOnDestroy(){this._containerElement&&this._containerElement.parentNode&&this._containerElement.parentNode.removeChild(this._containerElement)}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){let t=this._document.createElement("div");t.classList.add("overlay-container"),t.setAttribute("aria-live","polite"),this._document.body.appendChild(t),this._containerElement=t}static \u0275fac=function(n){return new(n||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),N_=class{_portalHost;constructor(e){this._portalHost=e}attach(e,t=!0){return this._portalHost.attach(e,t)}detach(){return this._portalHost.detach()}},tD=(()=>{class i{_overlayContainer=vt(eD);_componentFactoryResolver=vt(gv);_appRef=vt(bl);_document=vt(So);_paneElements=new Map;create(t,n){return this._createOverlayRef(this.getPaneElement(t,n))}getPaneElement(t="",n){return this._paneElements.get(n)||this._paneElements.set(n,{}),this._paneElements.get(n)[t]||(this._paneElements.get(n)[t]=this._createPaneElement(t,n)),this._paneElements.get(n)[t]}_createPaneElement(t,n){let s=this._document.createElement("div");return s.id="toast-container",s.classList.add(t),s.classList.add("toast-container"),n?n.getContainerElement().appendChild(s):this._overlayContainer.getContainerElement().appendChild(s),s}_createPortalHost(t){return new P_(t,this._componentFactoryResolver,this._appRef)}_createOverlayRef(t){return new N_(this._createPortalHost(t))}static \u0275fac=function(n){return new(n||i)};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),Xr=(()=>{class i{overlay;_injector;sanitizer;ngZone;toastrConfig;currentlyActive=0;toasts=[];overlayContainer;previousToastMessage;index=0;constructor(t,n,s,r,o){this.overlay=n,this._injector=s,this.sanitizer=r,this.ngZone=o,this.toastrConfig=xe(xe({},t.default),t.config),t.config.iconClasses&&(this.toastrConfig.iconClasses=xe(xe({},t.default.iconClasses),t.config.iconClasses))}show(t,n,s={},r=""){return this._preBuildNotification(r,t,n,this.applyConfig(s))}success(t,n,s={}){let r=this.toastrConfig.iconClasses.success||"";return this._preBuildNotification(r,t,n,this.applyConfig(s))}error(t,n,s={}){let r=this.toastrConfig.iconClasses.error||"";return this._preBuildNotification(r,t,n,this.applyConfig(s))}info(t,n,s={}){let r=this.toastrConfig.iconClasses.info||"";return this._preBuildNotification(r,t,n,this.applyConfig(s))}warning(t,n,s={}){let r=this.toastrConfig.iconClasses.warning||"";return this._preBuildNotification(r,t,n,this.applyConfig(s))}clear(t){for(let n of this.toasts)if(t!==void 0){if(n.toastId===t){n.toastRef.manualClose();return}}else n.toastRef.manualClose()}remove(t){let n=this._findToast(t);if(!n||(n.activeToast.toastRef.close(),this.toasts.splice(n.index,1),this.currentlyActive=this.currentlyActive-1,!this.toastrConfig.maxOpened||!this.toasts.length))return!1;if(this.currentlyActive<this.toastrConfig.maxOpened&&this.toasts[this.currentlyActive]){let s=this.toasts[this.currentlyActive].toastRef;s.isInactive()||(this.currentlyActive=this.currentlyActive+1,s.activate())}return!0}findDuplicate(t="",n="",s,r){let{includeTitleDuplicates:o}=this.toastrConfig;for(let a of this.toasts){let u=o&&a.title===t;if((!o||u)&&a.message===n)return a.toastRef.onDuplicate(s,r),a}return null}applyConfig(t={}){return xe(xe({},this.toastrConfig),t)}_findToast(t){for(let n=0;n<this.toasts.length;n++)if(this.toasts[n].toastId===t)return{index:n,activeToast:this.toasts[n]};return null}_preBuildNotification(t,n,s,r){return r.onActivateTick?this.ngZone.run(()=>this._buildNotification(t,n,s,r)):this._buildNotification(t,n,s,r)}_buildNotification(t,n,s,r){if(!r.toastComponent)throw new Error("toastComponent required");let o=this.findDuplicate(s,n,this.toastrConfig.resetTimeoutOnDuplicate&&r.timeOut>0,this.toastrConfig.countDuplicates);if((this.toastrConfig.includeTitleDuplicates&&s||n)&&this.toastrConfig.preventDuplicates&&o!==null)return o;this.previousToastMessage=n;let a=!1;this.toastrConfig.maxOpened&&this.currentlyActive>=this.toastrConfig.maxOpened&&(a=!0,this.toastrConfig.autoDismiss&&this.clear(this.toasts[0].toastId));let u=this.overlay.create(r.positionClass,this.overlayContainer);this.index=this.index+1;let c=n;n&&r.enableHtml&&(c=this.sanitizer.sanitize(pv.HTML,n));let d=new R_(u),f=new Jr(this.index,r,c,s,t,d),p=[{provide:Jr,useValue:f}],_=Tl.create({providers:p,parent:this._injector}),E=new A_(r.toastComponent,_),S=u.attach(E,r.newestOnTop);d.componentInstance=S.instance;let R={toastId:this.index,title:s||"",message:n||"",toastRef:d,onShown:d.afterActivate(),onHidden:d.afterClosed(),onTap:f.onTap(),onAction:f.onAction(),portal:S};return a||(this.currentlyActive=this.currentlyActive+1,setTimeout(()=>{R.toastRef.activate()})),this.toasts.push(R),R}static \u0275fac=function(n){return new(n||i)(J(cb),J(tD),J(Tl),J(Cl),J(Fn))};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),nD=(()=>{class i{toastrService;toastPackage;ngZone;message;title;options;duplicatesCount;originalTimeout;width=wo(-1);toastClasses="";state;get _state(){return this.state()}get displayStyle(){if(this.state().value==="inactive")return"none"}timeout;intervalId;hideTime;sub;sub1;sub2;sub3;constructor(t,n,s){this.toastrService=t,this.toastPackage=n,this.ngZone=s,this.message=n.message,this.title=n.title,this.options=n.config,this.originalTimeout=n.config.timeOut,this.toastClasses=`${n.toastType} ${n.config.toastClass}`,this.sub=n.toastRef.afterActivate().subscribe(()=>{this.activateToast()}),this.sub1=n.toastRef.manualClosed().subscribe(()=>{this.remove()}),this.sub2=n.toastRef.timeoutReset().subscribe(()=>{this.resetTimeout()}),this.sub3=n.toastRef.countDuplicate().subscribe(r=>{this.duplicatesCount=r}),this.state=wo({value:"inactive",params:{easeTime:this.toastPackage.config.easeTime,easing:"ease-in"}})}ngOnDestroy(){this.sub.unsubscribe(),this.sub1.unsubscribe(),this.sub2.unsubscribe(),this.sub3.unsubscribe(),clearInterval(this.intervalId),clearTimeout(this.timeout)}activateToast(){this.state.update(t=>Zt(xe({},t),{value:"active"})),!(this.options.disableTimeOut===!0||this.options.disableTimeOut==="timeOut")&&this.options.timeOut&&(this.outsideTimeout(()=>this.remove(),this.options.timeOut),this.hideTime=new Date().getTime()+this.options.timeOut,this.options.progressBar&&this.outsideInterval(()=>this.updateProgress(),10))}updateProgress(){if(this.width()===0||this.width()===100||!this.options.timeOut)return;let t=new Date().getTime(),n=this.hideTime-t;this.width.set(n/this.options.timeOut*100),this.options.progressAnimation==="increasing"&&this.width.update(s=>100-s),this.width()<=0&&this.width.set(0),this.width()>=100&&this.width.set(100)}resetTimeout(){clearTimeout(this.timeout),clearInterval(this.intervalId),this.state.update(t=>Zt(xe({},t),{value:"active"})),this.outsideTimeout(()=>this.remove(),this.originalTimeout),this.options.timeOut=this.originalTimeout,this.hideTime=new Date().getTime()+(this.options.timeOut||0),this.width.set(-1),this.options.progressBar&&this.outsideInterval(()=>this.updateProgress(),10)}remove(){this.state().value!=="removed"&&(clearTimeout(this.timeout),this.state.update(t=>Zt(xe({},t),{value:"removed"})),this.outsideTimeout(()=>this.toastrService.remove(this.toastPackage.toastId),+this.toastPackage.config.easeTime))}tapToast(){this.state().value!=="removed"&&(this.toastPackage.triggerTap(),this.options.tapToDismiss&&this.remove())}stickAround(){this.state().value!=="removed"&&this.options.disableTimeOut!=="extendedTimeOut"&&(clearTimeout(this.timeout),this.options.timeOut=0,this.hideTime=0,clearInterval(this.intervalId),this.width.set(0))}delayedHideToast(){this.options.disableTimeOut===!0||this.options.disableTimeOut==="extendedTimeOut"||this.options.extendedTimeOut===0||this.state().value==="removed"||(this.outsideTimeout(()=>this.remove(),this.options.extendedTimeOut),this.options.timeOut=this.options.extendedTimeOut,this.hideTime=new Date().getTime()+(this.options.timeOut||0),this.width.set(-1),this.options.progressBar&&this.outsideInterval(()=>this.updateProgress(),10))}outsideTimeout(t,n){this.ngZone?this.ngZone.runOutsideAngular(()=>this.timeout=setTimeout(()=>this.runInsideAngular(t),n)):this.timeout=setTimeout(()=>t(),n)}outsideInterval(t,n){this.ngZone?this.ngZone.runOutsideAngular(()=>this.intervalId=setInterval(()=>this.runInsideAngular(t),n)):this.intervalId=setInterval(()=>t(),n)}runInsideAngular(t){this.ngZone?this.ngZone.run(()=>t()):t()}static \u0275fac=function(n){return new(n||i)(Ze(Xr),Ze(Jr),Ze(Fn))};static \u0275cmp=en({type:i,selectors:[["","toast-component",""]],hostVars:5,hostBindings:function(n,s){n&1&&at("click",function(){return s.tapToast()})("mouseenter",function(){return s.stickAround()})("mouseleave",function(){return s.delayedHideToast()}),n&2&&(vv("@flyInOut",s._state),Ln(s.toastClasses),To("display",s.displayStyle))},standalone:!0,features:[tn],attrs:lb,decls:5,vars:5,consts:[["type","button","class","toast-close-button","aria-label","Close",3,"click",4,"ngIf"],[3,"class",4,"ngIf"],["role","alert",3,"class","innerHTML",4,"ngIf"],["role","alert",3,"class",4,"ngIf"],[4,"ngIf"],["type","button","aria-label","Close",1,"toast-close-button",3,"click"],["aria-hidden","true"],["role","alert",3,"innerHTML"],["role","alert"],[1,"toast-progress"]],template:function(n,s){n&1&&ft(0,jx,3,0,"button",0)(1,Gx,3,5,"div",1)(2,Kx,1,3,"div",2)(3,Qx,2,4,"div",3)(4,Wx,2,2,"div",4),n&2&&(Pe("ngIf",s.options.closeButton),ce(),Pe("ngIf",s.title),ce(),Pe("ngIf",s.message&&s.options.enableHtml),ce(),Pe("ngIf",s.message&&!s.options.enableHtml),ce(),Pe("ngIf",s.options.progressBar))},dependencies:[Hi],encapsulation:2,data:{animation:[ob("flyInOut",[gh("inactive",xs({opacity:0})),gh("active",xs({opacity:1})),gh("removed",xs({opacity:0})),b_("inactive => active",S_("{{ easeTime }}ms {{ easing }}")),b_("active => removed",S_("{{ easeTime }}ms {{ easing }}"))])]},changeDetection:0})}return i})(),iD=Zt(xe({},ub),{toastComponent:nD}),hb=(i={})=>dv([{provide:cb,useValue:{default:iD,config:i}}]);var sD=(()=>{class i{toastrService;toastPackage;appRef;message;title;options;duplicatesCount;originalTimeout;width=wo(-1);toastClasses="";get displayStyle(){return this.state()==="inactive"?"none":null}state=wo("inactive");timeout;intervalId;hideTime;sub;sub1;sub2;sub3;constructor(t,n,s){this.toastrService=t,this.toastPackage=n,this.appRef=s,this.message=n.message,this.title=n.title,this.options=n.config,this.originalTimeout=n.config.timeOut,this.toastClasses=`${n.toastType} ${n.config.toastClass}`,this.sub=n.toastRef.afterActivate().subscribe(()=>{this.activateToast()}),this.sub1=n.toastRef.manualClosed().subscribe(()=>{this.remove()}),this.sub2=n.toastRef.timeoutReset().subscribe(()=>{this.resetTimeout()}),this.sub3=n.toastRef.countDuplicate().subscribe(r=>{this.duplicatesCount=r})}ngOnDestroy(){this.sub.unsubscribe(),this.sub1.unsubscribe(),this.sub2.unsubscribe(),this.sub3.unsubscribe(),clearInterval(this.intervalId),clearTimeout(this.timeout)}activateToast(){this.state.set("active"),!(this.options.disableTimeOut===!0||this.options.disableTimeOut==="timeOut")&&this.options.timeOut&&(this.timeout=setTimeout(()=>{this.remove()},this.options.timeOut),this.hideTime=new Date().getTime()+this.options.timeOut,this.options.progressBar&&(this.intervalId=setInterval(()=>this.updateProgress(),10))),this.options.onActivateTick&&this.appRef.tick()}updateProgress(){if(this.width()===0||this.width()===100||!this.options.timeOut)return;let t=new Date().getTime(),n=this.hideTime-t;this.width.set(n/this.options.timeOut*100),this.options.progressAnimation==="increasing"&&this.width.update(s=>100-s),this.width()<=0&&this.width.set(0),this.width()>=100&&this.width.set(100)}resetTimeout(){clearTimeout(this.timeout),clearInterval(this.intervalId),this.state.set("active"),this.options.timeOut=this.originalTimeout,this.timeout=setTimeout(()=>this.remove(),this.originalTimeout),this.hideTime=new Date().getTime()+(this.originalTimeout||0),this.width.set(-1),this.options.progressBar&&(this.intervalId=setInterval(()=>this.updateProgress(),10))}remove(){this.state()!=="removed"&&(clearTimeout(this.timeout),this.state.set("removed"),this.timeout=setTimeout(()=>this.toastrService.remove(this.toastPackage.toastId)))}tapToast(){this.state()!=="removed"&&(this.toastPackage.triggerTap(),this.options.tapToDismiss&&this.remove())}stickAround(){this.state()!=="removed"&&(clearTimeout(this.timeout),this.options.timeOut=0,this.hideTime=0,clearInterval(this.intervalId),this.width.set(0))}delayedHideToast(){this.options.disableTimeOut===!0||this.options.disableTimeOut==="extendedTimeOut"||this.options.extendedTimeOut===0||this.state()==="removed"||(this.timeout=setTimeout(()=>this.remove(),this.options.extendedTimeOut),this.options.timeOut=this.options.extendedTimeOut,this.hideTime=new Date().getTime()+(this.options.timeOut||0),this.width.set(-1),this.options.progressBar&&(this.intervalId=setInterval(()=>this.updateProgress(),10)))}static \u0275fac=function(n){return new(n||i)(Ze(Xr),Ze(Jr),Ze(bl))};static \u0275cmp=en({type:i,selectors:[["","toast-component",""]],hostVars:4,hostBindings:function(n,s){n&1&&at("click",function(){return s.tapToast()})("mouseenter",function(){return s.stickAround()})("mouseleave",function(){return s.delayedHideToast()}),n&2&&(Ln(s.toastClasses),To("display",s.displayStyle))},standalone:!0,features:[tn],attrs:lb,decls:5,vars:5,consts:[["type","button","class","toast-close-button","aria-label","Close",3,"click",4,"ngIf"],[3,"class",4,"ngIf"],["role","alert",3,"class","innerHTML",4,"ngIf"],["role","alert",3,"class",4,"ngIf"],[4,"ngIf"],["type","button","aria-label","Close",1,"toast-close-button",3,"click"],["aria-hidden","true"],["role","alert",3,"innerHTML"],["role","alert"],[1,"toast-progress"]],template:function(n,s){n&1&&ft(0,$x,3,0,"button",0)(1,Yx,3,5,"div",1)(2,Jx,1,3,"div",2)(3,Xx,2,4,"div",3)(4,Zx,2,2,"div",4),n&2&&(Pe("ngIf",s.options.closeButton),ce(),Pe("ngIf",s.title),ce(),Pe("ngIf",s.message&&s.options.enableHtml),ce(),Pe("ngIf",s.message&&!s.options.enableHtml),ce(),Pe("ngIf",s.options.progressBar))},dependencies:[Hi],encapsulation:2,changeDetection:0})}return i})(),IO=Zt(xe({},ub),{toastComponent:sD});var Zr=class i{constructor(e,t){this.afs=e;this.toastr=t}getAllExpenses(){return this.afs.collection("expenses").snapshotChanges().pipe(Qe(e=>e.map(t=>{let n=t.payload.doc.data(),s=t.payload.doc.id;return n.key=s,xe({},n)})))}getExpense(e){return this.afs.collection("expenses").doc(e).valueChanges()}addExpense(e){this.afs.collection("expenses").add(e).catch(t=>{this.toastr.error(t.message,"An error occurred",{timeOut:1e4,positionClass:"toast-top-right",closeButton:!0,progressBar:!0})})}updateExpense(e,t){this.afs.collection("expenses").doc(e).update(t).catch(n=>{this.toastr.error(n.message,"An error occurred",{timeOut:1e4,positionClass:"toast-top-right",closeButton:!0,progressBar:!0})})}deleteExpense(e){this.afs.doc("expenses/"+e).delete().catch(t=>{this.toastr.error(t.message,"An error occurred",{timeOut:1e4,positionClass:"toast-top-right",closeButton:!0,progressBar:!0})})}static \u0275fac=function(t){return new(t||i)(J(T_),J(Xr))};static \u0275prov=Rt({token:i,factory:i.\u0275fac,providedIn:"root"})};function aD(i,e){i&1&&(ee(0,"div",4),ue(1,"Unauthorised! Please login to add/update items."),X())}function lD(i,e){if(i&1){let t=Wi();ee(0,"div",8)(1,"div",9)(2,"div",10)(3,"div",11)(4,"h5",12),ue(5),X(),ee(6,"h2",13),ue(7),$i(8,"number"),X(),Pt(9,"p",14),$i(10,"safeHtml"),ee(11,"div",15)(12,"button",16),at("click",function(){let s=oi(t).$implicit,r=We();return ai(r.editExpense(s.key))}),ue(13,"Edit"),X(),ee(14,"button",17),at("click",function(){let s=oi(t).$implicit,r=We();return ai(r.deleteExpense(s.key))}),ue(15,"Remove"),X()()()()()()}if(i&2){let t=e.$implicit;ce(5),Sl(t.title),ce(2),dn("\xA3",fd(8,3,t.price,"1.2-2"),""),ce(2),Pe("innerHTML",Io(10,6,t.description),vo)}}var yh=class i{constructor(e,t){this.expenseService=e;this.router=t;this.items=this.getAllDocuments(),this.isLoggedIn.subscribe(n=>{this.authorised=n}),this.items.subscribe(n=>{this.totalPrice=0,n.forEach(s=>{this.totalPrice+=Number(s.price)})})}items;totalPrice=0;isLoggedIn=vt(Bn).isLoggedIn();authorised;authService=vt(Bn);unauthorised=!1;isLoginFormModelOpen=!1;getAllDocuments(){return this.expenseService.getAllExpenses()}editExpense(e){this.router.navigate(["/expense-form/"+e])}deleteExpense(e){this.authorised?this.expenseService.deleteExpense(e):this.unauthorised=!0}addExpense(){this.authorised?this.router.navigate(["/expense-form"]):this.unauthorised=!0}ngOnInit(){}ngOnDestroy(){}static \u0275fac=function(t){return new(t||i)(Ze(Zr),Ze(Rl))};static \u0275cmp=en({type:i,selectors:[["app-expense"]],standalone:!0,features:[tn],decls:13,vars:9,consts:[[1,"mb-4","d-flex","justify-content-between","align-items-center"],["type","button","routerLink","/expense-form",1,"btn","btn-primary",3,"click"],[1,"fw-bold","align-items-center"],[1,"text-success"],[1,"form-text","text-danger","fw-bold"],["class","mt-4",4,"ngFor","ngForOf"],[3,"closeModal","showModal"],[3,"formSubmit"],[1,"mt-4"],[1,"d-flex","flex-column","gap-3"],[1,"card"],[1,"card-body"],[1,"card-title"],[1,"fw-bold","text-success"],[1,"card-text",3,"innerHTML"],[1,"d-flex","gap-2"],[1,"btn","btn-sm","btn-success",3,"click"],[1,"btn","btn-sm","btn-danger",3,"click"]],template:function(t,n){t&1&&(ee(0,"div",0)(1,"button",1),at("click",function(){return n.addExpense()}),ue(2,"Add Expense"),X(),ee(3,"h5",2),ue(4,"Total Expenses: "),ee(5,"strong",3),ue(6),$i(7,"number"),X()()(),ft(8,aD,2,0,"div",4)(9,lD,16,8,"div",5),$i(10,"async"),ee(11,"app-modal",6),at("closeModal",function(){return n.isLoginFormModelOpen=!1}),ee(12,"app-login-form",7),at("formSubmit",function(){return n.isLoginFormModelOpen=!1}),X()()),t&2&&(ce(6),dn("\xA3",fd(7,4,n.totalPrice,"1.2-2"),""),ce(2),Qi(n.unauthorised?8:-1),ce(),Pe("ngForOf",Io(10,7,n.items)),ce(2),Pe("showModal",n.isLoginFormModelOpen))},dependencies:[zs,Iv,Al,Sv,Pl,Nv,mh,ew,ph]})};function mb(i){return e=>i.test(e.value)?{forbiddenName:{value:e.value}}:null}function uD(i,e){i&1&&(ee(0,"div",6),ue(1,"Title is a required field"),X())}function cD(i,e){i&1&&(ee(0,"div",6),ue(1,"Price is a required field"),X())}function hD(i,e){i&1&&(ee(0,"div",6),ue(1,"Contains an illegal name"),X())}function dD(i,e){i&1&&(ee(0,"div",6),ue(1,"Unauthorised! Please login to add/update items."),X())}var Ha=class i{constructor(e,t,n,s){this.fb=e;this.afs=t;this.activatedRoute=n;this.router=s;this.expenseForm=this.fb.group({price:new Jl("",[vd.required]),title:new Jl("",[vd.required]),description:new Jl("",[mb(/craig/i)])})}expenseForm;expenseId;isLoggedIn=vt(Bn).isLoggedIn();authorised;authService=vt(Bn);unauthorised=!1;ngOnInit(){this.isLoggedIn.subscribe(e=>{this.authorised=e}),this.activatedRoute.params.subscribe({next:e=>this.expenseId=e.id}),this.getExpense(this.expenseId)}getExpense(e){this.afs.getExpense(e).subscribe(t=>{this.expenseForm.patchValue(t)})}addExpense(){this.authorised?(this.afs.addExpense(this.expenseForm.value),this.router.navigate(["./"])):this.unauthorised=!0}updateExpense(){this.expenseForm.valid&&this.authorised?(this.activatedRoute.params.subscribe({next:e=>e.id?this.afs.updateExpense(e.id,this.expenseForm.value):this.afs.addExpense(this.expenseForm.value)}),this.router.navigate(["./"])):(this.expenseForm.markAllAsTouched(),this.expenseForm.hasError,this.unauthorised=!0)}static \u0275fac=function(t){return new(t||i)(Ze(Xv),Ze(Zr),Ze(Rv),Ze(Rl))};static \u0275cmp=en({type:i,selectors:[["app-expense-form"]],standalone:!0,features:[tn],decls:23,vars:5,consts:[[1,"row"],[1,"col-lg-6"],[3,"formGroup"],[1,"mb-3"],["for","title",1,"form-label"],["type","text","id","title","placeholder","Title","formControlName","title",1,"form-control"],[1,"form-text","text-danger","fw-bold"],["for","price",1,"form-label"],["type","number","id","price","placeholder","Price","formControlName","price",1,"form-control"],["for","description",1,"form-label"],["type","password","id","description","formControlName","description",1,"form-control"],["type","submit",1,"btn","btn-success",3,"click"]],template:function(t,n){if(t&1&&(ee(0,"div",0)(1,"div",1)(2,"h4"),ue(3,"Expense Form"),X(),ee(4,"form",2)(5,"div",3)(6,"label",4),ue(7,"Title"),X(),Pt(8,"input",5),ft(9,uD,2,0,"div",6),X(),ee(10,"div",3)(11,"label",7),ue(12,"Price"),X(),Pt(13,"input",8),ft(14,cD,2,0,"div",6),X(),ee(15,"div",3)(16,"label",9),ue(17,"Description"),X(),Pt(18,"textarea",10),ft(19,hD,2,0,"div",6),X(),ee(20,"button",11),at("click",function(r){return r.preventDefault(),n.updateExpense()}),ue(21,"Save Changes"),X()(),ft(22,dD,2,0,"div",6),X()()),t&2){let s,r,o;ce(4),Pe("formGroup",n.expenseForm),ce(5),Qi((s=n.expenseForm.get("title"))!=null&&s.hasError("required")&&((s=n.expenseForm.get("title"))!=null&&s.touched)?9:-1),ce(5),Qi((r=n.expenseForm.get("price"))!=null&&r.hasError("required")&&((r=n.expenseForm.get("price"))!=null&&r.touched)?14:-1),ce(5),Qi((o=n.expenseForm.get("description"))!=null&&o.hasError("forbiddenName")&&((o=n.expenseForm.get("description"))!=null&&o.touched)?19:-1),ce(3),Qi(n.unauthorised?22:-1)}},dependencies:[zs,Zv,$v,Kv,Hv,Qv,Wv,Yv,Jv,Pl]})};var pb=[{path:"",component:yh},{path:"expense-form",component:Ha},{path:"expense-form/:id",component:Ha},{path:"login",loadComponent:()=>import("./chunk-PUDQLY2T.js").then(i=>i.LoginComponent)},{path:"signup",loadComponent:()=>import("./chunk-LOK6Q25Q.js").then(i=>i.SignupComponent)},{path:"reset",loadComponent:()=>import("./chunk-5VCEQ3W4.js").then(i=>i.ResetComponent)}];function gb(i){return new pe(3e3,!1)}function fD(){return new pe(3100,!1)}function mD(){return new pe(3101,!1)}function pD(i){return new pe(3001,!1)}function gD(i){return new pe(3003,!1)}function _D(i){return new pe(3004,!1)}function yD(i,e){return new pe(3005,!1)}function vD(){return new pe(3006,!1)}function wD(){return new pe(3007,!1)}function ED(i,e){return new pe(3008,!1)}function TD(i){return new pe(3002,!1)}function ID(i,e,t,n,s){return new pe(3010,!1)}function SD(){return new pe(3011,!1)}function bD(){return new pe(3012,!1)}function AD(){return new pe(3200,!1)}function CD(){return new pe(3202,!1)}function RD(){return new pe(3013,!1)}function PD(i){return new pe(3014,!1)}function ND(i){return new pe(3015,!1)}function xD(i){return new pe(3016,!1)}function DD(i,e){return new pe(3404,!1)}function kD(i){return new pe(3502,!1)}function OD(i){return new pe(3503,!1)}function MD(){return new pe(3300,!1)}function VD(i){return new pe(3504,!1)}function FD(i){return new pe(3301,!1)}function LD(i,e){return new pe(3302,!1)}function BD(i){return new pe(3303,!1)}function UD(i,e){return new pe(3400,!1)}function qD(i){return new pe(3401,!1)}function jD(i){return new pe(3402,!1)}function zD(i,e){return new pe(3505,!1)}function Ui(i){switch(i.length){case 0:return new Bi;case 1:return i[0];default:return new $a(i)}}function Nb(i,e,t=new Map,n=new Map){let s=[],r=[],o=-1,a=null;if(e.forEach(u=>{let c=u.get("offset"),d=c==o,f=d&&a||new Map;u.forEach((p,_)=>{let E=_,S=p;if(_!=="offset")switch(E=i.normalizePropertyName(E,s),S){case _h:S=t.get(_);break;case xn:S=n.get(_);break;default:S=i.normalizeStyleValue(_,E,S,s);break}f.set(E,S)}),d||r.push(f),a=f,o=c}),s.length)throw kD(s);return r}function Z_(i,e,t,n){switch(e){case"start":i.onStart(()=>n(t&&x_(t,"start",i)));break;case"done":i.onDone(()=>n(t&&x_(t,"done",i)));break;case"destroy":i.onDestroy(()=>n(t&&x_(t,"destroy",i)));break}}function x_(i,e,t){let n=t.totalTime,s=!!t.disabled,r=ey(i.element,i.triggerName,i.fromState,i.toState,e||i.phaseName,n??i.totalTime,s),o=i._data;return o!=null&&(r._data=o),r}function ey(i,e,t,n,s="",r=0,o){return{element:i,triggerName:e,fromState:t,toState:n,phaseName:s,totalTime:r,disabled:!!o}}function Ut(i,e,t){let n=i.get(e);return n||i.set(e,n=t),n}function _b(i){let e=i.indexOf(":"),t=i.substring(1,e),n=i.slice(e+1);return[t,n]}var GD=typeof document>"u"?null:document.documentElement;function ty(i){let e=i.parentNode||i.host||null;return e===GD?null:e}function KD(i){return i.substring(1,6)=="ebkit"}var Ds=null,yb=!1;function QD(i){Ds||(Ds=WD()||{},yb=Ds.style?"WebkitAppearance"in Ds.style:!1);let e=!0;return Ds.style&&!KD(i)&&(e=i in Ds.style,!e&&yb&&(e="Webkit"+i.charAt(0).toUpperCase()+i.slice(1)in Ds.style)),e}function WD(){return typeof document<"u"?document.body:null}function xb(i,e){for(;e;){if(e===i)return!0;e=ty(e)}return!1}function Db(i,e,t){if(t)return Array.from(i.querySelectorAll(e));let n=i.querySelector(e);return n?[n]:[]}var ny=(()=>{class i{validateStyleProperty(t){return QD(t)}containsElement(t,n){return xb(t,n)}getParentElement(t){return ty(t)}query(t,n,s){return Db(t,n,s)}computeStyle(t,n,s){return s||""}animate(t,n,s,r,o,a=[],u){return new Bi(s,r)}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=Rt({token:i,factory:i.\u0275fac})}}return i})(),Ms=class{static{this.NOOP=new ny}},Vs=class{};var $D=1e3,kb="{{",HD="}}",Ob="ng-enter",F_="ng-leave",vh="ng-trigger",Sh=".ng-trigger",vb="ng-animating",L_=".ng-animating";function Xn(i){if(typeof i=="number")return i;let e=i.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:B_(parseFloat(e[1]),e[2])}function B_(i,e){switch(e){case"s":return i*$D;default:return i}}function bh(i,e,t){return i.hasOwnProperty("duration")?i:YD(i,e,t)}function YD(i,e,t){let n=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i,s,r=0,o="";if(typeof i=="string"){let a=i.match(n);if(a===null)return e.push(gb(i)),{duration:0,delay:0,easing:""};s=B_(parseFloat(a[1]),a[2]);let u=a[3];u!=null&&(r=B_(parseFloat(u),a[4]));let c=a[5];c&&(o=c)}else s=i;if(!t){let a=!1,u=e.length;s<0&&(e.push(fD()),a=!0),r<0&&(e.push(mD()),a=!0),a&&e.splice(u,0,gb(i))}return{duration:s,delay:r,easing:o}}function JD(i){return i.length?i[0]instanceof Map?i:i.map(e=>new Map(Object.entries(e))):[]}function Dn(i,e,t){e.forEach((n,s)=>{let r=iy(s);t&&!t.has(s)&&t.set(s,i.style[r]),i.style[r]=n})}function Os(i,e){e.forEach((t,n)=>{let s=iy(n);i.style[s]=""})}function Ya(i){return Array.isArray(i)?i.length==1?i[0]:ab(i):i}function XD(i,e,t){let n=e.params||{},s=Mb(i);s.length&&s.forEach(r=>{n.hasOwnProperty(r)||t.push(pD(r))})}var U_=new RegExp(`${kb}\\s*(.+?)\\s*${HD}`,"g");function Mb(i){let e=[];if(typeof i=="string"){let t;for(;t=U_.exec(i);)e.push(t[1]);U_.lastIndex=0}return e}function Xa(i,e,t){let n=`${i}`,s=n.replace(U_,(r,o)=>{let a=e[o];return a==null&&(t.push(gD(o)),a=""),a.toString()});return s==n?i:s}var ZD=/-+([a-z0-9])/g;function iy(i){return i.replace(ZD,(...e)=>e[1].toUpperCase())}function e1(i,e){return i===0||e===0}function t1(i,e,t){if(t.size&&e.length){let n=e[0],s=[];if(t.forEach((r,o)=>{n.has(o)||s.push(o),n.set(o,r)}),s.length)for(let r=1;r<e.length;r++){let o=e[r];s.forEach(a=>o.set(a,sy(i,a)))}}return e}function Bt(i,e,t){switch(e.type){case se.Trigger:return i.visitTrigger(e,t);case se.State:return i.visitState(e,t);case se.Transition:return i.visitTransition(e,t);case se.Sequence:return i.visitSequence(e,t);case se.Group:return i.visitGroup(e,t);case se.Animate:return i.visitAnimate(e,t);case se.Keyframes:return i.visitKeyframes(e,t);case se.Style:return i.visitStyle(e,t);case se.Reference:return i.visitReference(e,t);case se.AnimateChild:return i.visitAnimateChild(e,t);case se.AnimateRef:return i.visitAnimateRef(e,t);case se.Query:return i.visitQuery(e,t);case se.Stagger:return i.visitStagger(e,t);default:throw _D(e.type)}}function sy(i,e){return window.getComputedStyle(i)[e]}var n1=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]),Ah=class extends Vs{normalizePropertyName(e,t){return iy(e)}normalizeStyleValue(e,t,n,s){let r="",o=n.toString().trim();if(n1.has(t)&&n!==0&&n!=="0")if(typeof n=="number")r="px";else{let a=n.match(/^[+-]?[\d\.]+([a-z]*)$/);a&&a[1].length==0&&s.push(yD(e,n))}return o+r}};var Ch="*";function i1(i,e){let t=[];return typeof i=="string"?i.split(/\s*,\s*/).forEach(n=>s1(n,t,e)):t.push(i),t}function s1(i,e,t){if(i[0]==":"){let u=r1(i,t);if(typeof u=="function"){e.push(u);return}i=u}let n=i.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(n==null||n.length<4)return t.push(ND(i)),e;let s=n[1],r=n[2],o=n[3];e.push(wb(s,o));let a=s==Ch&&o==Ch;r[0]=="<"&&!a&&e.push(wb(o,s))}function r1(i,e){switch(i){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,n)=>parseFloat(n)>parseFloat(t);case":decrement":return(t,n)=>parseFloat(n)<parseFloat(t);default:return e.push(xD(i)),"* => *"}}var wh=new Set(["true","1"]),Eh=new Set(["false","0"]);function wb(i,e){let t=wh.has(i)||Eh.has(i),n=wh.has(e)||Eh.has(e);return(s,r)=>{let o=i==Ch||i==s,a=e==Ch||e==r;return!o&&t&&typeof s=="boolean"&&(o=s?wh.has(i):Eh.has(i)),!a&&n&&typeof r=="boolean"&&(a=r?wh.has(e):Eh.has(e)),o&&a}}var Vb=":self",o1=new RegExp(`s*${Vb}s*,?`,"g");function Fb(i,e,t,n){return new q_(i).build(e,t,n)}var Eb="",q_=class{constructor(e){this._driver=e}build(e,t,n){let s=new j_(t);return this._resetContextStyleTimingState(s),Bt(this,Ya(e),s)}_resetContextStyleTimingState(e){e.currentQuerySelector=Eb,e.collectedStyles=new Map,e.collectedStyles.set(Eb,new Map),e.currentTime=0}visitTrigger(e,t){let n=t.queryCount=0,s=t.depCount=0,r=[],o=[];return e.name.charAt(0)=="@"&&t.errors.push(vD()),e.definitions.forEach(a=>{if(this._resetContextStyleTimingState(t),a.type==se.State){let u=a,c=u.name;c.toString().split(/\s*,\s*/).forEach(d=>{u.name=d,r.push(this.visitState(u,t))}),u.name=c}else if(a.type==se.Transition){let u=this.visitTransition(a,t);n+=u.queryCount,s+=u.depCount,o.push(u)}else t.errors.push(wD())}),{type:se.Trigger,name:e.name,states:r,transitions:o,queryCount:n,depCount:s,options:null}}visitState(e,t){let n=this.visitStyle(e.styles,t),s=e.options&&e.options.params||null;if(n.containsDynamicStyles){let r=new Set,o=s||{};n.styles.forEach(a=>{a instanceof Map&&a.forEach(u=>{Mb(u).forEach(c=>{o.hasOwnProperty(c)||r.add(c)})})}),r.size&&t.errors.push(ED(e.name,[...r.values()]))}return{type:se.State,name:e.name,style:n,options:s?{params:s}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;let n=Bt(this,Ya(e.animation),t),s=i1(e.expr,t.errors);return{type:se.Transition,matchers:s,animation:n,queryCount:t.queryCount,depCount:t.depCount,options:ks(e.options)}}visitSequence(e,t){return{type:se.Sequence,steps:e.steps.map(n=>Bt(this,n,t)),options:ks(e.options)}}visitGroup(e,t){let n=t.currentTime,s=0,r=e.steps.map(o=>{t.currentTime=n;let a=Bt(this,o,t);return s=Math.max(s,t.currentTime),a});return t.currentTime=s,{type:se.Group,steps:r,options:ks(e.options)}}visitAnimate(e,t){let n=c1(e.timings,t.errors);t.currentAnimateTimings=n;let s,r=e.styles?e.styles:xs({});if(r.type==se.Keyframes)s=this.visitKeyframes(r,t);else{let o=e.styles,a=!1;if(!o){a=!0;let c={};n.easing&&(c.easing=n.easing),o=xs(c)}t.currentTime+=n.duration+n.delay;let u=this.visitStyle(o,t);u.isEmptyStep=a,s=u}return t.currentAnimateTimings=null,{type:se.Animate,timings:n,style:s,options:null}}visitStyle(e,t){let n=this._makeStyleAst(e,t);return this._validateStyleAst(n,t),n}_makeStyleAst(e,t){let n=[],s=Array.isArray(e.styles)?e.styles:[e.styles];for(let a of s)typeof a=="string"?a===xn?n.push(a):t.errors.push(TD(a)):n.push(new Map(Object.entries(a)));let r=!1,o=null;return n.forEach(a=>{if(a instanceof Map&&(a.has("easing")&&(o=a.get("easing"),a.delete("easing")),!r)){for(let u of a.values())if(u.toString().indexOf(kb)>=0){r=!0;break}}}),{type:se.Style,styles:n,easing:o,offset:e.offset,containsDynamicStyles:r,options:null}}_validateStyleAst(e,t){let n=t.currentAnimateTimings,s=t.currentTime,r=t.currentTime;n&&r>0&&(r-=n.duration+n.delay),e.styles.forEach(o=>{typeof o!="string"&&o.forEach((a,u)=>{let c=t.collectedStyles.get(t.currentQuerySelector),d=c.get(u),f=!0;d&&(r!=s&&r>=d.startTime&&s<=d.endTime&&(t.errors.push(ID(u,d.startTime,d.endTime,r,s)),f=!1),r=d.startTime),f&&c.set(u,{startTime:r,endTime:s}),t.options&&XD(a,t.options,t.errors)})})}visitKeyframes(e,t){let n={type:se.Keyframes,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push(SD()),n;let s=1,r=0,o=[],a=!1,u=!1,c=0,d=e.steps.map(V=>{let B=this._makeStyleAst(V,t),F=B.offset!=null?B.offset:u1(B.styles),K=0;return F!=null&&(r++,K=B.offset=F),u=u||K<0||K>1,a=a||K<c,c=K,o.push(K),B});u&&t.errors.push(bD()),a&&t.errors.push(AD());let f=e.steps.length,p=0;r>0&&r<f?t.errors.push(CD()):r==0&&(p=s/(f-1));let _=f-1,E=t.currentTime,S=t.currentAnimateTimings,R=S.duration;return d.forEach((V,B)=>{let F=p>0?B==_?1:p*B:o[B],K=F*R;t.currentTime=E+S.delay+K,S.duration=K,this._validateStyleAst(V,t),V.offset=F,n.styles.push(V)}),n}visitReference(e,t){return{type:se.Reference,animation:Bt(this,Ya(e.animation),t),options:ks(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:se.AnimateChild,options:ks(e.options)}}visitAnimateRef(e,t){return{type:se.AnimateRef,animation:this.visitReference(e.animation,t),options:ks(e.options)}}visitQuery(e,t){let n=t.currentQuerySelector,s=e.options||{};t.queryCount++,t.currentQuery=e;let[r,o]=a1(e.selector);t.currentQuerySelector=n.length?n+" "+r:r,Ut(t.collectedStyles,t.currentQuerySelector,new Map);let a=Bt(this,Ya(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=n,{type:se.Query,selector:r,limit:s.limit||0,optional:!!s.optional,includeSelf:o,animation:a,originalSelector:e.selector,options:ks(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push(RD());let n=e.timings==="full"?{duration:0,delay:0,easing:"full"}:bh(e.timings,t.errors,!0);return{type:se.Stagger,animation:Bt(this,Ya(e.animation),t),timings:n,options:null}}};function a1(i){let e=!!i.split(/\s*,\s*/).find(t=>t==Vb);return e&&(i=i.replace(o1,"")),i=i.replace(/@\*/g,Sh).replace(/@\w+/g,t=>Sh+"-"+t.slice(1)).replace(/:animating/g,L_),[i,e]}function l1(i){return i?xe({},i):null}var j_=class{constructor(e){this.errors=e,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}};function u1(i){if(typeof i=="string")return null;let e=null;if(Array.isArray(i))i.forEach(t=>{if(t instanceof Map&&t.has("offset")){let n=t;e=parseFloat(n.get("offset")),n.delete("offset")}});else if(i instanceof Map&&i.has("offset")){let t=i;e=parseFloat(t.get("offset")),t.delete("offset")}return e}function c1(i,e){if(i.hasOwnProperty("duration"))return i;if(typeof i=="number"){let r=bh(i,e).duration;return D_(r,0,"")}let t=i;if(t.split(/\s+/).some(r=>r.charAt(0)=="{"&&r.charAt(1)=="{")){let r=D_(0,0,"");return r.dynamic=!0,r.strValue=t,r}let s=bh(t,e);return D_(s.duration,s.delay,s.easing)}function ks(i){return i?(i=xe({},i),i.params&&(i.params=l1(i.params))):i={},i}function D_(i,e,t){return{duration:i,delay:e,easing:t}}function ry(i,e,t,n,s,r,o=null,a=!1){return{type:1,element:i,keyframes:e,preStyleProps:t,postStyleProps:n,duration:s,delay:r,totalTime:s+r,easing:o,subTimeline:a}}var Za=class{constructor(){this._map=new Map}get(e){return this._map.get(e)||[]}append(e,t){let n=this._map.get(e);n||this._map.set(e,n=[]),n.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}},h1=1,d1=":enter",f1=new RegExp(d1,"g"),m1=":leave",p1=new RegExp(m1,"g");function Lb(i,e,t,n,s,r=new Map,o=new Map,a,u,c=[]){return new z_().buildKeyframes(i,e,t,n,s,r,o,a,u,c)}var z_=class{buildKeyframes(e,t,n,s,r,o,a,u,c,d=[]){c=c||new Za;let f=new G_(e,t,c,s,r,d,[]);f.options=u;let p=u.delay?Xn(u.delay):0;f.currentTimeline.delayNextStep(p),f.currentTimeline.setStyles([o],null,f.errors,u),Bt(this,n,f);let _=f.timelines.filter(E=>E.containsAnimation());if(_.length&&a.size){let E;for(let S=_.length-1;S>=0;S--){let R=_[S];if(R.element===t){E=R;break}}E&&!E.allowOnlyTimelineStyles()&&E.setStyles([a],null,f.errors,u)}return _.length?_.map(E=>E.buildKeyframes()):[ry(t,[],[],[],0,p,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){let n=t.subInstructions.get(t.element);if(n){let s=t.createSubContext(e.options),r=t.currentTimeline.currentTime,o=this._visitSubInstructions(n,s,s.options);r!=o&&t.transformIntoNewTimeline(o)}t.previousNode=e}visitAnimateRef(e,t){let n=t.createSubContext(e.options);n.transformIntoNewTimeline(),this._applyAnimationRefDelays([e.options,e.animation.options],t,n),this.visitReference(e.animation,n),t.transformIntoNewTimeline(n.currentTimeline.currentTime),t.previousNode=e}_applyAnimationRefDelays(e,t,n){for(let s of e){let r=s?.delay;if(r){let o=typeof r=="number"?r:Xn(Xa(r,s?.params??{},t.errors));n.delayNextStep(o)}}}_visitSubInstructions(e,t,n){let r=t.currentTimeline.currentTime,o=n.duration!=null?Xn(n.duration):null,a=n.delay!=null?Xn(n.delay):null;return o!==0&&e.forEach(u=>{let c=t.appendInstructionToTimeline(u,o,a);r=Math.max(r,c.duration+c.delay)}),r}visitReference(e,t){t.updateOptions(e.options,!0),Bt(this,e.animation,t),t.previousNode=e}visitSequence(e,t){let n=t.subContextCount,s=t,r=e.options;if(r&&(r.params||r.delay)&&(s=t.createSubContext(r),s.transformIntoNewTimeline(),r.delay!=null)){s.previousNode.type==se.Style&&(s.currentTimeline.snapshotCurrentStyles(),s.previousNode=Rh);let o=Xn(r.delay);s.delayNextStep(o)}e.steps.length&&(e.steps.forEach(o=>Bt(this,o,s)),s.currentTimeline.applyStylesToKeyframe(),s.subContextCount>n&&s.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){let n=[],s=t.currentTimeline.currentTime,r=e.options&&e.options.delay?Xn(e.options.delay):0;e.steps.forEach(o=>{let a=t.createSubContext(e.options);r&&a.delayNextStep(r),Bt(this,o,a),s=Math.max(s,a.currentTimeline.currentTime),n.push(a.currentTimeline)}),n.forEach(o=>t.currentTimeline.mergeTimelineCollectedStyles(o)),t.transformIntoNewTimeline(s),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){let n=e.strValue,s=t.params?Xa(n,t.params,t.errors):n;return bh(s,t.errors)}else return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){let n=t.currentAnimateTimings=this._visitTiming(e.timings,t),s=t.currentTimeline;n.delay&&(t.incrementTime(n.delay),s.snapshotCurrentStyles());let r=e.style;r.type==se.Keyframes?this.visitKeyframes(r,t):(t.incrementTime(n.duration),this.visitStyle(r,t),s.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){let n=t.currentTimeline,s=t.currentAnimateTimings;!s&&n.hasCurrentStyleProperties()&&n.forwardFrame();let r=s&&s.easing||e.easing;e.isEmptyStep?n.applyEmptyStep(r):n.setStyles(e.styles,r,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){let n=t.currentAnimateTimings,s=t.currentTimeline.duration,r=n.duration,a=t.createSubContext().currentTimeline;a.easing=n.easing,e.styles.forEach(u=>{let c=u.offset||0;a.forwardTime(c*r),a.setStyles(u.styles,u.easing,t.errors,t.options),a.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(a),t.transformIntoNewTimeline(s+r),t.previousNode=e}visitQuery(e,t){let n=t.currentTimeline.currentTime,s=e.options||{},r=s.delay?Xn(s.delay):0;r&&(t.previousNode.type===se.Style||n==0&&t.currentTimeline.hasCurrentStyleProperties())&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=Rh);let o=n,a=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!s.optional,t.errors);t.currentQueryTotal=a.length;let u=null;a.forEach((c,d)=>{t.currentQueryIndex=d;let f=t.createSubContext(e.options,c);r&&f.delayNextStep(r),c===t.element&&(u=f.currentTimeline),Bt(this,e.animation,f),f.currentTimeline.applyStylesToKeyframe();let p=f.currentTimeline.currentTime;o=Math.max(o,p)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(o),u&&(t.currentTimeline.mergeTimelineCollectedStyles(u),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){let n=t.parentContext,s=t.currentTimeline,r=e.timings,o=Math.abs(r.duration),a=o*(t.currentQueryTotal-1),u=o*t.currentQueryIndex;switch(r.duration<0?"reverse":r.easing){case"reverse":u=a-u;break;case"full":u=n.currentStaggerTime;break}let d=t.currentTimeline;u&&d.delayNextStep(u);let f=d.currentTime;Bt(this,e.animation,t),t.previousNode=e,n.currentStaggerTime=s.currentTime-f+(s.startTime-n.currentTimeline.startTime)}},Rh={},G_=class i{constructor(e,t,n,s,r,o,a,u){this._driver=e,this.element=t,this.subInstructions=n,this._enterClassName=s,this._leaveClassName=r,this.errors=o,this.timelines=a,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=Rh,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=u||new Ph(this._driver,t,0),a.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;let n=e,s=this.options;n.duration!=null&&(s.duration=Xn(n.duration)),n.delay!=null&&(s.delay=Xn(n.delay));let r=n.params;if(r){let o=s.params;o||(o=this.options.params={}),Object.keys(r).forEach(a=>{(!t||!o.hasOwnProperty(a))&&(o[a]=Xa(r[a],o,this.errors))})}}_copyOptions(){let e={};if(this.options){let t=this.options.params;if(t){let n=e.params={};Object.keys(t).forEach(s=>{n[s]=t[s]})}}return e}createSubContext(e=null,t,n){let s=t||this.element,r=new i(this._driver,s,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(s,n||0));return r.previousNode=this.previousNode,r.currentAnimateTimings=this.currentAnimateTimings,r.options=this._copyOptions(),r.updateOptions(e),r.currentQueryIndex=this.currentQueryIndex,r.currentQueryTotal=this.currentQueryTotal,r.parentContext=this,this.subContextCount++,r}transformIntoNewTimeline(e){return this.previousNode=Rh,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,n){let s={duration:t??e.duration,delay:this.currentTimeline.currentTime+(n??0)+e.delay,easing:""},r=new K_(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,s,e.stretchStartingKeyframe);return this.timelines.push(r),s}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,n,s,r,o){let a=[];if(s&&a.push(this.element),e.length>0){e=e.replace(f1,"."+this._enterClassName),e=e.replace(p1,"."+this._leaveClassName);let u=n!=1,c=this._driver.query(this.element,e,u);n!==0&&(c=n<0?c.slice(c.length+n,c.length):c.slice(0,n)),a.push(...c)}return!r&&a.length==0&&o.push(PD(t)),a}},Ph=class i{constructor(e,t,n,s){this._driver=e,this.element=t,this.startTime=n,this._elementTimelineStylesLookup=s,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(e){let t=this._keyframes.size===1&&this._pendingStyles.size;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new i(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=h1,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles.set(e,t),this._globalTimelineStyles.set(e,t),this._styleSummary.set(e,{time:this.currentTime,value:t})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&this._previousKeyframe.set("easing",e);for(let[t,n]of this._globalTimelineStyles)this._backFill.set(t,n||xn),this._currentKeyframe.set(t,xn);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,n,s){t&&this._previousKeyframe.set("easing",t);let r=s&&s.params||{},o=g1(e,this._globalTimelineStyles);for(let[a,u]of o){let c=Xa(u,r,n);this._pendingStyles.set(a,c),this._localTimelineStyles.has(a)||this._backFill.set(a,this._globalTimelineStyles.get(a)??xn),this._updateStyle(a,c)}}applyStylesToKeyframe(){this._pendingStyles.size!=0&&(this._pendingStyles.forEach((e,t)=>{this._currentKeyframe.set(t,e)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((e,t)=>{this._currentKeyframe.has(t)||this._currentKeyframe.set(t,e)}))}snapshotCurrentStyles(){for(let[e,t]of this._localTimelineStyles)this._pendingStyles.set(e,t),this._updateStyle(e,t)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){let e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){e._styleSummary.forEach((t,n)=>{let s=this._styleSummary.get(n);(!s||t.time>s.time)&&this._updateStyle(n,t.value)})}buildKeyframes(){this.applyStylesToKeyframe();let e=new Set,t=new Set,n=this._keyframes.size===1&&this.duration===0,s=[];this._keyframes.forEach((a,u)=>{let c=new Map([...this._backFill,...a]);c.forEach((d,f)=>{d===_h?e.add(f):d===xn&&t.add(f)}),n||c.set("offset",u/this.duration),s.push(c)});let r=[...e.values()],o=[...t.values()];if(n){let a=s[0],u=new Map(a);a.set("offset",0),u.set("offset",1),s=[a,u]}return ry(this.element,s,r,o,this.duration,this.startTime,this.easing,!1)}},K_=class extends Ph{constructor(e,t,n,s,r,o,a=!1){super(e,t,o.delay),this.keyframes=n,this.preStyleProps=s,this.postStyleProps=r,this._stretchStartingKeyframe=a,this.timings={duration:o.duration,delay:o.delay,easing:o.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:n,easing:s}=this.timings;if(this._stretchStartingKeyframe&&t){let r=[],o=n+t,a=t/o,u=new Map(e[0]);u.set("offset",0),r.push(u);let c=new Map(e[0]);c.set("offset",Tb(a)),r.push(c);let d=e.length-1;for(let f=1;f<=d;f++){let p=new Map(e[f]),_=p.get("offset"),E=t+_*n;p.set("offset",Tb(E/o)),r.push(p)}n=o,t=0,s="",e=r}return ry(this.element,e,this.preStyleProps,this.postStyleProps,n,t,s,!0)}};function Tb(i,e=3){let t=Math.pow(10,e-1);return Math.round(i*t)/t}function g1(i,e){let t=new Map,n;return i.forEach(s=>{if(s==="*"){n??=e.keys();for(let r of n)t.set(r,xn)}else for(let[r,o]of s)t.set(r,o)}),t}function Ib(i,e,t,n,s,r,o,a,u,c,d,f,p){return{type:0,element:i,triggerName:e,isRemovalTransition:s,fromState:t,fromStyles:r,toState:n,toStyles:o,timelines:a,queriedElements:u,preStyleProps:c,postStyleProps:d,totalTime:f,errors:p}}var k_={},Nh=class{constructor(e,t,n){this._triggerName=e,this.ast=t,this._stateStyles=n}match(e,t,n,s){return _1(this.ast.matchers,e,t,n,s)}buildStyles(e,t,n){let s=this._stateStyles.get("*");return e!==void 0&&(s=this._stateStyles.get(e?.toString())||s),s?s.buildStyles(t,n):new Map}build(e,t,n,s,r,o,a,u,c,d){let f=[],p=this.ast.options&&this.ast.options.params||k_,_=a&&a.params||k_,E=this.buildStyles(n,_,f),S=u&&u.params||k_,R=this.buildStyles(s,S,f),V=new Set,B=new Map,F=new Map,K=s==="void",ne={params:Bb(S,p),delay:this.ast.options?.delay},H=d?[]:Lb(e,t,this.ast.animation,r,o,E,R,ne,c,f),T=0;return H.forEach(y=>{T=Math.max(y.duration+y.delay,T)}),f.length?Ib(t,this._triggerName,n,s,K,E,R,[],[],B,F,T,f):(H.forEach(y=>{let w=y.element,I=Ut(B,w,new Set);y.preStyleProps.forEach(C=>I.add(C));let b=Ut(F,w,new Set);y.postStyleProps.forEach(C=>b.add(C)),w!==t&&V.add(w)}),Ib(t,this._triggerName,n,s,K,E,R,H,[...V.values()],B,F,T))}};function _1(i,e,t,n,s){return i.some(r=>r(e,t,n,s))}function Bb(i,e){let t=xe({},e);return Object.entries(i).forEach(([n,s])=>{s!=null&&(t[n]=s)}),t}var Q_=class{constructor(e,t,n){this.styles=e,this.defaultParams=t,this.normalizer=n}buildStyles(e,t){let n=new Map,s=Bb(e,this.defaultParams);return this.styles.styles.forEach(r=>{typeof r!="string"&&r.forEach((o,a)=>{o&&(o=Xa(o,s,t));let u=this.normalizer.normalizePropertyName(a,t);o=this.normalizer.normalizeStyleValue(a,u,o,t),n.set(a,o)})}),n}};function y1(i,e,t){return new W_(i,e,t)}var W_=class{constructor(e,t,n){this.name=e,this.ast=t,this._normalizer=n,this.transitionFactories=[],this.states=new Map,t.states.forEach(s=>{let r=s.options&&s.options.params||{};this.states.set(s.name,new Q_(s.style,r,n))}),Sb(this.states,"true","1"),Sb(this.states,"false","0"),t.transitions.forEach(s=>{this.transitionFactories.push(new Nh(e,s,this.states))}),this.fallbackTransition=v1(e,this.states,this._normalizer)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,n,s){return this.transitionFactories.find(o=>o.match(e,t,n,s))||null}matchStyles(e,t,n){return this.fallbackTransition.buildStyles(e,t,n)}};function v1(i,e,t){let n=[(o,a)=>!0],s={type:se.Sequence,steps:[],options:null},r={type:se.Transition,animation:s,matchers:n,options:null,queryCount:0,depCount:0};return new Nh(i,r,e)}function Sb(i,e,t){i.has(e)?i.has(t)||i.set(t,i.get(e)):i.has(t)&&i.set(e,i.get(t))}var w1=new Za,$_=class{constructor(e,t,n){this.bodyNode=e,this._driver=t,this._normalizer=n,this._animations=new Map,this._playersById=new Map,this.players=[]}register(e,t){let n=[],s=[],r=Fb(this._driver,t,n,s);if(n.length)throw OD(n);s.length&&void 0,this._animations.set(e,r)}_buildPlayer(e,t,n){let s=e.element,r=Nb(this._normalizer,e.keyframes,t,n);return this._driver.animate(s,r,e.duration,e.delay,e.easing,[],!0)}create(e,t,n={}){let s=[],r=this._animations.get(e),o,a=new Map;if(r?(o=Lb(this._driver,t,r,Ob,F_,new Map,new Map,n,w1,s),o.forEach(d=>{let f=Ut(a,d.element,new Map);d.postStyleProps.forEach(p=>f.set(p,null))})):(s.push(MD()),o=[]),s.length)throw VD(s);a.forEach((d,f)=>{d.forEach((p,_)=>{d.set(_,this._driver.computeStyle(f,_,xn))})});let u=o.map(d=>{let f=a.get(d.element);return this._buildPlayer(d,new Map,f)}),c=Ui(u);return this._playersById.set(e,c),c.onDestroy(()=>this.destroy(e)),this.players.push(c),c}destroy(e){let t=this._getPlayer(e);t.destroy(),this._playersById.delete(e);let n=this.players.indexOf(t);n>=0&&this.players.splice(n,1)}_getPlayer(e){let t=this._playersById.get(e);if(!t)throw FD(e);return t}listen(e,t,n,s){let r=ey(t,"","","");return Z_(this._getPlayer(e),n,r,s),()=>{}}command(e,t,n,s){if(n=="register"){this.register(e,s[0]);return}if(n=="create"){let o=s[0]||{};this.create(e,t,o);return}let r=this._getPlayer(e);switch(n){case"play":r.play();break;case"pause":r.pause();break;case"reset":r.reset();break;case"restart":r.restart();break;case"finish":r.finish();break;case"init":r.init();break;case"setPosition":r.setPosition(parseFloat(s[0]));break;case"destroy":this.destroy(e);break}}},bb="ng-animate-queued",E1=".ng-animate-queued",O_="ng-animate-disabled",T1=".ng-animate-disabled",I1="ng-star-inserted",S1=".ng-star-inserted",b1=[],Ub={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},A1={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},cn="__ng_removed",el=class{get params(){return this.options.params}constructor(e,t=""){this.namespaceId=t;let n=e&&e.hasOwnProperty("value"),s=n?e.value:e;if(this.value=R1(s),n){let r=e,{value:o}=r,a=ov(r,["value"]);this.options=a}else this.options={};this.options.params||(this.options.params={})}absorbOptions(e){let t=e.params;if(t){let n=this.options.params;Object.keys(t).forEach(s=>{n[s]==null&&(n[s]=t[s])})}}},Ja="void",M_=new el(Ja),H_=class{constructor(e,t,n){this.id=e,this.hostElement=t,this._engine=n,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+e,Jt(t,this._hostClassName)}listen(e,t,n,s){if(!this._triggers.has(t))throw LD(n,t);if(n==null||n.length==0)throw BD(t);if(!P1(n))throw UD(n,t);let r=Ut(this._elementListeners,e,[]),o={name:t,phase:n,callback:s};r.push(o);let a=Ut(this._engine.statesByElement,e,new Map);return a.has(t)||(Jt(e,vh),Jt(e,vh+"-"+t),a.set(t,M_)),()=>{this._engine.afterFlush(()=>{let u=r.indexOf(o);u>=0&&r.splice(u,1),this._triggers.has(t)||a.delete(t)})}}register(e,t){return this._triggers.has(e)?!1:(this._triggers.set(e,t),!0)}_getTrigger(e){let t=this._triggers.get(e);if(!t)throw qD(e);return t}trigger(e,t,n,s=!0){let r=this._getTrigger(t),o=new tl(this.id,t,e),a=this._engine.statesByElement.get(e);a||(Jt(e,vh),Jt(e,vh+"-"+t),this._engine.statesByElement.set(e,a=new Map));let u=a.get(t),c=new el(n,this.id);if(!(n&&n.hasOwnProperty("value"))&&u&&c.absorbOptions(u.options),a.set(t,c),u||(u=M_),!(c.value===Ja)&&u.value===c.value){if(!D1(u.params,c.params)){let S=[],R=r.matchStyles(u.value,u.params,S),V=r.matchStyles(c.value,c.params,S);S.length?this._engine.reportError(S):this._engine.afterFlush(()=>{Os(e,R),Dn(e,V)})}return}let p=Ut(this._engine.playersByElement,e,[]);p.forEach(S=>{S.namespaceId==this.id&&S.triggerName==t&&S.queued&&S.destroy()});let _=r.matchTransition(u.value,c.value,e,c.params),E=!1;if(!_){if(!s)return;_=r.fallbackTransition,E=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:_,fromState:u,toState:c,player:o,isFallbackTransition:E}),E||(Jt(e,bb),o.onStart(()=>{eo(e,bb)})),o.onDone(()=>{let S=this.players.indexOf(o);S>=0&&this.players.splice(S,1);let R=this._engine.playersByElement.get(e);if(R){let V=R.indexOf(o);V>=0&&R.splice(V,1)}}),this.players.push(o),p.push(o),o}deregister(e){this._triggers.delete(e),this._engine.statesByElement.forEach(t=>t.delete(e)),this._elementListeners.forEach((t,n)=>{this._elementListeners.set(n,t.filter(s=>s.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);let t=this._engine.playersByElement.get(e);t&&(t.forEach(n=>n.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){let n=this._engine.driver.query(e,Sh,!0);n.forEach(s=>{if(s[cn])return;let r=this._engine.fetchNamespacesByElement(s);r.size?r.forEach(o=>o.triggerLeaveAnimation(s,t,!1,!0)):this.clearElementCache(s)}),this._engine.afterFlushAnimationsDone(()=>n.forEach(s=>this.clearElementCache(s)))}triggerLeaveAnimation(e,t,n,s){let r=this._engine.statesByElement.get(e),o=new Map;if(r){let a=[];if(r.forEach((u,c)=>{if(o.set(c,u.value),this._triggers.has(c)){let d=this.trigger(e,c,Ja,s);d&&a.push(d)}}),a.length)return this._engine.markElementAsRemoved(this.id,e,!0,t,o),n&&Ui(a).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){let t=this._elementListeners.get(e),n=this._engine.statesByElement.get(e);if(t&&n){let s=new Set;t.forEach(r=>{let o=r.name;if(s.has(o))return;s.add(o);let u=this._triggers.get(o).fallbackTransition,c=n.get(o)||M_,d=new el(Ja),f=new tl(this.id,o,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:o,transition:u,fromState:c,toState:d,player:f,isFallbackTransition:!0})})}}removeNode(e,t){let n=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let s=!1;if(n.totalAnimations){let r=n.players.length?n.playersByQueriedElement.get(e):[];if(r&&r.length)s=!0;else{let o=e;for(;o=o.parentNode;)if(n.statesByElement.get(o)){s=!0;break}}}if(this.prepareLeaveAnimationListeners(e),s)n.markElementAsRemoved(this.id,e,!1,t);else{let r=e[cn];(!r||r===Ub)&&(n.afterFlush(()=>this.clearElementCache(e)),n.destroyInnerAnimations(e),n._onRemovalComplete(e,t))}}insertNode(e,t){Jt(e,this._hostClassName)}drainQueuedTransitions(e){let t=[];return this._queue.forEach(n=>{let s=n.player;if(s.destroyed)return;let r=n.element,o=this._elementListeners.get(r);o&&o.forEach(a=>{if(a.name==n.triggerName){let u=ey(r,n.triggerName,n.fromState.value,n.toState.value);u._data=e,Z_(n.player,a.phase,u,a.callback)}}),s.markedForDestroy?this._engine.afterFlush(()=>{s.destroy()}):t.push(n)}),this._queue=[],t.sort((n,s)=>{let r=n.transition.ast.depCount,o=s.transition.ast.depCount;return r==0||o==0?r-o:this._engine.driver.containsElement(n.element,s.element)?1:-1})}destroy(e){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}},Y_=class{_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}constructor(e,t,n){this.bodyNode=e,this.driver=t,this._normalizer=n,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(s,r)=>{}}get queuedPlayers(){let e=[];return this._namespaceList.forEach(t=>{t.players.forEach(n=>{n.queued&&e.push(n)})}),e}createNamespace(e,t){let n=new H_(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(n,t):(this.newHostElements.set(t,n),this.collectEnterElement(t)),this._namespaceLookup[e]=n}_balanceNamespaceList(e,t){let n=this._namespaceList,s=this.namespacesByHostElement;if(n.length-1>=0){let o=!1,a=this.driver.getParentElement(t);for(;a;){let u=s.get(a);if(u){let c=n.indexOf(u);n.splice(c+1,0,e),o=!0;break}a=this.driver.getParentElement(a)}o||n.unshift(e)}else n.push(e);return s.set(t,e),e}register(e,t){let n=this._namespaceLookup[e];return n||(n=this.createNamespace(e,t)),n}registerTrigger(e,t,n){let s=this._namespaceLookup[e];s&&s.register(t,n)&&this.totalAnimations++}destroy(e,t){e&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{let n=this._fetchNamespace(e);this.namespacesByHostElement.delete(n.hostElement);let s=this._namespaceList.indexOf(n);s>=0&&this._namespaceList.splice(s,1),n.destroy(t),delete this._namespaceLookup[e]}))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){let t=new Set,n=this.statesByElement.get(e);if(n){for(let s of n.values())if(s.namespaceId){let r=this._fetchNamespace(s.namespaceId);r&&t.add(r)}}return t}trigger(e,t,n,s){if(Th(t)){let r=this._fetchNamespace(e);if(r)return r.trigger(t,n,s),!0}return!1}insertNode(e,t,n,s){if(!Th(t))return;let r=t[cn];if(r&&r.setForRemoval){r.setForRemoval=!1,r.setForMove=!0;let o=this.collectedLeaveElements.indexOf(t);o>=0&&this.collectedLeaveElements.splice(o,1)}if(e){let o=this._fetchNamespace(e);o&&o.insertNode(t,n)}s&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),Jt(e,O_)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),eo(e,O_))}removeNode(e,t,n){if(Th(t)){let s=e?this._fetchNamespace(e):null;s?s.removeNode(t,n):this.markElementAsRemoved(e,t,!1,n);let r=this.namespacesByHostElement.get(t);r&&r.id!==e&&r.removeNode(t,n)}else this._onRemovalComplete(t,n)}markElementAsRemoved(e,t,n,s,r){this.collectedLeaveElements.push(t),t[cn]={namespaceId:e,setForRemoval:s,hasAnimation:n,removedBeforeQueried:!1,previousTriggersValues:r}}listen(e,t,n,s,r){return Th(t)?this._fetchNamespace(e).listen(t,n,s,r):()=>{}}_buildInstruction(e,t,n,s,r){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,n,s,e.fromState.options,e.toState.options,t,r)}destroyInnerAnimations(e){let t=this.driver.query(e,Sh,!0);t.forEach(n=>this.destroyActiveAnimationsForElement(n)),this.playersByQueriedElement.size!=0&&(t=this.driver.query(e,L_,!0),t.forEach(n=>this.finishActiveQueriedAnimationOnElement(n)))}destroyActiveAnimationsForElement(e){let t=this.playersByElement.get(e);t&&t.forEach(n=>{n.queued?n.markedForDestroy=!0:n.destroy()})}finishActiveQueriedAnimationOnElement(e){let t=this.playersByQueriedElement.get(e);t&&t.forEach(n=>n.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return Ui(this.players).onDone(()=>e());e()})}processLeaveNode(e){let t=e[cn];if(t&&t.setForRemoval){if(e[cn]=Ub,t.namespaceId){this.destroyInnerAnimations(e);let n=this._fetchNamespace(t.namespaceId);n&&n.clearElementCache(e)}this._onRemovalComplete(e,t.setForRemoval)}e.classList?.contains(O_)&&this.markElementAsDisabled(e,!1),this.driver.query(e,T1,!0).forEach(n=>{this.markElementAsDisabled(n,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((n,s)=>this._balanceNamespaceList(n,s)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let n=0;n<this.collectedEnterElements.length;n++){let s=this.collectedEnterElements[n];Jt(s,I1)}if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){let n=[];try{t=this._flushAnimations(n,e)}finally{for(let s=0;s<n.length;s++)n[s]()}}else for(let n=0;n<this.collectedLeaveElements.length;n++){let s=this.collectedLeaveElements[n];this.processLeaveNode(s)}if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(n=>n()),this._flushFns=[],this._whenQuietFns.length){let n=this._whenQuietFns;this._whenQuietFns=[],t.length?Ui(t).onDone(()=>{n.forEach(s=>s())}):n.forEach(s=>s())}}reportError(e){throw jD(e)}_flushAnimations(e,t){let n=new Za,s=[],r=new Map,o=[],a=new Map,u=new Map,c=new Map,d=new Set;this.disabledNodes.forEach(z=>{d.add(z);let Q=this.driver.query(z,E1,!0);for(let $=0;$<Q.length;$++)d.add(Q[$])});let f=this.bodyNode,p=Array.from(this.statesByElement.keys()),_=Rb(p,this.collectedEnterElements),E=new Map,S=0;_.forEach((z,Q)=>{let $=Ob+S++;E.set(Q,$),z.forEach(le=>Jt(le,$))});let R=[],V=new Set,B=new Set;for(let z=0;z<this.collectedLeaveElements.length;z++){let Q=this.collectedLeaveElements[z],$=Q[cn];$&&$.setForRemoval&&(R.push(Q),V.add(Q),$.hasAnimation?this.driver.query(Q,S1,!0).forEach(le=>V.add(le)):B.add(Q))}let F=new Map,K=Rb(p,Array.from(V));K.forEach((z,Q)=>{let $=F_+S++;F.set(Q,$),z.forEach(le=>Jt(le,$))}),e.push(()=>{_.forEach((z,Q)=>{let $=E.get(Q);z.forEach(le=>eo(le,$))}),K.forEach((z,Q)=>{let $=F.get(Q);z.forEach(le=>eo(le,$))}),R.forEach(z=>{this.processLeaveNode(z)})});let ne=[],H=[];for(let z=this._namespaceList.length-1;z>=0;z--)this._namespaceList[z].drainQueuedTransitions(t).forEach($=>{let le=$.player,qe=$.element;if(ne.push(le),this.collectedEnterElements.length){let Le=qe[cn];if(Le&&Le.setForMove){if(Le.previousTriggersValues&&Le.previousTriggersValues.has($.triggerName)){let kn=Le.previousTriggersValues.get($.triggerName),Ct=this.statesByElement.get($.element);if(Ct&&Ct.has($.triggerName)){let On=Ct.get($.triggerName);On.value=kn,Ct.set($.triggerName,On)}}le.destroy();return}}let jt=!f||!this.driver.containsElement(f,qe),Fe=F.get(qe),Ae=E.get(qe),Ce=this._buildInstruction($,n,Ae,Fe,jt);if(Ce.errors&&Ce.errors.length){H.push(Ce);return}if(jt){le.onStart(()=>Os(qe,Ce.fromStyles)),le.onDestroy(()=>Dn(qe,Ce.toStyles)),s.push(le);return}if($.isFallbackTransition){le.onStart(()=>Os(qe,Ce.fromStyles)),le.onDestroy(()=>Dn(qe,Ce.toStyles)),s.push(le);return}let ei=[];Ce.timelines.forEach(Le=>{Le.stretchStartingKeyframe=!0,this.disabledNodes.has(Le.element)||ei.push(Le)}),Ce.timelines=ei,n.append(qe,Ce.timelines);let Vh={instruction:Ce,player:le,element:qe};o.push(Vh),Ce.queriedElements.forEach(Le=>Ut(a,Le,[]).push(le)),Ce.preStyleProps.forEach((Le,kn)=>{if(Le.size){let Ct=u.get(kn);Ct||u.set(kn,Ct=new Set),Le.forEach((On,ti)=>Ct.add(ti))}}),Ce.postStyleProps.forEach((Le,kn)=>{let Ct=c.get(kn);Ct||c.set(kn,Ct=new Set),Le.forEach((On,ti)=>Ct.add(ti))})});if(H.length){let z=[];H.forEach(Q=>{z.push(zD(Q.triggerName,Q.errors))}),ne.forEach(Q=>Q.destroy()),this.reportError(z)}let T=new Map,y=new Map;o.forEach(z=>{let Q=z.element;n.has(Q)&&(y.set(Q,Q),this._beforeAnimationBuild(z.player.namespaceId,z.instruction,T))}),s.forEach(z=>{let Q=z.element;this._getPreviousPlayers(Q,!1,z.namespaceId,z.triggerName,null).forEach(le=>{Ut(T,Q,[]).push(le),le.destroy()})});let w=R.filter(z=>Pb(z,u,c)),I=new Map;Cb(I,this.driver,B,c,xn).forEach(z=>{Pb(z,u,c)&&w.push(z)});let C=new Map;_.forEach((z,Q)=>{Cb(C,this.driver,new Set(z),u,_h)}),w.forEach(z=>{let Q=I.get(z),$=C.get(z);I.set(z,new Map([...Q?.entries()??[],...$?.entries()??[]]))});let v=[],qt=[],Zn={};o.forEach(z=>{let{element:Q,player:$,instruction:le}=z;if(n.has(Q)){if(d.has(Q)){$.onDestroy(()=>Dn(Q,le.toStyles)),$.disabled=!0,$.overrideTotalTime(le.totalTime),s.push($);return}let qe=Zn;if(y.size>1){let Fe=Q,Ae=[];for(;Fe=Fe.parentNode;){let Ce=y.get(Fe);if(Ce){qe=Ce;break}Ae.push(Fe)}Ae.forEach(Ce=>y.set(Ce,qe))}let jt=this._buildAnimation($.namespaceId,le,T,r,C,I);if($.setRealPlayer(jt),qe===Zn)v.push($);else{let Fe=this.playersByElement.get(qe);Fe&&Fe.length&&($.parentPlayer=Ui(Fe)),s.push($)}}else Os(Q,le.fromStyles),$.onDestroy(()=>Dn(Q,le.toStyles)),qt.push($),d.has(Q)&&s.push($)}),qt.forEach(z=>{let Q=r.get(z.element);if(Q&&Q.length){let $=Ui(Q);z.setRealPlayer($)}}),s.forEach(z=>{z.parentPlayer?z.syncPlayerEvents(z.parentPlayer):z.destroy()});for(let z=0;z<R.length;z++){let Q=R[z],$=Q[cn];if(eo(Q,F_),$&&$.hasAnimation)continue;let le=[];if(a.size){let jt=a.get(Q);jt&&jt.length&&le.push(...jt);let Fe=this.driver.query(Q,L_,!0);for(let Ae=0;Ae<Fe.length;Ae++){let Ce=a.get(Fe[Ae]);Ce&&Ce.length&&le.push(...Ce)}}let qe=le.filter(jt=>!jt.destroyed);qe.length?N1(this,Q,qe):this.processLeaveNode(Q)}return R.length=0,v.forEach(z=>{this.players.push(z),z.onDone(()=>{z.destroy();let Q=this.players.indexOf(z);this.players.splice(Q,1)}),z.play()}),v}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,n,s,r){let o=[];if(t){let a=this.playersByQueriedElement.get(e);a&&(o=a)}else{let a=this.playersByElement.get(e);if(a){let u=!r||r==Ja;a.forEach(c=>{c.queued||!u&&c.triggerName!=s||o.push(c)})}}return(n||s)&&(o=o.filter(a=>!(n&&n!=a.namespaceId||s&&s!=a.triggerName))),o}_beforeAnimationBuild(e,t,n){let s=t.triggerName,r=t.element,o=t.isRemovalTransition?void 0:e,a=t.isRemovalTransition?void 0:s;for(let u of t.timelines){let c=u.element,d=c!==r,f=Ut(n,c,[]);this._getPreviousPlayers(c,d,o,a,t.toState).forEach(_=>{let E=_.getRealPlayer();E.beforeDestroy&&E.beforeDestroy(),_.destroy(),f.push(_)})}Os(r,t.fromStyles)}_buildAnimation(e,t,n,s,r,o){let a=t.triggerName,u=t.element,c=[],d=new Set,f=new Set,p=t.timelines.map(E=>{let S=E.element;d.add(S);let R=S[cn];if(R&&R.removedBeforeQueried)return new Bi(E.duration,E.delay);let V=S!==u,B=x1((n.get(S)||b1).map(T=>T.getRealPlayer())).filter(T=>{let y=T;return y.element?y.element===S:!1}),F=r.get(S),K=o.get(S),ne=Nb(this._normalizer,E.keyframes,F,K),H=this._buildPlayer(E,ne,B);if(E.subTimeline&&s&&f.add(S),V){let T=new tl(e,a,S);T.setRealPlayer(H),c.push(T)}return H});c.forEach(E=>{Ut(this.playersByQueriedElement,E.element,[]).push(E),E.onDone(()=>C1(this.playersByQueriedElement,E.element,E))}),d.forEach(E=>Jt(E,vb));let _=Ui(p);return _.onDestroy(()=>{d.forEach(E=>eo(E,vb)),Dn(u,t.toStyles)}),f.forEach(E=>{Ut(s,E,[]).push(_)}),_}_buildPlayer(e,t,n){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,n):new Bi(e.duration,e.delay)}},tl=class{constructor(e,t,n){this.namespaceId=e,this.triggerName=t,this.element=n,this._player=new Bi,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(e){this._containsRealPlayer||(this._player=e,this._queuedCallbacks.forEach((t,n)=>{t.forEach(s=>Z_(e,n,void 0,s))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){let t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){Ut(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return this.queued?!1:this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){let t=this._player;t.triggerCallback&&t.triggerCallback(e)}};function C1(i,e,t){let n=i.get(e);if(n){if(n.length){let s=n.indexOf(t);n.splice(s,1)}n.length==0&&i.delete(e)}return n}function R1(i){return i??null}function Th(i){return i&&i.nodeType===1}function P1(i){return i=="start"||i=="done"}function Ab(i,e){let t=i.style.display;return i.style.display=e??"none",t}function Cb(i,e,t,n,s){let r=[];t.forEach(u=>r.push(Ab(u)));let o=[];n.forEach((u,c)=>{let d=new Map;u.forEach(f=>{let p=e.computeStyle(c,f,s);d.set(f,p),(!p||p.length==0)&&(c[cn]=A1,o.push(c))}),i.set(c,d)});let a=0;return t.forEach(u=>Ab(u,r[a++])),o}function Rb(i,e){let t=new Map;if(i.forEach(a=>t.set(a,[])),e.length==0)return t;let n=1,s=new Set(e),r=new Map;function o(a){if(!a)return n;let u=r.get(a);if(u)return u;let c=a.parentNode;return t.has(c)?u=c:s.has(c)?u=n:u=o(c),r.set(a,u),u}return e.forEach(a=>{let u=o(a);u!==n&&t.get(u).push(a)}),t}function Jt(i,e){i.classList?.add(e)}function eo(i,e){i.classList?.remove(e)}function N1(i,e,t){Ui(t).onDone(()=>i.processLeaveNode(e))}function x1(i){let e=[];return qb(i,e),e}function qb(i,e){for(let t=0;t<i.length;t++){let n=i[t];n instanceof $a?qb(n.players,e):e.push(n)}}function D1(i,e){let t=Object.keys(i),n=Object.keys(e);if(t.length!=n.length)return!1;for(let s=0;s<t.length;s++){let r=t[s];if(!e.hasOwnProperty(r)||i[r]!==e[r])return!1}return!0}function Pb(i,e,t){let n=t.get(i);if(!n)return!1;let s=e.get(i);return s?n.forEach(r=>s.add(r)):e.set(i,n),t.delete(i),!0}var to=class{constructor(e,t,n){this._driver=t,this._normalizer=n,this._triggerCache={},this.onRemovalComplete=(s,r)=>{},this._transitionEngine=new Y_(e.body,t,n),this._timelineEngine=new $_(e.body,t,n),this._transitionEngine.onRemovalComplete=(s,r)=>this.onRemovalComplete(s,r)}registerTrigger(e,t,n,s,r){let o=e+"-"+s,a=this._triggerCache[o];if(!a){let u=[],c=[],d=Fb(this._driver,r,u,c);if(u.length)throw DD(s,u);c.length&&void 0,a=y1(s,d,this._normalizer),this._triggerCache[o]=a}this._transitionEngine.registerTrigger(t,s,a)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,n,s){this._transitionEngine.insertNode(e,t,n,s)}onRemove(e,t,n){this._transitionEngine.removeNode(e,t,n)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,n,s){if(n.charAt(0)=="@"){let[r,o]=_b(n),a=s;this._timelineEngine.command(r,t,o,a)}else this._transitionEngine.trigger(e,t,n,s)}listen(e,t,n,s,r){if(n.charAt(0)=="@"){let[o,a]=_b(n);return this._timelineEngine.listen(o,t,a,r)}return this._transitionEngine.listen(e,t,n,s,r)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(e){this._transitionEngine.afterFlushAnimationsDone(e)}};function k1(i,e){let t=null,n=null;return Array.isArray(e)&&e.length?(t=V_(e[0]),e.length>1&&(n=V_(e[e.length-1]))):e instanceof Map&&(t=V_(e)),t||n?new J_(i,t,n):null}var J_=class i{static{this.initialStylesByElement=new WeakMap}constructor(e,t,n){this._element=e,this._startStyles=t,this._endStyles=n,this._state=0;let s=i.initialStylesByElement.get(e);s||i.initialStylesByElement.set(e,s=new Map),this._initialStyles=s}start(){this._state<1&&(this._startStyles&&Dn(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Dn(this._element,this._initialStyles),this._endStyles&&(Dn(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(i.initialStylesByElement.delete(this._element),this._startStyles&&(Os(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(Os(this._element,this._endStyles),this._endStyles=null),Dn(this._element,this._initialStyles),this._state=3)}};function V_(i){let e=null;return i.forEach((t,n)=>{O1(n)&&(e=e||new Map,e.set(n,t))}),e}function O1(i){return i==="display"||i==="position"}var xh=class{constructor(e,t,n,s){this.element=e,this.keyframes=t,this.options=n,this._specialStyles=s,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=n.duration,this._delay=n.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;let e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:new Map;let t=()=>this._onFinish();this.domPlayer.addEventListener("finish",t),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",t)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(e){let t=[];return e.forEach(n=>{t.push(Object.fromEntries(n))}),t}_triggerWebAnimation(e,t,n){return e.animate(this._convertKeyframesToObject(t),n)}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){this.domPlayer===void 0&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){let e=new Map;this.hasStarted()&&this._finalKeyframe.forEach((n,s)=>{s!=="offset"&&e.set(s,this._finished?n:sy(this.element,s))}),this.currentSnapshot=e}triggerCallback(e){let t=e==="start"?this._onStartFns:this._onDoneFns;t.forEach(n=>n()),t.length=0}},Dh=class{validateStyleProperty(e){return!0}validateAnimatableStyleProperty(e){return!0}containsElement(e,t){return xb(e,t)}getParentElement(e){return ty(e)}query(e,t,n){return Db(e,t,n)}computeStyle(e,t,n){return sy(e,t)}animate(e,t,n,s,r,o=[]){let a=s==0?"both":"forwards",u={duration:n,delay:s,fill:a};r&&(u.easing=r);let c=new Map,d=o.filter(_=>_ instanceof xh);e1(n,s)&&d.forEach(_=>{_.currentSnapshot.forEach((E,S)=>c.set(S,E))});let f=JD(t).map(_=>new Map(_));f=t1(e,f,c);let p=k1(e,f);return new xh(e,f,u,p)}};var Ih="@",jb="@.disabled",kh=class{constructor(e,t,n,s){this.namespaceId=e,this.delegate=t,this.engine=n,this._onDestroy=s,this.\u0275type=0}get data(){return this.delegate.data}destroyNode(e){this.delegate.destroyNode?.(e)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,n,s=!0){this.delegate.insertBefore(e,t,n),this.engine.onInsert(this.namespaceId,t,e,s)}removeChild(e,t,n){this.parentNode(t)&&this.engine.onRemove(this.namespaceId,t,this.delegate)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,n,s){this.delegate.setAttribute(e,t,n,s)}removeAttribute(e,t,n){this.delegate.removeAttribute(e,t,n)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,n,s){this.delegate.setStyle(e,t,n,s)}removeStyle(e,t,n){this.delegate.removeStyle(e,t,n)}setProperty(e,t,n){t.charAt(0)==Ih&&t==jb?this.disableAnimations(e,!!n):this.delegate.setProperty(e,t,n)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,n){return this.delegate.listen(e,t,n)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}},X_=class extends kh{constructor(e,t,n,s,r){super(t,n,s,r),this.factory=e,this.namespaceId=t}setProperty(e,t,n){t.charAt(0)==Ih?t.charAt(1)=="."&&t==jb?(n=n===void 0?!0:!!n,this.disableAnimations(e,n)):this.engine.process(this.namespaceId,e,t.slice(1),n):this.delegate.setProperty(e,t,n)}listen(e,t,n){if(t.charAt(0)==Ih){let s=M1(e),r=t.slice(1),o="";return r.charAt(0)!=Ih&&([r,o]=V1(r)),this.engine.listen(this.namespaceId,s,r,o,a=>{let u=a._data||-1;this.factory.scheduleListenerCallback(u,n,a)})}return this.delegate.listen(e,t,n)}};function M1(i){switch(i){case"body":return document.body;case"document":return document;case"window":return window;default:return i}}function V1(i){let e=i.indexOf("."),t=i.substring(0,e),n=i.slice(e+1);return[t,n]}var Oh=class{constructor(e,t,n){this.delegate=e,this.engine=t,this._zone=n,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,t.onRemovalComplete=(s,r)=>{r?.removeChild(null,s)}}createRenderer(e,t){let n="",s=this.delegate.createRenderer(e,t);if(!e||!t?.data?.animation){let c=this._rendererCache,d=c.get(s);if(!d){let f=()=>c.delete(s);d=new kh(n,s,this.engine,f),c.set(s,d)}return d}let r=t.id,o=t.id+"-"+this._currentId;this._currentId++,this.engine.register(o,e);let a=c=>{Array.isArray(c)?c.forEach(a):this.engine.registerTrigger(r,o,e,c.name,c)};return t.data.animation.forEach(a),new X_(this,o,s,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(e,t,n){if(e>=0&&e<this._microtaskId){this._zone.run(()=>t(n));return}let s=this._animationCallbacksBuffer;s.length==0&&queueMicrotask(()=>{this._zone.run(()=>{s.forEach(r=>{let[o,a]=r;o(a)}),this._animationCallbacksBuffer=[]})}),s.push([t,n])}end(){this._cdRecurDepth--,this._cdRecurDepth==0&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}};var L1=(()=>{class i extends to{constructor(t,n,s){super(t,n,s)}ngOnDestroy(){this.flush()}static{this.\u0275fac=function(n){return new(n||i)(J(So),J(Ms),J(Vs))}}static{this.\u0275prov=Rt({token:i,factory:i.\u0275fac})}}return i})();function B1(){return new Ah}function U1(i,e,t){return new Oh(i,e,t)}var zb=[{provide:Vs,useFactory:B1},{provide:to,useClass:L1},{provide:_v,useFactory:U1,deps:[Av,to,Fn]}],q1=[{provide:Ms,useFactory:()=>new Dh},{provide:cd,useValue:"BrowserAnimations"},...zb],gM=[{provide:Ms,useClass:ny},{provide:cd,useValue:"NoopAnimations"},...zb];function Gb(){return yv("NgEagerAnimations"),[...q1]}var Kb={apiKey:"AIzaSyAdWLVOkP8pLrNZkELpC8Mm1fVdbkd1kEk",authDomain:"expenses-5d437.firebaseapp.com",projectId:"expenses-5d437",storageBucket:"expenses-5d437.appspot.com",messagingSenderId:"202582971776",appId:"1:202582971776:web:6b55340bb59e17d4565d65"};var Qb={providers:[Tv({eventCoalescing:!0}),xv(pb),fv([zv.initializeApp(Kb),Gv,IT,rb]),Gb(),hb()]};function j1(i,e){if(i&1&&(ee(0,"div",13),ue(1,"Logged on user: "),ee(2,"strong"),ue(3),X()()),i&2){let t=We();ce(3),Sl(t.user)}}var Mh=class i{constructor(e){this.toastr=e}title="expenses";auth=vt(Bn);isLoginFormModelOpen=!1;isLoggedIn=vt(Bn).isLoggedIn();user;logOut(){this.auth.logout()}ngOnInit(){this.isLoggedIn.subscribe(e=>{if(e){let t=localStorage.getItem("user");if(t){let n=JSON.parse(t);this.user=n.email,this.toastr.success(this.user,"User logged in successfully",{timeOut:5e3,positionClass:"toast-top-right",closeButton:!0,progressBar:!0})}}})}static \u0275fac=function(t){return new(t||i)(Ze(Xr))};static \u0275cmp=en({type:i,selectors:[["app-root"]],standalone:!0,features:[tn],decls:21,vars:3,consts:[[1,"navbar","navbar-expand-lg","border-bottom","sticky-top","navbar-light","bg-light"],[1,"container-fluid"],["href","#",1,"navbar-brand"],["type","button","data-bs-toggle","collapse","data-bs-target","#navbarSupportedContent","aria-controls","navbarSupportedContent","aria-expanded","false","aria-label","Toggle navigation",1,"navbar-toggler"],[1,"navbar-toggler-icon"],["id","navbarSupportedContent",1,"collapse","navbar-collapse"],[1,"navbar-nav","me-auto","mb-2","mb-lg-0"],[1,"nav-item"],["aria-current","page","href","/",1,"nav-link","active"],["aria-current","page","href","/login",1,"nav-link","active"],["aria-current","page","href","/",1,"nav-link","active",3,"click"],["class","align-items-center",4,"ngIf"],[1,"container","my-4"],[1,"align-items-center"]],template:function(t,n){t&1&&(ee(0,"nav",0)(1,"div",1)(2,"a",2),ue(3,"Expense Tracker"),X(),ee(4,"button",3),Pt(5,"span",4),X(),ee(6,"div",5)(7,"ul",6)(8,"li",7)(9,"a",8),ue(10,"Home"),X()(),ee(11,"li",7)(12,"a",9),ue(13,"Login"),X()(),ee(14,"li",7)(15,"a",10),at("click",function(){return n.logOut()}),ue(16,"Logout"),X()()(),ft(17,j1,4,1,"div",11),$i(18,"async"),X()()(),ee(19,"div",12),Pt(20,"router-outlet"),X()),t&2&&(ce(17),Pe("ngIf",Io(18,1,n.isLoggedIn)))},dependencies:[Pv,zs,Hi,Al]})};Cv(Mh,Qb).catch(i=>console.error(i));

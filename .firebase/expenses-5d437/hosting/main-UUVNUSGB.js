import{a as Q0}from"./chunk-UY7FZ3U3.js";import{$ as Yo,$a as I0,A as t0,Aa as li,Ab as q0,B as n0,Ba as f0,Bb as Dc,C as Ct,Ca as p0,Cb as j0,D as St,Da as ws,Db as G0,E as sn,Ea as Xo,Eb as W0,F as rn,Fa as Jd,Fb as z0,G as Zl,Ga as m0,Gb as K0,H as oi,Ha as nc,Hb as H0,I as zt,Ia as g0,J as _s,Ja as _0,K as Ni,Ka as ft,L as $d,La as Ts,M as i0,Ma as an,N as $o,Na as Zo,O as L,Oa as ic,P as he,Pa as In,Q as s0,Qa as sc,R as r0,Ra as rc,S as o0,Sa as oc,T as ec,Ta as y0,U as a0,Ua as Di,V as xi,Va as ac,W as on,Wa as v0,X as ai,Xa as E0,Y as be,Ya as w0,Z as ue,Za as lc,_ as z,_a as T0,a as Ql,aa as l0,ab as cc,b as nn,ba as Pe,bb as C0,c as $l,ca as ys,cb as S0,d as Ho,da as G,db as uc,e as Qo,ea as W,eb as _c,f as nt,fa as re,fb as yc,g as Hd,ga as En,gb as vc,h as Qd,ha as wn,hb as ut,i as Yl,ia as Jo,ib as Ec,j as Jl,ja as Tn,jb as wc,k as gs,ka as c0,kb as Tc,l as Yv,la as Ue,lb as L0,m as Jv,ma as ne,mb as Ic,n as Xl,na as vs,nb as Cc,o as Xv,oa as Es,ob as Sc,p as Zv,pa as tc,pb as bc,q as Ee,qa as Yd,qb as Ac,r as yt,ra as pr,rb as Rc,s as Dt,sa as mr,sb as Pc,t as On,ta as u0,tb as Nc,u as te,ua as oe,ub as xc,v as lt,va as kn,vb as V0,w as Se,wa as Mn,wb as ci,x as Ot,xa as h0,xb as B0,y as Pi,ya as Ne,yb as sf,z as e0,za as d0,zb as U0}from"./chunk-QCGTZJ3C.js";import{A as D0,B as O0,C as ln,D as Oi,E as fc,F as ta,G as ef,H as k0,I as M0,J as ee,K as jt,L as ct,M as tf,N as F0,O as na,P as ge,Q as Ln,R as pc,S as nf,T as cn,U as _r,V as mc,W as gc,Y as yr,Z as ki,a as Ae,b as vn,c as $v,d as Kd,e as D,j as M,k as gr,l as b0,m as A0,n as R0,o as kt,p as hc,q as ea,r as Xd,s as P0,t as Fn,u as Zd,v as N0,w as x0,y as dc,z as it}from"./chunk-6H46YYVM.js";var $0="@firebase/database",Y0="1.0.8";var gp="";function _p(i){gp=i}var df=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),it(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:dc(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var ff=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return ln(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var AE=function(i){try{if(typeof window<"u"&&typeof window[i]<"u"){let e=window[i];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new df(e)}}catch{}return new ff},Cs=AE("localStorage"),pf=AE("sessionStorage");var Tr=new _r("@firebase/database"),RE=function(){let i=1;return function(){return i++}}(),PE=function(i){let e=F0(i),t=new M0;t.update(e);let n=t.digest();return b0.encodeByteArray(n)},ba=function(...i){let e="";for(let t=0;t<i.length;t++){let n=i[t];Array.isArray(n)||n&&typeof n=="object"&&typeof n.length=="number"?e+=ba.apply(null,n):typeof n=="object"?e+=it(n):e+=n,e+=" "}return e},Ss=null,J0=!0,NE=function(i,e){M(!e||i===!0||i===!1,"Can't turn on custom loggers persistently."),i===!0?(Tr.logLevel=cn.VERBOSE,Ss=Tr.log.bind(Tr),e&&pf.set("logging_enabled",!0)):typeof i=="function"?Ss=i:(Ss=null,pf.remove("logging_enabled"))},pt=function(...i){if(J0===!0&&(J0=!1,Ss===null&&pf.get("logging_enabled")===!0&&NE(!0)),Ss){let e=ba.apply(null,i);Ss(e)}},Aa=function(i){return function(...e){pt(i,...e)}},mf=function(...i){let e="FIREBASE INTERNAL ERROR: "+ba(...i);Tr.error(e)},Un=function(...i){let e=`FIREBASE FATAL ERROR: ${ba(...i)}`;throw Tr.error(e),new Error(e)},bt=function(...i){let e="FIREBASE WARNING: "+ba(...i);Tr.warn(e)},R1=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&bt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},ou=function(i){return typeof i=="number"&&(i!==i||i===Number.POSITIVE_INFINITY||i===Number.NEGATIVE_INFINITY)},P1=function(i){if(Fn()||document.readyState==="complete")i();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,i())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Vi="[MIN_NAME]",ui="[MAX_NAME]",As=function(i,e){if(i===e)return 0;if(i===Vi||e===ui)return-1;if(e===Vi||i===ui)return 1;{let t=X0(i),n=X0(e);return t!==null?n!==null?t-n===0?i.length-e.length:t-n:-1:n!==null?1:i<e?-1:1}},N1=function(i,e){return i===e?0:i<e?-1:1},ia=function(i,e){if(e&&i in e)return e[i];throw new Error("Missing required key ("+i+") in object: "+it(e))},yp=function(i){if(typeof i!="object"||i===null)return it(i);let e=[];for(let n in i)e.push(n);e.sort();let t="{";for(let n=0;n<e.length;n++)n!==0&&(t+=","),t+=it(e[n]),t+=":",t+=yp(i[e[n]]);return t+="}",t},xE=function(i,e){let t=i.length;if(t<=e)return[i];let n=[];for(let s=0;s<t;s+=e)s+e>t?n.push(i.substring(s,t)):n.push(i.substring(s,s+e));return n};function mt(i,e){for(let t in i)i.hasOwnProperty(t)&&e(t,i[t])}var DE=function(i){M(!ou(i),"Invalid JSON number");let e=11,t=52,n=(1<<e-1)-1,s,r,o,a,c;i===0?(r=0,o=0,s=1/i===-1/0?1:0):(s=i<0,i=Math.abs(i),i>=Math.pow(2,1-n)?(a=Math.min(Math.floor(Math.log(i)/Math.LN2),n),r=a+n,o=Math.round(i*Math.pow(2,t-a)-Math.pow(2,t))):(r=0,o=Math.round(i/Math.pow(2,1-n-t))));let u=[];for(c=t;c;c-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)u.push(r%2?1:0),r=Math.floor(r/2);u.push(s?1:0),u.reverse();let d=u.join(""),f="";for(c=0;c<64;c+=8){let m=parseInt(d.substr(c,8),2).toString(16);m.length===1&&(m="0"+m),f=f+m}return f.toLowerCase()},x1=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},D1=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function O1(i,e){let t="Unknown Error";i==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":i==="permission_denied"?t="Client doesn't have permission to access the desired data.":i==="unavailable"&&(t="The service is unavailable");let n=new Error(i+" at "+e._path.toString()+": "+t);return n.code=i.toUpperCase(),n}var k1=new RegExp("^-?(0*)\\d{1,10}$"),M1=-2147483648,F1=2147483647,X0=function(i){if(k1.test(i)){let e=Number(i);if(e>=M1&&e<=F1)return e}return null},xr=function(i){try{i()}catch(e){setTimeout(()=>{let t=e.stack||"";throw bt("Exception was thrown by user callback.",t),e},Math.floor(0))}},L1=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},aa=function(i,e){let t=setTimeout(i,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var gf=class{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(n=>this.appCheck=n)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(n=>n.addTokenListener(e))}notifyForInvalidToken(){bt(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var _f=class{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(pt("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',bt(e)}},la=(()=>{class i{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}i.OWNER="owner";return i})(),kc="5",OE="v",kE="s",ME="r",FE="f",LE=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,VE="ls",BE="p",yf="ac",UE="websocket",qE="long_polling";var Mc=class{constructor(e,t,n,s,r=!1,o="",a=!1,c=!1){this.secure=t,this.namespace=n,this.webSocketOnly=s,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Cs.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Cs.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function V1(i){return i.host!==i.internalHost||i.isCustomHost()||i.includeNamespaceInQueryParams}function jE(i,e,t){M(typeof e=="string","typeof type must == string"),M(typeof t=="object","typeof params must == object");let n;if(e===UE)n=(i.secure?"wss://":"ws://")+i.internalHost+"/.ws?";else if(e===qE)n=(i.secure?"https://":"http://")+i.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);V1(i)&&(t.ns=i.namespace);let s=[];return mt(t,(r,o)=>{s.push(r+"="+o)}),n+s.join("&")}var vf=class{constructor(){this.counters_={}}incrementCounter(e,t=1){ln(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return R0(this.counters_)}};var rf={},of={};function vp(i){let e=i.toString();return rf[e]||(rf[e]=new vf),rf[e]}function B1(i,e){let t=i.toString();return of[t]||(of[t]=e()),of[t]}var Ef=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let n=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<n.length;++s)n[s]&&xr(()=>{this.onMessage_(n[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var Z0="start",U1="close",q1="pLPCommand",j1="pRTLPCB",GE="id",WE="pw",zE="ser",G1="cb",W1="seg",z1="ts",K1="d",H1="dframe",KE=1870,HE=30,Q1=KE-HE,$1=25e3,Y1=3e4,da=class i{constructor(e,t,n,s,r,o,a){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=s,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Aa(e),this.stats_=vp(t),this.urlFn=c=>(this.appCheckToken&&(c[yf]=this.appCheckToken),jE(t,qE,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Ef(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Y1)),P1(()=>{if(this.isClosed_)return;this.scriptTagHolder=new wf((...r)=>{let[o,a,c,u,d]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===Z0)this.id=a,this.password=c;else if(o===U1)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{let[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let n={};n[Z0]="t",n[zE]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(n[G1]=this.scriptTagHolder.uniqueCallbackIdentifier),n[OE]=kc,this.transportSessionId&&(n[kE]=this.transportSessionId),this.lastSessionId&&(n[VE]=this.lastSessionId),this.applicationId&&(n[BE]=this.applicationId),this.appCheckToken&&(n[yf]=this.appCheckToken),typeof location<"u"&&location.hostname&&LE.test(location.hostname)&&(n[ME]=FE);let s=this.urlFn(n);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){i.forceAllow_=!0}static forceDisallow(){i.forceDisallow_=!0}static isAvailable(){return Fn()?!1:i.forceAllow_?!0:!i.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!x1()&&!D1()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=it(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=A0(t),s=xE(n,Q1);for(let r=0;r<s.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(Fn())return;this.myDisconnFrame=document.createElement("iframe");let n={};n[H1]="t",n[GE]=e,n[WE]=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=it(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},wf=class i{constructor(e,t,n,s){if(this.onDisconnect=n,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,Fn())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=RE(),window[q1+this.uniqueCallbackIdentifier]=e,window[j1+this.uniqueCallbackIdentifier]=t,this.myIFrame=i.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){pt("frame writing exception"),a.stack&&pt(a.stack),pt(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||pt("No IE domain setting required")}catch{let n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[GE]=this.myID,e[WE]=this.myPW,e[zE]=this.currentSerial;let t=this.urlFn(e),n="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+HE+n.length<=KE;){let o=this.pendingSegs.shift();n=n+"&"+W1+s+"="+o.seg+"&"+z1+s+"="+o.ts+"&"+K1+s+"="+o.d,s++}return t=t+n,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(n,Math.floor($1)),r=()=>{clearTimeout(s),n()};this.addTag(e,r)}addTag(e,t){Fn()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){let s=n.readyState;(!s||s==="loaded"||s==="complete")&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{pt("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch{}},Math.floor(1))}};var J1=16384,X1=45e3,Fc=null;typeof MozWebSocket<"u"?Fc=MozWebSocket:typeof WebSocket<"u"&&(Fc=WebSocket);var Er=(()=>{class i{constructor(t,n,s,r,o,a,c){this.connId=t,this.applicationId=s,this.appCheckToken=r,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Aa(this.connId),this.stats_=vp(n),this.connURL=i.connectionURL_(n,a,c,r,s),this.nodeAdmin=n.nodeAdmin}static connectionURL_(t,n,s,r,o){let a={};return a[OE]=kc,!Fn()&&typeof location<"u"&&location.hostname&&LE.test(location.hostname)&&(a[ME]=FE),n&&(a[kE]=n),s&&(a[VE]=s),r&&(a[yf]=r),o&&(a[BE]=o),jE(t,UE,a)}open(t,n){this.onDisconnect=n,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Cs.set("previous_websocket_failure",!0);try{let s;if(Fn()){let r=this.nodeAdmin?"AdminNode":"Node";s={headers:{"User-Agent":`Firebase/${kc}/${gp}/${process.platform}/${r}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(s.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(s.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(s.proxy={origin:a})}this.mySock=new Fc(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");let r=s.message||s.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");let r=s.message||s.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){i.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let n=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(n);s&&s.length>1&&parseFloat(s[1])<4.4&&(t=!0)}return!t&&Fc!==null&&!i.forceDisallow_}static previouslyFailed(){return Cs.isInMemoryStorage||Cs.get("previous_websocket_failure")===!0}markConnectionHealthy(){Cs.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let n=this.frames.join("");this.frames=null;let s=dc(n);this.onMessage(s)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(M(this.frames===null,"We already have a frame buffer"),t.length<=6){let n=Number(t);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let n=t.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{let s=this.extractFrameCount_(n);s!==null&&this.appendFrame_(s)}}send(t){this.resetKeepAlive();let n=it(t);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);let s=xE(n,J1);s.length>1&&this.sendString_(String(s.length));for(let r=0;r<s.length;r++)this.sendString_(s[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(X1))}sendString_(t){try{this.mySock.send(t)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}i.responsesRequiredToBeHealthy=2,i.healthyTimeout=3e4;return i})(),QE=(()=>{class i{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[da,Er]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){let n=Er&&Er.isAvailable(),s=n&&!Er.previouslyFailed();if(t.webSocketOnly&&(n||bt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[Er];else{let r=this.transports_=[];for(let o of i.ALL_TRANSPORTS)o&&o.isAvailable()&&r.push(o);i.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}i.globalTransportInitialized_=!1;return i})(),Z1=6e4,eA=5e3,tA=10*1024,nA=100*1024,af="t",eE="d",iA="s",tE="r",sA="e",nE="o",iE="a",sE="n",rE="p",rA="h",Tf=class{constructor(e,t,n,s,r,o,a,c,u,d){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=s,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=u,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Aa("c:"+this.id+":"),this.transportManager_=new QE(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));let s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=aa(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>nA?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>tA?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(af in e){let t=e[af];t===iE?this.upgradeIfSecondaryHealthy_():t===tE?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===nE&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=ia("t",e),n=ia("d",e);if(t==="c")this.onSecondaryControl_(n);else if(t==="d")this.pendingDataMessages.push(n);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:rE,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:iE,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:sE,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=ia("t",e),n=ia("d",e);t==="c"?this.onControl_(n):t==="d"&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=ia(af,e);if(eE in e){let n=e[eE];if(t===rA){let s=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(t===sE){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===iA?this.onConnectionShutdown_(n):t===tE?this.onReset_(n):t===sA?mf("Server Error: "+n):t===nE?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):mf("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,n=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),kc!==n&&bt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),aa(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Z1))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):aa(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(eA))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:rE,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Cs.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var Lc=class{put(e,t,n,s){}merge(e,t,n,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}};var Vc=class{constructor(e){this.allowedEvents_=e,this.listeners_={},M(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let n=[...this.listeners_[e]];for(let s=0;s<n.length;s++)n[s].callback.apply(n[s].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});let s=this.getInitialEvent(e);s&&t.apply(n,s)}off(e,t,n){this.validateEventType_(e);let s=this.listeners_[e]||[];for(let r=0;r<s.length;r++)if(s[r].callback===t&&(!n||n===s[r].context)){s.splice(r,1);return}}validateEventType_(e){M(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var Bc=class i extends Vc{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Xd()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new i}getInitialEvent(e){return M(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var oE=32,aE=768,Ce=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let n=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[n]=this.pieces_[s],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function Ie(){return new Ce("")}function de(i){return i.pieceNum_>=i.pieces_.length?null:i.pieces_[i.pieceNum_]}function Bi(i){return i.pieces_.length-i.pieceNum_}function De(i){let e=i.pieceNum_;return e<i.pieces_.length&&e++,new Ce(i.pieces_,e)}function Ep(i){return i.pieceNum_<i.pieces_.length?i.pieces_[i.pieces_.length-1]:null}function oA(i){let e="";for(let t=i.pieceNum_;t<i.pieces_.length;t++)i.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(i.pieces_[t])));return e||"/"}function fa(i,e=0){return i.pieces_.slice(i.pieceNum_+e)}function $E(i){if(i.pieceNum_>=i.pieces_.length)return null;let e=[];for(let t=i.pieceNum_;t<i.pieces_.length-1;t++)e.push(i.pieces_[t]);return new Ce(e,0)}function qe(i,e){let t=[];for(let n=i.pieceNum_;n<i.pieces_.length;n++)t.push(i.pieces_[n]);if(e instanceof Ce)for(let n=e.pieceNum_;n<e.pieces_.length;n++)t.push(e.pieces_[n]);else{let n=e.split("/");for(let s=0;s<n.length;s++)n[s].length>0&&t.push(n[s])}return new Ce(t,0)}function fe(i){return i.pieceNum_>=i.pieces_.length}function Mt(i,e){let t=de(i),n=de(e);if(t===null)return e;if(t===n)return Mt(De(i),De(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+i+")")}function aA(i,e){let t=fa(i,0),n=fa(e,0);for(let s=0;s<t.length&&s<n.length;s++){let r=As(t[s],n[s]);if(r!==0)return r}return t.length===n.length?0:t.length<n.length?-1:1}function wp(i,e){if(Bi(i)!==Bi(e))return!1;for(let t=i.pieceNum_,n=e.pieceNum_;t<=i.pieces_.length;t++,n++)if(i.pieces_[t]!==e.pieces_[n])return!1;return!0}function un(i,e){let t=i.pieceNum_,n=e.pieceNum_;if(Bi(i)>Bi(e))return!1;for(;t<i.pieces_.length;){if(i.pieces_[t]!==e.pieces_[n])return!1;++t,++n}return!0}var If=class{constructor(e,t){this.errorPrefix_=t,this.parts_=fa(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=na(this.parts_[n]);YE(this)}};function lA(i,e){i.parts_.length>0&&(i.byteLength_+=1),i.parts_.push(e),i.byteLength_+=na(e),YE(i)}function cA(i){let e=i.parts_.pop();i.byteLength_-=na(e),i.parts_.length>0&&(i.byteLength_-=1)}function YE(i){if(i.byteLength_>aE)throw new Error(i.errorPrefix_+"has a key path longer than "+aE+" bytes ("+i.byteLength_+").");if(i.parts_.length>oE)throw new Error(i.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+oE+") or object contains a cycle "+Is(i))}function Is(i){return i.parts_.length===0?"":"in property '"+i.parts_.join(".")+"'"}var Cf=class i extends Vc{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let n=!document[e];n!==this.visible_&&(this.visible_=n,this.trigger("visible",n))},!1)}static getInstance(){return new i}getInitialEvent(e){return M(e==="visible","Unknown event type: "+e),[this.visible_]}};var sa=1e3,uA=60*5*1e3,lE=30*1e3,hA=1.3,dA=3e4,fA="server_kill",cE=3,Tp=(()=>{class i extends Lc{constructor(t,n,s,r,o,a,c,u){if(super(),this.repoInfo_=t,this.applicationId_=n,this.onDataUpdate_=s,this.onConnectStatus_=r,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=c,this.authOverride_=u,this.id=i.nextPersistentConnectionId_++,this.log_=Aa("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=sa,this.maxReconnectDelay_=uA,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,u&&!Fn())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Cf.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&Bc.getInstance().on("online",this.onOnline_,this)}sendRequest(t,n,s){let r=++this.requestNumber_,o={r,a:t,b:n};this.log_(it(o)),M(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),s&&(this.requestCBHash_[r]=s)}get(t){this.initConnection_();let n=new kt,r={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let c=a.d;a.s==="ok"?n.resolve(c):n.reject(c)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),n.promise}listen(t,n,s,r){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),M(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),M(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let c={onComplete:r,hashFn:n,query:t,tag:s};this.listens.get(a).set(o,c),this.connected_&&this.sendListen_(c)}sendGet_(t){let n=this.outstandingGets_[t];this.sendRequest("g",n.request,s=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(s)})}sendListen_(t){let n=t.query,s=n._path.toString(),r=n._queryIdentifier;this.log_("Listen on "+s+" for "+r);let o={p:s},a="q";t.tag&&(o.q=n._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,c=>{let u=c.d,d=c.s;i.warnOnListenWarnings_(u,n),(this.listens.get(s)&&this.listens.get(s).get(r))===t&&(this.log_("listen response",c),d!=="ok"&&this.removeListen_(s,r),t.onComplete&&t.onComplete(d,u))})}static warnOnListenWarnings_(t,n){if(t&&typeof t=="object"&&ln(t,"w")){let s=Oi(t,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){let r='".indexOn": "'+n._queryParams.getIndex().toString()+'"',o=n._path.toString();bt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||O0(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=lE)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,n=D0(t)?"auth":"gauth",s={cred:t};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(n,s,r=>{let o=r.s,a=r.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let n=t.s,s=t.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,s)})}unlisten(t,n){let s=t._path.toString(),r=t._queryIdentifier;this.log_("Unlisten called for "+s+" "+r),M(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,r)&&this.connected_&&this.sendUnlisten_(s,r,t._queryObject,n)}sendUnlisten_(t,n,s,r){this.log_("Unlisten on "+t+" for "+n);let o={p:t},a="n";r&&(o.q=s,o.t=r),this.sendRequest(a,o)}onDisconnectPut(t,n,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,n,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:n,onComplete:s})}onDisconnectMerge(t,n,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,n,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:n,onComplete:s})}onDisconnectCancel(t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(t,n,s,r){let o={p:n,d:s};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{r&&setTimeout(()=>{r(a.s,a.d)},Math.floor(0))})}put(t,n,s,r){this.putInternal("p",t,n,s,r)}merge(t,n,s,r){this.putInternal("m",t,n,s,r)}putInternal(t,n,s,r,o){this.initConnection_();let a={p:n,d:s};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:r}),this.outstandingPutCount_++;let c=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(c):this.log_("Buffering put: "+n)}sendPut_(t){let n=this.outstandingPuts_[t].action,s=this.outstandingPuts_[t].request,r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,s,o=>{this.log_(n+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(o.s,o.d)})}reportStats(t){if(this.connected_){let n={c:t};this.log_("reportStats",n),this.sendRequest("s",n,s=>{if(s.s!=="ok"){let o=s.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+it(t));let n=t.r,s=this.requestCBHash_[n];s&&(delete this.requestCBHash_[n],s(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,n){this.log_("handleServerMessage",t,n),t==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):t==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):t==="c"?this.onListenRevoked_(n.p,n.q):t==="ac"?this.onAuthRevoked_(n.s,n.d):t==="apc"?this.onAppCheckRevoked_(n.s,n.d):t==="sd"?this.onSecurityDebugPacket_(n):mf("Unrecognized action received from server: "+it(t)+`
Are you using the latest client?`)}onReady_(t,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){M(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=sa,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=sa,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>dA&&(this.reconnectDelay_=sa),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=new Date().getTime()-this.lastConnectionAttemptTime_,n=Math.max(0,this.reconnectDelay_-t);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*hA)}this.onConnectStatus_(!1)}establishConnection_(){return D(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+i.nextConnectionId_++,o=this.lastSessionId,a=!1,c=null,u=function(){c?c.close():(a=!0,s())},d=function(m){M(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(m)};this.realtime_={close:u,sendRequest:d};let f=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[m,_]=yield Promise.all([this.authTokenProvider_.getToken(f),this.appCheckTokenProvider_.getToken(f)]);a?pt("getToken() completed but was canceled"):(pt("getToken() completed. Creating connection."),this.authToken_=m&&m.accessToken,this.appCheckToken_=_&&_.token,c=new Tf(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,n,s,v=>{bt(v+" ("+this.repoInfo_.toString()+")"),this.interrupt(fA)},o))}catch(m){this.log_("Failed to get token: "+m),a||(this.repoInfo_.nodeAdmin&&bt(m),u())}}})}interrupt(t){pt("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){pt("Resuming connection for reason: "+t),delete this.interruptReasons_[t],fc(this.interruptReasons_)&&(this.reconnectDelay_=sa,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let n=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let n=this.outstandingPuts_[t];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,n){let s;n?s=n.map(o=>yp(o)).join("$"):s="default";let r=this.removeListen_(t,s);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(t,n){let s=new Ce(t).toString(),r;if(this.listens.has(s)){let o=this.listens.get(s);r=o.get(n),o.delete(n),o.size===0&&this.listens.delete(s)}else r=void 0;return r}onAuthRevoked_(t,n){pt("Auth token revoked: "+t+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=cE&&(this.reconnectDelay_=lE,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,n){pt("App check token revoked: "+t+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=cE&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let n of t.values())this.sendListen_(n);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},n="js";Fn()&&(this.repoInfo_.nodeAdmin?n="admin_node":n="node"),t["sdk."+n+"."+gp.replace(/\./g,"-")]=1,Xd()?t["framework.cordova"]=1:P0()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=Bc.getInstance().currentlyOnline();return fc(this.interruptReasons_)&&t}}i.nextPersistentConnectionId_=0,i.nextConnectionId_=0;return i})(),pe=class i{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new i(e,t)}};var Ir=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let n=new pe(Vi,e),s=new pe(Vi,t);return this.compare(n,s)!==0}minPost(){return pe.MIN}};var Oc,Uc=class extends Ir{static get __EMPTY_NODE(){return Oc}static set __EMPTY_NODE(e){Oc=e}compare(e,t){return As(e.name,t.name)}isDefinedOn(e){throw gr("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return pe.MIN}maxPost(){return new pe(ui,Oc)}makePost(e,t){return M(typeof e=="string","KeyIndex indexValue must always be a string."),new pe(e,Oc)}toString(){return".key"}},Bn=new Uc;var wr=class{constructor(e,t,n,s,r=null){this.isReverse_=s,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?n(e.key,t):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Cn=(()=>{class i{constructor(t,n,s,r,o){this.key=t,this.value=n,this.color=s??i.RED,this.left=r??hn.EMPTY_NODE,this.right=o??hn.EMPTY_NODE}copy(t,n,s,r,o){return new i(t??this.key,n??this.value,s??this.color,r??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,n,s){let r=this,o=s(t,r.key);return o<0?r=r.copy(null,null,null,r.left.insert(t,n,s),null):o===0?r=r.copy(null,n,null,null,null):r=r.copy(null,null,null,null,r.right.insert(t,n,s)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return hn.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,n){let s,r;if(s=this,n(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(t,n),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),n(t,s.key)===0){if(s.right.isEmpty())return hn.EMPTY_NODE;r=s.right.min_(),s=s.copy(r.key,r.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(t,n))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,i.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,i.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,n)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return i.RED=!0,i.BLACK=!1,i})(),Sf=class{copy(e,t,n,s,r){return this}insert(e,t,n){return new Cn(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},hn=class i{constructor(e,t=i.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new i(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Cn.BLACK,null,null))}remove(e){return new i(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Cn.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),t===0)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,s=null;for(;!n.isEmpty();)if(t=this.comparator_(e,n.key),t===0){if(n.left.isEmpty())return s?s.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}else t<0?n=n.left:t>0&&(s=n,n=n.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new wr(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new wr(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new wr(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new wr(this.root_,null,this.comparator_,!0,e)}};hn.EMPTY_NODE=new Sf;function pA(i,e){return As(i.name,e.name)}function Ip(i,e){return As(i,e)}var bf;function mA(i){bf=i}var JE=function(i){return typeof i=="number"?"number:"+DE(i):"string:"+i},XE=function(i){if(i.isLeafNode()){let e=i.val();M(typeof e=="string"||typeof e=="number"||typeof e=="object"&&ln(e,".sv"),"Priority must be a string or number.")}else M(i===bf||i.isEmpty(),"priority of unexpected type.");M(i===bf||i.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var uE,Cr=(()=>{class i{constructor(t,n=i.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=n,this.lazyHash_=null,M(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),XE(this.priorityNode_)}static set __childrenNodeConstructor(t){uE=t}static get __childrenNodeConstructor(){return uE}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new i(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:i.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return fe(t)?this:de(t)===".priority"?this.priorityNode_:i.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,n){return null}updateImmediateChild(t,n){return t===".priority"?this.updatePriority(n):n.isEmpty()&&t!==".priority"?this:i.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)}updateChild(t,n){let s=de(t);return s===null?n:n.isEmpty()&&s!==".priority"?this:(M(s!==".priority"||Bi(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,i.__childrenNodeConstructor.EMPTY_NODE.updateChild(De(t),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,n){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+JE(this.priorityNode_.val())+":");let n=typeof this.value_;t+=n+":",n==="number"?t+=DE(this.value_):t+=this.value_,this.lazyHash_=PE(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===i.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof i.__childrenNodeConstructor?-1:(M(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let n=typeof t.value_,s=typeof this.value_,r=i.VALUE_TYPE_ORDER.indexOf(n),o=i.VALUE_TYPE_ORDER.indexOf(s);return M(r>=0,"Unknown leaf type: "+n),M(o>=0,"Unknown leaf type: "+s),r===o?s==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-r}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let n=t;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}i.VALUE_TYPE_ORDER=["object","boolean","number","string"];return i})(),ZE,ew;function gA(i){ZE=i}function _A(i){ew=i}var Af=class extends Ir{compare(e,t){let n=e.node.getPriority(),s=t.node.getPriority(),r=n.compareTo(s);return r===0?As(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return pe.MIN}maxPost(){return new pe(ui,new Cr("[PRIORITY-POST]",ew))}makePost(e,t){let n=ZE(e);return new pe(t,new Cr("[PRIORITY-POST]",n))}toString(){return".priority"}},ke=new Af;var yA=Math.log(2),Rf=class{constructor(e){let t=r=>parseInt(Math.log(r)/yA,10),n=r=>parseInt(Array(r+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let s=n(this.count);this.bits_=e+1&s}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},qc=function(i,e,t,n){i.sort(e);let s=function(c,u){let d=u-c,f,m;if(d===0)return null;if(d===1)return f=i[c],m=t?t(f):f,new Cn(m,f.node,Cn.BLACK,null,null);{let _=parseInt(d/2,10)+c,v=s(c,_),C=s(_+1,u);return f=i[_],m=t?t(f):f,new Cn(m,f.node,Cn.BLACK,v,C)}},r=function(c){let u=null,d=null,f=i.length,m=function(v,C){let R=f-v,F=f;f-=v;let V=s(R+1,F),B=i[R],$=t?t(B):B;_(new Cn($,B.node,C,null,V))},_=function(v){u?(u.left=v,u=v):(d=v,u=v)};for(let v=0;v<c.count;++v){let C=c.nextBitIsOne(),R=Math.pow(2,c.count-(v+1));C?m(R,Cn.BLACK):(m(R,Cn.BLACK),m(R,Cn.RED))}return d},o=new Rf(i.length),a=r(o);return new hn(n||e,a)};var lf,vr={},Sr=class i{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return M(vr&&ke,"ChildrenNode.ts has not been loaded"),lf=lf||new i({".priority":vr},{".priority":ke}),lf}get(e){let t=Oi(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof hn?t:null}hasIndex(e){return ln(this.indexSet_,e.toString())}addIndex(e,t){M(e!==Bn,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let n=[],s=!1,r=t.getIterator(pe.Wrap),o=r.getNext();for(;o;)s=s||e.isDefinedOn(o.node),n.push(o),o=r.getNext();let a;s?a=qc(n,e.getCompare()):a=vr;let c=e.toString(),u=Object.assign({},this.indexSet_);u[c]=e;let d=Object.assign({},this.indexes_);return d[c]=a,new i(d,u)}addToIndexes(e,t){let n=ta(this.indexes_,(s,r)=>{let o=Oi(this.indexSet_,r);if(M(o,"Missing index implementation for "+r),s===vr)if(o.isDefinedOn(e.node)){let a=[],c=t.getIterator(pe.Wrap),u=c.getNext();for(;u;)u.name!==e.name&&a.push(u),u=c.getNext();return a.push(e),qc(a,o.getCompare())}else return vr;else{let a=t.get(e.name),c=s;return a&&(c=c.remove(new pe(e.name,a))),c.insert(e,e.node)}});return new i(n,this.indexSet_)}removeFromIndexes(e,t){let n=ta(this.indexes_,s=>{if(s===vr)return s;{let r=t.get(e.name);return r?s.remove(new pe(e.name,r)):s}});return new i(n,this.indexSet_)}};var ra,ae=(()=>{class i{constructor(t,n,s){this.children_=t,this.priorityNode_=n,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&XE(this.priorityNode_),this.children_.isEmpty()&&M(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return ra||(ra=new i(new hn(Ip),null,Sr.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||ra}updatePriority(t){return this.children_.isEmpty()?this:new i(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let n=this.children_.get(t);return n===null?ra:n}}getChild(t){let n=de(t);return n===null?this:this.getImmediateChild(n).getChild(De(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,n){if(M(n,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(n);{let s=new pe(t,n),r,o;n.isEmpty()?(r=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(s,this.children_)):(r=this.children_.insert(t,n),o=this.indexMap_.addToIndexes(s,this.children_));let a=r.isEmpty()?ra:this.priorityNode_;return new i(r,a,o)}}updateChild(t,n){let s=de(t);if(s===null)return n;{M(de(t)!==".priority"||Bi(t)===1,".priority must be the last token in a path");let r=this.getImmediateChild(s).updateChild(De(t),n);return this.updateImmediateChild(s,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let n={},s=0,r=0,o=!0;if(this.forEachChild(ke,(a,c)=>{n[a]=c.val(t),s++,o&&i.INTEGER_REGEXP_.test(a)?r=Math.max(r,Number(a)):o=!1}),!t&&o&&r<2*s){let a=[];for(let c in n)a[c]=n[c];return a}else return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+JE(this.getPriority().val())+":"),this.forEachChild(ke,(n,s)=>{let r=s.hash();r!==""&&(t+=":"+n+":"+r)}),this.lazyHash_=t===""?"":PE(t)}return this.lazyHash_}getPredecessorChildName(t,n,s){let r=this.resolveIndex_(s);if(r){let o=r.getPredecessorKey(new pe(t,n));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let n=this.resolveIndex_(t);if(n){let s=n.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(t){let n=this.getFirstChildName(t);return n?new pe(n,this.children_.get(n)):null}getLastChildName(t){let n=this.resolveIndex_(t);if(n){let s=n.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(t){let n=this.getLastChildName(t);return n?new pe(n,this.children_.get(n)):null}forEachChild(t,n){let s=this.resolveIndex_(t);return s?s.inorderTraversal(r=>n(r.name,r.node)):this.children_.inorderTraversal(n)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,n){let s=this.resolveIndex_(n);if(s)return s.getIteratorFrom(t,r=>r);{let r=this.children_.getIteratorFrom(t.name,pe.Wrap),o=r.peek();for(;o!=null&&n.compare(o,t)<0;)r.getNext(),o=r.peek();return r}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,n){let s=this.resolveIndex_(n);if(s)return s.getReverseIteratorFrom(t,r=>r);{let r=this.children_.getReverseIteratorFrom(t.name,pe.Wrap),o=r.peek();for(;o!=null&&n.compare(o,t)>0;)r.getNext(),o=r.peek();return r}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Ra?-1:0}withIndex(t){if(t===Bn||this.indexMap_.hasIndex(t))return this;{let n=this.indexMap_.addIndex(t,this.children_);return new i(this.children_,this.priorityNode_,n)}}isIndexed(t){return t===Bn||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let n=t;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){let s=this.getIterator(ke),r=n.getIterator(ke),o=s.getNext(),a=r.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=s.getNext(),a=r.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===Bn?null:this.indexMap_.get(t.toString())}}return i.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,i})(),Pf=class extends ae{constructor(){super(new hn(Ip),ae.EMPTY_NODE,Sr.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return ae.EMPTY_NODE}isEmpty(){return!1}},Ra=new Pf;Object.defineProperties(pe,{MIN:{value:new pe(Vi,ae.EMPTY_NODE)},MAX:{value:new pe(ui,Ra)}});Uc.__EMPTY_NODE=ae.EMPTY_NODE;Cr.__childrenNodeConstructor=ae;mA(Ra);_A(Ra);var vA=!0;function Ge(i,e=null){if(i===null)return ae.EMPTY_NODE;if(typeof i=="object"&&".priority"in i&&(e=i[".priority"]),M(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof i=="object"&&".value"in i&&i[".value"]!==null&&(i=i[".value"]),typeof i!="object"||".sv"in i){let t=i;return new Cr(t,Ge(e))}if(!(i instanceof Array)&&vA){let t=[],n=!1;if(mt(i,(o,a)=>{if(o.substring(0,1)!=="."){let c=Ge(a);c.isEmpty()||(n=n||!c.getPriority().isEmpty(),t.push(new pe(o,c)))}}),t.length===0)return ae.EMPTY_NODE;let r=qc(t,pA,o=>o.name,Ip);if(n){let o=qc(t,ke.getCompare());return new ae(r,Ge(e),new Sr({".priority":o},{".priority":ke}))}else return new ae(r,Ge(e),Sr.Default)}else{let t=ae.EMPTY_NODE;return mt(i,(n,s)=>{if(ln(i,n)&&n.substring(0,1)!=="."){let r=Ge(s);(r.isLeafNode()||!r.isEmpty())&&(t=t.updateImmediateChild(n,r))}}),t.updatePriority(Ge(e))}}gA(Ge);var pa=class extends Ir{constructor(e){super(),this.indexPath_=e,M(!fe(e)&&de(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let n=this.extractChild(e.node),s=this.extractChild(t.node),r=n.compareTo(s);return r===0?As(e.name,t.name):r}makePost(e,t){let n=Ge(e),s=ae.EMPTY_NODE.updateChild(this.indexPath_,n);return new pe(t,s)}maxPost(){let e=ae.EMPTY_NODE.updateChild(this.indexPath_,Ra);return new pe(ui,e)}toString(){return fa(this.indexPath_,0).join("/")}};var Nf=class extends Ir{compare(e,t){let n=e.node.compareTo(t.node);return n===0?As(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return pe.MIN}maxPost(){return pe.MAX}makePost(e,t){let n=Ge(e);return new pe(t,n)}toString(){return".value"}},Cp=new Nf;function tw(i){return{type:"value",snapshotNode:i}}function br(i,e){return{type:"child_added",snapshotNode:e,childName:i}}function ma(i,e){return{type:"child_removed",snapshotNode:e,childName:i}}function ga(i,e,t){return{type:"child_changed",snapshotNode:e,childName:i,oldSnap:t}}function EA(i,e){return{type:"child_moved",snapshotNode:e,childName:i}}var _a=class{constructor(e){this.index_=e}updateChild(e,t,n,s,r,o){M(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(s).equals(n.getChild(s))&&a.isEmpty()===n.isEmpty()||(o!=null&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(ma(t,a)):M(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(br(t,n)):o.trackChildChange(ga(t,n,a))),e.isLeafNode()&&n.isEmpty())?e:e.updateImmediateChild(t,n).withIndex(this.index_)}updateFullNode(e,t,n){return n!=null&&(e.isLeafNode()||e.forEachChild(ke,(s,r)=>{t.hasChild(s)||n.trackChildChange(ma(s,r))}),t.isLeafNode()||t.forEachChild(ke,(s,r)=>{if(e.hasChild(s)){let o=e.getImmediateChild(s);o.equals(r)||n.trackChildChange(ga(s,r,o))}else n.trackChildChange(br(s,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?ae.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var jc=class i{constructor(e){this.indexedFilter_=new _a(e.getIndex()),this.index_=e.getIndex(),this.startPost_=i.getStartPost_(e),this.endPost_=i.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,s,r,o){return this.matches(new pe(t,n))||(n=ae.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,s,r,o)}updateFullNode(e,t,n){t.isLeafNode()&&(t=ae.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(ae.EMPTY_NODE);let r=this;return t.forEachChild(ke,(o,a)=>{r.matches(new pe(o,a))||(s=s.updateImmediateChild(o,ae.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var xf=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let n=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?n<=0:n<0},this.withinEndPost=t=>{let n=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?n<=0:n<0},this.rangedFilter_=new jc(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,s,r,o){return this.rangedFilter_.matches(new pe(t,n))||(n=ae.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,s,r,o):this.fullLimitUpdateChild_(e,t,n,r,o)}updateFullNode(e,t,n){let s;if(t.isLeafNode()||t.isEmpty())s=ae.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){s=ae.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){let a=r.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=t.withIndex(this.index_),s=s.updatePriority(ae.EMPTY_NODE);let r;this.reverse_?r=s.getReverseIterator(this.index_):r=s.getIterator(this.index_);let o=0;for(;r.hasNext();){let a=r.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,ae.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,s,r){let o;if(this.reverse_){let f=this.index_.getCompare();o=(m,_)=>f(_,m)}else o=this.index_.getCompare();let a=e;M(a.numChildren()===this.limit_,"");let c=new pe(t,n),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),d=this.rangedFilter_.matches(c);if(a.hasChild(t)){let f=a.getImmediateChild(t),m=s.getChildAfterChild(this.index_,u,this.reverse_);for(;m!=null&&(m.name===t||a.hasChild(m.name));)m=s.getChildAfterChild(this.index_,m,this.reverse_);let _=m==null?1:o(m,c);if(d&&!n.isEmpty()&&_>=0)return r?.trackChildChange(ga(t,n,f)),a.updateImmediateChild(t,n);{r?.trackChildChange(ma(t,f));let C=a.updateImmediateChild(t,ae.EMPTY_NODE);return m!=null&&this.rangedFilter_.matches(m)?(r?.trackChildChange(br(m.name,m.node)),C.updateImmediateChild(m.name,m.node)):C}}else return n.isEmpty()?e:d&&o(u,c)>=0?(r!=null&&(r.trackChildChange(ma(u.name,u.node)),r.trackChildChange(br(t,n))),a.updateImmediateChild(t,n).updateImmediateChild(u.name,ae.EMPTY_NODE)):e}};var ya=class i{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=ke}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return M(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return M(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Vi}hasEnd(){return this.endSet_}getIndexEndValue(){return M(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return M(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ui}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return M(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===ke}copy(){let e=new i;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function wA(i){return i.loadsAllData()?new _a(i.getIndex()):i.hasLimit()?new xf(i):new jc(i)}function TA(i,e){let t=i.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function IA(i,e){let t=i.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function Df(i,e,t){let n=i.copy();return n.startSet_=!0,e===void 0&&(e=null),n.indexStartValue_=e,t!=null?(n.startNameSet_=!0,n.indexStartName_=t):(n.startNameSet_=!1,n.indexStartName_=""),n}function CA(i,e,t){let n;return i.index_===Bn||t?n=Df(i,e,t):n=Df(i,e,ui),n.startAfterSet_=!0,n}function Of(i,e,t){let n=i.copy();return n.endSet_=!0,e===void 0&&(e=null),n.indexEndValue_=e,t!==void 0?(n.endNameSet_=!0,n.indexEndName_=t):(n.endNameSet_=!1,n.indexEndName_=""),n}function SA(i,e,t){let n;return i.index_===Bn||t?n=Of(i,e,t):n=Of(i,e,Vi),n.endBeforeSet_=!0,n}function au(i,e){let t=i.copy();return t.index_=e,t}function hE(i){let e={};if(i.isDefault())return e;let t;if(i.index_===ke?t="$priority":i.index_===Cp?t="$value":i.index_===Bn?t="$key":(M(i.index_ instanceof pa,"Unrecognized index type!"),t=i.index_.toString()),e.orderBy=it(t),i.startSet_){let n=i.startAfterSet_?"startAfter":"startAt";e[n]=it(i.indexStartValue_),i.startNameSet_&&(e[n]+=","+it(i.indexStartName_))}if(i.endSet_){let n=i.endBeforeSet_?"endBefore":"endAt";e[n]=it(i.indexEndValue_),i.endNameSet_&&(e[n]+=","+it(i.indexEndName_))}return i.limitSet_&&(i.isViewFromLeft()?e.limitToFirst=i.limit_:e.limitToLast=i.limit_),e}function dE(i){let e={};if(i.startSet_&&(e.sp=i.indexStartValue_,i.startNameSet_&&(e.sn=i.indexStartName_),e.sin=!i.startAfterSet_),i.endSet_&&(e.ep=i.indexEndValue_,i.endNameSet_&&(e.en=i.indexEndName_),e.ein=!i.endBeforeSet_),i.limitSet_){e.l=i.limit_;let t=i.viewFrom_;t===""&&(i.isViewFromLeft()?t="l":t="r"),e.vf=t}return i.index_!==ke&&(e.i=i.index_.toString()),e}var kf=class i extends Lc{constructor(e,t,n,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=s,this.log_=Aa("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(M(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,s){let r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);let o=i.getListenId_(e,n),a={};this.listens_[o]=a;let c=hE(e._queryParams);this.restRequest_(r+".json",c,(u,d)=>{let f=d;if(u===404&&(f=null,u=null),u===null&&this.onDataUpdate_(r,f,!1,n),Oi(this.listens_,o)===a){let m;u?u===401?m="permission_denied":m="rest_error:"+u:m="ok",s(m,null)}})}unlisten(e,t){let n=i.getListenId_(e,t);delete this.listens_[n]}get(e){let t=hE(e._queryParams),n=e._path.toString(),s=new kt;return this.restRequest_(n+".json",t,(r,o)=>{let a=o;r===404&&(a=null,r=null),r===null?(this.onDataUpdate_(n,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,r])=>{s&&s.accessToken&&(t.auth=s.accessToken),r&&r.token&&(t.ac=r.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+k0(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(n&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=dc(a.responseText)}catch{bt("Failed to parse JSON response for "+o+": "+a.responseText)}n(null,c)}else a.status!==401&&a.status!==404&&bt("Got unsuccessful REST response for "+o+" Status: "+a.status),n(a.status);n=null}},a.open("GET",o,!0),a.send()})}};var Mf=class{constructor(){this.rootNode_=ae.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function Gc(){return{value:null,children:new Map}}function Dr(i,e,t){if(fe(e))i.value=t,i.children.clear();else if(i.value!==null)i.value=i.value.updateChild(e,t);else{let n=de(e);i.children.has(n)||i.children.set(n,Gc());let s=i.children.get(n);e=De(e),Dr(s,e,t)}}function Ff(i,e){if(fe(e))return i.value=null,i.children.clear(),!0;if(i.value!==null){if(i.value.isLeafNode())return!1;{let t=i.value;return i.value=null,t.forEachChild(ke,(n,s)=>{Dr(i,new Ce(n),s)}),Ff(i,e)}}else if(i.children.size>0){let t=de(e);return e=De(e),i.children.has(t)&&Ff(i.children.get(t),e)&&i.children.delete(t),i.children.size===0}else return!0}function Lf(i,e,t){i.value!==null?t(e,i.value):bA(i,(n,s)=>{let r=new Ce(e.toString()+"/"+n);Lf(s,r,t)})}function bA(i,e){i.children.forEach((t,n)=>{e(n,t)})}var Vf=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&mt(this.last_,(n,s)=>{t[n]=t[n]-s}),this.last_=e,t}};var fE=10*1e3,AA=30*1e3,RA=5*60*1e3,Bf=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Vf(e);let n=fE+(AA-fE)*Math.random();aa(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){let e=this.statsListener_.get(),t={},n=!1;mt(e,(s,r)=>{r>0&&ln(this.statsToReport_,s)&&(t[s]=r,n=!0)}),n&&this.server_.reportStats(t),aa(this.reportStats_.bind(this),Math.floor(Math.random()*2*RA))}};var Vn=function(i){return i[i.OVERWRITE=0]="OVERWRITE",i[i.MERGE=1]="MERGE",i[i.ACK_USER_WRITE=2]="ACK_USER_WRITE",i[i.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",i}(Vn||{});function Sp(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function bp(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Ap(i){return{fromUser:!1,fromServer:!0,queryId:i,tagged:!0}}var Uf=class i{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=Vn.ACK_USER_WRITE,this.source=Sp()}operationForChild(e){if(fe(this.path)){if(this.affectedTree.value!=null)return M(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new Ce(e));return new i(Ie(),t,this.revert)}}else return M(de(this.path)===e,"operationForChild called for unrelated child."),new i(De(this.path),this.affectedTree,this.revert)}};var Wc=class i{constructor(e,t){this.source=e,this.path=t,this.type=Vn.LISTEN_COMPLETE}operationForChild(e){return fe(this.path)?new i(this.source,Ie()):new i(this.source,De(this.path))}};var Ar=class i{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=Vn.OVERWRITE}operationForChild(e){return fe(this.path)?new i(this.source,Ie(),this.snap.getImmediateChild(e)):new i(this.source,De(this.path),this.snap)}};var va=class i{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=Vn.MERGE}operationForChild(e){if(fe(this.path)){let t=this.children.subtree(new Ce(e));return t.isEmpty()?null:t.value?new Ar(this.source,Ie(),t.value):new i(this.source,Ie(),t)}else return M(de(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new i(this.source,De(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var qn=class{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(fe(e))return this.isFullyInitialized()&&!this.filtered_;let t=de(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var qf=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function PA(i,e,t,n){let s=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&i.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(EA(o.childName,o.snapshotNode))}),oa(i,s,"child_removed",e,n,t),oa(i,s,"child_added",e,n,t),oa(i,s,"child_moved",r,n,t),oa(i,s,"child_changed",e,n,t),oa(i,s,"value",e,n,t),s}function oa(i,e,t,n,s,r){let o=n.filter(a=>a.type===t);o.sort((a,c)=>xA(i,a,c)),o.forEach(a=>{let c=NA(i,a,r);s.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(c,i.query_))})})}function NA(i,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,i.index_)),e}function xA(i,e,t){if(e.childName==null||t.childName==null)throw gr("Should only compare child_ events.");let n=new pe(e.childName,e.snapshotNode),s=new pe(t.childName,t.snapshotNode);return i.index_.compare(n,s)}function lu(i,e){return{eventCache:i,serverCache:e}}function ca(i,e,t,n){return lu(new qn(e,t,n),i.serverCache)}function nw(i,e,t,n){return lu(i.eventCache,new qn(e,t,n))}function zc(i){return i.eventCache.isFullyInitialized()?i.eventCache.getNode():null}function bs(i){return i.serverCache.isFullyInitialized()?i.serverCache.getNode():null}var cf,DA=()=>(cf||(cf=new hn(N1)),cf),Ft=class i{constructor(e,t=DA()){this.value=e,this.children=t}static fromObject(e){let t=new i(null);return mt(e,(n,s)=>{t=t.set(new Ce(n),s)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:Ie(),value:this.value};if(fe(e))return null;{let n=de(e),s=this.children.get(n);if(s!==null){let r=s.findRootMostMatchingPathAndValue(De(e),t);return r!=null?{path:qe(new Ce(n),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(fe(e))return this;{let t=de(e),n=this.children.get(t);return n!==null?n.subtree(De(e)):new i(null)}}set(e,t){if(fe(e))return new i(t,this.children);{let n=de(e),r=(this.children.get(n)||new i(null)).set(De(e),t),o=this.children.insert(n,r);return new i(this.value,o)}}remove(e){if(fe(e))return this.children.isEmpty()?new i(null):new i(null,this.children);{let t=de(e),n=this.children.get(t);if(n){let s=n.remove(De(e)),r;return s.isEmpty()?r=this.children.remove(t):r=this.children.insert(t,s),this.value===null&&r.isEmpty()?new i(null):new i(this.value,r)}else return this}}get(e){if(fe(e))return this.value;{let t=de(e),n=this.children.get(t);return n?n.get(De(e)):null}}setTree(e,t){if(fe(e))return t;{let n=de(e),r=(this.children.get(n)||new i(null)).setTree(De(e),t),o;return r.isEmpty()?o=this.children.remove(n):o=this.children.insert(n,r),new i(this.value,o)}}fold(e){return this.fold_(Ie(),e)}fold_(e,t){let n={};return this.children.inorderTraversal((s,r)=>{n[s]=r.fold_(qe(e,s),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,Ie(),t)}findOnPath_(e,t,n){let s=this.value?n(t,this.value):!1;if(s)return s;if(fe(e))return null;{let r=de(e),o=this.children.get(r);return o?o.findOnPath_(De(e),qe(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Ie(),t)}foreachOnPath_(e,t,n){if(fe(e))return this;{this.value&&n(t,this.value);let s=de(e),r=this.children.get(s);return r?r.foreachOnPath_(De(e),qe(t,s),n):new i(null)}}foreach(e){this.foreach_(Ie(),e)}foreach_(e,t){this.children.inorderTraversal((n,s)=>{s.foreach_(qe(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}};var Sn=class i{constructor(e){this.writeTree_=e}static empty(){return new i(new Ft(null))}};function ua(i,e,t){if(fe(e))return new Sn(new Ft(t));{let n=i.writeTree_.findRootMostValueAndPath(e);if(n!=null){let s=n.path,r=n.value,o=Mt(s,e);return r=r.updateChild(o,t),new Sn(i.writeTree_.set(s,r))}else{let s=new Ft(t),r=i.writeTree_.setTree(e,s);return new Sn(r)}}}function jf(i,e,t){let n=i;return mt(t,(s,r)=>{n=ua(n,qe(e,s),r)}),n}function pE(i,e){if(fe(e))return Sn.empty();{let t=i.writeTree_.setTree(e,new Ft(null));return new Sn(t)}}function Gf(i,e){return Rs(i,e)!=null}function Rs(i,e){let t=i.writeTree_.findRootMostValueAndPath(e);return t!=null?i.writeTree_.get(t.path).getChild(Mt(t.path,e)):null}function mE(i){let e=[],t=i.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(ke,(n,s)=>{e.push(new pe(n,s))}):i.writeTree_.children.inorderTraversal((n,s)=>{s.value!=null&&e.push(new pe(n,s.value))}),e}function Fi(i,e){if(fe(e))return i;{let t=Rs(i,e);return t!=null?new Sn(new Ft(t)):new Sn(i.writeTree_.subtree(e))}}function Wf(i){return i.writeTree_.isEmpty()}function Rr(i,e){return iw(Ie(),i.writeTree_,e)}function iw(i,e,t){if(e.value!=null)return t.updateChild(i,e.value);{let n=null;return e.children.inorderTraversal((s,r)=>{s===".priority"?(M(r.value!==null,"Priority writes must always be leaf nodes"),n=r.value):t=iw(qe(i,s),r,t)}),!t.getChild(i).isEmpty()&&n!==null&&(t=t.updateChild(qe(i,".priority"),n)),t}}function cu(i,e){return aw(e,i)}function OA(i,e,t,n,s){M(n>i.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),i.allWrites.push({path:e,snap:t,writeId:n,visible:s}),s&&(i.visibleWrites=ua(i.visibleWrites,e,t)),i.lastWriteId=n}function kA(i,e,t,n){M(n>i.lastWriteId,"Stacking an older merge on top of newer ones"),i.allWrites.push({path:e,children:t,writeId:n,visible:!0}),i.visibleWrites=jf(i.visibleWrites,e,t),i.lastWriteId=n}function MA(i,e){for(let t=0;t<i.allWrites.length;t++){let n=i.allWrites[t];if(n.writeId===e)return n}return null}function FA(i,e){let t=i.allWrites.findIndex(a=>a.writeId===e);M(t>=0,"removeWrite called with nonexistent writeId.");let n=i.allWrites[t];i.allWrites.splice(t,1);let s=n.visible,r=!1,o=i.allWrites.length-1;for(;s&&o>=0;){let a=i.allWrites[o];a.visible&&(o>=t&&LA(a,n.path)?s=!1:un(n.path,a.path)&&(r=!0)),o--}if(s){if(r)return VA(i),!0;if(n.snap)i.visibleWrites=pE(i.visibleWrites,n.path);else{let a=n.children;mt(a,c=>{i.visibleWrites=pE(i.visibleWrites,qe(n.path,c))})}return!0}else return!1}function LA(i,e){if(i.snap)return un(i.path,e);for(let t in i.children)if(i.children.hasOwnProperty(t)&&un(qe(i.path,t),e))return!0;return!1}function VA(i){i.visibleWrites=sw(i.allWrites,BA,Ie()),i.allWrites.length>0?i.lastWriteId=i.allWrites[i.allWrites.length-1].writeId:i.lastWriteId=-1}function BA(i){return i.visible}function sw(i,e,t){let n=Sn.empty();for(let s=0;s<i.length;++s){let r=i[s];if(e(r)){let o=r.path,a;if(r.snap)un(t,o)?(a=Mt(t,o),n=ua(n,a,r.snap)):un(o,t)&&(a=Mt(o,t),n=ua(n,Ie(),r.snap.getChild(a)));else if(r.children){if(un(t,o))a=Mt(t,o),n=jf(n,a,r.children);else if(un(o,t))if(a=Mt(o,t),fe(a))n=jf(n,Ie(),r.children);else{let c=Oi(r.children,de(a));if(c){let u=c.getChild(De(a));n=ua(n,Ie(),u)}}}else throw gr("WriteRecord should have .snap or .children")}}return n}function rw(i,e,t,n,s){if(!n&&!s){let r=Rs(i.visibleWrites,e);if(r!=null)return r;{let o=Fi(i.visibleWrites,e);if(Wf(o))return t;if(t==null&&!Gf(o,Ie()))return null;{let a=t||ae.EMPTY_NODE;return Rr(o,a)}}}else{let r=Fi(i.visibleWrites,e);if(!s&&Wf(r))return t;if(!s&&t==null&&!Gf(r,Ie()))return null;{let o=function(u){return(u.visible||s)&&(!n||!~n.indexOf(u.writeId))&&(un(u.path,e)||un(e,u.path))},a=sw(i.allWrites,o,e),c=t||ae.EMPTY_NODE;return Rr(a,c)}}}function UA(i,e,t){let n=ae.EMPTY_NODE,s=Rs(i.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(ke,(r,o)=>{n=n.updateImmediateChild(r,o)}),n;if(t){let r=Fi(i.visibleWrites,e);return t.forEachChild(ke,(o,a)=>{let c=Rr(Fi(r,new Ce(o)),a);n=n.updateImmediateChild(o,c)}),mE(r).forEach(o=>{n=n.updateImmediateChild(o.name,o.node)}),n}else{let r=Fi(i.visibleWrites,e);return mE(r).forEach(o=>{n=n.updateImmediateChild(o.name,o.node)}),n}}function qA(i,e,t,n,s){M(n||s,"Either existingEventSnap or existingServerSnap must exist");let r=qe(e,t);if(Gf(i.visibleWrites,r))return null;{let o=Fi(i.visibleWrites,r);return Wf(o)?s.getChild(t):Rr(o,s.getChild(t))}}function jA(i,e,t,n){let s=qe(e,t),r=Rs(i.visibleWrites,s);if(r!=null)return r;if(n.isCompleteForChild(t)){let o=Fi(i.visibleWrites,s);return Rr(o,n.getNode().getImmediateChild(t))}else return null}function GA(i,e){return Rs(i.visibleWrites,e)}function WA(i,e,t,n,s,r,o){let a,c=Fi(i.visibleWrites,e),u=Rs(c,Ie());if(u!=null)a=u;else if(t!=null)a=Rr(c,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let d=[],f=o.getCompare(),m=r?a.getReverseIteratorFrom(n,o):a.getIteratorFrom(n,o),_=m.getNext();for(;_&&d.length<s;)f(_,n)!==0&&d.push(_),_=m.getNext();return d}else return[]}function zA(){return{visibleWrites:Sn.empty(),allWrites:[],lastWriteId:-1}}function Kc(i,e,t,n){return rw(i.writeTree,i.treePath,e,t,n)}function Rp(i,e){return UA(i.writeTree,i.treePath,e)}function gE(i,e,t,n){return qA(i.writeTree,i.treePath,e,t,n)}function Hc(i,e){return GA(i.writeTree,qe(i.treePath,e))}function KA(i,e,t,n,s,r){return WA(i.writeTree,i.treePath,e,t,n,s,r)}function Pp(i,e,t){return jA(i.writeTree,i.treePath,e,t)}function ow(i,e){return aw(qe(i.treePath,e),i.writeTree)}function aw(i,e){return{treePath:i,writeTree:e}}var zf=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,n=e.childName;M(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),M(n!==".priority","Only non-priority child changes can be tracked.");let s=this.changeMap.get(n);if(s){let r=s.type;if(t==="child_added"&&r==="child_removed")this.changeMap.set(n,ga(n,e.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&r==="child_added")this.changeMap.delete(n);else if(t==="child_removed"&&r==="child_changed")this.changeMap.set(n,ma(n,s.oldSnap));else if(t==="child_changed"&&r==="child_added")this.changeMap.set(n,br(n,e.snapshotNode));else if(t==="child_changed"&&r==="child_changed")this.changeMap.set(n,ga(n,e.snapshotNode,s.oldSnap));else throw gr("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}};var Kf=class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}},lw=new Kf,Ea=class{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let n=this.optCompleteServerCache_!=null?new qn(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Pp(this.writes_,e,n)}}getChildAfterChild(e,t,n){let s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:bs(this.viewCache_),r=KA(this.writes_,s,t,1,n,e);return r.length===0?null:r[0]}};function HA(i){return{filter:i}}function QA(i,e){M(e.eventCache.getNode().isIndexed(i.filter.getIndex()),"Event snap not indexed"),M(e.serverCache.getNode().isIndexed(i.filter.getIndex()),"Server snap not indexed")}function $A(i,e,t,n,s){let r=new zf,o,a;if(t.type===Vn.OVERWRITE){let u=t;u.source.fromUser?o=Hf(i,e,u.path,u.snap,n,s,r):(M(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!fe(u.path),o=Qc(i,e,u.path,u.snap,n,s,a,r))}else if(t.type===Vn.MERGE){let u=t;u.source.fromUser?o=JA(i,e,u.path,u.children,n,s,r):(M(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=Qf(i,e,u.path,u.children,n,s,a,r))}else if(t.type===Vn.ACK_USER_WRITE){let u=t;u.revert?o=eR(i,e,u.path,n,s,r):o=XA(i,e,u.path,u.affectedTree,n,s,r)}else if(t.type===Vn.LISTEN_COMPLETE)o=ZA(i,e,t.path,n,r);else throw gr("Unknown operation type: "+t.type);let c=r.getChanges();return YA(e,o,c),{viewCache:o,changes:c}}function YA(i,e,t){let n=e.eventCache;if(n.isFullyInitialized()){let s=n.getNode().isLeafNode()||n.getNode().isEmpty(),r=zc(i);(t.length>0||!i.eventCache.isFullyInitialized()||s&&!n.getNode().equals(r)||!n.getNode().getPriority().equals(r.getPriority()))&&t.push(tw(zc(e)))}}function cw(i,e,t,n,s,r){let o=e.eventCache;if(Hc(n,t)!=null)return e;{let a,c;if(fe(t))if(M(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let u=bs(e),d=u instanceof ae?u:ae.EMPTY_NODE,f=Rp(n,d);a=i.filter.updateFullNode(e.eventCache.getNode(),f,r)}else{let u=Kc(n,bs(e));a=i.filter.updateFullNode(e.eventCache.getNode(),u,r)}else{let u=de(t);if(u===".priority"){M(Bi(t)===1,"Can't have a priority with additional path components");let d=o.getNode();c=e.serverCache.getNode();let f=gE(n,t,d,c);f!=null?a=i.filter.updatePriority(d,f):a=o.getNode()}else{let d=De(t),f;if(o.isCompleteForChild(u)){c=e.serverCache.getNode();let m=gE(n,t,o.getNode(),c);m!=null?f=o.getNode().getImmediateChild(u).updateChild(d,m):f=o.getNode().getImmediateChild(u)}else f=Pp(n,u,e.serverCache);f!=null?a=i.filter.updateChild(o.getNode(),u,f,d,s,r):a=o.getNode()}}return ca(e,a,o.isFullyInitialized()||fe(t),i.filter.filtersNodes())}}function Qc(i,e,t,n,s,r,o,a){let c=e.serverCache,u,d=o?i.filter:i.filter.getIndexedFilter();if(fe(t))u=d.updateFullNode(c.getNode(),n,null);else if(d.filtersNodes()&&!c.isFiltered()){let _=c.getNode().updateChild(t,n);u=d.updateFullNode(c.getNode(),_,null)}else{let _=de(t);if(!c.isCompleteForPath(t)&&Bi(t)>1)return e;let v=De(t),R=c.getNode().getImmediateChild(_).updateChild(v,n);_===".priority"?u=d.updatePriority(c.getNode(),R):u=d.updateChild(c.getNode(),_,R,v,lw,null)}let f=nw(e,u,c.isFullyInitialized()||fe(t),d.filtersNodes()),m=new Ea(s,f,r);return cw(i,f,t,s,m,a)}function Hf(i,e,t,n,s,r,o){let a=e.eventCache,c,u,d=new Ea(s,e,r);if(fe(t))u=i.filter.updateFullNode(e.eventCache.getNode(),n,o),c=ca(e,u,!0,i.filter.filtersNodes());else{let f=de(t);if(f===".priority")u=i.filter.updatePriority(e.eventCache.getNode(),n),c=ca(e,u,a.isFullyInitialized(),a.isFiltered());else{let m=De(t),_=a.getNode().getImmediateChild(f),v;if(fe(m))v=n;else{let C=d.getCompleteChild(f);C!=null?Ep(m)===".priority"&&C.getChild($E(m)).isEmpty()?v=C:v=C.updateChild(m,n):v=ae.EMPTY_NODE}if(_.equals(v))c=e;else{let C=i.filter.updateChild(a.getNode(),f,v,m,d,o);c=ca(e,C,a.isFullyInitialized(),i.filter.filtersNodes())}}}return c}function _E(i,e){return i.eventCache.isCompleteForChild(e)}function JA(i,e,t,n,s,r,o){let a=e;return n.foreach((c,u)=>{let d=qe(t,c);_E(e,de(d))&&(a=Hf(i,a,d,u,s,r,o))}),n.foreach((c,u)=>{let d=qe(t,c);_E(e,de(d))||(a=Hf(i,a,d,u,s,r,o))}),a}function yE(i,e,t){return t.foreach((n,s)=>{e=e.updateChild(n,s)}),e}function Qf(i,e,t,n,s,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,u;fe(t)?u=n:u=new Ft(null).setTree(t,n);let d=e.serverCache.getNode();return u.children.inorderTraversal((f,m)=>{if(d.hasChild(f)){let _=e.serverCache.getNode().getImmediateChild(f),v=yE(i,_,m);c=Qc(i,c,new Ce(f),v,s,r,o,a)}}),u.children.inorderTraversal((f,m)=>{let _=!e.serverCache.isCompleteForChild(f)&&m.value===null;if(!d.hasChild(f)&&!_){let v=e.serverCache.getNode().getImmediateChild(f),C=yE(i,v,m);c=Qc(i,c,new Ce(f),C,s,r,o,a)}}),c}function XA(i,e,t,n,s,r,o){if(Hc(s,t)!=null)return e;let a=e.serverCache.isFiltered(),c=e.serverCache;if(n.value!=null){if(fe(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return Qc(i,e,t,c.getNode().getChild(t),s,r,a,o);if(fe(t)){let u=new Ft(null);return c.getNode().forEachChild(Bn,(d,f)=>{u=u.set(new Ce(d),f)}),Qf(i,e,t,u,s,r,a,o)}else return e}else{let u=new Ft(null);return n.foreach((d,f)=>{let m=qe(t,d);c.isCompleteForPath(m)&&(u=u.set(d,c.getNode().getChild(m)))}),Qf(i,e,t,u,s,r,a,o)}}function ZA(i,e,t,n,s){let r=e.serverCache,o=nw(e,r.getNode(),r.isFullyInitialized()||fe(t),r.isFiltered());return cw(i,o,t,n,lw,s)}function eR(i,e,t,n,s,r){let o;if(Hc(n,t)!=null)return e;{let a=new Ea(n,e,s),c=e.eventCache.getNode(),u;if(fe(t)||de(t)===".priority"){let d;if(e.serverCache.isFullyInitialized())d=Kc(n,bs(e));else{let f=e.serverCache.getNode();M(f instanceof ae,"serverChildren would be complete if leaf node"),d=Rp(n,f)}d=d,u=i.filter.updateFullNode(c,d,r)}else{let d=de(t),f=Pp(n,d,e.serverCache);f==null&&e.serverCache.isCompleteForChild(d)&&(f=c.getImmediateChild(d)),f!=null?u=i.filter.updateChild(c,d,f,De(t),a,r):e.eventCache.getNode().hasChild(d)?u=i.filter.updateChild(c,d,ae.EMPTY_NODE,De(t),a,r):u=c,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Kc(n,bs(e)),o.isLeafNode()&&(u=i.filter.updateFullNode(u,o,r)))}return o=e.serverCache.isFullyInitialized()||Hc(n,Ie())!=null,ca(e,u,o,i.filter.filtersNodes())}}var $f=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let n=this.query_._queryParams,s=new _a(n.getIndex()),r=wA(n);this.processor_=HA(r);let o=t.serverCache,a=t.eventCache,c=s.updateFullNode(ae.EMPTY_NODE,o.getNode(),null),u=r.updateFullNode(ae.EMPTY_NODE,a.getNode(),null),d=new qn(c,o.isFullyInitialized(),s.filtersNodes()),f=new qn(u,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=lu(f,d),this.eventGenerator_=new qf(this.query_)}get query(){return this.query_}};function tR(i){return i.viewCache_.serverCache.getNode()}function nR(i){return zc(i.viewCache_)}function iR(i,e){let t=bs(i.viewCache_);return t&&(i.query._queryParams.loadsAllData()||!fe(e)&&!t.getImmediateChild(de(e)).isEmpty())?t.getChild(e):null}function vE(i){return i.eventRegistrations_.length===0}function sR(i,e){i.eventRegistrations_.push(e)}function EE(i,e,t){let n=[];if(t){M(e==null,"A cancel should cancel all event registrations.");let s=i.query._path;i.eventRegistrations_.forEach(r=>{let o=r.createCancelEvent(t,s);o&&n.push(o)})}if(e){let s=[];for(let r=0;r<i.eventRegistrations_.length;++r){let o=i.eventRegistrations_[r];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(i.eventRegistrations_.slice(r+1));break}}i.eventRegistrations_=s}else i.eventRegistrations_=[];return n}function wE(i,e,t,n){e.type===Vn.MERGE&&e.source.queryId!==null&&(M(bs(i.viewCache_),"We should always have a full cache before handling merges"),M(zc(i.viewCache_),"Missing event cache, even though we have a server cache"));let s=i.viewCache_,r=$A(i.processor_,s,e,t,n);return QA(i.processor_,r.viewCache),M(r.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),i.viewCache_=r.viewCache,uw(i,r.changes,r.viewCache.eventCache.getNode(),null)}function rR(i,e){let t=i.viewCache_.eventCache,n=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(ke,(r,o)=>{n.push(br(r,o))}),t.isFullyInitialized()&&n.push(tw(t.getNode())),uw(i,n,t.getNode(),e)}function uw(i,e,t,n){let s=n?[n]:i.eventRegistrations_;return PA(i.eventGenerator_,e,t,s)}var $c,Yc=class{constructor(){this.views=new Map}};function oR(i){M(!$c,"__referenceConstructor has already been defined"),$c=i}function aR(){return M($c,"Reference.ts has not been loaded"),$c}function lR(i){return i.views.size===0}function Np(i,e,t,n){let s=e.source.queryId;if(s!==null){let r=i.views.get(s);return M(r!=null,"SyncTree gave us an op for an invalid query."),wE(r,e,t,n)}else{let r=[];for(let o of i.views.values())r=r.concat(wE(o,e,t,n));return r}}function hw(i,e,t,n,s){let r=e._queryIdentifier,o=i.views.get(r);if(!o){let a=Kc(t,s?n:null),c=!1;a?c=!0:n instanceof ae?(a=Rp(t,n),c=!1):(a=ae.EMPTY_NODE,c=!1);let u=lu(new qn(a,c,!1),new qn(n,s,!1));return new $f(e,u)}return o}function cR(i,e,t,n,s,r){let o=hw(i,e,n,s,r);return i.views.has(e._queryIdentifier)||i.views.set(e._queryIdentifier,o),sR(o,t),rR(o,t)}function uR(i,e,t,n){let s=e._queryIdentifier,r=[],o=[],a=Ui(i);if(s==="default")for(let[c,u]of i.views.entries())o=o.concat(EE(u,t,n)),vE(u)&&(i.views.delete(c),u.query._queryParams.loadsAllData()||r.push(u.query));else{let c=i.views.get(s);c&&(o=o.concat(EE(c,t,n)),vE(c)&&(i.views.delete(s),c.query._queryParams.loadsAllData()||r.push(c.query)))}return a&&!Ui(i)&&r.push(new(aR())(e._repo,e._path)),{removed:r,events:o}}function dw(i){let e=[];for(let t of i.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Li(i,e){let t=null;for(let n of i.views.values())t=t||iR(n,e);return t}function fw(i,e){if(e._queryParams.loadsAllData())return uu(i);{let n=e._queryIdentifier;return i.views.get(n)}}function pw(i,e){return fw(i,e)!=null}function Ui(i){return uu(i)!=null}function uu(i){for(let e of i.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var Jc;function hR(i){M(!Jc,"__referenceConstructor has already been defined"),Jc=i}function dR(){return M(Jc,"Reference.ts has not been loaded"),Jc}var fR=1,Xc=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Ft(null),this.pendingWriteTree_=zA(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function xp(i,e,t,n,s){return OA(i.pendingWriteTree_,e,t,n,s),s?Or(i,new Ar(Sp(),e,t)):[]}function pR(i,e,t,n){kA(i.pendingWriteTree_,e,t,n);let s=Ft.fromObject(t);return Or(i,new va(Sp(),e,s))}function Mi(i,e,t=!1){let n=MA(i.pendingWriteTree_,e);if(FA(i.pendingWriteTree_,e)){let r=new Ft(null);return n.snap!=null?r=r.set(Ie(),!0):mt(n.children,o=>{r=r.set(new Ce(o),!0)}),Or(i,new Uf(n.path,r,t))}else return[]}function Pa(i,e,t){return Or(i,new Ar(bp(),e,t))}function mR(i,e,t){let n=Ft.fromObject(t);return Or(i,new va(bp(),e,n))}function gR(i,e){return Or(i,new Wc(bp(),e))}function _R(i,e,t){let n=Dp(i,t);if(n){let s=Op(n),r=s.path,o=s.queryId,a=Mt(r,e),c=new Wc(Ap(o),a);return kp(i,r,c)}else return[]}function Zc(i,e,t,n,s=!1){let r=e._path,o=i.syncPointTree_.get(r),a=[];if(o&&(e._queryIdentifier==="default"||pw(o,e))){let c=uR(o,e,t,n);lR(o)&&(i.syncPointTree_=i.syncPointTree_.remove(r));let u=c.removed;if(a=c.events,!s){let d=u.findIndex(m=>m._queryParams.loadsAllData())!==-1,f=i.syncPointTree_.findOnPath(r,(m,_)=>Ui(_));if(d&&!f){let m=i.syncPointTree_.subtree(r);if(!m.isEmpty()){let _=ER(m);for(let v=0;v<_.length;++v){let C=_[v],R=C.query,F=yw(i,C);i.listenProvider_.startListening(ha(R),wa(i,R),F.hashFn,F.onComplete)}}}!f&&u.length>0&&!n&&(d?i.listenProvider_.stopListening(ha(e),null):u.forEach(m=>{let _=i.queryToTagMap.get(du(m));i.listenProvider_.stopListening(ha(m),_)}))}wR(i,u)}return a}function mw(i,e,t,n){let s=Dp(i,n);if(s!=null){let r=Op(s),o=r.path,a=r.queryId,c=Mt(o,e),u=new Ar(Ap(a),c,t);return kp(i,o,u)}else return[]}function yR(i,e,t,n){let s=Dp(i,n);if(s){let r=Op(s),o=r.path,a=r.queryId,c=Mt(o,e),u=Ft.fromObject(t),d=new va(Ap(a),c,u);return kp(i,o,d)}else return[]}function Yf(i,e,t,n=!1){let s=e._path,r=null,o=!1;i.syncPointTree_.foreachOnPath(s,(m,_)=>{let v=Mt(m,s);r=r||Li(_,v),o=o||Ui(_)});let a=i.syncPointTree_.get(s);a?(o=o||Ui(a),r=r||Li(a,Ie())):(a=new Yc,i.syncPointTree_=i.syncPointTree_.set(s,a));let c;r!=null?c=!0:(c=!1,r=ae.EMPTY_NODE,i.syncPointTree_.subtree(s).foreachChild((_,v)=>{let C=Li(v,Ie());C&&(r=r.updateImmediateChild(_,C))}));let u=pw(a,e);if(!u&&!e._queryParams.loadsAllData()){let m=du(e);M(!i.queryToTagMap.has(m),"View does not exist, but we have a tag");let _=TR();i.queryToTagMap.set(m,_),i.tagToQueryMap.set(_,m)}let d=cu(i.pendingWriteTree_,s),f=cR(a,e,t,d,r,c);if(!u&&!o&&!n){let m=fw(a,e);f=f.concat(IR(i,e,m))}return f}function hu(i,e,t){let s=i.pendingWriteTree_,r=i.syncPointTree_.findOnPath(e,(o,a)=>{let c=Mt(o,e),u=Li(a,c);if(u)return u});return rw(s,e,r,t,!0)}function vR(i,e){let t=e._path,n=null;i.syncPointTree_.foreachOnPath(t,(u,d)=>{let f=Mt(u,t);n=n||Li(d,f)});let s=i.syncPointTree_.get(t);s?n=n||Li(s,Ie()):(s=new Yc,i.syncPointTree_=i.syncPointTree_.set(t,s));let r=n!=null,o=r?new qn(n,!0,!1):null,a=cu(i.pendingWriteTree_,e._path),c=hw(s,e,a,r?o.getNode():ae.EMPTY_NODE,r);return nR(c)}function Or(i,e){return gw(e,i.syncPointTree_,null,cu(i.pendingWriteTree_,Ie()))}function gw(i,e,t,n){if(fe(i.path))return _w(i,e,t,n);{let s=e.get(Ie());t==null&&s!=null&&(t=Li(s,Ie()));let r=[],o=de(i.path),a=i.operationForChild(o),c=e.children.get(o);if(c&&a){let u=t?t.getImmediateChild(o):null,d=ow(n,o);r=r.concat(gw(a,c,u,d))}return s&&(r=r.concat(Np(s,i,n,t))),r}}function _w(i,e,t,n){let s=e.get(Ie());t==null&&s!=null&&(t=Li(s,Ie()));let r=[];return e.children.inorderTraversal((o,a)=>{let c=t?t.getImmediateChild(o):null,u=ow(n,o),d=i.operationForChild(o);d&&(r=r.concat(_w(d,a,c,u)))}),s&&(r=r.concat(Np(s,i,n,t))),r}function yw(i,e){let t=e.query,n=wa(i,t);return{hashFn:()=>(tR(e)||ae.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return n?_R(i,t._path,n):gR(i,t._path);{let r=O1(s,t);return Zc(i,t,null,r)}}}}function wa(i,e){let t=du(e);return i.queryToTagMap.get(t)}function du(i){return i._path.toString()+"$"+i._queryIdentifier}function Dp(i,e){return i.tagToQueryMap.get(e)}function Op(i){let e=i.indexOf("$");return M(e!==-1&&e<i.length-1,"Bad queryKey."),{queryId:i.substr(e+1),path:new Ce(i.substr(0,e))}}function kp(i,e,t){let n=i.syncPointTree_.get(e);M(n,"Missing sync point for query tag that we're tracking");let s=cu(i.pendingWriteTree_,e);return Np(n,t,s,null)}function ER(i){return i.fold((e,t,n)=>{if(t&&Ui(t))return[uu(t)];{let s=[];return t&&(s=dw(t)),mt(n,(r,o)=>{s=s.concat(o)}),s}})}function ha(i){return i._queryParams.loadsAllData()&&!i._queryParams.isDefault()?new(dR())(i._repo,i._path):i}function wR(i,e){for(let t=0;t<e.length;++t){let n=e[t];if(!n._queryParams.loadsAllData()){let s=du(n),r=i.queryToTagMap.get(s);i.queryToTagMap.delete(s),i.tagToQueryMap.delete(r)}}}function TR(){return fR++}function IR(i,e,t){let n=e._path,s=wa(i,e),r=yw(i,t),o=i.listenProvider_.startListening(ha(e),s,r.hashFn,r.onComplete),a=i.syncPointTree_.subtree(n);if(s)M(!Ui(a.value),"If we're adding a query, it shouldn't be shadowed");else{let c=a.fold((u,d,f)=>{if(!fe(u)&&d&&Ui(d))return[uu(d).query];{let m=[];return d&&(m=m.concat(dw(d).map(_=>_.query))),mt(f,(_,v)=>{m=m.concat(v)}),m}});for(let u=0;u<c.length;++u){let d=c[u];i.listenProvider_.stopListening(ha(d),wa(i,d))}}return o}var Jf=class i{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new i(t)}node(){return this.node_}},Xf=class i{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=qe(this.path_,e);return new i(this.syncTree_,t)}node(){return hu(this.syncTree_,this.path_)}},CR=function(i){return i=i||{},i.timestamp=i.timestamp||new Date().getTime(),i},TE=function(i,e,t){if(!i||typeof i!="object")return i;if(M(".sv"in i,"Unexpected leaf node or priority contents"),typeof i[".sv"]=="string")return SR(i[".sv"],e,t);if(typeof i[".sv"]=="object")return bR(i[".sv"],e);M(!1,"Unexpected server value: "+JSON.stringify(i,null,2))},SR=function(i,e,t){switch(i){case"timestamp":return t.timestamp;default:M(!1,"Unexpected server value: "+i)}},bR=function(i,e,t){i.hasOwnProperty("increment")||M(!1,"Unexpected server value: "+JSON.stringify(i,null,2));let n=i.increment;typeof n!="number"&&M(!1,"Unexpected increment value: "+n);let s=e.node();if(M(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return n;let o=s.getValue();return typeof o!="number"?n:o+n},vw=function(i,e,t,n){return Fp(e,new Xf(t,i),n)},Mp=function(i,e,t){return Fp(i,new Jf(e),t)};function Fp(i,e,t){let n=i.getPriority().val(),s=TE(n,e.getImmediateChild(".priority"),t),r;if(i.isLeafNode()){let o=i,a=TE(o.getValue(),e,t);return a!==o.getValue()||s!==o.getPriority().val()?new Cr(a,Ge(s)):i}else{let o=i;return r=o,s!==o.getPriority().val()&&(r=r.updatePriority(new Cr(s))),o.forEachChild(ke,(a,c)=>{let u=Fp(c,e.getImmediateChild(a),t);u!==c&&(r=r.updateImmediateChild(a,u))}),r}}var Ta=class{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}};function fu(i,e){let t=e instanceof Ce?e:new Ce(e),n=i,s=de(t);for(;s!==null;){let r=Oi(n.node.children,s)||{children:{},childCount:0};n=new Ta(s,n,r),t=De(t),s=de(t)}return n}function Ps(i){return i.node.value}function Lp(i,e){i.node.value=e,Zf(i)}function Ew(i){return i.node.childCount>0}function AR(i){return Ps(i)===void 0&&!Ew(i)}function pu(i,e){mt(i.node.children,(t,n)=>{e(new Ta(t,i,n))})}function ww(i,e,t,n){t&&!n&&e(i),pu(i,s=>{ww(s,e,!0,n)}),t&&n&&e(i)}function RR(i,e,t){let n=t?i:i.parent;for(;n!==null;){if(e(n))return!0;n=n.parent}return!1}function Na(i){return new Ce(i.parent===null?i.name:Na(i.parent)+"/"+i.name)}function Zf(i){i.parent!==null&&PR(i.parent,i.name,i)}function PR(i,e,t){let n=AR(t),s=ln(i.node.children,e);n&&s?(delete i.node.children[e],i.node.childCount--,Zf(i)):!n&&!s&&(i.node.children[e]=t.node,i.node.childCount++,Zf(i))}var NR=/[\[\].#$\/\u0000-\u001F\u007F]/,xR=/[\[\].#$\u0000-\u001F\u007F]/,uf=10*1024*1024,mu=function(i){return typeof i=="string"&&i.length!==0&&!NR.test(i)},Tw=function(i){return typeof i=="string"&&i.length!==0&&!xR.test(i)},DR=function(i){return i&&(i=i.replace(/^\/*\.info(\/|$)/,"/")),Tw(i)},Ia=function(i){return i===null||typeof i=="string"||typeof i=="number"&&!ou(i)||i&&typeof i=="object"&&ln(i,".sv")},jn=function(i,e,t,n){n&&e===void 0||xa(jt(i,"value"),e,t)},xa=function(i,e,t){let n=t instanceof Ce?new If(t,i):t;if(e===void 0)throw new Error(i+"contains undefined "+Is(n));if(typeof e=="function")throw new Error(i+"contains a function "+Is(n)+" with contents = "+e.toString());if(ou(e))throw new Error(i+"contains "+e.toString()+" "+Is(n));if(typeof e=="string"&&e.length>uf/3&&na(e)>uf)throw new Error(i+"contains a string greater than "+uf+" utf8 bytes "+Is(n)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,r=!1;if(mt(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!mu(o)))throw new Error(i+" contains an invalid key ("+o+") "+Is(n)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);lA(n,o),xa(i,a,n),cA(n)}),s&&r)throw new Error(i+' contains ".value" child '+Is(n)+" in addition to actual children.")}},OR=function(i,e){let t,n;for(t=0;t<e.length;t++){n=e[t];let r=fa(n);for(let o=0;o<r.length;o++)if(!(r[o]===".priority"&&o===r.length-1)){if(!mu(r[o]))throw new Error(i+"contains an invalid key ("+r[o]+") in path "+n.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(aA);let s=null;for(t=0;t<e.length;t++){if(n=e[t],s!==null&&un(s,n))throw new Error(i+"contains a path "+s.toString()+" that is ancestor of another path "+n.toString());s=n}},Iw=function(i,e,t,n){if(n&&e===void 0)return;let s=jt(i,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");let r=[];mt(e,(o,a)=>{let c=new Ce(o);if(xa(s,a,qe(t,c)),Ep(c)===".priority"&&!Ia(a))throw new Error(s+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(c)}),OR(s,r)},Vp=function(i,e,t){if(!(t&&e===void 0)){if(ou(e))throw new Error(jt(i,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Ia(e))throw new Error(jt(i,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Da=function(i,e,t,n){if(!(n&&t===void 0)&&!mu(t))throw new Error(jt(i,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},kr=function(i,e,t,n){if(!(n&&t===void 0)&&!Tw(t))throw new Error(jt(i,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},kR=function(i,e,t,n){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),kr(i,e,t,n)},Kt=function(i,e){if(de(e)===".info")throw new Error(i+" failed = Can't modify data under /.info/")},Cw=function(i,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!mu(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!DR(t))throw new Error(jt(i,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var ep=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function gu(i,e){let t=null;for(let n=0;n<e.length;n++){let s=e[n],r=s.getPath();t!==null&&!wp(r,t.path)&&(i.eventLists_.push(t),t=null),t===null&&(t={events:[],path:r}),t.events.push(s)}t&&i.eventLists_.push(t)}function Sw(i,e,t){gu(i,t),bw(i,n=>wp(n,e))}function Ht(i,e,t){gu(i,t),bw(i,n=>un(n,e)||un(e,n))}function bw(i,e){i.recursionDepth_++;let t=!0;for(let n=0;n<i.eventLists_.length;n++){let s=i.eventLists_[n];if(s){let r=s.path;e(r)?(MR(i.eventLists_[n]),i.eventLists_[n]=null):t=!1}}t&&(i.eventLists_=[]),i.recursionDepth_--}function MR(i){for(let e=0;e<i.events.length;e++){let t=i.events[e];if(t!==null){i.events[e]=null;let n=t.getEventRunner();Ss&&pt("event: "+t.toString()),xr(n)}}}var Aw="repo_interrupt",FR=25,tp=class{constructor(e,t,n,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new ep,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Gc(),this.transactionQueueTree_=new Ta,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function LR(i,e,t){if(i.stats_=vp(i.repoInfo_),i.forceRestClient_||L1())i.server_=new kf(i.repoInfo_,(n,s,r,o)=>{IE(i,n,s,r,o)},i.authTokenProvider_,i.appCheckProvider_),setTimeout(()=>CE(i,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{it(t)}catch(n){throw new Error("Invalid authOverride provided: "+n)}}i.persistentConnection_=new Tp(i.repoInfo_,e,(n,s,r,o)=>{IE(i,n,s,r,o)},n=>{CE(i,n)},n=>{VR(i,n)},i.authTokenProvider_,i.appCheckProvider_,t),i.server_=i.persistentConnection_}i.authTokenProvider_.addTokenChangeListener(n=>{i.server_.refreshAuthToken(n)}),i.appCheckProvider_.addTokenChangeListener(n=>{i.server_.refreshAppCheckToken(n.token)}),i.statsReporter_=B1(i.repoInfo_,()=>new Bf(i.stats_,i.server_)),i.infoData_=new Mf,i.infoSyncTree_=new Xc({startListening:(n,s,r,o)=>{let a=[],c=i.infoData_.getNode(n._path);return c.isEmpty()||(a=Pa(i.infoSyncTree_,n._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Bp(i,"connected",!1),i.serverSyncTree_=new Xc({startListening:(n,s,r,o)=>(i.server_.listen(n,r,s,(a,c)=>{let u=o(a,c);Ht(i.eventQueue_,n._path,u)}),[]),stopListening:(n,s)=>{i.server_.unlisten(n,s)}})}function Rw(i){let t=i.infoData_.getNode(new Ce(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Oa(i){return CR({timestamp:Rw(i)})}function IE(i,e,t,n,s){i.dataUpdateCount++;let r=new Ce(e);t=i.interceptServerDataCallback_?i.interceptServerDataCallback_(e,t):t;let o=[];if(s)if(n){let c=ta(t,u=>Ge(u));o=yR(i.serverSyncTree_,r,c,s)}else{let c=Ge(t);o=mw(i.serverSyncTree_,r,c,s)}else if(n){let c=ta(t,u=>Ge(u));o=mR(i.serverSyncTree_,r,c)}else{let c=Ge(t);o=Pa(i.serverSyncTree_,r,c)}let a=r;o.length>0&&(a=Pr(i,r)),Ht(i.eventQueue_,a,o)}function CE(i,e){Bp(i,"connected",e),e===!1&&qR(i)}function VR(i,e){mt(e,(t,n)=>{Bp(i,t,n)})}function Bp(i,e,t){let n=new Ce("/.info/"+e),s=Ge(t);i.infoData_.updateSnapshot(n,s);let r=Pa(i.infoSyncTree_,n,s);Ht(i.eventQueue_,n,r)}function _u(i){return i.nextWriteId_++}function BR(i,e,t){let n=vR(i.serverSyncTree_,e);return n!=null?Promise.resolve(n):i.server_.get(e).then(s=>{let r=Ge(s).withIndex(e._queryParams.getIndex());Yf(i.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=Pa(i.serverSyncTree_,e._path,r);else{let a=wa(i.serverSyncTree_,e);o=mw(i.serverSyncTree_,e._path,r,a)}return Ht(i.eventQueue_,e._path,o),Zc(i.serverSyncTree_,e,t,null,!0),r},s=>(Mr(i,"get for query "+it(e)+" failed: "+s),Promise.reject(new Error(s))))}function Up(i,e,t,n,s){Mr(i,"set",{path:e.toString(),value:t,priority:n});let r=Oa(i),o=Ge(t,n),a=hu(i.serverSyncTree_,e),c=Mp(o,a,r),u=_u(i),d=xp(i.serverSyncTree_,e,c,u,!0);gu(i.eventQueue_,d),i.server_.put(e.toString(),o.val(!0),(m,_)=>{let v=m==="ok";v||bt("set at "+e+" failed: "+m);let C=Mi(i.serverSyncTree_,u,!v);Ht(i.eventQueue_,e,C),qi(i,s,m,_)});let f=jp(i,e);Pr(i,f),Ht(i.eventQueue_,f,[])}function UR(i,e,t,n){Mr(i,"update",{path:e.toString(),value:t});let s=!0,r=Oa(i),o={};if(mt(t,(a,c)=>{s=!1,o[a]=vw(qe(e,a),Ge(c),i.serverSyncTree_,r)}),s)pt("update() called with empty data.  Don't do anything."),qi(i,n,"ok",void 0);else{let a=_u(i),c=pR(i.serverSyncTree_,e,o,a);gu(i.eventQueue_,c),i.server_.merge(e.toString(),t,(u,d)=>{let f=u==="ok";f||bt("update at "+e+" failed: "+u);let m=Mi(i.serverSyncTree_,a,!f),_=m.length>0?Pr(i,e):e;Ht(i.eventQueue_,_,m),qi(i,n,u,d)}),mt(t,u=>{let d=jp(i,qe(e,u));Pr(i,d)}),Ht(i.eventQueue_,e,[])}}function qR(i){Mr(i,"onDisconnectEvents");let e=Oa(i),t=Gc();Lf(i.onDisconnect_,Ie(),(s,r)=>{let o=vw(s,r,i.serverSyncTree_,e);Dr(t,s,o)});let n=[];Lf(t,Ie(),(s,r)=>{n=n.concat(Pa(i.serverSyncTree_,s,r));let o=jp(i,s);Pr(i,o)}),i.onDisconnect_=Gc(),Ht(i.eventQueue_,Ie(),n)}function jR(i,e,t){i.server_.onDisconnectCancel(e.toString(),(n,s)=>{n==="ok"&&Ff(i.onDisconnect_,e),qi(i,t,n,s)})}function SE(i,e,t,n){let s=Ge(t);i.server_.onDisconnectPut(e.toString(),s.val(!0),(r,o)=>{r==="ok"&&Dr(i.onDisconnect_,e,s),qi(i,n,r,o)})}function GR(i,e,t,n,s){let r=Ge(t,n);i.server_.onDisconnectPut(e.toString(),r.val(!0),(o,a)=>{o==="ok"&&Dr(i.onDisconnect_,e,r),qi(i,s,o,a)})}function WR(i,e,t,n){if(fc(t)){pt("onDisconnect().update() called with empty data.  Don't do anything."),qi(i,n,"ok",void 0);return}i.server_.onDisconnectMerge(e.toString(),t,(s,r)=>{s==="ok"&&mt(t,(o,a)=>{let c=Ge(a);Dr(i.onDisconnect_,qe(e,o),c)}),qi(i,n,s,r)})}function zR(i,e,t){let n;de(e._path)===".info"?n=Yf(i.infoSyncTree_,e,t):n=Yf(i.serverSyncTree_,e,t),Sw(i.eventQueue_,e._path,n)}function np(i,e,t){let n;de(e._path)===".info"?n=Zc(i.infoSyncTree_,e,t):n=Zc(i.serverSyncTree_,e,t),Sw(i.eventQueue_,e._path,n)}function Pw(i){i.persistentConnection_&&i.persistentConnection_.interrupt(Aw)}function KR(i){i.persistentConnection_&&i.persistentConnection_.resume(Aw)}function Mr(i,...e){let t="";i.persistentConnection_&&(t=i.persistentConnection_.id+":"),pt(t,...e)}function qi(i,e,t,n){e&&xr(()=>{if(t==="ok")e(null);else{let s=(t||"error").toUpperCase(),r=s;n&&(r+=": "+n);let o=new Error(r);o.code=s,e(o)}})}function HR(i,e,t,n,s,r){Mr(i,"transaction on "+e);let o={path:e,update:t,onComplete:n,status:null,order:RE(),applyLocally:r,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=qp(i,e,void 0);o.currentInputSnapshot=a;let c=o.update(a.val());if(c===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{xa("transaction failed: Data returned ",c,o.path),o.status=0;let u=fu(i.transactionQueueTree_,e),d=Ps(u)||[];d.push(o),Lp(u,d);let f;typeof c=="object"&&c!==null&&ln(c,".priority")?(f=Oi(c,".priority"),M(Ia(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):f=(hu(i.serverSyncTree_,e)||ae.EMPTY_NODE).getPriority().val();let m=Oa(i),_=Ge(c,f),v=Mp(_,a,m);o.currentOutputSnapshotRaw=_,o.currentOutputSnapshotResolved=v,o.currentWriteId=_u(i);let C=xp(i.serverSyncTree_,e,v,o.currentWriteId,o.applyLocally);Ht(i.eventQueue_,e,C),yu(i,i.transactionQueueTree_)}}function qp(i,e,t){return hu(i.serverSyncTree_,e,t)||ae.EMPTY_NODE}function yu(i,e=i.transactionQueueTree_){if(e||vu(i,e),Ps(e)){let t=xw(i,e);M(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&QR(i,Na(e),t)}else Ew(e)&&pu(e,t=>{yu(i,t)})}function QR(i,e,t){let n=t.map(u=>u.currentWriteId),s=qp(i,e,n),r=s,o=s.hash();for(let u=0;u<t.length;u++){let d=t[u];M(d.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;let f=Mt(e,d.path);r=r.updateChild(f,d.currentOutputSnapshotRaw)}let a=r.val(!0),c=e;i.server_.put(c.toString(),a,u=>{Mr(i,"transaction put response",{path:c.toString(),status:u});let d=[];if(u==="ok"){let f=[];for(let m=0;m<t.length;m++)t[m].status=2,d=d.concat(Mi(i.serverSyncTree_,t[m].currentWriteId)),t[m].onComplete&&f.push(()=>t[m].onComplete(null,!0,t[m].currentOutputSnapshotResolved)),t[m].unwatcher();vu(i,fu(i.transactionQueueTree_,e)),yu(i,i.transactionQueueTree_),Ht(i.eventQueue_,e,d);for(let m=0;m<f.length;m++)xr(f[m])}else{if(u==="datastale")for(let f=0;f<t.length;f++)t[f].status===3?t[f].status=4:t[f].status=0;else{bt("transaction at "+c.toString()+" failed: "+u);for(let f=0;f<t.length;f++)t[f].status=4,t[f].abortReason=u}Pr(i,e)}},o)}function Pr(i,e){let t=Nw(i,e),n=Na(t),s=xw(i,t);return $R(i,s,n),n}function $R(i,e,t){if(e.length===0)return;let n=[],s=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let c=e[a],u=Mt(t,c.path),d=!1,f;if(M(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)d=!0,f=c.abortReason,s=s.concat(Mi(i.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=FR)d=!0,f="maxretry",s=s.concat(Mi(i.serverSyncTree_,c.currentWriteId,!0));else{let m=qp(i,c.path,o);c.currentInputSnapshot=m;let _=e[a].update(m.val());if(_!==void 0){xa("transaction failed: Data returned ",_,c.path);let v=Ge(_);typeof _=="object"&&_!=null&&ln(_,".priority")||(v=v.updatePriority(m.getPriority()));let R=c.currentWriteId,F=Oa(i),V=Mp(v,m,F);c.currentOutputSnapshotRaw=v,c.currentOutputSnapshotResolved=V,c.currentWriteId=_u(i),o.splice(o.indexOf(R),1),s=s.concat(xp(i.serverSyncTree_,c.path,V,c.currentWriteId,c.applyLocally)),s=s.concat(Mi(i.serverSyncTree_,R,!0))}else d=!0,f="nodata",s=s.concat(Mi(i.serverSyncTree_,c.currentWriteId,!0))}Ht(i.eventQueue_,t,s),s=[],d&&(e[a].status=2,function(m){setTimeout(m,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(f==="nodata"?n.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):n.push(()=>e[a].onComplete(new Error(f),!1,null))))}vu(i,i.transactionQueueTree_);for(let a=0;a<n.length;a++)xr(n[a]);yu(i,i.transactionQueueTree_)}function Nw(i,e){let t,n=i.transactionQueueTree_;for(t=de(e);t!==null&&Ps(n)===void 0;)n=fu(n,t),e=De(e),t=de(e);return n}function xw(i,e){let t=[];return Dw(i,e,t),t.sort((n,s)=>n.order-s.order),t}function Dw(i,e,t){let n=Ps(e);if(n)for(let s=0;s<n.length;s++)t.push(n[s]);pu(e,s=>{Dw(i,s,t)})}function vu(i,e){let t=Ps(e);if(t){let n=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[n]=t[s],n++);t.length=n,Lp(e,t.length>0?t:void 0)}pu(e,n=>{vu(i,n)})}function jp(i,e){let t=Na(Nw(i,e)),n=fu(i.transactionQueueTree_,e);return RR(n,s=>{hf(i,s)}),hf(i,n),ww(n,s=>{hf(i,s)}),t}function hf(i,e){let t=Ps(e);if(t){let n=[],s=[],r=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(M(r===o-1,"All SENT items should be at beginning of queue."),r=o,t[o].status=3,t[o].abortReason="set"):(M(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),s=s.concat(Mi(i.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&n.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?Lp(e,void 0):t.length=r+1,Ht(i.eventQueue_,Na(e),s);for(let o=0;o<n.length;o++)xr(n[o])}}function YR(i){let e="",t=i.split("/");for(let n=0;n<t.length;n++)if(t[n].length>0){let s=t[n];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function JR(i){let e={};i.charAt(0)==="?"&&(i=i.substring(1));for(let t of i.split("&")){if(t.length===0)continue;let n=t.split("=");n.length===2?e[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):bt(`Invalid query segment '${t}' in query '${i}'`)}return e}var ip=function(i,e){let t=XR(i),n=t.namespace;t.domain==="firebase.com"&&Un(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!n||n==="undefined")&&t.domain!=="localhost"&&Un("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||R1();let s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new Mc(t.host,t.secure,n,s,e,"",n!==t.subdomain),path:new Ce(t.pathString)}},XR=function(i){let e="",t="",n="",s="",r="",o=!0,a="https",c=443;if(typeof i=="string"){let u=i.indexOf("//");u>=0&&(a=i.substring(0,u-1),i=i.substring(u+2));let d=i.indexOf("/");d===-1&&(d=i.length);let f=i.indexOf("?");f===-1&&(f=i.length),e=i.substring(0,Math.min(d,f)),d<f&&(s=YR(i.substring(d,f)));let m=JR(i.substring(Math.min(i.length,f)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",c=parseInt(e.substring(u+1),10)):u=e.length;let _=e.slice(0,u);if(_.toLowerCase()==="localhost")t="localhost";else if(_.split(".").length<=2)t=_;else{let v=e.indexOf(".");n=e.substring(0,v).toLowerCase(),t=e.substring(v+1),r=n}"ns"in m&&(r=m.ns)}return{host:e,port:c,domain:t,subdomain:n,secure:o,scheme:a,pathString:s,namespace:r}};var bE="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",ZR=function(){let i=0,e=[];return function(t){let n=t===i;i=t;let s,r=new Array(8);for(s=7;s>=0;s--)r[s]=bE.charAt(t%64),t=Math.floor(t/64);M(t===0,"Cannot push at time == 0");let o=r.join("");if(n){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=bE.charAt(e[s]);return M(o.length===20,"nextPushId: Length should be 20."),o}}();var eu=class{constructor(e,t,n,s){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=s}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+it(this.snapshot.exportVal())}},tu=class{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var Ca=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return M(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var nu=class{constructor(e,t){this._repo=e,this._path=t}cancel(){let e=new kt;return jR(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Kt("OnDisconnect.remove",this._path);let e=new kt;return SE(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Kt("OnDisconnect.set",this._path),jn("OnDisconnect.set",e,this._path,!1);let t=new kt;return SE(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){Kt("OnDisconnect.setWithPriority",this._path),jn("OnDisconnect.setWithPriority",e,this._path,!1),Vp("OnDisconnect.setWithPriority",t,!1);let n=new kt;return GR(this._repo,this._path,e,t,n.wrapCallback(()=>{})),n.promise}update(e){Kt("OnDisconnect.update",this._path),Iw("OnDisconnect.update",e,this._path,!1);let t=new kt;return WR(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};var Lt=class i{constructor(e,t,n,s){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=s}get key(){return fe(this._path)?null:Ep(this._path)}get ref(){return new Qt(this._repo,this._path)}get _queryIdentifier(){let e=dE(this._queryParams),t=yp(e);return t==="{}"?"default":t}get _queryObject(){return dE(this._queryParams)}isEqual(e){if(e=ge(e),!(e instanceof i))return!1;let t=this._repo===e._repo,n=wp(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&n&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+oA(this._path)}};function Eu(i,e){if(i._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function Gi(i){let e=null,t=null;if(i.hasStart()&&(e=i.getIndexStartValue()),i.hasEnd()&&(t=i.getIndexEndValue()),i.getIndex()===Bn){let n="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",s="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(i.hasStart()){if(i.getIndexStartName()!==Vi)throw new Error(n);if(typeof e!="string")throw new Error(s)}if(i.hasEnd()){if(i.getIndexEndName()!==ui)throw new Error(n);if(typeof t!="string")throw new Error(s)}}else if(i.getIndex()===ke){if(e!=null&&!Ia(e)||t!=null&&!Ia(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(M(i.getIndex()instanceof pa||i.getIndex()===Cp,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function wu(i){if(i.hasStart()&&i.hasEnd()&&i.hasLimit()&&!i.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var Qt=class i extends Lt{constructor(e,t){super(e,t,new ya,!1)}get parent(){let e=$E(this._path);return e===null?null:new i(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},Nr=class i{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new Ce(e),n=ji(this.ref,e);return new i(this._node.getChild(t),n,ke)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(n,s)=>e(new i(s,ji(this.ref,n),ke)))}hasChild(e){let t=new Ce(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function Gp(i,e){return i=ge(i),i._checkNotDeleted("ref"),e!==void 0?ji(i._root,e):i._root}function Wp(i,e){i=ge(i),i._checkNotDeleted("refFromURL");let t=ip(e,i._repo.repoInfo_.nodeAdmin);Cw("refFromURL",t);let n=t.repoInfo;return!i._repo.repoInfo_.isCustomHost()&&n.host!==i._repo.repoInfo_.host&&Un("refFromURL: Host name does not match the current database: (found "+n.host+" but expected "+i._repo.repoInfo_.host+")"),Gp(i,t.path.toString())}function ji(i,e){return i=ge(i),de(i._path)===null?kR("child","path",e,!1):kr("child","path",e,!1),new Qt(i._repo,qe(i._path,e))}function Ow(i,e){i=ge(i),Kt("push",i._path),jn("push",e,i._path,!0);let t=Rw(i._repo),n=ZR(t),s=ji(i,n),r=ji(i,n),o;return e!=null?o=Tu(r,e).then(()=>r):o=Promise.resolve(r),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function kw(i){return Kt("remove",i._path),Tu(i,null)}function Tu(i,e){i=ge(i),Kt("set",i._path),jn("set",e,i._path,!1);let t=new kt;return Up(i._repo,i._path,e,null,t.wrapCallback(()=>{})),t.promise}function Mw(i,e){i=ge(i),Kt("setPriority",i._path),Vp("setPriority",e,!1);let t=new kt;return Up(i._repo,qe(i._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function Fw(i,e,t){if(Kt("setWithPriority",i._path),jn("setWithPriority",e,i._path,!1),Vp("setWithPriority",t,!1),i.key===".length"||i.key===".keys")throw"setWithPriority failed: "+i.key+" is a read-only object.";let n=new kt;return Up(i._repo,i._path,e,t,n.wrapCallback(()=>{})),n.promise}function Lw(i,e){Iw("update",e,i._path,!1);let t=new kt;return UR(i._repo,i._path,e,t.wrapCallback(()=>{})),t.promise}function Vw(i){i=ge(i);let e=new Ca(()=>{}),t=new Sa(e);return BR(i._repo,i,t).then(n=>new Nr(n,new Qt(i._repo,i._path),i._queryParams.getIndex()))}var Sa=class i{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let n=t._queryParams.getIndex();return new eu("value",this,new Nr(e.snapshotNode,new Qt(t._repo,t._path),n))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new tu(this,e,t):null}matches(e){return e instanceof i?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},iu=class i{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new tu(this,e,t):null}createEvent(e,t){M(e.childName!=null,"Child events should have a childName.");let n=ji(new Qt(t._repo,t._path),e.childName),s=t._queryParams.getIndex();return new eu(e.type,this,new Nr(e.snapshotNode,n,s),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof i?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function ka(i,e,t,n,s){let r;if(typeof n=="object"&&(r=void 0,s=n),typeof n=="function"&&(r=n),s&&s.onlyOnce){let c=t,u=(d,f)=>{np(i._repo,i,a),c(d,f)};u.userCallback=t.userCallback,u.context=t.context,t=u}let o=new Ca(t,r||void 0),a=e==="value"?new Sa(o):new iu(e,o);return zR(i._repo,i,a),()=>np(i._repo,i,a)}function Iu(i,e,t,n){return ka(i,"value",e,t,n)}function zp(i,e,t,n){return ka(i,"child_added",e,t,n)}function Kp(i,e,t,n){return ka(i,"child_changed",e,t,n)}function Hp(i,e,t,n){return ka(i,"child_moved",e,t,n)}function Qp(i,e,t,n){return ka(i,"child_removed",e,t,n)}function $p(i,e,t){let n=null,s=t?new Ca(t):null;e==="value"?n=new Sa(s):e&&(n=new iu(e,s)),np(i._repo,i,n)}var $t=class{},su=class extends $t{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){jn("endAt",this._value,e._path,!0);let t=Of(e._queryParams,this._value,this._key);if(wu(t),Gi(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Lt(e._repo,e._path,t,e._orderByCalled)}};function Bw(i,e){return Da("endAt","key",e,!0),new su(i,e)}var sp=class extends $t{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){jn("endBefore",this._value,e._path,!1);let t=SA(e._queryParams,this._value,this._key);if(wu(t),Gi(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Lt(e._repo,e._path,t,e._orderByCalled)}};function Uw(i,e){return Da("endBefore","key",e,!0),new sp(i,e)}var ru=class extends $t{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){jn("startAt",this._value,e._path,!0);let t=Df(e._queryParams,this._value,this._key);if(wu(t),Gi(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Lt(e._repo,e._path,t,e._orderByCalled)}};function qw(i=null,e){return Da("startAt","key",e,!0),new ru(i,e)}var rp=class extends $t{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){jn("startAfter",this._value,e._path,!1);let t=CA(e._queryParams,this._value,this._key);if(wu(t),Gi(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Lt(e._repo,e._path,t,e._orderByCalled)}};function jw(i,e){return Da("startAfter","key",e,!0),new rp(i,e)}var op=class extends $t{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Lt(e._repo,e._path,TA(e._queryParams,this._limit),e._orderByCalled)}};function Gw(i){if(typeof i!="number"||Math.floor(i)!==i||i<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new op(i)}var ap=class extends $t{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Lt(e._repo,e._path,IA(e._queryParams,this._limit),e._orderByCalled)}};function Ww(i){if(typeof i!="number"||Math.floor(i)!==i||i<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new ap(i)}var lp=class extends $t{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){Eu(e,"orderByChild");let t=new Ce(this._path);if(fe(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let n=new pa(t),s=au(e._queryParams,n);return Gi(s),new Lt(e._repo,e._path,s,!0)}};function zw(i){if(i==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(i==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(i==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return kr("orderByChild","path",i,!1),new lp(i)}var cp=class extends $t{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){Eu(e,"orderByKey");let t=au(e._queryParams,Bn);return Gi(t),new Lt(e._repo,e._path,t,!0)}};function Kw(){return new cp}var up=class extends $t{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){Eu(e,"orderByPriority");let t=au(e._queryParams,ke);return Gi(t),new Lt(e._repo,e._path,t,!0)}};function Hw(){return new up}var hp=class extends $t{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){Eu(e,"orderByValue");let t=au(e._queryParams,Cp);return Gi(t),new Lt(e._repo,e._path,t,!0)}};function Qw(){return new hp}var dp=class extends $t{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(jn("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new su(this._value,this._key)._apply(new ru(this._value,this._key)._apply(e))}};function $w(i,e){return Da("equalTo","key",e,!0),new dp(i,e)}function dn(i,...e){let t=ge(i);for(let n of e)t=n._apply(t);return t}oR(Qt);hR(Qt);var eP="FIREBASE_DATABASE_EMULATOR_HOST",fp={},tP=!1;function nP(i,e,t,n){i.repoInfo_=new Mc(`${e}:${t}`,!1,i.repoInfo_.namespace,i.repoInfo_.webSocketOnly,i.repoInfo_.nodeAdmin,i.repoInfo_.persistenceKey,i.repoInfo_.includeNamespaceInQueryParams,!0),n&&(i.authTokenProvider_=n)}function Yp(i,e,t,n,s){let r=n||i.options.databaseURL;r===void 0&&(i.options.projectId||Un("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),pt("Using default host for project ",i.options.projectId),r=`${i.options.projectId}-default-rtdb.firebaseio.com`);let o=ip(r,s),a=o.repoInfo,c,u;typeof process<"u"&&process.env&&(u=process.env[eP]),u?(c=!0,r=`http://${u}?ns=${a.namespace}`,o=ip(r,s),a=o.repoInfo):c=!o.repoInfo.secure;let d=s&&c?new la(la.OWNER):new _f(i.name,i.options,e);Cw("Invalid Firebase Database URL",o),fe(o.path)||Un("Database URL must point to the root of a Firebase Database (not including a child path).");let f=sP(a,i,d,new gf(i.name,t));return new pp(f,i)}function iP(i,e){let t=fp[e];(!t||t[i.key]!==i)&&Un(`Database ${e}(${i.repoInfo_}) has already been deleted.`),Pw(i),delete t[i.key]}function sP(i,e,t,n){let s=fp[e.name];s||(s={},fp[e.name]=s);let r=s[i.toURLString()];return r&&Un("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new tp(i,tP,t,n),s[i.toURLString()]=r,r}var pp=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(LR(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Qt(this._repo,Ie())),this._rootInternal}_delete(){return this._rootInternal!==null&&(iP(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Un("Cannot call "+e+" on a deleted database.")}};function Yw(){QE.IS_TRANSPORT_INITIALIZED&&bt("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function Jw(){Yw(),da.forceDisallow()}function Xw(){Yw(),Er.forceDisallow(),da.forceAllow()}function Zw(i,e,t,n={}){i=ge(i),i._checkNotDeleted("useEmulator"),i._instanceStarted&&Un("Cannot call useEmulator() after instance has already been initialized.");let s=i._repoInternal,r;if(s.repoInfo_.nodeAdmin)n.mockUserToken&&Un('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new la(la.OWNER);else if(n.mockUserToken){let o=typeof n.mockUserToken=="string"?n.mockUserToken:hc(n.mockUserToken,i.app.options.projectId);r=new la(o)}nP(s,e,t,r)}function eT(i){i=ge(i),i._checkNotDeleted("goOffline"),Pw(i._repo)}function tT(i){i=ge(i),i._checkNotDeleted("goOnline"),KR(i._repo)}function nT(i,e){NE(i,e)}function rP(i){_p(gc),mc(new Ln("database",(e,{instanceIdentifier:t})=>{let n=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return Yp(n,s,r,t)},"PUBLIC").setMultipleInstances(!0)),yr($0,Y0,i),yr($0,Y0,"esm2017")}var oP={".sv":"timestamp"};function iT(){return oP}function sT(i){return{".sv":{increment:i}}}var mp=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function rT(i,e,t){var n;if(i=ge(i),Kt("Reference.transaction",i._path),i.key===".length"||i.key===".keys")throw"Reference.transaction failed: "+i.key+" is a read-only object.";let s=(n=t?.applyLocally)!==null&&n!==void 0?n:!0,r=new kt,o=(c,u,d)=>{let f=null;c?r.reject(c):(f=new Nr(d,new Qt(i._repo,i._path),ke),r.resolve(new mp(u,f)))},a=Iu(i,()=>{});return HR(i._repo,i._path,e,o,a,s),r.promise}Tp.prototype.simpleListen=function(i,e){this.sendRequest("q",{p:i},e)};Tp.prototype.echo=function(i,e){this.sendRequest("echo",{d:i},e)};rP();var aP="@firebase/database-compat",lP="1.0.8";var cP=new _r("@firebase/database-compat"),oT=function(i){let e="FIREBASE WARNING: "+i;cP.warn(e)};var uP=function(i,e,t,n){if(!(n&&t===void 0)&&typeof t!="boolean")throw new Error(jt(i,e)+"must be a boolean.")},hP=function(i,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(jt(i,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var Jp=class{constructor(e){this._delegate=e}cancel(e){ee("OnDisconnect.cancel",0,1,arguments.length),ct("OnDisconnect.cancel","onComplete",e,!0);let t=this._delegate.cancel();return e&&t.then(()=>e(null),n=>e(n)),t}remove(e){ee("OnDisconnect.remove",0,1,arguments.length),ct("OnDisconnect.remove","onComplete",e,!0);let t=this._delegate.remove();return e&&t.then(()=>e(null),n=>e(n)),t}set(e,t){ee("OnDisconnect.set",1,2,arguments.length),ct("OnDisconnect.set","onComplete",t,!0);let n=this._delegate.set(e);return t&&n.then(()=>t(null),s=>t(s)),n}setWithPriority(e,t,n){ee("OnDisconnect.setWithPriority",2,3,arguments.length),ct("OnDisconnect.setWithPriority","onComplete",n,!0);let s=this._delegate.setWithPriority(e,t);return n&&s.then(()=>n(null),r=>n(r)),s}update(e,t){if(ee("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let s={};for(let r=0;r<e.length;++r)s[""+r]=e[r];e=s,oT("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ct("OnDisconnect.update","onComplete",t,!0);let n=this._delegate.update(e);return t&&n.then(()=>t(null),s=>t(s)),n}};var Xp=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return ee("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}};var Ns=class i{constructor(e,t){this._database=e,this._delegate=t}val(){return ee("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return ee("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return ee("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return ee("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return ee("DataSnapshot.child",0,1,arguments.length),e=String(e),kr("DataSnapshot.child","path",e,!1),new i(this._database,this._delegate.child(e))}hasChild(e){return ee("DataSnapshot.hasChild",1,1,arguments.length),kr("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return ee("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return ee("DataSnapshot.forEach",1,1,arguments.length),ct("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new i(this._database,t)))}hasChildren(){return ee("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return ee("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return ee("DataSnapshot.ref",0,0,arguments.length),new hi(this._database,this._delegate.ref)}get ref(){return this.getRef()}},Cu=class i{constructor(e,t){this.database=e,this._delegate=t}on(e,t,n,s){var r;ee("Query.on",2,4,arguments.length),ct("Query.on","callback",t,!1);let o=i.getCancelAndContextArgs_("Query.on",n,s),a=(u,d)=>{t.call(o.context,new Ns(this.database,u),d)};a.userCallback=t,a.context=o.context;let c=(r=o.cancel)===null||r===void 0?void 0:r.bind(o.context);switch(e){case"value":return Iu(this._delegate,a,c),t;case"child_added":return zp(this._delegate,a,c),t;case"child_removed":return Qp(this._delegate,a,c),t;case"child_changed":return Kp(this._delegate,a,c),t;case"child_moved":return Hp(this._delegate,a,c),t;default:throw new Error(jt("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,n){if(ee("Query.off",0,3,arguments.length),hP("Query.off",e,!0),ct("Query.off","callback",t,!0),tf("Query.off","context",n,!0),t){let s=()=>{};s.userCallback=t,s.context=n,$p(this._delegate,e,s)}else $p(this._delegate,e)}get(){return Vw(this._delegate).then(e=>new Ns(this.database,e))}once(e,t,n,s){ee("Query.once",1,4,arguments.length),ct("Query.once","callback",t,!0);let r=i.getCancelAndContextArgs_("Query.once",n,s),o=new kt,a=(u,d)=>{let f=new Ns(this.database,u);t&&t.call(r.context,f,d),o.resolve(f)};a.userCallback=t,a.context=r.context;let c=u=>{r.cancel&&r.cancel.call(r.context,u),o.reject(u)};switch(e){case"value":Iu(this._delegate,a,c,{onlyOnce:!0});break;case"child_added":zp(this._delegate,a,c,{onlyOnce:!0});break;case"child_removed":Qp(this._delegate,a,c,{onlyOnce:!0});break;case"child_changed":Kp(this._delegate,a,c,{onlyOnce:!0});break;case"child_moved":Hp(this._delegate,a,c,{onlyOnce:!0});break;default:throw new Error(jt("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return ee("Query.limitToFirst",1,1,arguments.length),new i(this.database,dn(this._delegate,Gw(e)))}limitToLast(e){return ee("Query.limitToLast",1,1,arguments.length),new i(this.database,dn(this._delegate,Ww(e)))}orderByChild(e){return ee("Query.orderByChild",1,1,arguments.length),new i(this.database,dn(this._delegate,zw(e)))}orderByKey(){return ee("Query.orderByKey",0,0,arguments.length),new i(this.database,dn(this._delegate,Kw()))}orderByPriority(){return ee("Query.orderByPriority",0,0,arguments.length),new i(this.database,dn(this._delegate,Hw()))}orderByValue(){return ee("Query.orderByValue",0,0,arguments.length),new i(this.database,dn(this._delegate,Qw()))}startAt(e=null,t){return ee("Query.startAt",0,2,arguments.length),new i(this.database,dn(this._delegate,qw(e,t)))}startAfter(e=null,t){return ee("Query.startAfter",0,2,arguments.length),new i(this.database,dn(this._delegate,jw(e,t)))}endAt(e=null,t){return ee("Query.endAt",0,2,arguments.length),new i(this.database,dn(this._delegate,Bw(e,t)))}endBefore(e=null,t){return ee("Query.endBefore",0,2,arguments.length),new i(this.database,dn(this._delegate,Uw(e,t)))}equalTo(e,t){return ee("Query.equalTo",1,2,arguments.length),new i(this.database,dn(this._delegate,$w(e,t)))}toString(){return ee("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return ee("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(ee("Query.isEqual",1,1,arguments.length),!(e instanceof i)){let t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,n){let s={cancel:void 0,context:void 0};if(t&&n)s.cancel=t,ct(e,"cancel",s.cancel,!0),s.context=n,tf(e,"context",s.context,!0);else if(t)if(typeof t=="object"&&t!==null)s.context=t;else if(typeof t=="function")s.cancel=t;else throw new Error(jt(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return s}get ref(){return new hi(this.database,new Qt(this._delegate._repo,this._delegate._path))}},hi=class i extends Cu{constructor(e,t){super(e,new Lt(t._repo,t._path,new ya,!1)),this.database=e,this._delegate=t}getKey(){return ee("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return ee("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new i(this.database,ji(this._delegate,e))}getParent(){ee("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new i(this.database,e):null}getRoot(){return ee("Reference.root",0,0,arguments.length),new i(this.database,this._delegate.root)}set(e,t){ee("Reference.set",1,2,arguments.length),ct("Reference.set","onComplete",t,!0);let n=Tu(this._delegate,e);return t&&n.then(()=>t(null),s=>t(s)),n}update(e,t){if(ee("Reference.update",1,2,arguments.length),Array.isArray(e)){let s={};for(let r=0;r<e.length;++r)s[""+r]=e[r];e=s,oT("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Kt("Reference.update",this._delegate._path),ct("Reference.update","onComplete",t,!0);let n=Lw(this._delegate,e);return t&&n.then(()=>t(null),s=>t(s)),n}setWithPriority(e,t,n){ee("Reference.setWithPriority",2,3,arguments.length),ct("Reference.setWithPriority","onComplete",n,!0);let s=Fw(this._delegate,e,t);return n&&s.then(()=>n(null),r=>n(r)),s}remove(e){ee("Reference.remove",0,1,arguments.length),ct("Reference.remove","onComplete",e,!0);let t=kw(this._delegate);return e&&t.then(()=>e(null),n=>e(n)),t}transaction(e,t,n){ee("Reference.transaction",1,3,arguments.length),ct("Reference.transaction","transactionUpdate",e,!1),ct("Reference.transaction","onComplete",t,!0),uP("Reference.transaction","applyLocally",n,!0);let s=rT(this._delegate,e,{applyLocally:n}).then(r=>new Xp(r.committed,new Ns(this.database,r.snapshot)));return t&&s.then(r=>t(null,r.committed,r.snapshot),r=>t(r,!1,null)),s}setPriority(e,t){ee("Reference.setPriority",1,2,arguments.length),ct("Reference.setPriority","onComplete",t,!0);let n=Mw(this._delegate,e);return t&&n.then(()=>t(null),s=>t(s)),n}push(e,t){ee("Reference.push",0,2,arguments.length),ct("Reference.push","onComplete",t,!0);let n=Ow(this._delegate,e),s=n.then(o=>new i(this.database,o));t&&s.then(()=>t(null),o=>t(o));let r=new i(this.database,n);return r.then=s.then.bind(s),r.catch=s.catch.bind(s,void 0),r}onDisconnect(){return Kt("Reference.onDisconnect",this._delegate._path),new Jp(new nu(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};var xs=class{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:Jw,forceLongPolling:Xw}}useEmulator(e,t,n={}){Zw(this._delegate,e,t,n)}ref(e){if(ee("database.ref",0,1,arguments.length),e instanceof hi){let t=Wp(this._delegate,e.toString());return new hi(this,t)}else{let t=Gp(this._delegate,e);return new hi(this,t)}}refFromURL(e){ee("database.refFromURL",1,1,arguments.length);let n=Wp(this._delegate,e);return new hi(this,n)}goOffline(){return ee("database.goOffline",0,0,arguments.length),eT(this._delegate)}goOnline(){return ee("database.goOnline",0,0,arguments.length),tT(this._delegate)}};xs.ServerValue={TIMESTAMP:iT(),increment:i=>sT(i)};function dP({app:i,url:e,version:t,customAuthImpl:n,customAppCheckImpl:s,namespace:r,nodeAdmin:o=!1}){_p(t);let a=new nf("database-standalone"),c=new pc("auth-internal",a);c.setComponent(new Ln("auth-internal",()=>n,"PRIVATE"));let u;return s&&(u=new pc("app-check-internal",a),u.setComponent(new Ln("app-check-internal",()=>s,"PRIVATE"))),{instance:new xs(Yp(i,c,u,e,o),i),namespace:r}}var fP=Object.freeze({__proto__:null,initStandalone:dP});var pP=xs.ServerValue;function mP(i){i.INTERNAL.registerComponent(new Ln("database-compat",(e,{instanceIdentifier:t})=>{let n=e.getProvider("app-compat").getImmediate(),s=e.getProvider("database").getImmediate({identifier:t});return new xs(s,n)},"PUBLIC").setServiceProps({Reference:hi,Query:Cu,Database:xs,DataSnapshot:Ns,enableLogging:nT,INTERNAL:fP,ServerValue:pP}).setMultipleInstances(!0)),i.registerVersion(aP,lP)}mP(ki);function Ma(i,e,t="on",n=$l){return new Ql(s=>{let r=null;return r=i[t](e,(o,a)=>{n.schedule(()=>{s.next({snapshot:o,prevKey:a})}),t==="once"&&n.schedule(()=>s.complete())},o=>{n.schedule(()=>s.error(o))}),t==="on"?{unsubscribe(){r!=null&&i.off(e,r)}}:{unsubscribe(){}}}).pipe(nt(s=>{let{snapshot:r,prevKey:o}=s,a=null;return r.exists()&&(a=r.key),{type:e,payload:r,prevKey:o,key:a}}),Yv())}function vP(i){return typeof i=="string"}function EP(i){return typeof i.exportVal=="function"}function hT(i){return i==null}function dT(i){return typeof i.set=="function"}function aT(i,e){return dT(e)?e:i.ref(e)}function fT(i,e){if(vP(i))return e.stringCase();if(dT(i))return e.firebaseCase();if(EP(i))return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof i}`)}function pT(i){return(hT(i)||i.length===0)&&(i=["child_added","child_removed","child_changed","child_moved"]),i}function mT(i,e,t){e=pT(e);let n=e.map(s=>Ma(i,s,"on",t));return Hd(...n)}function wP(i,e,t){let n=mT(i,e).pipe(gs((s,r)=>[...s,r],[]));return IP(i,n,t)}function TP(i,e){return Ma(i,"value","on",e).pipe(nt(t=>{let n;return t.payload.forEach(s=>(n=s.key,!1)),{data:t,lastKeyToLoad:n}}))}function IP(i,e,t){return TP(i,t).pipe(Zv(e),nt(([s,r])=>{let o=s.lastKeyToLoad,a=r.map(c=>c.key);return{actions:r,lastKeyToLoad:o,loadedKeys:a}}),Jv(s=>s.loadedKeys.indexOf(s.lastKeyToLoad)===-1),nt(s=>s.actions))}function lT(i,e){return function(n,s){return fT(n,{stringCase:()=>i.child(n)[e](s),firebaseCase:()=>n[e](s),snapshotCase:()=>n.ref[e](s)})}}function CP(i){return function(t){return t?fT(t,{stringCase:()=>i.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):i.remove()}}function SP(i,e,t){return Ma(i,"value","once",t).pipe(Xv(n=>{let s=[Qo(n)];return e.forEach(r=>s.push(Ma(i,r,"on",t))),Hd(...s).pipe(gs(AP,[]))}),Yl())}function gT(i,e){let t=i.length;for(let n=0;n<t;n++)if(i[n].payload.key===e)return n;return-1}function bP(i,e){if(hT(e))return 0;{let t=gT(i,e);return t===-1?i.length:t+1}}function AP(i,e){let{payload:t,prevKey:n,key:s}=e,r=gT(i,s),o=bP(i,n);switch(e.type){case"value":if(e.payload?.exists()){let a=null;e.payload.forEach(c=>{let u={payload:c,type:"value",prevKey:a,key:c.key};return a=c.key,i=[...i,u],!1})}return i;case"child_added":if(r>-1)(i[r-1]?.key||null)!==n&&(i=i.filter(c=>c.payload.key!==t.key),i.splice(o,0,e));else{if(n==null)return[e,...i];i=i.slice(),i.splice(o,0,e)}return i;case"child_removed":return i.filter(a=>a.payload.key!==t.key);case"child_changed":return i.map(a=>a.payload.key===s?e:a);case"child_moved":if(r>-1){let a=i.splice(r,1)[0];return i=i.slice(),i.splice(o,0,a),i}return i;default:return i}}function cT(i,e,t){return e=pT(e),SP(i,e,t)}function RP(i,e){let t=e.schedulers.outsideAngular,n=e.schedulers.ngZone.run(()=>i.ref);return{query:i,update:lT(n,"update"),set:lT(n,"set"),push:s=>n.push(s),remove:CP(n),snapshotChanges(s){return cT(i,s,t).pipe(ut)},stateChanges(s){return mT(i,s,t).pipe(ut)},auditTrail(s){return wP(i,s,t).pipe(ut)},valueChanges(s,r){return cT(i,s,t).pipe(nt(a=>a.map(c=>r&&r.idField?vn(Ae({},c.payload.val()),{[r.idField]:c.key}):c.payload.val())),ut)}}}function uT(i,e){return function(){return Ma(i,"value","on",e)}}function PP(i,e){return{query:i,snapshotChanges(){return uT(i,e.schedulers.outsideAngular)().pipe(ut)},update(t){return i.ref.update(t)},set(t){return i.ref.set(t)},remove(){return i.ref.remove()},valueChanges(){return uT(i,e.schedulers.outsideAngular)().pipe(ut,nt(n=>n.payload.exists()?n.payload.val():null))}}}var NP=new On("angularfire2.realtimeDatabaseURL"),xP=new On("angularfire2.database.use-emulator"),DP=(()=>{class i{schedulers;database;constructor(t,n,s,r,o,a,c,u,d,f,m,_,v,C,R){this.schedulers=a;let F=c,V=Tc(t,o,n);u&&Nc(V,o,d,m,_,v,f,C),this.database=Ic(`${V.name}.database.${s}`,"AngularFireDatabase",V.name,()=>{let B=o.runOutsideAngular(()=>V.database(s||void 0));return F&&B.useEmulator(...F),B},[F])}list(t,n){let s=this.schedulers.ngZone.runOutsideAngular(()=>aT(this.database,t)),r=s;return n&&(r=n(s)),RP(r,this)}object(t){let n=this.schedulers.ngZone.runOutsideAngular(()=>aT(this.database,t));return PP(n,this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}static \u0275fac=function(n){return new(n||i)(te(Ec),te(wc,8),te(NP,8),te(Ni),te(zt),te(vc),te(xP,8),te(xc,8),te(Cc,8),te(Sc,8),te(bc,8),te(Ac,8),te(Rc,8),te(Pc,8),te(yc,8))};static \u0275prov=yt({token:i,factory:i.\u0275fac,providedIn:"any"})}return i})(),_T=(()=>{class i{constructor(){ki.registerVersion("angularfire",_c.full,"rtdb-compat")}static \u0275fac=function(n){return new(n||i)};static \u0275mod=Ot({type:i});static \u0275inj=Dt({providers:[DP]})}return i})();var yT=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},vT={};var Wi,Zp;(function(){var i;function e(T,y){function w(){}w.prototype=y.prototype,T.D=y.prototype,T.prototype=new w,T.prototype.constructor=T,T.C=function(I,S,A){for(var E=Array(arguments.length-2),en=2;en<arguments.length;en++)E[en-2]=arguments[en];return y.prototype[S].apply(I,E)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(T,y,w){w||(w=0);var I=Array(16);if(typeof y=="string")for(var S=0;16>S;++S)I[S]=y.charCodeAt(w++)|y.charCodeAt(w++)<<8|y.charCodeAt(w++)<<16|y.charCodeAt(w++)<<24;else for(S=0;16>S;++S)I[S]=y[w++]|y[w++]<<8|y[w++]<<16|y[w++]<<24;y=T.g[0],w=T.g[1],S=T.g[2];var A=T.g[3],E=y+(A^w&(S^A))+I[0]+3614090360&4294967295;y=w+(E<<7&4294967295|E>>>25),E=A+(S^y&(w^S))+I[1]+3905402710&4294967295,A=y+(E<<12&4294967295|E>>>20),E=S+(w^A&(y^w))+I[2]+606105819&4294967295,S=A+(E<<17&4294967295|E>>>15),E=w+(y^S&(A^y))+I[3]+3250441966&4294967295,w=S+(E<<22&4294967295|E>>>10),E=y+(A^w&(S^A))+I[4]+4118548399&4294967295,y=w+(E<<7&4294967295|E>>>25),E=A+(S^y&(w^S))+I[5]+1200080426&4294967295,A=y+(E<<12&4294967295|E>>>20),E=S+(w^A&(y^w))+I[6]+2821735955&4294967295,S=A+(E<<17&4294967295|E>>>15),E=w+(y^S&(A^y))+I[7]+4249261313&4294967295,w=S+(E<<22&4294967295|E>>>10),E=y+(A^w&(S^A))+I[8]+1770035416&4294967295,y=w+(E<<7&4294967295|E>>>25),E=A+(S^y&(w^S))+I[9]+2336552879&4294967295,A=y+(E<<12&4294967295|E>>>20),E=S+(w^A&(y^w))+I[10]+4294925233&4294967295,S=A+(E<<17&4294967295|E>>>15),E=w+(y^S&(A^y))+I[11]+2304563134&4294967295,w=S+(E<<22&4294967295|E>>>10),E=y+(A^w&(S^A))+I[12]+1804603682&4294967295,y=w+(E<<7&4294967295|E>>>25),E=A+(S^y&(w^S))+I[13]+4254626195&4294967295,A=y+(E<<12&4294967295|E>>>20),E=S+(w^A&(y^w))+I[14]+2792965006&4294967295,S=A+(E<<17&4294967295|E>>>15),E=w+(y^S&(A^y))+I[15]+1236535329&4294967295,w=S+(E<<22&4294967295|E>>>10),E=y+(S^A&(w^S))+I[1]+4129170786&4294967295,y=w+(E<<5&4294967295|E>>>27),E=A+(w^S&(y^w))+I[6]+3225465664&4294967295,A=y+(E<<9&4294967295|E>>>23),E=S+(y^w&(A^y))+I[11]+643717713&4294967295,S=A+(E<<14&4294967295|E>>>18),E=w+(A^y&(S^A))+I[0]+3921069994&4294967295,w=S+(E<<20&4294967295|E>>>12),E=y+(S^A&(w^S))+I[5]+3593408605&4294967295,y=w+(E<<5&4294967295|E>>>27),E=A+(w^S&(y^w))+I[10]+38016083&4294967295,A=y+(E<<9&4294967295|E>>>23),E=S+(y^w&(A^y))+I[15]+3634488961&4294967295,S=A+(E<<14&4294967295|E>>>18),E=w+(A^y&(S^A))+I[4]+3889429448&4294967295,w=S+(E<<20&4294967295|E>>>12),E=y+(S^A&(w^S))+I[9]+568446438&4294967295,y=w+(E<<5&4294967295|E>>>27),E=A+(w^S&(y^w))+I[14]+3275163606&4294967295,A=y+(E<<9&4294967295|E>>>23),E=S+(y^w&(A^y))+I[3]+4107603335&4294967295,S=A+(E<<14&4294967295|E>>>18),E=w+(A^y&(S^A))+I[8]+1163531501&4294967295,w=S+(E<<20&4294967295|E>>>12),E=y+(S^A&(w^S))+I[13]+2850285829&4294967295,y=w+(E<<5&4294967295|E>>>27),E=A+(w^S&(y^w))+I[2]+4243563512&4294967295,A=y+(E<<9&4294967295|E>>>23),E=S+(y^w&(A^y))+I[7]+1735328473&4294967295,S=A+(E<<14&4294967295|E>>>18),E=w+(A^y&(S^A))+I[12]+2368359562&4294967295,w=S+(E<<20&4294967295|E>>>12),E=y+(w^S^A)+I[5]+4294588738&4294967295,y=w+(E<<4&4294967295|E>>>28),E=A+(y^w^S)+I[8]+2272392833&4294967295,A=y+(E<<11&4294967295|E>>>21),E=S+(A^y^w)+I[11]+1839030562&4294967295,S=A+(E<<16&4294967295|E>>>16),E=w+(S^A^y)+I[14]+4259657740&4294967295,w=S+(E<<23&4294967295|E>>>9),E=y+(w^S^A)+I[1]+2763975236&4294967295,y=w+(E<<4&4294967295|E>>>28),E=A+(y^w^S)+I[4]+1272893353&4294967295,A=y+(E<<11&4294967295|E>>>21),E=S+(A^y^w)+I[7]+4139469664&4294967295,S=A+(E<<16&4294967295|E>>>16),E=w+(S^A^y)+I[10]+3200236656&4294967295,w=S+(E<<23&4294967295|E>>>9),E=y+(w^S^A)+I[13]+681279174&4294967295,y=w+(E<<4&4294967295|E>>>28),E=A+(y^w^S)+I[0]+3936430074&4294967295,A=y+(E<<11&4294967295|E>>>21),E=S+(A^y^w)+I[3]+3572445317&4294967295,S=A+(E<<16&4294967295|E>>>16),E=w+(S^A^y)+I[6]+76029189&4294967295,w=S+(E<<23&4294967295|E>>>9),E=y+(w^S^A)+I[9]+3654602809&4294967295,y=w+(E<<4&4294967295|E>>>28),E=A+(y^w^S)+I[12]+3873151461&4294967295,A=y+(E<<11&4294967295|E>>>21),E=S+(A^y^w)+I[15]+530742520&4294967295,S=A+(E<<16&4294967295|E>>>16),E=w+(S^A^y)+I[2]+3299628645&4294967295,w=S+(E<<23&4294967295|E>>>9),E=y+(S^(w|~A))+I[0]+4096336452&4294967295,y=w+(E<<6&4294967295|E>>>26),E=A+(w^(y|~S))+I[7]+1126891415&4294967295,A=y+(E<<10&4294967295|E>>>22),E=S+(y^(A|~w))+I[14]+2878612391&4294967295,S=A+(E<<15&4294967295|E>>>17),E=w+(A^(S|~y))+I[5]+4237533241&4294967295,w=S+(E<<21&4294967295|E>>>11),E=y+(S^(w|~A))+I[12]+1700485571&4294967295,y=w+(E<<6&4294967295|E>>>26),E=A+(w^(y|~S))+I[3]+2399980690&4294967295,A=y+(E<<10&4294967295|E>>>22),E=S+(y^(A|~w))+I[10]+4293915773&4294967295,S=A+(E<<15&4294967295|E>>>17),E=w+(A^(S|~y))+I[1]+2240044497&4294967295,w=S+(E<<21&4294967295|E>>>11),E=y+(S^(w|~A))+I[8]+1873313359&4294967295,y=w+(E<<6&4294967295|E>>>26),E=A+(w^(y|~S))+I[15]+4264355552&4294967295,A=y+(E<<10&4294967295|E>>>22),E=S+(y^(A|~w))+I[6]+2734768916&4294967295,S=A+(E<<15&4294967295|E>>>17),E=w+(A^(S|~y))+I[13]+1309151649&4294967295,w=S+(E<<21&4294967295|E>>>11),E=y+(S^(w|~A))+I[4]+4149444226&4294967295,y=w+(E<<6&4294967295|E>>>26),E=A+(w^(y|~S))+I[11]+3174756917&4294967295,A=y+(E<<10&4294967295|E>>>22),E=S+(y^(A|~w))+I[2]+718787259&4294967295,S=A+(E<<15&4294967295|E>>>17),E=w+(A^(S|~y))+I[9]+3951481745&4294967295,T.g[0]=T.g[0]+y&4294967295,T.g[1]=T.g[1]+(S+(E<<21&4294967295|E>>>11))&4294967295,T.g[2]=T.g[2]+S&4294967295,T.g[3]=T.g[3]+A&4294967295}n.prototype.u=function(T,y){y===void 0&&(y=T.length);for(var w=y-this.blockSize,I=this.B,S=this.h,A=0;A<y;){if(S==0)for(;A<=w;)s(this,T,A),A+=this.blockSize;if(typeof T=="string"){for(;A<y;)if(I[S++]=T.charCodeAt(A++),S==this.blockSize){s(this,I),S=0;break}}else for(;A<y;)if(I[S++]=T[A++],S==this.blockSize){s(this,I),S=0;break}}this.h=S,this.o+=y},n.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var y=1;y<T.length-8;++y)T[y]=0;var w=8*this.o;for(y=T.length-8;y<T.length;++y)T[y]=w&255,w/=256;for(this.u(T),T=Array(16),y=w=0;4>y;++y)for(var I=0;32>I;I+=8)T[w++]=this.g[y]>>>I&255;return T};function r(T,y){var w=a;return Object.prototype.hasOwnProperty.call(w,T)?w[T]:w[T]=y(T)}function o(T,y){this.h=y;for(var w=[],I=!0,S=T.length-1;0<=S;S--){var A=T[S]|0;I&&A==y||(w[S]=A,I=!1)}this.g=w}var a={};function c(T){return-128<=T&&128>T?r(T,function(y){return new o([y|0],0>y?-1:0)}):new o([T|0],0>T?-1:0)}function u(T){if(isNaN(T)||!isFinite(T))return f;if(0>T)return R(u(-T));for(var y=[],w=1,I=0;T>=w;I++)y[I]=T/w|0,w*=4294967296;return new o(y,0)}function d(T,y){if(T.length==0)throw Error("number format error: empty string");if(y=y||10,2>y||36<y)throw Error("radix out of range: "+y);if(T.charAt(0)=="-")return R(d(T.substring(1),y));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=u(Math.pow(y,8)),I=f,S=0;S<T.length;S+=8){var A=Math.min(8,T.length-S),E=parseInt(T.substring(S,S+A),y);8>A?(A=u(Math.pow(y,A)),I=I.j(A).add(u(E))):(I=I.j(w),I=I.add(u(E)))}return I}var f=c(0),m=c(1),_=c(16777216);i=o.prototype,i.m=function(){if(C(this))return-R(this).m();for(var T=0,y=1,w=0;w<this.g.length;w++){var I=this.i(w);T+=(0<=I?I:4294967296+I)*y,y*=4294967296}return T},i.toString=function(T){if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(v(this))return"0";if(C(this))return"-"+R(this).toString(T);for(var y=u(Math.pow(T,6)),w=this,I="";;){var S=$(w,y).g;w=F(w,S.j(y));var A=((0<w.g.length?w.g[0]:w.h)>>>0).toString(T);if(w=S,v(w))return A+I;for(;6>A.length;)A="0"+A;I=A+I}},i.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h};function v(T){if(T.h!=0)return!1;for(var y=0;y<T.g.length;y++)if(T.g[y]!=0)return!1;return!0}function C(T){return T.h==-1}i.l=function(T){return T=F(this,T),C(T)?-1:v(T)?0:1};function R(T){for(var y=T.g.length,w=[],I=0;I<y;I++)w[I]=~T.g[I];return new o(w,~T.h).add(m)}i.abs=function(){return C(this)?R(this):this},i.add=function(T){for(var y=Math.max(this.g.length,T.g.length),w=[],I=0,S=0;S<=y;S++){var A=I+(this.i(S)&65535)+(T.i(S)&65535),E=(A>>>16)+(this.i(S)>>>16)+(T.i(S)>>>16);I=E>>>16,A&=65535,E&=65535,w[S]=E<<16|A}return new o(w,w[w.length-1]&-2147483648?-1:0)};function F(T,y){return T.add(R(y))}i.j=function(T){if(v(this)||v(T))return f;if(C(this))return C(T)?R(this).j(R(T)):R(R(this).j(T));if(C(T))return R(this.j(R(T)));if(0>this.l(_)&&0>T.l(_))return u(this.m()*T.m());for(var y=this.g.length+T.g.length,w=[],I=0;I<2*y;I++)w[I]=0;for(I=0;I<this.g.length;I++)for(var S=0;S<T.g.length;S++){var A=this.i(I)>>>16,E=this.i(I)&65535,en=T.i(S)>>>16,Ii=T.i(S)&65535;w[2*I+2*S]+=E*Ii,V(w,2*I+2*S),w[2*I+2*S+1]+=A*Ii,V(w,2*I+2*S+1),w[2*I+2*S+1]+=E*en,V(w,2*I+2*S+1),w[2*I+2*S+2]+=A*en,V(w,2*I+2*S+2)}for(I=0;I<y;I++)w[I]=w[2*I+1]<<16|w[2*I];for(I=y;I<2*y;I++)w[I]=0;return new o(w,0)};function V(T,y){for(;(T[y]&65535)!=T[y];)T[y+1]+=T[y]>>>16,T[y]&=65535,y++}function B(T,y){this.g=T,this.h=y}function $(T,y){if(v(y))throw Error("division by zero");if(v(T))return new B(f,f);if(C(T))return y=$(R(T),y),new B(R(y.g),R(y.h));if(C(y))return y=$(T,R(y)),new B(R(y.g),y.h);if(30<T.g.length){if(C(T)||C(y))throw Error("slowDivide_ only works with positive integers.");for(var w=m,I=y;0>=I.l(T);)w=le(w),I=le(I);var S=Z(w,1),A=Z(I,1);for(I=Z(I,2),w=Z(w,2);!v(I);){var E=A.add(I);0>=E.l(T)&&(S=S.add(w),A=E),I=Z(I,1),w=Z(w,1)}return y=F(T,S.j(y)),new B(S,y)}for(S=f;0<=T.l(y);){for(w=Math.max(1,Math.floor(T.m()/y.m())),I=Math.ceil(Math.log(w)/Math.LN2),I=48>=I?1:Math.pow(2,I-48),A=u(w),E=A.j(y);C(E)||0<E.l(T);)w-=I,A=u(w),E=A.j(y);v(A)&&(A=m),S=S.add(A),T=F(T,E)}return new B(S,T)}i.A=function(T){return $(this,T).h},i.and=function(T){for(var y=Math.max(this.g.length,T.g.length),w=[],I=0;I<y;I++)w[I]=this.i(I)&T.i(I);return new o(w,this.h&T.h)},i.or=function(T){for(var y=Math.max(this.g.length,T.g.length),w=[],I=0;I<y;I++)w[I]=this.i(I)|T.i(I);return new o(w,this.h|T.h)},i.xor=function(T){for(var y=Math.max(this.g.length,T.g.length),w=[],I=0;I<y;I++)w[I]=this.i(I)^T.i(I);return new o(w,this.h^T.h)};function le(T){for(var y=T.g.length+1,w=[],I=0;I<y;I++)w[I]=T.i(I)<<1|T.i(I-1)>>>31;return new o(w,T.h)}function Z(T,y){var w=y>>5;y%=32;for(var I=T.g.length-w,S=[],A=0;A<I;A++)S[A]=0<y?T.i(A+w)>>>y|T.i(A+w+1)<<32-y:T.i(A+w);return new o(S,T.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,Zp=vT.Md5=n,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=d,Wi=vT.Integer=o}).apply(typeof yT<"u"?yT:typeof self<"u"?self:typeof window<"u"?window:{});var Su=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},di={};var em,OP,Fr,tm,Fa,bu,nm,im,sm;(function(){var i,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(l,h,p){return l==Array.prototype||l==Object.prototype||(l[h]=p.value),l};function t(l){l=[typeof globalThis=="object"&&globalThis,l,typeof window=="object"&&window,typeof self=="object"&&self,typeof Su=="object"&&Su];for(var h=0;h<l.length;++h){var p=l[h];if(p&&p.Math==Math)return p}throw Error("Cannot find global object")}var n=t(this);function s(l,h){if(h)e:{var p=n;l=l.split(".");for(var g=0;g<l.length-1;g++){var b=l[g];if(!(b in p))break e;p=p[b]}l=l[l.length-1],g=p[l],h=h(g),h!=g&&h!=null&&e(p,l,{configurable:!0,writable:!0,value:h})}}function r(l,h){l instanceof String&&(l+="");var p=0,g=!1,b={next:function(){if(!g&&p<l.length){var N=p++;return{value:h(N,l[N]),done:!1}}return g=!0,{done:!0,value:void 0}}};return b[Symbol.iterator]=function(){return b},b}s("Array.prototype.values",function(l){return l||function(){return r(this,function(h,p){return p})}});var o=o||{},a=this||self;function c(l){var h=typeof l;return h=h!="object"?h:l?Array.isArray(l)?"array":h:"null",h=="array"||h=="object"&&typeof l.length=="number"}function u(l){var h=typeof l;return h=="object"&&l!=null||h=="function"}function d(l,h,p){return l.call.apply(l.bind,arguments)}function f(l,h,p){if(!l)throw Error();if(2<arguments.length){var g=Array.prototype.slice.call(arguments,2);return function(){var b=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(b,g),l.apply(h,b)}}return function(){return l.apply(h,arguments)}}function m(l,h,p){return m=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:f,m.apply(null,arguments)}function _(l,h){var p=Array.prototype.slice.call(arguments,1);return function(){var g=p.slice();return g.push.apply(g,arguments),l.apply(this,g)}}function v(l,h){function p(){}p.prototype=h.prototype,l.aa=h.prototype,l.prototype=new p,l.prototype.constructor=l,l.Qb=function(g,b,N){for(var U=Array(arguments.length-2),xe=2;xe<arguments.length;xe++)U[xe-2]=arguments[xe];return h.prototype[b].apply(g,U)}}function C(l){let h=l.length;if(0<h){let p=Array(h);for(let g=0;g<h;g++)p[g]=l[g];return p}return[]}function R(l,h){for(let p=1;p<arguments.length;p++){let g=arguments[p];if(c(g)){let b=l.length||0,N=g.length||0;l.length=b+N;for(let U=0;U<N;U++)l[b+U]=g[U]}else l.push(g)}}class F{constructor(h,p){this.i=h,this.j=p,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function V(l){return/^[\s\xa0]*$/.test(l)}function B(){var l=a.navigator;return l&&(l=l.userAgent)?l:""}function $(l){return $[" "](l),l}$[" "]=function(){};var le=B().indexOf("Gecko")!=-1&&!(B().toLowerCase().indexOf("webkit")!=-1&&B().indexOf("Edge")==-1)&&!(B().indexOf("Trident")!=-1||B().indexOf("MSIE")!=-1)&&B().indexOf("Edge")==-1;function Z(l,h,p){for(let g in l)h.call(p,l[g],g,l)}function T(l,h){for(let p in l)h.call(void 0,l[p],p,l)}function y(l){let h={};for(let p in l)h[p]=l[p];return h}let w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function I(l,h){let p,g;for(let b=1;b<arguments.length;b++){g=arguments[b];for(p in g)l[p]=g[p];for(let N=0;N<w.length;N++)p=w[N],Object.prototype.hasOwnProperty.call(g,p)&&(l[p]=g[p])}}function S(l){var h=1;l=l.split(":");let p=[];for(;0<h&&l.length;)p.push(l.shift()),h--;return l.length&&p.push(l.join(":")),p}function A(l){a.setTimeout(()=>{throw l},0)}function E(){var l=me;let h=null;return l.g&&(h=l.g,l.g=l.g.next,l.g||(l.h=null),h.next=null),h}class en{constructor(){this.h=this.g=null}add(h,p){let g=Ii.get();g.set(h,p),this.h?this.h.next=g:this.g=g,this.h=g}}var Ii=new F(()=>new H,l=>l.reset());class H{constructor(){this.next=this.g=this.h=null}set(h,p){this.h=h,this.g=p,this.next=null}reset(){this.next=this.g=this.h=null}}let Y,X=!1,me=new en,Je=()=>{let l=a.Promise.resolve(void 0);Y=()=>{l.then(tn)}};var tn=()=>{for(var l;l=E();){try{l.h.call(l.g)}catch(p){A(p)}var h=Ii;h.j(l),100>h.h&&(h.h++,l.next=h.g,h.g=l)}X=!1};function Ke(){this.s=this.s,this.C=this.C}Ke.prototype.s=!1,Ke.prototype.ma=function(){this.s||(this.s=!0,this.N())},Ke.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Fe(l,h){this.type=l,this.g=this.target=h,this.defaultPrevented=!1}Fe.prototype.h=function(){this.defaultPrevented=!0};var Le=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var l=!1,h=Object.defineProperty({},"passive",{get:function(){l=!0}});try{let p=()=>{};a.addEventListener("test",p,h),a.removeEventListener("test",p,h)}catch{}return l}();function Ci(l,h){if(Fe.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l){var p=this.type=l.type,g=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;if(this.target=l.target||l.srcElement,this.g=h,h=l.relatedTarget){if(le){e:{try{$(h.nodeName);var b=!0;break e}catch{}b=!1}b||(h=null)}}else p=="mouseover"?h=l.fromElement:p=="mouseout"&&(h=l.toElement);this.relatedTarget=h,g?(this.clientX=g.clientX!==void 0?g.clientX:g.pageX,this.clientY=g.clientY!==void 0?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0):(this.clientX=l.clientX!==void 0?l.clientX:l.pageX,this.clientY=l.clientY!==void 0?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType=typeof l.pointerType=="string"?l.pointerType:wd[l.pointerType]||"",this.state=l.state,this.i=l,l.defaultPrevented&&Ci.aa.h.call(this)}}v(Ci,Fe);var wd={2:"touch",3:"pen",4:"mouse"};Ci.prototype.h=function(){Ci.aa.h.call(this);var l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var He="closure_listenable_"+(1e6*Math.random()|0),ni=0;function qt(l,h,p,g,b){this.listener=l,this.proxy=null,this.src=h,this.type=p,this.capture=!!g,this.ha=b,this.key=++ni,this.da=this.fa=!1}function ii(l){l.da=!0,l.listener=null,l.proxy=null,l.src=null,l.ha=null}function Si(l){this.src=l,this.g={},this.h=0}Si.prototype.add=function(l,h,p,g,b){var N=l.toString();l=this.g[N],l||(l=this.g[N]=[],this.h++);var U=Id(l,h,g,b);return-1<U?(h=l[U],p||(h.fa=!1)):(h=new qt(h,this.src,N,!!g,b),h.fa=p,l.push(h)),h};function Td(l,h){var p=h.type;if(p in l.g){var g=l.g[p],b=Array.prototype.indexOf.call(g,h,void 0),N;(N=0<=b)&&Array.prototype.splice.call(g,b,1),N&&(ii(h),l.g[p].length==0&&(delete l.g[p],l.h--))}}function Id(l,h,p,g){for(var b=0;b<l.length;++b){var N=l[b];if(!N.da&&N.listener==h&&N.capture==!!p&&N.ha==g)return b}return-1}var Cd="closure_lm_"+(1e6*Math.random()|0),Sd={};function $y(l,h,p,g,b){if(g&&g.once)return Jy(l,h,p,g,b);if(Array.isArray(h)){for(var N=0;N<h.length;N++)$y(l,h[N],p,g,b);return null}return p=Pd(p),l&&l[He]?l.K(h,p,u(g)?!!g.capture:!!g,b):Yy(l,h,p,!1,g,b)}function Yy(l,h,p,g,b,N){if(!h)throw Error("Invalid event type");var U=u(b)?!!b.capture:!!b,xe=Ad(l);if(xe||(l[Cd]=xe=new Si(l)),p=xe.add(h,p,g,U,N),p.proxy)return p;if(g=Jb(),p.proxy=g,g.src=l,g.listener=p,l.addEventListener)Le||(b=U),b===void 0&&(b=!1),l.addEventListener(h.toString(),g,b);else if(l.attachEvent)l.attachEvent(Zy(h.toString()),g);else if(l.addListener&&l.removeListener)l.addListener(g);else throw Error("addEventListener and attachEvent are unavailable.");return p}function Jb(){function l(p){return h.call(l.src,l.listener,p)}let h=Xb;return l}function Jy(l,h,p,g,b){if(Array.isArray(h)){for(var N=0;N<h.length;N++)Jy(l,h[N],p,g,b);return null}return p=Pd(p),l&&l[He]?l.L(h,p,u(g)?!!g.capture:!!g,b):Yy(l,h,p,!0,g,b)}function Xy(l,h,p,g,b){if(Array.isArray(h))for(var N=0;N<h.length;N++)Xy(l,h[N],p,g,b);else g=u(g)?!!g.capture:!!g,p=Pd(p),l&&l[He]?(l=l.i,h=String(h).toString(),h in l.g&&(N=l.g[h],p=Id(N,p,g,b),-1<p&&(ii(N[p]),Array.prototype.splice.call(N,p,1),N.length==0&&(delete l.g[h],l.h--)))):l&&(l=Ad(l))&&(h=l.g[h.toString()],l=-1,h&&(l=Id(h,p,g,b)),(p=-1<l?h[l]:null)&&bd(p))}function bd(l){if(typeof l!="number"&&l&&!l.da){var h=l.src;if(h&&h[He])Td(h.i,l);else{var p=l.type,g=l.proxy;h.removeEventListener?h.removeEventListener(p,g,l.capture):h.detachEvent?h.detachEvent(Zy(p),g):h.addListener&&h.removeListener&&h.removeListener(g),(p=Ad(h))?(Td(p,l),p.h==0&&(p.src=null,h[Cd]=null)):ii(l)}}}function Zy(l){return l in Sd?Sd[l]:Sd[l]="on"+l}function Xb(l,h){if(l.da)l=!0;else{h=new Ci(h,this);var p=l.listener,g=l.ha||l.src;l.fa&&bd(l),l=p.call(g,h)}return l}function Ad(l){return l=l[Cd],l instanceof Si?l:null}var Rd="__closure_events_fn_"+(1e9*Math.random()>>>0);function Pd(l){return typeof l=="function"?l:(l[Rd]||(l[Rd]=function(h){return l.handleEvent(h)}),l[Rd])}function wt(){Ke.call(this),this.i=new Si(this),this.M=this,this.F=null}v(wt,Ke),wt.prototype[He]=!0,wt.prototype.removeEventListener=function(l,h,p,g){Xy(this,l,h,p,g)};function Nt(l,h){var p,g=l.F;if(g)for(p=[];g;g=g.F)p.push(g);if(l=l.M,g=h.type||h,typeof h=="string")h=new Fe(h,l);else if(h instanceof Fe)h.target=h.target||l;else{var b=h;h=new Fe(g,l),I(h,b)}if(b=!0,p)for(var N=p.length-1;0<=N;N--){var U=h.g=p[N];b=Ol(U,g,!0,h)&&b}if(U=h.g=l,b=Ol(U,g,!0,h)&&b,b=Ol(U,g,!1,h)&&b,p)for(N=0;N<p.length;N++)U=h.g=p[N],b=Ol(U,g,!1,h)&&b}wt.prototype.N=function(){if(wt.aa.N.call(this),this.i){var l=this.i,h;for(h in l.g){for(var p=l.g[h],g=0;g<p.length;g++)ii(p[g]);delete l.g[h],l.h--}}this.F=null},wt.prototype.K=function(l,h,p,g){return this.i.add(String(l),h,!1,p,g)},wt.prototype.L=function(l,h,p,g){return this.i.add(String(l),h,!0,p,g)};function Ol(l,h,p,g){if(h=l.i.g[String(h)],!h)return!0;h=h.concat();for(var b=!0,N=0;N<h.length;++N){var U=h[N];if(U&&!U.da&&U.capture==p){var xe=U.listener,_t=U.ha||U.src;U.fa&&Td(l.i,U),b=xe.call(_t,g)!==!1&&b}}return b&&!g.defaultPrevented}function ev(l,h,p){if(typeof l=="function")p&&(l=m(l,p));else if(l&&typeof l.handleEvent=="function")l=m(l.handleEvent,l);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:a.setTimeout(l,h||0)}function tv(l){l.g=ev(()=>{l.g=null,l.i&&(l.i=!1,tv(l))},l.l);let h=l.h;l.h=null,l.m.apply(null,h)}class Zb extends Ke{constructor(h,p){super(),this.m=h,this.l=p,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:tv(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Oo(l){Ke.call(this),this.h=l,this.g={}}v(Oo,Ke);var nv=[];function iv(l){Z(l.g,function(h,p){this.g.hasOwnProperty(p)&&bd(h)},l),l.g={}}Oo.prototype.N=function(){Oo.aa.N.call(this),iv(this)},Oo.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Nd=a.JSON.stringify,e1=a.JSON.parse,t1=class{stringify(l){return a.JSON.stringify(l,void 0)}parse(l){return a.JSON.parse(l,void 0)}};function xd(){}xd.prototype.h=null;function sv(l){return l.h||(l.h=l.i())}function rv(){}var ko={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Dd(){Fe.call(this,"d")}v(Dd,Fe);function Od(){Fe.call(this,"c")}v(Od,Fe);var ds={},ov=null;function kl(){return ov=ov||new wt}ds.La="serverreachability";function av(l){Fe.call(this,ds.La,l)}v(av,Fe);function Mo(l){let h=kl();Nt(h,new av(h))}ds.STAT_EVENT="statevent";function lv(l,h){Fe.call(this,ds.STAT_EVENT,l),this.stat=h}v(lv,Fe);function xt(l){let h=kl();Nt(h,new lv(h,l))}ds.Ma="timingevent";function cv(l,h){Fe.call(this,ds.Ma,l),this.size=h}v(cv,Fe);function Fo(l,h){if(typeof l!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){l()},h)}function Lo(){this.g=!0}Lo.prototype.xa=function(){this.g=!1};function n1(l,h,p,g,b,N){l.info(function(){if(l.g)if(N)for(var U="",xe=N.split("&"),_t=0;_t<xe.length;_t++){var Te=xe[_t].split("=");if(1<Te.length){var Tt=Te[0];Te=Te[1];var It=Tt.split("_");U=2<=It.length&&It[1]=="type"?U+(Tt+"="+Te+"&"):U+(Tt+"=redacted&")}}else U=null;else U=N;return"XMLHTTP REQ ("+g+") [attempt "+b+"]: "+h+`
`+p+`
`+U})}function i1(l,h,p,g,b,N,U){l.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+b+"]: "+h+`
`+p+`
`+N+" "+U})}function ur(l,h,p,g){l.info(function(){return"XMLHTTP TEXT ("+h+"): "+r1(l,p)+(g?" "+g:"")})}function s1(l,h){l.info(function(){return"TIMEOUT: "+h})}Lo.prototype.info=function(){};function r1(l,h){if(!l.g)return h;if(!h)return null;try{var p=JSON.parse(h);if(p){for(l=0;l<p.length;l++)if(Array.isArray(p[l])){var g=p[l];if(!(2>g.length)){var b=g[1];if(Array.isArray(b)&&!(1>b.length)){var N=b[0];if(N!="noop"&&N!="stop"&&N!="close")for(var U=1;U<b.length;U++)b[U]=""}}}}return Nd(p)}catch{return h}}var Ml={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},uv={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},kd;function Fl(){}v(Fl,xd),Fl.prototype.g=function(){return new XMLHttpRequest},Fl.prototype.i=function(){return{}},kd=new Fl;function bi(l,h,p,g){this.j=l,this.i=h,this.l=p,this.R=g||1,this.U=new Oo(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new hv}function hv(){this.i=null,this.g="",this.h=!1}var dv={},Md={};function Fd(l,h,p){l.L=1,l.v=Ul(si(h)),l.m=p,l.P=!0,fv(l,null)}function fv(l,h){l.F=Date.now(),Ll(l),l.A=si(l.v);var p=l.A,g=l.R;Array.isArray(g)||(g=[String(g)]),Av(p.i,"t",g),l.C=0,p=l.j.J,l.h=new hv,l.g=zv(l.j,p?h:null,!l.m),0<l.O&&(l.M=new Zb(m(l.Y,l,l.g),l.O)),h=l.U,p=l.g,g=l.ca;var b="readystatechange";Array.isArray(b)||(b&&(nv[0]=b.toString()),b=nv);for(var N=0;N<b.length;N++){var U=$y(p,b[N],g||h.handleEvent,!1,h.h||h);if(!U)break;h.g[U.key]=U}h=l.H?y(l.H):{},l.m?(l.u||(l.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",l.g.ea(l.A,l.u,l.m,h)):(l.u="GET",l.g.ea(l.A,l.u,null,h)),Mo(),n1(l.i,l.u,l.A,l.l,l.R,l.m)}bi.prototype.ca=function(l){l=l.target;let h=this.M;h&&ri(l)==3?h.j():this.Y(l)},bi.prototype.Y=function(l){try{if(l==this.g)e:{let It=ri(this.g);var h=this.g.Ba();let fr=this.g.Z();if(!(3>It)&&(It!=3||this.g&&(this.h.h||this.g.oa()||kv(this.g)))){this.J||It!=4||h==7||(h==8||0>=fr?Mo(3):Mo(2)),Ld(this);var p=this.g.Z();this.X=p;t:if(pv(this)){var g=kv(this.g);l="";var b=g.length,N=ri(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){fs(this),Vo(this);var U="";break t}this.h.i=new a.TextDecoder}for(h=0;h<b;h++)this.h.h=!0,l+=this.h.i.decode(g[h],{stream:!(N&&h==b-1)});g.length=0,this.h.g+=l,this.C=0,U=this.h.g}else U=this.g.oa();if(this.o=p==200,i1(this.i,this.u,this.A,this.l,this.R,It,p),this.o){if(this.T&&!this.K){t:{if(this.g){var xe,_t=this.g;if((xe=_t.g?_t.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!V(xe)){var Te=xe;break t}}Te=null}if(p=Te)ur(this.i,this.l,p,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Vd(this,p);else{this.o=!1,this.s=3,xt(12),fs(this),Vo(this);break e}}if(this.P){p=!0;let yn;for(;!this.J&&this.C<U.length;)if(yn=o1(this,U),yn==Md){It==4&&(this.s=4,xt(14),p=!1),ur(this.i,this.l,null,"[Incomplete Response]");break}else if(yn==dv){this.s=4,xt(15),ur(this.i,this.l,U,"[Invalid Chunk]"),p=!1;break}else ur(this.i,this.l,yn,null),Vd(this,yn);if(pv(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),It!=4||U.length!=0||this.h.h||(this.s=1,xt(16),p=!1),this.o=this.o&&p,!p)ur(this.i,this.l,U,"[Invalid Chunked Response]"),fs(this),Vo(this);else if(0<U.length&&!this.W){this.W=!0;var Tt=this.j;Tt.g==this&&Tt.ba&&!Tt.M&&(Tt.j.info("Great, no buffering proxy detected. Bytes received: "+U.length),Wd(Tt),Tt.M=!0,xt(11))}}else ur(this.i,this.l,U,null),Vd(this,U);It==4&&fs(this),this.o&&!this.J&&(It==4?qv(this.j,this):(this.o=!1,Ll(this)))}else I1(this.g),p==400&&0<U.indexOf("Unknown SID")?(this.s=3,xt(12)):(this.s=0,xt(13)),fs(this),Vo(this)}}}catch{}finally{}};function pv(l){return l.g?l.u=="GET"&&l.L!=2&&l.j.Ca:!1}function o1(l,h){var p=l.C,g=h.indexOf(`
`,p);return g==-1?Md:(p=Number(h.substring(p,g)),isNaN(p)?dv:(g+=1,g+p>h.length?Md:(h=h.slice(g,g+p),l.C=g+p,h)))}bi.prototype.cancel=function(){this.J=!0,fs(this)};function Ll(l){l.S=Date.now()+l.I,mv(l,l.I)}function mv(l,h){if(l.B!=null)throw Error("WatchDog timer not null");l.B=Fo(m(l.ba,l),h)}function Ld(l){l.B&&(a.clearTimeout(l.B),l.B=null)}bi.prototype.ba=function(){this.B=null;let l=Date.now();0<=l-this.S?(s1(this.i,this.A),this.L!=2&&(Mo(),xt(17)),fs(this),this.s=2,Vo(this)):mv(this,this.S-l)};function Vo(l){l.j.G==0||l.J||qv(l.j,l)}function fs(l){Ld(l);var h=l.M;h&&typeof h.ma=="function"&&h.ma(),l.M=null,iv(l.U),l.g&&(h=l.g,l.g=null,h.abort(),h.ma())}function Vd(l,h){try{var p=l.j;if(p.G!=0&&(p.g==l||Bd(p.h,l))){if(!l.K&&Bd(p.h,l)&&p.G==3){try{var g=p.Da.g.parse(h)}catch{g=null}if(Array.isArray(g)&&g.length==3){var b=g;if(b[0]==0){e:if(!p.u){if(p.g)if(p.g.F+3e3<l.F)zl(p),Gl(p);else break e;Gd(p),xt(18)}}else p.za=b[1],0<p.za-p.T&&37500>b[2]&&p.F&&p.v==0&&!p.C&&(p.C=Fo(m(p.Za,p),6e3));if(1>=yv(p.h)&&p.ca){try{p.ca()}catch{}p.ca=void 0}}else ms(p,11)}else if((l.K||p.g==l)&&zl(p),!V(h))for(b=p.Da.g.parse(h),h=0;h<b.length;h++){let Te=b[h];if(p.T=Te[0],Te=Te[1],p.G==2)if(Te[0]=="c"){p.K=Te[1],p.ia=Te[2];let Tt=Te[3];Tt!=null&&(p.la=Tt,p.j.info("VER="+p.la));let It=Te[4];It!=null&&(p.Aa=It,p.j.info("SVER="+p.Aa));let fr=Te[5];fr!=null&&typeof fr=="number"&&0<fr&&(g=1.5*fr,p.L=g,p.j.info("backChannelRequestTimeoutMs_="+g)),g=p;let yn=l.g;if(yn){let Hl=yn.g?yn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Hl){var N=g.h;N.g||Hl.indexOf("spdy")==-1&&Hl.indexOf("quic")==-1&&Hl.indexOf("h2")==-1||(N.j=N.l,N.g=new Set,N.h&&(Ud(N,N.h),N.h=null))}if(g.D){let zd=yn.g?yn.g.getResponseHeader("X-HTTP-Session-Id"):null;zd&&(g.ya=zd,Ve(g.I,g.D,zd))}}p.G=3,p.l&&p.l.ua(),p.ba&&(p.R=Date.now()-l.F,p.j.info("Handshake RTT: "+p.R+"ms")),g=p;var U=l;if(g.qa=Wv(g,g.J?g.ia:null,g.W),U.K){vv(g.h,U);var xe=U,_t=g.L;_t&&(xe.I=_t),xe.B&&(Ld(xe),Ll(xe)),g.g=U}else Bv(g);0<p.i.length&&Wl(p)}else Te[0]!="stop"&&Te[0]!="close"||ms(p,7);else p.G==3&&(Te[0]=="stop"||Te[0]=="close"?Te[0]=="stop"?ms(p,7):jd(p):Te[0]!="noop"&&p.l&&p.l.ta(Te),p.v=0)}}Mo(4)}catch{}}var a1=class{constructor(l,h){this.g=l,this.map=h}};function gv(l){this.l=l||10,a.PerformanceNavigationTiming?(l=a.performance.getEntriesByType("navigation"),l=0<l.length&&(l[0].nextHopProtocol=="hq"||l[0].nextHopProtocol=="h2")):l=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=l?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function _v(l){return l.h?!0:l.g?l.g.size>=l.j:!1}function yv(l){return l.h?1:l.g?l.g.size:0}function Bd(l,h){return l.h?l.h==h:l.g?l.g.has(h):!1}function Ud(l,h){l.g?l.g.add(h):l.h=h}function vv(l,h){l.h&&l.h==h?l.h=null:l.g&&l.g.has(h)&&l.g.delete(h)}gv.prototype.cancel=function(){if(this.i=Ev(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let l of this.g.values())l.cancel();this.g.clear()}};function Ev(l){if(l.h!=null)return l.i.concat(l.h.D);if(l.g!=null&&l.g.size!==0){let h=l.i;for(let p of l.g.values())h=h.concat(p.D);return h}return C(l.i)}function l1(l){if(l.V&&typeof l.V=="function")return l.V();if(typeof Map<"u"&&l instanceof Map||typeof Set<"u"&&l instanceof Set)return Array.from(l.values());if(typeof l=="string")return l.split("");if(c(l)){for(var h=[],p=l.length,g=0;g<p;g++)h.push(l[g]);return h}h=[],p=0;for(g in l)h[p++]=l[g];return h}function c1(l){if(l.na&&typeof l.na=="function")return l.na();if(!l.V||typeof l.V!="function"){if(typeof Map<"u"&&l instanceof Map)return Array.from(l.keys());if(!(typeof Set<"u"&&l instanceof Set)){if(c(l)||typeof l=="string"){var h=[];l=l.length;for(var p=0;p<l;p++)h.push(p);return h}h=[],p=0;for(let g in l)h[p++]=g;return h}}}function wv(l,h){if(l.forEach&&typeof l.forEach=="function")l.forEach(h,void 0);else if(c(l)||typeof l=="string")Array.prototype.forEach.call(l,h,void 0);else for(var p=c1(l),g=l1(l),b=g.length,N=0;N<b;N++)h.call(void 0,g[N],p&&p[N],l)}var Tv=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function u1(l,h){if(l){l=l.split("&");for(var p=0;p<l.length;p++){var g=l[p].indexOf("="),b=null;if(0<=g){var N=l[p].substring(0,g);b=l[p].substring(g+1)}else N=l[p];h(N,b?decodeURIComponent(b.replace(/\+/g," ")):"")}}}function ps(l){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,l instanceof ps){this.h=l.h,Vl(this,l.j),this.o=l.o,this.g=l.g,Bl(this,l.s),this.l=l.l;var h=l.i,p=new qo;p.i=h.i,h.g&&(p.g=new Map(h.g),p.h=h.h),Iv(this,p),this.m=l.m}else l&&(h=String(l).match(Tv))?(this.h=!1,Vl(this,h[1]||"",!0),this.o=Bo(h[2]||""),this.g=Bo(h[3]||"",!0),Bl(this,h[4]),this.l=Bo(h[5]||"",!0),Iv(this,h[6]||"",!0),this.m=Bo(h[7]||"")):(this.h=!1,this.i=new qo(null,this.h))}ps.prototype.toString=function(){var l=[],h=this.j;h&&l.push(Uo(h,Cv,!0),":");var p=this.g;return(p||h=="file")&&(l.push("//"),(h=this.o)&&l.push(Uo(h,Cv,!0),"@"),l.push(encodeURIComponent(String(p)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),p=this.s,p!=null&&l.push(":",String(p))),(p=this.l)&&(this.g&&p.charAt(0)!="/"&&l.push("/"),l.push(Uo(p,p.charAt(0)=="/"?f1:d1,!0))),(p=this.i.toString())&&l.push("?",p),(p=this.m)&&l.push("#",Uo(p,m1)),l.join("")};function si(l){return new ps(l)}function Vl(l,h,p){l.j=p?Bo(h,!0):h,l.j&&(l.j=l.j.replace(/:$/,""))}function Bl(l,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);l.s=h}else l.s=null}function Iv(l,h,p){h instanceof qo?(l.i=h,g1(l.i,l.h)):(p||(h=Uo(h,p1)),l.i=new qo(h,l.h))}function Ve(l,h,p){l.i.set(h,p)}function Ul(l){return Ve(l,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),l}function Bo(l,h){return l?h?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function Uo(l,h,p){return typeof l=="string"?(l=encodeURI(l).replace(h,h1),p&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function h1(l){return l=l.charCodeAt(0),"%"+(l>>4&15).toString(16)+(l&15).toString(16)}var Cv=/[#\/\?@]/g,d1=/[#\?:]/g,f1=/[#\?]/g,p1=/[#\?@]/g,m1=/#/g;function qo(l,h){this.h=this.g=null,this.i=l||null,this.j=!!h}function Ai(l){l.g||(l.g=new Map,l.h=0,l.i&&u1(l.i,function(h,p){l.add(decodeURIComponent(h.replace(/\+/g," ")),p)}))}i=qo.prototype,i.add=function(l,h){Ai(this),this.i=null,l=hr(this,l);var p=this.g.get(l);return p||this.g.set(l,p=[]),p.push(h),this.h+=1,this};function Sv(l,h){Ai(l),h=hr(l,h),l.g.has(h)&&(l.i=null,l.h-=l.g.get(h).length,l.g.delete(h))}function bv(l,h){return Ai(l),h=hr(l,h),l.g.has(h)}i.forEach=function(l,h){Ai(this),this.g.forEach(function(p,g){p.forEach(function(b){l.call(h,b,g,this)},this)},this)},i.na=function(){Ai(this);let l=Array.from(this.g.values()),h=Array.from(this.g.keys()),p=[];for(let g=0;g<h.length;g++){let b=l[g];for(let N=0;N<b.length;N++)p.push(h[g])}return p},i.V=function(l){Ai(this);let h=[];if(typeof l=="string")bv(this,l)&&(h=h.concat(this.g.get(hr(this,l))));else{l=Array.from(this.g.values());for(let p=0;p<l.length;p++)h=h.concat(l[p])}return h},i.set=function(l,h){return Ai(this),this.i=null,l=hr(this,l),bv(this,l)&&(this.h-=this.g.get(l).length),this.g.set(l,[h]),this.h+=1,this},i.get=function(l,h){return l?(l=this.V(l),0<l.length?String(l[0]):h):h};function Av(l,h,p){Sv(l,h),0<p.length&&(l.i=null,l.g.set(hr(l,h),C(p)),l.h+=p.length)}i.toString=function(){if(this.i)return this.i;if(!this.g)return"";let l=[],h=Array.from(this.g.keys());for(var p=0;p<h.length;p++){var g=h[p];let N=encodeURIComponent(String(g)),U=this.V(g);for(g=0;g<U.length;g++){var b=N;U[g]!==""&&(b+="="+encodeURIComponent(String(U[g]))),l.push(b)}}return this.i=l.join("&")};function hr(l,h){return h=String(h),l.j&&(h=h.toLowerCase()),h}function g1(l,h){h&&!l.j&&(Ai(l),l.i=null,l.g.forEach(function(p,g){var b=g.toLowerCase();g!=b&&(Sv(this,g),Av(this,b,p))},l)),l.j=h}function _1(l,h){let p=new Lo;if(a.Image){let g=new Image;g.onload=_(Ri,p,"TestLoadImage: loaded",!0,h,g),g.onerror=_(Ri,p,"TestLoadImage: error",!1,h,g),g.onabort=_(Ri,p,"TestLoadImage: abort",!1,h,g),g.ontimeout=_(Ri,p,"TestLoadImage: timeout",!1,h,g),a.setTimeout(function(){g.ontimeout&&g.ontimeout()},1e4),g.src=l}else h(!1)}function y1(l,h){let p=new Lo,g=new AbortController,b=setTimeout(()=>{g.abort(),Ri(p,"TestPingServer: timeout",!1,h)},1e4);fetch(l,{signal:g.signal}).then(N=>{clearTimeout(b),N.ok?Ri(p,"TestPingServer: ok",!0,h):Ri(p,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(b),Ri(p,"TestPingServer: error",!1,h)})}function Ri(l,h,p,g,b){try{b&&(b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null),g(p)}catch{}}function v1(){this.g=new t1}function E1(l,h,p){let g=p||"";try{wv(l,function(b,N){let U=b;u(b)&&(U=Nd(b)),h.push(g+N+"="+encodeURIComponent(U))})}catch(b){throw h.push(g+"type="+encodeURIComponent("_badmap")),b}}function jo(l){this.l=l.Ub||null,this.j=l.eb||!1}v(jo,xd),jo.prototype.g=function(){return new ql(this.l,this.j)},jo.prototype.i=function(l){return function(){return l}}({});function ql(l,h){wt.call(this),this.D=l,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}v(ql,wt),i=ql.prototype,i.open=function(l,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=l,this.A=h,this.readyState=1,Wo(this)},i.send=function(l){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};l&&(h.body=l),(this.D||a).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},i.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Go(this)),this.readyState=0},i.Sa=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,Wo(this)),this.g&&(this.readyState=3,Wo(this),this.g)))if(this.responseType==="arraybuffer")l.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in l){if(this.j=l.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Rv(this)}else l.text().then(this.Ra.bind(this),this.ga.bind(this))};function Rv(l){l.j.read().then(l.Pa.bind(l)).catch(l.ga.bind(l))}i.Pa=function(l){if(this.g){if(this.o&&l.value)this.response.push(l.value);else if(!this.o){var h=l.value?l.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!l.done}))&&(this.response=this.responseText+=h)}l.done?Go(this):Wo(this),this.readyState==3&&Rv(this)}},i.Ra=function(l){this.g&&(this.response=this.responseText=l,Go(this))},i.Qa=function(l){this.g&&(this.response=l,Go(this))},i.ga=function(){this.g&&Go(this)};function Go(l){l.readyState=4,l.l=null,l.j=null,l.v=null,Wo(l)}i.setRequestHeader=function(l,h){this.u.append(l,h)},i.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},i.getAllResponseHeaders=function(){if(!this.h)return"";let l=[],h=this.h.entries();for(var p=h.next();!p.done;)p=p.value,l.push(p[0]+": "+p[1]),p=h.next();return l.join(`\r
`)};function Wo(l){l.onreadystatechange&&l.onreadystatechange.call(l)}Object.defineProperty(ql.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(l){this.m=l?"include":"same-origin"}});function Pv(l){let h="";return Z(l,function(p,g){h+=g,h+=":",h+=p,h+=`\r
`}),h}function qd(l,h,p){e:{for(g in p){var g=!1;break e}g=!0}g||(p=Pv(p),typeof l=="string"?p!=null&&encodeURIComponent(String(p)):Ve(l,h,p))}function Qe(l){wt.call(this),this.headers=new Map,this.o=l||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}v(Qe,wt);var w1=/^https?$/i,T1=["POST","PUT"];i=Qe.prototype,i.Ha=function(l){this.J=l},i.ea=function(l,h,p,g){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+l);h=h?h.toUpperCase():"GET",this.D=l,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():kd.g(),this.v=this.o?sv(this.o):sv(kd),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(h,String(l),!0),this.B=!1}catch(N){Nv(this,N);return}if(l=p||"",p=new Map(this.headers),g)if(Object.getPrototypeOf(g)===Object.prototype)for(var b in g)p.set(b,g[b]);else if(typeof g.keys=="function"&&typeof g.get=="function")for(let N of g.keys())p.set(N,g.get(N));else throw Error("Unknown input type for opt_headers: "+String(g));g=Array.from(p.keys()).find(N=>N.toLowerCase()=="content-type"),b=a.FormData&&l instanceof a.FormData,!(0<=Array.prototype.indexOf.call(T1,h,void 0))||g||b||p.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[N,U]of p)this.g.setRequestHeader(N,U);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Ov(this),this.u=!0,this.g.send(l),this.u=!1}catch(N){Nv(this,N)}};function Nv(l,h){l.h=!1,l.g&&(l.j=!0,l.g.abort(),l.j=!1),l.l=h,l.m=5,xv(l),jl(l)}function xv(l){l.A||(l.A=!0,Nt(l,"complete"),Nt(l,"error"))}i.abort=function(l){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=l||7,Nt(this,"complete"),Nt(this,"abort"),jl(this))},i.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),jl(this,!0)),Qe.aa.N.call(this)},i.Ea=function(){this.s||(this.B||this.u||this.j?Dv(this):this.bb())},i.bb=function(){Dv(this)};function Dv(l){if(l.h&&typeof o<"u"&&(!l.v[1]||ri(l)!=4||l.Z()!=2)){if(l.u&&ri(l)==4)ev(l.Ea,0,l);else if(Nt(l,"readystatechange"),ri(l)==4){l.h=!1;try{let U=l.Z();e:switch(U){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var p;if(!(p=h)){var g;if(g=U===0){var b=String(l.D).match(Tv)[1]||null;!b&&a.self&&a.self.location&&(b=a.self.location.protocol.slice(0,-1)),g=!w1.test(b?b.toLowerCase():"")}p=g}if(p)Nt(l,"complete"),Nt(l,"success");else{l.m=6;try{var N=2<ri(l)?l.g.statusText:""}catch{N=""}l.l=N+" ["+l.Z()+"]",xv(l)}}finally{jl(l)}}}}function jl(l,h){if(l.g){Ov(l);let p=l.g,g=l.v[0]?()=>{}:null;l.g=null,l.v=null,h||Nt(l,"ready");try{p.onreadystatechange=g}catch{}}}function Ov(l){l.I&&(a.clearTimeout(l.I),l.I=null)}i.isActive=function(){return!!this.g};function ri(l){return l.g?l.g.readyState:0}i.Z=function(){try{return 2<ri(this)?this.g.status:-1}catch{return-1}},i.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},i.Oa=function(l){if(this.g){var h=this.g.responseText;return l&&h.indexOf(l)==0&&(h=h.substring(l.length)),e1(h)}};function kv(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.H){case"":case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch{return null}}function I1(l){let h={};l=(l.g&&2<=ri(l)&&l.g.getAllResponseHeaders()||"").split(`\r
`);for(let g=0;g<l.length;g++){if(V(l[g]))continue;var p=S(l[g]);let b=p[0];if(p=p[1],typeof p!="string")continue;p=p.trim();let N=h[b]||[];h[b]=N,N.push(p)}T(h,function(g){return g.join(", ")})}i.Ba=function(){return this.m},i.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function zo(l,h,p){return p&&p.internalChannelParams&&p.internalChannelParams[l]||h}function Mv(l){this.Aa=0,this.i=[],this.j=new Lo,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=zo("failFast",!1,l),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=zo("baseRetryDelayMs",5e3,l),this.cb=zo("retryDelaySeedMs",1e4,l),this.Wa=zo("forwardChannelMaxRetries",2,l),this.wa=zo("forwardChannelRequestTimeoutMs",2e4,l),this.pa=l&&l.xmlHttpFactory||void 0,this.Xa=l&&l.Tb||void 0,this.Ca=l&&l.useFetchStreams||!1,this.L=void 0,this.J=l&&l.supportsCrossDomainXhr||!1,this.K="",this.h=new gv(l&&l.concurrentRequestLimit),this.Da=new v1,this.P=l&&l.fastHandshake||!1,this.O=l&&l.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=l&&l.Rb||!1,l&&l.xa&&this.j.xa(),l&&l.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&l&&l.detectBufferingProxy||!1,this.ja=void 0,l&&l.longPollingTimeout&&0<l.longPollingTimeout&&(this.ja=l.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}i=Mv.prototype,i.la=8,i.G=1,i.connect=function(l,h,p,g){xt(0),this.W=l,this.H=h||{},p&&g!==void 0&&(this.H.OSID=p,this.H.OAID=g),this.F=this.X,this.I=Wv(this,null,this.W),Wl(this)};function jd(l){if(Fv(l),l.G==3){var h=l.U++,p=si(l.I);if(Ve(p,"SID",l.K),Ve(p,"RID",h),Ve(p,"TYPE","terminate"),Ko(l,p),h=new bi(l,l.j,h),h.L=2,h.v=Ul(si(p)),p=!1,a.navigator&&a.navigator.sendBeacon)try{p=a.navigator.sendBeacon(h.v.toString(),"")}catch{}!p&&a.Image&&(new Image().src=h.v,p=!0),p||(h.g=zv(h.j,null),h.g.ea(h.v)),h.F=Date.now(),Ll(h)}Gv(l)}function Gl(l){l.g&&(Wd(l),l.g.cancel(),l.g=null)}function Fv(l){Gl(l),l.u&&(a.clearTimeout(l.u),l.u=null),zl(l),l.h.cancel(),l.s&&(typeof l.s=="number"&&a.clearTimeout(l.s),l.s=null)}function Wl(l){if(!_v(l.h)&&!l.s){l.s=!0;var h=l.Ga;Y||Je(),X||(Y(),X=!0),me.add(h,l),l.B=0}}function C1(l,h){return yv(l.h)>=l.h.j-(l.s?1:0)?!1:l.s?(l.i=h.D.concat(l.i),!0):l.G==1||l.G==2||l.B>=(l.Va?0:l.Wa)?!1:(l.s=Fo(m(l.Ga,l,h),jv(l,l.B)),l.B++,!0)}i.Ga=function(l){if(this.s)if(this.s=null,this.G==1){if(!l){this.U=Math.floor(1e5*Math.random()),l=this.U++;let b=new bi(this,this.j,l),N=this.o;if(this.S&&(N?(N=y(N),I(N,this.S)):N=this.S),this.m!==null||this.O||(b.H=N,N=null),this.P)e:{for(var h=0,p=0;p<this.i.length;p++){t:{var g=this.i[p];if("__data__"in g.map&&(g=g.map.__data__,typeof g=="string")){g=g.length;break t}g=void 0}if(g===void 0)break;if(h+=g,4096<h){h=p;break e}if(h===4096||p===this.i.length-1){h=p+1;break e}}h=1e3}else h=1e3;h=Vv(this,b,h),p=si(this.I),Ve(p,"RID",l),Ve(p,"CVER",22),this.D&&Ve(p,"X-HTTP-Session-Id",this.D),Ko(this,p),N&&(this.O?h="headers="+encodeURIComponent(String(Pv(N)))+"&"+h:this.m&&qd(p,this.m,N)),Ud(this.h,b),this.Ua&&Ve(p,"TYPE","init"),this.P?(Ve(p,"$req",h),Ve(p,"SID","null"),b.T=!0,Fd(b,p,null)):Fd(b,p,h),this.G=2}}else this.G==3&&(l?Lv(this,l):this.i.length==0||_v(this.h)||Lv(this))};function Lv(l,h){var p;h?p=h.l:p=l.U++;let g=si(l.I);Ve(g,"SID",l.K),Ve(g,"RID",p),Ve(g,"AID",l.T),Ko(l,g),l.m&&l.o&&qd(g,l.m,l.o),p=new bi(l,l.j,p,l.B+1),l.m===null&&(p.H=l.o),h&&(l.i=h.D.concat(l.i)),h=Vv(l,p,1e3),p.I=Math.round(.5*l.wa)+Math.round(.5*l.wa*Math.random()),Ud(l.h,p),Fd(p,g,h)}function Ko(l,h){l.H&&Z(l.H,function(p,g){Ve(h,g,p)}),l.l&&wv({},function(p,g){Ve(h,g,p)})}function Vv(l,h,p){p=Math.min(l.i.length,p);var g=l.l?m(l.l.Na,l.l,l):null;e:{var b=l.i;let N=-1;for(;;){let U=["count="+p];N==-1?0<p?(N=b[0].g,U.push("ofs="+N)):N=0:U.push("ofs="+N);let xe=!0;for(let _t=0;_t<p;_t++){let Te=b[_t].g,Tt=b[_t].map;if(Te-=N,0>Te)N=Math.max(0,b[_t].g-100),xe=!1;else try{E1(Tt,U,"req"+Te+"_")}catch{g&&g(Tt)}}if(xe){g=U.join("&");break e}}}return l=l.i.splice(0,p),h.D=l,g}function Bv(l){if(!l.g&&!l.u){l.Y=1;var h=l.Fa;Y||Je(),X||(Y(),X=!0),me.add(h,l),l.v=0}}function Gd(l){return l.g||l.u||3<=l.v?!1:(l.Y++,l.u=Fo(m(l.Fa,l),jv(l,l.v)),l.v++,!0)}i.Fa=function(){if(this.u=null,Uv(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var l=2*this.R;this.j.info("BP detection timer enabled: "+l),this.A=Fo(m(this.ab,this),l)}},i.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,xt(10),Gl(this),Uv(this))};function Wd(l){l.A!=null&&(a.clearTimeout(l.A),l.A=null)}function Uv(l){l.g=new bi(l,l.j,"rpc",l.Y),l.m===null&&(l.g.H=l.o),l.g.O=0;var h=si(l.qa);Ve(h,"RID","rpc"),Ve(h,"SID",l.K),Ve(h,"AID",l.T),Ve(h,"CI",l.F?"0":"1"),!l.F&&l.ja&&Ve(h,"TO",l.ja),Ve(h,"TYPE","xmlhttp"),Ko(l,h),l.m&&l.o&&qd(h,l.m,l.o),l.L&&(l.g.I=l.L);var p=l.g;l=l.ia,p.L=1,p.v=Ul(si(h)),p.m=null,p.P=!0,fv(p,l)}i.Za=function(){this.C!=null&&(this.C=null,Gl(this),Gd(this),xt(19))};function zl(l){l.C!=null&&(a.clearTimeout(l.C),l.C=null)}function qv(l,h){var p=null;if(l.g==h){zl(l),Wd(l),l.g=null;var g=2}else if(Bd(l.h,h))p=h.D,vv(l.h,h),g=1;else return;if(l.G!=0){if(h.o)if(g==1){p=h.m?h.m.length:0,h=Date.now()-h.F;var b=l.B;g=kl(),Nt(g,new cv(g,p)),Wl(l)}else Bv(l);else if(b=h.s,b==3||b==0&&0<h.X||!(g==1&&C1(l,h)||g==2&&Gd(l)))switch(p&&0<p.length&&(h=l.h,h.i=h.i.concat(p)),b){case 1:ms(l,5);break;case 4:ms(l,10);break;case 3:ms(l,6);break;default:ms(l,2)}}}function jv(l,h){let p=l.Ta+Math.floor(Math.random()*l.cb);return l.isActive()||(p*=2),p*h}function ms(l,h){if(l.j.info("Error code "+h),h==2){var p=m(l.fb,l),g=l.Xa;let b=!g;g=new ps(g||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Vl(g,"https"),Ul(g),b?_1(g.toString(),p):y1(g.toString(),p)}else xt(2);l.G=0,l.l&&l.l.sa(h),Gv(l),Fv(l)}i.fb=function(l){l?(this.j.info("Successfully pinged google.com"),xt(2)):(this.j.info("Failed to ping google.com"),xt(1))};function Gv(l){if(l.G=0,l.ka=[],l.l){let h=Ev(l.h);(h.length!=0||l.i.length!=0)&&(R(l.ka,h),R(l.ka,l.i),l.h.i.length=0,C(l.i),l.i.length=0),l.l.ra()}}function Wv(l,h,p){var g=p instanceof ps?si(p):new ps(p);if(g.g!="")h&&(g.g=h+"."+g.g),Bl(g,g.s);else{var b=a.location;g=b.protocol,h=h?h+"."+b.hostname:b.hostname,b=+b.port;var N=new ps(null);g&&Vl(N,g),h&&(N.g=h),b&&Bl(N,b),p&&(N.l=p),g=N}return p=l.D,h=l.ya,p&&h&&Ve(g,p,h),Ve(g,"VER",l.la),Ko(l,g),g}function zv(l,h,p){if(h&&!l.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=l.Ca&&!l.pa?new Qe(new jo({eb:p})):new Qe(l.pa),h.Ha(l.J),h}i.isActive=function(){return!!this.l&&this.l.isActive(this)};function Kv(){}i=Kv.prototype,i.ua=function(){},i.ta=function(){},i.sa=function(){},i.ra=function(){},i.isActive=function(){return!0},i.Na=function(){};function Kl(){}Kl.prototype.g=function(l,h){return new Wt(l,h)};function Wt(l,h){wt.call(this),this.g=new Mv(h),this.l=l,this.h=h&&h.messageUrlParams||null,l=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.o=l,l=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(l?l["X-WebChannel-Content-Type"]=h.messageContentType:l={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(l?l["X-WebChannel-Client-Profile"]=h.va:l={"X-WebChannel-Client-Profile":h.va}),this.g.S=l,(l=h&&h.Sb)&&!V(l)&&(this.g.m=l),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!V(h)&&(this.g.D=h,l=this.h,l!==null&&h in l&&(l=this.h,h in l&&delete l[h])),this.j=new dr(this)}v(Wt,wt),Wt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Wt.prototype.close=function(){jd(this.g)},Wt.prototype.o=function(l){var h=this.g;if(typeof l=="string"){var p={};p.__data__=l,l=p}else this.u&&(p={},p.__data__=Nd(l),l=p);h.i.push(new a1(h.Ya++,l)),h.G==3&&Wl(h)},Wt.prototype.N=function(){this.g.l=null,delete this.j,jd(this.g),delete this.g,Wt.aa.N.call(this)};function Hv(l){Dd.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var h=l.__sm__;if(h){e:{for(let p in h){l=p;break e}l=void 0}(this.i=l)&&(l=this.i,h=h!==null&&l in h?h[l]:void 0),this.data=h}else this.data=l}v(Hv,Dd);function Qv(){Od.call(this),this.status=1}v(Qv,Od);function dr(l){this.g=l}v(dr,Kv),dr.prototype.ua=function(){Nt(this.g,"a")},dr.prototype.ta=function(l){Nt(this.g,new Hv(l))},dr.prototype.sa=function(l){Nt(this.g,new Qv)},dr.prototype.ra=function(){Nt(this.g,"b")},Kl.prototype.createWebChannel=Kl.prototype.g,Wt.prototype.send=Wt.prototype.o,Wt.prototype.open=Wt.prototype.m,Wt.prototype.close=Wt.prototype.close,sm=di.createWebChannelTransport=function(){return new Kl},im=di.getStatEventTarget=function(){return kl()},nm=di.Event=ds,bu=di.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ml.NO_ERROR=0,Ml.TIMEOUT=8,Ml.HTTP_ERROR=6,Fa=di.ErrorCode=Ml,uv.COMPLETE="complete",tm=di.EventType=uv,rv.EventType=ko,ko.OPEN="a",ko.CLOSE="b",ko.ERROR="c",ko.MESSAGE="d",wt.prototype.listen=wt.prototype.K,Fr=di.WebChannel=rv,OP=di.FetchXmlHttpFactory=jo,Qe.prototype.listenOnce=Qe.prototype.L,Qe.prototype.getLastError=Qe.prototype.Ka,Qe.prototype.getLastErrorCode=Qe.prototype.Ba,Qe.prototype.getStatus=Qe.prototype.Z,Qe.prototype.getResponseJson=Qe.prototype.Oa,Qe.prototype.getResponseText=Qe.prototype.oa,Qe.prototype.send=Qe.prototype.ea,Qe.prototype.setWithCredentials=Qe.prototype.Ha,em=di.XhrIo=Qe}).apply(typeof Su<"u"?Su:typeof self<"u"?self:typeof window<"u"?window:{});var ET="@firebase/firestore";var ot=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};ot.UNAUTHENTICATED=new ot(null),ot.GOOGLE_CREDENTIALS=new ot("google-credentials-uid"),ot.FIRST_PARTY=new ot("first-party-uid"),ot.MOCK_USER=new ot("mock-user");var po="10.14.0";var Ji=new _r("@firebase/firestore");function qr(){return Ji.logLevel}function II(i){Ji.setLogLevel(i)}function k(i,...e){if(Ji.logLevel<=cn.DEBUG){let t=e.map(c_);Ji.debug(`Firestore (${po}): ${i}`,...t)}}function Xe(i,...e){if(Ji.logLevel<=cn.ERROR){let t=e.map(c_);Ji.error(`Firestore (${po}): ${i}`,...t)}}function bn(i,...e){if(Ji.logLevel<=cn.WARN){let t=e.map(c_);Ji.warn(`Firestore (${po}): ${i}`,...t)}}function c_(i){if(typeof i=="string")return i;try{return function(t){return JSON.stringify(t)}(i)}catch{return i}}function K(i="Unexpected state"){let e=`FIRESTORE (${po}) INTERNAL ASSERTION FAILED: `+i;throw Xe(e),new Error(e)}function Q(i,e){i||K()}function CI(i,e){i||K()}function q(i,e){return i}var x={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},O=class extends x0{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var ht=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Fu=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},um=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ot.UNAUTHENTICATED))}shutdown(){}},hm=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},dm=class{constructor(e){this.t=e,this.currentUser=ot.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Q(this.o===void 0);let n=this.i,s=c=>this.i!==n?(n=this.i,t(c)):Promise.resolve(),r=new ht;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new ht,e.enqueueRetryable(()=>s(this.currentUser))};let o=()=>{let c=r;e.enqueueRetryable(()=>D(this,null,function*(){yield c.promise,yield s(this.currentUser)}))},a=c=>{k("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?a(c):(k("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new ht)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(k("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(Q(typeof n.accessToken=="string"),new Fu(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return Q(e===null||typeof e=="string"),new ot(e)}},fm=class{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=ot.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},pm=class{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new fm(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(ot.FIRST_PARTY))}shutdown(){}invalidateToken(){}},mm=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},gm=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Q(this.o===void 0);let n=r=>{r.error!=null&&k("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${r.error.message}`);let o=r.token!==this.R;return this.R=r.token,k("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(r.token):Promise.resolve()};this.o=r=>{e.enqueueRetryable(()=>n(r))};let s=r=>{k("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=r,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(r=>s(r)),setTimeout(()=>{if(!this.appCheck){let r=this.A.getImmediate({optional:!0});r?s(r):k("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Q(typeof t.token=="string"),this.R=t.token,new mm(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function kP(i){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(i);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<i;n++)t[n]=Math.floor(256*Math.random());return t}var Lu=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";for(;n.length<20;){let s=kP(40);for(let r=0;r<s.length;++r)n.length<20&&s[r]<t&&(n+=e.charAt(s[r]%e.length))}return n}};function ie(i,e){return i<e?-1:i>e?1:0}function Yr(i,e,t){return i.length===e.length&&i.every((n,s)=>t(n,e[s]))}function SI(i){return i+"\0"}var We=class i{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new O(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new O(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new O(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new O(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return i.fromMillis(Date.now())}static fromDate(e){return i.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new i(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ie(this.nanoseconds,e.nanoseconds):ie(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var J=class i{constructor(e){this.timestamp=e}static fromTimestamp(e){return new i(e)}static min(){return new i(new We(0,0))}static max(){return new i(new We(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Vu=class i{constructor(e,t,n){t===void 0?t=0:t>e.length&&K(),n===void 0?n=e.length-t:n>e.length-t&&K(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return i.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof i?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let s=0;s<n;s++){let r=e.get(s),o=t.get(s);if(r<o)return-1;if(r>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},ve=class i extends Vu{construct(e,t,n){return new i(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new O(x.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(s=>s.length>0))}return new i(t)}static emptyPath(){return new i([])}},MP=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Ze=class i extends Vu{construct(e,t,n){return new i(e,t,n)}static isValidIdentifier(e){return MP.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),i.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new i(["__name__"])}static fromServerFormat(e){let t=[],n="",s=0,r=()=>{if(n.length===0)throw new O(x.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},o=!1;for(;s<e.length;){let a=e[s];if(a==="\\"){if(s+1===e.length)throw new O(x.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let c=e[s+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new O(x.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=c,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(n+=a,s++):(r(),s++)}if(r(),o)throw new O(x.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new i(t)}static emptyPath(){return new i([])}};var j=class i{constructor(e){this.path=e}static fromPath(e){return new i(ve.fromString(e))}static fromName(e){return new i(ve.fromString(e).popFirst(5))}static empty(){return new i(ve.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ve.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ve.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new i(new ve(e.slice()))}};var Jr=class{constructor(e,t,n,s){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=s}};function _m(i){return i.fields.find(e=>e.kind===2)}function Os(i){return i.fields.filter(e=>e.kind!==2)}Jr.UNKNOWN_ID=-1;var Hr=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var Qa=class i{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new i(0,pn.min())}};function bI(i,e){let t=i.toTimestamp().seconds,n=i.toTimestamp().nanoseconds+1,s=J.fromTimestamp(n===1e9?new We(t+1,0):new We(t,n));return new pn(s,j.empty(),e)}function AI(i){return new pn(i.readTime,i.key,-1)}var pn=class i{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new i(J.min(),j.empty(),-1)}static max(){return new i(J.max(),j.empty(),-1)}};function u_(i,e){let t=i.readTime.compareTo(e.readTime);return t!==0?t:(t=j.comparator(i.documentKey,e.documentKey),t!==0?t:ie(i.largestBatchId,e.largestBatchId))}var RI="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Bu=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function as(i){return D(this,null,function*(){if(i.code!==x.FAILED_PRECONDITION||i.message!==RI)throw i;k("LocalStore","Unexpectedly lost primary lease")})}var P=class i{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&K(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new i((n,s)=>{this.nextCallback=r=>{this.wrapSuccess(e,r).next(n,s)},this.catchCallback=r=>{this.wrapFailure(t,r).next(n,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof i?t:i.resolve(t)}catch(t){return i.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):i.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):i.reject(t)}static resolve(e){return new i((t,n)=>{t(e)})}static reject(e){return new i((t,n)=>{n(e)})}static waitFor(e){return new i((t,n)=>{let s=0,r=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++r,o&&r===s&&t()},c=>n(c))}),o=!0,r===s&&t()})}static or(e){let t=i.resolve(!1);for(let n of e)t=t.next(s=>s?i.resolve(s):n());return t}static forEach(e,t){let n=[];return e.forEach((s,r)=>{n.push(t.call(this,s,r))}),this.waitFor(n)}static mapArray(e,t){return new i((n,s)=>{let r=e.length,o=new Array(r),a=0;for(let c=0;c<r;c++){let u=c;t(e[u]).next(d=>{o[u]=d,++a,a===r&&n(o)},d=>s(d))}})}static doWhile(e,t){return new i((n,s)=>{let r=()=>{e()===!0?t().next(()=>{r()},s):n()};r()})}};var Uu=class i{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new ht,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Bs(e,t.error)):this.V.resolve()},this.transaction.onerror=n=>{let s=h_(n.target.error);this.V.reject(new Bs(e,s))}}static open(e,t,n,s){try{return new i(t,e.transaction(s,n))}catch(r){throw new Bs(t,r)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(k("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new vm(t)}},Xi=class i{constructor(e,t,n){this.name=e,this.version=t,this.p=n,i.S(ea())===12.2&&Xe("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return k("SimpleDb","Removing database:",e),ks(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!N0())return!1;if(i.v())return!0;let e=ea(),t=i.S(e),n=0<t&&t<10,s=PI(e),r=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||r)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}M(e){return D(this,null,function*(){return this.db||(k("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,n)=>{let s=indexedDB.open(this.name,this.version);s.onsuccess=r=>{let o=r.target.result;t(o)},s.onblocked=()=>{n(new Bs(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=r=>{let o=r.target.error;o.name==="VersionError"?n(new O(x.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?n(new O(x.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):n(new Bs(e,o))},s.onupgradeneeded=r=>{k("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',r.oldVersion);let o=r.target.result;this.p.O(o,s.transaction,r.oldVersion,this.version).next(()=>{k("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db})}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,n,s){return D(this,null,function*(){let r=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.M(e);let a=Uu.open(this.db,e,r?"readonly":"readwrite",n),c=s(a).next(u=>(a.g(),u)).catch(u=>(a.abort(u),P.reject(u))).toPromise();return c.catch(()=>{}),yield a.m,c}catch(a){let c=a,u=c.name!=="FirebaseError"&&o<3;if(k("SimpleDb","Transaction failed with error:",c.message,"Retrying:",u),this.close(),!u)return Promise.reject(c)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function PI(i){let e=i.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var ym=class{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return ks(this.B.delete())}},Bs=class extends O{constructor(e,t){super(x.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function ls(i){return i.name==="IndexedDbTransactionError"}var vm=class{constructor(e){this.store=e}put(e,t){let n;return t!==void 0?(k("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(k("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),ks(n)}add(e){return k("SimpleDb","ADD",this.store.name,e,e),ks(this.store.add(e))}get(e){return ks(this.store.get(e)).next(t=>(t===void 0&&(t=null),k("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return k("SimpleDb","DELETE",this.store.name,e),ks(this.store.delete(e))}count(){return k("SimpleDb","COUNT",this.store.name),ks(this.store.count())}U(e,t){let n=this.options(e,t),s=n.index?this.store.index(n.index):this.store;if(typeof s.getAll=="function"){let r=s.getAll(n.range);return new P((o,a)=>{r.onerror=c=>{a(c.target.error)},r.onsuccess=c=>{o(c.target.result)}})}{let r=this.cursor(n),o=[];return this.W(r,(a,c)=>{o.push(c)}).next(()=>o)}}G(e,t){let n=this.store.getAll(e,t===null?void 0:t);return new P((s,r)=>{n.onerror=o=>{r(o.target.error)},n.onsuccess=o=>{s(o.target.result)}})}j(e,t){k("SimpleDb","DELETE ALL",this.store.name);let n=this.options(e,t);n.H=!1;let s=this.cursor(n);return this.W(s,(r,o,a)=>a.delete())}J(e,t){let n;t?n=e:(n={},t=e);let s=this.cursor(n);return this.W(s,t)}Y(e){let t=this.cursor({});return new P((n,s)=>{t.onerror=r=>{let o=h_(r.target.error);s(o)},t.onsuccess=r=>{let o=r.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():n()}):n()}})}W(e,t){let n=[];return new P((s,r)=>{e.onerror=o=>{r(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a)return void s();let c=new ym(a),u=t(a.primaryKey,a.value,c);if(u instanceof P){let d=u.catch(f=>(c.done(),P.reject(f)));n.push(d)}c.isDone?s():c.K===null?a.continue():a.continue(c.K)}}).next(()=>P.waitFor(n))}options(e,t){let n;return e!==void 0&&(typeof e=="string"?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function ks(i){return new P((e,t)=>{i.onsuccess=n=>{let s=n.target.result;e(s)},i.onerror=n=>{let s=h_(n.target.error);t(s)}})}var wT=!1;function h_(i){let e=Xi.S(ea());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(i.message.indexOf(t)>=0){let n=new O("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return wT||(wT=!0,setTimeout(()=>{throw n},0)),n}}return i}var Em=class{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){k("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>D(this,null,function*(){this.task=null;try{k("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(t){ls(t)?k("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield as(t)}yield this.X(6e4)}))}},wm=class{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){return D(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))})}te(e,t){let n=new Set,s=t,r=!0;return P.doWhile(()=>r===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!n.has(o))return k("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,s).next(a=>{s-=a,n.add(o)});r=!1})).next(()=>t-s)}ne(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,n).next(r=>{let o=r.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(s,r)).next(a=>(k("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let n=e;return t.changes.forEach((s,r)=>{let o=AI(r);u_(o,n)>0&&(n=o)}),new pn(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}};var Yt=(()=>{class i{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=s=>this.ie(s),this.se=s=>n.writeSequenceNumber(s))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return i.oe=-1,i})();function ml(i){return i==null}function $a(i){return i===0&&1/i==-1/0}function NI(i){return typeof i=="number"&&Number.isInteger(i)&&!$a(i)&&i<=Number.MAX_SAFE_INTEGER&&i>=Number.MIN_SAFE_INTEGER}function Vt(i){let e="";for(let t=0;t<i.length;t++)e.length>0&&(e=TT(e)),e=FP(i.get(t),e);return TT(e)}function FP(i,e){let t=e,n=i.length;for(let s=0;s<n;s++){let r=i.charAt(s);switch(r){case"\0":t+="";break;case"":t+="";break;default:t+=r}}return t}function TT(i){return i+""}function Gn(i){let e=i.length;if(Q(e>=2),e===2)return Q(i.charAt(0)===""&&i.charAt(1)===""),ve.emptyPath();let t=e-2,n=[],s="";for(let r=0;r<e;){let o=i.indexOf("",r);switch((o<0||o>t)&&K(),i.charAt(o+1)){case"":let a=i.substring(r,o),c;s.length===0?c=a:(s+=a,c=s,s=""),n.push(c);break;case"":s+=i.substring(r,o),s+="\0";break;case"":s+=i.substring(r,o+1);break;default:K()}r=o+2}return new ve(n)}var IT=["userId","batchId"];function xu(i,e){return[i,Vt(e)]}function xI(i,e,t){return[i,Vt(e),t]}var LP={},VP=["prefixPath","collectionGroup","readTime","documentId"],BP=["prefixPath","collectionGroup","documentId"],UP=["collectionGroup","readTime","prefixPath","documentId"],qP=["canonicalId","targetId"],jP=["targetId","path"],GP=["path","targetId"],WP=["collectionId","parent"],zP=["indexId","uid"],KP=["uid","sequenceNumber"],HP=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],QP=["indexId","uid","orderedDocumentKey"],$P=["userId","collectionPath","documentId"],YP=["userId","collectionPath","largestBatchId"],JP=["userId","collectionGroup","largestBatchId"],DI=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],XP=[...DI,"documentOverlays"],OI=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],kI=OI,d_=[...kI,"indexConfiguration","indexState","indexEntries"],ZP=d_,eN=[...d_,"globals"];var Ya=class extends Bu{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}};function dt(i,e){let t=q(i);return Xi.F(t._e,e)}function CT(i){let e=0;for(let t in i)Object.prototype.hasOwnProperty.call(i,t)&&e++;return e}function Js(i,e){for(let t in i)Object.prototype.hasOwnProperty.call(i,t)&&e(t,i[t])}function MI(i){for(let e in i)if(Object.prototype.hasOwnProperty.call(i,e))return!1;return!0}var Be=class i{constructor(e,t){this.comparator=e,this.root=t||zn.EMPTY}insert(e,t){return new i(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,zn.BLACK,null,null))}remove(e){return new i(this.comparator,this.root.remove(e,this.comparator).copy(null,null,zn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let s=this.comparator(e,n.key);if(s===0)return t+n.left.size;s<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Kr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Kr(this.root,e,this.comparator,!1)}getReverseIterator(){return new Kr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Kr(this.root,e,this.comparator,!0)}},Kr=class{constructor(e,t,n,s){this.isReverse=s,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,t&&s&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(r===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},zn=class i{constructor(e,t,n,s,r){this.key=e,this.value=t,this.color=n??i.RED,this.left=s??i.EMPTY,this.right=r??i.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,s,r){return new i(e??this.key,t??this.value,n??this.color,s??this.left,r??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let s=this,r=n(e,s.key);return s=r<0?s.copy(null,null,null,s.left.insert(e,t,n),null):r===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return i.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return i.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,i.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,i.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw K();let e=this.left.check();if(e!==this.right.check())throw K();return e+(this.isRed()?0:1)}};zn.EMPTY=null,zn.RED=!0,zn.BLACK=!1;zn.EMPTY=new class{constructor(){this.size=0}get key(){throw K()}get value(){throw K()}get color(){throw K()}get left(){throw K()}get right(){throw K()}copy(e,t,n,s,r){return this}insert(e,t,n){return new zn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var Oe=class i{constructor(e){this.comparator=e,this.data=new Be(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let s=n.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new qu(this.data.getIterator())}getIteratorFrom(e){return new qu(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof i)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let s=t.getNext().key,r=n.getNext().key;if(this.comparator(s,r)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new i(this.comparator);return t.data=e,t}},qu=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Lr(i){return i.hasNext()?i.getNext():void 0}var Jt=class i{constructor(e){this.fields=e,e.sort(Ze.comparator)}static empty(){return new i([])}unionWith(e){let t=new Oe(Ze.comparator);for(let n of this.fields)t=t.add(n);for(let n of e)t=t.add(n);return new i(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Yr(this.fields,e.fields,(t,n)=>t.isEqual(n))}};var ju=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function FI(){return typeof atob<"u"}var tt=class i{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(s){try{return atob(s)}catch(r){throw typeof DOMException<"u"&&r instanceof DOMException?new ju("Invalid base64 string: "+r):r}}(e);return new i(t)}static fromUint8Array(e){let t=function(s){let r="";for(let o=0;o<s.length;++o)r+=String.fromCharCode(s[o]);return r}(e);return new i(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let n=new Uint8Array(t.length);for(let s=0;s<t.length;s++)n[s]=t.charCodeAt(s);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ie(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};tt.EMPTY_BYTE_STRING=new tt("");var tN=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function mi(i){if(Q(!!i),typeof i=="string"){let e=0,t=tN.exec(i);if(Q(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}let n=new Date(i);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:je(i.seconds),nanos:je(i.nanos)}}function je(i){return typeof i=="number"?i:typeof i=="string"?Number(i):0}function Zi(i){return typeof i=="string"?tt.fromBase64String(i):tt.fromUint8Array(i)}function Oh(i){var e,t;return((t=(((e=i?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function f_(i){let e=i.mapValue.fields.__previous_value__;return Oh(e)?f_(e):e}function Ja(i){let e=mi(i.mapValue.fields.__local_write_time__.timestampValue);return new We(e.seconds,e.nanos)}var Tm=class{constructor(e,t,n,s,r,o,a,c,u){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=s,this.ssl=r,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=u}},es=class i{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new i("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof i&&e.projectId===this.projectId&&e.database===this.database}};var $i={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Du={nullValue:"NULL_VALUE"};function Us(i){return"nullValue"in i?0:"booleanValue"in i?1:"integerValue"in i||"doubleValue"in i?2:"timestampValue"in i?3:"stringValue"in i?5:"bytesValue"in i?6:"referenceValue"in i?7:"geoPointValue"in i?8:"arrayValue"in i?9:"mapValue"in i?Oh(i)?4:LI(i)?9007199254740991:kh(i)?10:11:K()}function Qn(i,e){if(i===e)return!0;let t=Us(i);if(t!==Us(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return i.booleanValue===e.booleanValue;case 4:return Ja(i).isEqual(Ja(e));case 3:return function(s,r){if(typeof s.timestampValue=="string"&&typeof r.timestampValue=="string"&&s.timestampValue.length===r.timestampValue.length)return s.timestampValue===r.timestampValue;let o=mi(s.timestampValue),a=mi(r.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(i,e);case 5:return i.stringValue===e.stringValue;case 6:return function(s,r){return Zi(s.bytesValue).isEqual(Zi(r.bytesValue))}(i,e);case 7:return i.referenceValue===e.referenceValue;case 8:return function(s,r){return je(s.geoPointValue.latitude)===je(r.geoPointValue.latitude)&&je(s.geoPointValue.longitude)===je(r.geoPointValue.longitude)}(i,e);case 2:return function(s,r){if("integerValue"in s&&"integerValue"in r)return je(s.integerValue)===je(r.integerValue);if("doubleValue"in s&&"doubleValue"in r){let o=je(s.doubleValue),a=je(r.doubleValue);return o===a?$a(o)===$a(a):isNaN(o)&&isNaN(a)}return!1}(i,e);case 9:return Yr(i.arrayValue.values||[],e.arrayValue.values||[],Qn);case 10:case 11:return function(s,r){let o=s.mapValue.fields||{},a=r.mapValue.fields||{};if(CT(o)!==CT(a))return!1;for(let c in o)if(o.hasOwnProperty(c)&&(a[c]===void 0||!Qn(o[c],a[c])))return!1;return!0}(i,e);default:return K()}}function Xa(i,e){return(i.values||[]).find(t=>Qn(t,e))!==void 0}function ts(i,e){if(i===e)return 0;let t=Us(i),n=Us(e);if(t!==n)return ie(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return ie(i.booleanValue,e.booleanValue);case 2:return function(r,o){let a=je(r.integerValue||r.doubleValue),c=je(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1}(i,e);case 3:return ST(i.timestampValue,e.timestampValue);case 4:return ST(Ja(i),Ja(e));case 5:return ie(i.stringValue,e.stringValue);case 6:return function(r,o){let a=Zi(r),c=Zi(o);return a.compareTo(c)}(i.bytesValue,e.bytesValue);case 7:return function(r,o){let a=r.split("/"),c=o.split("/");for(let u=0;u<a.length&&u<c.length;u++){let d=ie(a[u],c[u]);if(d!==0)return d}return ie(a.length,c.length)}(i.referenceValue,e.referenceValue);case 8:return function(r,o){let a=ie(je(r.latitude),je(o.latitude));return a!==0?a:ie(je(r.longitude),je(o.longitude))}(i.geoPointValue,e.geoPointValue);case 9:return bT(i.arrayValue,e.arrayValue);case 10:return function(r,o){var a,c,u,d;let f=r.fields||{},m=o.fields||{},_=(a=f.value)===null||a===void 0?void 0:a.arrayValue,v=(c=m.value)===null||c===void 0?void 0:c.arrayValue,C=ie(((u=_?.values)===null||u===void 0?void 0:u.length)||0,((d=v?.values)===null||d===void 0?void 0:d.length)||0);return C!==0?C:bT(_,v)}(i.mapValue,e.mapValue);case 11:return function(r,o){if(r===$i.mapValue&&o===$i.mapValue)return 0;if(r===$i.mapValue)return 1;if(o===$i.mapValue)return-1;let a=r.fields||{},c=Object.keys(a),u=o.fields||{},d=Object.keys(u);c.sort(),d.sort();for(let f=0;f<c.length&&f<d.length;++f){let m=ie(c[f],d[f]);if(m!==0)return m;let _=ts(a[c[f]],u[d[f]]);if(_!==0)return _}return ie(c.length,d.length)}(i.mapValue,e.mapValue);default:throw K()}}function ST(i,e){if(typeof i=="string"&&typeof e=="string"&&i.length===e.length)return ie(i,e);let t=mi(i),n=mi(e),s=ie(t.seconds,n.seconds);return s!==0?s:ie(t.nanos,n.nanos)}function bT(i,e){let t=i.values||[],n=e.values||[];for(let s=0;s<t.length&&s<n.length;++s){let r=ts(t[s],n[s]);if(r)return r}return ie(t.length,n.length)}function Xr(i){return Im(i)}function Im(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?function(t){let n=mi(t);return`time(${n.seconds},${n.nanos})`}(i.timestampValue):"stringValue"in i?i.stringValue:"bytesValue"in i?function(t){return Zi(t).toBase64()}(i.bytesValue):"referenceValue"in i?function(t){return j.fromName(t).toString()}(i.referenceValue):"geoPointValue"in i?function(t){return`geo(${t.latitude},${t.longitude})`}(i.geoPointValue):"arrayValue"in i?function(t){let n="[",s=!0;for(let r of t.values||[])s?s=!1:n+=",",n+=Im(r);return n+"]"}(i.arrayValue):"mapValue"in i?function(t){let n=Object.keys(t.fields||{}).sort(),s="{",r=!0;for(let o of n)r?r=!1:s+=",",s+=`${o}:${Im(t.fields[o])}`;return s+"}"}(i.mapValue):K()}function qs(i,e){return{referenceValue:`projects/${i.projectId}/databases/${i.database}/documents/${e.path.canonicalString()}`}}function Cm(i){return!!i&&"integerValue"in i}function Za(i){return!!i&&"arrayValue"in i}function AT(i){return!!i&&"nullValue"in i}function RT(i){return!!i&&"doubleValue"in i&&isNaN(Number(i.doubleValue))}function Ou(i){return!!i&&"mapValue"in i}function kh(i){var e,t;return((t=(((e=i?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Ga(i){if(i.geoPointValue)return{geoPointValue:Object.assign({},i.geoPointValue)};if(i.timestampValue&&typeof i.timestampValue=="object")return{timestampValue:Object.assign({},i.timestampValue)};if(i.mapValue){let e={mapValue:{fields:{}}};return Js(i.mapValue.fields,(t,n)=>e.mapValue.fields[t]=Ga(n)),e}if(i.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(i.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ga(i.arrayValue.values[t]);return e}return Object.assign({},i)}function LI(i){return(((i.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var VI={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function nN(i){return"nullValue"in i?Du:"booleanValue"in i?{booleanValue:!1}:"integerValue"in i||"doubleValue"in i?{doubleValue:NaN}:"timestampValue"in i?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in i?{stringValue:""}:"bytesValue"in i?{bytesValue:""}:"referenceValue"in i?qs(es.empty(),j.empty()):"geoPointValue"in i?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in i?{arrayValue:{}}:"mapValue"in i?kh(i)?VI:{mapValue:{}}:K()}function iN(i){return"nullValue"in i?{booleanValue:!1}:"booleanValue"in i?{doubleValue:NaN}:"integerValue"in i||"doubleValue"in i?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in i?{stringValue:""}:"stringValue"in i?{bytesValue:""}:"bytesValue"in i?qs(es.empty(),j.empty()):"referenceValue"in i?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in i?{arrayValue:{}}:"arrayValue"in i?VI:"mapValue"in i?kh(i)?{mapValue:{}}:$i:K()}function PT(i,e){let t=ts(i.value,e.value);return t!==0?t:i.inclusive&&!e.inclusive?-1:!i.inclusive&&e.inclusive?1:0}function NT(i,e){let t=ts(i.value,e.value);return t!==0?t:i.inclusive&&!e.inclusive?1:!i.inclusive&&e.inclusive?-1:0}var Rt=class i{constructor(e){this.value=e}static empty(){return new i({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Ou(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ga(t)}setAll(e){let t=Ze.emptyPath(),n={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let c=this.getFieldsMap(t);this.applyChanges(c,n,s),n={},s=[],t=a.popLast()}o?n[a.lastSegment()]=Ga(o):s.push(a.lastSegment())});let r=this.getFieldsMap(t);this.applyChanges(r,n,s)}delete(e){let t=this.field(e.popLast());Ou(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Qn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let s=t.mapValue.fields[e.get(n)];Ou(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,n){Js(t,(s,r)=>e[s]=r);for(let s of n)delete e[s]}clone(){return new i(Ga(this.value))}};function BI(i){let e=[];return Js(i.fields,(t,n)=>{let s=new Ze([t]);if(Ou(n)){let r=BI(n.mapValue).fields;if(r.length===0)e.push(s);else for(let o of r)e.push(s.child(o))}else e.push(s)}),new Jt(e)}var at=class i{constructor(e,t,n,s,r,o,a){this.key=e,this.documentType=t,this.version=n,this.readTime=s,this.createTime=r,this.data=o,this.documentState=a}static newInvalidDocument(e){return new i(e,0,J.min(),J.min(),J.min(),Rt.empty(),0)}static newFoundDocument(e,t,n,s){return new i(e,1,t,J.min(),n,s,0)}static newNoDocument(e,t){return new i(e,2,t,J.min(),J.min(),Rt.empty(),0)}static newUnknownDocument(e,t){return new i(e,3,t,J.min(),J.min(),Rt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(J.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Rt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Rt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=J.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof i&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new i(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var $n=class{constructor(e,t){this.position=e,this.inclusive=t}};function xT(i,e,t){let n=0;for(let s=0;s<i.position.length;s++){let r=e[s],o=i.position[s];if(r.field.isKeyField()?n=j.comparator(j.fromName(o.referenceValue),t.key):n=ts(o,t.data.field(r.field)),r.dir==="desc"&&(n*=-1),n!==0)break}return n}function DT(i,e){if(i===null)return e===null;if(e===null||i.inclusive!==e.inclusive||i.position.length!==e.position.length)return!1;for(let t=0;t<i.position.length;t++)if(!Qn(i.position[t],e.position[t]))return!1;return!0}var js=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function sN(i,e){return i.dir===e.dir&&i.field.isEqual(e.field)}var Gu=class{},_e=class i extends Gu{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new Am(e,t,n):t==="array-contains"?new Nm(e,n):t==="in"?new Wu(e,n):t==="not-in"?new xm(e,n):t==="array-contains-any"?new Dm(e,n):new i(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new Rm(e,n):new Pm(e,n)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(ts(t,this.value)):t!==null&&Us(this.value)===Us(t)&&this.matchesComparison(ts(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return K()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Re=class i extends Gu{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new i(e,t)}matches(e){return Zr(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function Zr(i){return i.op==="and"}function Sm(i){return i.op==="or"}function p_(i){return UI(i)&&Zr(i)}function UI(i){for(let e of i.filters)if(e instanceof Re)return!1;return!0}function bm(i){if(i instanceof _e)return i.field.canonicalString()+i.op.toString()+Xr(i.value);if(p_(i))return i.filters.map(e=>bm(e)).join(",");{let e=i.filters.map(t=>bm(t)).join(",");return`${i.op}(${e})`}}function qI(i,e){return i instanceof _e?function(n,s){return s instanceof _e&&n.op===s.op&&n.field.isEqual(s.field)&&Qn(n.value,s.value)}(i,e):i instanceof Re?function(n,s){return s instanceof Re&&n.op===s.op&&n.filters.length===s.filters.length?n.filters.reduce((r,o,a)=>r&&qI(o,s.filters[a]),!0):!1}(i,e):void K()}function jI(i,e){let t=i.filters.concat(e);return Re.create(t,i.op)}function GI(i){return i instanceof _e?function(t){return`${t.field.canonicalString()} ${t.op} ${Xr(t.value)}`}(i):i instanceof Re?function(t){return t.op.toString()+" {"+t.getFilters().map(GI).join(" ,")+"}"}(i):"Filter"}var Am=class extends _e{constructor(e,t,n){super(e,t,n),this.key=j.fromName(n.referenceValue)}matches(e){let t=j.comparator(e.key,this.key);return this.matchesComparison(t)}},Rm=class extends _e{constructor(e,t){super(e,"in",t),this.keys=WI("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Pm=class extends _e{constructor(e,t){super(e,"not-in",t),this.keys=WI("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function WI(i,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(n=>j.fromName(n.referenceValue))}var Nm=class extends _e{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Za(t)&&Xa(t.arrayValue,this.value)}},Wu=class extends _e{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Xa(this.value.arrayValue,t)}},xm=class extends _e{constructor(e,t){super(e,"not-in",t)}matches(e){if(Xa(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!Xa(this.value.arrayValue,t)}},Dm=class extends _e{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Za(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>Xa(this.value.arrayValue,n))}};var Om=class{constructor(e,t=null,n=[],s=[],r=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=s,this.limit=r,this.startAt=o,this.endAt=a,this.ue=null}};function km(i,e=null,t=[],n=[],s=null,r=null,o=null){return new Om(i,e,t,n,s,r,o)}function Gs(i){let e=q(i);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>bm(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>function(r){return r.field.canonicalString()+r.dir}(n)).join(","),ml(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>Xr(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>Xr(n)).join(",")),e.ue=t}return e.ue}function gl(i,e){if(i.limit!==e.limit||i.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<i.orderBy.length;t++)if(!sN(i.orderBy[t],e.orderBy[t]))return!1;if(i.filters.length!==e.filters.length)return!1;for(let t=0;t<i.filters.length;t++)if(!qI(i.filters[t],e.filters[t]))return!1;return i.collectionGroup===e.collectionGroup&&!!i.path.isEqual(e.path)&&!!DT(i.startAt,e.startAt)&&DT(i.endAt,e.endAt)}function zu(i){return j.isDocumentKey(i.path)&&i.collectionGroup===null&&i.filters.length===0}function Ku(i,e){return i.filters.filter(t=>t instanceof _e&&t.field.isEqual(e))}function OT(i,e,t){let n=Du,s=!0;for(let r of Ku(i,e)){let o=Du,a=!0;switch(r.op){case"<":case"<=":o=nN(r.value);break;case"==":case"in":case">=":o=r.value;break;case">":o=r.value,a=!1;break;case"!=":case"not-in":o=Du}PT({value:n,inclusive:s},{value:o,inclusive:a})<0&&(n=o,s=a)}if(t!==null){for(let r=0;r<i.orderBy.length;++r)if(i.orderBy[r].field.isEqual(e)){let o=t.position[r];PT({value:n,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(n=o,s=t.inclusive);break}}return{value:n,inclusive:s}}function kT(i,e,t){let n=$i,s=!0;for(let r of Ku(i,e)){let o=$i,a=!0;switch(r.op){case">=":case">":o=iN(r.value),a=!1;break;case"==":case"in":case"<=":o=r.value;break;case"<":o=r.value,a=!1;break;case"!=":case"not-in":o=$i}NT({value:n,inclusive:s},{value:o,inclusive:a})>0&&(n=o,s=a)}if(t!==null){for(let r=0;r<i.orderBy.length;++r)if(i.orderBy[r].field.isEqual(e)){let o=t.position[r];NT({value:n,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(n=o,s=t.inclusive);break}}return{value:n,inclusive:s}}var An=class{constructor(e,t=null,n=[],s=[],r=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=s,this.limit=r,this.limitType=o,this.startAt=a,this.endAt=c,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function zI(i,e,t,n,s,r,o,a){return new An(i,e,t,n,s,r,o,a)}function mo(i){return new An(i)}function MT(i){return i.filters.length===0&&i.limit===null&&i.startAt==null&&i.endAt==null&&(i.explicitOrderBy.length===0||i.explicitOrderBy.length===1&&i.explicitOrderBy[0].field.isKeyField())}function m_(i){return i.collectionGroup!==null}function Qr(i){let e=q(i);if(e.ce===null){e.ce=[];let t=new Set;for(let r of e.explicitOrderBy)e.ce.push(r),t.add(r.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Oe(Ze.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(r=>{t.has(r.canonicalString())||r.isKeyField()||e.ce.push(new js(r,n))}),t.has(Ze.keyField().canonicalString())||e.ce.push(new js(Ze.keyField(),n))}return e.ce}function Bt(i){let e=q(i);return e.le||(e.le=rN(e,Qr(i))),e.le}function rN(i,e){if(i.limitType==="F")return km(i.path,i.collectionGroup,e,i.filters,i.limit,i.startAt,i.endAt);{e=e.map(s=>{let r=s.dir==="desc"?"asc":"desc";return new js(s.field,r)});let t=i.endAt?new $n(i.endAt.position,i.endAt.inclusive):null,n=i.startAt?new $n(i.startAt.position,i.startAt.inclusive):null;return km(i.path,i.collectionGroup,e,i.filters,i.limit,t,n)}}function Mm(i,e){let t=i.filters.concat([e]);return new An(i.path,i.collectionGroup,i.explicitOrderBy.slice(),t,i.limit,i.limitType,i.startAt,i.endAt)}function Hu(i,e,t){return new An(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),e,t,i.startAt,i.endAt)}function _l(i,e){return gl(Bt(i),Bt(e))&&i.limitType===e.limitType}function KI(i){return`${Gs(Bt(i))}|lt:${i.limitType}`}function jr(i){return`Query(target=${function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(s=>GI(s)).join(", ")}]`),ml(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(s=>Xr(s)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(s=>Xr(s)).join(",")),`Target(${n})`}(Bt(i))}; limitType=${i.limitType})`}function yl(i,e){return e.isFoundDocument()&&function(n,s){let r=s.key.path;return n.collectionGroup!==null?s.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(r):j.isDocumentKey(n.path)?n.path.isEqual(r):n.path.isImmediateParentOf(r)}(i,e)&&function(n,s){for(let r of Qr(n))if(!r.field.isKeyField()&&s.data.field(r.field)===null)return!1;return!0}(i,e)&&function(n,s){for(let r of n.filters)if(!r.matches(s))return!1;return!0}(i,e)&&function(n,s){return!(n.startAt&&!function(o,a,c){let u=xT(o,a,c);return o.inclusive?u<=0:u<0}(n.startAt,Qr(n),s)||n.endAt&&!function(o,a,c){let u=xT(o,a,c);return o.inclusive?u>=0:u>0}(n.endAt,Qr(n),s))}(i,e)}function HI(i){return i.collectionGroup||(i.path.length%2==1?i.path.lastSegment():i.path.get(i.path.length-2))}function QI(i){return(e,t)=>{let n=!1;for(let s of Qr(i)){let r=oN(s,e,t);if(r!==0)return r;n=n||s.field.isKeyField()}return 0}}function oN(i,e,t){let n=i.field.isKeyField()?j.comparator(e.key,t.key):function(r,o,a){let c=o.data.field(r),u=a.data.field(r);return c!==null&&u!==null?ts(c,u):K()}(i.field,e,t);switch(i.dir){case"asc":return n;case"desc":return-1*n;default:return K()}}var Yn=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(let[s,r]of n)if(this.equalsFn(s,e))return r}}has(e){return this.get(e)!==void 0}set(e,t){let n=this.mapKeyFn(e),s=this.inner[n];if(s===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return void(s[r]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],e))return n.length===1?delete this.inner[t]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Js(this.inner,(t,n)=>{for(let[s,r]of n)e(s,r)})}isEmpty(){return MI(this.inner)}size(){return this.innerSize}};var aN=new Be(j.comparator);function Gt(){return aN}var $I=new Be(j.comparator);function qa(...i){let e=$I;for(let t of i)e=e.insert(t.key,t);return e}function YI(i){let e=$I;return i.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function Wn(){return Wa()}function JI(){return Wa()}function Wa(){return new Yn(i=>i.toString(),(i,e)=>i.isEqual(e))}var lN=new Be(j.comparator),cN=new Oe(j.comparator);function ce(...i){let e=cN;for(let t of i)e=e.add(t);return e}var uN=new Oe(ie);function g_(){return uN}function __(i,e){if(i.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:$a(e)?"-0":e}}function XI(i){return{integerValue:""+i}}function ZI(i,e){return NI(e)?XI(e):__(i,e)}var eo=class{constructor(){this._=void 0}};function hN(i,e,t){return i instanceof ns?function(s,r){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return r&&Oh(r)&&(r=f_(r)),r&&(o.fields.__previous_value__=r),{mapValue:o}}(t,e):i instanceof gi?tC(i,e):i instanceof _i?nC(i,e):function(s,r){let o=eC(s,r),a=FT(o)+FT(s.Pe);return Cm(o)&&Cm(s.Pe)?XI(a):__(s.serializer,a)}(i,e)}function dN(i,e,t){return i instanceof gi?tC(i,e):i instanceof _i?nC(i,e):t}function eC(i,e){return i instanceof is?function(n){return Cm(n)||function(r){return!!r&&"doubleValue"in r}(n)}(e)?e:{integerValue:0}:null}var ns=class extends eo{},gi=class extends eo{constructor(e){super(),this.elements=e}};function tC(i,e){let t=iC(e);for(let n of i.elements)t.some(s=>Qn(s,n))||t.push(n);return{arrayValue:{values:t}}}var _i=class extends eo{constructor(e){super(),this.elements=e}};function nC(i,e){let t=iC(e);for(let n of i.elements)t=t.filter(s=>!Qn(s,n));return{arrayValue:{values:t}}}var is=class extends eo{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function FT(i){return je(i.integerValue||i.doubleValue)}function iC(i){return Za(i)&&i.arrayValue.values?i.arrayValue.values.slice():[]}var Ws=class{constructor(e,t){this.field=e,this.transform=t}};function fN(i,e){return i.field.isEqual(e.field)&&function(n,s){return n instanceof gi&&s instanceof gi||n instanceof _i&&s instanceof _i?Yr(n.elements,s.elements,Qn):n instanceof is&&s instanceof is?Qn(n.Pe,s.Pe):n instanceof ns&&s instanceof ns}(i.transform,e.transform)}var Fm=class{constructor(e,t){this.version=e,this.transformResults=t}},Ye=class i{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new i}static exists(e){return new i(void 0,e)}static updateTime(e){return new i(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function ku(i,e){return i.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(i.updateTime):i.exists===void 0||i.exists===e.isFoundDocument()}var to=class{};function sC(i,e){if(!i.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return i.isNoDocument()?new rs(i.key,Ye.none()):new ss(i.key,i.data,Ye.none());{let t=i.data,n=Rt.empty(),s=new Oe(Ze.comparator);for(let r of e.fields)if(!s.has(r)){let o=t.field(r);o===null&&r.length>1&&(r=r.popLast(),o=t.field(r)),o===null?n.delete(r):n.set(r,o),s=s.add(r)}return new Rn(i.key,n,new Jt(s.toArray()),Ye.none())}}function pN(i,e,t){i instanceof ss?function(s,r,o){let a=s.value.clone(),c=VT(s.fieldTransforms,r,o.transformResults);a.setAll(c),r.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(i,e,t):i instanceof Rn?function(s,r,o){if(!ku(s.precondition,r))return void r.convertToUnknownDocument(o.version);let a=VT(s.fieldTransforms,r,o.transformResults),c=r.data;c.setAll(rC(s)),c.setAll(a),r.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(i,e,t):function(s,r,o){r.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function za(i,e,t,n){return i instanceof ss?function(r,o,a,c){if(!ku(r.precondition,o))return a;let u=r.value.clone(),d=BT(r.fieldTransforms,c,o);return u.setAll(d),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(i,e,t,n):i instanceof Rn?function(r,o,a,c){if(!ku(r.precondition,o))return a;let u=BT(r.fieldTransforms,c,o),d=o.data;return d.setAll(rC(r)),d.setAll(u),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(r.fieldMask.fields).unionWith(r.fieldTransforms.map(f=>f.field))}(i,e,t,n):function(r,o,a){return ku(r.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(i,e,t)}function mN(i,e){let t=null;for(let n of i.fieldTransforms){let s=e.data.field(n.field),r=eC(n.transform,s||null);r!=null&&(t===null&&(t=Rt.empty()),t.set(n.field,r))}return t||null}function LT(i,e){return i.type===e.type&&!!i.key.isEqual(e.key)&&!!i.precondition.isEqual(e.precondition)&&!!function(n,s){return n===void 0&&s===void 0||!(!n||!s)&&Yr(n,s,(r,o)=>fN(r,o))}(i.fieldTransforms,e.fieldTransforms)&&(i.type===0?i.value.isEqual(e.value):i.type!==1||i.data.isEqual(e.data)&&i.fieldMask.isEqual(e.fieldMask))}var ss=class extends to{constructor(e,t,n,s=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}},Rn=class extends to{constructor(e,t,n,s,r=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=s,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}};function rC(i){let e=new Map;return i.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let n=i.data.field(t);e.set(t,n)}}),e}function VT(i,e,t){let n=new Map;Q(i.length===t.length);for(let s=0;s<t.length;s++){let r=i[s],o=r.transform,a=e.data.field(r.field);n.set(r.field,dN(o,a,t[s]))}return n}function BT(i,e,t){let n=new Map;for(let s of i){let r=s.transform,o=t.data.field(s.field);n.set(s.field,hN(r,o,e))}return n}var rs=class extends to{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},el=class extends to{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var tl=class{constructor(e,t,n,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let s=0;s<this.mutations.length;s++){let r=this.mutations[s];r.key.isEqual(e.key)&&pN(r,e,n[s])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=za(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=za(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=JI();return this.mutations.forEach(s=>{let r=e.get(s.key),o=r.overlayedDocument,a=this.applyToLocalView(o,r.mutatedFields);a=t.has(s.key)?null:a;let c=sC(o,a);c!==null&&n.set(s.key,c),o.isValidDocument()||o.convertToNoDocument(J.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ce())}isEqual(e){return this.batchId===e.batchId&&Yr(this.mutations,e.mutations,(t,n)=>LT(t,n))&&Yr(this.baseMutations,e.baseMutations,(t,n)=>LT(t,n))}},Lm=class i{constructor(e,t,n,s){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=s}static from(e,t,n){Q(e.mutations.length===n.length);let s=function(){return lN}(),r=e.mutations;for(let o=0;o<r.length;o++)s=s.insert(r[o].key,n[o].version);return new i(e,t,n,s)}};var nl=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Vm=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var st,ye;function oC(i){switch(i){default:return K();case x.CANCELLED:case x.UNKNOWN:case x.DEADLINE_EXCEEDED:case x.RESOURCE_EXHAUSTED:case x.INTERNAL:case x.UNAVAILABLE:case x.UNAUTHENTICATED:return!1;case x.INVALID_ARGUMENT:case x.NOT_FOUND:case x.ALREADY_EXISTS:case x.PERMISSION_DENIED:case x.FAILED_PRECONDITION:case x.ABORTED:case x.OUT_OF_RANGE:case x.UNIMPLEMENTED:case x.DATA_LOSS:return!0}}function aC(i){if(i===void 0)return Xe("GRPC error has no .code"),x.UNKNOWN;switch(i){case st.OK:return x.OK;case st.CANCELLED:return x.CANCELLED;case st.UNKNOWN:return x.UNKNOWN;case st.DEADLINE_EXCEEDED:return x.DEADLINE_EXCEEDED;case st.RESOURCE_EXHAUSTED:return x.RESOURCE_EXHAUSTED;case st.INTERNAL:return x.INTERNAL;case st.UNAVAILABLE:return x.UNAVAILABLE;case st.UNAUTHENTICATED:return x.UNAUTHENTICATED;case st.INVALID_ARGUMENT:return x.INVALID_ARGUMENT;case st.NOT_FOUND:return x.NOT_FOUND;case st.ALREADY_EXISTS:return x.ALREADY_EXISTS;case st.PERMISSION_DENIED:return x.PERMISSION_DENIED;case st.FAILED_PRECONDITION:return x.FAILED_PRECONDITION;case st.ABORTED:return x.ABORTED;case st.OUT_OF_RANGE:return x.OUT_OF_RANGE;case st.UNIMPLEMENTED:return x.UNIMPLEMENTED;case st.DATA_LOSS:return x.DATA_LOSS;default:return K()}}(ye=st||(st={}))[ye.OK=0]="OK",ye[ye.CANCELLED=1]="CANCELLED",ye[ye.UNKNOWN=2]="UNKNOWN",ye[ye.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ye[ye.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ye[ye.NOT_FOUND=5]="NOT_FOUND",ye[ye.ALREADY_EXISTS=6]="ALREADY_EXISTS",ye[ye.PERMISSION_DENIED=7]="PERMISSION_DENIED",ye[ye.UNAUTHENTICATED=16]="UNAUTHENTICATED",ye[ye.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ye[ye.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ye[ye.ABORTED=10]="ABORTED",ye[ye.OUT_OF_RANGE=11]="OUT_OF_RANGE",ye[ye.UNIMPLEMENTED=12]="UNIMPLEMENTED",ye[ye.INTERNAL=13]="INTERNAL",ye[ye.UNAVAILABLE=14]="UNAVAILABLE",ye[ye.DATA_LOSS=15]="DATA_LOSS";var UT=null;function lC(){return new TextEncoder}var gN=new Wi([4294967295,4294967295],0);function qT(i){let e=lC().encode(i),t=new Zp;return t.update(e),new Uint8Array(t.digest())}function jT(i){let e=new DataView(i.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),s=e.getUint32(8,!0),r=e.getUint32(12,!0);return[new Wi([t,n],0),new Wi([s,r],0)]}var Bm=class i{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Vs(`Invalid padding: ${t}`);if(n<0)throw new Vs(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new Vs(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new Vs(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Wi.fromNumber(this.Ie)}Ee(e,t,n){let s=e.add(t.multiply(Wi.fromNumber(n)));return s.compare(gN)===1&&(s=new Wi([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=qT(e),[n,s]=jT(t);for(let r=0;r<this.hashCount;r++){let o=this.Ee(n,s,r);if(!this.de(o))return!1}return!0}static create(e,t,n){let s=e%8==0?0:8-e%8,r=new Uint8Array(Math.ceil(e/8)),o=new i(r,s,t);return n.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;let t=qT(e),[n,s]=jT(t);for(let r=0;r<this.hashCount;r++){let o=this.Ee(n,s,r);this.Ae(o)}}Ae(e){let t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}},Vs=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var il=class i{constructor(e,t,n,s,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let s=new Map;return s.set(e,sl.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new i(J.min(),s,new Be(ie),Gt(),ce())}},sl=class i{constructor(e,t,n,s,r){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new i(n,t,ce(),ce(),ce())}};var $r=class{constructor(e,t,n,s){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=s}},Qu=class{constructor(e,t){this.targetId=e,this.me=t}},$u=class{constructor(e,t,n=tt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=s}},Yu=class{constructor(){this.fe=0,this.ge=WT(),this.pe=tt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=ce(),t=ce(),n=ce();return this.ge.forEach((s,r)=>{switch(r){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:n=n.add(s);break;default:K()}}),new sl(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=WT()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Q(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},Um=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=Gt(),this.qe=GT(),this.Qe=new Be(ie)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:K()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,s)=>{this.ze(s)&&t(s)})}He(e){let t=e.targetId,n=e.me.count,s=this.Je(t);if(s){let r=s.target;if(zu(r))if(n===0){let o=new j(r.path);this.Ue(t,o,at.newNoDocument(o,J.min()))}else Q(n===1);else{let o=this.Ye(t);if(o!==n){let a=this.Ze(e),c=a?this.Xe(a,e,o):1;if(c!==0){this.je(t);let u=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,u)}UT?.et(function(d,f,m,_,v){var C,R,F,V,B,$;let le={localCacheCount:d,existenceFilterCount:f.count,databaseId:m.database,projectId:m.projectId},Z=f.unchangedNames;return Z&&(le.bloomFilter={applied:v===0,hashCount:(C=Z?.hashCount)!==null&&C!==void 0?C:0,bitmapLength:(V=(F=(R=Z?.bits)===null||R===void 0?void 0:R.bitmap)===null||F===void 0?void 0:F.length)!==null&&V!==void 0?V:0,padding:($=(B=Z?.bits)===null||B===void 0?void 0:B.padding)!==null&&$!==void 0?$:0,mightContain:T=>{var y;return(y=_?.mightContain(T))!==null&&y!==void 0&&y}}),le}(o,e.me,this.Le.tt(),a,c))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:n="",padding:s=0},hashCount:r=0}=t,o,a;try{o=Zi(n).toUint8Array()}catch(c){if(c instanceof ju)return bn("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{a=new Bm(o,s,r)}catch(c){return bn(c instanceof Vs?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return a.Ie===0?null:a}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){let n=this.Le.getRemoteKeysForTarget(t),s=0;return n.forEach(r=>{let o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${r.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,r,null),s++)}),s}rt(e){let t=new Map;this.Be.forEach((r,o)=>{let a=this.Je(o);if(a){if(r.current&&zu(a.target)){let c=new j(a.target.path);this.ke.get(c)!==null||this.it(o,c)||this.Ue(o,c,at.newNoDocument(c,e))}r.be&&(t.set(o,r.ve()),r.Ce())}});let n=ce();this.qe.forEach((r,o)=>{let a=!0;o.forEachWhile(c=>{let u=this.Je(c);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(n=n.add(r))}),this.ke.forEach((r,o)=>o.setReadTime(e));let s=new il(e,t,this.Qe,this.ke,n);return this.ke=Gt(),this.qe=GT(),this.Qe=new Be(ie),s}$e(e,t){if(!this.ze(e))return;let n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;let s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Yu,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Oe(ie),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||k("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Yu),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function GT(){return new Be(j.comparator)}function WT(){return new Be(j.comparator)}var _N={asc:"ASCENDING",desc:"DESCENDING"},yN={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},vN={and:"AND",or:"OR"},qm=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function jm(i,e){return i.useProto3Json||ml(e)?e:{value:e}}function no(i,e){return i.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function cC(i,e){return i.useProto3Json?e.toBase64():e.toUint8Array()}function EN(i,e){return no(i,e.toTimestamp())}function et(i){return Q(!!i),J.fromTimestamp(function(t){let n=mi(t);return new We(n.seconds,n.nanos)}(i))}function y_(i,e){return Gm(i,e).canonicalString()}function Gm(i,e){let t=function(s){return new ve(["projects",s.projectId,"databases",s.database])}(i).child("documents");return e===void 0?t:t.child(e)}function uC(i){let e=ve.fromString(i);return Q(EC(e)),e}function rl(i,e){return y_(i.databaseId,e.path)}function Kn(i,e){let t=uC(e);if(t.get(1)!==i.databaseId.projectId)throw new O(x.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+i.databaseId.projectId);if(t.get(3)!==i.databaseId.database)throw new O(x.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+i.databaseId.database);return new j(fC(t))}function hC(i,e){return y_(i.databaseId,e)}function dC(i){let e=uC(i);return e.length===4?ve.emptyPath():fC(e)}function Wm(i){return new ve(["projects",i.databaseId.projectId,"databases",i.databaseId.database]).canonicalString()}function fC(i){return Q(i.length>4&&i.get(4)==="documents"),i.popFirst(5)}function zT(i,e,t){return{name:rl(i,e),fields:t.value.mapValue.fields}}function pC(i,e,t){let n=Kn(i,e.name),s=et(e.updateTime),r=e.createTime?et(e.createTime):J.min(),o=new Rt({mapValue:{fields:e.fields}}),a=at.newFoundDocument(n,s,r,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function wN(i,e){return"found"in e?function(n,s){Q(!!s.found),s.found.name,s.found.updateTime;let r=Kn(n,s.found.name),o=et(s.found.updateTime),a=s.found.createTime?et(s.found.createTime):J.min(),c=new Rt({mapValue:{fields:s.found.fields}});return at.newFoundDocument(r,o,a,c)}(i,e):"missing"in e?function(n,s){Q(!!s.missing),Q(!!s.readTime);let r=Kn(n,s.missing),o=et(s.readTime);return at.newNoDocument(r,o)}(i,e):K()}function TN(i,e){let t;if("targetChange"in e){e.targetChange;let n=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:K()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],r=function(u,d){return u.useProto3Json?(Q(d===void 0||typeof d=="string"),tt.fromBase64String(d||"")):(Q(d===void 0||d instanceof Buffer||d instanceof Uint8Array),tt.fromUint8Array(d||new Uint8Array))}(i,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){let d=u.code===void 0?x.UNKNOWN:aC(u.code);return new O(d,u.message||"")}(o);t=new $u(n,s,r,a||null)}else if("documentChange"in e){e.documentChange;let n=e.documentChange;n.document,n.document.name,n.document.updateTime;let s=Kn(i,n.document.name),r=et(n.document.updateTime),o=n.document.createTime?et(n.document.createTime):J.min(),a=new Rt({mapValue:{fields:n.document.fields}}),c=at.newFoundDocument(s,r,o,a),u=n.targetIds||[],d=n.removedTargetIds||[];t=new $r(u,d,c.key,c)}else if("documentDelete"in e){e.documentDelete;let n=e.documentDelete;n.document;let s=Kn(i,n.document),r=n.readTime?et(n.readTime):J.min(),o=at.newNoDocument(s,r),a=n.removedTargetIds||[];t=new $r([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let n=e.documentRemove;n.document;let s=Kn(i,n.document),r=n.removedTargetIds||[];t=new $r([],r,s,null)}else{if(!("filter"in e))return K();{e.filter;let n=e.filter;n.targetId;let{count:s=0,unchangedNames:r}=n,o=new Vm(s,r),a=n.targetId;t=new Qu(a,o)}}return t}function ol(i,e){let t;if(e instanceof ss)t={update:zT(i,e.key,e.value)};else if(e instanceof rs)t={delete:rl(i,e.key)};else if(e instanceof Rn)t={update:zT(i,e.key,e.data),updateMask:RN(e.fieldMask)};else{if(!(e instanceof el))return K();t={verify:rl(i,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(r,o){let a=o.transform;if(a instanceof ns)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof gi)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof _i)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof is)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw K()}(0,n))),e.precondition.isNone||(t.currentDocument=function(s,r){return r.updateTime!==void 0?{updateTime:EN(s,r.updateTime)}:r.exists!==void 0?{exists:r.exists}:K()}(i,e.precondition)),t}function zm(i,e){let t=e.currentDocument?function(r){return r.updateTime!==void 0?Ye.updateTime(et(r.updateTime)):r.exists!==void 0?Ye.exists(r.exists):Ye.none()}(e.currentDocument):Ye.none(),n=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let c=null;if("setToServerValue"in a)Q(a.setToServerValue==="REQUEST_TIME"),c=new ns;else if("appendMissingElements"in a){let d=a.appendMissingElements.values||[];c=new gi(d)}else if("removeAllFromArray"in a){let d=a.removeAllFromArray.values||[];c=new _i(d)}else"increment"in a?c=new is(o,a.increment):K();let u=Ze.fromServerFormat(a.fieldPath);return new Ws(u,c)}(i,s)):[];if(e.update){e.update.name;let s=Kn(i,e.update.name),r=new Rt({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(c){let u=c.fieldPaths||[];return new Jt(u.map(d=>Ze.fromServerFormat(d)))}(e.updateMask);return new Rn(s,r,o,t,n)}return new ss(s,r,t,n)}if(e.delete){let s=Kn(i,e.delete);return new rs(s,t)}if(e.verify){let s=Kn(i,e.verify);return new el(s,t)}return K()}function IN(i,e){return i&&i.length>0?(Q(e!==void 0),i.map(t=>function(s,r){let o=s.updateTime?et(s.updateTime):et(r);return o.isEqual(J.min())&&(o=et(r)),new Fm(o,s.transformResults||[])}(t,e))):[]}function mC(i,e){return{documents:[hC(i,e.path)]}}function gC(i,e){let t={structuredQuery:{}},n=e.path,s;e.collectionGroup!==null?(s=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=hC(i,s);let r=function(u){if(u.length!==0)return vC(Re.create(u,"and"))}(e.filters);r&&(t.structuredQuery.where=r);let o=function(u){if(u.length!==0)return u.map(d=>function(m){return{field:Gr(m.field),direction:SN(m.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=jm(i,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{_t:t,parent:s}}function _C(i){let e=dC(i.parent),t=i.structuredQuery,n=t.from?t.from.length:0,s=null;if(n>0){Q(n===1);let d=t.from[0];d.allDescendants?s=d.collectionId:e=e.child(d.collectionId)}let r=[];t.where&&(r=function(f){let m=yC(f);return m instanceof Re&&p_(m)?m.getFilters():[m]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(m=>function(v){return new js(Wr(v.field),function(R){switch(R){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(v.direction))}(m))}(t.orderBy));let a=null;t.limit&&(a=function(f){let m;return m=typeof f=="object"?f.value:f,ml(m)?null:m}(t.limit));let c=null;t.startAt&&(c=function(f){let m=!!f.before,_=f.values||[];return new $n(_,m)}(t.startAt));let u=null;return t.endAt&&(u=function(f){let m=!f.before,_=f.values||[];return new $n(_,m)}(t.endAt)),zI(e,s,o,r,a,"F",c,u)}function CN(i,e){let t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return K()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function yC(i){return i.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let n=Wr(t.unaryFilter.field);return _e.create(n,"==",{doubleValue:NaN});case"IS_NULL":let s=Wr(t.unaryFilter.field);return _e.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=Wr(t.unaryFilter.field);return _e.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=Wr(t.unaryFilter.field);return _e.create(o,"!=",{nullValue:"NULL_VALUE"});default:return K()}}(i):i.fieldFilter!==void 0?function(t){return _e.create(Wr(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return K()}}(t.fieldFilter.op),t.fieldFilter.value)}(i):i.compositeFilter!==void 0?function(t){return Re.create(t.compositeFilter.filters.map(n=>yC(n)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return K()}}(t.compositeFilter.op))}(i):K()}function SN(i){return _N[i]}function bN(i){return yN[i]}function AN(i){return vN[i]}function Gr(i){return{fieldPath:i.canonicalString()}}function Wr(i){return Ze.fromServerFormat(i.fieldPath)}function vC(i){return i instanceof _e?function(t){if(t.op==="=="){if(RT(t.value))return{unaryFilter:{field:Gr(t.field),op:"IS_NAN"}};if(AT(t.value))return{unaryFilter:{field:Gr(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(RT(t.value))return{unaryFilter:{field:Gr(t.field),op:"IS_NOT_NAN"}};if(AT(t.value))return{unaryFilter:{field:Gr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Gr(t.field),op:bN(t.op),value:t.value}}}(i):i instanceof Re?function(t){let n=t.getFilters().map(s=>vC(s));return n.length===1?n[0]:{compositeFilter:{op:AN(t.op),filters:n}}}(i):K()}function RN(i){let e=[];return i.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function EC(i){return i.length>=4&&i.get(0)==="projects"&&i.get(2)==="databases"}var io=class i{constructor(e,t,n,s,r=J.min(),o=J.min(),a=tt.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(e){return new i(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new i(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new i(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new i(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Ju=class{constructor(e){this.ct=e}};function PN(i,e){let t;if(e.document)t=pC(i.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let n=j.fromSegments(e.noDocument.path),s=Ks(e.noDocument.readTime);t=at.newNoDocument(n,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return K();{let n=j.fromSegments(e.unknownDocument.path),s=Ks(e.unknownDocument.version);t=at.newUnknownDocument(n,s)}}return e.readTime&&t.setReadTime(function(s){let r=new We(s[0],s[1]);return J.fromTimestamp(r)}(e.readTime)),t}function KT(i,e){let t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Xu(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document=function(r,o){return{name:rl(r,o.key),fields:o.data.value.mapValue.fields,updateTime:no(r,o.version.toTimestamp()),createTime:no(r,o.createTime.toTimestamp())}}(i.ct,e);else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:zs(e.version)};else{if(!e.isUnknownDocument())return K();n.unknownDocument={path:t.path.toArray(),version:zs(e.version)}}return n}function Xu(i){let e=i.toTimestamp();return[e.seconds,e.nanoseconds]}function zs(i){let e=i.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Ks(i){let e=new We(i.seconds,i.nanoseconds);return J.fromTimestamp(e)}function Ms(i,e){let t=(e.baseMutations||[]).map(r=>zm(i.ct,r));for(let r=0;r<e.mutations.length-1;++r){let o=e.mutations[r];if(r+1<e.mutations.length&&e.mutations[r+1].transform!==void 0){let a=e.mutations[r+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(r+1,1),++r}}let n=e.mutations.map(r=>zm(i.ct,r)),s=We.fromMillis(e.localWriteTimeMs);return new tl(e.batchId,s,t,n)}function ja(i){let e=Ks(i.readTime),t=i.lastLimboFreeSnapshotVersion!==void 0?Ks(i.lastLimboFreeSnapshotVersion):J.min(),n;return n=function(r){return r.documents!==void 0}(i.query)?function(r){return Q(r.documents.length===1),Bt(mo(dC(r.documents[0])))}(i.query):function(r){return Bt(_C(r))}(i.query),new io(n,i.targetId,"TargetPurposeListen",i.lastListenSequenceNumber,e,t,tt.fromBase64String(i.resumeToken))}function wC(i,e){let t=zs(e.snapshotVersion),n=zs(e.lastLimboFreeSnapshotVersion),s;s=zu(e.target)?mC(i.ct,e.target):gC(i.ct,e.target)._t;let r=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Gs(e.target),readTime:t,resumeToken:r,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:s}}function v_(i){let e=_C({parent:i.parent,structuredQuery:i.structuredQuery});return i.limitType==="LAST"?Hu(e,e.limit,"L"):e}function rm(i,e){return new nl(e.largestBatchId,zm(i.ct,e.overlayMutation))}function HT(i,e){let t=e.path.lastSegment();return[i,Vt(e.path.popLast()),t]}function QT(i,e,t,n){return{indexId:i,uid:e,sequenceNumber:t,readTime:zs(n.readTime),documentKey:Vt(n.documentKey.path),largestBatchId:n.largestBatchId}}var Km=class{getBundleMetadata(e,t){return $T(e).get(t).next(n=>{if(n)return function(r){return{id:r.bundleId,createTime:Ks(r.createTime),version:r.version}}(n)})}saveBundleMetadata(e,t){return $T(e).put(function(s){return{bundleId:s.id,createTime:zs(et(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return YT(e).get(t).next(n=>{if(n)return function(r){return{name:r.name,query:v_(r.bundledQuery),readTime:Ks(r.readTime)}}(n)})}saveNamedQuery(e,t){return YT(e).put(function(s){return{name:s.name,readTime:zs(et(s.readTime)),bundledQuery:s.bundledQuery}}(t))}};function $T(i){return dt(i,"bundles")}function YT(i){return dt(i,"namedQueries")}var Zu=class i{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){let n=t.uid||"";return new i(e,n)}getOverlay(e,t){return La(e).get(HT(this.userId,t)).next(n=>n?rm(this.serializer,n):null)}getOverlays(e,t){let n=Wn();return P.forEach(t,s=>this.getOverlay(e,s).next(r=>{r!==null&&n.set(s,r)})).next(()=>n)}saveOverlays(e,t,n){let s=[];return n.forEach((r,o)=>{let a=new nl(t,o);s.push(this.ht(e,a))}),P.waitFor(s)}removeOverlaysForBatchId(e,t,n){let s=new Set;t.forEach(o=>s.add(Vt(o.getCollectionPath())));let r=[];return s.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,n],[this.userId,o,n+1],!1,!0);r.push(La(e).j("collectionPathOverlayIndex",a))}),P.waitFor(r)}getOverlaysForCollection(e,t,n){let s=Wn(),r=Vt(t),o=IDBKeyRange.bound([this.userId,r,n],[this.userId,r,Number.POSITIVE_INFINITY],!0);return La(e).U("collectionPathOverlayIndex",o).next(a=>{for(let c of a){let u=rm(this.serializer,c);s.set(u.getKey(),u)}return s})}getOverlaysForCollectionGroup(e,t,n,s){let r=Wn(),o,a=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return La(e).J({index:"collectionGroupOverlayIndex",range:a},(c,u,d)=>{let f=rm(this.serializer,u);r.size()<s||f.largestBatchId===o?(r.set(f.getKey(),f),o=f.largestBatchId):d.done()}).next(()=>r)}ht(e,t){return La(e).put(function(s,r,o){let[a,c,u]=HT(r,o.mutation.key);return{userId:r,collectionPath:c,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:ol(s.ct,o.mutation)}}(this.serializer,this.userId,t))}};function La(i){return dt(i,"documentOverlays")}var Hm=class{Pt(e){return dt(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{let n=t?.value;return n?tt.fromUint8Array(n):tt.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}};var fi=class{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(je(e.integerValue));else if("doubleValue"in e){let n=je(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),$a(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),typeof n=="string"&&(n=mi(n)),t.Rt(`${n.seconds||""}`),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(Zi(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?LI(e)?this.dt(t,Number.MAX_SAFE_INTEGER):kh(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):K()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){let n=e.fields||{};this.dt(t,55);for(let s of Object.keys(n))this.Vt(s,t),this.Tt(n[s],t)}wt(e,t){var n,s;let r=e.fields||{};this.dt(t,53);let o="value",a=((s=(n=r[o].arrayValue)===null||n===void 0?void 0:n.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At(je(a)),this.Vt(o,t),this.Tt(r[o],t)}bt(e,t){let n=e.values||[];this.dt(t,50);for(let s of n)this.Tt(s,t)}yt(e,t){this.dt(t,37),j.fromName(e).path.forEach(n=>{this.dt(t,60),this.Dt(n,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}};fi.vt=new fi;function NN(i){if(i===0)return 8;let e=0;return!(i>>4)&&(e+=4,i<<=4),!(i>>6)&&(e+=2,i<<=2),!(i>>7)&&(e+=1),e}function JT(i){let e=64-function(n){let s=0;for(let r=0;r<8;++r){let o=NN(255&n[r]);if(s+=o,o!==8)break}return s}(i);return Math.ceil(e/8)}var Qm=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Ft(n.value),n=t.next();this.Mt()}xt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Ot(n.value),n=t.next();this.Nt()}Lt(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.Ft(n);else if(n<2048)this.Ft(960|n>>>6),this.Ft(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|n>>>12),this.Ft(128|63&n>>>6),this.Ft(128|63&n);else{let s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.Ot(n);else if(n<2048)this.Ot(960|n>>>6),this.Ot(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|n>>>12),this.Ot(128|63&n>>>6),this.Ot(128|63&n);else{let s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){let t=this.qt(e),n=JT(t);this.Qt(1+n),this.buffer[this.position++]=255&n;for(let s=t.length-n;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){let t=this.qt(e),n=JT(t);this.Qt(1+n),this.buffer[this.position++]=~(255&n);for(let s=t.length-n;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){let t=function(r){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,r,!1),new Uint8Array(o.buffer)}(e),n=(128&t[0])!=0;t[0]^=n?255:128;for(let s=1;s<t.length;++s)t[s]^=n?255:0;return t}Ft(e){let t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){let t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let s=new Uint8Array(n);s.set(this.buffer),this.buffer=s}},$m=class{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}},Ym=class{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}},Fs=class{constructor(){this.jt=new Qm,this.Ht=new $m(this.jt),this.Jt=new Ym(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}};var Ls=class i{constructor(e,t,n,s){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=s}Zt(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new i(this.indexId,this.documentKey,this.arrayValue,n)}};function zi(i,e){let t=i.indexId-e.indexId;return t!==0?t:(t=XT(i.arrayValue,e.arrayValue),t!==0?t:(t=XT(i.directionalValue,e.directionalValue),t!==0?t:j.comparator(i.documentKey,e.documentKey)))}function XT(i,e){for(let t=0;t<i.length&&t<e.length;++t){let n=i[t]-e[t];if(n!==0)return n}return i.length-e.length}var eh=class{constructor(e){this.Xt=new Oe((t,n)=>Ze.comparator(t.field,n.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(let t of e.filters){let n=t;n.isInequality()?this.Xt=this.Xt.add(n):this.tn.push(n)}}get nn(){return this.Xt.size>1}rn(e){if(Q(e.collectionGroup===this.collectionId),this.nn)return!1;let t=_m(e);if(t!==void 0&&!this.sn(t))return!1;let n=Os(e),s=new Set,r=0,o=0;for(;r<n.length&&this.sn(n[r]);++r)s=s.add(n[r].fieldPath.canonicalString());if(r===n.length)return!0;if(this.Xt.size>0){let a=this.Xt.getIterator().getNext();if(!s.has(a.field.canonicalString())){let c=n[r];if(!this.on(a,c)||!this._n(this.en[o++],c))return!1}++r}for(;r<n.length;++r){let a=n[r];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new Oe(Ze.comparator),t=[];for(let n of this.tn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")t.push(new Hr(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new Hr(n.field,0))}for(let n of this.en)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new Hr(n.field,n.dir==="asc"?0:1)));return new Jr(Jr.UNKNOWN_ID,this.collectionId,t,Qa.empty())}sn(e){for(let t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let n=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===n}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function TC(i){var e,t;if(Q(i instanceof _e||i instanceof Re),i instanceof _e){if(i instanceof Wu){let s=((t=(e=i.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(r=>_e.create(i.field,"==",r)))||[];return Re.create(s,"or")}return i}let n=i.filters.map(s=>TC(s));return Re.create(n,i.op)}function xN(i){if(i.getFilters().length===0)return[];let e=Zm(TC(i));return Q(IC(e)),Jm(e)||Xm(e)?[e]:e.getFilters()}function Jm(i){return i instanceof _e}function Xm(i){return i instanceof Re&&p_(i)}function IC(i){return Jm(i)||Xm(i)||function(t){if(t instanceof Re&&Sm(t)){for(let n of t.getFilters())if(!Jm(n)&&!Xm(n))return!1;return!0}return!1}(i)}function Zm(i){if(Q(i instanceof _e||i instanceof Re),i instanceof _e)return i;if(i.filters.length===1)return Zm(i.filters[0]);let e=i.filters.map(n=>Zm(n)),t=Re.create(e,i.op);return t=th(t),IC(t)?t:(Q(t instanceof Re),Q(Zr(t)),Q(t.filters.length>1),t.filters.reduce((n,s)=>E_(n,s)))}function E_(i,e){let t;return Q(i instanceof _e||i instanceof Re),Q(e instanceof _e||e instanceof Re),t=i instanceof _e?e instanceof _e?function(s,r){return Re.create([s,r],"and")}(i,e):ZT(i,e):e instanceof _e?ZT(e,i):function(s,r){if(Q(s.filters.length>0&&r.filters.length>0),Zr(s)&&Zr(r))return jI(s,r.getFilters());let o=Sm(s)?s:r,a=Sm(s)?r:s,c=o.filters.map(u=>E_(u,a));return Re.create(c,"or")}(i,e),th(t)}function ZT(i,e){if(Zr(e))return jI(e,i.getFilters());{let t=e.filters.map(n=>E_(i,n));return Re.create(t,"or")}}function th(i){if(Q(i instanceof _e||i instanceof Re),i instanceof _e)return i;let e=i.getFilters();if(e.length===1)return th(e[0]);if(UI(i))return i;let t=e.map(s=>th(s)),n=[];return t.forEach(s=>{s instanceof _e?n.push(s):s instanceof Re&&(s.op===i.op?n.push(...s.filters):n.push(s))}),n.length===1?n[0]:Re.create(n,i.op)}var eg=class{constructor(){this.un=new al}addToCollectionParentIndex(e,t){return this.un.add(t),P.resolve()}getCollectionParents(e,t){return P.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return P.resolve()}deleteFieldIndex(e,t){return P.resolve()}deleteAllFieldIndexes(e){return P.resolve()}createTargetIndexes(e,t){return P.resolve()}getDocumentsMatchingTarget(e,t){return P.resolve(null)}getIndexType(e,t){return P.resolve(0)}getFieldIndexes(e,t){return P.resolve([])}getNextCollectionGroupToUpdate(e){return P.resolve(null)}getMinOffset(e,t){return P.resolve(pn.min())}getMinOffsetFromCollectionGroup(e,t){return P.resolve(pn.min())}updateCollectionGroup(e,t,n){return P.resolve()}updateIndexEntries(e,t){return P.resolve()}},al=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),s=this.index[t]||new Oe(ve.comparator),r=!s.has(n);return this.index[t]=s.add(n),r}has(e){let t=e.lastSegment(),n=e.popLast(),s=this.index[t];return s&&s.has(n)}getEntries(e){return(this.index[e]||new Oe(ve.comparator)).toArray()}};var Au=new Uint8Array(0),tg=class{constructor(e,t){this.databaseId=t,this.cn=new al,this.ln=new Yn(n=>Gs(n),(n,s)=>gl(n,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){let n=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});let r={collectionId:n,parent:Vt(s)};return eI(e).put(r)}return P.resolve()}getCollectionParents(e,t){let n=[],s=IDBKeyRange.bound([t,""],[SI(t),""],!1,!0);return eI(e).U(s).next(r=>{for(let o of r){if(o.collectionId!==t)break;n.push(Gn(o.parent))}return n})}addFieldIndex(e,t){let n=Va(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(t);delete s.indexId;let r=n.add(s);if(t.indexState){let o=Br(e);return r.next(a=>{o.put(QT(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return r.next()}deleteFieldIndex(e,t){let n=Va(e),s=Br(e),r=Vr(e);return n.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Va(e),n=Vr(e),s=Br(e);return t.j().next(()=>n.j()).next(()=>s.j())}createTargetIndexes(e,t){return P.forEach(this.hn(t),n=>this.getIndexType(e,n).next(s=>{if(s===0||s===1){let r=new eh(n).an();if(r!=null)return this.addFieldIndex(e,r)}}))}getDocumentsMatchingTarget(e,t){let n=Vr(e),s=!0,r=new Map;return P.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{s&&(s=!!a),r.set(o,a)})).next(()=>{if(s){let o=ce(),a=[];return P.forEach(r,(c,u)=>{k("IndexedDbIndexManager",`Using index ${function(B){return`id=${B.indexId}|cg=${B.collectionGroup}|f=${B.fields.map($=>`${$.fieldPath}:${$.kind}`).join(",")}`}(c)} to execute ${Gs(t)}`);let d=function(B,$){let le=_m($);if(le===void 0)return null;for(let Z of Ku(B,le.fieldPath))switch(Z.op){case"array-contains-any":return Z.value.arrayValue.values||[];case"array-contains":return[Z.value]}return null}(u,c),f=function(B,$){let le=new Map;for(let Z of Os($))for(let T of Ku(B,Z.fieldPath))switch(T.op){case"==":case"in":le.set(Z.fieldPath.canonicalString(),T.value);break;case"not-in":case"!=":return le.set(Z.fieldPath.canonicalString(),T.value),Array.from(le.values())}return null}(u,c),m=function(B,$){let le=[],Z=!0;for(let T of Os($)){let y=T.kind===0?OT(B,T.fieldPath,B.startAt):kT(B,T.fieldPath,B.startAt);le.push(y.value),Z&&(Z=y.inclusive)}return new $n(le,Z)}(u,c),_=function(B,$){let le=[],Z=!0;for(let T of Os($)){let y=T.kind===0?kT(B,T.fieldPath,B.endAt):OT(B,T.fieldPath,B.endAt);le.push(y.value),Z&&(Z=y.inclusive)}return new $n(le,Z)}(u,c),v=this.In(c,u,m),C=this.In(c,u,_),R=this.Tn(c,u,f),F=this.En(c.indexId,d,v,m.inclusive,C,_.inclusive,R);return P.forEach(F,V=>n.G(V,t.limit).next(B=>{B.forEach($=>{let le=j.fromSegments($.documentKey);o.has(le)||(o=o.add(le),a.push(le))})}))}).next(()=>a)}return P.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=xN(Re.create(e.filters,"and")).map(n=>km(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,n,s,r,o,a){let c=(t!=null?t.length:1)*Math.max(n.length,r.length),u=c/(t!=null?t.length:1),d=[];for(let f=0;f<c;++f){let m=t?this.dn(t[f/u]):Au,_=this.An(e,m,n[f%u],s),v=this.Rn(e,m,r[f%u],o),C=a.map(R=>this.An(e,m,R,!0));d.push(...this.createRange(_,v,C))}return d}An(e,t,n,s){let r=new Ls(e,j.empty(),t,n);return s?r:r.Zt()}Rn(e,t,n,s){let r=new Ls(e,j.empty(),t,n);return s?r.Zt():r}Pn(e,t){let n=new eh(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(r=>{let o=null;for(let a of r)n.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let n=2,s=this.hn(t);return P.forEach(s,r=>this.Pn(e,r).next(o=>{o?n!==0&&o.fields.length<function(c){let u=new Oe(Ze.comparator),d=!1;for(let f of c.filters)for(let m of f.getFlattenedFilters())m.field.isKeyField()||(m.op==="array-contains"||m.op==="array-contains-any"?d=!0:u=u.add(m.field));for(let f of c.orderBy)f.field.isKeyField()||(u=u.add(f.field));return u.size+(d?1:0)}(r)&&(n=1):n=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&n===2?1:n)}Vn(e,t){let n=new Fs;for(let s of Os(e)){let r=t.data.field(s.fieldPath);if(r==null)return null;let o=n.Yt(s.kind);fi.vt.It(r,o)}return n.zt()}dn(e){let t=new Fs;return fi.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){let n=new Fs;return fi.vt.It(qs(this.databaseId,t),n.Yt(function(r){let o=Os(r);return o.length===0?0:o[o.length-1].kind}(e))),n.zt()}Tn(e,t,n){if(n===null)return[];let s=[];s.push(new Fs);let r=0;for(let o of Os(e)){let a=n[r++];for(let c of s)if(this.fn(t,o.fieldPath)&&Za(a))s=this.gn(s,o,a);else{let u=c.Yt(o.kind);fi.vt.It(a,u)}}return this.pn(s)}In(e,t,n){return this.Tn(e,t,n.position)}pn(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].zt();return t}gn(e,t,n){let s=[...e],r=[];for(let o of n.arrayValue.values||[])for(let a of s){let c=new Fs;c.seed(a.zt()),fi.vt.It(o,c.Yt(t.kind)),r.push(c)}return r}fn(e,t){return!!e.filters.find(n=>n instanceof _e&&n.field.isEqual(t)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(e,t){let n=Va(e),s=Br(e);return(t?n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.U()).next(r=>{let o=[];return P.forEach(r,a=>s.get([a.indexId,this.uid]).next(c=>{o.push(function(d,f){let m=f?new Qa(f.sequenceNumber,new pn(Ks(f.readTime),new j(Gn(f.documentKey)),f.largestBatchId)):Qa.empty(),_=d.fields.map(([v,C])=>new Hr(Ze.fromServerFormat(v),C));return new Jr(d.indexId,d.collectionGroup,_,m)}(a,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((n,s)=>{let r=n.indexState.sequenceNumber-s.indexState.sequenceNumber;return r!==0?r:ie(n.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,n){let s=Va(e),r=Br(e);return this.yn(e).next(o=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>P.forEach(a,c=>r.put(QT(c.indexId,this.uid,o,n)))))}updateIndexEntries(e,t){let n=new Map;return P.forEach(t,(s,r)=>{let o=n.get(s.collectionGroup);return(o?P.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(n.set(s.collectionGroup,a),P.forEach(a,c=>this.wn(e,s,c).next(u=>{let d=this.Sn(r,c);return u.isEqual(d)?P.resolve():this.bn(e,r,c,u,d)}))))})}Dn(e,t,n,s){return Vr(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(n,t.key),documentKey:t.key.path.toArray()})}vn(e,t,n,s){return Vr(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(n,t.key),t.key.path.toArray()])}wn(e,t,n){let s=Vr(e),r=new Oe(zi);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.mn(n,t)])},(o,a)=>{r=r.add(new Ls(n.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>r)}Sn(e,t){let n=new Oe(zi),s=this.Vn(t,e);if(s==null)return n;let r=_m(t);if(r!=null){let o=e.data.field(r.fieldPath);if(Za(o))for(let a of o.arrayValue.values||[])n=n.add(new Ls(t.indexId,e.key,this.dn(a),s))}else n=n.add(new Ls(t.indexId,e.key,Au,s));return n}bn(e,t,n,s,r){k("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let o=[];return function(c,u,d,f,m){let _=c.getIterator(),v=u.getIterator(),C=Lr(_),R=Lr(v);for(;C||R;){let F=!1,V=!1;if(C&&R){let B=d(C,R);B<0?V=!0:B>0&&(F=!0)}else C!=null?V=!0:F=!0;F?(f(R),R=Lr(v)):V?(m(C),C=Lr(_)):(C=Lr(_),R=Lr(v))}}(s,r,zi,a=>{o.push(this.Dn(e,t,n,a))},a=>{o.push(this.vn(e,t,n,a))}),P.waitFor(o)}yn(e){let t=1;return Br(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,s,r)=>{r.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((o,a)=>zi(o,a)).filter((o,a,c)=>!a||zi(o,c[a-1])!==0);let s=[];s.push(e);for(let o of n){let a=zi(o,e),c=zi(o,t);if(a===0)s[0]=e.Zt();else if(a>0&&c<0)s.push(o),s.push(o.Zt());else if(c>0)break}s.push(t);let r=[];for(let o=0;o<s.length;o+=2){if(this.Cn(s[o],s[o+1]))return[];let a=[s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,Au,[]],c=[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,Au,[]];r.push(IDBKeyRange.bound(a,c))}return r}Cn(e,t){return zi(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(tI)}getMinOffset(e,t){return P.mapArray(this.hn(t),n=>this.Pn(e,n).next(s=>s||K())).next(tI)}};function eI(i){return dt(i,"collectionParents")}function Vr(i){return dt(i,"indexEntries")}function Va(i){return dt(i,"indexConfiguration")}function Br(i){return dt(i,"indexState")}function tI(i){Q(i.length!==0);let e=i[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<i.length;n++){let s=i[n].indexState.offset;u_(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new pn(e.readTime,e.documentKey,t)}var nI={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},fn=class i{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new i(e,i.DEFAULT_COLLECTION_PERCENTILE,i.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function CC(i,e,t){let n=i.store("mutations"),s=i.store("documentMutations"),r=[],o=IDBKeyRange.only(t.batchId),a=0,c=n.J({range:o},(d,f,m)=>(a++,m.delete()));r.push(c.next(()=>{Q(a===1)}));let u=[];for(let d of t.mutations){let f=xI(e,d.key.path,t.batchId);r.push(s.delete(f)),u.push(d.key)}return P.waitFor(r).next(()=>u)}function nh(i){if(!i)return 0;let e;if(i.document)e=i.document;else if(i.unknownDocument)e=i.unknownDocument;else{if(!i.noDocument)throw K();e=i.noDocument}return JSON.stringify(e).length}fn.DEFAULT_COLLECTION_PERCENTILE=10,fn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,fn.DEFAULT=new fn(41943040,fn.DEFAULT_COLLECTION_PERCENTILE,fn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),fn.DISABLED=new fn(-1,0,0);var ih=class i{constructor(e,t,n,s){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=s,this.Fn={}}static lt(e,t,n,s){Q(e.uid!=="");let r=e.isAuthenticated()?e.uid:"";return new i(r,t,n,s)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ki(e).J({index:"userMutationsIndex",range:n},(s,r,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,n,s){let r=zr(e),o=Ki(e);return o.add({}).next(a=>{Q(typeof a=="number");let c=new tl(a,t,n,s),u=function(_,v,C){let R=C.baseMutations.map(V=>ol(_.ct,V)),F=C.mutations.map(V=>ol(_.ct,V));return{userId:v,batchId:C.batchId,localWriteTimeMs:C.localWriteTime.toMillis(),baseMutations:R,mutations:F}}(this.serializer,this.userId,c),d=[],f=new Oe((m,_)=>ie(m.canonicalString(),_.canonicalString()));for(let m of s){let _=xI(this.userId,m.key.path,a);f=f.add(m.key.path.popLast()),d.push(o.put(u)),d.push(r.put(_,LP))}return f.forEach(m=>{d.push(this.indexManager.addToCollectionParentIndex(e,m))}),e.addOnCommittedListener(()=>{this.Fn[a]=c.keys()}),P.waitFor(d).next(()=>c)})}lookupMutationBatch(e,t){return Ki(e).get(t).next(n=>n?(Q(n.userId===this.userId),Ms(this.serializer,n)):null)}Mn(e,t){return this.Fn[t]?P.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(n=>{if(n){let s=n.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,s=IDBKeyRange.lowerBound([this.userId,n]),r=null;return Ki(e).J({index:"userMutationsIndex",range:s},(o,a,c)=>{a.userId===this.userId&&(Q(a.batchId>=n),r=Ms(this.serializer,a)),c.done()}).next(()=>r)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Ki(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,r,o)=>{n=r.batchId,o.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ki(e).U("userMutationsIndex",t).next(n=>n.map(s=>Ms(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=xu(this.userId,t.path),s=IDBKeyRange.lowerBound(n),r=[];return zr(e).J({range:s},(o,a,c)=>{let[u,d,f]=o,m=Gn(d);if(u===this.userId&&t.path.isEqual(m))return Ki(e).get(f).next(_=>{if(!_)throw K();Q(_.userId===this.userId),r.push(Ms(this.serializer,_))});c.done()}).next(()=>r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Oe(ie),s=[];return t.forEach(r=>{let o=xu(this.userId,r.path),a=IDBKeyRange.lowerBound(o),c=zr(e).J({range:a},(u,d,f)=>{let[m,_,v]=u,C=Gn(_);m===this.userId&&r.path.isEqual(C)?n=n.add(v):f.done()});s.push(c)}),P.waitFor(s).next(()=>this.xn(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,s=n.length+1,r=xu(this.userId,n),o=IDBKeyRange.lowerBound(r),a=new Oe(ie);return zr(e).J({range:o},(c,u,d)=>{let[f,m,_]=c,v=Gn(m);f===this.userId&&n.isPrefixOf(v)?v.length===s&&(a=a.add(_)):d.done()}).next(()=>this.xn(e,a))}xn(e,t){let n=[],s=[];return t.forEach(r=>{s.push(Ki(e).get(r).next(o=>{if(o===null)throw K();Q(o.userId===this.userId),n.push(Ms(this.serializer,o))}))}),P.waitFor(s).next(()=>n)}removeMutationBatch(e,t){return CC(e._e,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),P.forEach(n,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return P.resolve();let n=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return zr(e).J({range:n},(r,o,a)=>{if(r[0]===this.userId){let c=Gn(r[1]);s.push(c)}else a.done()}).next(()=>{Q(s.length===0)})})}containsKey(e,t){return SC(e,this.userId,t)}Nn(e){return bC(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function SC(i,e,t){let n=xu(e,t.path),s=n[1],r=IDBKeyRange.lowerBound(n),o=!1;return zr(i).J({range:r,H:!0},(a,c,u)=>{let[d,f,m]=a;d===e&&f===s&&(o=!0),u.done()}).next(()=>o)}function Ki(i){return dt(i,"mutations")}function zr(i){return dt(i,"documentMutations")}function bC(i){return dt(i,"mutationQueues")}var so=class i{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new i(0)}static kn(){return new i(-1)}};var ng=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{let n=new so(t.highestTargetId);return t.highestTargetId=n.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>J.fromTimestamp(new We(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,n&&(s.lastRemoteSnapshotVersion=n.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(n=>(n.targetCount+=1,this.$n(t,n),this.Qn(e,n))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Ur(e).delete(t.targetId)).next(()=>this.qn(e)).next(n=>(Q(n.targetCount>0),n.targetCount-=1,this.Qn(e,n)))}removeTargets(e,t,n){let s=0,r=[];return Ur(e).J((o,a)=>{let c=ja(a);c.sequenceNumber<=t&&n.get(c.targetId)===null&&(s++,r.push(this.removeTargetData(e,c)))}).next(()=>P.waitFor(r)).next(()=>s)}forEachTarget(e,t){return Ur(e).J((n,s)=>{let r=ja(s);t(r)})}qn(e){return iI(e).get("targetGlobalKey").next(t=>(Q(t!==null),t))}Qn(e,t){return iI(e).put("targetGlobalKey",t)}Kn(e,t){return Ur(e).put(wC(this.serializer,t))}$n(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){let n=Gs(t),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),r=null;return Ur(e).J({range:s,index:"queryTargetsIndex"},(o,a,c)=>{let u=ja(a);gl(t,u.target)&&(r=u,c.done())}).next(()=>r)}addMatchingKeys(e,t,n){let s=[],r=Hi(e);return t.forEach(o=>{let a=Vt(o.path);s.push(r.put({targetId:n,path:a})),s.push(this.referenceDelegate.addReference(e,n,o))}),P.waitFor(s)}removeMatchingKeys(e,t,n){let s=Hi(e);return P.forEach(t,r=>{let o=Vt(r.path);return P.waitFor([s.delete([n,o]),this.referenceDelegate.removeReference(e,n,r)])})}removeMatchingKeysForTargetId(e,t){let n=Hi(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(s)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),s=Hi(e),r=ce();return s.J({range:n,H:!0},(o,a,c)=>{let u=Gn(o[1]),d=new j(u);r=r.add(d)}).next(()=>r)}containsKey(e,t){let n=Vt(t.path),s=IDBKeyRange.bound([n],[SI(n)],!1,!0),r=0;return Hi(e).J({index:"documentTargetsIndex",H:!0,range:s},([o,a],c,u)=>{o!==0&&(r++,u.done())}).next(()=>r>0)}ot(e,t){return Ur(e).get(t).next(n=>n?ja(n):null)}};function Ur(i){return dt(i,"targets")}function iI(i){return dt(i,"targetGlobal")}function Hi(i){return dt(i,"targetDocuments")}function sI([i,e],[t,n]){let s=ie(i,t);return s===0?ie(e,n):s}var ig=class{constructor(e){this.Un=e,this.buffer=new Oe(sI),this.Wn=0}Gn(){return++this.Wn}zn(e){let t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{let n=this.buffer.last();sI(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}},sg=class{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){k("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>D(this,null,function*(){this.jn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){ls(t)?k("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield as(t)}yield this.Hn(3e5)}))}},rg=class{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(t===0)return P.resolve(Yt.oe);let n=new ig(t);return this.Jn.forEachTarget(e,s=>n.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>n.zn(s))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(k("LruGarbageCollector","Garbage collection skipped; disabled"),P.resolve(nI)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(k("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),nI):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let n,s,r,o,a,c,u,d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(k("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(n=f,a=Date.now(),this.removeTargets(e,n,t))).next(f=>(r=f,c=Date.now(),this.removeOrphanedDocuments(e,n))).next(f=>(u=Date.now(),qr()<=cn.DEBUG&&k("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${r} targets in `+(c-a)+`ms
	Removed ${f} documents in `+(u-c)+`ms
Total Duration: ${u-d}ms`),P.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:r,documentsRemoved:f})))}};function DN(i,e){return new rg(i,e)}var og=class{constructor(e,t){this.db=e,this.garbageCollector=DN(this,t)}Yn(e){let t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(n=>t.next(s=>n+s))}er(e){let t=0;return this.Zn(e,n=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(n,s)=>t(s))}addReference(e,t,n){return Ru(e,n)}removeReference(e,t,n){return Ru(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Ru(e,t)}nr(e,t){return function(s,r){let o=!1;return bC(s).Y(a=>SC(s,a,r).next(c=>(c&&(o=!0),P.resolve(!c)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],r=0;return this.tr(e,(o,a)=>{if(a<=t){let c=this.nr(e,o).next(u=>{if(!u)return r++,n.getEntry(e,o).next(()=>(n.removeEntry(o,J.min()),Hi(e).delete(function(f){return[0,Vt(f.path)]}(o))))});s.push(c)}}).next(()=>P.waitFor(s)).next(()=>n.apply(e)).next(()=>r)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Ru(e,t)}tr(e,t){let n=Hi(e),s,r=Yt.oe;return n.J({index:"documentTargetsIndex"},([o,a],{path:c,sequenceNumber:u})=>{o===0?(r!==Yt.oe&&t(new j(Gn(s)),r),r=u,s=c):r=Yt.oe}).next(()=>{r!==Yt.oe&&t(new j(Gn(s)),r)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function Ru(i,e){return Hi(i).put(function(n,s){return{targetId:0,path:Vt(n.path),sequenceNumber:s}}(e,i.currentSequenceNumber))}var sh=class{constructor(){this.changes=new Yn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,at.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return n!==void 0?P.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var ag=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return Ds(e).put(n)}removeEntry(e,t,n){return Ds(e).delete(function(r,o){let a=r.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Xu(o),a[a.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.rr(e,n)))}getEntry(e,t){let n=at.newInvalidDocument(t);return Ds(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Ba(t))},(s,r)=>{n=this.ir(t,r)}).next(()=>n)}sr(e,t){let n={size:0,document:at.newInvalidDocument(t)};return Ds(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Ba(t))},(s,r)=>{n={document:this.ir(t,r),size:nh(r)}}).next(()=>n)}getEntries(e,t){let n=Gt();return this._r(e,t,(s,r)=>{let o=this.ir(s,r);n=n.insert(s,o)}).next(()=>n)}ar(e,t){let n=Gt(),s=new Be(j.comparator);return this._r(e,t,(r,o)=>{let a=this.ir(r,o);n=n.insert(r,a),s=s.insert(r,nh(o))}).next(()=>({documents:n,ur:s}))}_r(e,t,n){if(t.isEmpty())return P.resolve();let s=new Oe(aI);t.forEach(c=>s=s.add(c));let r=IDBKeyRange.bound(Ba(s.first()),Ba(s.last())),o=s.getIterator(),a=o.getNext();return Ds(e).J({index:"documentKeyIndex",range:r},(c,u,d)=>{let f=j.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&aI(a,f)<0;)n(a,null),a=o.getNext();a&&a.isEqual(f)&&(n(a,u),a=o.hasNext()?o.getNext():null),a?d.$(Ba(a)):d.done()}).next(()=>{for(;a;)n(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,n,s,r){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Xu(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],c=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Ds(e).U(IDBKeyRange.bound(a,c,!0)).next(u=>{r?.incrementDocumentReadCount(u.length);let d=Gt();for(let f of u){let m=this.ir(j.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);m.isFoundDocument()&&(yl(t,m)||s.has(m.key))&&(d=d.insert(m.key,m))}return d})}getAllFromCollectionGroup(e,t,n,s){let r=Gt(),o=oI(t,n),a=oI(t,pn.max());return Ds(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(c,u,d)=>{let f=this.ir(j.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);r=r.insert(f.key,f),r.size===s&&d.done()}).next(()=>r)}newChangeBuffer(e){return new lg(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return rI(e).get("remoteDocumentGlobalKey").next(t=>(Q(!!t),t))}rr(e,t){return rI(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){let n=PN(this.serializer,t);if(!(n.isNoDocument()&&n.version.isEqual(J.min())))return n}return at.newInvalidDocument(e)}};function AC(i){return new ag(i)}var lg=class extends sh{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new Yn(n=>n.toString(),(n,s)=>n.isEqual(s))}applyChanges(e){let t=[],n=0,s=new Oe((r,o)=>ie(r.canonicalString(),o.canonicalString()));return this.changes.forEach((r,o)=>{let a=this.lr.get(r);if(t.push(this.cr.removeEntry(e,r,a.readTime)),o.isValidDocument()){let c=KT(this.cr.serializer,o);s=s.add(r.path.popLast());let u=nh(c);n+=u-a.size,t.push(this.cr.addEntry(e,r,c))}else if(n-=a.size,this.trackRemovals){let c=KT(this.cr.serializer,o.convertToNoDocument(J.min()));t.push(this.cr.addEntry(e,r,c))}}),s.forEach(r=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,r))}),t.push(this.cr.updateMetadata(e,n)),P.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(n=>(this.lr.set(t,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:n,ur:s})=>(s.forEach((r,o)=>{this.lr.set(r,{size:o,readTime:n.get(r).readTime})}),n))}};function rI(i){return dt(i,"remoteDocumentGlobal")}function Ds(i){return dt(i,"remoteDocumentsV14")}function Ba(i){let e=i.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function oI(i,e){let t=e.documentKey.path.toArray();return[i,Xu(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function aI(i,e){let t=i.path.toArray(),n=e.path.toArray(),s=0;for(let r=0;r<t.length-2&&r<n.length-2;++r)if(s=ie(t[r],n[r]),s)return s;return s=ie(t.length,n.length),s||(s=ie(t[t.length-2],n[n.length-2]),s||ie(t[t.length-1],n[n.length-1]))}var cg=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var rh=class{constructor(e,t,n,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=s}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(n=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(n!==null&&za(n.mutation,s,Jt.empty(),We.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,ce()).next(()=>n))}getLocalViewOfDocuments(e,t,n=ce()){let s=Wn();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,n).next(r=>{let o=qa();return r.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let n=Wn();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,ce()))}populateOverlays(e,t,n){let s=[];return n.forEach(r=>{t.has(r)||s.push(r)}),this.documentOverlayCache.getOverlays(e,s).next(r=>{r.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,n,s){let r=Gt(),o=Wa(),a=function(){return Wa()}();return t.forEach((c,u)=>{let d=n.get(u.key);s.has(u.key)&&(d===void 0||d.mutation instanceof Rn)?r=r.insert(u.key,u):d!==void 0?(o.set(u.key,d.mutation.getFieldMask()),za(d.mutation,u,d.mutation.getFieldMask(),We.now())):o.set(u.key,Jt.empty())}),this.recalculateAndSaveOverlays(e,r).next(c=>(c.forEach((u,d)=>o.set(u,d)),t.forEach((u,d)=>{var f;return a.set(u,new cg(d,(f=o.get(u))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){let n=Wa(),s=new Be((o,a)=>o-a),r=ce();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(c=>{let u=t.get(c);if(u===null)return;let d=n.get(c)||Jt.empty();d=a.applyToLocalView(u,d),n.set(c,d);let f=(s.get(a.batchId)||ce()).add(c);s=s.insert(a.batchId,f)})}).next(()=>{let o=[],a=s.getReverseIterator();for(;a.hasNext();){let c=a.getNext(),u=c.key,d=c.value,f=JI();d.forEach(m=>{if(!r.has(m)){let _=sC(t.get(m),n.get(m));_!==null&&f.set(m,_),r=r.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,f))}return P.waitFor(o)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,s){return function(o){return j.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):m_(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,s):this.getDocumentsMatchingCollectionQuery(e,t,n,s)}getNextDocuments(e,t,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,s).next(r=>{let o=s-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,s-r.size):P.resolve(Wn()),a=-1,c=r;return o.next(u=>P.forEach(u,(d,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),r.get(d)?P.resolve():this.remoteDocumentCache.getEntry(e,d).next(m=>{c=c.insert(d,m)}))).next(()=>this.populateOverlays(e,u,r)).next(()=>this.computeViews(e,c,u,ce())).next(d=>({batchId:a,changes:YI(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new j(t)).next(n=>{let s=qa();return n.isFoundDocument()&&(s=s.insert(n.key,n)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,n,s){let r=t.collectionGroup,o=qa();return this.indexManager.getCollectionParents(e,r).next(a=>P.forEach(a,c=>{let u=function(f,m){return new An(m,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,c.child(r));return this.getDocumentsMatchingCollectionQuery(e,u,n,s).next(d=>{d.forEach((f,m)=>{o=o.insert(f,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,n,s){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(o=>(r=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r,s))).next(o=>{r.forEach((c,u)=>{let d=u.getKey();o.get(d)===null&&(o=o.insert(d,at.newInvalidDocument(d)))});let a=qa();return o.forEach((c,u)=>{let d=r.get(c);d!==void 0&&za(d.mutation,u,Jt.empty(),We.now()),yl(t,u)&&(a=a.insert(c,u))}),a})}};var ug=class{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return P.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:et(s.createTime)}}(t)),P.resolve()}getNamedQuery(e,t){return P.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:v_(s.bundledQuery),readTime:et(s.readTime)}}(t)),P.resolve()}};var hg=class{constructor(){this.overlays=new Be(j.comparator),this.Ir=new Map}getOverlay(e,t){return P.resolve(this.overlays.get(t))}getOverlays(e,t){let n=Wn();return P.forEach(t,s=>this.getOverlay(e,s).next(r=>{r!==null&&n.set(s,r)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((s,r)=>{this.ht(e,t,r)}),P.resolve()}removeOverlaysForBatchId(e,t,n){let s=this.Ir.get(n);return s!==void 0&&(s.forEach(r=>this.overlays=this.overlays.remove(r)),this.Ir.delete(n)),P.resolve()}getOverlaysForCollection(e,t,n){let s=Wn(),r=t.length+1,o=new j(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===r&&c.largestBatchId>n&&s.set(c.getKey(),c)}return P.resolve(s)}getOverlaysForCollectionGroup(e,t,n,s){let r=new Be((u,d)=>u-d),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>n){let d=r.get(u.largestBatchId);d===null&&(d=Wn(),r=r.insert(u.largestBatchId,d)),d.set(u.getKey(),u)}}let a=Wn(),c=r.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((u,d)=>a.set(u,d)),!(a.size()>=s)););return P.resolve(a)}ht(e,t,n){let s=this.overlays.get(n.key);if(s!==null){let o=this.Ir.get(s.largestBatchId).delete(n.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(n.key,new nl(t,n));let r=this.Ir.get(t);r===void 0&&(r=ce(),this.Ir.set(t,r)),this.Ir.set(t,r.add(n.key))}};var dg=class{constructor(){this.sessionToken=tt.EMPTY_BYTE_STRING}getSessionToken(e){return P.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,P.resolve()}};var ll=class{constructor(){this.Tr=new Oe(rt.Er),this.dr=new Oe(rt.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){let n=new rt(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Vr(new rt(e,t))}mr(e,t){e.forEach(n=>this.removeReference(n,t))}gr(e){let t=new j(new ve([])),n=new rt(t,e),s=new rt(t,e+1),r=[];return this.dr.forEachInRange([n,s],o=>{this.Vr(o),r.push(o.key)}),r}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){let t=new j(new ve([])),n=new rt(t,e),s=new rt(t,e+1),r=ce();return this.dr.forEachInRange([n,s],o=>{r=r.add(o.key)}),r}containsKey(e){let t=new rt(e,0),n=this.Tr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}},rt=class{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return j.comparator(e.key,t.key)||ie(e.wr,t.wr)}static Ar(e,t){return ie(e.wr,t.wr)||j.comparator(e.key,t.key)}};var fg=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Oe(rt.Er)}checkEmpty(e){return P.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,s){let r=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new tl(r,t,n,s);this.mutationQueue.push(o);for(let a of s)this.br=this.br.add(new rt(a.key,r)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return P.resolve(o)}lookupMutationBatch(e,t){return P.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){let n=t+1,s=this.vr(n),r=s<0?0:s;return P.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new rt(t,0),s=new rt(t,Number.POSITIVE_INFINITY),r=[];return this.br.forEachInRange([n,s],o=>{let a=this.Dr(o.wr);r.push(a)}),P.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Oe(ie);return t.forEach(s=>{let r=new rt(s,0),o=new rt(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([r,o],a=>{n=n.add(a.wr)})}),P.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,s=n.length+1,r=n;j.isDocumentKey(r)||(r=r.child(""));let o=new rt(new j(r),0),a=new Oe(ie);return this.br.forEachWhile(c=>{let u=c.key.path;return!!n.isPrefixOf(u)&&(u.length===s&&(a=a.add(c.wr)),!0)},o),P.resolve(this.Cr(a))}Cr(e){let t=[];return e.forEach(n=>{let s=this.Dr(n);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){Q(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let n=this.br;return P.forEach(t.mutations,s=>{let r=new rt(s.key,t.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){let n=new rt(t,0),s=this.br.firstAfterOrEqual(n);return P.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,P.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){let t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var pg=class{constructor(e){this.Mr=e,this.docs=function(){return new Be(j.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,s=this.docs.get(n),r=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-r,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return P.resolve(n?n.document.mutableCopy():at.newInvalidDocument(t))}getEntries(e,t){let n=Gt();return t.forEach(s=>{let r=this.docs.get(s);n=n.insert(s,r?r.document.mutableCopy():at.newInvalidDocument(s))}),P.resolve(n)}getDocumentsMatchingQuery(e,t,n,s){let r=Gt(),o=t.path,a=new j(o.child("")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){let{key:u,value:{document:d}}=c.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||u_(AI(d),n)<=0||(s.has(d.key)||yl(t,d))&&(r=r.insert(d.key,d.mutableCopy()))}return P.resolve(r)}getAllFromCollectionGroup(e,t,n,s){K()}Or(e,t){return P.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new mg(this)}getSize(e){return P.resolve(this.size)}},mg=class extends sh{constructor(e){super(),this.cr=e}applyChanges(e){let t=[];return this.changes.forEach((n,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(n)}),P.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}};var gg=class{constructor(e){this.persistence=e,this.Nr=new Yn(t=>Gs(t),gl),this.lastRemoteSnapshotVersion=J.min(),this.highestTargetId=0,this.Lr=0,this.Br=new ll,this.targetCount=0,this.kr=so.Bn()}forEachTarget(e,t){return this.Nr.forEach((n,s)=>t(s)),P.resolve()}getLastRemoteSnapshotVersion(e){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return P.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),P.resolve()}Kn(e){this.Nr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.kr=new so(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,P.resolve()}updateTargetData(e,t){return this.Kn(t),P.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,P.resolve()}removeTargets(e,t,n){let s=0,r=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&n.get(a.targetId)===null&&(this.Nr.delete(o),r.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),P.waitFor(r).next(()=>s)}getTargetCount(e){return P.resolve(this.targetCount)}getTargetData(e,t){let n=this.Nr.get(t)||null;return P.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),P.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);let s=this.persistence.referenceDelegate,r=[];return s&&t.forEach(o=>{r.push(s.markPotentiallyOrphaned(e,o))}),P.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),P.resolve()}getMatchingKeysForTargetId(e,t){let n=this.Br.yr(t);return P.resolve(n)}containsKey(e,t){return P.resolve(this.Br.containsKey(t))}};var oh=class{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Yt(0),this.Kr=!1,this.Kr=!0,this.$r=new dg,this.referenceDelegate=e(this),this.Ur=new gg(this),this.indexManager=new eg,this.remoteDocumentCache=function(s){return new pg(s)}(n=>this.referenceDelegate.Wr(n)),this.serializer=new Ju(t),this.Gr=new ug(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new hg,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new fg(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){k("MemoryPersistence","Starting transaction:",e);let s=new _g(this.Qr.next());return this.referenceDelegate.zr(),n(s).next(r=>this.referenceDelegate.jr(s).next(()=>r)).toPromise().then(r=>(s.raiseOnCommittedEvent(),r))}Hr(e,t){return P.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}},_g=class extends Bu{constructor(e){super(),this.currentSequenceNumber=e}},ah=class i{constructor(e){this.persistence=e,this.Jr=new ll,this.Yr=null}static Zr(e){return new i(e)}get Xr(){if(this.Yr)return this.Yr;throw K()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),P.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),P.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),P.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(r=>this.Xr.add(r.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.Xr,n=>{let s=j.fromPath(n);return this.ei(e,s).next(r=>{r||t.removeEntry(s,J.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(n=>{n?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return P.or([()=>P.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}};var yg=class{constructor(e){this.serializer=e}O(e,t,n,s){let r=new Uu("createOrUpgrade",t);n<1&&s>=1&&(function(c){c.createObjectStore("owner")}(e),function(c){c.createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",IT,{unique:!0}),c.createObjectStore("documentMutations")}(e),lI(e),function(c){c.createObjectStore("remoteDocuments")}(e));let o=P.resolve();return n<3&&s>=3&&(n!==0&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(e),lI(e)),o=o.next(()=>function(c){let u=c.store("targetGlobal"),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:J.min().toTimestamp(),targetCount:0};return u.put("targetGlobalKey",d)}(r))),n<4&&s>=4&&(n!==0&&(o=o.next(()=>function(c,u){return u.store("mutations").U().next(d=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",IT,{unique:!0});let f=u.store("mutations"),m=d.map(_=>f.put(_));return P.waitFor(m)})}(e,r))),o=o.next(()=>{(function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),n<5&&s>=5&&(o=o.next(()=>this.ni(r))),n<6&&s>=6&&(o=o.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(e),this.ri(r)))),n<7&&s>=7&&(o=o.next(()=>this.ii(r))),n<8&&s>=8&&(o=o.next(()=>this.si(e,r))),n<9&&s>=9&&(o=o.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),n<10&&s>=10&&(o=o.next(()=>this.oi(r))),n<11&&s>=11&&(o=o.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&s>=12&&(o=o.next(()=>{(function(c){let u=c.createObjectStore("documentOverlays",{keyPath:$P});u.createIndex("collectionPathOverlayIndex",YP,{unique:!1}),u.createIndex("collectionGroupOverlayIndex",JP,{unique:!1})})(e)})),n<13&&s>=13&&(o=o.next(()=>function(c){let u=c.createObjectStore("remoteDocumentsV14",{keyPath:VP});u.createIndex("documentKeyIndex",BP),u.createIndex("collectionGroupIndex",UP)}(e)).next(()=>this._i(e,r)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&s>=14&&(o=o.next(()=>this.ai(e,r))),n<15&&s>=15&&(o=o.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:zP}).createIndex("sequenceNumberIndex",KP,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:HP}).createIndex("documentKeyIndex",QP,{unique:!1})}(e))),n<16&&s>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),n<17&&s>=17&&(o=o.next(()=>{(function(c){c.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((n,s)=>{t+=nh(s)}).next(()=>{let n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}ni(e){let t=e.store("mutationQueues"),n=e.store("mutations");return t.U().next(s=>P.forEach(s,r=>{let o=IDBKeyRange.bound([r.userId,-1],[r.userId,r.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",o).next(a=>P.forEach(a,c=>{Q(c.userId===r.userId);let u=Ms(this.serializer,c);return CC(e,r.userId,u).next(()=>{})}))}))}ii(e){let t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{let r=[];return n.J((o,a)=>{let c=new ve(o),u=function(f){return[0,Vt(f)]}(c);r.push(t.get(u).next(d=>d?P.resolve():(f=>t.put({targetId:0,path:Vt(f),sequenceNumber:s.highestListenSequenceNumber}))(c)))}).next(()=>P.waitFor(r))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:WP});let n=t.store("collectionParents"),s=new al,r=o=>{if(s.add(o)){let a=o.lastSegment(),c=o.popLast();return n.put({collectionId:a,parent:Vt(c)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{let c=new ve(o);return r(c.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,c],u)=>{let d=Gn(a);return r(d.popLast())}))}oi(e){let t=e.store("targets");return t.J((n,s)=>{let r=ja(s),o=wC(this.serializer,r);return t.put(o)})}_i(e,t){let n=t.store("remoteDocuments"),s=[];return n.J((r,o)=>{let a=t.store("remoteDocumentsV14"),c=function(f){return f.document?new j(ve.fromString(f.document.name).popFirst(5)):f.noDocument?j.fromSegments(f.noDocument.path):f.unknownDocument?j.fromSegments(f.unknownDocument.path):K()}(o).path.toArray(),u={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(u))}).next(()=>P.waitFor(s))}ai(e,t){let n=t.store("mutations"),s=AC(this.serializer),r=new oh(ah.Zr,this.serializer.ct);return n.U().next(o=>{let a=new Map;return o.forEach(c=>{var u;let d=(u=a.get(c.userId))!==null&&u!==void 0?u:ce();Ms(this.serializer,c).keys().forEach(f=>d=d.add(f)),a.set(c.userId,d)}),P.forEach(a,(c,u)=>{let d=new ot(u),f=Zu.lt(this.serializer,d),m=r.getIndexManager(d),_=ih.lt(d,this.serializer,m,r.referenceDelegate);return new rh(s,_,f,m).recalculateAndSaveOverlaysForDocumentKeys(new Ya(t,Yt.oe),c).next()})})}};function lI(i){i.createObjectStore("targetDocuments",{keyPath:jP}).createIndex("documentTargetsIndex",GP,{unique:!0}),i.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",qP,{unique:!0}),i.createObjectStore("targetGlobal")}var om="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",vg=class i{constructor(e,t,n,s,r,o,a,c,u,d,f=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.ui=r,this.window=o,this.document=a,this.ci=u,this.li=d,this.hi=f,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=m=>Promise.resolve(),!i.D())throw new O(x.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new og(this,s),this.Ai=t+"main",this.serializer=new Ju(c),this.Ri=new Xi(this.Ai,this.hi,new yg(this.serializer)),this.$r=new Hm,this.Ur=new ng(this.referenceDelegate,this.serializer),this.remoteDocumentCache=AC(this.serializer),this.Gr=new Km,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,d===!1&&Xe("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new O(x.FAILED_PRECONDITION,om);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new Yt(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=t=>D(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(t=>D(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(()=>D(this,null,function*(){this.started&&(yield this.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Pu(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(ls(e))return k("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return k("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return Ua(e).get("owner").next(t=>P.resolve(this.vi(t)))}Ci(e){return Pu(e).delete(this.clientId)}Fi(){return D(this,null,function*(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let n=dt(t,"clientMetadata");return n.U().next(s=>{let r=this.xi(s,18e5),o=s.filter(a=>r.indexOf(a)===-1);return P.forEach(o,a=>n.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(let t of e)this.Vi.removeItem(this.Oi(t.clientId))}})}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?P.resolve(!0):Ua(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new O(x.FAILED_PRECONDITION,om);return!1}}return!(!this.networkEnabled||!this.inForeground)||Pu(e).U().next(n=>this.xi(n,5e3).find(s=>{if(this.clientId!==s.clientId){let r=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(r||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&k("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return D(this,null,function*(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),yield this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new Ya(e,Yt.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()})}xi(e,t){return e.filter(n=>this.Mi(n.updateTimeMs,t)&&!this.Ni(n.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>Pu(e).U().next(t=>this.xi(t,18e5).map(n=>n.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return ih.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new tg(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Zu.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,n){k("IndexedDbPersistence","Starting transaction:",e);let s=t==="readonly"?"readonly":"readwrite",r=function(c){return c===17?eN:c===16?ZP:c===15?d_:c===14?kI:c===13?OI:c===12?XP:c===11?DI:void K()}(this.hi),o;return this.Ri.runTransaction(e,s,r,a=>(o=new Ya(a,this.Qr?this.Qr.next():Yt.oe),t==="readwrite-primary"?this.wi(o).next(c=>!!c||this.Si(o)).next(c=>{if(!c)throw Xe(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new O(x.FAILED_PRECONDITION,RI);return n(o)}).next(c=>this.Di(o).next(()=>c)):this.Ki(o).next(()=>n(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return Ua(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new O(x.FAILED_PRECONDITION,om)})}Di(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Ua(e).put("owner",t)}static D(){return Xi.D()}bi(e){let t=Ua(e);return t.get("owner").next(n=>this.vi(n)?(k("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):P.resolve())}Mi(e,t){let n=Date.now();return!(e<n-t)&&(!(e>n)||(Xe(`Detected an update time that is in the future: ${e} > ${n}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();let t=/(?:Version|Mobile)\/1[456]/;Zd()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{let n=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return k("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return Xe("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){Xe("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function Ua(i){return dt(i,"owner")}function Pu(i){return dt(i,"clientMetadata")}function w_(i,e){let t=i.projectId;return i.isDefaultDatabase||(t+="."+i.database),"firestore/"+e+"/"+t+"/"}var Eg=class i{constructor(e,t,n,s){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=s}static Wi(e,t){let n=ce(),s=ce();for(let r of t.docChanges)switch(r.type){case 0:n=n.add(r.doc.key);break;case 1:s=s.add(r.doc.key)}return new i(e,t.fromCache,n,s)}};var wg=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var lh=class{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return Zd()?8:PI(ea())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,s){let r={result:null};return this.Yi(e,t).next(o=>{r.result=o}).next(()=>{if(!r.result)return this.Zi(e,t,s,n).next(o=>{r.result=o})}).next(()=>{if(r.result)return;let o=new wg;return this.Xi(e,t,o).next(a=>{if(r.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>r.result)}es(e,t,n,s){return n.documentReadCount<this.ji?(qr()<=cn.DEBUG&&k("QueryEngine","SDK will not create cache indexes for query:",jr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),P.resolve()):(qr()<=cn.DEBUG&&k("QueryEngine","Query:",jr(t),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.Hi*s?(qr()<=cn.DEBUG&&k("QueryEngine","The SDK decides to create cache indexes for query:",jr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Bt(t))):P.resolve())}Yi(e,t){if(MT(t))return P.resolve(null);let n=Bt(t);return this.indexManager.getIndexType(e,n).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=Hu(t,null,"F"),n=Bt(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{let o=ce(...r);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,n).next(c=>{let u=this.ts(t,a);return this.ns(t,u,o,c.readTime)?this.Yi(e,Hu(t,null,"F")):this.rs(e,u,t,c)}))})))}Zi(e,t,n,s){return MT(t)||s.isEqual(J.min())?P.resolve(null):this.Ji.getDocuments(e,n).next(r=>{let o=this.ts(t,r);return this.ns(t,o,n,s)?P.resolve(null):(qr()<=cn.DEBUG&&k("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),jr(t)),this.rs(e,o,t,bI(s,-1)).next(a=>a))})}ts(e,t){let n=new Oe(QI(e));return t.forEach((s,r)=>{yl(e,r)&&(n=n.add(r))}),n}ns(e,t,n,s){if(e.limit===null)return!1;if(n.size!==t.size)return!0;let r=e.limitType==="F"?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(s)>0)}Xi(e,t,n){return qr()<=cn.DEBUG&&k("QueryEngine","Using full collection scan to execute query:",jr(t)),this.Ji.getDocumentsMatchingQuery(e,t,pn.min(),n)}rs(e,t,n,s){return this.Ji.getDocumentsMatchingQuery(e,n,s).next(r=>(t.forEach(o=>{r=r.insert(o.key,o)}),r))}};var Tg=class{constructor(e,t,n,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new Be(ie),this._s=new Yn(r=>Gs(r),gl),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new rh(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}};function RC(i,e,t,n){return new Tg(i,e,t,n)}function PC(i,e){return D(this,null,function*(){let t=q(i);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let s;return t.mutationQueue.getAllMutationBatches(n).next(r=>(s=r,t.ls(e),t.mutationQueue.getAllMutationBatches(n))).next(r=>{let o=[],a=[],c=ce();for(let u of s){o.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}for(let u of r){a.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}return t.localDocuments.getDocuments(n,c).next(u=>({hs:u,removedBatchIds:o,addedBatchIds:a}))})})})}function ON(i,e){let t=q(i);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let s=e.batch.keys(),r=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,c,u,d){let f=u.batch,m=f.keys(),_=P.resolve();return m.forEach(v=>{_=_.next(()=>d.getEntry(c,v)).next(C=>{let R=u.docVersions.get(v);Q(R!==null),C.version.compareTo(R)<0&&(f.applyToRemoteDocument(C,u),C.isValidDocument()&&(C.setReadTime(u.commitVersion),d.addEntry(C)))})}),_.next(()=>a.mutationQueue.removeMutationBatch(c,f))}(t,n,e,r).next(()=>r.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(a){let c=ce();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(c=c.add(a.batch.mutations[u].key));return c}(e))).next(()=>t.localDocuments.getDocuments(n,s))})}function NC(i){let e=q(i);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function kN(i,e){let t=q(i),n=e.snapshotVersion,s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",r=>{let o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;let a=[];e.targetChanges.forEach((d,f)=>{let m=s.get(f);if(!m)return;a.push(t.Ur.removeMatchingKeys(r,d.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(r,d.addedDocuments,f)));let _=m.withSequenceNumber(r.currentSequenceNumber);e.targetMismatches.get(f)!==null?_=_.withResumeToken(tt.EMPTY_BYTE_STRING,J.min()).withLastLimboFreeSnapshotVersion(J.min()):d.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(d.resumeToken,n)),s=s.insert(f,_),function(C,R,F){return C.resumeToken.approximateByteSize()===0||R.snapshotVersion.toMicroseconds()-C.snapshotVersion.toMicroseconds()>=3e8?!0:F.addedDocuments.size+F.modifiedDocuments.size+F.removedDocuments.size>0}(m,_,d)&&a.push(t.Ur.updateTargetData(r,_))});let c=Gt(),u=ce();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(r,d))}),a.push(xC(r,o,e.documentUpdates).next(d=>{c=d.Ps,u=d.Is})),!n.isEqual(J.min())){let d=t.Ur.getLastRemoteSnapshotVersion(r).next(f=>t.Ur.setTargetsMetadata(r,r.currentSequenceNumber,n));a.push(d)}return P.waitFor(a).next(()=>o.apply(r)).next(()=>t.localDocuments.getLocalViewOfDocuments(r,c,u)).next(()=>c)}).then(r=>(t.os=s,r))}function xC(i,e,t){let n=ce(),s=ce();return t.forEach(r=>n=n.add(r)),e.getEntries(i,n).next(r=>{let o=Gt();return t.forEach((a,c)=>{let u=r.get(a);c.isFoundDocument()!==u.isFoundDocument()&&(s=s.add(a)),c.isNoDocument()&&c.version.isEqual(J.min())?(e.removeEntry(a,c.readTime),o=o.insert(a,c)):!u.isValidDocument()||c.version.compareTo(u.version)>0||c.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(c),o=o.insert(a,c)):k("LocalStore","Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",c.version)}),{Ps:o,Is:s}})}function MN(i,e){let t=q(i);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function ro(i,e){let t=q(i);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let s;return t.Ur.getTargetData(n,e).next(r=>r?(s=r,P.resolve(s)):t.Ur.allocateTargetId(n).next(o=>(s=new io(e,o,"TargetPurposeListen",n.currentSequenceNumber),t.Ur.addTargetData(n,s).next(()=>s))))}).then(n=>{let s=t.os.get(n.targetId);return(s===null||n.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(n.targetId,n),t._s.set(e,n.targetId)),n})}function oo(i,e,t){return D(this,null,function*(){let n=q(i),s=n.os.get(e),r=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",r,o=>n.persistence.referenceDelegate.removeTarget(o,s)))}catch(o){if(!ls(o))throw o;k("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}n.os=n.os.remove(e),n._s.delete(s.target)})}function ch(i,e,t){let n=q(i),s=J.min(),r=ce();return n.persistence.runTransaction("Execute query","readwrite",o=>function(c,u,d){let f=q(c),m=f._s.get(d);return m!==void 0?P.resolve(f.os.get(m)):f.Ur.getTargetData(u,d)}(n,o,Bt(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(o,a.targetId).next(c=>{r=c})}).next(()=>n.ss.getDocumentsMatchingQuery(o,e,t?s:J.min(),t?r:ce())).next(a=>(kC(n,HI(e),a),{documents:a,Ts:r})))}function DC(i,e){let t=q(i),n=q(t.Ur),s=t.os.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",r=>n.ot(r,e).next(o=>o?o.target:null))}function OC(i,e){let t=q(i),n=t.us.get(e)||J.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.cs.getAllFromCollectionGroup(s,e,bI(n,-1),Number.MAX_SAFE_INTEGER)).then(s=>(kC(t,e,s),s))}function kC(i,e,t){let n=i.us.get(e)||J.min();t.forEach((s,r)=>{r.readTime.compareTo(n)>0&&(n=r.readTime)}),i.us.set(e,n)}function FN(i,e,t,n){return D(this,null,function*(){let s=q(i),r=ce(),o=Gt();for(let u of t){let d=e.Es(u.metadata.name);u.document&&(r=r.add(d));let f=e.ds(u);f.setReadTime(e.As(u.metadata.readTime)),o=o.insert(d,f)}let a=s.cs.newChangeBuffer({trackRemovals:!0}),c=yield ro(s,function(d){return Bt(mo(ve.fromString(`__bundle__/docs/${d}`)))}(n));return s.persistence.runTransaction("Apply bundle documents","readwrite",u=>xC(u,a,o).next(d=>(a.apply(u),d)).next(d=>s.Ur.removeMatchingKeysForTargetId(u,c.targetId).next(()=>s.Ur.addMatchingKeys(u,r,c.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(u,d.Ps,d.Is)).next(()=>d.Ps)))})}function LN(n,s){return D(this,arguments,function*(i,e,t=ce()){let r=yield ro(i,Bt(v_(e.bundledQuery))),o=q(i);return o.persistence.runTransaction("Save named query","readwrite",a=>{let c=et(e.readTime);if(r.snapshotVersion.compareTo(c)>=0)return o.Gr.saveNamedQuery(a,e);let u=r.withResumeToken(tt.EMPTY_BYTE_STRING,c);return o.os=o.os.insert(u.targetId,u),o.Ur.updateTargetData(a,u).next(()=>o.Ur.removeMatchingKeysForTargetId(a,r.targetId)).next(()=>o.Ur.addMatchingKeys(a,t,r.targetId)).next(()=>o.Gr.saveNamedQuery(a,e))})})}function cI(i,e){return`firestore_clients_${i}_${e}`}function uI(i,e,t){let n=`firestore_mutations_${i}_${t}`;return e.isAuthenticated()&&(n+=`_${e.uid}`),n}function am(i,e){return`firestore_targets_${i}_${e}`}var uh=class i{constructor(e,t,n,s){this.user=e,this.batchId=t,this.state=n,this.error=s}static Rs(e,t,n){let s=JSON.parse(n),r,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(r=new O(s.error.code,s.error.message))),o?new i(e,t,s.state,r):(Xe("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Ka=class i{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Rs(e,t){let n=JSON.parse(t),s,r=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return r&&n.error&&(r=typeof n.error.message=="string"&&typeof n.error.code=="string",r&&(s=new O(n.error.code,n.error.message))),r?new i(e,n.state,s):(Xe("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},hh=class i{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){let n=JSON.parse(t),s=typeof n=="object"&&n.activeTargetIds instanceof Array,r=g_();for(let o=0;s&&o<n.activeTargetIds.length;++o)s=NI(n.activeTargetIds[o]),r=r.add(n.activeTargetIds[o]);return s?new i(e,r):(Xe("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},Ig=class i{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new i(t.clientId,t.onlineState):(Xe("SharedClientState",`Failed to parse online state: ${e}`),null)}},cl=class{constructor(){this.activeTargetIds=g_()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},Ha=class{constructor(e,t,n,s,r){this.window=e,this.ui=t,this.persistenceKey=n,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Be(ie),this.started=!1,this.bs=[];let o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=r,this.Ds=cI(this.persistenceKey,this.ps),this.vs=function(c){return`firestore_sequence_number_${c}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new cl),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(c){return`firestore_online_state_${c}`}(this.persistenceKey),this.Os=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}start(){return D(this,null,function*(){let e=yield this.syncEngine.Qi();for(let n of e){if(n===this.ps)continue;let s=this.getItem(cI(this.persistenceKey,n));if(s){let r=hh.Rs(n,s);r&&(this.Ss=this.Ss.insert(r.clientId,r))}}this.Ns();let t=this.storage.getItem(this.xs);if(t){let n=this.Ls(t);n&&this.Bs(n)}for(let n of this.bs)this.ws(n);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((n,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,n){this.qs(e,t,n),this.Qs(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){let s=this.storage.getItem(am(this.persistenceKey,e));if(s){let r=Ka.Rs(e,s);r&&(n=r.state)}}return t&&this.Ks.fs(e),this.Ns(),n}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(am(this.persistenceKey,e))}updateQueryState(e,t,n){this.$s(e,t,n)}handleUserChange(e,t,n){t.forEach(s=>{this.Qs(s)}),this.currentUser=e,n.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return k("SharedClientState","READ",e,t),t}setItem(e,t){k("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){k("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){let t=e;if(t.storageArea===this.storage){if(k("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void Xe("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(()=>D(this,null,function*(){if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){let n=this.Gs(t.key);return this.zs(n,null)}{let n=this.js(t.key,t.newValue);if(n)return this.zs(n.clientId,n)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){let n=this.Hs(t.key,t.newValue);if(n)return this.Js(n)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){let n=this.Ys(t.key,t.newValue);if(n)return this.Zs(n)}}else if(t.key===this.xs){if(t.newValue!==null){let n=this.Ls(t.newValue);if(n)return this.Bs(n)}}else if(t.key===this.vs){let n=function(r){let o=Yt.oe;if(r!=null)try{let a=JSON.parse(r);Q(typeof a=="number"),o=a}catch(a){Xe("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);n!==Yt.oe&&this.sequenceNumberHandler(n)}else if(t.key===this.Os){let n=this.Xs(t.newValue);yield Promise.all(n.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(t)}))}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,n){let s=new uh(this.currentUser,e,t,n),r=uI(this.persistenceKey,this.currentUser,e);this.setItem(r,s.Vs())}Qs(e){let t=uI(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){let t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,n){let s=am(this.persistenceKey,e),r=new Ka(e,t,n);this.setItem(s,r.Vs())}Ws(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){let t=this.Cs.exec(e);return t?t[1]:null}js(e,t){let n=this.Gs(e);return hh.Rs(n,t)}Hs(e,t){let n=this.Fs.exec(e),s=Number(n[1]),r=n[2]!==void 0?n[2]:null;return uh.Rs(new ot(r),s,t)}Ys(e,t){let n=this.Ms.exec(e),s=Number(n[1]);return Ka.Rs(s,t)}Ls(e){return Ig.Rs(e)}Xs(e){return JSON.parse(e)}Js(e){return D(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);k("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){let n=t?this.Ss.insert(e,t):this.Ss.remove(e),s=this.ks(this.Ss),r=this.ks(n),o=[],a=[];return r.forEach(c=>{s.has(c)||o.push(c)}),s.forEach(c=>{r.has(c)||a.push(c)}),this.syncEngine.io(o,a).then(()=>{this.Ss=n})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=g_();return e.forEach((n,s)=>{t=t.unionWith(s.activeTargetIds)}),t}},dh=class{constructor(){this.so=new cl,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new cl,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Cg=class{_o(e){}shutdown(){}};var fh=class{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){k("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.ho)e(0)}lo(){k("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Nu=null;function lm(){return Nu===null?Nu=function(){return 268435456+Math.round(2147483648*Math.random())}():Nu++,"0x"+Nu.toString(16)}var VN={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var Sg=class{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}};var At="WebChannelConnection",bg=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let n=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+t.host,this.vo=`projects/${s}/databases/${r}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${r}`}get Fo(){return!1}Mo(t,n,s,r,o){let a=lm(),c=this.xo(t,n.toUriEncodedString());k("RestConnection",`Sending RPC '${t}' ${a}:`,c,s);let u={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(u,r,o),this.No(t,c,u,s).then(d=>(k("RestConnection",`Received RPC '${t}' ${a}: `,d),d),d=>{throw bn("RestConnection",`RPC '${t}' ${a} failed with error: `,d,"url: ",c,"request:",s),d})}Lo(t,n,s,r,o,a){return this.Mo(t,n,s,r,o)}Oo(t,n,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+po}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((r,o)=>t[o]=r),s&&s.headers.forEach((r,o)=>t[o]=r)}xo(t,n){let s=VN[t];return`${this.Do}/v1/${n}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,s){let r=lm();return new Promise((o,a)=>{let c=new em;c.setWithCredentials(!0),c.listenOnce(tm.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Fa.NO_ERROR:let d=c.getResponseJson();k(At,`XHR for RPC '${e}' ${r} received:`,JSON.stringify(d)),o(d);break;case Fa.TIMEOUT:k(At,`RPC '${e}' ${r} timed out`),a(new O(x.DEADLINE_EXCEEDED,"Request time out"));break;case Fa.HTTP_ERROR:let f=c.getStatus();if(k(At,`RPC '${e}' ${r} failed with status:`,f,"response text:",c.getResponseText()),f>0){let m=c.getResponseJson();Array.isArray(m)&&(m=m[0]);let _=m?.error;if(_&&_.status&&_.message){let v=function(R){let F=R.toLowerCase().replace(/_/g,"-");return Object.values(x).indexOf(F)>=0?F:x.UNKNOWN}(_.status);a(new O(v,_.message))}else a(new O(x.UNKNOWN,"Server responded with status "+c.getStatus()))}else a(new O(x.UNAVAILABLE,"Connection failed."));break;default:K()}}finally{k(At,`RPC '${e}' ${r} completed.`)}});let u=JSON.stringify(s);k(At,`RPC '${e}' ${r} sending request:`,s),c.send(t,"POST",u,n,15)})}Bo(e,t,n){let s=lm(),r=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=sm(),a=im(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(c.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Oo(c.initMessageHeaders,t,n),c.encodeInitMessageHeaders=!0;let d=r.join("");k(At,`Creating RPC '${e}' stream ${s}: ${d}`,c);let f=o.createWebChannel(d,c),m=!1,_=!1,v=new Sg({Io:R=>{_?k(At,`Not sending because RPC '${e}' stream ${s} is closed:`,R):(m||(k(At,`Opening RPC '${e}' stream ${s} transport.`),f.open(),m=!0),k(At,`RPC '${e}' stream ${s} sending:`,R),f.send(R))},To:()=>f.close()}),C=(R,F,V)=>{R.listen(F,B=>{try{V(B)}catch($){setTimeout(()=>{throw $},0)}})};return C(f,Fr.EventType.OPEN,()=>{_||(k(At,`RPC '${e}' stream ${s} transport opened.`),v.yo())}),C(f,Fr.EventType.CLOSE,()=>{_||(_=!0,k(At,`RPC '${e}' stream ${s} transport closed`),v.So())}),C(f,Fr.EventType.ERROR,R=>{_||(_=!0,bn(At,`RPC '${e}' stream ${s} transport errored:`,R),v.So(new O(x.UNAVAILABLE,"The operation could not be completed")))}),C(f,Fr.EventType.MESSAGE,R=>{var F;if(!_){let V=R.data[0];Q(!!V);let B=V,$=B.error||((F=B[0])===null||F===void 0?void 0:F.error);if($){k(At,`RPC '${e}' stream ${s} received error:`,$);let le=$.status,Z=function(w){let I=st[w];if(I!==void 0)return aC(I)}(le),T=$.message;Z===void 0&&(Z=x.INTERNAL,T="Unknown error status: "+le+" with message "+$.message),_=!0,v.So(new O(Z,T)),f.close()}else k(At,`RPC '${e}' stream ${s} received:`,V),v.bo(V)}}),C(a,nm.STAT_EVENT,R=>{R.stat===bu.PROXY?k(At,`RPC '${e}' stream ${s} detected buffering proxy`):R.stat===bu.NOPROXY&&k(At,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{v.wo()},0),v}};function MC(){return typeof window<"u"?window:null}function Mu(){return typeof document<"u"?document:null}function vl(i){return new qm(i,!0)}var ul=class{constructor(e,t,n=1e3,s=1.5,r=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=s,this.Qo=r,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();let t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-n);s>0&&k("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}};var ph=class{constructor(e,t,n,s,r,o,a,c){this.ui=e,this.Ho=n,this.Jo=s,this.connection=r,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new ul(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}stop(){return D(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){return D(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){return D(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===x.RESOURCE_EXHAUSTED?(Xe(t.toString()),Xe("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===x.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.mo(t)})}l_(){}auth(){this.state=1;let e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,s])=>{this.Yo===t&&this.P_(n,s)},n=>{e(()=>{let s=new O(x.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(s)})})}P_(e,t){let n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{n(()=>this.I_(s))}),this.stream.onMessage(s=>{n(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(()=>D(this,null,function*(){this.state=0,this.start()}))}I_(e){return k("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(k("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Ag=class extends ph{constructor(e,t,n,s,r,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,s,o),this.serializer=r}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();let t=TN(this.serializer,e),n=function(r){if(!("targetChange"in r))return J.min();let o=r.targetChange;return o.targetIds&&o.targetIds.length?J.min():o.readTime?et(o.readTime):J.min()}(e);return this.listener.d_(t,n)}A_(e){let t={};t.database=Wm(this.serializer),t.addTarget=function(r,o){let a,c=o.target;if(a=zu(c)?{documents:mC(r,c)}:{query:gC(r,c)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=cC(r,o.resumeToken);let u=jm(r,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(J.min())>0){a.readTime=no(r,o.snapshotVersion.toTimestamp());let u=jm(r,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);let n=CN(this.serializer,e);n&&(t.labels=n),this.a_(t)}R_(e){let t={};t.database=Wm(this.serializer),t.removeTarget=e,this.a_(t)}},Rg=class extends ph{constructor(e,t,n,s,r,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,s,o),this.serializer=r}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Q(!!e.streamToken),this.lastStreamToken=e.streamToken,Q(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Q(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();let t=IN(e.writeResults,e.commitTime),n=et(e.commitTime);return this.listener.g_(n,t)}p_(){let e={};e.database=Wm(this.serializer),this.a_(e)}m_(e){let t={streamToken:this.lastStreamToken,writes:e.map(n=>ol(this.serializer,n))};this.a_(t)}};var Pg=class extends class{}{constructor(e,t,n,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new O(x.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,o])=>this.connection.Mo(e,Gm(t,n),s,r,o)).catch(r=>{throw r.name==="FirebaseError"?(r.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new O(x.UNKNOWN,r.toString())})}Lo(e,t,n,s,r){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,Gm(t,n),s,o,a,r)).catch(o=>{throw o.name==="FirebaseError"?(o.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new O(x.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}},Ng=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Xe(t),this.D_=!1):k("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}};var xg=class{constructor(e,t,n,s,r){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=r,this.k_._o(o=>{n.enqueueAndForget(()=>D(this,null,function*(){cs(this)&&(k("RemoteStore","Restarting streams for network reachability change."),yield function(c){return D(this,null,function*(){let u=q(c);u.L_.add(4),yield go(u),u.q_.set("Unknown"),u.L_.delete(4),yield El(u)})}(this))}))}),this.q_=new Ng(n,s)}};function El(i){return D(this,null,function*(){if(cs(i))for(let e of i.B_)yield e(!0)})}function go(i){return D(this,null,function*(){for(let e of i.B_)yield e(!1)})}function Mh(i,e){let t=q(i);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),C_(t)?I_(t):yo(t).r_()&&T_(t,e))}function ao(i,e){let t=q(i),n=yo(t);t.N_.delete(e),n.r_()&&FC(t,e),t.N_.size===0&&(n.r_()?n.o_():cs(t)&&t.q_.set("Unknown"))}function T_(i,e){if(i.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(J.min())>0){let t=i.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}yo(i).A_(e)}function FC(i,e){i.Q_.xe(e),yo(i).R_(e)}function I_(i){i.Q_=new Um({getRemoteKeysForTarget:e=>i.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>i.N_.get(e)||null,tt:()=>i.datastore.serializer.databaseId}),yo(i).start(),i.q_.v_()}function C_(i){return cs(i)&&!yo(i).n_()&&i.N_.size>0}function cs(i){return q(i).L_.size===0}function LC(i){i.Q_=void 0}function BN(i){return D(this,null,function*(){i.q_.set("Online")})}function UN(i){return D(this,null,function*(){i.N_.forEach((e,t)=>{T_(i,e)})})}function qN(i,e){return D(this,null,function*(){LC(i),C_(i)?(i.q_.M_(e),I_(i)):i.q_.set("Unknown")})}function jN(i,e,t){return D(this,null,function*(){if(i.q_.set("Online"),e instanceof $u&&e.state===2&&e.cause)try{yield function(s,r){return D(this,null,function*(){let o=r.cause;for(let a of r.targetIds)s.N_.has(a)&&(yield s.remoteSyncer.rejectListen(a,o),s.N_.delete(a),s.Q_.removeTarget(a))})}(i,e)}catch(n){k("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield mh(i,n)}else if(e instanceof $r?i.Q_.Ke(e):e instanceof Qu?i.Q_.He(e):i.Q_.We(e),!t.isEqual(J.min()))try{let n=yield NC(i.localStore);t.compareTo(n)>=0&&(yield function(r,o){let a=r.Q_.rt(o);return a.targetChanges.forEach((c,u)=>{if(c.resumeToken.approximateByteSize()>0){let d=r.N_.get(u);d&&r.N_.set(u,d.withResumeToken(c.resumeToken,o))}}),a.targetMismatches.forEach((c,u)=>{let d=r.N_.get(c);if(!d)return;r.N_.set(c,d.withResumeToken(tt.EMPTY_BYTE_STRING,d.snapshotVersion)),FC(r,c);let f=new io(d.target,c,u,d.sequenceNumber);T_(r,f)}),r.remoteSyncer.applyRemoteEvent(a)}(i,t))}catch(n){k("RemoteStore","Failed to raise snapshot:",n),yield mh(i,n)}})}function mh(i,e,t){return D(this,null,function*(){if(!ls(e))throw e;i.L_.add(1),yield go(i),i.q_.set("Offline"),t||(t=()=>NC(i.localStore)),i.asyncQueue.enqueueRetryable(()=>D(this,null,function*(){k("RemoteStore","Retrying IndexedDB access"),yield t(),i.L_.delete(1),yield El(i)}))})}function VC(i,e){return e().catch(t=>mh(i,t,e))}function _o(i){return D(this,null,function*(){let e=q(i),t=os(e),n=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;GN(e);)try{let s=yield MN(e.localStore,n);if(s===null){e.O_.length===0&&t.o_();break}n=s.batchId,WN(e,s)}catch(s){yield mh(e,s)}BC(e)&&UC(e)})}function GN(i){return cs(i)&&i.O_.length<10}function WN(i,e){i.O_.push(e);let t=os(i);t.r_()&&t.V_&&t.m_(e.mutations)}function BC(i){return cs(i)&&!os(i).n_()&&i.O_.length>0}function UC(i){os(i).start()}function zN(i){return D(this,null,function*(){os(i).p_()})}function KN(i){return D(this,null,function*(){let e=os(i);for(let t of i.O_)e.m_(t.mutations)})}function HN(i,e,t){return D(this,null,function*(){let n=i.O_.shift(),s=Lm.from(n,e,t);yield VC(i,()=>i.remoteSyncer.applySuccessfulWrite(s)),yield _o(i)})}function QN(i,e){return D(this,null,function*(){e&&os(i).V_&&(yield function(n,s){return D(this,null,function*(){if(function(o){return oC(o)&&o!==x.ABORTED}(s.code)){let r=n.O_.shift();os(n).s_(),yield VC(n,()=>n.remoteSyncer.rejectFailedWrite(r.batchId,s)),yield _o(n)}})}(i,e)),BC(i)&&UC(i)})}function hI(i,e){return D(this,null,function*(){let t=q(i);t.asyncQueue.verifyOperationInProgress(),k("RemoteStore","RemoteStore received new credentials");let n=cs(t);t.L_.add(3),yield go(t),n&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield El(t)})}function Dg(i,e){return D(this,null,function*(){let t=q(i);e?(t.L_.delete(2),yield El(t)):e||(t.L_.add(2),yield go(t),t.q_.set("Unknown"))})}function yo(i){return i.K_||(i.K_=function(t,n,s){let r=q(t);return r.w_(),new Ag(n,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,s)}(i.datastore,i.asyncQueue,{Eo:BN.bind(null,i),Ro:UN.bind(null,i),mo:qN.bind(null,i),d_:jN.bind(null,i)}),i.B_.push(e=>D(this,null,function*(){e?(i.K_.s_(),C_(i)?I_(i):i.q_.set("Unknown")):(yield i.K_.stop(),LC(i))}))),i.K_}function os(i){return i.U_||(i.U_=function(t,n,s){let r=q(t);return r.w_(),new Rg(n,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,s)}(i.datastore,i.asyncQueue,{Eo:()=>Promise.resolve(),Ro:zN.bind(null,i),mo:QN.bind(null,i),f_:KN.bind(null,i),g_:HN.bind(null,i)}),i.B_.push(e=>D(this,null,function*(){e?(i.U_.s_(),yield _o(i)):(yield i.U_.stop(),i.O_.length>0&&(k("RemoteStore",`Stopping write stream with ${i.O_.length} pending writes`),i.O_=[]))}))),i.U_}var Og=class i{constructor(e,t,n,s,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=s,this.removalCallback=r,this.deferred=new ht,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,s,r){let o=Date.now()+n,a=new i(e,t,o,s,r);return a.start(n),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new O(x.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function vo(i,e){if(Xe("AsyncQueue",`${e}: ${i}`),ls(i))return new O(x.UNAVAILABLE,`${e}: ${i}`);throw i}var gh=class i{constructor(e){this.comparator=e?(t,n)=>e(t,n)||j.comparator(t.key,n.key):(t,n)=>j.comparator(t.key,n.key),this.keyedMap=qa(),this.sortedSet=new Be(this.comparator)}static emptySet(e){return new i(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof i)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let s=t.getNext().key,r=n.getNext().key;if(!s.isEqual(r))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let n=new i;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}};var _h=class{constructor(){this.W_=new Be(j.comparator)}track(e){let t=e.doc.key,n=this.W_.get(t);n?e.type!==0&&n.type===3?this.W_=this.W_.insert(t,e):e.type===3&&n.type!==1?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.W_=this.W_.remove(t):e.type===1&&n.type===2?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):K():this.W_=this.W_.insert(t,e)}G_(){let e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}},lo=class i{constructor(e,t,n,s,r,o,a,c,u){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=r,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=u}static fromInitialDocuments(e,t,n,s,r){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new i(e,t,gh.emptySet(t),o,n,s,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&_l(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==n[s].type||!t[s].doc.isEqual(n[s].doc))return!1;return!0}};var kg=class{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}},Mg=class{constructor(){this.queries=dI(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,n){let s=q(t),r=s.queries;s.queries=dI(),r.forEach((o,a)=>{for(let c of a.j_)c.onError(n)})})(this,new O(x.ABORTED,"Firestore shutting down"))}};function dI(){return new Yn(i=>KI(i),_l)}function S_(i,e){return D(this,null,function*(){let t=q(i),n=3,s=e.query,r=t.queries.get(s);r?!r.H_()&&e.J_()&&(n=2):(r=new kg,n=e.J_()?0:1);try{switch(n){case 0:r.z_=yield t.onListen(s,!0);break;case 1:r.z_=yield t.onListen(s,!1);break;case 2:yield t.onFirstRemoteStoreListen(s)}}catch(o){let a=vo(o,`Initialization of query '${jr(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,r),r.j_.push(e),e.Z_(t.onlineState),r.z_&&e.X_(r.z_)&&A_(t)})}function b_(i,e){return D(this,null,function*(){let t=q(i),n=e.query,s=3,r=t.queries.get(n);if(r){let o=r.j_.indexOf(e);o>=0&&(r.j_.splice(o,1),r.j_.length===0?s=e.J_()?0:1:!r.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})}function $N(i,e){let t=q(i),n=!1;for(let s of e){let r=s.query,o=t.queries.get(r);if(o){for(let a of o.j_)a.X_(s)&&(n=!0);o.z_=s}}n&&A_(t)}function YN(i,e,t){let n=q(i),s=n.queries.get(e);if(s)for(let r of s.j_)r.onError(t);n.queries.delete(e)}function A_(i){i.Y_.forEach(e=>{e.next()})}var Fg,fI;(fI=Fg||(Fg={})).ea="default",fI.Cache="cache";var hl=class{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){let n=[];for(let s of e.docChanges)s.type!==3&&n.push(s);e=new lo(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;let n=t!=="Offline";return(!this.options._a||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;let t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=lo.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Fg.Cache}};var Lg=class{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}};var yh=class{constructor(e){this.serializer=e}Es(e){return Kn(this.serializer,e)}ds(e){return e.metadata.exists?pC(this.serializer,e.document,!1):at.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return et(e)}},Vg=class{constructor(e,t,n){this.ca=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=qC(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;let n=ve.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){let t=new Map,n=new yh(this.serializer);for(let s of e)if(s.metadata.queries){let r=n.Es(s.metadata.name);for(let o of s.metadata.queries){let a=(t.get(o)||ce()).add(r);t.set(o,a)}}return t}complete(){return D(this,null,function*(){let e=yield FN(this.localStore,new yh(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(let n of this.queries)yield LN(this.localStore,n,t.get(n.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}})}};function qC(i){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:i.totalDocuments,totalBytes:i.totalBytes}}var vh=class{constructor(e){this.key=e}},Eh=class{constructor(e){this.key=e}},wh=class{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=ce(),this.mutatedKeys=ce(),this.Aa=QI(e),this.Ra=new gh(this.Aa)}get Va(){return this.Ta}ma(e,t){let n=t?t.fa:new _h,s=t?t.Ra:this.Ra,r=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1,c=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,u=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((d,f)=>{let m=s.get(d),_=yl(this.query,f)?f:null,v=!!m&&this.mutatedKeys.has(m.key),C=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations),R=!1;m&&_?m.data.isEqual(_.data)?v!==C&&(n.track({type:3,doc:_}),R=!0):this.ga(m,_)||(n.track({type:2,doc:_}),R=!0,(c&&this.Aa(_,c)>0||u&&this.Aa(_,u)<0)&&(a=!0)):!m&&_?(n.track({type:0,doc:_}),R=!0):m&&!_&&(n.track({type:1,doc:m}),R=!0,(c||u)&&(a=!0)),R&&(_?(o=o.add(_),r=C?r.add(d):r.delete(d)):(o=o.delete(d),r=r.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),r=r.delete(d.key),n.track({type:1,doc:d})}return{Ra:o,fa:n,ns:a,mutatedKeys:r}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,s){let r=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;let o=e.fa.G_();o.sort((d,f)=>function(_,v){let C=R=>{switch(R){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return K()}};return C(_)-C(v)}(d.type,f.type)||this.Aa(d.doc,f.doc)),this.pa(n),s=s!=null&&s;let a=t&&!s?this.ya():[],c=this.da.size===0&&this.current&&!s?1:0,u=c!==this.Ea;return this.Ea=c,o.length!==0||u?{snapshot:new lo(this.query,e.Ra,r,o,e.mutatedKeys,c===0,u,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new _h,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];let e=this.da;this.da=ce(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});let t=[];return e.forEach(n=>{this.da.has(n)||t.push(new Eh(n))}),this.da.forEach(n=>{e.has(n)||t.push(new vh(n))}),t}ba(e){this.Ta=e.Ts,this.da=ce();let t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return lo.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}},Bg=class{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}},Ug=class{constructor(e){this.key=e,this.va=!1}},qg=class{constructor(e,t,n,s,r,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=s,this.currentUser=r,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Yn(a=>KI(a),_l),this.Ma=new Map,this.xa=new Set,this.Oa=new Be(j.comparator),this.Na=new Map,this.La=new ll,this.Ba={},this.ka=new Map,this.qa=so.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}};function JN(i,e,t=!0){return D(this,null,function*(){let n=Fh(i),s,r=n.Fa.get(e);return r?(n.sharedClientState.addLocalQueryTarget(r.targetId),s=r.view.Da()):s=yield jC(n,e,t,!0),s})}function XN(i,e){return D(this,null,function*(){let t=Fh(i);yield jC(t,e,!0,!1)})}function jC(i,e,t,n){return D(this,null,function*(){let s=yield ro(i.localStore,Bt(e)),r=s.targetId,o=i.sharedClientState.addLocalQueryTarget(r,t),a;return n&&(a=yield R_(i,e,r,o==="current",s.resumeToken)),i.isPrimaryClient&&t&&Mh(i.remoteStore,s),a})}function R_(i,e,t,n,s){return D(this,null,function*(){i.Ka=(f,m,_)=>function(C,R,F,V){return D(this,null,function*(){let B=R.view.ma(F);B.ns&&(B=yield ch(C.localStore,R.query,!1).then(({documents:T})=>R.view.ma(T,B)));let $=V&&V.targetChanges.get(R.targetId),le=V&&V.targetMismatches.get(R.targetId)!=null,Z=R.view.applyChanges(B,C.isPrimaryClient,$,le);return jg(C,R.targetId,Z.wa),Z.snapshot})}(i,f,m,_);let r=yield ch(i.localStore,e,!0),o=new wh(e,r.Ts),a=o.ma(r.documents),c=sl.createSynthesizedTargetChangeForCurrentChange(t,n&&i.onlineState!=="Offline",s),u=o.applyChanges(a,i.isPrimaryClient,c);jg(i,t,u.wa);let d=new Bg(e,t,o);return i.Fa.set(e,d),i.Ma.has(t)?i.Ma.get(t).push(e):i.Ma.set(t,[e]),u.snapshot})}function ZN(i,e,t){return D(this,null,function*(){let n=q(i),s=n.Fa.get(e),r=n.Ma.get(s.targetId);if(r.length>1)return n.Ma.set(s.targetId,r.filter(o=>!_l(o,e))),void n.Fa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||(yield oo(n.localStore,s.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(s.targetId),t&&ao(n.remoteStore,s.targetId),co(n,s.targetId)}).catch(as))):(co(n,s.targetId),yield oo(n.localStore,s.targetId,!0))})}function ex(i,e){return D(this,null,function*(){let t=q(i),n=t.Fa.get(e),s=t.Ma.get(n.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),ao(t.remoteStore,n.targetId))})}function tx(i,e,t){return D(this,null,function*(){let n=D_(i);try{let s=yield function(o,a){let c=q(o),u=We.now(),d=a.reduce((_,v)=>_.add(v.key),ce()),f,m;return c.persistence.runTransaction("Locally write mutations","readwrite",_=>{let v=Gt(),C=ce();return c.cs.getEntries(_,d).next(R=>{v=R,v.forEach((F,V)=>{V.isValidDocument()||(C=C.add(F))})}).next(()=>c.localDocuments.getOverlayedDocuments(_,v)).next(R=>{f=R;let F=[];for(let V of a){let B=mN(V,f.get(V.key).overlayedDocument);B!=null&&F.push(new Rn(V.key,B,BI(B.value.mapValue),Ye.exists(!0)))}return c.mutationQueue.addMutationBatch(_,u,F,a)}).next(R=>{m=R;let F=R.applyToLocalDocumentSet(f,C);return c.documentOverlayCache.saveOverlays(_,R.batchId,F)})}).then(()=>({batchId:m.batchId,changes:YI(f)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(s.batchId),function(o,a,c){let u=o.Ba[o.currentUser.toKey()];u||(u=new Be(ie)),u=u.insert(a,c),o.Ba[o.currentUser.toKey()]=u}(n,s.batchId,t),yield Ei(n,s.changes),yield _o(n.remoteStore)}catch(s){let r=vo(s,"Failed to persist write");t.reject(r)}})}function GC(i,e){return D(this,null,function*(){let t=q(i);try{let n=yield kN(t.localStore,e);e.targetChanges.forEach((s,r)=>{let o=t.Na.get(r);o&&(Q(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?Q(o.va):s.removedDocuments.size>0&&(Q(o.va),o.va=!1))}),yield Ei(t,n,e)}catch(n){yield as(n)}})}function pI(i,e,t){let n=q(i);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){let s=[];n.Fa.forEach((r,o)=>{let a=o.view.Z_(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){let c=q(o);c.onlineState=a;let u=!1;c.queries.forEach((d,f)=>{for(let m of f.j_)m.Z_(a)&&(u=!0)}),u&&A_(c)}(n.eventManager,e),s.length&&n.Ca.d_(s),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function nx(i,e,t){return D(this,null,function*(){let n=q(i);n.sharedClientState.updateQueryState(e,"rejected",t);let s=n.Na.get(e),r=s&&s.key;if(r){let o=new Be(j.comparator);o=o.insert(r,at.newNoDocument(r,J.min()));let a=ce().add(r),c=new il(J.min(),new Map,new Be(ie),o,a);yield GC(n,c),n.Oa=n.Oa.remove(r),n.Na.delete(e),x_(n)}else yield oo(n.localStore,e,!1).then(()=>co(n,e,t)).catch(as)})}function ix(i,e){return D(this,null,function*(){let t=q(i),n=e.batch.batchId;try{let s=yield ON(t.localStore,e);N_(t,n,null),P_(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield Ei(t,s)}catch(s){yield as(s)}})}function sx(i,e,t){return D(this,null,function*(){let n=q(i);try{let s=yield function(o,a){let c=q(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let d;return c.mutationQueue.lookupMutationBatch(u,a).next(f=>(Q(f!==null),d=f.keys(),c.mutationQueue.removeMutationBatch(u,f))).next(()=>c.mutationQueue.performConsistencyCheck(u)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(u,d,a)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,d)).next(()=>c.localDocuments.getDocuments(u,d))})}(n.localStore,e);N_(n,e,t),P_(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield Ei(n,s)}catch(s){yield as(s)}})}function rx(i,e){return D(this,null,function*(){let t=q(i);cs(t.remoteStore)||k("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let n=yield function(o){let a=q(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>a.mutationQueue.getHighestUnacknowledgedBatchId(c))}(t.localStore);if(n===-1)return void e.resolve();let s=t.ka.get(n)||[];s.push(e),t.ka.set(n,s)}catch(n){let s=vo(n,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}})}function P_(i,e){(i.ka.get(e)||[]).forEach(t=>{t.resolve()}),i.ka.delete(e)}function N_(i,e,t){let n=q(i),s=n.Ba[n.currentUser.toKey()];if(s){let r=s.get(e);r&&(t?r.reject(t):r.resolve(),s=s.remove(e)),n.Ba[n.currentUser.toKey()]=s}}function co(i,e,t=null){i.sharedClientState.removeLocalQueryTarget(e);for(let n of i.Ma.get(e))i.Fa.delete(n),t&&i.Ca.$a(n,t);i.Ma.delete(e),i.isPrimaryClient&&i.La.gr(e).forEach(n=>{i.La.containsKey(n)||WC(i,n)})}function WC(i,e){i.xa.delete(e.path.canonicalString());let t=i.Oa.get(e);t!==null&&(ao(i.remoteStore,t),i.Oa=i.Oa.remove(e),i.Na.delete(t),x_(i))}function jg(i,e,t){for(let n of t)n instanceof vh?(i.La.addReference(n.key,e),ox(i,n)):n instanceof Eh?(k("SyncEngine","Document no longer in limbo: "+n.key),i.La.removeReference(n.key,e),i.La.containsKey(n.key)||WC(i,n.key)):K()}function ox(i,e){let t=e.key,n=t.path.canonicalString();i.Oa.get(t)||i.xa.has(n)||(k("SyncEngine","New document in limbo: "+t),i.xa.add(n),x_(i))}function x_(i){for(;i.xa.size>0&&i.Oa.size<i.maxConcurrentLimboResolutions;){let e=i.xa.values().next().value;i.xa.delete(e);let t=new j(ve.fromString(e)),n=i.qa.next();i.Na.set(n,new Ug(t)),i.Oa=i.Oa.insert(t,n),Mh(i.remoteStore,new io(Bt(mo(t.path)),n,"TargetPurposeLimboResolution",Yt.oe))}}function Ei(i,e,t){return D(this,null,function*(){let n=q(i),s=[],r=[],o=[];n.Fa.isEmpty()||(n.Fa.forEach((a,c)=>{o.push(n.Ka(c,e,t).then(u=>{var d;if((u||t)&&n.isPrimaryClient){let f=u?!u.fromCache:(d=t?.targetChanges.get(c.targetId))===null||d===void 0?void 0:d.current;n.sharedClientState.updateQueryState(c.targetId,f?"current":"not-current")}if(u){s.push(u);let f=Eg.Wi(c.targetId,u);r.push(f)}}))}),yield Promise.all(o),n.Ca.d_(s),yield function(c,u){return D(this,null,function*(){let d=q(c);try{yield d.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>P.forEach(u,m=>P.forEach(m.$i,_=>d.persistence.referenceDelegate.addReference(f,m.targetId,_)).next(()=>P.forEach(m.Ui,_=>d.persistence.referenceDelegate.removeReference(f,m.targetId,_)))))}catch(f){if(!ls(f))throw f;k("LocalStore","Failed to update sequence numbers: "+f)}for(let f of u){let m=f.targetId;if(!f.fromCache){let _=d.os.get(m),v=_.snapshotVersion,C=_.withLastLimboFreeSnapshotVersion(v);d.os=d.os.insert(m,C)}}})}(n.localStore,r))})}function ax(i,e){return D(this,null,function*(){let t=q(i);if(!t.currentUser.isEqual(e)){k("SyncEngine","User change. New user:",e.toKey());let n=yield PC(t.localStore,e);t.currentUser=e,function(r,o){r.ka.forEach(a=>{a.forEach(c=>{c.reject(new O(x.CANCELLED,o))})}),r.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield Ei(t,n.hs)}})}function lx(i,e){let t=q(i),n=t.Na.get(e);if(n&&n.va)return ce().add(n.key);{let s=ce(),r=t.Ma.get(e);if(!r)return s;for(let o of r){let a=t.Fa.get(o);s=s.unionWith(a.view.Va)}return s}}function cx(i,e){return D(this,null,function*(){let t=q(i),n=yield ch(t.localStore,e.query,!0),s=e.view.ba(n);return t.isPrimaryClient&&jg(t,e.targetId,s.wa),s})}function ux(i,e){return D(this,null,function*(){let t=q(i);return OC(t.localStore,e).then(n=>Ei(t,n))})}function hx(i,e,t,n){return D(this,null,function*(){let s=q(i),r=yield function(a,c){let u=q(a),d=q(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",f=>d.Mn(f,c).next(m=>m?u.localDocuments.getDocuments(f,m):P.resolve(null)))}(s.localStore,e);r!==null?(t==="pending"?yield _o(s.remoteStore):t==="acknowledged"||t==="rejected"?(N_(s,e,n||null),P_(s,e),function(a,c){q(q(a).mutationQueue).On(c)}(s.localStore,e)):K(),yield Ei(s,r)):k("SyncEngine","Cannot apply mutation batch with id: "+e)})}function dx(i,e){return D(this,null,function*(){let t=q(i);if(Fh(t),D_(t),e===!0&&t.Qa!==!0){let n=t.sharedClientState.getAllActiveQueryTargets(),s=yield mI(t,n.toArray());t.Qa=!0,yield Dg(t.remoteStore,!0);for(let r of s)Mh(t.remoteStore,r)}else if(e===!1&&t.Qa!==!1){let n=[],s=Promise.resolve();t.Ma.forEach((r,o)=>{t.sharedClientState.isLocalQueryTarget(o)?n.push(o):s=s.then(()=>(co(t,o),oo(t.localStore,o,!0))),ao(t.remoteStore,o)}),yield s,yield mI(t,n),function(o){let a=q(o);a.Na.forEach((c,u)=>{ao(a.remoteStore,u)}),a.La.pr(),a.Na=new Map,a.Oa=new Be(j.comparator)}(t),t.Qa=!1,yield Dg(t.remoteStore,!1)}})}function mI(i,e,t){return D(this,null,function*(){let n=q(i),s=[],r=[];for(let o of e){let a,c=n.Ma.get(o);if(c&&c.length!==0){a=yield ro(n.localStore,Bt(c[0]));for(let u of c){let d=n.Fa.get(u),f=yield cx(n,d);f.snapshot&&r.push(f.snapshot)}}else{let u=yield DC(n.localStore,o);a=yield ro(n.localStore,u),yield R_(n,zC(u),o,!1,a.resumeToken)}s.push(a)}return n.Ca.d_(r),s})}function zC(i){return zI(i.path,i.collectionGroup,i.orderBy,i.filters,i.limit,"F",i.startAt,i.endAt)}function fx(i){return function(t){return q(q(t).persistence).Qi()}(q(i).localStore)}function px(i,e,t,n){return D(this,null,function*(){let s=q(i);if(s.Qa)return void k("SyncEngine","Ignoring unexpected query state notification.");let r=s.Ma.get(e);if(r&&r.length>0)switch(t){case"current":case"not-current":{let o=yield OC(s.localStore,HI(r[0])),a=il.createSynthesizedRemoteEventForCurrentChange(e,t==="current",tt.EMPTY_BYTE_STRING);yield Ei(s,o,a);break}case"rejected":yield oo(s.localStore,e,!0),co(s,e,n);break;default:K()}})}function mx(i,e,t){return D(this,null,function*(){let n=Fh(i);if(n.Qa){for(let s of e){if(n.Ma.has(s)&&n.sharedClientState.isActiveQueryTarget(s)){k("SyncEngine","Adding an already active target "+s);continue}let r=yield DC(n.localStore,s),o=yield ro(n.localStore,r);yield R_(n,zC(r),o.targetId,!1,o.resumeToken),Mh(n.remoteStore,o)}for(let s of t)n.Ma.has(s)&&(yield oo(n.localStore,s,!1).then(()=>{ao(n.remoteStore,s),co(n,s)}).catch(as))}})}function Fh(i){let e=q(i);return e.remoteStore.remoteSyncer.applyRemoteEvent=GC.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=lx.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=nx.bind(null,e),e.Ca.d_=$N.bind(null,e.eventManager),e.Ca.$a=YN.bind(null,e.eventManager),e}function D_(i){let e=q(i);return e.remoteStore.remoteSyncer.applySuccessfulWrite=ix.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=sx.bind(null,e),e}function gx(i,e,t){let n=q(i);(function(r,o,a){return D(this,null,function*(){try{let c=yield o.getMetadata();if(yield function(_,v){let C=q(_),R=et(v.createTime);return C.persistence.runTransaction("hasNewerBundle","readonly",F=>C.Gr.getBundleMetadata(F,v.id)).then(F=>!!F&&F.createTime.compareTo(R)>=0)}(r.localStore,c))return yield o.close(),a._completeWith(function(_){return{taskState:"Success",documentsLoaded:_.totalDocuments,bytesLoaded:_.totalBytes,totalDocuments:_.totalDocuments,totalBytes:_.totalBytes}}(c)),Promise.resolve(new Set);a._updateProgress(qC(c));let u=new Vg(c,r.localStore,o.serializer),d=yield o.Ua();for(;d;){let m=yield u.la(d);m&&a._updateProgress(m),d=yield o.Ua()}let f=yield u.complete();return yield Ei(r,f.Ia,void 0),yield function(_,v){let C=q(_);return C.persistence.runTransaction("Save bundle","readwrite",R=>C.Gr.saveBundleMetadata(R,v))}(r.localStore,c),a._completeWith(f.progress),Promise.resolve(f.Pa)}catch(c){return bn("SyncEngine",`Loading bundle failed with ${c}`),a._failWith(c),Promise.resolve(new Set)}})})(n,e,t).then(s=>{n.sharedClientState.notifyBundleLoaded(s)})}var Gg=(()=>{class i{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return D(this,null,function*(){this.serializer=vl(t.databaseInfo.databaseId),this.sharedClientState=this.Wa(t),this.persistence=this.Ga(t),yield this.persistence.start(),this.localStore=this.za(t),this.gcScheduler=this.ja(t,this.localStore),this.indexBackfillerScheduler=this.Ha(t,this.localStore)})}ja(t,n){return null}Ha(t,n){return null}za(t){return RC(this.persistence,new lh,t.initialUser,this.serializer)}Ga(t){return new oh(ah.Zr,this.serializer)}Wa(t){return new dh}terminate(){return D(this,null,function*(){var t,n;(t=this.gcScheduler)===null||t===void 0||t.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return i.provider={build:()=>new i},i})();var Th=class i extends Gg{constructor(e,t,n){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return D(this,null,function*(){yield Kd(i.prototype,this,"initialize").call(this,e),yield this.Ja.initialize(this,e),yield D_(this.Ja.syncEngine),yield _o(this.Ja.remoteStore),yield this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}za(e){return RC(this.persistence,new lh,e.initialUser,this.serializer)}ja(e,t){let n=this.persistence.referenceDelegate.garbageCollector;return new sg(n,e.asyncQueue,t)}Ha(e,t){let n=new wm(t,this.persistence);return new Em(e.asyncQueue,n)}Ga(e){let t=w_(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?fn.withCacheSize(this.cacheSizeBytes):fn.DEFAULT;return new vg(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,MC(),Mu(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new dh}},Wg=class i extends Th{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return D(this,null,function*(){yield Kd(i.prototype,this,"initialize").call(this,e);let t=this.Ja.syncEngine;this.sharedClientState instanceof Ha&&(this.sharedClientState.syncEngine={no:hx.bind(null,t),ro:px.bind(null,t),io:mx.bind(null,t),Qi:fx.bind(null,t),eo:ux.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.yi(n=>D(this,null,function*(){yield dx(this.Ja.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())}))})}Wa(e){let t=MC();if(!Ha.D(t))throw new O(x.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=w_(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Ha(t,e.asyncQueue,n,e.clientId,e.initialUser)}},O_=(()=>{class i{initialize(t,n){return D(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>pI(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=ax.bind(null,this.syncEngine),yield Dg(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new Mg}()}createDatastore(t){let n=vl(t.databaseInfo.databaseId),s=function(o){return new bg(o)}(t.databaseInfo);return function(o,a,c,u){return new Pg(o,a,c,u)}(t.authCredentials,t.appCheckCredentials,s,n)}createRemoteStore(t){return function(s,r,o,a,c){return new xg(s,r,o,a,c)}(this.localStore,this.datastore,t.asyncQueue,n=>pI(this.syncEngine,n,0),function(){return fh.D()?new fh:new Cg}())}createSyncEngine(t,n){return function(r,o,a,c,u,d,f){let m=new qg(r,o,a,c,u,d);return f&&(m.Qa=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,n)}terminate(){return D(this,null,function*(){var t,n;yield function(r){return D(this,null,function*(){let o=q(r);k("RemoteStore","RemoteStore shutting down."),o.L_.add(5),yield go(o),o.k_.shutdown(),o.q_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()})}}return i.provider={build:()=>new i},i})();function gI(i,e=10240){let t=0;return{read(){return D(this,null,function*(){if(t<i.byteLength){let s={value:i.slice(t,t+e),done:!1};return t+=e,s}return{done:!0}})},cancel(){return D(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var uo=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Xe("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var zg=class{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new ht,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(n=>{n&&n.ua()?this.metadata.resolve(n.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(n?.aa)}`))},n=>this.metadata.reject(n))}close(){return this.Xa.cancel()}getMetadata(){return D(this,null,function*(){return this.metadata.promise})}Ua(){return D(this,null,function*(){return yield this.getMetadata(),this.tu()})}tu(){return D(this,null,function*(){let e=yield this.nu();if(e===null)return null;let t=this.eu.decode(e),n=Number(t);isNaN(n)&&this.ru(`length string (${t}) is not valid number`);let s=yield this.iu(n);return new Lg(JSON.parse(s),e.length+n)})}su(){return this.buffer.findIndex(e=>e===123)}nu(){return D(this,null,function*(){for(;this.su()<0&&!(yield this.ou()););if(this.buffer.length===0)return null;let e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}iu(e){return D(this,null,function*(){for(;this.buffer.length<e;)(yield this.ou())&&this.ru("Reached the end of bundle when more is expected.");let t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}ou(){return D(this,null,function*(){let e=yield this.Xa.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var Kg=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return D(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new O(x.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(s,r){return D(this,null,function*(){let o=q(s),a={documents:r.map(f=>rl(o.serializer,f))},c=yield o.Lo("BatchGetDocuments",o.serializer.databaseId,ve.emptyPath(),a,r.length),u=new Map;c.forEach(f=>{let m=wN(o.serializer,f);u.set(m.key.toString(),m)});let d=[];return r.forEach(f=>{let m=u.get(f.toString());Q(!!m),d.push(m)}),d})}(this.datastore,e);return t.forEach(n=>this.recordVersion(n)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(e.toString())}delete(e){this.write(new rs(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return D(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,n)=>{let s=j.fromPath(n);this.mutations.push(new el(s,this.precondition(s)))}),yield function(n,s){return D(this,null,function*(){let r=q(n),o={writes:s.map(a=>ol(r.serializer,a))};yield r.Mo("Commit",r.serializer.databaseId,ve.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw K();t=J.min()}let n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new O(x.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(J.min())?Ye.exists(!1):Ye.updateTime(t):Ye.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(J.min()))throw new O(x.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ye.updateTime(t)}return Ye.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var Hg=class{constructor(e,t,n,s,r){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=s,this.deferred=r,this._u=n.maxAttempts,this.t_=new ul(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(()=>D(this,null,function*(){let e=new Kg(this.datastore),t=this.cu(e);t&&t.then(n=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(n)}).catch(s=>{this.lu(s)}))}).catch(n=>{this.lu(n)})}))}cu(e){try{let t=this.updateFunction(e);return!ml(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!oC(t)}return!1}};var Qg=class{constructor(e,t,n,s,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=s,this.user=ot.UNAUTHENTICATED,this.clientId=Lu.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=r,this.authCredentials.start(n,o=>D(this,null,function*(){k("FirestoreClient","Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(n,o=>(k("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new ht;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>D(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let n=vo(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}};function cm(i,e){return D(this,null,function*(){i.asyncQueue.verifyOperationInProgress(),k("FirestoreClient","Initializing OfflineComponentProvider");let t=i.configuration;yield e.initialize(t);let n=t.initialUser;i.setCredentialChangeListener(s=>D(this,null,function*(){n.isEqual(s)||(yield PC(e.localStore,s),n=s)})),e.persistence.setDatabaseDeletedListener(()=>i.terminate()),i._offlineComponents=e})}function _I(i,e){return D(this,null,function*(){i.asyncQueue.verifyOperationInProgress();let t=yield k_(i);k("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,i.configuration),i.setCredentialChangeListener(n=>hI(e.remoteStore,n)),i.setAppCheckTokenChangeListener((n,s)=>hI(e.remoteStore,s)),i._onlineComponents=e})}function k_(i){return D(this,null,function*(){if(!i._offlineComponents)if(i._uninitializedComponentsProvider){k("FirestoreClient","Using user provided OfflineComponentProvider");try{yield cm(i,i._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(s){return s.name==="FirebaseError"?s.code===x.FAILED_PRECONDITION||s.code===x.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;bn("Error using user provided cache. Falling back to memory cache: "+t),yield cm(i,new Gg)}}else k("FirestoreClient","Using default OfflineComponentProvider"),yield cm(i,new Gg);return i._offlineComponents})}function Lh(i){return D(this,null,function*(){return i._onlineComponents||(i._uninitializedComponentsProvider?(k("FirestoreClient","Using user provided OnlineComponentProvider"),yield _I(i,i._uninitializedComponentsProvider._online)):(k("FirestoreClient","Using default OnlineComponentProvider"),yield _I(i,new O_))),i._onlineComponents})}function KC(i){return k_(i).then(e=>e.persistence)}function M_(i){return k_(i).then(e=>e.localStore)}function HC(i){return Lh(i).then(e=>e.remoteStore)}function F_(i){return Lh(i).then(e=>e.syncEngine)}function _x(i){return Lh(i).then(e=>e.datastore)}function ho(i){return D(this,null,function*(){let e=yield Lh(i),t=e.eventManager;return t.onListen=JN.bind(null,e.syncEngine),t.onUnlisten=ZN.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=XN.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=ex.bind(null,e.syncEngine),t})}function yx(i){return i.asyncQueue.enqueue(()=>D(this,null,function*(){let e=yield KC(i),t=yield HC(i);return e.setNetworkEnabled(!0),function(s){let r=q(s);return r.L_.delete(0),El(r)}(t)}))}function vx(i){return i.asyncQueue.enqueue(()=>D(this,null,function*(){let e=yield KC(i),t=yield HC(i);return e.setNetworkEnabled(!1),function(s){return D(this,null,function*(){let r=q(s);r.L_.add(0),yield go(r),r.q_.set("Offline")})}(t)}))}function Ex(i,e){let t=new ht;return i.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(s,r,o){return D(this,null,function*(){try{let a=yield function(u,d){let f=q(u);return f.persistence.runTransaction("read document","readonly",m=>f.localDocuments.getDocument(m,d))}(s,r);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new O(x.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let c=vo(a,`Failed to get document '${r} from cache`);o.reject(c)}})}(yield M_(i),e,t)})),t.promise}function QC(i,e,t={}){let n=new ht;return i.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(r,o,a,c,u){let d=new uo({next:m=>{d.Za(),o.enqueueAndForget(()=>b_(r,f));let _=m.docs.has(a);!_&&m.fromCache?u.reject(new O(x.UNAVAILABLE,"Failed to get document because the client is offline.")):_&&m.fromCache&&c&&c.source==="server"?u.reject(new O(x.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(m)},error:m=>u.reject(m)}),f=new hl(mo(a.path),d,{includeMetadataChanges:!0,_a:!0});return S_(r,f)}(yield ho(i),i.asyncQueue,e,t,n)})),n.promise}function wx(i,e){let t=new ht;return i.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(s,r,o){return D(this,null,function*(){try{let a=yield ch(s,r,!0),c=new wh(r,a.Ts),u=c.ma(a.documents),d=c.applyChanges(u,!1);o.resolve(d.snapshot)}catch(a){let c=vo(a,`Failed to execute query '${r} against cache`);o.reject(c)}})}(yield M_(i),e,t)})),t.promise}function $C(i,e,t={}){let n=new ht;return i.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(r,o,a,c,u){let d=new uo({next:m=>{d.Za(),o.enqueueAndForget(()=>b_(r,f)),m.fromCache&&c.source==="server"?u.reject(new O(x.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(m)},error:m=>u.reject(m)}),f=new hl(a,d,{includeMetadataChanges:!0,_a:!0});return S_(r,f)}(yield ho(i),i.asyncQueue,e,t,n)})),n.promise}function Tx(i,e){let t=new uo(e);return i.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(s,r){q(s).Y_.add(r),r.next()}(yield ho(i),t)})),()=>{t.Za(),i.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(s,r){q(s).Y_.delete(r)}(yield ho(i),t)}))}}function Ix(i,e,t,n){let s=function(o,a){let c;return c=typeof o=="string"?lC().encode(o):o,function(d,f){return new zg(d,f)}(function(d,f){if(d instanceof Uint8Array)return gI(d,f);if(d instanceof ArrayBuffer)return gI(new Uint8Array(d),f);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),a)}(t,vl(e));i.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){gx(yield F_(i),s,n)}))}function Cx(i,e){return i.asyncQueue.enqueue(()=>D(this,null,function*(){return function(n,s){let r=q(n);return r.persistence.runTransaction("Get named query","readonly",o=>r.Gr.getNamedQuery(o,s))}(yield M_(i),e)}))}function YC(i){let e={};return i.timeoutSeconds!==void 0&&(e.timeoutSeconds=i.timeoutSeconds),e}var yI=new Map;function L_(i,e,t){if(!t)throw new O(x.INVALID_ARGUMENT,`Function ${i}() cannot be called with an empty ${e}.`)}function V_(i,e,t,n){if(e===!0&&n===!0)throw new O(x.INVALID_ARGUMENT,`${i} and ${t} cannot be used together.`)}function vI(i){if(!j.isDocumentKey(i))throw new O(x.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${i} has ${i.length}.`)}function EI(i){if(j.isDocumentKey(i))throw new O(x.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${i} has ${i.length}.`)}function Vh(i){if(i===void 0)return"undefined";if(i===null)return"null";if(typeof i=="string")return i.length>20&&(i=`${i.substring(0,20)}...`),JSON.stringify(i);if(typeof i=="number"||typeof i=="boolean")return""+i;if(typeof i=="object"){if(i instanceof Array)return"an array";{let e=function(n){return n.constructor?n.constructor.name:null}(i);return e?`a custom ${e} object`:"an object"}}return typeof i=="function"?"a function":K()}function we(i,e){if("_delegate"in i&&(i=i._delegate),!(i instanceof e)){if(e.name===i.constructor.name)throw new O(x.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Vh(i);throw new O(x.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return i}function JC(i,e){if(e<=0)throw new O(x.INVALID_ARGUMENT,`Function ${i}() requires a positive number, but it was: ${e}.`)}var Ih=class{constructor(e){var t,n;if(e.host===void 0){if(e.ssl!==void 0)throw new O(x.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new O(x.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}V_("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=YC((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new O(x.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new O(x.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new O(x.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,s){return n.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Hs=class{constructor(e,t,n,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ih({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new O(x.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new O(x.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ih(e),e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new um;switch(n.type){case"firstParty":return new pm(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new O(x.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return D(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let n=yI.get(t);n&&(k("ComponentProvider","Removing Datastore"),yI.delete(t),n.terminate())}(this),Promise.resolve()}};function XC(i,e,t,n={}){var s;let r=(i=we(i,Hs))._getSettings(),o=`${e}:${t}`;if(r.host!=="firestore.googleapis.com"&&r.host!==o&&bn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),i._setSettings(Object.assign(Object.assign({},r),{host:o,ssl:!1})),n.mockUserToken){let a,c;if(typeof n.mockUserToken=="string")a=n.mockUserToken,c=ot.MOCK_USER;else{a=hc(n.mockUserToken,(s=i._app)===null||s===void 0?void 0:s.options.projectId);let u=n.mockUserToken.sub||n.mockUserToken.user_id;if(!u)throw new O(x.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new ot(u)}i._authCredentials=new hm(new Fu(a,c))}}var vt=class i{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new i(this.firestore,e,this._query)}},Me=class i{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Hn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new i(this.firestore,e,this._key)}},Hn=class i extends vt{constructor(e,t,n){super(e,t,mo(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Me(this.firestore,null,new j(e))}withConverter(e){return new i(this.firestore,e,this._path)}};function B_(i,e,...t){if(i=ge(i),L_("collection","path",e),i instanceof Hs){let n=ve.fromString(e,...t);return EI(n),new Hn(i,null,n)}{if(!(i instanceof Me||i instanceof Hn))throw new O(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=i._path.child(ve.fromString(e,...t));return EI(n),new Hn(i.firestore,null,n)}}function ZC(i,e){if(i=we(i,Hs),L_("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new O(x.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new vt(i,null,function(n){return new An(ve.emptyPath(),n)}(e))}function wl(i,e,...t){if(i=ge(i),arguments.length===1&&(e=Lu.newId()),L_("doc","path",e),i instanceof Hs){let n=ve.fromString(e,...t);return vI(n),new Me(i,null,new j(n))}{if(!(i instanceof Me||i instanceof Hn))throw new O(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=i._path.child(ve.fromString(e,...t));return vI(n),new Me(i.firestore,i instanceof Hn?i.converter:null,new j(n))}}function U_(i,e){return i=ge(i),e=ge(e),(i instanceof Me||i instanceof Hn)&&(e instanceof Me||e instanceof Hn)&&i.firestore===e.firestore&&i.path===e.path&&i.converter===e.converter}function q_(i,e){return i=ge(i),e=ge(e),i instanceof vt&&e instanceof vt&&i.firestore===e.firestore&&_l(i._query,e._query)&&i.converter===e.converter}var Ch=class{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new ul(this,"async_queue_retry"),this.Vu=()=>{let n=Mu();n&&k("AsyncQueue","Visibility state changed to "+n.visibilityState),this.t_.jo()},this.mu=e;let t=Mu();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;let t=Mu();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});let t=new ht;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}pu(){return D(this,null,function*(){if(this.Pu.length!==0){try{yield this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!ls(e))throw e;k("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}})}gu(e){let t=this.mu.then(()=>(this.du=!0,e().catch(n=>{this.Eu=n,this.du=!1;let s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(n);throw Xe("INTERNAL UNHANDLED ERROR: ",s),n}).then(n=>(this.du=!1,n))));return this.mu=t,t}enqueueAfterDelay(e,t,n){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);let s=Og.createAndSchedule(this,e,t,n,r=>this.yu(r));return this.Tu.push(s),s}fu(){this.Eu&&K()}verifyOperationInProgress(){}wu(){return D(this,null,function*(){let e;do e=this.mu,yield e;while(e!==this.mu)})}Su(e){for(let t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(let t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){let t=this.Tu.indexOf(e);this.Tu.splice(t,1)}};function $g(i){return function(t,n){if(typeof t!="object"||t===null)return!1;let s=t;for(let r of n)if(r in s&&typeof s[r]=="function")return!0;return!1}(i,["next","error","complete"])}var Yg=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new ht,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var eS=-1,ze=class extends Hs{constructor(e,t,n,s){super(e,t,n,s),this.type="firestore",this._queue=new Ch,this._persistenceKey=s?.name||"[DEFAULT]"}_terminate(){return D(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new Ch(e),this._firestoreClient=void 0,yield e}})}};function Et(i){if(i._terminated)throw new O(x.FAILED_PRECONDITION,"The client has already been terminated.");return i._firestoreClient||tS(i),i._firestoreClient}function tS(i){var e,t,n;let s=i._freezeSettings(),r=function(a,c,u,d){return new Tm(a,c,u,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,YC(d.experimentalLongPollingOptions),d.useFetchStreams)}(i._databaseId,((e=i._app)===null||e===void 0?void 0:e.options.appId)||"",i._persistenceKey,s);i._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((n=s.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(i._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),i._firestoreClient=new Qg(i._authCredentials,i._appCheckCredentials,i._queue,r,i._componentsProvider&&function(a){let c=a?._online.build();return{_offline:a?._offline.build(c),_online:c}}(i._componentsProvider))}function nS(i,e){bn("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=i._freezeSettings();return sS(i,O_.provider,{build:n=>new Th(n,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}function iS(i){return D(this,null,function*(){bn("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=i._freezeSettings();sS(i,O_.provider,{build:t=>new Wg(t,e.cacheSizeBytes)})})}function sS(i,e,t){if((i=we(i,ze))._firestoreClient||i._terminated)throw new O(x.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(i._componentsProvider||i._getSettings().localCache)throw new O(x.FAILED_PRECONDITION,"SDK cache is already specified.");i._componentsProvider={_online:e,_offline:t},tS(i)}function rS(i){if(i._initialized&&!i._terminated)throw new O(x.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new ht;return i._queue.enqueueAndForgetEvenWhileRestricted(()=>D(this,null,function*(){try{yield function(n){return D(this,null,function*(){if(!Xi.D())return Promise.resolve();let s=n+"main";yield Xi.delete(s)})}(w_(i._databaseId,i._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function oS(i){return function(t){let n=new ht;return t.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return rx(yield F_(t),n)})),n.promise}(Et(i=we(i,ze)))}function aS(i){return yx(Et(i=we(i,ze)))}function lS(i){return vx(Et(i=we(i,ze)))}function cS(i,e){let t=Et(i=we(i,ze)),n=new Yg;return Ix(t,i._databaseId,e,n),n}function uS(i,e){return Cx(Et(i=we(i,ze)),e).then(t=>t?new vt(i,null,t.query):null)}var Jn=class i{constructor(e){this._byteString=e}static fromBase64String(e){try{return new i(tt.fromBase64String(e))}catch(t){throw new O(x.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new i(tt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var Pn=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new O(x.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ze(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var yi=class{constructor(e){this._methodName=e}};var Qs=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new O(x.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new O(x.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ie(this._lat,e._lat)||ie(this._long,e._long)}};var dl=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,s){if(n.length!==s.length)return!1;for(let r=0;r<n.length;++r)if(n[r]!==s[r])return!1;return!0}(this._values,e._values)}};var Sx=/^__.*__$/,Jg=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new Rn(e,this.data,this.fieldMask,t,this.fieldTransforms):new ss(e,this.data,t,this.fieldTransforms)}},Sh=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Rn(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function hS(i){switch(i){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw K()}}var bh=class i{constructor(e,t,n,s,r,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=s,r===void 0&&this.vu(),this.fieldTransforms=r||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new i(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:n,xu:!1});return s.Ou(e),s}Nu(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:n,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Ah(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(hS(this.Cu)&&Sx.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}},Xg=class{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||vl(e)}Qu(e,t,n,s=!1){return new bh({Cu:e,methodName:t,qu:n,path:Ze.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Xs(i){let e=i._freezeSettings(),t=vl(i._databaseId);return new Xg(i._databaseId,!!e.ignoreUndefinedProperties,t)}function Bh(i,e,t,n,s,r={}){let o=i.Qu(r.merge||r.mergeFields?2:0,e,t,s);W_("Data must be an object, but it was:",o,n);let a=pS(n,o),c,u;if(r.merge)c=new Jt(o.fieldMask),u=o.fieldTransforms;else if(r.mergeFields){let d=[];for(let f of r.mergeFields){let m=i_(e,f,t);if(!o.contains(m))throw new O(x.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);gS(d,m)||d.push(m)}c=new Jt(d),u=o.fieldTransforms.filter(f=>c.covers(f.field))}else c=null,u=o.fieldTransforms;return new Jg(new Rt(a),c,u)}var fl=class i extends yi{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof i}};function dS(i,e,t){return new bh({Cu:3,qu:e.settings.qu,methodName:i._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var Zg=class i extends yi{_toFieldTransform(e){return new Ws(e.path,new ns)}isEqual(e){return e instanceof i}},e_=class i extends yi{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){let t=dS(this,e,!0),n=this.Ku.map(r=>Zs(r,t)),s=new gi(n);return new Ws(e.path,s)}isEqual(e){return e instanceof i&&ef(this.Ku,e.Ku)}},t_=class i extends yi{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){let t=dS(this,e,!0),n=this.Ku.map(r=>Zs(r,t)),s=new _i(n);return new Ws(e.path,s)}isEqual(e){return e instanceof i&&ef(this.Ku,e.Ku)}},n_=class i extends yi{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){let t=new is(e.serializer,ZI(e.serializer,this.$u));return new Ws(e.path,t)}isEqual(e){return e instanceof i&&this.$u===e.$u}};function j_(i,e,t,n){let s=i.Qu(1,e,t);W_("Data must be an object, but it was:",s,n);let r=[],o=Rt.empty();Js(n,(c,u)=>{let d=z_(e,c,t);u=ge(u);let f=s.Nu(d);if(u instanceof fl)r.push(d);else{let m=Zs(u,f);m!=null&&(r.push(d),o.set(d,m))}});let a=new Jt(r);return new Sh(o,a,s.fieldTransforms)}function G_(i,e,t,n,s,r){let o=i.Qu(1,e,t),a=[i_(e,n,t)],c=[s];if(r.length%2!=0)throw new O(x.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<r.length;m+=2)a.push(i_(e,r[m])),c.push(r[m+1]);let u=[],d=Rt.empty();for(let m=a.length-1;m>=0;--m)if(!gS(u,a[m])){let _=a[m],v=c[m];v=ge(v);let C=o.Nu(_);if(v instanceof fl)u.push(_);else{let R=Zs(v,C);R!=null&&(u.push(_),d.set(_,R))}}let f=new Jt(u);return new Sh(d,f,o.fieldTransforms)}function fS(i,e,t,n=!1){return Zs(t,i.Qu(n?4:3,e))}function Zs(i,e){if(mS(i=ge(i)))return W_("Unsupported field value:",e,i),pS(i,e);if(i instanceof yi)return function(n,s){if(!hS(s.Cu))throw s.Bu(`${n._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${n._methodName}() is not currently supported inside arrays`);let r=n._toFieldTransform(s);r&&s.fieldTransforms.push(r)}(i,e),null;if(i===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),i instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(n,s){let r=[],o=0;for(let a of n){let c=Zs(a,s.Lu(o));c==null&&(c={nullValue:"NULL_VALUE"}),r.push(c),o++}return{arrayValue:{values:r}}}(i,e)}return function(n,s){if((n=ge(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return ZI(s.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let r=We.fromDate(n);return{timestampValue:no(s.serializer,r)}}if(n instanceof We){let r=new We(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:no(s.serializer,r)}}if(n instanceof Qs)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Jn)return{bytesValue:cC(s.serializer,n._byteString)};if(n instanceof Me){let r=s.databaseId,o=n.firestore._databaseId;if(!o.isEqual(r))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:y_(n.firestore._databaseId||s.databaseId,n._key.path)}}if(n instanceof dl)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(c=>{if(typeof c!="number")throw a.Bu("VectorValues must only contain numeric values.");return __(a.serializer,c)})}}}}}}(n,s);throw s.Bu(`Unsupported field value: ${Vh(n)}`)}(i,e)}function pS(i,e){let t={};return MI(i)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Js(i,(n,s)=>{let r=Zs(s,e.Mu(n));r!=null&&(t[n]=r)}),{mapValue:{fields:t}}}function mS(i){return!(typeof i!="object"||i===null||i instanceof Array||i instanceof Date||i instanceof We||i instanceof Qs||i instanceof Jn||i instanceof Me||i instanceof yi||i instanceof dl)}function W_(i,e,t){if(!mS(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){let n=Vh(t);throw n==="an object"?e.Bu(i+" a custom object"):e.Bu(i+" "+n)}}function i_(i,e,t){if((e=ge(e))instanceof Pn)return e._internalPath;if(typeof e=="string")return z_(i,e);throw Ah("Field path arguments must be of type string or ",i,!1,void 0,t)}var bx=new RegExp("[~\\*/\\[\\]]");function z_(i,e,t){if(e.search(bx)>=0)throw Ah(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,i,!1,void 0,t);try{return new Pn(...e.split("."))._internalPath}catch{throw Ah(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,i,!1,void 0,t)}}function Ah(i,e,t,n,s){let r=n&&!n.isEmpty(),o=s!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(r||o)&&(c+=" (found",r&&(c+=` in field ${n}`),o&&(c+=` in document ${s}`),c+=")"),new O(x.INVALID_ARGUMENT,a+i+c)}function gS(i,e){return i.some(t=>t.isEqual(e))}var $s=class{constructor(e,t,n,s,r){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=s,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new Me(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new s_(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Uh("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},s_=class extends $s{data(){return super.data()}};function Uh(i,e){return typeof e=="string"?z_(i,e):e instanceof Pn?e._internalPath:e._delegate._internalPath}function _S(i){if(i.limitType==="L"&&i.explicitOrderBy.length===0)throw new O(x.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var pl=class{},Ys=class extends pl{};function wi(i,e,...t){let n=[];e instanceof pl&&n.push(e),n=n.concat(t),function(r){let o=r.filter(c=>c instanceof r_).length,a=r.filter(c=>c instanceof Rh).length;if(o>1||o>0&&a>0)throw new O(x.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(let s of n)i=s._apply(i);return i}var Rh=class i extends Ys{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new i(e,t,n)}_apply(e){let t=this._parse(e);return AS(e._query,t),new vt(e.firestore,e.converter,Mm(e._query,t))}_parse(e){let t=Xs(e.firestore);return function(r,o,a,c,u,d,f){let m;if(u.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new O(x.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){TI(f,d);let _=[];for(let v of f)_.push(wI(c,r,v));m={arrayValue:{values:_}}}else m=wI(c,r,f)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||TI(f,d),m=fS(a,o,f,d==="in"||d==="not-in");return _e.create(u,d,m)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function yS(i,e,t){let n=e,s=Uh("where",i);return Rh._create(s,n,t)}var r_=class i extends pl{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new i(e,t)}_parse(e){let t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return t.length===1?t[0]:Re.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(s,r){let o=s,a=r.getFlattenedFilters();for(let c of a)AS(o,c),o=Mm(o,c)}(e._query,t),new vt(e.firestore,e.converter,Mm(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var o_=class i extends Ys{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new i(e,t)}_apply(e){let t=function(s,r,o){if(s.startAt!==null)throw new O(x.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new O(x.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new js(r,o)}(e._query,this._field,this._direction);return new vt(e.firestore,e.converter,function(s,r){let o=s.explicitOrderBy.concat([r]);return new An(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}};function vS(i,e="asc"){let t=e,n=Uh("orderBy",i);return o_._create(n,t)}var Ph=class i extends Ys{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new i(e,t,n)}_apply(e){return new vt(e.firestore,e.converter,Hu(e._query,this._limit,this._limitType))}};function ES(i){return JC("limit",i),Ph._create("limit",i,"F")}function wS(i){return JC("limitToLast",i),Ph._create("limitToLast",i,"L")}var Nh=class i extends Ys{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new i(e,t,n)}_apply(e){let t=bS(e,this.type,this._docOrFields,this._inclusive);return new vt(e.firestore,e.converter,function(s,r){return new An(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,r,s.endAt)}(e._query,t))}};function TS(...i){return Nh._create("startAt",i,!0)}function IS(...i){return Nh._create("startAfter",i,!1)}var xh=class i extends Ys{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new i(e,t,n)}_apply(e){let t=bS(e,this.type,this._docOrFields,this._inclusive);return new vt(e.firestore,e.converter,function(s,r){return new An(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,r)}(e._query,t))}};function CS(...i){return xh._create("endBefore",i,!1)}function SS(...i){return xh._create("endAt",i,!0)}function bS(i,e,t,n){if(t[0]=ge(t[0]),t[0]instanceof $s)return function(r,o,a,c,u){if(!c)throw new O(x.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let d=[];for(let f of Qr(r))if(f.field.isKeyField())d.push(qs(o,c.key));else{let m=c.data.field(f.field);if(Oh(m))throw new O(x.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(m===null){let _=f.field.canonicalString();throw new O(x.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${_}' (used as the orderBy) does not exist.`)}d.push(m)}return new $n(d,u)}(i._query,i.firestore._databaseId,e,t[0]._document,n);{let s=Xs(i.firestore);return function(o,a,c,u,d,f){let m=o.explicitOrderBy;if(d.length>m.length)throw new O(x.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let _=[];for(let v=0;v<d.length;v++){let C=d[v];if(m[v].field.isKeyField()){if(typeof C!="string")throw new O(x.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof C}`);if(!m_(o)&&C.indexOf("/")!==-1)throw new O(x.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${C}' contains a slash.`);let R=o.path.child(ve.fromString(C));if(!j.isDocumentKey(R))throw new O(x.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${R}' is not because it contains an odd number of segments.`);let F=new j(R);_.push(qs(a,F))}else{let R=fS(c,u,C);_.push(R)}}return new $n(_,f)}(i._query,i.firestore._databaseId,s,e,t,n)}}function wI(i,e,t){if(typeof(t=ge(t))=="string"){if(t==="")throw new O(x.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!m_(e)&&t.indexOf("/")!==-1)throw new O(x.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let n=e.path.child(ve.fromString(t));if(!j.isDocumentKey(n))throw new O(x.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return qs(i,new j(n))}if(t instanceof Me)return qs(i,t._key);throw new O(x.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Vh(t)}.`)}function TI(i,e){if(!Array.isArray(i)||i.length===0)throw new O(x.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function AS(i,e){let t=function(s,r){for(let o of s)for(let a of o.getFlattenedFilters())if(r.indexOf(a.op)>=0)return a.op;return null}(i.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new O(x.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new O(x.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var fo=class{convertValue(e,t="none"){switch(Us(e)){case 0:return null;case 1:return e.booleanValue;case 2:return je(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Zi(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw K()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return Js(e,(s,r)=>{n[s]=this.convertValue(r,t)}),n}convertVectorValue(e){var t,n,s;let r=(s=(n=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||n===void 0?void 0:n.values)===null||s===void 0?void 0:s.map(o=>je(o.doubleValue));return new dl(r)}convertGeoPoint(e){return new Qs(je(e.latitude),je(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=f_(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Ja(e));default:return null}}convertTimestamp(e){let t=mi(e);return new We(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=ve.fromString(e);Q(EC(n));let s=new es(n.get(1),n.get(3)),r=new j(n.popFirst(5));return s.isEqual(t)||Xe(`Document ${r} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}};function qh(i,e,t){let n;return n=i?t&&(t.merge||t.mergeFields)?i.toFirestore(e,t):i.toFirestore(e):e,n}var a_=class extends fo{constructor(e){super(),this.firestore=e}convertBytes(e){return new Jn(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Me(this.firestore,null,t)}};var pi=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},mn=class extends $s{constructor(e,t,n,s,r,o){super(e,t,n,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new Yi(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(Uh("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}},Yi=class extends mn{data(e={}){return super.data(e)}},Nn=class{constructor(e,t,n,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new pi(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Yi(this._firestore,this._userDataWriter,n.key,n,new pi(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new O(x.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,r){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{let c=new Yi(s._firestore,s._userDataWriter,a.doc.key,a.doc,new pi(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>r||a.type!==3).map(a=>{let c=new Yi(s._firestore,s._userDataWriter,a.doc.key,a.doc,new pi(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter),u=-1,d=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:Ax(a.type),doc:c,oldIndex:u,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function Ax(i){switch(i){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return K()}}function K_(i,e){return i instanceof mn&&e instanceof mn?i._firestore===e._firestore&&i._key.isEqual(e._key)&&(i._document===null?e._document===null:i._document.isEqual(e._document))&&i._converter===e._converter:i instanceof Nn&&e instanceof Nn&&i._firestore===e._firestore&&q_(i.query,e.query)&&i.metadata.isEqual(e.metadata)&&i._snapshot.isEqual(e._snapshot)}function RS(i){i=we(i,Me);let e=we(i.firestore,ze);return QC(Et(e),i._key).then(t=>Y_(e,i,t))}var vi=class extends fo{constructor(e){super(),this.firestore=e}convertBytes(e){return new Jn(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Me(this.firestore,null,t)}};function PS(i){i=we(i,Me);let e=we(i.firestore,ze),t=Et(e),n=new vi(e);return Ex(t,i._key).then(s=>new mn(e,n,i._key,s,new pi(s!==null&&s.hasLocalMutations,!0),i.converter))}function NS(i){i=we(i,Me);let e=we(i.firestore,ze);return QC(Et(e),i._key,{source:"server"}).then(t=>Y_(e,i,t))}function xS(i){i=we(i,vt);let e=we(i.firestore,ze),t=Et(e),n=new vi(e);return _S(i._query),$C(t,i._query).then(s=>new Nn(e,n,i,s))}function DS(i){i=we(i,vt);let e=we(i.firestore,ze),t=Et(e),n=new vi(e);return wx(t,i._query).then(s=>new Nn(e,n,i,s))}function OS(i){i=we(i,vt);let e=we(i.firestore,ze),t=Et(e),n=new vi(e);return $C(t,i._query,{source:"server"}).then(s=>new Nn(e,n,i,s))}function H_(i,e,t){i=we(i,Me);let n=we(i.firestore,ze),s=qh(i.converter,e,t);return Eo(n,[Bh(Xs(n),"setDoc",i._key,s,i.converter!==null,t).toMutation(i._key,Ye.none())])}function Q_(i,e,t,...n){i=we(i,Me);let s=we(i.firestore,ze),r=Xs(s),o;return o=typeof(e=ge(e))=="string"||e instanceof Pn?G_(r,"updateDoc",i._key,e,t,n):j_(r,"updateDoc",i._key,e),Eo(s,[o.toMutation(i._key,Ye.exists(!0))])}function kS(i){return Eo(we(i.firestore,ze),[new rs(i._key,Ye.none())])}function MS(i,e){let t=we(i.firestore,ze),n=wl(i),s=qh(i.converter,e);return Eo(t,[Bh(Xs(i.firestore),"addDoc",n._key,s,i.converter!==null,{}).toMutation(n._key,Ye.exists(!1))]).then(()=>n)}function $_(i,...e){var t,n,s;i=ge(i);let r={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||$g(e[o])||(r=e[o],o++);let a={includeMetadataChanges:r.includeMetadataChanges,source:r.source};if($g(e[o])){let f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(n=f.error)===null||n===void 0?void 0:n.bind(f),e[o+2]=(s=f.complete)===null||s===void 0?void 0:s.bind(f)}let c,u,d;if(i instanceof Me)u=we(i.firestore,ze),d=mo(i._key.path),c={next:f=>{e[o]&&e[o](Y_(u,i,f))},error:e[o+1],complete:e[o+2]};else{let f=we(i,vt);u=we(f.firestore,ze),d=f._query;let m=new vi(u);c={next:_=>{e[o]&&e[o](new Nn(u,m,f,_))},error:e[o+1],complete:e[o+2]},_S(i._query)}return function(m,_,v,C){let R=new uo(C),F=new hl(_,R,v);return m.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return S_(yield ho(m),F)})),()=>{R.Za(),m.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return b_(yield ho(m),F)}))}}(Et(u),d,a,c)}function FS(i,e){return Tx(Et(i=we(i,ze)),$g(e)?e:{next:e})}function Eo(i,e){return function(n,s){let r=new ht;return n.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return tx(yield F_(n),s,r)})),r.promise}(Et(i),e)}function Y_(i,e,t){let n=t.docs.get(e._key),s=new vi(i);return new mn(i,s,e._key,n,new pi(t.hasPendingWrites,t.fromCache),e.converter)}var Rx={maxAttempts:5};var Dh=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Xs(e)}set(e,t,n){this._verifyNotCommitted();let s=Qi(e,this._firestore),r=qh(s.converter,t,n),o=Bh(this._dataReader,"WriteBatch.set",s._key,r,s.converter!==null,n);return this._mutations.push(o.toMutation(s._key,Ye.none())),this}update(e,t,n,...s){this._verifyNotCommitted();let r=Qi(e,this._firestore),o;return o=typeof(t=ge(t))=="string"||t instanceof Pn?G_(this._dataReader,"WriteBatch.update",r._key,t,n,s):j_(this._dataReader,"WriteBatch.update",r._key,t),this._mutations.push(o.toMutation(r._key,Ye.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Qi(e,this._firestore);return this._mutations=this._mutations.concat(new rs(t._key,Ye.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new O(x.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Qi(i,e){if((i=ge(i)).firestore!==e)throw new O(x.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return i}var l_=class extends class{constructor(t,n){this._firestore=t,this._transaction=n,this._dataReader=Xs(t)}get(t){let n=Qi(t,this._firestore),s=new a_(this._firestore);return this._transaction.lookup([n._key]).then(r=>{if(!r||r.length!==1)return K();let o=r[0];if(o.isFoundDocument())return new $s(this._firestore,s,o.key,o,n.converter);if(o.isNoDocument())return new $s(this._firestore,s,n._key,null,n.converter);throw K()})}set(t,n,s){let r=Qi(t,this._firestore),o=qh(r.converter,n,s),a=Bh(this._dataReader,"Transaction.set",r._key,o,r.converter!==null,s);return this._transaction.set(r._key,a),this}update(t,n,s,...r){let o=Qi(t,this._firestore),a;return a=typeof(n=ge(n))=="string"||n instanceof Pn?G_(this._dataReader,"Transaction.update",o._key,n,s,r):j_(this._dataReader,"Transaction.update",o._key,n),this._transaction.update(o._key,a),this}delete(t){let n=Qi(t,this._firestore);return this._transaction.delete(n._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Qi(e,this._firestore),n=new vi(this._firestore);return super.get(e).then(s=>new mn(this._firestore,n,t._key,s._document,new pi(!1,!1),t.converter))}};function LS(i,e,t){i=we(i,ze);let n=Object.assign(Object.assign({},Rx),t);return function(r){if(r.maxAttempts<1)throw new O(x.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(r,o,a){let c=new ht;return r.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){let u=yield _x(r);new Hg(r.asyncQueue,u,a,o,c).au()})),c.promise}(Et(i),s=>e(new l_(i,s)),n)}function VS(){return new fl("deleteField")}function BS(){return new Zg("serverTimestamp")}function US(...i){return new e_("arrayUnion",i)}function qS(...i){return new t_("arrayRemove",i)}function jS(i){return new n_("increment",i)}(function(e,t=!0){(function(s){po=s})(gc),mc(new Ln("firestore",(n,{instanceIdentifier:s,options:r})=>{let o=n.getProvider("app").getImmediate(),a=new ze(new dm(n.getProvider("auth-internal")),new gm(n.getProvider("app-check-internal")),function(u,d){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new O(x.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new es(u.options.projectId,d)}(o,s),o);return r=Object.assign({useFetchStreams:t},r),a._setSettings(r),a},"PUBLIC").setMultipleInstances(!0)),yr(ET,"4.7.3",e),yr(ET,"4.7.3","esm2017")})();var Px="@firebase/firestore-compat",Nx="0.3.38";function ny(i,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new O("invalid-argument",`Invalid options passed to function ${i}(): You cannot specify both "merge" and "mergeFields".`);return e}function GS(){if(typeof Uint8Array>"u")throw new O("unimplemented","Uint8Arrays are not available in this environment.")}function WS(){if(!FI())throw new O("unimplemented","Blobs are unavailable in Firestore in this environment.")}var jh=class i{constructor(e){this._delegate=e}static fromBase64String(e){return WS(),new i(Jn.fromBase64String(e))}static fromUint8Array(e){return GS(),new i(Jn.fromUint8Array(e))}toBase64(){return WS(),this._delegate.toBase64()}toUint8Array(){return GS(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function J_(i){return xx(i,["next","error","complete"])}function xx(i,e){if(typeof i!="object"||i===null)return!1;let t=i;for(let n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}var X_=class{enableIndexedDbPersistence(e,t){return nS(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return iS(e._delegate)}clearIndexedDbPersistence(e){return rS(e._delegate)}},Gh=class{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof es||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&bn("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,n={}){XC(this._delegate,e,t,n)}enableNetwork(){return aS(this._delegate)}disableNetwork(){return lS(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,V_("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return oS(this._delegate)}onSnapshotsInSync(e){return FS(this._delegate,e)}get app(){if(!this._appCompat)throw new O("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Io(this,B_(this._delegate,e))}catch(t){throw Ut(t,"collection()","Firestore.collection()")}}doc(e){try{return new Xn(this,wl(this._delegate,e))}catch(t){throw Ut(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new ir(this,ZC(this._delegate,e))}catch(t){throw Ut(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return LS(this._delegate,t=>e(new Wh(this,t)))}batch(){return Et(this._delegate),new zh(new Dh(this._delegate,e=>Eo(this._delegate,e)))}loadBundle(e){return cS(this._delegate,e)}namedQuery(e){return uS(this._delegate,e).then(t=>t?new ir(this,t):null)}},wo=class extends fo{constructor(e){super(),this.firestore=e}convertBytes(e){return new jh(new Jn(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return Xn.forKey(t,this.firestore,null)}};function Dx(i){II(i)}var Wh=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new wo(e)}get(e){let t=er(e);return this._delegate.get(t).then(n=>new tr(this._firestore,new mn(this._firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,t.converter)))}set(e,t,n){let s=er(e);return n?(ny("Transaction.set",n),this._delegate.set(s,t,n)):this._delegate.set(s,t),this}update(e,t,n,...s){let r=er(e);return arguments.length===2?this._delegate.update(r,t):this._delegate.update(r,t,n,...s),this}delete(e){let t=er(e);return this._delegate.delete(t),this}},zh=class{constructor(e){this._delegate=e}set(e,t,n){let s=er(e);return n?(ny("WriteBatch.set",n),this._delegate.set(s,t,n)):this._delegate.set(s,t),this}update(e,t,n,...s){let r=er(e);return arguments.length===2?this._delegate.update(r,t):this._delegate.update(r,t,n,...s),this}delete(e){let t=er(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},To=class i{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){let n=new Yi(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new nr(this._firestore,n),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let n=i.INSTANCES,s=n.get(e);s||(s=new WeakMap,n.set(e,s));let r=s.get(t);return r||(r=new i(e,new wo(e),t),s.set(t,r)),r}};To.INSTANCES=new WeakMap;var Xn=class i{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new wo(e)}static forPath(e,t,n){if(e.length%2!==0)throw new O("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new i(t,new Me(t._delegate,n,new j(e)))}static forKey(e,t,n){return new i(t,new Me(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new Io(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Io(this.firestore,B_(this._delegate,e))}catch(t){throw Ut(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=ge(e),e instanceof Me?U_(this._delegate,e):!1}set(e,t){t=ny("DocumentReference.set",t);try{return t?H_(this._delegate,e,t):H_(this._delegate,e)}catch(n){throw Ut(n,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return arguments.length===1?Q_(this._delegate,e):Q_(this._delegate,e,t,...n)}catch(s){throw Ut(s,"updateDoc()","DocumentReference.update()")}}delete(){return kS(this._delegate)}onSnapshot(...e){let t=zS(e),n=KS(e,s=>new tr(this.firestore,new mn(this.firestore._delegate,this._userDataWriter,s._key,s._document,s.metadata,this._delegate.converter)));return $_(this._delegate,t,n)}get(e){let t;return e?.source==="cache"?t=PS(this._delegate):e?.source==="server"?t=NS(this._delegate):t=RS(this._delegate),t.then(n=>new tr(this.firestore,new mn(this.firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,this._delegate.converter)))}withConverter(e){return new i(this.firestore,e?this._delegate.withConverter(To.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Ut(i,e,t){return i.message=i.message.replace(e,t),i}function zS(i){for(let e of i)if(typeof e=="object"&&!J_(e))return e;return{}}function KS(i,e){var t,n;let s;return J_(i[0])?s=i[0]:J_(i[1])?s=i[1]:typeof i[0]=="function"?s={next:i[0],error:i[1],complete:i[2]}:s={next:i[1],error:i[2],complete:i[3]},{next:r=>{s.next&&s.next(e(r))},error:(t=s.error)===null||t===void 0?void 0:t.bind(s),complete:(n=s.complete)===null||n===void 0?void 0:n.bind(s)}}var tr=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Xn(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return K_(this._delegate,e._delegate)}},nr=class extends tr{data(e){let t=this._delegate.data(e);return this._delegate._converter||CI(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},ir=class i{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new wo(e)}where(e,t,n){try{return new i(this.firestore,wi(this._delegate,yS(e,t,n)))}catch(s){throw Ut(s,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new i(this.firestore,wi(this._delegate,vS(e,t)))}catch(n){throw Ut(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new i(this.firestore,wi(this._delegate,ES(e)))}catch(t){throw Ut(t,"limit()","Query.limit()")}}limitToLast(e){try{return new i(this.firestore,wi(this._delegate,wS(e)))}catch(t){throw Ut(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new i(this.firestore,wi(this._delegate,TS(...e)))}catch(t){throw Ut(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new i(this.firestore,wi(this._delegate,IS(...e)))}catch(t){throw Ut(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new i(this.firestore,wi(this._delegate,CS(...e)))}catch(t){throw Ut(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new i(this.firestore,wi(this._delegate,SS(...e)))}catch(t){throw Ut(t,"endAt()","Query.endAt()")}}isEqual(e){return q_(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=DS(this._delegate):e?.source==="server"?t=OS(this._delegate):t=xS(this._delegate),t.then(n=>new Tl(this.firestore,new Nn(this.firestore._delegate,this._userDataWriter,this._delegate,n._snapshot)))}onSnapshot(...e){let t=zS(e),n=KS(e,s=>new Tl(this.firestore,new Nn(this.firestore._delegate,this._userDataWriter,this._delegate,s._snapshot)));return $_(this._delegate,t,n)}withConverter(e){return new i(this.firestore,e?this._delegate.withConverter(To.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},Z_=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new nr(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},Tl=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new ir(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new nr(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new Z_(this._firestore,t))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new nr(this._firestore,n))})}isEqual(e){return K_(this._delegate,e._delegate)}},Io=class i extends ir{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new Xn(this.firestore,e):null}doc(e){try{return e===void 0?new Xn(this.firestore,wl(this._delegate)):new Xn(this.firestore,wl(this._delegate,e))}catch(t){throw Ut(t,"doc()","CollectionReference.doc()")}}add(e){return MS(this._delegate,e).then(t=>new Xn(this.firestore,t))}isEqual(e){return U_(this._delegate,e._delegate)}withConverter(e){return new i(this.firestore,e?this._delegate.withConverter(To.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function er(i){return we(i,Me)}var ey=class i{constructor(...e){this._delegate=new Pn(...e)}static documentId(){return new i(Ze.keyField().canonicalString())}isEqual(e){return e=ge(e),e instanceof Pn?this._delegate._internalPath.isEqual(e._internalPath):!1}};var ty=class i{constructor(e){this._delegate=e}static serverTimestamp(){let e=BS();return e._methodName="FieldValue.serverTimestamp",new i(e)}static delete(){let e=VS();return e._methodName="FieldValue.delete",new i(e)}static arrayUnion(...e){let t=US(...e);return t._methodName="FieldValue.arrayUnion",new i(t)}static arrayRemove(...e){let t=qS(...e);return t._methodName="FieldValue.arrayRemove",new i(t)}static increment(e){let t=jS(e);return t._methodName="FieldValue.increment",new i(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var Ox={Firestore:Gh,GeoPoint:Qs,Timestamp:We,Blob:jh,Transaction:Wh,WriteBatch:zh,DocumentReference:Xn,DocumentSnapshot:tr,Query:ir,QueryDocumentSnapshot:nr,QuerySnapshot:Tl,CollectionReference:Io,FieldPath:ey,FieldValue:ty,setLogLevel:Dx,CACHE_SIZE_UNLIMITED:eS};function kx(i,e){i.INTERNAL.registerComponent(new Ln("firestore-compat",t=>{let n=t.getProvider("app-compat").getImmediate(),s=t.getProvider("firestore").getImmediate();return e(n,s)},"PUBLIC").setServiceProps(Object.assign({},Ox)))}function Mx(i){kx(i,(e,t)=>new Gh(e,t,new X_)),i.registerVersion(Px,Nx)}Mx(ki);function Fx(i,e=$l){return new Ql(t=>{let n;return e!=null?e.schedule(()=>{n=i.onSnapshot({includeMetadataChanges:!0},t)}):n=i.onSnapshot({includeMetadataChanges:!0},t),()=>{n?.()}})}function HS(i,e){return Fx(i,e)}function Lx(i,e){return HS(i,e).pipe(Xl(void 0),Jl(),nt(t=>{let[n,s]=t;return s.exists?n?.exists?{payload:s,type:"modified"}:{payload:s,type:"added"}:{payload:s,type:"removed"}}))}function ry(i,e){return HS(i,e).pipe(nt(t=>({payload:t,type:"query"})))}var Kh=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let n=this.ref.collection(e),{ref:s,query:r}=XS(n,t);return new Qh(s,r,this.afs)}snapshotChanges(){return Lx(this.ref,this.afs.schedulers.outsideAngular).pipe(ut)}valueChanges(e={}){return this.snapshotChanges().pipe(nt(({payload:t})=>e.idField?vn(Ae({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return Ho(this.ref.get(e)).pipe(ut)}};function Hh(i,e){return ry(i,e).pipe(Xl(void 0),Jl(),nt(t=>{let[n,s]=t,r=s.payload.docChanges(),o=r.map(a=>({type:a.type,payload:a}));return n&&JSON.stringify(n.payload.metadata)!==JSON.stringify(s.payload.metadata)&&s.payload.docs.forEach((a,c)=>{let u=r.find(f=>f.doc.ref.isEqual(a.ref)),d=n?.payload.docs.find(f=>f.ref.isEqual(a.ref));u&&JSON.stringify(u.doc.metadata)===JSON.stringify(a.metadata)||!u&&d&&JSON.stringify(d.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:c,newIndex:c,type:"modified",doc:a}})}),o}))}function QS(i,e,t){return Hh(i,t).pipe(gs((n,s)=>Vx(n,s.map(r=>r.payload),e),[]),Yl(),nt(n=>n.map(s=>({type:s.type,payload:s}))))}function Vx(i,e,t){return e.forEach(n=>{t.indexOf(n.type)>-1&&(i=Bx(i,n))}),i}function iy(i,e,t,...n){let s=i.slice();return s.splice(e,t,...n),s}function Bx(i,e){switch(e.type){case"added":if(!(i[e.newIndex]&&i[e.newIndex].doc.ref.isEqual(e.doc.ref)))return iy(i,e.newIndex,0,e);break;case"modified":if(i[e.oldIndex]==null||i[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=i.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return iy(i,e.newIndex,1,e);break;case"removed":if(i[e.oldIndex]&&i[e.oldIndex].doc.ref.isEqual(e.doc.ref))return iy(i,e.oldIndex,1);break}return i}function $S(i){return(!i||i.length===0)&&(i=["added","removed","modified"]),i}var Qh=class{ref;query;afs;constructor(e,t,n){this.ref=e,this.query=t,this.afs=n}stateChanges(e){let t=Hh(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(nt(n=>n.filter(s=>e.indexOf(s.type)>-1)))),t.pipe(Xl(void 0),Jl(),Qd(([n,s])=>s.length>0||!n),nt(([,n])=>n),ut)}auditTrail(e){return this.stateChanges(e).pipe(gs((t,n)=>[...t,...n],[]))}snapshotChanges(e){let t=$S(e);return QS(this.query,t,this.afs.schedulers.outsideAngular).pipe(ut)}valueChanges(e={}){return ry(this.query,this.afs.schedulers.outsideAngular).pipe(nt(t=>t.payload.docs.map(n=>e.idField?vn(Ae({},n.data()),{[e.idField]:n.id}):n.data())),ut)}get(e){return Ho(this.query.get(e)).pipe(ut)}add(e){return this.ref.add(e)}doc(e){return new Kh(this.ref.doc(e),this.afs)}},sy=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?Hh(this.query,this.afs.schedulers.outsideAngular).pipe(ut):Hh(this.query,this.afs.schedulers.outsideAngular).pipe(nt(t=>t.filter(n=>e.indexOf(n.type)>-1)),Qd(t=>t.length>0),ut)}auditTrail(e){return this.stateChanges(e).pipe(gs((t,n)=>[...t,...n],[]))}snapshotChanges(e){let t=$S(e);return QS(this.query,t,this.afs.schedulers.outsideAngular).pipe(ut)}valueChanges(e={}){return ry(this.query,this.afs.schedulers.outsideAngular).pipe(nt(n=>n.payload.docs.map(s=>e.idField?Ae({[e.idField]:s.id},s.data()):s.data())),ut)}get(e){return Ho(this.query.get(e)).pipe(ut)}},YS=new On("angularfire2.enableFirestorePersistence"),JS=new On("angularfire2.firestore.persistenceSettings"),Ux=new On("angularfire2.firestore.settings"),qx=new On("angularfire2.firestore.use-emulator");function XS(i,e=t=>t){return{query:e(i),ref:i}}var oy=(()=>{class i{schedulers;firestore;persistenceEnabled$;constructor(t,n,s,r,o,a,c,u,d,f,m,_,v,C,R,F,V){this.schedulers=c;let B=Tc(t,a,n),$=d;f&&Nc(B,a,m,v,C,R,_,F),[this.firestore,this.persistenceEnabled$]=Ic(`${B.name}.firestore`,"AngularFirestore",B.name,()=>{let le=a.runOutsideAngular(()=>B.firestore());if(r&&le.settings(r),$&&le.useEmulator(...$),s&&!v0(o)){let Z=()=>{try{return Ho(le.enablePersistence(u||void 0).then(()=>!0,()=>!1))}catch(T){return typeof console<"u"&&console.warn(T),Qo(!1)}};return[le,a.runOutsideAngular(Z)]}else return[le,Qo(!1)]},[r,$,s])}collection(t,n){let s;typeof t=="string"?s=this.firestore.collection(t):s=t;let{ref:r,query:o}=XS(s,n),a=this.schedulers.ngZone.run(()=>r);return new Qh(a,o,this)}collectionGroup(t,n){let s=n||(o=>o),r=this.firestore.collectionGroup(t);return new sy(s(r),this)}doc(t){let n;typeof t=="string"?n=this.firestore.doc(t):n=t;let s=this.schedulers.ngZone.run(()=>n);return new Kh(s,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(n){return new(n||i)(te(Ec),te(wc,8),te(YS,8),te(Ux,8),te(Ni),te(zt),te(vc),te(JS,8),te(qx,8),te(xc,8),te(Cc,8),te(Sc,8),te(bc,8),te(Ac,8),te(Rc,8),te(Pc,8),te(yc,8))};static \u0275prov=yt({token:i,factory:i.\u0275fac,providedIn:"any"})}return i})(),ZS=(()=>{class i{constructor(){ki.registerVersion("angularfire",_c.full,"fst-compat")}static enablePersistence(t){return{ngModule:i,providers:[{provide:YS,useValue:!0},{provide:JS,useValue:t}]}}static \u0275fac=function(n){return new(n||i)};static \u0275mod=Ot({type:i});static \u0275inj=Dt({providers:[oy]})}return i})();var Gx=["*"];function Wx(i,e){if(i&1){let t=Tn();G(0,"div",1)(1,"div",2)(2,"span",3)(3,"button",4),Ue("click",function(){Ct(t);let s=ne();return St(s.onClose())}),oe(4,"\xD7"),W()(),Es(5),W()()}}var $h=class i{showModal=!1;closeModal=new oi;onClose(){this.closeModal.emit()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=Se({type:i,selectors:[["app-modal"]],inputs:{showModal:"showModal"},outputs:{closeModal:"closeModal"},standalone:!0,features:[Ne],ngContentSelectors:Gx,decls:1,vars:1,consts:[["class","fixed inset-0 z-50 overflow-auto bg-gray-900/60 flex",4,"ngIf"],[1,"fixed","inset-0","z-50","overflow-auto","bg-gray-900/60","flex"],[1,"relative","p-8","bg-white","w-full","max-w-md","m-auto","flex-col","flex","rounded-lg"],[1,"absolute","top-0","right-0","p-4"],[1,"text-black",3,"click"]],template:function(t,n){t&1&&(vs(),be(0,Wx,6,0,"div",0)),t&2&&z("ngIf",n.showModal)},dependencies:[In]})};var Yh=class i{constructor(e){this.sanitizer=e}transform(e){return this.sanitizer.bypassSecurityTrustHtml(e)}static \u0275fac=function(t){return new(t||i)(he(lc,16))};static \u0275pipe=e0({name:"safeHtml",type:i,pure:!0,standalone:!0})};var Co=class i{static isArray(e,t=!0){return Array.isArray(e)&&(t||e.length!==0)}static isObject(e,t=!0){return typeof e=="object"&&!Array.isArray(e)&&e!=null&&(t||Object.keys(e).length!==0)}static equals(e,t,n){return n?this.resolveFieldData(e,n)===this.resolveFieldData(t,n):this.equalsByValue(e,t)}static equalsByValue(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),s=Array.isArray(t),r,o,a;if(n&&s){if(o=e.length,o!=t.length)return!1;for(r=o;r--!==0;)if(!this.equalsByValue(e[r],t[r]))return!1;return!0}if(n!=s)return!1;var c=this.isDate(e),u=this.isDate(t);if(c!=u)return!1;if(c&&u)return e.getTime()==t.getTime();var d=e instanceof RegExp,f=t instanceof RegExp;if(d!=f)return!1;if(d&&f)return e.toString()==t.toString();var m=Object.keys(e);if(o=m.length,o!==Object.keys(t).length)return!1;for(r=o;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,m[r]))return!1;for(r=o;r--!==0;)if(a=m[r],!this.equalsByValue(e[a],t[a]))return!1;return!0}return e!==e&&t!==t}static resolveFieldData(e,t){if(e&&t){if(this.isFunction(t))return t(e);if(t.indexOf(".")==-1)return e[t];{let n=t.split("."),s=e;for(let r=0,o=n.length;r<o;++r){if(s==null)return null;s=s[n[r]]}return s}}else return null}static isFunction(e){return!!(e&&e.constructor&&e.call&&e.apply)}static reorderArray(e,t,n){let s;e&&t!==n&&(n>=e.length&&(n%=e.length,t%=e.length),e.splice(n,0,e.splice(t,1)[0]))}static insertIntoOrderedArray(e,t,n,s){if(n.length>0){let r=!1;for(let o=0;o<n.length;o++)if(this.findIndexInList(n[o],s)>t){n.splice(o,0,e),r=!0;break}r||n.push(e)}else n.push(e)}static findIndexInList(e,t){let n=-1;if(t){for(let s=0;s<t.length;s++)if(t[s]==e){n=s;break}}return n}static contains(e,t){if(e!=null&&t&&t.length){for(let n of t)if(this.equals(e,n))return!0}return!1}static removeAccents(e){return e&&(e=e.normalize("NFKD").replace(new RegExp("\\p{Diacritic}","gu"),"")),e}static isDate(e){return Object.prototype.toString.call(e)==="[object Date]"}static isEmpty(e){return e==null||e===""||Array.isArray(e)&&e.length===0||!this.isDate(e)&&typeof e=="object"&&Object.keys(e).length===0}static isNotEmpty(e){return!this.isEmpty(e)}static compare(e,t,n,s=1){let r=-1,o=this.isEmpty(e),a=this.isEmpty(t);return o&&a?r=0:o?r=s:a?r=-s:typeof e=="string"&&typeof t=="string"?r=e.localeCompare(t,n,{numeric:!0}):r=e<t?-1:e>t?1:0,r}static sort(e,t,n=1,s,r=1){let o=i.compare(e,t,s,n),a=n;return(i.isEmpty(e)||i.isEmpty(t))&&(a=r===1?n:r),a*o}static merge(e,t){if(!(e==null&&t==null)){{if((e==null||typeof e=="object")&&(t==null||typeof t=="object"))return Ae(Ae({},e||{}),t||{});if((e==null||typeof e=="string")&&(t==null||typeof t=="string"))return[e||"",t||""].join(" ")}return t||e}}static isPrintableCharacter(e=""){return this.isNotEmpty(e)&&e.length===1&&e.match(/\S| /)}static getItemValue(e,...t){return this.isFunction(e)?e(...t):e}static findLastIndex(e,t){let n=-1;if(this.isNotEmpty(e))try{n=e.findLastIndex(t)}catch{n=e.lastIndexOf([...e].reverse().find(t))}return n}static findLast(e,t){let n;if(this.isNotEmpty(e))try{n=e.findLast(t)}catch{n=[...e].reverse().find(t)}return n}static deepEquals(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),s=Array.isArray(t),r,o,a;if(n&&s){if(o=e.length,o!=t.length)return!1;for(r=o;r--!==0;)if(!this.deepEquals(e[r],t[r]))return!1;return!0}if(n!=s)return!1;var c=e instanceof Date,u=t instanceof Date;if(c!=u)return!1;if(c&&u)return e.getTime()==t.getTime();var d=e instanceof RegExp,f=t instanceof RegExp;if(d!=f)return!1;if(d&&f)return e.toString()==t.toString();var m=Object.keys(e);if(o=m.length,o!==Object.keys(t).length)return!1;for(r=o;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,m[r]))return!1;for(r=o;r--!==0;)if(a=m[r],!this.deepEquals(e[a],t[a]))return!1;return!0}return e!==e&&t!==t}},eb=0;function Zn(i="pn_id_"){return eb++,`${i}${eb}`}function Kx(){let i=[],e=(r,o)=>{let a=i.length>0?i[i.length-1]:{key:r,value:o},c=a.value+(a.key===r?0:o)+2;return i.push({key:r,value:c}),c},t=r=>{i=i.filter(o=>o.value!==r)},n=()=>i.length>0?i[i.length-1].value:0,s=r=>r&&parseInt(r.style.zIndex,10)||0;return{get:s,set:(r,o,a)=>{o&&(o.style.zIndex=String(e(r,a)))},clear:r=>{r&&(t(s(r)),r.style.zIndex="")},getCurrent:()=>n()}}var Jh=Kx();var Pt=(()=>{class i{static STARTS_WITH="startsWith";static CONTAINS="contains";static NOT_CONTAINS="notContains";static ENDS_WITH="endsWith";static EQUALS="equals";static NOT_EQUALS="notEquals";static IN="in";static LESS_THAN="lt";static LESS_THAN_OR_EQUAL_TO="lte";static GREATER_THAN="gt";static GREATER_THAN_OR_EQUAL_TO="gte";static BETWEEN="between";static IS="is";static IS_NOT="isNot";static BEFORE="before";static AFTER="after";static DATE_IS="dateIs";static DATE_IS_NOT="dateIsNot";static DATE_BEFORE="dateBefore";static DATE_AFTER="dateAfter"}return i})();var So=(()=>{class i{messageSource=new nn;clearSource=new nn;messageObserver=this.messageSource.asObservable();clearObserver=this.clearSource.asObservable();add(t){t&&this.messageSource.next(t)}addAll(t){t&&t.length&&this.messageSource.next(t)}clear(t){this.clearSource.next(t||null)}static \u0275fac=function(n){return new(n||i)};static \u0275prov=yt({token:i,factory:i.\u0275fac})}return i})();var Il=(()=>{class i{ripple=!1;inputStyle=xi("outlined");overlayOptions={};csp=xi({nonce:void 0});filterMatchModeOptions={text:[Pt.STARTS_WITH,Pt.CONTAINS,Pt.NOT_CONTAINS,Pt.ENDS_WITH,Pt.EQUALS,Pt.NOT_EQUALS],numeric:[Pt.EQUALS,Pt.NOT_EQUALS,Pt.LESS_THAN,Pt.LESS_THAN_OR_EQUAL_TO,Pt.GREATER_THAN,Pt.GREATER_THAN_OR_EQUAL_TO],date:[Pt.DATE_IS,Pt.DATE_IS_NOT,Pt.DATE_BEFORE,Pt.DATE_AFTER]};translation={startsWith:"Starts with",contains:"Contains",notContains:"Not contains",endsWith:"Ends with",equals:"Equals",notEquals:"Not equals",noFilter:"No Filter",lt:"Less than",lte:"Less than or equal to",gt:"Greater than",gte:"Greater than or equal to",is:"Is",isNot:"Is not",before:"Before",after:"After",dateIs:"Date is",dateIsNot:"Date is not",dateBefore:"Date is before",dateAfter:"Date is after",clear:"Clear",apply:"Apply",matchAll:"Match All",matchAny:"Match Any",addRule:"Add Rule",removeRule:"Remove Rule",accept:"Yes",reject:"No",choose:"Choose",upload:"Upload",cancel:"Cancel",pending:"Pending",fileSizeTypes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],chooseYear:"Choose Year",chooseMonth:"Choose Month",chooseDate:"Choose Date",prevDecade:"Previous Decade",nextDecade:"Next Decade",prevYear:"Previous Year",nextYear:"Next Year",prevMonth:"Previous Month",nextMonth:"Next Month",prevHour:"Previous Hour",nextHour:"Next Hour",prevMinute:"Previous Minute",nextMinute:"Next Minute",prevSecond:"Previous Second",nextSecond:"Next Second",am:"am",pm:"pm",dateFormat:"mm/dd/yy",firstDayOfWeek:0,today:"Today",weekHeader:"Wk",weak:"Weak",medium:"Medium",strong:"Strong",passwordPrompt:"Enter a password",emptyMessage:"No results found",searchMessage:"{0} results are available",selectionMessage:"{0} items selected",emptySelectionMessage:"No selected item",emptySearchMessage:"No results found",emptyFilterMessage:"No results found",aria:{trueLabel:"True",falseLabel:"False",nullLabel:"Not Selected",star:"1 star",stars:"{star} stars",selectAll:"All items selected",unselectAll:"All items unselected",close:"Close",previous:"Previous",next:"Next",navigation:"Navigation",scrollTop:"Scroll Top",moveTop:"Move Top",moveUp:"Move Up",moveDown:"Move Down",moveBottom:"Move Bottom",moveToTarget:"Move to Target",moveToSource:"Move to Source",moveAllToTarget:"Move All to Target",moveAllToSource:"Move All to Source",pageLabel:"{page}",firstPageLabel:"First Page",lastPageLabel:"Last Page",nextPageLabel:"Next Page",prevPageLabel:"Previous Page",rowsPerPageLabel:"Rows per page",previousPageLabel:"Previous Page",jumpToPageDropdownLabel:"Jump to Page Dropdown",jumpToPageInputLabel:"Jump to Page Input",selectRow:"Row Selected",unselectRow:"Row Unselected",expandRow:"Row Expanded",collapseRow:"Row Collapsed",showFilterMenu:"Show Filter Menu",hideFilterMenu:"Hide Filter Menu",filterOperator:"Filter Operator",filterConstraint:"Filter Constraint",editRow:"Row Edit",saveEdit:"Save Edit",cancelEdit:"Cancel Edit",listView:"List View",gridView:"Grid View",slide:"Slide",slideNumber:"{slideNumber}",zoomImage:"Zoom Image",zoomIn:"Zoom In",zoomOut:"Zoom Out",rotateRight:"Rotate Right",rotateLeft:"Rotate Left",listLabel:"Option List",selectColor:"Select a color",removeLabel:"Remove",browseFiles:"Browse Files",maximizeLabel:"Maximize"}};zIndex={modal:1100,overlay:1e3,menu:1e3,tooltip:1100};translationSource=new nn;translationObserver=this.translationSource.asObservable();getTranslation(t){return this.translation[t]}setTranslation(t){this.translation=Ae(Ae({},this.translation),t),this.translationSource.next(this.translation)}static \u0275fac=function(n){return new(n||i)};static \u0275prov=yt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var Xh=(()=>{class i{template;type;name;constructor(t){this.template=t}getType(){return this.name}static \u0275fac=function(n){return new(n||i)(he(s0))};static \u0275dir=Pi({type:i,selectors:[["","pTemplate",""]],inputs:{type:"type",name:[0,"pTemplate","name"]},standalone:!0})}return i})(),Zh=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=Ot({type:i});static \u0275inj=Dt({})}return i})();var se=function(i){return i[i.State=0]="State",i[i.Transition=1]="Transition",i[i.Sequence=2]="Sequence",i[i.Group=3]="Group",i[i.Animate=4]="Animate",i[i.Keyframes=5]="Keyframes",i[i.Style=6]="Style",i[i.Trigger=7]="Trigger",i[i.Reference=8]="Reference",i[i.AnimateChild=9]="AnimateChild",i[i.AnimateRef=10]="AnimateRef",i[i.Query=11]="Query",i[i.Stagger=12]="Stagger",i}(se||{}),ei="*";function Sl(i,e){return{type:se.Trigger,name:i,definitions:e,options:{}}}function bo(i,e=null){return{type:se.Animate,styles:e,timings:i}}function tb(i,e=null){return{type:se.Sequence,steps:i,options:e}}function xn(i){return{type:se.Style,styles:i,offset:null}}function Ao(i,e,t){return{type:se.State,name:i,styles:e,options:t}}function sr(i,e,t=null){return{type:se.Transition,expr:i,animation:e,options:t}}function nb(i=null){return{type:se.AnimateChild,options:i}}function ib(i,e,t=null){return{type:se.Query,selector:i,animation:e,options:t}}var us=class{constructor(e=0,t=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=e+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){let t=e=="start"?this._onStartFns:this._onDoneFns;t.forEach(n=>n()),t.length=0}},Cl=class{constructor(e){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=e;let t=0,n=0,s=0,r=this.players.length;r==0?queueMicrotask(()=>this._onFinish()):this.players.forEach(o=>{o.onDone(()=>{++t==r&&this._onFinish()}),o.onDestroy(()=>{++n==r&&this._onDestroy()}),o.onStart(()=>{++s==r&&this._onStart()})}),this.totalTime=this.players.reduce((o,a)=>Math.max(o,a.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){let t=e*this.totalTime;this.players.forEach(n=>{let s=n.totalTime?Math.min(1,t/n.totalTime):1;n.setPosition(s)})}getPosition(){let e=this.players.reduce((t,n)=>t===null||n.totalTime>t.totalTime?n:t,null);return e!=null?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){let t=e=="start"?this._onStartFns:this._onDoneFns;t.forEach(n=>n()),t.length=0}},ed="!";var Hx=["*"],gn=(()=>{class i{label;spin=!1;styleClass;role;ariaLabel;ariaHidden;ngOnInit(){this.getAttributes()}getAttributes(){let t=Co.isEmpty(this.label);this.role=t?void 0:"img",this.ariaLabel=t?void 0:this.label,this.ariaHidden=t}getClassNames(){return`p-icon ${this.styleClass?this.styleClass+" ":""}${this.spin?"p-icon-spin":""}`}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=Se({type:i,selectors:[["ng-component"]],hostAttrs:[1,"p-element","p-icon-wrapper"],inputs:{label:"label",spin:[2,"spin","spin",ft],styleClass:"styleClass"},standalone:!0,features:[ai,Ne],ngContentSelectors:Hx,decls:1,vars:0,template:function(n,s){n&1&&(vs(),Es(0))},encapsulation:2,changeDetection:0})}return i})();var cy=(()=>{class i extends gn{static \u0275fac=(()=>{let t;return function(s){return(t||(t=rn(i)))(s||i)}})();static \u0275cmp=Se({type:i,selectors:[["CheckIcon"]],standalone:!0,features:[on,Ne],decls:2,vars:5,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M4.86199 11.5948C4.78717 11.5923 4.71366 11.5745 4.64596 11.5426C4.57826 11.5107 4.51779 11.4652 4.46827 11.4091L0.753985 7.69483C0.683167 7.64891 0.623706 7.58751 0.580092 7.51525C0.536478 7.44299 0.509851 7.36177 0.502221 7.27771C0.49459 7.19366 0.506156 7.10897 0.536046 7.03004C0.565935 6.95111 0.613367 6.88 0.674759 6.82208C0.736151 6.76416 0.8099 6.72095 0.890436 6.69571C0.970973 6.67046 1.05619 6.66385 1.13966 6.67635C1.22313 6.68886 1.30266 6.72017 1.37226 6.76792C1.44186 6.81567 1.4997 6.8786 1.54141 6.95197L4.86199 10.2503L12.6397 2.49483C12.7444 2.42694 12.8689 2.39617 12.9932 2.40745C13.1174 2.41873 13.2343 2.47141 13.3251 2.55705C13.4159 2.64268 13.4753 2.75632 13.4938 2.87973C13.5123 3.00315 13.4888 3.1292 13.4271 3.23768L5.2557 11.4091C5.20618 11.4652 5.14571 11.5107 5.07801 11.5426C5.01031 11.5745 4.9368 11.5923 4.86199 11.5948Z","fill","currentColor"]],template:function(n,s){n&1&&(sn(),G(0,"svg",0),re(1,"path",1),W()),n&2&&(Pe(s.getClassNames()),ue("aria-label",s.ariaLabel)("aria-hidden",s.ariaHidden)("role",s.role))},encapsulation:2})}return i})();var uy=(()=>{class i extends gn{pathId;ngOnInit(){this.pathId="url(#"+Zn()+")"}static \u0275fac=(()=>{let t;return function(s){return(t||(t=rn(i)))(s||i)}})();static \u0275cmp=Se({type:i,selectors:[["ExclamationTriangleIcon"]],standalone:!0,features:[on,Ne],decls:8,vars:7,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M13.4018 13.1893H0.598161C0.49329 13.189 0.390283 13.1615 0.299143 13.1097C0.208003 13.0578 0.131826 12.9832 0.0780112 12.8932C0.0268539 12.8015 0 12.6982 0 12.5931C0 12.4881 0.0268539 12.3848 0.0780112 12.293L6.47985 1.08982C6.53679 1.00399 6.61408 0.933574 6.70484 0.884867C6.7956 0.836159 6.897 0.810669 7 0.810669C7.103 0.810669 7.2044 0.836159 7.29516 0.884867C7.38592 0.933574 7.46321 1.00399 7.52015 1.08982L13.922 12.293C13.9731 12.3848 14 12.4881 14 12.5931C14 12.6982 13.9731 12.8015 13.922 12.8932C13.8682 12.9832 13.792 13.0578 13.7009 13.1097C13.6097 13.1615 13.5067 13.189 13.4018 13.1893ZM1.63046 11.989H12.3695L7 2.59425L1.63046 11.989Z","fill","currentColor"],["d","M6.99996 8.78801C6.84143 8.78594 6.68997 8.72204 6.57787 8.60993C6.46576 8.49782 6.40186 8.34637 6.39979 8.18784V5.38703C6.39979 5.22786 6.46302 5.0752 6.57557 4.96265C6.68813 4.85009 6.84078 4.78686 6.99996 4.78686C7.15914 4.78686 7.31179 4.85009 7.42435 4.96265C7.5369 5.0752 7.60013 5.22786 7.60013 5.38703V8.18784C7.59806 8.34637 7.53416 8.49782 7.42205 8.60993C7.30995 8.72204 7.15849 8.78594 6.99996 8.78801Z","fill","currentColor"],["d","M6.99996 11.1887C6.84143 11.1866 6.68997 11.1227 6.57787 11.0106C6.46576 10.8985 6.40186 10.7471 6.39979 10.5885V10.1884C6.39979 10.0292 6.46302 9.87658 6.57557 9.76403C6.68813 9.65147 6.84078 9.58824 6.99996 9.58824C7.15914 9.58824 7.31179 9.65147 7.42435 9.76403C7.5369 9.87658 7.60013 10.0292 7.60013 10.1884V10.5885C7.59806 10.7471 7.53416 10.8985 7.42205 11.0106C7.30995 11.1227 7.15849 11.1866 6.99996 11.1887Z","fill","currentColor"],[3,"id"],["width","14","height","14","fill","white"]],template:function(n,s){n&1&&(sn(),G(0,"svg",0)(1,"g"),re(2,"path",1)(3,"path",2)(4,"path",3),W(),G(5,"defs")(6,"clipPath",4),re(7,"rect",5),W()()()),n&2&&(Pe(s.getClassNames()),ue("aria-label",s.ariaLabel)("aria-hidden",s.ariaHidden)("role",s.role),L(),ue("clip-path",s.pathId),L(5),z("id",s.pathId))},encapsulation:2})}return i})();var hy=(()=>{class i extends gn{pathId;ngOnInit(){this.pathId="url(#"+Zn()+")"}static \u0275fac=(()=>{let t;return function(s){return(t||(t=rn(i)))(s||i)}})();static \u0275cmp=Se({type:i,selectors:[["InfoCircleIcon"]],standalone:!0,features:[on,Ne],decls:6,vars:7,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["fill-rule","evenodd","clip-rule","evenodd","d","M3.11101 12.8203C4.26215 13.5895 5.61553 14 7 14C8.85652 14 10.637 13.2625 11.9497 11.9497C13.2625 10.637 14 8.85652 14 7C14 5.61553 13.5895 4.26215 12.8203 3.11101C12.0511 1.95987 10.9579 1.06266 9.67879 0.532846C8.3997 0.00303296 6.99224 -0.13559 5.63437 0.134506C4.2765 0.404603 3.02922 1.07129 2.05026 2.05026C1.07129 3.02922 0.404603 4.2765 0.134506 5.63437C-0.13559 6.99224 0.00303296 8.3997 0.532846 9.67879C1.06266 10.9579 1.95987 12.0511 3.11101 12.8203ZM3.75918 2.14976C4.71846 1.50879 5.84628 1.16667 7 1.16667C8.5471 1.16667 10.0308 1.78125 11.1248 2.87521C12.2188 3.96918 12.8333 5.45291 12.8333 7C12.8333 8.15373 12.4912 9.28154 11.8502 10.2408C11.2093 11.2001 10.2982 11.9478 9.23232 12.3893C8.16642 12.8308 6.99353 12.9463 5.86198 12.7212C4.73042 12.4962 3.69102 11.9406 2.87521 11.1248C2.05941 10.309 1.50384 9.26958 1.27876 8.13803C1.05367 7.00647 1.16919 5.83358 1.61071 4.76768C2.05222 3.70178 2.79989 2.79074 3.75918 2.14976ZM7.00002 4.8611C6.84594 4.85908 6.69873 4.79698 6.58977 4.68801C6.48081 4.57905 6.4187 4.43185 6.41669 4.27776V3.88888C6.41669 3.73417 6.47815 3.58579 6.58754 3.4764C6.69694 3.367 6.84531 3.30554 7.00002 3.30554C7.15473 3.30554 7.3031 3.367 7.4125 3.4764C7.52189 3.58579 7.58335 3.73417 7.58335 3.88888V4.27776C7.58134 4.43185 7.51923 4.57905 7.41027 4.68801C7.30131 4.79698 7.1541 4.85908 7.00002 4.8611ZM7.00002 10.6945C6.84594 10.6925 6.69873 10.6304 6.58977 10.5214C6.48081 10.4124 6.4187 10.2652 6.41669 10.1111V6.22225C6.41669 6.06754 6.47815 5.91917 6.58754 5.80977C6.69694 5.70037 6.84531 5.63892 7.00002 5.63892C7.15473 5.63892 7.3031 5.70037 7.4125 5.80977C7.52189 5.91917 7.58335 6.06754 7.58335 6.22225V10.1111C7.58134 10.2652 7.51923 10.4124 7.41027 10.5214C7.30131 10.6304 7.1541 10.6925 7.00002 10.6945Z","fill","currentColor"],[3,"id"],["width","14","height","14","fill","white"]],template:function(n,s){n&1&&(sn(),G(0,"svg",0)(1,"g"),re(2,"path",1),W(),G(3,"defs")(4,"clipPath",2),re(5,"rect",3),W()()()),n&2&&(Pe(s.getClassNames()),ue("aria-label",s.ariaLabel)("aria-hidden",s.ariaHidden)("role",s.role),L(),ue("clip-path",s.pathId),L(3),z("id",s.pathId))},encapsulation:2})}return i})();var dy=(()=>{class i extends gn{static \u0275fac=(()=>{let t;return function(s){return(t||(t=rn(i)))(s||i)}})();static \u0275cmp=Se({type:i,selectors:[["TimesIcon"]],standalone:!0,features:[on,Ne],decls:2,vars:5,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M8.01186 7.00933L12.27 2.75116C12.341 2.68501 12.398 2.60524 12.4375 2.51661C12.4769 2.42798 12.4982 2.3323 12.4999 2.23529C12.5016 2.13827 12.4838 2.0419 12.4474 1.95194C12.4111 1.86197 12.357 1.78024 12.2884 1.71163C12.2198 1.64302 12.138 1.58893 12.0481 1.55259C11.9581 1.51625 11.8617 1.4984 11.7647 1.50011C11.6677 1.50182 11.572 1.52306 11.4834 1.56255C11.3948 1.60204 11.315 1.65898 11.2488 1.72997L6.99067 5.98814L2.7325 1.72997C2.59553 1.60234 2.41437 1.53286 2.22718 1.53616C2.03999 1.53946 1.8614 1.61529 1.72901 1.74767C1.59663 1.88006 1.5208 2.05865 1.5175 2.24584C1.5142 2.43303 1.58368 2.61419 1.71131 2.75116L5.96948 7.00933L1.71131 11.2675C1.576 11.403 1.5 11.5866 1.5 11.7781C1.5 11.9696 1.576 12.1532 1.71131 12.2887C1.84679 12.424 2.03043 12.5 2.2219 12.5C2.41338 12.5 2.59702 12.424 2.7325 12.2887L6.99067 8.03052L11.2488 12.2887C11.3843 12.424 11.568 12.5 11.7594 12.5C11.9509 12.5 12.1346 12.424 12.27 12.2887C12.4053 12.1532 12.4813 11.9696 12.4813 11.7781C12.4813 11.5866 12.4053 11.403 12.27 11.2675L8.01186 7.00933Z","fill","currentColor"]],template:function(n,s){n&1&&(sn(),G(0,"svg",0),re(1,"path",1),W()),n&2&&(Pe(s.getClassNames()),ue("aria-label",s.ariaLabel)("aria-hidden",s.ariaHidden)("role",s.role))},encapsulation:2})}return i})();var fy=(()=>{class i extends gn{pathId;ngOnInit(){this.pathId="url(#"+Zn()+")"}static \u0275fac=(()=>{let t;return function(s){return(t||(t=rn(i)))(s||i)}})();static \u0275cmp=Se({type:i,selectors:[["TimesCircleIcon"]],standalone:!0,features:[on,Ne],decls:6,vars:7,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["fill-rule","evenodd","clip-rule","evenodd","d","M7 14C5.61553 14 4.26215 13.5895 3.11101 12.8203C1.95987 12.0511 1.06266 10.9579 0.532846 9.67879C0.00303296 8.3997 -0.13559 6.99224 0.134506 5.63437C0.404603 4.2765 1.07129 3.02922 2.05026 2.05026C3.02922 1.07129 4.2765 0.404603 5.63437 0.134506C6.99224 -0.13559 8.3997 0.00303296 9.67879 0.532846C10.9579 1.06266 12.0511 1.95987 12.8203 3.11101C13.5895 4.26215 14 5.61553 14 7C14 8.85652 13.2625 10.637 11.9497 11.9497C10.637 13.2625 8.85652 14 7 14ZM7 1.16667C5.84628 1.16667 4.71846 1.50879 3.75918 2.14976C2.79989 2.79074 2.05222 3.70178 1.61071 4.76768C1.16919 5.83358 1.05367 7.00647 1.27876 8.13803C1.50384 9.26958 2.05941 10.309 2.87521 11.1248C3.69102 11.9406 4.73042 12.4962 5.86198 12.7212C6.99353 12.9463 8.16642 12.8308 9.23232 12.3893C10.2982 11.9478 11.2093 11.2001 11.8502 10.2408C12.4912 9.28154 12.8333 8.15373 12.8333 7C12.8333 5.45291 12.2188 3.96918 11.1248 2.87521C10.0308 1.78125 8.5471 1.16667 7 1.16667ZM4.66662 9.91668C4.58998 9.91704 4.51404 9.90209 4.44325 9.87271C4.37246 9.84333 4.30826 9.8001 4.2544 9.74557C4.14516 9.6362 4.0838 9.48793 4.0838 9.33335C4.0838 9.17876 4.14516 9.0305 4.2544 8.92113L6.17553 7L4.25443 5.07891C4.15139 4.96832 4.09529 4.82207 4.09796 4.67094C4.10063 4.51982 4.16185 4.37563 4.26872 4.26876C4.3756 4.16188 4.51979 4.10066 4.67091 4.09799C4.82204 4.09532 4.96829 4.15142 5.07887 4.25446L6.99997 6.17556L8.92106 4.25446C9.03164 4.15142 9.1779 4.09532 9.32903 4.09799C9.48015 4.10066 9.62434 4.16188 9.73121 4.26876C9.83809 4.37563 9.89931 4.51982 9.90198 4.67094C9.90464 4.82207 9.84855 4.96832 9.74551 5.07891L7.82441 7L9.74554 8.92113C9.85478 9.0305 9.91614 9.17876 9.91614 9.33335C9.91614 9.48793 9.85478 9.6362 9.74554 9.74557C9.69168 9.8001 9.62748 9.84333 9.55669 9.87271C9.4859 9.90209 9.40996 9.91704 9.33332 9.91668C9.25668 9.91704 9.18073 9.90209 9.10995 9.87271C9.03916 9.84333 8.97495 9.8001 8.9211 9.74557L6.99997 7.82444L5.07884 9.74557C5.02499 9.8001 4.96078 9.84333 4.88999 9.87271C4.81921 9.90209 4.74326 9.91704 4.66662 9.91668Z","fill","currentColor"],[3,"id"],["width","14","height","14","fill","white"]],template:function(n,s){n&1&&(sn(),G(0,"svg",0)(1,"g"),re(2,"path",1),W(),G(3,"defs")(4,"clipPath",2),re(5,"rect",3),W()()()),n&2&&(Pe(s.getClassNames()),ue("aria-label",s.ariaLabel)("aria-hidden",s.ariaHidden)("role",s.role),L(),ue("clip-path",s.pathId),L(3),z("id",s.pathId))},encapsulation:2})}return i})();var gt=(()=>{class i{static zindex=1e3;static calculatedScrollbarWidth=null;static calculatedScrollbarHeight=null;static browser;static addClass(t,n){t&&n&&(t.classList?t.classList.add(n):t.className+=" "+n)}static addMultipleClasses(t,n){if(t&&n)if(t.classList){let s=n.trim().split(" ");for(let r=0;r<s.length;r++)t.classList.add(s[r])}else{let s=n.split(" ");for(let r=0;r<s.length;r++)t.className+=" "+s[r]}}static removeClass(t,n){t&&n&&(t.classList?t.classList.remove(n):t.className=t.className.replace(new RegExp("(^|\\b)"+n.split(" ").join("|")+"(\\b|$)","gi")," "))}static removeMultipleClasses(t,n){t&&n&&[n].flat().filter(Boolean).forEach(s=>s.split(" ").forEach(r=>this.removeClass(t,r)))}static hasClass(t,n){return t&&n?t.classList?t.classList.contains(n):new RegExp("(^| )"+n+"( |$)","gi").test(t.className):!1}static siblings(t){return Array.prototype.filter.call(t.parentNode.children,function(n){return n!==t})}static find(t,n){return Array.from(t.querySelectorAll(n))}static findSingle(t,n){return this.isElement(t)?t.querySelector(n):null}static index(t){let n=t.parentNode.childNodes,s=0;for(var r=0;r<n.length;r++){if(n[r]==t)return s;n[r].nodeType==1&&s++}return-1}static indexWithinGroup(t,n){let s=t.parentNode?t.parentNode.childNodes:[],r=0;for(var o=0;o<s.length;o++){if(s[o]==t)return r;s[o].attributes&&s[o].attributes[n]&&s[o].nodeType==1&&r++}return-1}static appendOverlay(t,n,s="self"){s!=="self"&&t&&n&&this.appendChild(t,n)}static alignOverlay(t,n,s="self",r=!0){t&&n&&(r&&(t.style.minWidth=`${i.getOuterWidth(n)}px`),s==="self"?this.relativePosition(t,n):this.absolutePosition(t,n))}static relativePosition(t,n,s=!0){let r=V=>{if(V)return getComputedStyle(V).getPropertyValue("position")==="relative"?V:r(V.parentElement)},o=t.offsetParent?{width:t.offsetWidth,height:t.offsetHeight}:this.getHiddenElementDimensions(t),a=n.offsetHeight??n.getBoundingClientRect().height,c=n.getBoundingClientRect(),u=this.getWindowScrollTop(),d=this.getWindowScrollLeft(),f=this.getViewport(),_=r(t)?.getBoundingClientRect()||{top:-1*u,left:-1*d},v,C;c.top+a+o.height>f.height?(v=c.top-_.top-o.height,t.style.transformOrigin="bottom",c.top+v<0&&(v=-1*c.top)):(v=a+c.top-_.top,t.style.transformOrigin="top");let R=c.left+o.width-f.width,F=c.left-_.left;o.width>f.width?C=(c.left-_.left)*-1:R>0?C=F-R:C=c.left-_.left,t.style.top=v+"px",t.style.left=C+"px",s&&(t.style.marginTop=origin==="bottom"?"calc(var(--p-anchor-gutter) * -1)":"calc(var(--p-anchor-gutter))")}static absolutePosition(t,n,s=!0){let r=t.offsetParent?{width:t.offsetWidth,height:t.offsetHeight}:this.getHiddenElementDimensions(t),o=r.height,a=r.width,c=n.offsetHeight??n.getBoundingClientRect().height,u=n.offsetWidth??n.getBoundingClientRect().width,d=n.getBoundingClientRect(),f=this.getWindowScrollTop(),m=this.getWindowScrollLeft(),_=this.getViewport(),v,C;d.top+c+o>_.height?(v=d.top+f-o,t.style.transformOrigin="bottom",v<0&&(v=f)):(v=c+d.top+f,t.style.transformOrigin="top"),d.left+a>_.width?C=Math.max(0,d.left+m+u-a):C=d.left+m,t.style.top=v+"px",t.style.left=C+"px",s&&(t.style.marginTop=origin==="bottom"?"calc(var(--p-anchor-gutter) * -1)":"calc(var(--p-anchor-gutter))")}static getParents(t,n=[]){return t.parentNode===null?n:this.getParents(t.parentNode,n.concat([t.parentNode]))}static getScrollableParents(t){let n=[];if(t){let s=this.getParents(t),r=/(auto|scroll)/,o=a=>{let c=window.getComputedStyle(a,null);return r.test(c.getPropertyValue("overflow"))||r.test(c.getPropertyValue("overflowX"))||r.test(c.getPropertyValue("overflowY"))};for(let a of s){let c=a.nodeType===1&&a.dataset.scrollselectors;if(c){let u=c.split(",");for(let d of u){let f=this.findSingle(a,d);f&&o(f)&&n.push(f)}}a.nodeType!==9&&o(a)&&n.push(a)}}return n}static getHiddenElementOuterHeight(t){t.style.visibility="hidden",t.style.display="block";let n=t.offsetHeight;return t.style.display="none",t.style.visibility="visible",n}static getHiddenElementOuterWidth(t){t.style.visibility="hidden",t.style.display="block";let n=t.offsetWidth;return t.style.display="none",t.style.visibility="visible",n}static getHiddenElementDimensions(t){let n={};return t.style.visibility="hidden",t.style.display="block",n.width=t.offsetWidth,n.height=t.offsetHeight,t.style.display="none",t.style.visibility="visible",n}static scrollInView(t,n){let s=getComputedStyle(t).getPropertyValue("borderTopWidth"),r=s?parseFloat(s):0,o=getComputedStyle(t).getPropertyValue("paddingTop"),a=o?parseFloat(o):0,c=t.getBoundingClientRect(),d=n.getBoundingClientRect().top+document.body.scrollTop-(c.top+document.body.scrollTop)-r-a,f=t.scrollTop,m=t.clientHeight,_=this.getOuterHeight(n);d<0?t.scrollTop=f+d:d+_>m&&(t.scrollTop=f+d-m+_)}static fadeIn(t,n){t.style.opacity=0;let s=+new Date,r=0,o=function(){r=+t.style.opacity.replace(",",".")+(new Date().getTime()-s)/n,t.style.opacity=r,s=+new Date,+r<1&&(window.requestAnimationFrame&&requestAnimationFrame(o)||setTimeout(o,16))};o()}static fadeOut(t,n){var s=1,r=50,o=n,a=r/o;let c=setInterval(()=>{s=s-a,s<=0&&(s=0,clearInterval(c)),t.style.opacity=s},r)}static getWindowScrollTop(){let t=document.documentElement;return(window.pageYOffset||t.scrollTop)-(t.clientTop||0)}static getWindowScrollLeft(){let t=document.documentElement;return(window.pageXOffset||t.scrollLeft)-(t.clientLeft||0)}static matches(t,n){var s=Element.prototype,r=s.matches||s.webkitMatchesSelector||s.mozMatchesSelector||s.msMatchesSelector||function(o){return[].indexOf.call(document.querySelectorAll(o),this)!==-1};return r.call(t,n)}static getOuterWidth(t,n){let s=t.offsetWidth;if(n){let r=getComputedStyle(t);s+=parseFloat(r.marginLeft)+parseFloat(r.marginRight)}return s}static getHorizontalPadding(t){let n=getComputedStyle(t);return parseFloat(n.paddingLeft)+parseFloat(n.paddingRight)}static getHorizontalMargin(t){let n=getComputedStyle(t);return parseFloat(n.marginLeft)+parseFloat(n.marginRight)}static innerWidth(t){let n=t.offsetWidth,s=getComputedStyle(t);return n+=parseFloat(s.paddingLeft)+parseFloat(s.paddingRight),n}static width(t){let n=t.offsetWidth,s=getComputedStyle(t);return n-=parseFloat(s.paddingLeft)+parseFloat(s.paddingRight),n}static getInnerHeight(t){let n=t.offsetHeight,s=getComputedStyle(t);return n+=parseFloat(s.paddingTop)+parseFloat(s.paddingBottom),n}static getOuterHeight(t,n){let s=t.offsetHeight;if(n){let r=getComputedStyle(t);s+=parseFloat(r.marginTop)+parseFloat(r.marginBottom)}return s}static getHeight(t){let n=t.offsetHeight,s=getComputedStyle(t);return n-=parseFloat(s.paddingTop)+parseFloat(s.paddingBottom)+parseFloat(s.borderTopWidth)+parseFloat(s.borderBottomWidth),n}static getWidth(t){let n=t.offsetWidth,s=getComputedStyle(t);return n-=parseFloat(s.paddingLeft)+parseFloat(s.paddingRight)+parseFloat(s.borderLeftWidth)+parseFloat(s.borderRightWidth),n}static getViewport(){let t=window,n=document,s=n.documentElement,r=n.getElementsByTagName("body")[0],o=t.innerWidth||s.clientWidth||r.clientWidth,a=t.innerHeight||s.clientHeight||r.clientHeight;return{width:o,height:a}}static getOffset(t){var n=t.getBoundingClientRect();return{top:n.top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0),left:n.left+(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0)}}static replaceElementWith(t,n){let s=t.parentNode;if(!s)throw"Can't replace element";return s.replaceChild(n,t)}static getUserAgent(){if(navigator&&this.isClient())return navigator.userAgent}static isIE(){var t=window.navigator.userAgent,n=t.indexOf("MSIE ");if(n>0)return!0;var s=t.indexOf("Trident/");if(s>0){var r=t.indexOf("rv:");return!0}var o=t.indexOf("Edge/");return o>0}static isIOS(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}static isAndroid(){return/(android)/i.test(navigator.userAgent)}static isTouchDevice(){return"ontouchstart"in window||navigator.maxTouchPoints>0}static appendChild(t,n){if(this.isElement(n))n.appendChild(t);else if(n&&n.el&&n.el.nativeElement)n.el.nativeElement.appendChild(t);else throw"Cannot append "+n+" to "+t}static removeChild(t,n){if(this.isElement(n))n.removeChild(t);else if(n.el&&n.el.nativeElement)n.el.nativeElement.removeChild(t);else throw"Cannot remove "+t+" from "+n}static removeElement(t){"remove"in Element.prototype?t.remove():t.parentNode.removeChild(t)}static isElement(t){return typeof HTMLElement=="object"?t instanceof HTMLElement:t&&typeof t=="object"&&t!==null&&t.nodeType===1&&typeof t.nodeName=="string"}static calculateScrollbarWidth(t){if(t){let n=getComputedStyle(t);return t.offsetWidth-t.clientWidth-parseFloat(n.borderLeftWidth)-parseFloat(n.borderRightWidth)}else{if(this.calculatedScrollbarWidth!==null)return this.calculatedScrollbarWidth;let n=document.createElement("div");n.className="p-scrollbar-measure",document.body.appendChild(n);let s=n.offsetWidth-n.clientWidth;return document.body.removeChild(n),this.calculatedScrollbarWidth=s,s}}static calculateScrollbarHeight(){if(this.calculatedScrollbarHeight!==null)return this.calculatedScrollbarHeight;let t=document.createElement("div");t.className="p-scrollbar-measure",document.body.appendChild(t);let n=t.offsetHeight-t.clientHeight;return document.body.removeChild(t),this.calculatedScrollbarWidth=n,n}static invokeElementMethod(t,n,s){t[n].apply(t,s)}static clearSelection(){if(window.getSelection)window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().rangeCount>0&&window.getSelection().getRangeAt(0).getClientRects().length>0&&window.getSelection().removeAllRanges();else if(document.selection&&document.selection.empty)try{document.selection.empty()}catch{}}static getBrowser(){if(!this.browser){let t=this.resolveUserAgent();this.browser={},t.browser&&(this.browser[t.browser]=!0,this.browser.version=t.version),this.browser.chrome?this.browser.webkit=!0:this.browser.webkit&&(this.browser.safari=!0)}return this.browser}static resolveUserAgent(){let t=navigator.userAgent.toLowerCase(),n=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return{browser:n[1]||"",version:n[2]||"0"}}static isInteger(t){return Number.isInteger?Number.isInteger(t):typeof t=="number"&&isFinite(t)&&Math.floor(t)===t}static isHidden(t){return!t||t.offsetParent===null}static isVisible(t){return t&&t.offsetParent!=null}static isExist(t){return t!==null&&typeof t<"u"&&t.nodeName&&t.parentNode}static focus(t,n){t&&document.activeElement!==t&&t.focus(n)}static getFocusableSelectorString(t=""){return`button:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${t},
        [href][clientHeight][clientWidth]:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${t},
        input:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${t},
        select:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${t},
        textarea:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${t},
        [tabIndex]:not([tabIndex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${t},
        [contenteditable]:not([tabIndex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${t},
        .p-inputtext:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${t},
        .p-button:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${t}`}static getFocusableElements(t,n=""){let s=this.find(t,this.getFocusableSelectorString(n)),r=[];for(let o of s){let a=getComputedStyle(o);this.isVisible(o)&&a.display!="none"&&a.visibility!="hidden"&&r.push(o)}return r}static getFocusableElement(t,n=""){let s=this.findSingle(t,this.getFocusableSelectorString(n));if(s){let r=getComputedStyle(s);if(this.isVisible(s)&&r.display!="none"&&r.visibility!="hidden")return s}return null}static getFirstFocusableElement(t,n=""){let s=this.getFocusableElements(t,n);return s.length>0?s[0]:null}static getLastFocusableElement(t,n){let s=this.getFocusableElements(t,n);return s.length>0?s[s.length-1]:null}static getNextFocusableElement(t,n=!1){let s=i.getFocusableElements(t),r=0;if(s&&s.length>0){let o=s.indexOf(s[0].ownerDocument.activeElement);n?o==-1||o===0?r=s.length-1:r=o-1:o!=-1&&o!==s.length-1&&(r=o+1)}return s[r]}static generateZIndex(){return this.zindex=this.zindex||999,++this.zindex}static getSelection(){return window.getSelection?window.getSelection().toString():document.getSelection?document.getSelection().toString():document.selection?document.selection.createRange().text:null}static getTargetElement(t,n){if(!t)return null;switch(t){case"document":return document;case"window":return window;case"@next":return n?.nextElementSibling;case"@prev":return n?.previousElementSibling;case"@parent":return n?.parentElement;case"@grandparent":return n?.parentElement.parentElement;default:let s=typeof t;if(s==="string")return document.querySelector(t);if(s==="object"&&t.hasOwnProperty("nativeElement"))return this.isExist(t.nativeElement)?t.nativeElement:void 0;let o=(a=>!!(a&&a.constructor&&a.call&&a.apply))(t)?t():t;return o&&o.nodeType===9||this.isExist(o)?o:null}}static isClient(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}static getAttribute(t,n){if(t){let s=t.getAttribute(n);return isNaN(s)?s==="true"||s==="false"?s==="true":s:+s}}static calculateBodyScrollbarWidth(){return window.innerWidth-document.documentElement.offsetWidth}static blockBodyScroll(t="p-overflow-hidden"){document.body.style.setProperty("--scrollbar-width",this.calculateBodyScrollbarWidth()+"px"),this.addClass(document.body,t)}static unblockBodyScroll(t="p-overflow-hidden"){document.body.style.removeProperty("--scrollbar-width"),this.removeClass(document.body,t)}static createElement(t,n={},...s){if(t){let r=document.createElement(t);return this.setAttributes(r,n),r.append(...s),r}}static setAttribute(t,n="",s){this.isElement(t)&&s!==null&&s!==void 0&&t.setAttribute(n,s)}static setAttributes(t,n={}){if(this.isElement(t)){let s=(r,o)=>{let a=t?.$attrs?.[r]?[t?.$attrs?.[r]]:[];return[o].flat().reduce((c,u)=>{if(u!=null){let d=typeof u;if(d==="string"||d==="number")c.push(u);else if(d==="object"){let f=Array.isArray(u)?s(r,u):Object.entries(u).map(([m,_])=>r==="style"&&(_||_===0)?`${m.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}:${_}`:_?m:void 0);c=f.length?c.concat(f.filter(m=>!!m)):c}}return c},a)};Object.entries(n).forEach(([r,o])=>{if(o!=null){let a=r.match(/^on(.+)/);a?t.addEventListener(a[1].toLowerCase(),o):r==="pBind"?this.setAttributes(t,o):(o=r==="class"?[...new Set(s("class",o))].join(" ").trim():r==="style"?s("style",o).join(";").trim():o,(t.$attrs=t.$attrs||{})&&(t.$attrs[r]=o),t.setAttribute(r,o))}})}}static isFocusableElement(t,n=""){return this.isElement(t)?t.matches(`button:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${n},
                [href][clientHeight][clientWidth]:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${n},
                input:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${n},
                select:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${n},
                textarea:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${n},
                [tabIndex]:not([tabIndex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${n},
                [contenteditable]:not([tabIndex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${n}`):!1}}return i})();var td=(()=>{class i{document;platformId;renderer;el;zone;config;constructor(t,n,s,r,o,a){this.document=t,this.platformId=n,this.renderer=s,this.el=r,this.zone=o,this.config=a}animationListener;mouseDownListener;timeout;ngAfterViewInit(){ac(this.platformId)&&this.config&&this.config.ripple&&this.zone.runOutsideAngular(()=>{this.create(),this.mouseDownListener=this.renderer.listen(this.el.nativeElement,"mousedown",this.onMouseDown.bind(this))})}onMouseDown(t){let n=this.getInk();if(!n||this.document.defaultView?.getComputedStyle(n,null).display==="none")return;if(gt.removeClass(n,"p-ink-active"),!gt.getHeight(n)&&!gt.getWidth(n)){let a=Math.max(gt.getOuterWidth(this.el.nativeElement),gt.getOuterHeight(this.el.nativeElement));n.style.height=a+"px",n.style.width=a+"px"}let s=gt.getOffset(this.el.nativeElement),r=t.pageX-s.left+this.document.body.scrollTop-gt.getWidth(n)/2,o=t.pageY-s.top+this.document.body.scrollLeft-gt.getHeight(n)/2;this.renderer.setStyle(n,"top",o+"px"),this.renderer.setStyle(n,"left",r+"px"),gt.addClass(n,"p-ink-active"),this.timeout=setTimeout(()=>{let a=this.getInk();a&&gt.removeClass(a,"p-ink-active")},401)}getInk(){let t=this.el.nativeElement.children;for(let n=0;n<t.length;n++)if(typeof t[n].className=="string"&&t[n].className.indexOf("p-ink")!==-1)return t[n];return null}resetInk(){let t=this.getInk();t&&gt.removeClass(t,"p-ink-active")}onAnimationEnd(t){this.timeout&&clearTimeout(this.timeout),gt.removeClass(t.currentTarget,"p-ink-active")}create(){let t=this.renderer.createElement("span");this.renderer.addClass(t,"p-ink"),this.renderer.appendChild(this.el.nativeElement,t),this.renderer.setAttribute(t,"aria-hidden","true"),this.renderer.setAttribute(t,"role","presentation"),this.animationListener||(this.animationListener=this.renderer.listen(t,"animationend",this.onAnimationEnd.bind(this)))}remove(){let t=this.getInk();t&&(this.mouseDownListener&&this.mouseDownListener(),this.animationListener&&this.animationListener(),this.mouseDownListener=null,this.animationListener=null,gt.removeElement(t))}ngOnDestroy(){this.config&&this.config.ripple&&this.remove()}static \u0275fac=function(n){return new(n||i)(he(an),he(Ni),he(ec),he(_s),he(zt),he(Il,8))};static \u0275dir=Pi({type:i,selectors:[["","pRipple",""]],hostAttrs:[1,"p-ripple","p-element"],standalone:!0})}return i})(),sb=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=Ot({type:i});static \u0275inj=Dt({})}return i})();var ob=["container"],$x=i=>[i,"p-toast-message"],Yx=(i,e,t,n)=>({showTransformParams:i,hideTransformParams:e,showTransitionParams:t,hideTransitionParams:n}),Jx=i=>({value:"visible",params:i}),Xx=(i,e)=>({$implicit:i,closeFn:e}),Zx=i=>({$implicit:i});function eD(i,e){i&1&&Jo(0)}function tD(i,e){if(i&1&&(En(0),be(1,eD,1,0,"ng-container",4),wn()),i&2){let t=ne();L(),z("ngTemplateOutlet",t.headlessTemplate)("ngTemplateOutletContext",f0(2,Xx,t.message,t.onCloseIconClick))}}function nD(i,e){if(i&1&&re(0,"span"),i&2){let t=ne(3);Pe("p-toast-message-icon pi "+t.message.icon)}}function iD(i,e){i&1&&re(0,"CheckIcon"),i&2&&ue("aria-hidden",!0)("data-pc-section","icon")}function sD(i,e){i&1&&re(0,"InfoCircleIcon"),i&2&&ue("aria-hidden",!0)("data-pc-section","icon")}function rD(i,e){i&1&&re(0,"TimesCircleIcon"),i&2&&ue("aria-hidden",!0)("data-pc-section","icon")}function oD(i,e){i&1&&re(0,"ExclamationTriangleIcon"),i&2&&ue("aria-hidden",!0)("data-pc-section","icon")}function aD(i,e){if(i&1&&(G(0,"span",13),En(1),be(2,iD,1,2,"CheckIcon",6)(3,sD,1,2,"InfoCircleIcon",6)(4,rD,1,2,"TimesCircleIcon",6)(5,oD,1,2,"ExclamationTriangleIcon",6),wn(),W()),i&2){let t=ne(3);ue("aria-hidden",!0)("data-pc-section","icon"),L(2),z("ngIf",t.message.severity==="success"),L(),z("ngIf",t.message.severity==="info"),L(),z("ngIf",t.message.severity==="error"),L(),z("ngIf",t.message.severity==="warn")}}function lD(i,e){if(i&1&&(En(0),be(1,nD,1,2,"span",8)(2,aD,6,6,"span",9),G(3,"div",10)(4,"div",11),oe(5),W(),G(6,"div",12),oe(7),W()(),wn()),i&2){let t=ne(2);L(),z("ngIf",t.message.icon),L(),z("ngIf",!t.message.icon),L(),ue("data-pc-section","text"),L(),ue("data-pc-section","summary"),L(),kn(t.message.summary),L(),ue("data-pc-section","detail"),L(),kn(t.message.detail)}}function cD(i,e){i&1&&Jo(0)}function uD(i,e){if(i&1&&re(0,"span"),i&2){let t=ne(3);Pe("pt-1 text-base p-toast-message-icon pi "+t.message.closeIcon)}}function hD(i,e){i&1&&re(0,"TimesIcon",16),i&2&&(z("styleClass","p-toast-icon-close-icon"),ue("aria-hidden",!0)("data-pc-section","closeicon"))}function dD(i,e){if(i&1){let t=Tn();G(0,"button",14),Ue("click",function(s){Ct(t);let r=ne(2);return St(r.onCloseIconClick(s))})("keydown.enter",function(s){Ct(t);let r=ne(2);return St(r.onCloseIconClick(s))}),be(1,uD,1,2,"span",8)(2,hD,1,3,"TimesIcon",15),W()}if(i&2){let t=ne(2);ue("aria-label",t.closeAriaLabel)("data-pc-section","closebutton"),L(),z("ngIf",t.message.closeIcon),L(),z("ngIf",!t.message.closeIcon)}}function fD(i,e){if(i&1&&(G(0,"div",5),be(1,lD,8,7,"ng-container",6)(2,cD,1,0,"ng-container",4)(3,dD,3,4,"button",7),W()),i&2){let t=ne();z("ngClass",t.message==null?null:t.message.contentStyleClass),ue("data-pc-section","content"),L(),z("ngIf",!t.template),L(),z("ngTemplateOutlet",t.template)("ngTemplateOutletContext",li(6,Zx,t.message)),L(),z("ngIf",(t.message==null?null:t.message.closable)!==!1)}}function pD(i,e){if(i&1){let t=Tn();G(0,"p-toastItem",3),Ue("onClose",function(s){Ct(t);let r=ne();return St(r.onMessageClose(s))})("@toastAnimation.start",function(s){Ct(t);let r=ne();return St(r.onAnimationStart(s))})("@toastAnimation.done",function(s){Ct(t);let r=ne();return St(r.onAnimationEnd(s))}),W()}if(i&2){let t=e.$implicit,n=e.index,s=ne();z("message",t)("index",n)("life",s.life)("template",s.template)("headlessTemplate",s.headlessTemplate)("@toastAnimation",void 0)("showTransformOptions",s.showTransformOptions)("hideTransformOptions",s.hideTransformOptions)("showTransitionOptions",s.showTransitionOptions)("hideTransitionOptions",s.hideTransitionOptions)}}var mD=(()=>{class i{zone;config;message;index;life;template;headlessTemplate;showTransformOptions;hideTransformOptions;showTransitionOptions;hideTransitionOptions;onClose=new oi;containerViewChild;timeout;constructor(t,n){this.zone=t,this.config=n}ngAfterViewInit(){this.initTimeout()}initTimeout(){this.message?.sticky||this.zone.runOutsideAngular(()=>{this.timeout=setTimeout(()=>{this.onClose.emit({index:this.index,message:this.message})},this.message?.life||this.life||3e3)})}clearTimeout(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null)}onMouseEnter(){this.clearTimeout()}onMouseLeave(){this.initTimeout()}onCloseIconClick=t=>{this.clearTimeout(),this.onClose.emit({index:this.index,message:this.message}),t.preventDefault()};get closeAriaLabel(){return this.config.translation.aria?this.config.translation.aria.close:void 0}ngOnDestroy(){this.clearTimeout()}static \u0275fac=function(n){return new(n||i)(he(zt),he(Il))};static \u0275cmp=Se({type:i,selectors:[["p-toastItem"]],viewQuery:function(n,s){if(n&1&&Yd(ob,5),n&2){let r;pr(r=mr())&&(s.containerViewChild=r.first)}},hostAttrs:[1,"p-element"],inputs:{message:"message",index:[2,"index","index",Ts],life:[2,"life","life",Ts],template:"template",headlessTemplate:"headlessTemplate",showTransformOptions:"showTransformOptions",hideTransformOptions:"hideTransformOptions",showTransitionOptions:"showTransitionOptions",hideTransitionOptions:"hideTransitionOptions"},outputs:{onClose:"onClose"},features:[ai],decls:5,vars:18,consts:[["container",""],["notHeadless",""],["role","alert","aria-live","assertive","aria-atomic","true",3,"mouseenter","mouseleave","ngClass"],[4,"ngIf","ngIfElse"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"p-toast-message-content",3,"ngClass"],[4,"ngIf"],["type","button","class","p-toast-icon-close p-link","pRipple","",3,"click","keydown.enter",4,"ngIf"],[3,"class",4,"ngIf"],["class","p-toast-message-icon",4,"ngIf"],[1,"p-toast-message-text"],[1,"p-toast-summary"],[1,"p-toast-detail"],[1,"p-toast-message-icon"],["type","button","pRipple","",1,"p-toast-icon-close","p-link",3,"click","keydown.enter"],[3,"styleClass",4,"ngIf"],[3,"styleClass"]],template:function(n,s){if(n&1){let r=Tn();G(0,"div",2,0),Ue("mouseenter",function(){return Ct(r),St(s.onMouseEnter())})("mouseleave",function(){return Ct(r),St(s.onMouseLeave())}),be(2,tD,2,5,"ng-container",3)(3,fD,4,8,"ng-template",null,1,m0),W()}if(n&2){let r=u0(4);Pe(s.message==null?null:s.message.styleClass),z("ngClass",li(9,$x,"p-toast-message-"+(s.message==null?null:s.message.severity)))("@messageState",li(16,Jx,p0(11,Yx,s.showTransformOptions,s.hideTransformOptions,s.showTransitionOptions,s.hideTransitionOptions))),ue("id",s.message==null?null:s.message.id)("data-pc-name","toast")("data-pc-section","root"),L(2),z("ngIf",s.headlessTemplate)("ngIfElse",r)}},dependencies:()=>[Zo,In,rc,td,cy,hy,fy,uy,dy],encapsulation:2,data:{animation:[Sl("messageState",[Ao("visible",xn({transform:"translateY(0)",opacity:1})),sr("void => *",[xn({transform:"{{showTransformParams}}",opacity:0}),bo("{{showTransitionParams}}")]),sr("* => void",[bo("{{hideTransitionParams}}",xn({height:0,opacity:0,transform:"{{hideTransformParams}}"}))])])]},changeDetection:0})}return i})(),ab=(()=>{class i{document;renderer;messageService;cd;config;key;autoZIndex=!0;baseZIndex=0;life=3e3;style;styleClass;get position(){return this._position}set position(t){this._position=t,this.cd.markForCheck()}preventOpenDuplicates=!1;preventDuplicates=!1;showTransformOptions="translateY(100%)";hideTransformOptions="translateY(-100%)";showTransitionOptions="300ms ease-out";hideTransitionOptions="250ms ease-in";breakpoints;onClose=new oi;containerViewChild;templates;messageSubscription;clearSubscription;messages;messagesArchieve;template;headlessTemplate;_position="top-right";constructor(t,n,s,r,o){this.document=t,this.renderer=n,this.messageService=s,this.cd=r,this.config=o}styleElement;id=Zn();ngOnInit(){this.messageSubscription=this.messageService.messageObserver.subscribe(t=>{if(t)if(Array.isArray(t)){let n=t.filter(s=>this.canAdd(s));this.add(n)}else this.canAdd(t)&&this.add([t])}),this.clearSubscription=this.messageService.clearObserver.subscribe(t=>{t?this.key===t&&(this.messages=null):this.messages=null,this.cd.markForCheck()})}ngAfterViewInit(){this.breakpoints&&this.createStyle()}add(t){this.messages=this.messages?[...this.messages,...t]:[...t],this.preventDuplicates&&(this.messagesArchieve=this.messagesArchieve?[...this.messagesArchieve,...t]:[...t]),this.cd.markForCheck()}canAdd(t){let n=this.key===t.key;return n&&this.preventOpenDuplicates&&(n=!this.containsMessage(this.messages,t)),n&&this.preventDuplicates&&(n=!this.containsMessage(this.messagesArchieve,t)),n}containsMessage(t,n){return t?t.find(s=>s.summary===n.summary&&s.detail==n.detail&&s.severity===n.severity)!=null:!1}ngAfterContentInit(){this.templates?.forEach(t=>{switch(t.getType()){case"message":this.template=t.template;break;case"headless":this.headlessTemplate=t.template;break;default:this.template=t.template;break}})}onMessageClose(t){this.messages?.splice(t.index,1),this.onClose.emit({message:t.message}),this.cd.detectChanges()}onAnimationStart(t){t.fromState==="void"&&(this.renderer.setAttribute(this.containerViewChild?.nativeElement,this.id,""),this.autoZIndex&&this.containerViewChild?.nativeElement.style.zIndex===""&&Jh.set("modal",this.containerViewChild?.nativeElement,this.baseZIndex||this.config.zIndex.modal))}onAnimationEnd(t){t.toState==="void"&&this.autoZIndex&&Co.isEmpty(this.messages)&&Jh.clear(this.containerViewChild?.nativeElement)}createStyle(){if(!this.styleElement){this.styleElement=this.renderer.createElement("style"),this.styleElement.type="text/css",gt.setAttribute(this.styleElement,"nonce",this.config?.csp()?.nonce),this.renderer.appendChild(this.document.head,this.styleElement);let t="";for(let n in this.breakpoints){let s="";for(let r in this.breakpoints[n])s+=r+":"+this.breakpoints[n][r]+" !important;";t+=`
                    @media screen and (max-width: ${n}) {
                        .p-toast[${this.id}] {
                           ${s}
                        }
                    }
                `}this.renderer.setProperty(this.styleElement,"innerHTML",t)}}destroyStyle(){this.styleElement&&(this.renderer.removeChild(this.document.head,this.styleElement),this.styleElement=null)}ngOnDestroy(){this.messageSubscription&&this.messageSubscription.unsubscribe(),this.containerViewChild&&this.autoZIndex&&Jh.clear(this.containerViewChild.nativeElement),this.clearSubscription&&this.clearSubscription.unsubscribe(),this.destroyStyle()}static \u0275fac=function(n){return new(n||i)(he(an),he(ec),he(So),he(_0),he(Il))};static \u0275cmp=Se({type:i,selectors:[["p-toast"]],contentQueries:function(n,s,r){if(n&1&&tc(r,Xh,4),n&2){let o;pr(o=mr())&&(s.templates=o)}},viewQuery:function(n,s){if(n&1&&Yd(ob,5),n&2){let r;pr(r=mr())&&(s.containerViewChild=r.first)}},hostAttrs:[1,"p-element"],inputs:{key:"key",autoZIndex:[2,"autoZIndex","autoZIndex",ft],baseZIndex:[2,"baseZIndex","baseZIndex",Ts],life:[2,"life","life",Ts],style:"style",styleClass:"styleClass",position:"position",preventOpenDuplicates:[2,"preventOpenDuplicates","preventOpenDuplicates",ft],preventDuplicates:[2,"preventDuplicates","preventDuplicates",ft],showTransformOptions:"showTransformOptions",hideTransformOptions:"hideTransformOptions",showTransitionOptions:"showTransitionOptions",hideTransitionOptions:"hideTransitionOptions",breakpoints:"breakpoints"},outputs:{onClose:"onClose"},features:[ai],decls:3,vars:5,consts:[["container",""],[1,"p-toast","p-component",3,"ngClass","ngStyle"],[3,"message","index","life","template","headlessTemplate","showTransformOptions","hideTransformOptions","showTransitionOptions","hideTransitionOptions","onClose",4,"ngFor","ngForOf"],[3,"onClose","message","index","life","template","headlessTemplate","showTransformOptions","hideTransformOptions","showTransitionOptions","hideTransitionOptions"]],template:function(n,s){n&1&&(G(0,"div",1,0),be(2,pD,1,10,"p-toastItem",2),W()),n&2&&(Pe(s.styleClass),z("ngClass","p-toast-"+s._position)("ngStyle",s.style),L(2),z("ngForOf",s.messages))},dependencies:[Zo,ic,sc,mD],styles:[`@layer primeng{.p-toast{position:fixed;width:25rem}.p-toast-message{overflow:hidden}.p-toast-message-content{display:flex;align-items:flex-start}.p-toast-message-text{flex:1 1 auto}.p-toast-top-right{top:20px;right:20px}.p-toast-top-left{top:20px;left:20px}.p-toast-bottom-left{bottom:20px;left:20px}.p-toast-bottom-right{bottom:20px;right:20px}.p-toast-top-center{top:20px;left:50%;transform:translate(-50%)}.p-toast-bottom-center{bottom:20px;left:50%;transform:translate(-50%)}.p-toast-center{left:50%;top:50%;min-width:20vw;transform:translate(-50%,-50%)}.p-toast-icon-close{display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative;flex:none}.p-toast-icon-close.p-link{cursor:pointer}}
`],encapsulation:2,data:{animation:[Sl("toastAnimation",[sr(":enter, :leave",[ib("@*",nb())])])]},changeDetection:0})}return i})(),nd=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=Ot({type:i});static \u0275inj=Dt({imports:[Di,sb,cy,hy,fy,uy,dy,Zh]})}return i})();var lb=(()=>{class i{autofocus=!1;focused=!1;platformId=lt(Ni);document=lt(an);host=lt(_s);ngAfterContentChecked(){this.autofocus===!1?this.host.nativeElement.removeAttribute("autofocus"):this.host.nativeElement.setAttribute("autofocus",!0),this.focused||this.autoFocus()}ngAfterViewChecked(){this.focused||this.autoFocus()}autoFocus(){ac(this.platformId)&&this.autofocus&&setTimeout(()=>{let t=gt.getFocusableElements(this.host?.nativeElement);t.length===0&&this.host.nativeElement.focus(),t.length>0&&t[0].focus(),this.focused=!0})}static \u0275fac=function(n){return new(n||i)};static \u0275dir=Pi({type:i,selectors:[["","pAutoFocus",""]],hostAttrs:[1,"p-element"],inputs:{autofocus:[2,"autofocus","autofocus",ft]},standalone:!0,features:[ai]})}return i})();var cb=(()=>{class i extends gn{pathId;ngOnInit(){this.pathId="url(#"+Zn()+")"}static \u0275fac=(()=>{let t;return function(s){return(t||(t=rn(i)))(s||i)}})();static \u0275cmp=Se({type:i,selectors:[["SpinnerIcon"]],standalone:!0,features:[on,Ne],decls:6,vars:7,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M6.99701 14C5.85441 13.999 4.72939 13.7186 3.72012 13.1832C2.71084 12.6478 1.84795 11.8737 1.20673 10.9284C0.565504 9.98305 0.165424 8.89526 0.041387 7.75989C-0.0826496 6.62453 0.073125 5.47607 0.495122 4.4147C0.917119 3.35333 1.59252 2.4113 2.46241 1.67077C3.33229 0.930247 4.37024 0.413729 5.4857 0.166275C6.60117 -0.0811796 7.76026 -0.0520535 8.86188 0.251112C9.9635 0.554278 10.9742 1.12227 11.8057 1.90555C11.915 2.01493 11.9764 2.16319 11.9764 2.31778C11.9764 2.47236 11.915 2.62062 11.8057 2.73C11.7521 2.78503 11.688 2.82877 11.6171 2.85864C11.5463 2.8885 11.4702 2.90389 11.3933 2.90389C11.3165 2.90389 11.2404 2.8885 11.1695 2.85864C11.0987 2.82877 11.0346 2.78503 10.9809 2.73C9.9998 1.81273 8.73246 1.26138 7.39226 1.16876C6.05206 1.07615 4.72086 1.44794 3.62279 2.22152C2.52471 2.99511 1.72683 4.12325 1.36345 5.41602C1.00008 6.70879 1.09342 8.08723 1.62775 9.31926C2.16209 10.5513 3.10478 11.5617 4.29713 12.1803C5.48947 12.7989 6.85865 12.988 8.17414 12.7157C9.48963 12.4435 10.6711 11.7264 11.5196 10.6854C12.3681 9.64432 12.8319 8.34282 12.8328 7C12.8328 6.84529 12.8943 6.69692 13.0038 6.58752C13.1132 6.47812 13.2616 6.41667 13.4164 6.41667C13.5712 6.41667 13.7196 6.47812 13.8291 6.58752C13.9385 6.69692 14 6.84529 14 7C14 8.85651 13.2622 10.637 11.9489 11.9497C10.6356 13.2625 8.85432 14 6.99701 14Z","fill","currentColor"],[3,"id"],["width","14","height","14","fill","white"]],template:function(n,s){n&1&&(sn(),G(0,"svg",0)(1,"g"),re(2,"path",1),W(),G(3,"defs")(4,"clipPath",2),re(5,"rect",3),W()()()),n&2&&(Pe(s.getClassNames()),ue("aria-label",s.ariaLabel)("aria-hidden",s.ariaHidden)("role",s.role),L(),ue("clip-path",s.pathId),L(3),z("id",s.pathId))},encapsulation:2})}return i})();var _D=["*"],ub=i=>({class:i});function yD(i,e){i&1&&Jo(0)}function vD(i,e){if(i&1&&re(0,"span",8),i&2){let t=ne(3);z("ngClass",t.iconClass()),ue("aria-hidden",!0)("data-pc-section","loadingicon")}}function ED(i,e){if(i&1&&re(0,"SpinnerIcon",9),i&2){let t=ne(3);z("styleClass",t.spinnerIconClass())("spin",!0),ue("aria-hidden",!0)("data-pc-section","loadingicon")}}function wD(i,e){if(i&1&&(En(0),be(1,vD,1,3,"span",6)(2,ED,1,4,"SpinnerIcon",7),wn()),i&2){let t=ne(2);L(),z("ngIf",t.loadingIcon),L(),z("ngIf",!t.loadingIcon)}}function TD(i,e){}function ID(i,e){if(i&1&&be(0,TD,0,0,"ng-template",10),i&2){let t=ne(2);z("ngIf",t.loadingIconTemplate)}}function CD(i,e){if(i&1&&(En(0),be(1,wD,3,2,"ng-container",2)(2,ID,1,1,null,5),wn()),i&2){let t=ne();L(),z("ngIf",!t.loadingIconTemplate),L(),z("ngTemplateOutlet",t.loadingIconTemplate)("ngTemplateOutletContext",li(3,ub,t.iconClass()))}}function SD(i,e){if(i&1&&re(0,"span",8),i&2){let t=ne(2);z("ngClass",t.iconClass()),ue("data-pc-section","icon")}}function bD(i,e){}function AD(i,e){if(i&1&&be(0,bD,0,0,"ng-template",10),i&2){let t=ne(2);z("ngIf",!t.icon&&t.iconTemplate)}}function RD(i,e){if(i&1&&(En(0),be(1,SD,1,2,"span",6)(2,AD,1,1,null,5),wn()),i&2){let t=ne();L(),z("ngIf",t.icon&&!t.iconTemplate),L(),z("ngTemplateOutlet",t.iconTemplate)("ngTemplateOutletContext",li(3,ub,t.iconClass()))}}function PD(i,e){if(i&1&&(G(0,"span",11),oe(1),W()),i&2){let t=ne();ue("aria-hidden",t.icon&&!t.label)("data-pc-section","label"),L(),kn(t.label)}}function ND(i,e){if(i&1&&(G(0,"span",8),oe(1),W()),i&2){let t=ne();Pe(t.badgeClass),z("ngClass",t.badgeStyleClass()),ue("data-pc-section","badge"),L(),kn(t.badge)}}var py=(()=>{class i{el;type="button";iconPos="left";icon;badge;label;disabled;loading=!1;loadingIcon;raised=!1;rounded=!1;text=!1;plain=!1;severity;outlined=!1;link=!1;tabindex;size;style;styleClass;badgeClass;ariaLabel;autofocus;onClick=new oi;onFocus=new oi;onBlur=new oi;contentTemplate;loadingIconTemplate;iconTemplate;templates;constructor(t){this.el=t}spinnerIconClass(){return Object.entries(this.iconClass()).filter(([,t])=>!!t).reduce((t,[n])=>t+` ${n}`,"p-button-loading-icon")}iconClass(){let t={"p-button-icon":!0,"p-button-icon-left":this.iconPos==="left"&&this.label,"p-button-icon-right":this.iconPos==="right"&&this.label,"p-button-icon-top":this.iconPos==="top"&&this.label,"p-button-icon-bottom":this.iconPos==="bottom"&&this.label};return this.loading?t[`p-button-loading-icon pi-spin ${this.loadingIcon??""}`]=!0:this.icon&&(t[this.icon]=!0),t}get buttonClass(){return{"p-button p-component":!0,"p-button-icon-only":(this.icon||this.iconTemplate||this.loadingIcon||this.loadingIconTemplate)&&!this.label,"p-button-vertical":(this.iconPos==="top"||this.iconPos==="bottom")&&this.label,"p-button-loading":this.loading,"p-button-loading-label-only":this.loading&&!this.icon&&this.label&&!this.loadingIcon&&this.iconPos==="left","p-button-link":this.link,[`p-button-${this.severity}`]:this.severity,"p-button-raised":this.raised,"p-button-rounded":this.rounded,"p-button-text":this.text,"p-button-outlined":this.outlined,"p-button-sm":this.size==="small","p-button-lg":this.size==="large","p-button-plain":this.plain,[`${this.styleClass}`]:this.styleClass}}ngAfterContentInit(){this.templates?.forEach(t=>{switch(t.getType()){case"content":this.contentTemplate=t.template;break;case"icon":this.iconTemplate=t.template;break;case"loadingicon":this.loadingIconTemplate=t.template;break;default:this.contentTemplate=t.template;break}})}badgeStyleClass(){return{"p-badge p-component":!0,"p-badge-no-gutter":this.badge&&String(this.badge).length===1}}focus(){this.el.nativeElement.firstChild.focus()}static \u0275fac=function(n){return new(n||i)(he(_s))};static \u0275cmp=Se({type:i,selectors:[["p-button"]],contentQueries:function(n,s,r){if(n&1&&tc(r,Xh,4),n&2){let o;pr(o=mr())&&(s.templates=o)}},hostAttrs:[1,"p-element"],hostVars:2,hostBindings:function(n,s){n&2&&l0("p-disabled",s.disabled)},inputs:{type:"type",iconPos:"iconPos",icon:"icon",badge:"badge",label:"label",disabled:[2,"disabled","disabled",ft],loading:[2,"loading","loading",ft],loadingIcon:"loadingIcon",raised:[2,"raised","raised",ft],rounded:[2,"rounded","rounded",ft],text:[2,"text","text",ft],plain:[2,"plain","plain",ft],severity:"severity",outlined:[2,"outlined","outlined",ft],link:[2,"link","link",ft],tabindex:[2,"tabindex","tabindex",Ts],size:"size",style:"style",styleClass:"styleClass",badgeClass:"badgeClass",ariaLabel:"ariaLabel",autofocus:[2,"autofocus","autofocus",ft]},outputs:{onClick:"onClick",onFocus:"onFocus",onBlur:"onBlur"},standalone:!0,features:[ai,Ne],ngContentSelectors:_D,decls:7,vars:14,consts:[["pRipple","","pAutoFocus","",3,"click","focus","blur","ngStyle","disabled","ngClass","autofocus"],[4,"ngTemplateOutlet"],[4,"ngIf"],["class","p-button-label",4,"ngIf"],[3,"ngClass","class",4,"ngIf"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"ngClass",4,"ngIf"],[3,"styleClass","spin",4,"ngIf"],[3,"ngClass"],[3,"styleClass","spin"],[3,"ngIf"],[1,"p-button-label"]],template:function(n,s){n&1&&(vs(),G(0,"button",0),Ue("click",function(o){return s.onClick.emit(o)})("focus",function(o){return s.onFocus.emit(o)})("blur",function(o){return s.onBlur.emit(o)}),Es(1),be(2,yD,1,0,"ng-container",1)(3,CD,3,5,"ng-container",2)(4,RD,3,5,"ng-container",2)(5,PD,2,3,"span",3)(6,ND,2,5,"span",4),W()),n&2&&(z("ngStyle",s.style)("disabled",s.disabled||s.loading)("ngClass",s.buttonClass)("autofocus",s.autofocus),ue("type",s.type)("aria-label",s.ariaLabel)("data-pc-name","button")("data-pc-section","root")("tabindex",s.tabindex),L(2),z("ngTemplateOutlet",s.contentTemplate),L(),z("ngIf",s.loading),L(),z("ngIf",!s.loading),L(),z("ngIf",!s.contentTemplate&&s.label),L(),z("ngIf",!s.contentTemplate&&s.badge))},dependencies:[In,rc,sc,Zo,td,lb,cb],encapsulation:2,changeDetection:0})}return i})(),hb=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=Ot({type:i});static \u0275inj=Dt({imports:[py,Zh]})}return i})();var db=["toast-component",""];function DD(i,e){if(i&1){let t=Tn();G(0,"button",5),Ue("click",function(){Ct(t);let s=ne();return St(s.remove())}),G(1,"span",6),oe(2,"\xD7"),W()()}}function OD(i,e){if(i&1&&(En(0),oe(1),wn()),i&2){let t=ne(2);L(),Mn("[",t.duplicatesCount+1,"]")}}function kD(i,e){if(i&1&&(G(0,"div"),oe(1),be(2,OD,2,1,"ng-container",4),W()),i&2){let t=ne();Pe(t.options.titleClass),ue("aria-label",t.title),L(),Mn(" ",t.title," "),L(),z("ngIf",t.duplicatesCount)}}function MD(i,e){if(i&1&&re(0,"div",7),i&2){let t=ne();Pe(t.options.messageClass),z("innerHTML",t.message,$o)}}function FD(i,e){if(i&1&&(G(0,"div",8),oe(1),W()),i&2){let t=ne();Pe(t.options.messageClass),ue("aria-label",t.message),L(),Mn(" ",t.message," ")}}function LD(i,e){if(i&1&&(G(0,"div"),re(1,"div",9),W()),i&2){let t=ne();L(),Yo("width",t.width()+"%")}}function VD(i,e){if(i&1){let t=Tn();G(0,"button",5),Ue("click",function(){Ct(t);let s=ne();return St(s.remove())}),G(1,"span",6),oe(2,"\xD7"),W()()}}function BD(i,e){if(i&1&&(En(0),oe(1),wn()),i&2){let t=ne(2);L(),Mn("[",t.duplicatesCount+1,"]")}}function UD(i,e){if(i&1&&(G(0,"div"),oe(1),be(2,BD,2,1,"ng-container",4),W()),i&2){let t=ne();Pe(t.options.titleClass),ue("aria-label",t.title),L(),Mn(" ",t.title," "),L(),z("ngIf",t.duplicatesCount)}}function qD(i,e){if(i&1&&re(0,"div",7),i&2){let t=ne();Pe(t.options.messageClass),z("innerHTML",t.message,$o)}}function jD(i,e){if(i&1&&(G(0,"div",8),oe(1),W()),i&2){let t=ne();Pe(t.options.messageClass),ue("aria-label",t.message),L(),Mn(" ",t.message," ")}}function GD(i,e){if(i&1&&(G(0,"div"),re(1,"div",9),W()),i&2){let t=ne();L(),Yo("width",t.width()+"%")}}var my=class{_attachedHost;component;viewContainerRef;injector;constructor(e,t){this.component=e,this.injector=t}attach(e,t){return this._attachedHost=e,e.attach(this,t)}detach(){let e=this._attachedHost;if(e)return this._attachedHost=void 0,e.detach()}get isAttached(){return this._attachedHost!=null}setAttachedHost(e){this._attachedHost=e}},gy=class{_attachedPortal;_disposeFn;attach(e,t){return this._attachedPortal=e,this.attachComponentPortal(e,t)}detach(){this._attachedPortal&&this._attachedPortal.setAttachedHost(),this._attachedPortal=void 0,this._disposeFn&&(this._disposeFn(),this._disposeFn=void 0)}setDisposeFn(e){this._disposeFn=e}},_y=class{_overlayRef;componentInstance;duplicatesCount=0;_afterClosed=new nn;_activate=new nn;_manualClose=new nn;_resetTimeout=new nn;_countDuplicate=new nn;constructor(e){this._overlayRef=e}manualClose(){this._manualClose.next(),this._manualClose.complete()}manualClosed(){return this._manualClose.asObservable()}timeoutReset(){return this._resetTimeout.asObservable()}countDuplicate(){return this._countDuplicate.asObservable()}close(){this._overlayRef.detach(),this._afterClosed.next(),this._manualClose.next(),this._afterClosed.complete(),this._manualClose.complete(),this._activate.complete(),this._resetTimeout.complete(),this._countDuplicate.complete()}afterClosed(){return this._afterClosed.asObservable()}isInactive(){return this._activate.isStopped}activate(){this._activate.next(),this._activate.complete()}afterActivate(){return this._activate.asObservable()}onDuplicate(e,t){e&&this._resetTimeout.next(),t&&this._countDuplicate.next(++this.duplicatesCount)}},Ro=class{toastId;config;message;title;toastType;toastRef;_onTap=new nn;_onAction=new nn;constructor(e,t,n,s,r,o){this.toastId=e,this.config=t,this.message=n,this.title=s,this.toastType=r,this.toastRef=o,this.toastRef.afterClosed().subscribe(()=>{this._onAction.complete(),this._onTap.complete()})}triggerTap(){this._onTap.next(),this.config.tapToDismiss&&this._onTap.complete()}onTap(){return this._onTap.asObservable()}triggerAction(e){this._onAction.next(e)}onAction(){return this._onAction.asObservable()}},fb={maxOpened:0,autoDismiss:!1,newestOnTop:!0,preventDuplicates:!1,countDuplicates:!1,resetTimeoutOnDuplicate:!1,includeTitleDuplicates:!1,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},closeButton:!1,disableTimeOut:!1,timeOut:5e3,extendedTimeOut:1e3,enableHtml:!1,progressBar:!1,toastClass:"ngx-toastr",positionClass:"toast-top-right",titleClass:"toast-title",messageClass:"toast-message",easing:"ease-in",easeTime:300,tapToDismiss:!0,onActivateTick:!1,progressAnimation:"decreasing"},pb=new On("ToastConfig"),yy=class extends gy{_hostDomElement;_componentFactoryResolver;_appRef;constructor(e,t,n){super(),this._hostDomElement=e,this._componentFactoryResolver=t,this._appRef=n}attachComponentPortal(e,t){let n=this._componentFactoryResolver.resolveComponentFactory(e.component),s;return s=n.create(e.injector),this._appRef.attachView(s.hostView),this.setDisposeFn(()=>{this._appRef.detachView(s.hostView),s.destroy()}),t?this._hostDomElement.insertBefore(this._getComponentRootNode(s),this._hostDomElement.firstChild):this._hostDomElement.appendChild(this._getComponentRootNode(s)),s}_getComponentRootNode(e){return e.hostView.rootNodes[0]}},WD=(()=>{class i{_document=lt(an);_containerElement;ngOnDestroy(){this._containerElement&&this._containerElement.parentNode&&this._containerElement.parentNode.removeChild(this._containerElement)}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){let t=this._document.createElement("div");t.classList.add("overlay-container"),t.setAttribute("aria-live","polite"),this._document.body.appendChild(t),this._containerElement=t}static \u0275fac=function(n){return new(n||i)};static \u0275prov=yt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),vy=class{_portalHost;constructor(e){this._portalHost=e}attach(e,t=!0){return this._portalHost.attach(e,t)}detach(){return this._portalHost.detach()}},zD=(()=>{class i{_overlayContainer=lt(WD);_componentFactoryResolver=lt(r0);_appRef=lt(nc);_document=lt(an);_paneElements=new Map;create(t,n){return this._createOverlayRef(this.getPaneElement(t,n))}getPaneElement(t="",n){return this._paneElements.get(n)||this._paneElements.set(n,{}),this._paneElements.get(n)[t]||(this._paneElements.get(n)[t]=this._createPaneElement(t,n)),this._paneElements.get(n)[t]}_createPaneElement(t,n){let s=this._document.createElement("div");return s.id="toast-container",s.classList.add(t),s.classList.add("toast-container"),n?n.getContainerElement().appendChild(s):this._overlayContainer.getContainerElement().appendChild(s),s}_createPortalHost(t){return new yy(t,this._componentFactoryResolver,this._appRef)}_createOverlayRef(t){return new vy(this._createPortalHost(t))}static \u0275fac=function(n){return new(n||i)};static \u0275prov=yt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),Po=(()=>{class i{overlay;_injector;sanitizer;ngZone;toastrConfig;currentlyActive=0;toasts=[];overlayContainer;previousToastMessage;index=0;constructor(t,n,s,r,o){this.overlay=n,this._injector=s,this.sanitizer=r,this.ngZone=o,this.toastrConfig=Ae(Ae({},t.default),t.config),t.config.iconClasses&&(this.toastrConfig.iconClasses=Ae(Ae({},t.default.iconClasses),t.config.iconClasses))}show(t,n,s={},r=""){return this._preBuildNotification(r,t,n,this.applyConfig(s))}success(t,n,s={}){let r=this.toastrConfig.iconClasses.success||"";return this._preBuildNotification(r,t,n,this.applyConfig(s))}error(t,n,s={}){let r=this.toastrConfig.iconClasses.error||"";return this._preBuildNotification(r,t,n,this.applyConfig(s))}info(t,n,s={}){let r=this.toastrConfig.iconClasses.info||"";return this._preBuildNotification(r,t,n,this.applyConfig(s))}warning(t,n,s={}){let r=this.toastrConfig.iconClasses.warning||"";return this._preBuildNotification(r,t,n,this.applyConfig(s))}clear(t){for(let n of this.toasts)if(t!==void 0){if(n.toastId===t){n.toastRef.manualClose();return}}else n.toastRef.manualClose()}remove(t){let n=this._findToast(t);if(!n||(n.activeToast.toastRef.close(),this.toasts.splice(n.index,1),this.currentlyActive=this.currentlyActive-1,!this.toastrConfig.maxOpened||!this.toasts.length))return!1;if(this.currentlyActive<this.toastrConfig.maxOpened&&this.toasts[this.currentlyActive]){let s=this.toasts[this.currentlyActive].toastRef;s.isInactive()||(this.currentlyActive=this.currentlyActive+1,s.activate())}return!0}findDuplicate(t="",n="",s,r){let{includeTitleDuplicates:o}=this.toastrConfig;for(let a of this.toasts){let c=o&&a.title===t;if((!o||c)&&a.message===n)return a.toastRef.onDuplicate(s,r),a}return null}applyConfig(t={}){return Ae(Ae({},this.toastrConfig),t)}_findToast(t){for(let n=0;n<this.toasts.length;n++)if(this.toasts[n].toastId===t)return{index:n,activeToast:this.toasts[n]};return null}_preBuildNotification(t,n,s,r){return r.onActivateTick?this.ngZone.run(()=>this._buildNotification(t,n,s,r)):this._buildNotification(t,n,s,r)}_buildNotification(t,n,s,r){if(!r.toastComponent)throw new Error("toastComponent required");let o=this.findDuplicate(s,n,this.toastrConfig.resetTimeoutOnDuplicate&&r.timeOut>0,this.toastrConfig.countDuplicates);if((this.toastrConfig.includeTitleDuplicates&&s||n)&&this.toastrConfig.preventDuplicates&&o!==null)return o;this.previousToastMessage=n;let a=!1;this.toastrConfig.maxOpened&&this.currentlyActive>=this.toastrConfig.maxOpened&&(a=!0,this.toastrConfig.autoDismiss&&this.clear(this.toasts[0].toastId));let c=this.overlay.create(r.positionClass,this.overlayContainer);this.index=this.index+1;let u=n;n&&r.enableHtml&&(u=this.sanitizer.sanitize(i0.HTML,n));let d=new _y(c),f=new Ro(this.index,r,u,s,t,d),m=[{provide:Ro,useValue:f}],_=Zl.create({providers:m,parent:this._injector}),v=new my(r.toastComponent,_),C=c.attach(v,r.newestOnTop);d.componentInstance=C.instance;let R={toastId:this.index,title:s||"",message:n||"",toastRef:d,onShown:d.afterActivate(),onHidden:d.afterClosed(),onTap:f.onTap(),onAction:f.onAction(),portal:C};return a||(this.currentlyActive=this.currentlyActive+1,setTimeout(()=>{R.toastRef.activate()})),this.toasts.push(R),R}static \u0275fac=function(n){return new(n||i)(te(pb),te(zD),te(Zl),te(lc),te(zt))};static \u0275prov=yt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),KD=(()=>{class i{toastrService;toastPackage;ngZone;message;title;options;duplicatesCount;originalTimeout;width=xi(-1);toastClasses="";state;get _state(){return this.state()}get displayStyle(){if(this.state().value==="inactive")return"none"}timeout;intervalId;hideTime;sub;sub1;sub2;sub3;constructor(t,n,s){this.toastrService=t,this.toastPackage=n,this.ngZone=s,this.message=n.message,this.title=n.title,this.options=n.config,this.originalTimeout=n.config.timeOut,this.toastClasses=`${n.toastType} ${n.config.toastClass}`,this.sub=n.toastRef.afterActivate().subscribe(()=>{this.activateToast()}),this.sub1=n.toastRef.manualClosed().subscribe(()=>{this.remove()}),this.sub2=n.toastRef.timeoutReset().subscribe(()=>{this.resetTimeout()}),this.sub3=n.toastRef.countDuplicate().subscribe(r=>{this.duplicatesCount=r}),this.state=xi({value:"inactive",params:{easeTime:this.toastPackage.config.easeTime,easing:"ease-in"}})}ngOnDestroy(){this.sub.unsubscribe(),this.sub1.unsubscribe(),this.sub2.unsubscribe(),this.sub3.unsubscribe(),clearInterval(this.intervalId),clearTimeout(this.timeout)}activateToast(){this.state.update(t=>vn(Ae({},t),{value:"active"})),!(this.options.disableTimeOut===!0||this.options.disableTimeOut==="timeOut")&&this.options.timeOut&&(this.outsideTimeout(()=>this.remove(),this.options.timeOut),this.hideTime=new Date().getTime()+this.options.timeOut,this.options.progressBar&&this.outsideInterval(()=>this.updateProgress(),10))}updateProgress(){if(this.width()===0||this.width()===100||!this.options.timeOut)return;let t=new Date().getTime(),n=this.hideTime-t;this.width.set(n/this.options.timeOut*100),this.options.progressAnimation==="increasing"&&this.width.update(s=>100-s),this.width()<=0&&this.width.set(0),this.width()>=100&&this.width.set(100)}resetTimeout(){clearTimeout(this.timeout),clearInterval(this.intervalId),this.state.update(t=>vn(Ae({},t),{value:"active"})),this.outsideTimeout(()=>this.remove(),this.originalTimeout),this.options.timeOut=this.originalTimeout,this.hideTime=new Date().getTime()+(this.options.timeOut||0),this.width.set(-1),this.options.progressBar&&this.outsideInterval(()=>this.updateProgress(),10)}remove(){this.state().value!=="removed"&&(clearTimeout(this.timeout),this.state.update(t=>vn(Ae({},t),{value:"removed"})),this.outsideTimeout(()=>this.toastrService.remove(this.toastPackage.toastId),+this.toastPackage.config.easeTime))}tapToast(){this.state().value!=="removed"&&(this.toastPackage.triggerTap(),this.options.tapToDismiss&&this.remove())}stickAround(){this.state().value!=="removed"&&this.options.disableTimeOut!=="extendedTimeOut"&&(clearTimeout(this.timeout),this.options.timeOut=0,this.hideTime=0,clearInterval(this.intervalId),this.width.set(0))}delayedHideToast(){this.options.disableTimeOut===!0||this.options.disableTimeOut==="extendedTimeOut"||this.options.extendedTimeOut===0||this.state().value==="removed"||(this.outsideTimeout(()=>this.remove(),this.options.extendedTimeOut),this.options.timeOut=this.options.extendedTimeOut,this.hideTime=new Date().getTime()+(this.options.timeOut||0),this.width.set(-1),this.options.progressBar&&this.outsideInterval(()=>this.updateProgress(),10))}outsideTimeout(t,n){this.ngZone?this.ngZone.runOutsideAngular(()=>this.timeout=setTimeout(()=>this.runInsideAngular(t),n)):this.timeout=setTimeout(()=>t(),n)}outsideInterval(t,n){this.ngZone?this.ngZone.runOutsideAngular(()=>this.intervalId=setInterval(()=>this.runInsideAngular(t),n)):this.intervalId=setInterval(()=>t(),n)}runInsideAngular(t){this.ngZone?this.ngZone.run(()=>t()):t()}static \u0275fac=function(n){return new(n||i)(he(Po),he(Ro),he(zt))};static \u0275cmp=Se({type:i,selectors:[["","toast-component",""]],hostVars:5,hostBindings:function(n,s){n&1&&Ue("click",function(){return s.tapToast()})("mouseenter",function(){return s.stickAround()})("mouseleave",function(){return s.delayedHideToast()}),n&2&&(c0("@flyInOut",s._state),Pe(s.toastClasses),Yo("display",s.displayStyle))},standalone:!0,features:[Ne],attrs:db,decls:5,vars:5,consts:[["type","button","class","toast-close-button","aria-label","Close",3,"click",4,"ngIf"],[3,"class",4,"ngIf"],["role","alert",3,"class","innerHTML",4,"ngIf"],["role","alert",3,"class",4,"ngIf"],[4,"ngIf"],["type","button","aria-label","Close",1,"toast-close-button",3,"click"],["aria-hidden","true"],["role","alert",3,"innerHTML"],["role","alert"],[1,"toast-progress"]],template:function(n,s){n&1&&be(0,DD,3,0,"button",0)(1,kD,3,5,"div",1)(2,MD,1,3,"div",2)(3,FD,2,4,"div",3)(4,LD,2,2,"div",4),n&2&&(z("ngIf",s.options.closeButton),L(),z("ngIf",s.title),L(),z("ngIf",s.message&&s.options.enableHtml),L(),z("ngIf",s.message&&!s.options.enableHtml),L(),z("ngIf",s.options.progressBar))},dependencies:[In],encapsulation:2,data:{animation:[Sl("flyInOut",[Ao("inactive",xn({opacity:0})),Ao("active",xn({opacity:1})),Ao("removed",xn({opacity:0})),sr("inactive => active",bo("{{ easeTime }}ms {{ easing }}")),sr("active => removed",bo("{{ easeTime }}ms {{ easing }}"))])]},changeDetection:0})}return i})(),HD=vn(Ae({},fb),{toastComponent:KD}),mb=(i={})=>t0([{provide:pb,useValue:{default:HD,config:i}}]);var QD=(()=>{class i{toastrService;toastPackage;appRef;message;title;options;duplicatesCount;originalTimeout;width=xi(-1);toastClasses="";get displayStyle(){return this.state()==="inactive"?"none":null}state=xi("inactive");timeout;intervalId;hideTime;sub;sub1;sub2;sub3;constructor(t,n,s){this.toastrService=t,this.toastPackage=n,this.appRef=s,this.message=n.message,this.title=n.title,this.options=n.config,this.originalTimeout=n.config.timeOut,this.toastClasses=`${n.toastType} ${n.config.toastClass}`,this.sub=n.toastRef.afterActivate().subscribe(()=>{this.activateToast()}),this.sub1=n.toastRef.manualClosed().subscribe(()=>{this.remove()}),this.sub2=n.toastRef.timeoutReset().subscribe(()=>{this.resetTimeout()}),this.sub3=n.toastRef.countDuplicate().subscribe(r=>{this.duplicatesCount=r})}ngOnDestroy(){this.sub.unsubscribe(),this.sub1.unsubscribe(),this.sub2.unsubscribe(),this.sub3.unsubscribe(),clearInterval(this.intervalId),clearTimeout(this.timeout)}activateToast(){this.state.set("active"),!(this.options.disableTimeOut===!0||this.options.disableTimeOut==="timeOut")&&this.options.timeOut&&(this.timeout=setTimeout(()=>{this.remove()},this.options.timeOut),this.hideTime=new Date().getTime()+this.options.timeOut,this.options.progressBar&&(this.intervalId=setInterval(()=>this.updateProgress(),10))),this.options.onActivateTick&&this.appRef.tick()}updateProgress(){if(this.width()===0||this.width()===100||!this.options.timeOut)return;let t=new Date().getTime(),n=this.hideTime-t;this.width.set(n/this.options.timeOut*100),this.options.progressAnimation==="increasing"&&this.width.update(s=>100-s),this.width()<=0&&this.width.set(0),this.width()>=100&&this.width.set(100)}resetTimeout(){clearTimeout(this.timeout),clearInterval(this.intervalId),this.state.set("active"),this.options.timeOut=this.originalTimeout,this.timeout=setTimeout(()=>this.remove(),this.originalTimeout),this.hideTime=new Date().getTime()+(this.originalTimeout||0),this.width.set(-1),this.options.progressBar&&(this.intervalId=setInterval(()=>this.updateProgress(),10))}remove(){this.state()!=="removed"&&(clearTimeout(this.timeout),this.state.set("removed"),this.timeout=setTimeout(()=>this.toastrService.remove(this.toastPackage.toastId)))}tapToast(){this.state()!=="removed"&&(this.toastPackage.triggerTap(),this.options.tapToDismiss&&this.remove())}stickAround(){this.state()!=="removed"&&(clearTimeout(this.timeout),this.options.timeOut=0,this.hideTime=0,clearInterval(this.intervalId),this.width.set(0))}delayedHideToast(){this.options.disableTimeOut===!0||this.options.disableTimeOut==="extendedTimeOut"||this.options.extendedTimeOut===0||this.state()==="removed"||(this.timeout=setTimeout(()=>this.remove(),this.options.extendedTimeOut),this.options.timeOut=this.options.extendedTimeOut,this.hideTime=new Date().getTime()+(this.options.timeOut||0),this.width.set(-1),this.options.progressBar&&(this.intervalId=setInterval(()=>this.updateProgress(),10)))}static \u0275fac=function(n){return new(n||i)(he(Po),he(Ro),he(nc))};static \u0275cmp=Se({type:i,selectors:[["","toast-component",""]],hostVars:4,hostBindings:function(n,s){n&1&&Ue("click",function(){return s.tapToast()})("mouseenter",function(){return s.stickAround()})("mouseleave",function(){return s.delayedHideToast()}),n&2&&(Pe(s.toastClasses),Yo("display",s.displayStyle))},standalone:!0,features:[Ne],attrs:db,decls:5,vars:5,consts:[["type","button","class","toast-close-button","aria-label","Close",3,"click",4,"ngIf"],[3,"class",4,"ngIf"],["role","alert",3,"class","innerHTML",4,"ngIf"],["role","alert",3,"class",4,"ngIf"],[4,"ngIf"],["type","button","aria-label","Close",1,"toast-close-button",3,"click"],["aria-hidden","true"],["role","alert",3,"innerHTML"],["role","alert"],[1,"toast-progress"]],template:function(n,s){n&1&&be(0,VD,3,0,"button",0)(1,UD,3,5,"div",1)(2,qD,1,3,"div",2)(3,jD,2,4,"div",3)(4,GD,2,2,"div",4),n&2&&(z("ngIf",s.options.closeButton),L(),z("ngIf",s.title),L(),z("ngIf",s.message&&s.options.enableHtml),L(),z("ngIf",s.message&&!s.options.enableHtml),L(),z("ngIf",s.options.progressBar))},dependencies:[In],encapsulation:2,changeDetection:0})}return i})(),jF=vn(Ae({},fb),{toastComponent:QD});var No=class i{constructor(e,t){this.afs=e;this.toastr=t}getAllExpenses(){return this.afs.collection("expenses").snapshotChanges().pipe(nt(e=>e.map(t=>{let n=t.payload.doc.data(),s=t.payload.doc.id;return n.key=s,Ae({},n)})))}getExpense(e){return this.afs.collection("expenses").doc(e).valueChanges()}addExpense(e){this.afs.collection("expenses").add(e).catch(t=>{this.toastr.error(t.message,"An error occurred",{timeOut:1e4,positionClass:"toast-top-right",closeButton:!0,progressBar:!0})})}updateExpense(e,t){this.afs.collection("expenses").doc(e).update(t).catch(n=>{this.toastr.error(n.message,"An error occurred",{timeOut:1e4,positionClass:"toast-top-right",closeButton:!0,progressBar:!0})})}deleteExpense(e){this.afs.doc("expenses/"+e).delete().catch(t=>{this.toastr.error(t.message,"An error occurred",{timeOut:1e4,positionClass:"toast-top-right",closeButton:!0,progressBar:!0})})}static \u0275fac=function(t){return new(t||i)(te(oy),te(Po))};static \u0275prov=yt({token:i,factory:i.\u0275fac,providedIn:"root"})};var YD=()=>({width:"100%",right:"0",left:"0"}),JD=i=>({"920px":i});function XD(i,e){i&1&&(G(0,"div",4),oe(1,"Unauthorised! Please login to add/update items."),W())}function ZD(i,e){if(i&1){let t=Tn();G(0,"div",11)(1,"div",12)(2,"div",13)(3,"div",14)(4,"h5",15),oe(5),W(),G(6,"h2",16),oe(7),ws(8,"number"),W(),re(9,"p",17),ws(10,"safeHtml"),G(11,"div",18)(12,"button",19),Ue("click",function(){let s=Ct(t).$implicit,r=ne();return St(r.editExpense(s.key))}),oe(13,"Edit"),W(),G(14,"button",20),Ue("click",function(){let s=Ct(t).$implicit,r=ne();return St(r.deleteExpense(s.key))}),oe(15,"Remove"),W()()()()()()}if(i&2){let t=e.$implicit;L(5),kn(t.title),L(2),Mn("\xA3",Jd(8,3,t.price,"1.2-2"),""),L(2),z("innerHTML",Xo(10,6,t.description),$o)}}var id=class i{constructor(e,t,n){this.expenseService=e;this.router=t;this.messageService=n;this.items=this.getAllDocuments(),this.isLoggedIn.subscribe(s=>{this.authorised=s}),this.items.subscribe(s=>{this.totalPrice=0,s.forEach(r=>{this.totalPrice+=Number(r.price)})})}items;totalPrice=0;isLoggedIn=lt(ci).isLoggedIn();authorised;authService=lt(ci);unauthorised=!1;isLoginFormModelOpen=!1;show(){this.messageService.add({severity:"error",summary:"Oops!",detail:"Looks like something went wrong.",life:5e3})}getAllDocuments(){return this.expenseService.getAllExpenses()}editExpense(e){this.router.navigate(["/expense-form/"+e])}deleteExpense(e){this.authorised?this.expenseService.deleteExpense(e):this.unauthorised=!0}addExpense(){this.authorised?this.router.navigate(["/expense-form"]):this.unauthorised=!0}ngOnInit(){}ngOnDestroy(){}static \u0275fac=function(t){return new(t||i)(he(No),he(cc),he(So))};static \u0275cmp=Se({type:i,selectors:[["app-expense"]],standalone:!0,features:[h0([So]),Ne],decls:16,vars:13,consts:[[1,"mb-4","d-flex","justify-content-between","align-items-center"],["type","button","routerLink","/expense-form",1,"btn","btn-primary",3,"click"],[1,"fw-bold","align-items-center"],[1,"text-success"],[1,"form-text","text-danger","fw-bold"],["class","mt-4",4,"ngFor","ngForOf"],[3,"closeModal","showModal"],[3,"formSubmit"],[1,"card","flex","justify-content-center"],[3,"breakpoints"],["label","Show",3,"onClick"],[1,"mt-4"],[1,"d-flex","flex-column","gap-3"],[1,"card"],[1,"card-body"],[1,"card-title"],[1,"fw-bold","text-success"],[1,"card-text",3,"innerHTML"],[1,"d-flex","gap-2"],[1,"btn","btn-sm","btn-success",3,"click"],[1,"btn","btn-sm","btn-danger",3,"click"]],template:function(t,n){t&1&&(G(0,"div",0)(1,"button",1),Ue("click",function(){return n.addExpense()}),oe(2,"Add Expense"),W(),G(3,"h5",2),oe(4,"Total Expenses: "),G(5,"strong",3),oe(6),ws(7,"number"),W()()(),be(8,XD,2,0,"div",4)(9,ZD,16,8,"div",5),ws(10,"async"),G(11,"app-modal",6),Ue("closeModal",function(){return n.isLoginFormModelOpen=!1}),G(12,"app-login-form",7),Ue("formSubmit",function(){return n.isLoginFormModelOpen=!1}),W()(),G(13,"div",8),re(14,"p-toast",9),G(15,"p-button",10),Ue("onClick",function(){return n.show()}),W()()),t&2&&(L(6),Mn("\xA3",Jd(7,5,n.totalPrice,"1.2-2"),""),L(2),ys(n.unauthorised?8:-1),L(),z("ngForOf",Xo(10,8,n.items)),L(2),z("showModal",n.isLoginFormModelOpen),L(3),z("breakpoints",li(11,JD,d0(10,YD))))},dependencies:[Di,ic,oc,y0,uc,C0,$h,Q0,Yh,nd,ab,hb,py]})};function yb(i){return e=>i.test(e.value)?{forbiddenName:{value:e.value}}:null}function eO(i,e){i&1&&(G(0,"div",6),oe(1,"Title is a required field"),W())}function tO(i,e){i&1&&(G(0,"div",6),oe(1,"Price is a required field"),W())}function nO(i,e){i&1&&(G(0,"div",6),oe(1,"Contains an illegal name"),W())}function iO(i,e){i&1&&(G(0,"div",6),oe(1,"Unauthorised! Please login to add/update items."),W())}var bl=class i{constructor(e,t,n,s){this.fb=e;this.afs=t;this.activatedRoute=n;this.router=s;this.expenseForm=this.fb.group({price:new Dc("",[sf.required]),title:new Dc("",[sf.required]),description:new Dc("",[yb(/craig/i)])})}expenseForm;expenseId;isLoggedIn=lt(ci).isLoggedIn();authorised;authService=lt(ci);unauthorised=!1;ngOnInit(){this.isLoggedIn.subscribe(e=>{this.authorised=e}),this.activatedRoute.params.subscribe({next:e=>this.expenseId=e.id}),this.getExpense(this.expenseId)}getExpense(e){this.afs.getExpense(e).subscribe(t=>{this.expenseForm.patchValue(t)})}addExpense(){this.authorised?(this.afs.addExpense(this.expenseForm.value),this.router.navigate(["./"])):this.unauthorised=!0}updateExpense(){this.expenseForm.valid&&this.authorised?(this.activatedRoute.params.subscribe({next:e=>e.id?this.afs.updateExpense(e.id,this.expenseForm.value):this.afs.addExpense(this.expenseForm.value)}),this.router.navigate(["./"])):(this.expenseForm.markAllAsTouched(),this.expenseForm.hasError,this.unauthorised=!0)}static \u0275fac=function(t){return new(t||i)(he(K0),he(No),he(T0),he(cc))};static \u0275cmp=Se({type:i,selectors:[["app-expense-form"]],standalone:!0,features:[Ne],decls:23,vars:5,consts:[[1,"row"],[1,"col-lg-6"],[3,"formGroup"],[1,"mb-3"],["for","title",1,"form-label"],["type","text","id","title","placeholder","Title","formControlName","title",1,"form-control"],[1,"form-text","text-danger","fw-bold"],["for","price",1,"form-label"],["type","number","id","price","placeholder","Price","formControlName","price",1,"form-control"],["for","description",1,"form-label"],["type","password","id","description","formControlName","description",1,"form-control"],["type","submit",1,"btn","btn-success",3,"click"]],template:function(t,n){if(t&1&&(G(0,"div",0)(1,"div",1)(2,"h4"),oe(3,"Expense Form"),W(),G(4,"form",2)(5,"div",3)(6,"label",4),oe(7,"Title"),W(),re(8,"input",5),be(9,eO,2,0,"div",6),W(),G(10,"div",3)(11,"label",7),oe(12,"Price"),W(),re(13,"input",8),be(14,tO,2,0,"div",6),W(),G(15,"div",3)(16,"label",9),oe(17,"Description"),W(),re(18,"textarea",10),be(19,nO,2,0,"div",6),W(),G(20,"button",11),Ue("click",function(r){return r.preventDefault(),n.updateExpense()}),oe(21,"Save Changes"),W()(),be(22,iO,2,0,"div",6),W()()),t&2){let s,r,o;L(4),z("formGroup",n.expenseForm),L(5),ys((s=n.expenseForm.get("title"))!=null&&s.hasError("required")&&((s=n.expenseForm.get("title"))!=null&&s.touched)?9:-1),L(5),ys((r=n.expenseForm.get("price"))!=null&&r.hasError("required")&&((r=n.expenseForm.get("price"))!=null&&r.touched)?14:-1),L(5),ys((o=n.expenseForm.get("description"))!=null&&o.hasError("forbiddenName")&&((o=n.expenseForm.get("description"))!=null&&o.touched)?19:-1),L(3),ys(n.unauthorised?22:-1)}},dependencies:[Di,H0,j0,B0,G0,U0,q0,W0,z0,uc]})};var vb=[{path:"",component:id},{path:"expense-form",component:bl},{path:"expense-form/:id",component:bl},{path:"login",loadComponent:()=>import("./chunk-MRC5KTIP.js").then(i=>i.LoginComponent)},{path:"signup",loadComponent:()=>import("./chunk-FXRLUWVG.js").then(i=>i.SignupComponent)},{path:"reset",loadComponent:()=>import("./chunk-35RCRMZM.js").then(i=>i.ResetComponent)}];function Eb(i){return new Ee(3e3,!1)}function sO(){return new Ee(3100,!1)}function rO(){return new Ee(3101,!1)}function oO(i){return new Ee(3001,!1)}function aO(i){return new Ee(3003,!1)}function lO(i){return new Ee(3004,!1)}function cO(i,e){return new Ee(3005,!1)}function uO(){return new Ee(3006,!1)}function hO(){return new Ee(3007,!1)}function dO(i,e){return new Ee(3008,!1)}function fO(i){return new Ee(3002,!1)}function pO(i,e,t,n,s){return new Ee(3010,!1)}function mO(){return new Ee(3011,!1)}function gO(){return new Ee(3012,!1)}function _O(){return new Ee(3200,!1)}function yO(){return new Ee(3202,!1)}function vO(){return new Ee(3013,!1)}function EO(i){return new Ee(3014,!1)}function wO(i){return new Ee(3015,!1)}function TO(i){return new Ee(3016,!1)}function IO(i,e){return new Ee(3404,!1)}function CO(i){return new Ee(3502,!1)}function SO(i){return new Ee(3503,!1)}function bO(){return new Ee(3300,!1)}function AO(i){return new Ee(3504,!1)}function RO(i){return new Ee(3301,!1)}function PO(i,e){return new Ee(3302,!1)}function NO(i){return new Ee(3303,!1)}function xO(i,e){return new Ee(3400,!1)}function DO(i){return new Ee(3401,!1)}function OO(i){return new Ee(3402,!1)}function kO(i,e){return new Ee(3505,!1)}function hs(i){switch(i.length){case 0:return new us;case 1:return i[0];default:return new Cl(i)}}function kb(i,e,t=new Map,n=new Map){let s=[],r=[],o=-1,a=null;if(e.forEach(c=>{let u=c.get("offset"),d=u==o,f=d&&a||new Map;c.forEach((m,_)=>{let v=_,C=m;if(_!=="offset")switch(v=i.normalizePropertyName(v,s),C){case ed:C=t.get(_);break;case ei:C=n.get(_);break;default:C=i.normalizeStyleValue(_,v,C,s);break}f.set(v,C)}),d||r.push(f),a=f,o=u}),s.length)throw CO(s);return r}function jy(i,e,t,n){switch(e){case"start":i.onStart(()=>n(t&&Ey(t,"start",i)));break;case"done":i.onDone(()=>n(t&&Ey(t,"done",i)));break;case"destroy":i.onDestroy(()=>n(t&&Ey(t,"destroy",i)));break}}function Ey(i,e,t){let n=t.totalTime,s=!!t.disabled,r=Gy(i.element,i.triggerName,i.fromState,i.toState,e||i.phaseName,n??i.totalTime,s),o=i._data;return o!=null&&(r._data=o),r}function Gy(i,e,t,n,s="",r=0,o){return{element:i,triggerName:e,fromState:t,toState:n,phaseName:s,totalTime:r,disabled:!!o}}function Zt(i,e,t){let n=i.get(e);return n||i.set(e,n=t),n}function wb(i){let e=i.indexOf(":"),t=i.substring(1,e),n=i.slice(e+1);return[t,n]}var MO=typeof document>"u"?null:document.documentElement;function Wy(i){let e=i.parentNode||i.host||null;return e===MO?null:e}function FO(i){return i.substring(1,6)=="ebkit"}var rr=null,Tb=!1;function LO(i){rr||(rr=VO()||{},Tb=rr.style?"WebkitAppearance"in rr.style:!1);let e=!0;return rr.style&&!FO(i)&&(e=i in rr.style,!e&&Tb&&(e="Webkit"+i.charAt(0).toUpperCase()+i.slice(1)in rr.style)),e}function VO(){return typeof document<"u"?document.body:null}function Mb(i,e){for(;e;){if(e===i)return!0;e=Wy(e)}return!1}function Fb(i,e,t){if(t)return Array.from(i.querySelectorAll(e));let n=i.querySelector(e);return n?[n]:[]}var zy=(()=>{class i{validateStyleProperty(t){return LO(t)}containsElement(t,n){return Mb(t,n)}getParentElement(t){return Wy(t)}query(t,n,s){return Fb(t,n,s)}computeStyle(t,n,s){return s||""}animate(t,n,s,r,o,a=[],c){return new us(s,r)}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=yt({token:i,factory:i.\u0275fac})}}return i})(),lr=class{static{this.NOOP=new zy}},cr=class{};var BO=1e3,Lb="{{",UO="}}",Vb="ng-enter",by="ng-leave",sd="ng-trigger",cd=".ng-trigger",Ib="ng-animating",Ay=".ng-animating";function Ti(i){if(typeof i=="number")return i;let e=i.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:Ry(parseFloat(e[1]),e[2])}function Ry(i,e){switch(e){case"s":return i*BO;default:return i}}function ud(i,e,t){return i.hasOwnProperty("duration")?i:qO(i,e,t)}function qO(i,e,t){let n=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i,s,r=0,o="";if(typeof i=="string"){let a=i.match(n);if(a===null)return e.push(Eb(i)),{duration:0,delay:0,easing:""};s=Ry(parseFloat(a[1]),a[2]);let c=a[3];c!=null&&(r=Ry(parseFloat(c),a[4]));let u=a[5];u&&(o=u)}else s=i;if(!t){let a=!1,c=e.length;s<0&&(e.push(sO()),a=!0),r<0&&(e.push(rO()),a=!0),a&&e.splice(c,0,Eb(i))}return{duration:s,delay:r,easing:o}}function jO(i){return i.length?i[0]instanceof Map?i:i.map(e=>new Map(Object.entries(e))):[]}function ti(i,e,t){e.forEach((n,s)=>{let r=Ky(s);t&&!t.has(s)&&t.set(s,i.style[r]),i.style[r]=n})}function ar(i,e){e.forEach((t,n)=>{let s=Ky(n);i.style[s]=""})}function Al(i){return Array.isArray(i)?i.length==1?i[0]:tb(i):i}function GO(i,e,t){let n=e.params||{},s=Bb(i);s.length&&s.forEach(r=>{n.hasOwnProperty(r)||t.push(oO(r))})}var Py=new RegExp(`${Lb}\\s*(.+?)\\s*${UO}`,"g");function Bb(i){let e=[];if(typeof i=="string"){let t;for(;t=Py.exec(i);)e.push(t[1]);Py.lastIndex=0}return e}function Pl(i,e,t){let n=`${i}`,s=n.replace(Py,(r,o)=>{let a=e[o];return a==null&&(t.push(aO(o)),a=""),a.toString()});return s==n?i:s}var WO=/-+([a-z0-9])/g;function Ky(i){return i.replace(WO,(...e)=>e[1].toUpperCase())}function zO(i,e){return i===0||e===0}function KO(i,e,t){if(t.size&&e.length){let n=e[0],s=[];if(t.forEach((r,o)=>{n.has(o)||s.push(o),n.set(o,r)}),s.length)for(let r=1;r<e.length;r++){let o=e[r];s.forEach(a=>o.set(a,Hy(i,a)))}}return e}function Xt(i,e,t){switch(e.type){case se.Trigger:return i.visitTrigger(e,t);case se.State:return i.visitState(e,t);case se.Transition:return i.visitTransition(e,t);case se.Sequence:return i.visitSequence(e,t);case se.Group:return i.visitGroup(e,t);case se.Animate:return i.visitAnimate(e,t);case se.Keyframes:return i.visitKeyframes(e,t);case se.Style:return i.visitStyle(e,t);case se.Reference:return i.visitReference(e,t);case se.AnimateChild:return i.visitAnimateChild(e,t);case se.AnimateRef:return i.visitAnimateRef(e,t);case se.Query:return i.visitQuery(e,t);case se.Stagger:return i.visitStagger(e,t);default:throw lO(e.type)}}function Hy(i,e){return window.getComputedStyle(i)[e]}var HO=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]),hd=class extends cr{normalizePropertyName(e,t){return Ky(e)}normalizeStyleValue(e,t,n,s){let r="",o=n.toString().trim();if(HO.has(t)&&n!==0&&n!=="0")if(typeof n=="number")r="px";else{let a=n.match(/^[+-]?[\d\.]+([a-z]*)$/);a&&a[1].length==0&&s.push(cO(e,n))}return o+r}};var dd="*";function QO(i,e){let t=[];return typeof i=="string"?i.split(/\s*,\s*/).forEach(n=>$O(n,t,e)):t.push(i),t}function $O(i,e,t){if(i[0]==":"){let c=YO(i,t);if(typeof c=="function"){e.push(c);return}i=c}let n=i.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(n==null||n.length<4)return t.push(wO(i)),e;let s=n[1],r=n[2],o=n[3];e.push(Cb(s,o));let a=s==dd&&o==dd;r[0]=="<"&&!a&&e.push(Cb(o,s))}function YO(i,e){switch(i){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,n)=>parseFloat(n)>parseFloat(t);case":decrement":return(t,n)=>parseFloat(n)<parseFloat(t);default:return e.push(TO(i)),"* => *"}}var rd=new Set(["true","1"]),od=new Set(["false","0"]);function Cb(i,e){let t=rd.has(i)||od.has(i),n=rd.has(e)||od.has(e);return(s,r)=>{let o=i==dd||i==s,a=e==dd||e==r;return!o&&t&&typeof s=="boolean"&&(o=s?rd.has(i):od.has(i)),!a&&n&&typeof r=="boolean"&&(a=r?rd.has(e):od.has(e)),o&&a}}var Ub=":self",JO=new RegExp(`s*${Ub}s*,?`,"g");function qb(i,e,t,n){return new Ny(i).build(e,t,n)}var Sb="",Ny=class{constructor(e){this._driver=e}build(e,t,n){let s=new xy(t);return this._resetContextStyleTimingState(s),Xt(this,Al(e),s)}_resetContextStyleTimingState(e){e.currentQuerySelector=Sb,e.collectedStyles=new Map,e.collectedStyles.set(Sb,new Map),e.currentTime=0}visitTrigger(e,t){let n=t.queryCount=0,s=t.depCount=0,r=[],o=[];return e.name.charAt(0)=="@"&&t.errors.push(uO()),e.definitions.forEach(a=>{if(this._resetContextStyleTimingState(t),a.type==se.State){let c=a,u=c.name;u.toString().split(/\s*,\s*/).forEach(d=>{c.name=d,r.push(this.visitState(c,t))}),c.name=u}else if(a.type==se.Transition){let c=this.visitTransition(a,t);n+=c.queryCount,s+=c.depCount,o.push(c)}else t.errors.push(hO())}),{type:se.Trigger,name:e.name,states:r,transitions:o,queryCount:n,depCount:s,options:null}}visitState(e,t){let n=this.visitStyle(e.styles,t),s=e.options&&e.options.params||null;if(n.containsDynamicStyles){let r=new Set,o=s||{};n.styles.forEach(a=>{a instanceof Map&&a.forEach(c=>{Bb(c).forEach(u=>{o.hasOwnProperty(u)||r.add(u)})})}),r.size&&t.errors.push(dO(e.name,[...r.values()]))}return{type:se.State,name:e.name,style:n,options:s?{params:s}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;let n=Xt(this,Al(e.animation),t),s=QO(e.expr,t.errors);return{type:se.Transition,matchers:s,animation:n,queryCount:t.queryCount,depCount:t.depCount,options:or(e.options)}}visitSequence(e,t){return{type:se.Sequence,steps:e.steps.map(n=>Xt(this,n,t)),options:or(e.options)}}visitGroup(e,t){let n=t.currentTime,s=0,r=e.steps.map(o=>{t.currentTime=n;let a=Xt(this,o,t);return s=Math.max(s,t.currentTime),a});return t.currentTime=s,{type:se.Group,steps:r,options:or(e.options)}}visitAnimate(e,t){let n=tk(e.timings,t.errors);t.currentAnimateTimings=n;let s,r=e.styles?e.styles:xn({});if(r.type==se.Keyframes)s=this.visitKeyframes(r,t);else{let o=e.styles,a=!1;if(!o){a=!0;let u={};n.easing&&(u.easing=n.easing),o=xn(u)}t.currentTime+=n.duration+n.delay;let c=this.visitStyle(o,t);c.isEmptyStep=a,s=c}return t.currentAnimateTimings=null,{type:se.Animate,timings:n,style:s,options:null}}visitStyle(e,t){let n=this._makeStyleAst(e,t);return this._validateStyleAst(n,t),n}_makeStyleAst(e,t){let n=[],s=Array.isArray(e.styles)?e.styles:[e.styles];for(let a of s)typeof a=="string"?a===ei?n.push(a):t.errors.push(fO(a)):n.push(new Map(Object.entries(a)));let r=!1,o=null;return n.forEach(a=>{if(a instanceof Map&&(a.has("easing")&&(o=a.get("easing"),a.delete("easing")),!r)){for(let c of a.values())if(c.toString().indexOf(Lb)>=0){r=!0;break}}}),{type:se.Style,styles:n,easing:o,offset:e.offset,containsDynamicStyles:r,options:null}}_validateStyleAst(e,t){let n=t.currentAnimateTimings,s=t.currentTime,r=t.currentTime;n&&r>0&&(r-=n.duration+n.delay),e.styles.forEach(o=>{typeof o!="string"&&o.forEach((a,c)=>{let u=t.collectedStyles.get(t.currentQuerySelector),d=u.get(c),f=!0;d&&(r!=s&&r>=d.startTime&&s<=d.endTime&&(t.errors.push(pO(c,d.startTime,d.endTime,r,s)),f=!1),r=d.startTime),f&&u.set(c,{startTime:r,endTime:s}),t.options&&GO(a,t.options,t.errors)})})}visitKeyframes(e,t){let n={type:se.Keyframes,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push(mO()),n;let s=1,r=0,o=[],a=!1,c=!1,u=0,d=e.steps.map(F=>{let V=this._makeStyleAst(F,t),B=V.offset!=null?V.offset:ek(V.styles),$=0;return B!=null&&(r++,$=V.offset=B),c=c||$<0||$>1,a=a||$<u,u=$,o.push($),V});c&&t.errors.push(gO()),a&&t.errors.push(_O());let f=e.steps.length,m=0;r>0&&r<f?t.errors.push(yO()):r==0&&(m=s/(f-1));let _=f-1,v=t.currentTime,C=t.currentAnimateTimings,R=C.duration;return d.forEach((F,V)=>{let B=m>0?V==_?1:m*V:o[V],$=B*R;t.currentTime=v+C.delay+$,C.duration=$,this._validateStyleAst(F,t),F.offset=B,n.styles.push(F)}),n}visitReference(e,t){return{type:se.Reference,animation:Xt(this,Al(e.animation),t),options:or(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:se.AnimateChild,options:or(e.options)}}visitAnimateRef(e,t){return{type:se.AnimateRef,animation:this.visitReference(e.animation,t),options:or(e.options)}}visitQuery(e,t){let n=t.currentQuerySelector,s=e.options||{};t.queryCount++,t.currentQuery=e;let[r,o]=XO(e.selector);t.currentQuerySelector=n.length?n+" "+r:r,Zt(t.collectedStyles,t.currentQuerySelector,new Map);let a=Xt(this,Al(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=n,{type:se.Query,selector:r,limit:s.limit||0,optional:!!s.optional,includeSelf:o,animation:a,originalSelector:e.selector,options:or(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push(vO());let n=e.timings==="full"?{duration:0,delay:0,easing:"full"}:ud(e.timings,t.errors,!0);return{type:se.Stagger,animation:Xt(this,Al(e.animation),t),timings:n,options:null}}};function XO(i){let e=!!i.split(/\s*,\s*/).find(t=>t==Ub);return e&&(i=i.replace(JO,"")),i=i.replace(/@\*/g,cd).replace(/@\w+/g,t=>cd+"-"+t.slice(1)).replace(/:animating/g,Ay),[i,e]}function ZO(i){return i?Ae({},i):null}var xy=class{constructor(e){this.errors=e,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}};function ek(i){if(typeof i=="string")return null;let e=null;if(Array.isArray(i))i.forEach(t=>{if(t instanceof Map&&t.has("offset")){let n=t;e=parseFloat(n.get("offset")),n.delete("offset")}});else if(i instanceof Map&&i.has("offset")){let t=i;e=parseFloat(t.get("offset")),t.delete("offset")}return e}function tk(i,e){if(i.hasOwnProperty("duration"))return i;if(typeof i=="number"){let r=ud(i,e).duration;return wy(r,0,"")}let t=i;if(t.split(/\s+/).some(r=>r.charAt(0)=="{"&&r.charAt(1)=="{")){let r=wy(0,0,"");return r.dynamic=!0,r.strValue=t,r}let s=ud(t,e);return wy(s.duration,s.delay,s.easing)}function or(i){return i?(i=Ae({},i),i.params&&(i.params=ZO(i.params))):i={},i}function wy(i,e,t){return{duration:i,delay:e,easing:t}}function Qy(i,e,t,n,s,r,o=null,a=!1){return{type:1,element:i,keyframes:e,preStyleProps:t,postStyleProps:n,duration:s,delay:r,totalTime:s+r,easing:o,subTimeline:a}}var Nl=class{constructor(){this._map=new Map}get(e){return this._map.get(e)||[]}append(e,t){let n=this._map.get(e);n||this._map.set(e,n=[]),n.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}},nk=1,ik=":enter",sk=new RegExp(ik,"g"),rk=":leave",ok=new RegExp(rk,"g");function jb(i,e,t,n,s,r=new Map,o=new Map,a,c,u=[]){return new Dy().buildKeyframes(i,e,t,n,s,r,o,a,c,u)}var Dy=class{buildKeyframes(e,t,n,s,r,o,a,c,u,d=[]){u=u||new Nl;let f=new Oy(e,t,u,s,r,d,[]);f.options=c;let m=c.delay?Ti(c.delay):0;f.currentTimeline.delayNextStep(m),f.currentTimeline.setStyles([o],null,f.errors,c),Xt(this,n,f);let _=f.timelines.filter(v=>v.containsAnimation());if(_.length&&a.size){let v;for(let C=_.length-1;C>=0;C--){let R=_[C];if(R.element===t){v=R;break}}v&&!v.allowOnlyTimelineStyles()&&v.setStyles([a],null,f.errors,c)}return _.length?_.map(v=>v.buildKeyframes()):[Qy(t,[],[],[],0,m,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){let n=t.subInstructions.get(t.element);if(n){let s=t.createSubContext(e.options),r=t.currentTimeline.currentTime,o=this._visitSubInstructions(n,s,s.options);r!=o&&t.transformIntoNewTimeline(o)}t.previousNode=e}visitAnimateRef(e,t){let n=t.createSubContext(e.options);n.transformIntoNewTimeline(),this._applyAnimationRefDelays([e.options,e.animation.options],t,n),this.visitReference(e.animation,n),t.transformIntoNewTimeline(n.currentTimeline.currentTime),t.previousNode=e}_applyAnimationRefDelays(e,t,n){for(let s of e){let r=s?.delay;if(r){let o=typeof r=="number"?r:Ti(Pl(r,s?.params??{},t.errors));n.delayNextStep(o)}}}_visitSubInstructions(e,t,n){let r=t.currentTimeline.currentTime,o=n.duration!=null?Ti(n.duration):null,a=n.delay!=null?Ti(n.delay):null;return o!==0&&e.forEach(c=>{let u=t.appendInstructionToTimeline(c,o,a);r=Math.max(r,u.duration+u.delay)}),r}visitReference(e,t){t.updateOptions(e.options,!0),Xt(this,e.animation,t),t.previousNode=e}visitSequence(e,t){let n=t.subContextCount,s=t,r=e.options;if(r&&(r.params||r.delay)&&(s=t.createSubContext(r),s.transformIntoNewTimeline(),r.delay!=null)){s.previousNode.type==se.Style&&(s.currentTimeline.snapshotCurrentStyles(),s.previousNode=fd);let o=Ti(r.delay);s.delayNextStep(o)}e.steps.length&&(e.steps.forEach(o=>Xt(this,o,s)),s.currentTimeline.applyStylesToKeyframe(),s.subContextCount>n&&s.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){let n=[],s=t.currentTimeline.currentTime,r=e.options&&e.options.delay?Ti(e.options.delay):0;e.steps.forEach(o=>{let a=t.createSubContext(e.options);r&&a.delayNextStep(r),Xt(this,o,a),s=Math.max(s,a.currentTimeline.currentTime),n.push(a.currentTimeline)}),n.forEach(o=>t.currentTimeline.mergeTimelineCollectedStyles(o)),t.transformIntoNewTimeline(s),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){let n=e.strValue,s=t.params?Pl(n,t.params,t.errors):n;return ud(s,t.errors)}else return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){let n=t.currentAnimateTimings=this._visitTiming(e.timings,t),s=t.currentTimeline;n.delay&&(t.incrementTime(n.delay),s.snapshotCurrentStyles());let r=e.style;r.type==se.Keyframes?this.visitKeyframes(r,t):(t.incrementTime(n.duration),this.visitStyle(r,t),s.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){let n=t.currentTimeline,s=t.currentAnimateTimings;!s&&n.hasCurrentStyleProperties()&&n.forwardFrame();let r=s&&s.easing||e.easing;e.isEmptyStep?n.applyEmptyStep(r):n.setStyles(e.styles,r,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){let n=t.currentAnimateTimings,s=t.currentTimeline.duration,r=n.duration,a=t.createSubContext().currentTimeline;a.easing=n.easing,e.styles.forEach(c=>{let u=c.offset||0;a.forwardTime(u*r),a.setStyles(c.styles,c.easing,t.errors,t.options),a.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(a),t.transformIntoNewTimeline(s+r),t.previousNode=e}visitQuery(e,t){let n=t.currentTimeline.currentTime,s=e.options||{},r=s.delay?Ti(s.delay):0;r&&(t.previousNode.type===se.Style||n==0&&t.currentTimeline.hasCurrentStyleProperties())&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=fd);let o=n,a=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!s.optional,t.errors);t.currentQueryTotal=a.length;let c=null;a.forEach((u,d)=>{t.currentQueryIndex=d;let f=t.createSubContext(e.options,u);r&&f.delayNextStep(r),u===t.element&&(c=f.currentTimeline),Xt(this,e.animation,f),f.currentTimeline.applyStylesToKeyframe();let m=f.currentTimeline.currentTime;o=Math.max(o,m)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(o),c&&(t.currentTimeline.mergeTimelineCollectedStyles(c),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){let n=t.parentContext,s=t.currentTimeline,r=e.timings,o=Math.abs(r.duration),a=o*(t.currentQueryTotal-1),c=o*t.currentQueryIndex;switch(r.duration<0?"reverse":r.easing){case"reverse":c=a-c;break;case"full":c=n.currentStaggerTime;break}let d=t.currentTimeline;c&&d.delayNextStep(c);let f=d.currentTime;Xt(this,e.animation,t),t.previousNode=e,n.currentStaggerTime=s.currentTime-f+(s.startTime-n.currentTimeline.startTime)}},fd={},Oy=class i{constructor(e,t,n,s,r,o,a,c){this._driver=e,this.element=t,this.subInstructions=n,this._enterClassName=s,this._leaveClassName=r,this.errors=o,this.timelines=a,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=fd,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=c||new pd(this._driver,t,0),a.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;let n=e,s=this.options;n.duration!=null&&(s.duration=Ti(n.duration)),n.delay!=null&&(s.delay=Ti(n.delay));let r=n.params;if(r){let o=s.params;o||(o=this.options.params={}),Object.keys(r).forEach(a=>{(!t||!o.hasOwnProperty(a))&&(o[a]=Pl(r[a],o,this.errors))})}}_copyOptions(){let e={};if(this.options){let t=this.options.params;if(t){let n=e.params={};Object.keys(t).forEach(s=>{n[s]=t[s]})}}return e}createSubContext(e=null,t,n){let s=t||this.element,r=new i(this._driver,s,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(s,n||0));return r.previousNode=this.previousNode,r.currentAnimateTimings=this.currentAnimateTimings,r.options=this._copyOptions(),r.updateOptions(e),r.currentQueryIndex=this.currentQueryIndex,r.currentQueryTotal=this.currentQueryTotal,r.parentContext=this,this.subContextCount++,r}transformIntoNewTimeline(e){return this.previousNode=fd,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,n){let s={duration:t??e.duration,delay:this.currentTimeline.currentTime+(n??0)+e.delay,easing:""},r=new ky(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,s,e.stretchStartingKeyframe);return this.timelines.push(r),s}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,n,s,r,o){let a=[];if(s&&a.push(this.element),e.length>0){e=e.replace(sk,"."+this._enterClassName),e=e.replace(ok,"."+this._leaveClassName);let c=n!=1,u=this._driver.query(this.element,e,c);n!==0&&(u=n<0?u.slice(u.length+n,u.length):u.slice(0,n)),a.push(...u)}return!r&&a.length==0&&o.push(EO(t)),a}},pd=class i{constructor(e,t,n,s){this._driver=e,this.element=t,this.startTime=n,this._elementTimelineStylesLookup=s,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(e){let t=this._keyframes.size===1&&this._pendingStyles.size;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new i(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=nk,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles.set(e,t),this._globalTimelineStyles.set(e,t),this._styleSummary.set(e,{time:this.currentTime,value:t})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&this._previousKeyframe.set("easing",e);for(let[t,n]of this._globalTimelineStyles)this._backFill.set(t,n||ei),this._currentKeyframe.set(t,ei);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,n,s){t&&this._previousKeyframe.set("easing",t);let r=s&&s.params||{},o=ak(e,this._globalTimelineStyles);for(let[a,c]of o){let u=Pl(c,r,n);this._pendingStyles.set(a,u),this._localTimelineStyles.has(a)||this._backFill.set(a,this._globalTimelineStyles.get(a)??ei),this._updateStyle(a,u)}}applyStylesToKeyframe(){this._pendingStyles.size!=0&&(this._pendingStyles.forEach((e,t)=>{this._currentKeyframe.set(t,e)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((e,t)=>{this._currentKeyframe.has(t)||this._currentKeyframe.set(t,e)}))}snapshotCurrentStyles(){for(let[e,t]of this._localTimelineStyles)this._pendingStyles.set(e,t),this._updateStyle(e,t)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){let e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){e._styleSummary.forEach((t,n)=>{let s=this._styleSummary.get(n);(!s||t.time>s.time)&&this._updateStyle(n,t.value)})}buildKeyframes(){this.applyStylesToKeyframe();let e=new Set,t=new Set,n=this._keyframes.size===1&&this.duration===0,s=[];this._keyframes.forEach((a,c)=>{let u=new Map([...this._backFill,...a]);u.forEach((d,f)=>{d===ed?e.add(f):d===ei&&t.add(f)}),n||u.set("offset",c/this.duration),s.push(u)});let r=[...e.values()],o=[...t.values()];if(n){let a=s[0],c=new Map(a);a.set("offset",0),c.set("offset",1),s=[a,c]}return Qy(this.element,s,r,o,this.duration,this.startTime,this.easing,!1)}},ky=class extends pd{constructor(e,t,n,s,r,o,a=!1){super(e,t,o.delay),this.keyframes=n,this.preStyleProps=s,this.postStyleProps=r,this._stretchStartingKeyframe=a,this.timings={duration:o.duration,delay:o.delay,easing:o.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:n,easing:s}=this.timings;if(this._stretchStartingKeyframe&&t){let r=[],o=n+t,a=t/o,c=new Map(e[0]);c.set("offset",0),r.push(c);let u=new Map(e[0]);u.set("offset",bb(a)),r.push(u);let d=e.length-1;for(let f=1;f<=d;f++){let m=new Map(e[f]),_=m.get("offset"),v=t+_*n;m.set("offset",bb(v/o)),r.push(m)}n=o,t=0,s="",e=r}return Qy(this.element,e,this.preStyleProps,this.postStyleProps,n,t,s,!0)}};function bb(i,e=3){let t=Math.pow(10,e-1);return Math.round(i*t)/t}function ak(i,e){let t=new Map,n;return i.forEach(s=>{if(s==="*"){n??=e.keys();for(let r of n)t.set(r,ei)}else for(let[r,o]of s)t.set(r,o)}),t}function Ab(i,e,t,n,s,r,o,a,c,u,d,f,m){return{type:0,element:i,triggerName:e,isRemovalTransition:s,fromState:t,fromStyles:r,toState:n,toStyles:o,timelines:a,queriedElements:c,preStyleProps:u,postStyleProps:d,totalTime:f,errors:m}}var Ty={},md=class{constructor(e,t,n){this._triggerName=e,this.ast=t,this._stateStyles=n}match(e,t,n,s){return lk(this.ast.matchers,e,t,n,s)}buildStyles(e,t,n){let s=this._stateStyles.get("*");return e!==void 0&&(s=this._stateStyles.get(e?.toString())||s),s?s.buildStyles(t,n):new Map}build(e,t,n,s,r,o,a,c,u,d){let f=[],m=this.ast.options&&this.ast.options.params||Ty,_=a&&a.params||Ty,v=this.buildStyles(n,_,f),C=c&&c.params||Ty,R=this.buildStyles(s,C,f),F=new Set,V=new Map,B=new Map,$=s==="void",le={params:Gb(C,m),delay:this.ast.options?.delay},Z=d?[]:jb(e,t,this.ast.animation,r,o,v,R,le,u,f),T=0;return Z.forEach(y=>{T=Math.max(y.duration+y.delay,T)}),f.length?Ab(t,this._triggerName,n,s,$,v,R,[],[],V,B,T,f):(Z.forEach(y=>{let w=y.element,I=Zt(V,w,new Set);y.preStyleProps.forEach(A=>I.add(A));let S=Zt(B,w,new Set);y.postStyleProps.forEach(A=>S.add(A)),w!==t&&F.add(w)}),Ab(t,this._triggerName,n,s,$,v,R,Z,[...F.values()],V,B,T))}};function lk(i,e,t,n,s){return i.some(r=>r(e,t,n,s))}function Gb(i,e){let t=Ae({},e);return Object.entries(i).forEach(([n,s])=>{s!=null&&(t[n]=s)}),t}var My=class{constructor(e,t,n){this.styles=e,this.defaultParams=t,this.normalizer=n}buildStyles(e,t){let n=new Map,s=Gb(e,this.defaultParams);return this.styles.styles.forEach(r=>{typeof r!="string"&&r.forEach((o,a)=>{o&&(o=Pl(o,s,t));let c=this.normalizer.normalizePropertyName(a,t);o=this.normalizer.normalizeStyleValue(a,c,o,t),n.set(a,o)})}),n}};function ck(i,e,t){return new Fy(i,e,t)}var Fy=class{constructor(e,t,n){this.name=e,this.ast=t,this._normalizer=n,this.transitionFactories=[],this.states=new Map,t.states.forEach(s=>{let r=s.options&&s.options.params||{};this.states.set(s.name,new My(s.style,r,n))}),Rb(this.states,"true","1"),Rb(this.states,"false","0"),t.transitions.forEach(s=>{this.transitionFactories.push(new md(e,s,this.states))}),this.fallbackTransition=uk(e,this.states,this._normalizer)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,n,s){return this.transitionFactories.find(o=>o.match(e,t,n,s))||null}matchStyles(e,t,n){return this.fallbackTransition.buildStyles(e,t,n)}};function uk(i,e,t){let n=[(o,a)=>!0],s={type:se.Sequence,steps:[],options:null},r={type:se.Transition,animation:s,matchers:n,options:null,queryCount:0,depCount:0};return new md(i,r,e)}function Rb(i,e,t){i.has(e)?i.has(t)||i.set(t,i.get(e)):i.has(t)&&i.set(e,i.get(t))}var hk=new Nl,Ly=class{constructor(e,t,n){this.bodyNode=e,this._driver=t,this._normalizer=n,this._animations=new Map,this._playersById=new Map,this.players=[]}register(e,t){let n=[],s=[],r=qb(this._driver,t,n,s);if(n.length)throw SO(n);s.length&&void 0,this._animations.set(e,r)}_buildPlayer(e,t,n){let s=e.element,r=kb(this._normalizer,e.keyframes,t,n);return this._driver.animate(s,r,e.duration,e.delay,e.easing,[],!0)}create(e,t,n={}){let s=[],r=this._animations.get(e),o,a=new Map;if(r?(o=jb(this._driver,t,r,Vb,by,new Map,new Map,n,hk,s),o.forEach(d=>{let f=Zt(a,d.element,new Map);d.postStyleProps.forEach(m=>f.set(m,null))})):(s.push(bO()),o=[]),s.length)throw AO(s);a.forEach((d,f)=>{d.forEach((m,_)=>{d.set(_,this._driver.computeStyle(f,_,ei))})});let c=o.map(d=>{let f=a.get(d.element);return this._buildPlayer(d,new Map,f)}),u=hs(c);return this._playersById.set(e,u),u.onDestroy(()=>this.destroy(e)),this.players.push(u),u}destroy(e){let t=this._getPlayer(e);t.destroy(),this._playersById.delete(e);let n=this.players.indexOf(t);n>=0&&this.players.splice(n,1)}_getPlayer(e){let t=this._playersById.get(e);if(!t)throw RO(e);return t}listen(e,t,n,s){let r=Gy(t,"","","");return jy(this._getPlayer(e),n,r,s),()=>{}}command(e,t,n,s){if(n=="register"){this.register(e,s[0]);return}if(n=="create"){let o=s[0]||{};this.create(e,t,o);return}let r=this._getPlayer(e);switch(n){case"play":r.play();break;case"pause":r.pause();break;case"reset":r.reset();break;case"restart":r.restart();break;case"finish":r.finish();break;case"init":r.init();break;case"setPosition":r.setPosition(parseFloat(s[0]));break;case"destroy":this.destroy(e);break}}},Pb="ng-animate-queued",dk=".ng-animate-queued",Iy="ng-animate-disabled",fk=".ng-animate-disabled",pk="ng-star-inserted",mk=".ng-star-inserted",gk=[],Wb={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},_k={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Dn="__ng_removed",xl=class{get params(){return this.options.params}constructor(e,t=""){this.namespaceId=t;let n=e&&e.hasOwnProperty("value"),s=n?e.value:e;if(this.value=vk(s),n){let r=e,{value:o}=r,a=$v(r,["value"]);this.options=a}else this.options={};this.options.params||(this.options.params={})}absorbOptions(e){let t=e.params;if(t){let n=this.options.params;Object.keys(t).forEach(s=>{n[s]==null&&(n[s]=t[s])})}}},Rl="void",Cy=new xl(Rl),Vy=class{constructor(e,t,n){this.id=e,this.hostElement=t,this._engine=n,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+e,_n(t,this._hostClassName)}listen(e,t,n,s){if(!this._triggers.has(t))throw PO(n,t);if(n==null||n.length==0)throw NO(t);if(!Ek(n))throw xO(n,t);let r=Zt(this._elementListeners,e,[]),o={name:t,phase:n,callback:s};r.push(o);let a=Zt(this._engine.statesByElement,e,new Map);return a.has(t)||(_n(e,sd),_n(e,sd+"-"+t),a.set(t,Cy)),()=>{this._engine.afterFlush(()=>{let c=r.indexOf(o);c>=0&&r.splice(c,1),this._triggers.has(t)||a.delete(t)})}}register(e,t){return this._triggers.has(e)?!1:(this._triggers.set(e,t),!0)}_getTrigger(e){let t=this._triggers.get(e);if(!t)throw DO(e);return t}trigger(e,t,n,s=!0){let r=this._getTrigger(t),o=new Dl(this.id,t,e),a=this._engine.statesByElement.get(e);a||(_n(e,sd),_n(e,sd+"-"+t),this._engine.statesByElement.set(e,a=new Map));let c=a.get(t),u=new xl(n,this.id);if(!(n&&n.hasOwnProperty("value"))&&c&&u.absorbOptions(c.options),a.set(t,u),c||(c=Cy),!(u.value===Rl)&&c.value===u.value){if(!Ik(c.params,u.params)){let C=[],R=r.matchStyles(c.value,c.params,C),F=r.matchStyles(u.value,u.params,C);C.length?this._engine.reportError(C):this._engine.afterFlush(()=>{ar(e,R),ti(e,F)})}return}let m=Zt(this._engine.playersByElement,e,[]);m.forEach(C=>{C.namespaceId==this.id&&C.triggerName==t&&C.queued&&C.destroy()});let _=r.matchTransition(c.value,u.value,e,u.params),v=!1;if(!_){if(!s)return;_=r.fallbackTransition,v=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:_,fromState:c,toState:u,player:o,isFallbackTransition:v}),v||(_n(e,Pb),o.onStart(()=>{xo(e,Pb)})),o.onDone(()=>{let C=this.players.indexOf(o);C>=0&&this.players.splice(C,1);let R=this._engine.playersByElement.get(e);if(R){let F=R.indexOf(o);F>=0&&R.splice(F,1)}}),this.players.push(o),m.push(o),o}deregister(e){this._triggers.delete(e),this._engine.statesByElement.forEach(t=>t.delete(e)),this._elementListeners.forEach((t,n)=>{this._elementListeners.set(n,t.filter(s=>s.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);let t=this._engine.playersByElement.get(e);t&&(t.forEach(n=>n.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){let n=this._engine.driver.query(e,cd,!0);n.forEach(s=>{if(s[Dn])return;let r=this._engine.fetchNamespacesByElement(s);r.size?r.forEach(o=>o.triggerLeaveAnimation(s,t,!1,!0)):this.clearElementCache(s)}),this._engine.afterFlushAnimationsDone(()=>n.forEach(s=>this.clearElementCache(s)))}triggerLeaveAnimation(e,t,n,s){let r=this._engine.statesByElement.get(e),o=new Map;if(r){let a=[];if(r.forEach((c,u)=>{if(o.set(u,c.value),this._triggers.has(u)){let d=this.trigger(e,u,Rl,s);d&&a.push(d)}}),a.length)return this._engine.markElementAsRemoved(this.id,e,!0,t,o),n&&hs(a).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){let t=this._elementListeners.get(e),n=this._engine.statesByElement.get(e);if(t&&n){let s=new Set;t.forEach(r=>{let o=r.name;if(s.has(o))return;s.add(o);let c=this._triggers.get(o).fallbackTransition,u=n.get(o)||Cy,d=new xl(Rl),f=new Dl(this.id,o,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:o,transition:c,fromState:u,toState:d,player:f,isFallbackTransition:!0})})}}removeNode(e,t){let n=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let s=!1;if(n.totalAnimations){let r=n.players.length?n.playersByQueriedElement.get(e):[];if(r&&r.length)s=!0;else{let o=e;for(;o=o.parentNode;)if(n.statesByElement.get(o)){s=!0;break}}}if(this.prepareLeaveAnimationListeners(e),s)n.markElementAsRemoved(this.id,e,!1,t);else{let r=e[Dn];(!r||r===Wb)&&(n.afterFlush(()=>this.clearElementCache(e)),n.destroyInnerAnimations(e),n._onRemovalComplete(e,t))}}insertNode(e,t){_n(e,this._hostClassName)}drainQueuedTransitions(e){let t=[];return this._queue.forEach(n=>{let s=n.player;if(s.destroyed)return;let r=n.element,o=this._elementListeners.get(r);o&&o.forEach(a=>{if(a.name==n.triggerName){let c=Gy(r,n.triggerName,n.fromState.value,n.toState.value);c._data=e,jy(n.player,a.phase,c,a.callback)}}),s.markedForDestroy?this._engine.afterFlush(()=>{s.destroy()}):t.push(n)}),this._queue=[],t.sort((n,s)=>{let r=n.transition.ast.depCount,o=s.transition.ast.depCount;return r==0||o==0?r-o:this._engine.driver.containsElement(n.element,s.element)?1:-1})}destroy(e){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}},By=class{_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}constructor(e,t,n){this.bodyNode=e,this.driver=t,this._normalizer=n,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(s,r)=>{}}get queuedPlayers(){let e=[];return this._namespaceList.forEach(t=>{t.players.forEach(n=>{n.queued&&e.push(n)})}),e}createNamespace(e,t){let n=new Vy(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(n,t):(this.newHostElements.set(t,n),this.collectEnterElement(t)),this._namespaceLookup[e]=n}_balanceNamespaceList(e,t){let n=this._namespaceList,s=this.namespacesByHostElement;if(n.length-1>=0){let o=!1,a=this.driver.getParentElement(t);for(;a;){let c=s.get(a);if(c){let u=n.indexOf(c);n.splice(u+1,0,e),o=!0;break}a=this.driver.getParentElement(a)}o||n.unshift(e)}else n.push(e);return s.set(t,e),e}register(e,t){let n=this._namespaceLookup[e];return n||(n=this.createNamespace(e,t)),n}registerTrigger(e,t,n){let s=this._namespaceLookup[e];s&&s.register(t,n)&&this.totalAnimations++}destroy(e,t){e&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{let n=this._fetchNamespace(e);this.namespacesByHostElement.delete(n.hostElement);let s=this._namespaceList.indexOf(n);s>=0&&this._namespaceList.splice(s,1),n.destroy(t),delete this._namespaceLookup[e]}))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){let t=new Set,n=this.statesByElement.get(e);if(n){for(let s of n.values())if(s.namespaceId){let r=this._fetchNamespace(s.namespaceId);r&&t.add(r)}}return t}trigger(e,t,n,s){if(ad(t)){let r=this._fetchNamespace(e);if(r)return r.trigger(t,n,s),!0}return!1}insertNode(e,t,n,s){if(!ad(t))return;let r=t[Dn];if(r&&r.setForRemoval){r.setForRemoval=!1,r.setForMove=!0;let o=this.collectedLeaveElements.indexOf(t);o>=0&&this.collectedLeaveElements.splice(o,1)}if(e){let o=this._fetchNamespace(e);o&&o.insertNode(t,n)}s&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),_n(e,Iy)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),xo(e,Iy))}removeNode(e,t,n){if(ad(t)){let s=e?this._fetchNamespace(e):null;s?s.removeNode(t,n):this.markElementAsRemoved(e,t,!1,n);let r=this.namespacesByHostElement.get(t);r&&r.id!==e&&r.removeNode(t,n)}else this._onRemovalComplete(t,n)}markElementAsRemoved(e,t,n,s,r){this.collectedLeaveElements.push(t),t[Dn]={namespaceId:e,setForRemoval:s,hasAnimation:n,removedBeforeQueried:!1,previousTriggersValues:r}}listen(e,t,n,s,r){return ad(t)?this._fetchNamespace(e).listen(t,n,s,r):()=>{}}_buildInstruction(e,t,n,s,r){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,n,s,e.fromState.options,e.toState.options,t,r)}destroyInnerAnimations(e){let t=this.driver.query(e,cd,!0);t.forEach(n=>this.destroyActiveAnimationsForElement(n)),this.playersByQueriedElement.size!=0&&(t=this.driver.query(e,Ay,!0),t.forEach(n=>this.finishActiveQueriedAnimationOnElement(n)))}destroyActiveAnimationsForElement(e){let t=this.playersByElement.get(e);t&&t.forEach(n=>{n.queued?n.markedForDestroy=!0:n.destroy()})}finishActiveQueriedAnimationOnElement(e){let t=this.playersByQueriedElement.get(e);t&&t.forEach(n=>n.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return hs(this.players).onDone(()=>e());e()})}processLeaveNode(e){let t=e[Dn];if(t&&t.setForRemoval){if(e[Dn]=Wb,t.namespaceId){this.destroyInnerAnimations(e);let n=this._fetchNamespace(t.namespaceId);n&&n.clearElementCache(e)}this._onRemovalComplete(e,t.setForRemoval)}e.classList?.contains(Iy)&&this.markElementAsDisabled(e,!1),this.driver.query(e,fk,!0).forEach(n=>{this.markElementAsDisabled(n,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((n,s)=>this._balanceNamespaceList(n,s)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let n=0;n<this.collectedEnterElements.length;n++){let s=this.collectedEnterElements[n];_n(s,pk)}if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){let n=[];try{t=this._flushAnimations(n,e)}finally{for(let s=0;s<n.length;s++)n[s]()}}else for(let n=0;n<this.collectedLeaveElements.length;n++){let s=this.collectedLeaveElements[n];this.processLeaveNode(s)}if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(n=>n()),this._flushFns=[],this._whenQuietFns.length){let n=this._whenQuietFns;this._whenQuietFns=[],t.length?hs(t).onDone(()=>{n.forEach(s=>s())}):n.forEach(s=>s())}}reportError(e){throw OO(e)}_flushAnimations(e,t){let n=new Nl,s=[],r=new Map,o=[],a=new Map,c=new Map,u=new Map,d=new Set;this.disabledNodes.forEach(H=>{d.add(H);let Y=this.driver.query(H,dk,!0);for(let X=0;X<Y.length;X++)d.add(Y[X])});let f=this.bodyNode,m=Array.from(this.statesByElement.keys()),_=Db(m,this.collectedEnterElements),v=new Map,C=0;_.forEach((H,Y)=>{let X=Vb+C++;v.set(Y,X),H.forEach(me=>_n(me,X))});let R=[],F=new Set,V=new Set;for(let H=0;H<this.collectedLeaveElements.length;H++){let Y=this.collectedLeaveElements[H],X=Y[Dn];X&&X.setForRemoval&&(R.push(Y),F.add(Y),X.hasAnimation?this.driver.query(Y,mk,!0).forEach(me=>F.add(me)):V.add(Y))}let B=new Map,$=Db(m,Array.from(F));$.forEach((H,Y)=>{let X=by+C++;B.set(Y,X),H.forEach(me=>_n(me,X))}),e.push(()=>{_.forEach((H,Y)=>{let X=v.get(Y);H.forEach(me=>xo(me,X))}),$.forEach((H,Y)=>{let X=B.get(Y);H.forEach(me=>xo(me,X))}),R.forEach(H=>{this.processLeaveNode(H)})});let le=[],Z=[];for(let H=this._namespaceList.length-1;H>=0;H--)this._namespaceList[H].drainQueuedTransitions(t).forEach(X=>{let me=X.player,Je=X.element;if(le.push(me),this.collectedEnterElements.length){let He=Je[Dn];if(He&&He.setForMove){if(He.previousTriggersValues&&He.previousTriggersValues.has(X.triggerName)){let ni=He.previousTriggersValues.get(X.triggerName),qt=this.statesByElement.get(X.element);if(qt&&qt.has(X.triggerName)){let ii=qt.get(X.triggerName);ii.value=ni,qt.set(X.triggerName,ii)}}me.destroy();return}}let tn=!f||!this.driver.containsElement(f,Je),Ke=B.get(Je),Fe=v.get(Je),Le=this._buildInstruction(X,n,Fe,Ke,tn);if(Le.errors&&Le.errors.length){Z.push(Le);return}if(tn){me.onStart(()=>ar(Je,Le.fromStyles)),me.onDestroy(()=>ti(Je,Le.toStyles)),s.push(me);return}if(X.isFallbackTransition){me.onStart(()=>ar(Je,Le.fromStyles)),me.onDestroy(()=>ti(Je,Le.toStyles)),s.push(me);return}let Ci=[];Le.timelines.forEach(He=>{He.stretchStartingKeyframe=!0,this.disabledNodes.has(He.element)||Ci.push(He)}),Le.timelines=Ci,n.append(Je,Le.timelines);let wd={instruction:Le,player:me,element:Je};o.push(wd),Le.queriedElements.forEach(He=>Zt(a,He,[]).push(me)),Le.preStyleProps.forEach((He,ni)=>{if(He.size){let qt=c.get(ni);qt||c.set(ni,qt=new Set),He.forEach((ii,Si)=>qt.add(Si))}}),Le.postStyleProps.forEach((He,ni)=>{let qt=u.get(ni);qt||u.set(ni,qt=new Set),He.forEach((ii,Si)=>qt.add(Si))})});if(Z.length){let H=[];Z.forEach(Y=>{H.push(kO(Y.triggerName,Y.errors))}),le.forEach(Y=>Y.destroy()),this.reportError(H)}let T=new Map,y=new Map;o.forEach(H=>{let Y=H.element;n.has(Y)&&(y.set(Y,Y),this._beforeAnimationBuild(H.player.namespaceId,H.instruction,T))}),s.forEach(H=>{let Y=H.element;this._getPreviousPlayers(Y,!1,H.namespaceId,H.triggerName,null).forEach(me=>{Zt(T,Y,[]).push(me),me.destroy()})});let w=R.filter(H=>Ob(H,c,u)),I=new Map;xb(I,this.driver,V,u,ei).forEach(H=>{Ob(H,c,u)&&w.push(H)});let A=new Map;_.forEach((H,Y)=>{xb(A,this.driver,new Set(H),c,ed)}),w.forEach(H=>{let Y=I.get(H),X=A.get(H);I.set(H,new Map([...Y?.entries()??[],...X?.entries()??[]]))});let E=[],en=[],Ii={};o.forEach(H=>{let{element:Y,player:X,instruction:me}=H;if(n.has(Y)){if(d.has(Y)){X.onDestroy(()=>ti(Y,me.toStyles)),X.disabled=!0,X.overrideTotalTime(me.totalTime),s.push(X);return}let Je=Ii;if(y.size>1){let Ke=Y,Fe=[];for(;Ke=Ke.parentNode;){let Le=y.get(Ke);if(Le){Je=Le;break}Fe.push(Ke)}Fe.forEach(Le=>y.set(Le,Je))}let tn=this._buildAnimation(X.namespaceId,me,T,r,A,I);if(X.setRealPlayer(tn),Je===Ii)E.push(X);else{let Ke=this.playersByElement.get(Je);Ke&&Ke.length&&(X.parentPlayer=hs(Ke)),s.push(X)}}else ar(Y,me.fromStyles),X.onDestroy(()=>ti(Y,me.toStyles)),en.push(X),d.has(Y)&&s.push(X)}),en.forEach(H=>{let Y=r.get(H.element);if(Y&&Y.length){let X=hs(Y);H.setRealPlayer(X)}}),s.forEach(H=>{H.parentPlayer?H.syncPlayerEvents(H.parentPlayer):H.destroy()});for(let H=0;H<R.length;H++){let Y=R[H],X=Y[Dn];if(xo(Y,by),X&&X.hasAnimation)continue;let me=[];if(a.size){let tn=a.get(Y);tn&&tn.length&&me.push(...tn);let Ke=this.driver.query(Y,Ay,!0);for(let Fe=0;Fe<Ke.length;Fe++){let Le=a.get(Ke[Fe]);Le&&Le.length&&me.push(...Le)}}let Je=me.filter(tn=>!tn.destroyed);Je.length?wk(this,Y,Je):this.processLeaveNode(Y)}return R.length=0,E.forEach(H=>{this.players.push(H),H.onDone(()=>{H.destroy();let Y=this.players.indexOf(H);this.players.splice(Y,1)}),H.play()}),E}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,n,s,r){let o=[];if(t){let a=this.playersByQueriedElement.get(e);a&&(o=a)}else{let a=this.playersByElement.get(e);if(a){let c=!r||r==Rl;a.forEach(u=>{u.queued||!c&&u.triggerName!=s||o.push(u)})}}return(n||s)&&(o=o.filter(a=>!(n&&n!=a.namespaceId||s&&s!=a.triggerName))),o}_beforeAnimationBuild(e,t,n){let s=t.triggerName,r=t.element,o=t.isRemovalTransition?void 0:e,a=t.isRemovalTransition?void 0:s;for(let c of t.timelines){let u=c.element,d=u!==r,f=Zt(n,u,[]);this._getPreviousPlayers(u,d,o,a,t.toState).forEach(_=>{let v=_.getRealPlayer();v.beforeDestroy&&v.beforeDestroy(),_.destroy(),f.push(_)})}ar(r,t.fromStyles)}_buildAnimation(e,t,n,s,r,o){let a=t.triggerName,c=t.element,u=[],d=new Set,f=new Set,m=t.timelines.map(v=>{let C=v.element;d.add(C);let R=C[Dn];if(R&&R.removedBeforeQueried)return new us(v.duration,v.delay);let F=C!==c,V=Tk((n.get(C)||gk).map(T=>T.getRealPlayer())).filter(T=>{let y=T;return y.element?y.element===C:!1}),B=r.get(C),$=o.get(C),le=kb(this._normalizer,v.keyframes,B,$),Z=this._buildPlayer(v,le,V);if(v.subTimeline&&s&&f.add(C),F){let T=new Dl(e,a,C);T.setRealPlayer(Z),u.push(T)}return Z});u.forEach(v=>{Zt(this.playersByQueriedElement,v.element,[]).push(v),v.onDone(()=>yk(this.playersByQueriedElement,v.element,v))}),d.forEach(v=>_n(v,Ib));let _=hs(m);return _.onDestroy(()=>{d.forEach(v=>xo(v,Ib)),ti(c,t.toStyles)}),f.forEach(v=>{Zt(s,v,[]).push(_)}),_}_buildPlayer(e,t,n){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,n):new us(e.duration,e.delay)}},Dl=class{constructor(e,t,n){this.namespaceId=e,this.triggerName=t,this.element=n,this._player=new us,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(e){this._containsRealPlayer||(this._player=e,this._queuedCallbacks.forEach((t,n)=>{t.forEach(s=>jy(e,n,void 0,s))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){let t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){Zt(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return this.queued?!1:this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){let t=this._player;t.triggerCallback&&t.triggerCallback(e)}};function yk(i,e,t){let n=i.get(e);if(n){if(n.length){let s=n.indexOf(t);n.splice(s,1)}n.length==0&&i.delete(e)}return n}function vk(i){return i??null}function ad(i){return i&&i.nodeType===1}function Ek(i){return i=="start"||i=="done"}function Nb(i,e){let t=i.style.display;return i.style.display=e??"none",t}function xb(i,e,t,n,s){let r=[];t.forEach(c=>r.push(Nb(c)));let o=[];n.forEach((c,u)=>{let d=new Map;c.forEach(f=>{let m=e.computeStyle(u,f,s);d.set(f,m),(!m||m.length==0)&&(u[Dn]=_k,o.push(u))}),i.set(u,d)});let a=0;return t.forEach(c=>Nb(c,r[a++])),o}function Db(i,e){let t=new Map;if(i.forEach(a=>t.set(a,[])),e.length==0)return t;let n=1,s=new Set(e),r=new Map;function o(a){if(!a)return n;let c=r.get(a);if(c)return c;let u=a.parentNode;return t.has(u)?c=u:s.has(u)?c=n:c=o(u),r.set(a,c),c}return e.forEach(a=>{let c=o(a);c!==n&&t.get(c).push(a)}),t}function _n(i,e){i.classList?.add(e)}function xo(i,e){i.classList?.remove(e)}function wk(i,e,t){hs(t).onDone(()=>i.processLeaveNode(e))}function Tk(i){let e=[];return zb(i,e),e}function zb(i,e){for(let t=0;t<i.length;t++){let n=i[t];n instanceof Cl?zb(n.players,e):e.push(n)}}function Ik(i,e){let t=Object.keys(i),n=Object.keys(e);if(t.length!=n.length)return!1;for(let s=0;s<t.length;s++){let r=t[s];if(!e.hasOwnProperty(r)||i[r]!==e[r])return!1}return!0}function Ob(i,e,t){let n=t.get(i);if(!n)return!1;let s=e.get(i);return s?n.forEach(r=>s.add(r)):e.set(i,n),t.delete(i),!0}var Do=class{constructor(e,t,n){this._driver=t,this._normalizer=n,this._triggerCache={},this.onRemovalComplete=(s,r)=>{},this._transitionEngine=new By(e.body,t,n),this._timelineEngine=new Ly(e.body,t,n),this._transitionEngine.onRemovalComplete=(s,r)=>this.onRemovalComplete(s,r)}registerTrigger(e,t,n,s,r){let o=e+"-"+s,a=this._triggerCache[o];if(!a){let c=[],u=[],d=qb(this._driver,r,c,u);if(c.length)throw IO(s,c);u.length&&void 0,a=ck(s,d,this._normalizer),this._triggerCache[o]=a}this._transitionEngine.registerTrigger(t,s,a)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,n,s){this._transitionEngine.insertNode(e,t,n,s)}onRemove(e,t,n){this._transitionEngine.removeNode(e,t,n)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,n,s){if(n.charAt(0)=="@"){let[r,o]=wb(n),a=s;this._timelineEngine.command(r,t,o,a)}else this._transitionEngine.trigger(e,t,n,s)}listen(e,t,n,s,r){if(n.charAt(0)=="@"){let[o,a]=wb(n);return this._timelineEngine.listen(o,t,a,r)}return this._transitionEngine.listen(e,t,n,s,r)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(e){this._transitionEngine.afterFlushAnimationsDone(e)}};function Ck(i,e){let t=null,n=null;return Array.isArray(e)&&e.length?(t=Sy(e[0]),e.length>1&&(n=Sy(e[e.length-1]))):e instanceof Map&&(t=Sy(e)),t||n?new Uy(i,t,n):null}var Uy=class i{static{this.initialStylesByElement=new WeakMap}constructor(e,t,n){this._element=e,this._startStyles=t,this._endStyles=n,this._state=0;let s=i.initialStylesByElement.get(e);s||i.initialStylesByElement.set(e,s=new Map),this._initialStyles=s}start(){this._state<1&&(this._startStyles&&ti(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(ti(this._element,this._initialStyles),this._endStyles&&(ti(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(i.initialStylesByElement.delete(this._element),this._startStyles&&(ar(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(ar(this._element,this._endStyles),this._endStyles=null),ti(this._element,this._initialStyles),this._state=3)}};function Sy(i){let e=null;return i.forEach((t,n)=>{Sk(n)&&(e=e||new Map,e.set(n,t))}),e}function Sk(i){return i==="display"||i==="position"}var gd=class{constructor(e,t,n,s){this.element=e,this.keyframes=t,this.options=n,this._specialStyles=s,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=n.duration,this._delay=n.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;let e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:new Map;let t=()=>this._onFinish();this.domPlayer.addEventListener("finish",t),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",t)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(e){let t=[];return e.forEach(n=>{t.push(Object.fromEntries(n))}),t}_triggerWebAnimation(e,t,n){return e.animate(this._convertKeyframesToObject(t),n)}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){this.domPlayer===void 0&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){let e=new Map;this.hasStarted()&&this._finalKeyframe.forEach((n,s)=>{s!=="offset"&&e.set(s,this._finished?n:Hy(this.element,s))}),this.currentSnapshot=e}triggerCallback(e){let t=e==="start"?this._onStartFns:this._onDoneFns;t.forEach(n=>n()),t.length=0}},_d=class{validateStyleProperty(e){return!0}validateAnimatableStyleProperty(e){return!0}containsElement(e,t){return Mb(e,t)}getParentElement(e){return Wy(e)}query(e,t,n){return Fb(e,t,n)}computeStyle(e,t,n){return Hy(e,t)}animate(e,t,n,s,r,o=[]){let a=s==0?"both":"forwards",c={duration:n,delay:s,fill:a};r&&(c.easing=r);let u=new Map,d=o.filter(_=>_ instanceof gd);zO(n,s)&&d.forEach(_=>{_.currentSnapshot.forEach((v,C)=>u.set(C,v))});let f=jO(t).map(_=>new Map(_));f=KO(e,f,u);let m=Ck(e,f);return new gd(e,f,c,m)}};var ld="@",Kb="@.disabled",yd=class{constructor(e,t,n,s){this.namespaceId=e,this.delegate=t,this.engine=n,this._onDestroy=s,this.\u0275type=0}get data(){return this.delegate.data}destroyNode(e){this.delegate.destroyNode?.(e)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,n,s=!0){this.delegate.insertBefore(e,t,n),this.engine.onInsert(this.namespaceId,t,e,s)}removeChild(e,t,n){this.parentNode(t)&&this.engine.onRemove(this.namespaceId,t,this.delegate)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,n,s){this.delegate.setAttribute(e,t,n,s)}removeAttribute(e,t,n){this.delegate.removeAttribute(e,t,n)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,n,s){this.delegate.setStyle(e,t,n,s)}removeStyle(e,t,n){this.delegate.removeStyle(e,t,n)}setProperty(e,t,n){t.charAt(0)==ld&&t==Kb?this.disableAnimations(e,!!n):this.delegate.setProperty(e,t,n)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,n){return this.delegate.listen(e,t,n)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}},qy=class extends yd{constructor(e,t,n,s,r){super(t,n,s,r),this.factory=e,this.namespaceId=t}setProperty(e,t,n){t.charAt(0)==ld?t.charAt(1)=="."&&t==Kb?(n=n===void 0?!0:!!n,this.disableAnimations(e,n)):this.engine.process(this.namespaceId,e,t.slice(1),n):this.delegate.setProperty(e,t,n)}listen(e,t,n){if(t.charAt(0)==ld){let s=bk(e),r=t.slice(1),o="";return r.charAt(0)!=ld&&([r,o]=Ak(r)),this.engine.listen(this.namespaceId,s,r,o,a=>{let c=a._data||-1;this.factory.scheduleListenerCallback(c,n,a)})}return this.delegate.listen(e,t,n)}};function bk(i){switch(i){case"body":return document.body;case"document":return document;case"window":return window;default:return i}}function Ak(i){let e=i.indexOf("."),t=i.substring(0,e),n=i.slice(e+1);return[t,n]}var vd=class{constructor(e,t,n){this.delegate=e,this.engine=t,this._zone=n,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,t.onRemovalComplete=(s,r)=>{r?.removeChild(null,s)}}createRenderer(e,t){let n="",s=this.delegate.createRenderer(e,t);if(!e||!t?.data?.animation){let u=this._rendererCache,d=u.get(s);if(!d){let f=()=>u.delete(s);d=new yd(n,s,this.engine,f),u.set(s,d)}return d}let r=t.id,o=t.id+"-"+this._currentId;this._currentId++,this.engine.register(o,e);let a=u=>{Array.isArray(u)?u.forEach(a):this.engine.registerTrigger(r,o,e,u.name,u)};return t.data.animation.forEach(a),new qy(this,o,s,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(e,t,n){if(e>=0&&e<this._microtaskId){this._zone.run(()=>t(n));return}let s=this._animationCallbacksBuffer;s.length==0&&queueMicrotask(()=>{this._zone.run(()=>{s.forEach(r=>{let[o,a]=r;o(a)}),this._animationCallbacksBuffer=[]})}),s.push([t,n])}end(){this._cdRecurDepth--,this._cdRecurDepth==0&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}};var Pk=(()=>{class i extends Do{constructor(t,n,s){super(t,n,s)}ngOnDestroy(){this.flush()}static{this.\u0275fac=function(n){return new(n||i)(te(an),te(lr),te(cr))}}static{this.\u0275prov=yt({token:i,factory:i.\u0275fac})}}return i})();function Nk(){return new hd}function xk(i,e,t){return new vd(i,e,t)}var Hb=[{provide:cr,useFactory:Nk},{provide:Do,useClass:Pk},{provide:o0,useFactory:xk,deps:[E0,Do,zt]}],Dk=[{provide:lr,useFactory:()=>new _d},{provide:$d,useValue:"BrowserAnimations"},...Hb],UL=[{provide:lr,useClass:zy},{provide:$d,useValue:"NoopAnimations"},...Hb];function Qb(){return a0("NgEagerAnimations"),[...Dk]}var $b={apiKey:"AIzaSyAdWLVOkP8pLrNZkELpC8Mm1fVdbkd1kEk",authDomain:"expenses-5d437.firebaseapp.com",projectId:"expenses-5d437",storageBucket:"expenses-5d437.appspot.com",messagingSenderId:"202582971776",appId:"1:202582971776:web:6b55340bb59e17d4565d65"};var Yb={providers:[g0({eventCoalescing:!0}),S0(vb),n0([L0.initializeApp($b),V0,_T,ZS,nd]),Qb(),mb()]};function Ok(i,e){if(i&1&&(G(0,"div",13),oe(1,"Logged on user: "),G(2,"strong"),oe(3),W()()),i&2){let t=ne();L(3),kn(t.user)}}var Ed=class i{constructor(e){this.toastr=e}title="expenses";auth=lt(ci);isLoginFormModelOpen=!1;isLoggedIn=lt(ci).isLoggedIn();user;logOut(){this.auth.logout().then(()=>{this.toastr.warning("Logged out","User logged out successfully",{timeOut:5e3,positionClass:"toast-top-right",closeButton:!0,progressBar:!0})})}ngOnInit(){this.isLoggedIn.subscribe(e=>{if(e){let t=localStorage.getItem("user");if(t){let n=JSON.parse(t);this.user=n.email,this.toastr.success(this.user,"User logged in successfully",{timeOut:5e3,positionClass:"toast-top-right",closeButton:!0,progressBar:!0})}}})}static \u0275fac=function(t){return new(t||i)(he(Po))};static \u0275cmp=Se({type:i,selectors:[["app-root"]],standalone:!0,features:[Ne],decls:21,vars:3,consts:[[1,"navbar","navbar-expand-lg","border-bottom","sticky-top","navbar-light","bg-light"],[1,"container-fluid"],["href","#",1,"navbar-brand"],["type","button","data-bs-toggle","collapse","data-bs-target","#navbarSupportedContent","aria-controls","navbarSupportedContent","aria-expanded","false","aria-label","Toggle navigation",1,"navbar-toggler"],[1,"navbar-toggler-icon"],["id","navbarSupportedContent",1,"collapse","navbar-collapse"],[1,"navbar-nav","me-auto","mb-2","mb-lg-0"],[1,"nav-item"],["aria-current","page","href","/",1,"nav-link","active"],["aria-current","page","href","/login",1,"nav-link","active"],["aria-current","page","href","/",1,"nav-link","active",3,"click"],["class","align-items-center",4,"ngIf"],[1,"container","my-4"],[1,"align-items-center"]],template:function(t,n){t&1&&(G(0,"nav",0)(1,"div",1)(2,"a",2),oe(3,"Expense Tracker"),W(),G(4,"button",3),re(5,"span",4),W(),G(6,"div",5)(7,"ul",6)(8,"li",7)(9,"a",8),oe(10,"Home"),W()(),G(11,"li",7)(12,"a",9),oe(13,"Login"),W()(),G(14,"li",7)(15,"a",10),Ue("click",function(){return n.logOut()}),oe(16,"Logout"),W()()(),be(17,Ok,4,1,"div",11),ws(18,"async"),W()()(),G(19,"div",12),re(20,"router-outlet"),W()),t&2&&(L(17),z("ngIf",Xo(18,1,n.isLoggedIn)))},dependencies:[I0,Di,In,oc]})};w0(Ed,Yb).catch(i=>console.error(i));

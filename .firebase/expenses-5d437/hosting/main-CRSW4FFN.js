import{a as mf}from"./chunk-YNDMNXWM.js";import{$ as se,$a as Ov,A as gv,Aa as Re,Ab as Zv,B as _v,Ba as hc,Bb as vi,C as yv,Ca as Fn,Cb as ew,D as ze,Da as dc,Db as pf,E as je,Ea as fc,Eb as tw,F as Nt,Fa as Rv,Fb as nw,G as kt,Ga as xs,Gb as zc,H as br,Ha as ua,Hb as iw,I as gi,Ia as lf,Ib as sw,J as zt,Ja as xv,Jb as rw,K as _i,Ka as Ar,Kb as ow,L as _n,La as Pv,Lb as aw,M as af,Ma as pc,Mb as lw,N as vv,Na as lt,O as la,Oa as Ps,P as k,Pa as Dv,Q as ie,Qa as bt,R as wv,Ra as Ds,S as Ev,Sa as Nv,T as Tv,Ta as mc,U as Sr,Ua as rn,V as Iv,Va as Rr,W as Cv,Wa as gc,X as Ui,Xa as _c,Y as Ot,Ya as kv,Z as Mn,Za as In,_ as de,_a as Cn,a as sc,aa as O,ab as Mv,b as nt,ba as ca,bb as Fv,c as rc,ca as bv,cb as yc,d as oa,da as Ee,db as Lv,e as aa,ea as Ss,eb as Vv,f as at,fa as L,fb as vc,g as rf,ga as V,gb as Bv,h as of,ha as te,hb as Uv,i as oc,ia as Jt,ib as wc,j as ac,ja as Zt,jb as Ac,k as bs,ka as yn,kb as Rc,l as hv,la as Ct,lb as xc,m as dv,ma as Sv,mb as yt,n as lc,na as De,nb as Pc,o as fv,oa as Q,ob as Dc,p as pv,pa as As,pb as Nc,q as be,qa as Rs,qb as Jv,r as pt,ra as cc,rb as kc,s as mt,sa as yi,sb as Oc,t as Wn,ta as vn,tb as Mc,u as ne,ua as wn,ub as Fc,v as Ke,va as Av,vb as Lc,w as ye,wa as ae,wb as Vc,x as gt,xa as En,xb as Bc,y as gn,ya as Tn,yb as Uc,z as mv,za as uc,zb as qc}from"./chunk-GOILVWMB.js";import{A as Kv,B as Qv,C as bn,D as qi,E as Ic,F as da,G as hf,H as $v,I as Yv,J as re,K as en,L as _t,M as df,N as Xv,O as fa,P as ve,Q as Kn,R as Cc,S as ff,T as Sn,U as Pr,V as bc,W as Sc,Y as Dr,Z as zi,a as Ce,b as sn,c as uv,d as sf,e as N,j as B,k as xr,l as qv,m as zv,n as jv,o as jt,p as Ec,q as ha,r as cf,s as Gv,t as Hn,u as uf,v as Wv,w as Hv,y as Tc,z as ct}from"./chunk-6H46YYVM.js";var cw="@firebase/database",uw="1.0.8";var Ap="";function Rp(i){Ap=i}var If=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),ct(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Tc(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var Cf=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return bn(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var qw=function(i){try{if(typeof window<"u"&&typeof window[i]<"u"){let e=window[i];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new If(e)}}catch{}return new Cf},ks=qw("localStorage"),bf=qw("sessionStorage");var Mr=new Pr("@firebase/database"),zw=function(){let i=1;return function(){return i++}}(),jw=function(i){let e=Xv(i),t=new Yv;t.update(e);let n=t.digest();return qv.encodeByteArray(n)},La=function(...i){let e="";for(let t=0;t<i.length;t++){let n=i[t];Array.isArray(n)||n&&typeof n=="object"&&typeof n.length=="number"?e+=La.apply(null,n):typeof n=="object"?e+=ct(n):e+=n,e+=" "}return e},Os=null,hw=!0,Gw=function(i,e){B(!e||i===!0||i===!1,"Can't turn on custom loggers persistently."),i===!0?(Mr.logLevel=Sn.VERBOSE,Os=Mr.log.bind(Mr),e&&bf.set("logging_enabled",!0)):typeof i=="function"?Os=i:(Os=null,bf.remove("logging_enabled"))},Et=function(...i){if(hw===!0&&(hw=!1,Os===null&&bf.get("logging_enabled")===!0&&Gw(!0)),Os){let e=La.apply(null,i);Os(e)}},Va=function(i){return function(...e){Et(i,...e)}},Sf=function(...i){let e="FIREBASE INTERNAL ERROR: "+La(...i);Mr.error(e)},Yn=function(...i){let e=`FIREBASE FATAL ERROR: ${La(...i)}`;throw Mr.error(e),new Error(e)},Mt=function(...i){let e="FIREBASE WARNING: "+La(...i);Mr.warn(e)},HS=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Mt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},gu=function(i){return typeof i=="number"&&(i!==i||i===Number.POSITIVE_INFINITY||i===Number.NEGATIVE_INFINITY)},KS=function(i){if(Hn()||document.readyState==="complete")i();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,i())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Hi="[MIN_NAME]",wi="[MAX_NAME]",Fs=function(i,e){if(i===e)return 0;if(i===Hi||e===wi)return-1;if(e===Hi||i===wi)return 1;{let t=dw(i),n=dw(e);return t!==null?n!==null?t-n===0?i.length-e.length:t-n:-1:n!==null?1:i<e?-1:1}},QS=function(i,e){return i===e?0:i<e?-1:1},pa=function(i,e){if(e&&i in e)return e[i];throw new Error("Missing required key ("+i+") in object: "+ct(e))},xp=function(i){if(typeof i!="object"||i===null)return ct(i);let e=[];for(let n in i)e.push(n);e.sort();let t="{";for(let n=0;n<e.length;n++)n!==0&&(t+=","),t+=ct(e[n]),t+=":",t+=xp(i[e[n]]);return t+="}",t},Ww=function(i,e){let t=i.length;if(t<=e)return[i];let n=[];for(let s=0;s<t;s+=e)s+e>t?n.push(i.substring(s,t)):n.push(i.substring(s,s+e));return n};function Tt(i,e){for(let t in i)i.hasOwnProperty(t)&&e(t,i[t])}var Hw=function(i){B(!gu(i),"Invalid JSON number");let e=11,t=52,n=(1<<e-1)-1,s,r,o,a,c;i===0?(r=0,o=0,s=1/i===-1/0?1:0):(s=i<0,i=Math.abs(i),i>=Math.pow(2,1-n)?(a=Math.min(Math.floor(Math.log(i)/Math.LN2),n),r=a+n,o=Math.round(i*Math.pow(2,t-a)-Math.pow(2,t))):(r=0,o=Math.round(i/Math.pow(2,1-n-t))));let u=[];for(c=t;c;c-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)u.push(r%2?1:0),r=Math.floor(r/2);u.push(s?1:0),u.reverse();let d=u.join(""),f="";for(c=0;c<64;c+=8){let m=parseInt(d.substr(c,8),2).toString(16);m.length===1&&(m="0"+m),f=f+m}return f.toLowerCase()},$S=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},YS=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function XS(i,e){let t="Unknown Error";i==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":i==="permission_denied"?t="Client doesn't have permission to access the desired data.":i==="unavailable"&&(t="The service is unavailable");let n=new Error(i+" at "+e._path.toString()+": "+t);return n.code=i.toUpperCase(),n}var JS=new RegExp("^-?(0*)\\d{1,10}$"),ZS=-2147483648,eA=2147483647,dw=function(i){if(JS.test(i)){let e=Number(i);if(e>=ZS&&e<=eA)return e}return null},Gr=function(i){try{i()}catch(e){setTimeout(()=>{let t=e.stack||"";throw Mt("Exception was thrown by user callback.",t),e},Math.floor(0))}},tA=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},ya=function(i,e){let t=setTimeout(i,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var Af=class{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(n=>this.appCheck=n)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(n=>n.addTokenListener(e))}notifyForInvalidToken(){Mt(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var Rf=class{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Et("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Mt(e)}},va=(()=>{class i{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}i.OWNER="owner";return i})(),Gc="5",Kw="v",Qw="s",$w="r",Yw="f",Xw=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Jw="ls",Zw="p",xf="ac",eE="websocket",tE="long_polling";var Wc=class{constructor(e,t,n,s,r=!1,o="",a=!1,c=!1){this.secure=t,this.namespace=n,this.webSocketOnly=s,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ks.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ks.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function nA(i){return i.host!==i.internalHost||i.isCustomHost()||i.includeNamespaceInQueryParams}function nE(i,e,t){B(typeof e=="string","typeof type must == string"),B(typeof t=="object","typeof params must == object");let n;if(e===eE)n=(i.secure?"wss://":"ws://")+i.internalHost+"/.ws?";else if(e===tE)n=(i.secure?"https://":"http://")+i.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);nA(i)&&(t.ns=i.namespace);let s=[];return Tt(t,(r,o)=>{s.push(r+"="+o)}),n+s.join("&")}var Pf=class{constructor(){this.counters_={}}incrementCounter(e,t=1){bn(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return jv(this.counters_)}};var gf={},_f={};function Pp(i){let e=i.toString();return gf[e]||(gf[e]=new Pf),gf[e]}function iA(i,e){let t=i.toString();return _f[t]||(_f[t]=e()),_f[t]}var Df=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let n=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<n.length;++s)n[s]&&Gr(()=>{this.onMessage_(n[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var fw="start",sA="close",rA="pLPCommand",oA="pRTLPCB",iE="id",sE="pw",rE="ser",aA="cb",lA="seg",cA="ts",uA="d",hA="dframe",oE=1870,aE=30,dA=oE-aE,fA=25e3,pA=3e4,Ia=class i{constructor(e,t,n,s,r,o,a){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=s,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Va(e),this.stats_=Pp(t),this.urlFn=c=>(this.appCheckToken&&(c[xf]=this.appCheckToken),nE(t,tE,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Df(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(pA)),KS(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Nf((...r)=>{let[o,a,c,u,d]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===fw)this.id=a,this.password=c;else if(o===sA)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{let[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let n={};n[fw]="t",n[rE]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(n[aA]=this.scriptTagHolder.uniqueCallbackIdentifier),n[Kw]=Gc,this.transportSessionId&&(n[Qw]=this.transportSessionId),this.lastSessionId&&(n[Jw]=this.lastSessionId),this.applicationId&&(n[Zw]=this.applicationId),this.appCheckToken&&(n[xf]=this.appCheckToken),typeof location<"u"&&location.hostname&&Xw.test(location.hostname)&&(n[$w]=Yw);let s=this.urlFn(n);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){i.forceAllow_=!0}static forceDisallow(){i.forceDisallow_=!0}static isAvailable(){return Hn()?!1:i.forceAllow_?!0:!i.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!$S()&&!YS()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=ct(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=zv(t),s=Ww(n,dA);for(let r=0;r<s.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(Hn())return;this.myDisconnFrame=document.createElement("iframe");let n={};n[hA]="t",n[iE]=e,n[sE]=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=ct(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},Nf=class i{constructor(e,t,n,s){if(this.onDisconnect=n,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,Hn())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=zw(),window[rA+this.uniqueCallbackIdentifier]=e,window[oA+this.uniqueCallbackIdentifier]=t,this.myIFrame=i.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Et("frame writing exception"),a.stack&&Et(a.stack),Et(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Et("No IE domain setting required")}catch{let n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[iE]=this.myID,e[sE]=this.myPW,e[rE]=this.currentSerial;let t=this.urlFn(e),n="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+aE+n.length<=oE;){let o=this.pendingSegs.shift();n=n+"&"+lA+s+"="+o.seg+"&"+cA+s+"="+o.ts+"&"+uA+s+"="+o.d,s++}return t=t+n,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(n,Math.floor(fA)),r=()=>{clearTimeout(s),n()};this.addTag(e,r)}addTag(e,t){Hn()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){let s=n.readyState;(!s||s==="loaded"||s==="complete")&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{Et("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch{}},Math.floor(1))}};var mA=16384,gA=45e3,Hc=null;typeof MozWebSocket<"u"?Hc=MozWebSocket:typeof WebSocket<"u"&&(Hc=WebSocket);var kr=(()=>{class i{constructor(t,n,s,r,o,a,c){this.connId=t,this.applicationId=s,this.appCheckToken=r,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Va(this.connId),this.stats_=Pp(n),this.connURL=i.connectionURL_(n,a,c,r,s),this.nodeAdmin=n.nodeAdmin}static connectionURL_(t,n,s,r,o){let a={};return a[Kw]=Gc,!Hn()&&typeof location<"u"&&location.hostname&&Xw.test(location.hostname)&&(a[$w]=Yw),n&&(a[Qw]=n),s&&(a[Jw]=s),r&&(a[xf]=r),o&&(a[Zw]=o),nE(t,eE,a)}open(t,n){this.onDisconnect=n,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ks.set("previous_websocket_failure",!0);try{let s;if(Hn()){let r=this.nodeAdmin?"AdminNode":"Node";s={headers:{"User-Agent":`Firebase/${Gc}/${Ap}/${process.platform}/${r}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(s.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(s.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(s.proxy={origin:a})}this.mySock=new Hc(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");let r=s.message||s.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");let r=s.message||s.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){i.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let n=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(n);s&&s.length>1&&parseFloat(s[1])<4.4&&(t=!0)}return!t&&Hc!==null&&!i.forceDisallow_}static previouslyFailed(){return ks.isInMemoryStorage||ks.get("previous_websocket_failure")===!0}markConnectionHealthy(){ks.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let n=this.frames.join("");this.frames=null;let s=Tc(n);this.onMessage(s)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(B(this.frames===null,"We already have a frame buffer"),t.length<=6){let n=Number(t);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let n=t.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{let s=this.extractFrameCount_(n);s!==null&&this.appendFrame_(s)}}send(t){this.resetKeepAlive();let n=ct(t);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);let s=Ww(n,mA);s.length>1&&this.sendString_(String(s.length));for(let r=0;r<s.length;r++)this.sendString_(s[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(gA))}sendString_(t){try{this.mySock.send(t)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}i.responsesRequiredToBeHealthy=2,i.healthyTimeout=3e4;return i})(),lE=(()=>{class i{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[Ia,kr]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){let n=kr&&kr.isAvailable(),s=n&&!kr.previouslyFailed();if(t.webSocketOnly&&(n||Mt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[kr];else{let r=this.transports_=[];for(let o of i.ALL_TRANSPORTS)o&&o.isAvailable()&&r.push(o);i.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}i.globalTransportInitialized_=!1;return i})(),_A=6e4,yA=5e3,vA=10*1024,wA=100*1024,yf="t",pw="d",EA="s",mw="r",TA="e",gw="o",_w="a",yw="n",vw="p",IA="h",kf=class{constructor(e,t,n,s,r,o,a,c,u,d){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=s,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=u,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Va("c:"+this.id+":"),this.transportManager_=new lE(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));let s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=ya(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>wA?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>vA?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(yf in e){let t=e[yf];t===_w?this.upgradeIfSecondaryHealthy_():t===mw?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===gw&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=pa("t",e),n=pa("d",e);if(t==="c")this.onSecondaryControl_(n);else if(t==="d")this.pendingDataMessages.push(n);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:vw,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:_w,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:yw,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=pa("t",e),n=pa("d",e);t==="c"?this.onControl_(n):t==="d"&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=pa(yf,e);if(pw in e){let n=e[pw];if(t===IA){let s=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(t===yw){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===EA?this.onConnectionShutdown_(n):t===mw?this.onReset_(n):t===TA?Sf("Server Error: "+n):t===gw?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Sf("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,n=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Gc!==n&&Mt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),ya(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(_A))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):ya(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(yA))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:vw,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ks.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var Kc=class{put(e,t,n,s){}merge(e,t,n,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}};var Qc=class{constructor(e){this.allowedEvents_=e,this.listeners_={},B(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let n=[...this.listeners_[e]];for(let s=0;s<n.length;s++)n[s].callback.apply(n[s].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});let s=this.getInitialEvent(e);s&&t.apply(n,s)}off(e,t,n){this.validateEventType_(e);let s=this.listeners_[e]||[];for(let r=0;r<s.length;r++)if(s[r].callback===t&&(!n||n===s[r].context)){s.splice(r,1);return}}validateEventType_(e){B(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var $c=class i extends Qc{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!cf()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new i}getInitialEvent(e){return B(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var ww=32,Ew=768,Pe=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let n=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[n]=this.pieces_[s],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function xe(){return new Pe("")}function pe(i){return i.pieceNum_>=i.pieces_.length?null:i.pieces_[i.pieceNum_]}function Ki(i){return i.pieces_.length-i.pieceNum_}function Oe(i){let e=i.pieceNum_;return e<i.pieces_.length&&e++,new Pe(i.pieces_,e)}function Dp(i){return i.pieceNum_<i.pieces_.length?i.pieces_[i.pieces_.length-1]:null}function CA(i){let e="";for(let t=i.pieceNum_;t<i.pieces_.length;t++)i.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(i.pieces_[t])));return e||"/"}function Ca(i,e=0){return i.pieces_.slice(i.pieceNum_+e)}function cE(i){if(i.pieceNum_>=i.pieces_.length)return null;let e=[];for(let t=i.pieceNum_;t<i.pieces_.length-1;t++)e.push(i.pieces_[t]);return new Pe(e,0)}function We(i,e){let t=[];for(let n=i.pieceNum_;n<i.pieces_.length;n++)t.push(i.pieces_[n]);if(e instanceof Pe)for(let n=e.pieceNum_;n<e.pieces_.length;n++)t.push(e.pieces_[n]);else{let n=e.split("/");for(let s=0;s<n.length;s++)n[s].length>0&&t.push(n[s])}return new Pe(t,0)}function me(i){return i.pieceNum_>=i.pieces_.length}function Gt(i,e){let t=pe(i),n=pe(e);if(t===null)return e;if(t===n)return Gt(Oe(i),Oe(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+i+")")}function bA(i,e){let t=Ca(i,0),n=Ca(e,0);for(let s=0;s<t.length&&s<n.length;s++){let r=Fs(t[s],n[s]);if(r!==0)return r}return t.length===n.length?0:t.length<n.length?-1:1}function Np(i,e){if(Ki(i)!==Ki(e))return!1;for(let t=i.pieceNum_,n=e.pieceNum_;t<=i.pieces_.length;t++,n++)if(i.pieces_[t]!==e.pieces_[n])return!1;return!0}function An(i,e){let t=i.pieceNum_,n=e.pieceNum_;if(Ki(i)>Ki(e))return!1;for(;t<i.pieces_.length;){if(i.pieces_[t]!==e.pieces_[n])return!1;++t,++n}return!0}var Of=class{constructor(e,t){this.errorPrefix_=t,this.parts_=Ca(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=fa(this.parts_[n]);uE(this)}};function SA(i,e){i.parts_.length>0&&(i.byteLength_+=1),i.parts_.push(e),i.byteLength_+=fa(e),uE(i)}function AA(i){let e=i.parts_.pop();i.byteLength_-=fa(e),i.parts_.length>0&&(i.byteLength_-=1)}function uE(i){if(i.byteLength_>Ew)throw new Error(i.errorPrefix_+"has a key path longer than "+Ew+" bytes ("+i.byteLength_+").");if(i.parts_.length>ww)throw new Error(i.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+ww+") or object contains a cycle "+Ns(i))}function Ns(i){return i.parts_.length===0?"":"in property '"+i.parts_.join(".")+"'"}var Mf=class i extends Qc{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let n=!document[e];n!==this.visible_&&(this.visible_=n,this.trigger("visible",n))},!1)}static getInstance(){return new i}getInitialEvent(e){return B(e==="visible","Unknown event type: "+e),[this.visible_]}};var ma=1e3,RA=60*5*1e3,Tw=30*1e3,xA=1.3,PA=3e4,DA="server_kill",Iw=3,kp=(()=>{class i extends Kc{constructor(t,n,s,r,o,a,c,u){if(super(),this.repoInfo_=t,this.applicationId_=n,this.onDataUpdate_=s,this.onConnectStatus_=r,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=c,this.authOverride_=u,this.id=i.nextPersistentConnectionId_++,this.log_=Va("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=ma,this.maxReconnectDelay_=RA,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,u&&!Hn())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Mf.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&$c.getInstance().on("online",this.onOnline_,this)}sendRequest(t,n,s){let r=++this.requestNumber_,o={r,a:t,b:n};this.log_(ct(o)),B(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),s&&(this.requestCBHash_[r]=s)}get(t){this.initConnection_();let n=new jt,r={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let c=a.d;a.s==="ok"?n.resolve(c):n.reject(c)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),n.promise}listen(t,n,s,r){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),B(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),B(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let c={onComplete:r,hashFn:n,query:t,tag:s};this.listens.get(a).set(o,c),this.connected_&&this.sendListen_(c)}sendGet_(t){let n=this.outstandingGets_[t];this.sendRequest("g",n.request,s=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(s)})}sendListen_(t){let n=t.query,s=n._path.toString(),r=n._queryIdentifier;this.log_("Listen on "+s+" for "+r);let o={p:s},a="q";t.tag&&(o.q=n._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,c=>{let u=c.d,d=c.s;i.warnOnListenWarnings_(u,n),(this.listens.get(s)&&this.listens.get(s).get(r))===t&&(this.log_("listen response",c),d!=="ok"&&this.removeListen_(s,r),t.onComplete&&t.onComplete(d,u))})}static warnOnListenWarnings_(t,n){if(t&&typeof t=="object"&&bn(t,"w")){let s=qi(t,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){let r='".indexOn": "'+n._queryParams.getIndex().toString()+'"',o=n._path.toString();Mt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||Qv(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Tw)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,n=Kv(t)?"auth":"gauth",s={cred:t};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(n,s,r=>{let o=r.s,a=r.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let n=t.s,s=t.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,s)})}unlisten(t,n){let s=t._path.toString(),r=t._queryIdentifier;this.log_("Unlisten called for "+s+" "+r),B(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,r)&&this.connected_&&this.sendUnlisten_(s,r,t._queryObject,n)}sendUnlisten_(t,n,s,r){this.log_("Unlisten on "+t+" for "+n);let o={p:t},a="n";r&&(o.q=s,o.t=r),this.sendRequest(a,o)}onDisconnectPut(t,n,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,n,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:n,onComplete:s})}onDisconnectMerge(t,n,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,n,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:n,onComplete:s})}onDisconnectCancel(t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(t,n,s,r){let o={p:n,d:s};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{r&&setTimeout(()=>{r(a.s,a.d)},Math.floor(0))})}put(t,n,s,r){this.putInternal("p",t,n,s,r)}merge(t,n,s,r){this.putInternal("m",t,n,s,r)}putInternal(t,n,s,r,o){this.initConnection_();let a={p:n,d:s};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:r}),this.outstandingPutCount_++;let c=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(c):this.log_("Buffering put: "+n)}sendPut_(t){let n=this.outstandingPuts_[t].action,s=this.outstandingPuts_[t].request,r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,s,o=>{this.log_(n+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(o.s,o.d)})}reportStats(t){if(this.connected_){let n={c:t};this.log_("reportStats",n),this.sendRequest("s",n,s=>{if(s.s!=="ok"){let o=s.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+ct(t));let n=t.r,s=this.requestCBHash_[n];s&&(delete this.requestCBHash_[n],s(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,n){this.log_("handleServerMessage",t,n),t==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):t==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):t==="c"?this.onListenRevoked_(n.p,n.q):t==="ac"?this.onAuthRevoked_(n.s,n.d):t==="apc"?this.onAppCheckRevoked_(n.s,n.d):t==="sd"?this.onSecurityDebugPacket_(n):Sf("Unrecognized action received from server: "+ct(t)+`
Are you using the latest client?`)}onReady_(t,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){B(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=ma,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=ma,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>PA&&(this.reconnectDelay_=ma),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=new Date().getTime()-this.lastConnectionAttemptTime_,n=Math.max(0,this.reconnectDelay_-t);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*xA)}this.onConnectStatus_(!1)}establishConnection_(){return N(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+i.nextConnectionId_++,o=this.lastSessionId,a=!1,c=null,u=function(){c?c.close():(a=!0,s())},d=function(m){B(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(m)};this.realtime_={close:u,sendRequest:d};let f=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[m,_]=yield Promise.all([this.authTokenProvider_.getToken(f),this.appCheckTokenProvider_.getToken(f)]);a?Et("getToken() completed but was canceled"):(Et("getToken() completed. Creating connection."),this.authToken_=m&&m.accessToken,this.appCheckToken_=_&&_.token,c=new kf(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,n,s,v=>{Mt(v+" ("+this.repoInfo_.toString()+")"),this.interrupt(DA)},o))}catch(m){this.log_("Failed to get token: "+m),a||(this.repoInfo_.nodeAdmin&&Mt(m),u())}}})}interrupt(t){Et("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){Et("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Ic(this.interruptReasons_)&&(this.reconnectDelay_=ma,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let n=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let n=this.outstandingPuts_[t];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,n){let s;n?s=n.map(o=>xp(o)).join("$"):s="default";let r=this.removeListen_(t,s);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(t,n){let s=new Pe(t).toString(),r;if(this.listens.has(s)){let o=this.listens.get(s);r=o.get(n),o.delete(n),o.size===0&&this.listens.delete(s)}else r=void 0;return r}onAuthRevoked_(t,n){Et("Auth token revoked: "+t+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Iw&&(this.reconnectDelay_=Tw,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,n){Et("App check token revoked: "+t+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Iw&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let n of t.values())this.sendListen_(n);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},n="js";Hn()&&(this.repoInfo_.nodeAdmin?n="admin_node":n="node"),t["sdk."+n+"."+Ap.replace(/\./g,"-")]=1,cf()?t["framework.cordova"]=1:Gv()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=$c.getInstance().currentlyOnline();return Ic(this.interruptReasons_)&&t}}i.nextPersistentConnectionId_=0,i.nextConnectionId_=0;return i})(),ge=class i{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new i(e,t)}};var Fr=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let n=new ge(Hi,e),s=new ge(Hi,t);return this.compare(n,s)!==0}minPost(){return ge.MIN}};var jc,Yc=class extends Fr{static get __EMPTY_NODE(){return jc}static set __EMPTY_NODE(e){jc=e}compare(e,t){return Fs(e.name,t.name)}isDefinedOn(e){throw xr("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return ge.MIN}maxPost(){return new ge(wi,jc)}makePost(e,t){return B(typeof e=="string","KeyIndex indexValue must always be a string."),new ge(e,jc)}toString(){return".key"}},$n=new Yc;var Or=class{constructor(e,t,n,s,r=null){this.isReverse_=s,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?n(e.key,t):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Ln=(()=>{class i{constructor(t,n,s,r,o){this.key=t,this.value=n,this.color=s??i.RED,this.left=r??Rn.EMPTY_NODE,this.right=o??Rn.EMPTY_NODE}copy(t,n,s,r,o){return new i(t??this.key,n??this.value,s??this.color,r??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,n,s){let r=this,o=s(t,r.key);return o<0?r=r.copy(null,null,null,r.left.insert(t,n,s),null):o===0?r=r.copy(null,n,null,null,null):r=r.copy(null,null,null,null,r.right.insert(t,n,s)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return Rn.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,n){let s,r;if(s=this,n(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(t,n),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),n(t,s.key)===0){if(s.right.isEmpty())return Rn.EMPTY_NODE;r=s.right.min_(),s=s.copy(r.key,r.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(t,n))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,i.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,i.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,n)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return i.RED=!0,i.BLACK=!1,i})(),Ff=class{copy(e,t,n,s,r){return this}insert(e,t,n){return new Ln(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},Rn=class i{constructor(e,t=i.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new i(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Ln.BLACK,null,null))}remove(e){return new i(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Ln.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),t===0)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,s=null;for(;!n.isEmpty();)if(t=this.comparator_(e,n.key),t===0){if(n.left.isEmpty())return s?s.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}else t<0?n=n.left:t>0&&(s=n,n=n.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Or(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Or(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Or(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Or(this.root_,null,this.comparator_,!0,e)}};Rn.EMPTY_NODE=new Ff;function NA(i,e){return Fs(i.name,e.name)}function Op(i,e){return Fs(i,e)}var Lf;function kA(i){Lf=i}var hE=function(i){return typeof i=="number"?"number:"+Hw(i):"string:"+i},dE=function(i){if(i.isLeafNode()){let e=i.val();B(typeof e=="string"||typeof e=="number"||typeof e=="object"&&bn(e,".sv"),"Priority must be a string or number.")}else B(i===Lf||i.isEmpty(),"priority of unexpected type.");B(i===Lf||i.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var Cw,Lr=(()=>{class i{constructor(t,n=i.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=n,this.lazyHash_=null,B(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),dE(this.priorityNode_)}static set __childrenNodeConstructor(t){Cw=t}static get __childrenNodeConstructor(){return Cw}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new i(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:i.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return me(t)?this:pe(t)===".priority"?this.priorityNode_:i.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,n){return null}updateImmediateChild(t,n){return t===".priority"?this.updatePriority(n):n.isEmpty()&&t!==".priority"?this:i.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)}updateChild(t,n){let s=pe(t);return s===null?n:n.isEmpty()&&s!==".priority"?this:(B(s!==".priority"||Ki(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,i.__childrenNodeConstructor.EMPTY_NODE.updateChild(Oe(t),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,n){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+hE(this.priorityNode_.val())+":");let n=typeof this.value_;t+=n+":",n==="number"?t+=Hw(this.value_):t+=this.value_,this.lazyHash_=jw(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===i.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof i.__childrenNodeConstructor?-1:(B(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let n=typeof t.value_,s=typeof this.value_,r=i.VALUE_TYPE_ORDER.indexOf(n),o=i.VALUE_TYPE_ORDER.indexOf(s);return B(r>=0,"Unknown leaf type: "+n),B(o>=0,"Unknown leaf type: "+s),r===o?s==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-r}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let n=t;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}i.VALUE_TYPE_ORDER=["object","boolean","number","string"];return i})(),fE,pE;function OA(i){fE=i}function MA(i){pE=i}var Vf=class extends Fr{compare(e,t){let n=e.node.getPriority(),s=t.node.getPriority(),r=n.compareTo(s);return r===0?Fs(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return ge.MIN}maxPost(){return new ge(wi,new Lr("[PRIORITY-POST]",pE))}makePost(e,t){let n=fE(e);return new ge(t,new Lr("[PRIORITY-POST]",n))}toString(){return".priority"}},Fe=new Vf;var FA=Math.log(2),Bf=class{constructor(e){let t=r=>parseInt(Math.log(r)/FA,10),n=r=>parseInt(Array(r+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let s=n(this.count);this.bits_=e+1&s}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},Xc=function(i,e,t,n){i.sort(e);let s=function(c,u){let d=u-c,f,m;if(d===0)return null;if(d===1)return f=i[c],m=t?t(f):f,new Ln(m,f.node,Ln.BLACK,null,null);{let _=parseInt(d/2,10)+c,v=s(c,_),C=s(_+1,u);return f=i[_],m=t?t(f):f,new Ln(m,f.node,Ln.BLACK,v,C)}},r=function(c){let u=null,d=null,f=i.length,m=function(v,C){let R=f-v,U=f;f-=v;let q=s(R+1,U),z=i[R],Y=t?t(z):z;_(new Ln(Y,z.node,C,null,q))},_=function(v){u?(u.left=v,u=v):(d=v,u=v)};for(let v=0;v<c.count;++v){let C=c.nextBitIsOne(),R=Math.pow(2,c.count-(v+1));C?m(R,Ln.BLACK):(m(R,Ln.BLACK),m(R,Ln.RED))}return d},o=new Bf(i.length),a=r(o);return new Rn(n||e,a)};var vf,Nr={},Vr=class i{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return B(Nr&&Fe,"ChildrenNode.ts has not been loaded"),vf=vf||new i({".priority":Nr},{".priority":Fe}),vf}get(e){let t=qi(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Rn?t:null}hasIndex(e){return bn(this.indexSet_,e.toString())}addIndex(e,t){B(e!==$n,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let n=[],s=!1,r=t.getIterator(ge.Wrap),o=r.getNext();for(;o;)s=s||e.isDefinedOn(o.node),n.push(o),o=r.getNext();let a;s?a=Xc(n,e.getCompare()):a=Nr;let c=e.toString(),u=Object.assign({},this.indexSet_);u[c]=e;let d=Object.assign({},this.indexes_);return d[c]=a,new i(d,u)}addToIndexes(e,t){let n=da(this.indexes_,(s,r)=>{let o=qi(this.indexSet_,r);if(B(o,"Missing index implementation for "+r),s===Nr)if(o.isDefinedOn(e.node)){let a=[],c=t.getIterator(ge.Wrap),u=c.getNext();for(;u;)u.name!==e.name&&a.push(u),u=c.getNext();return a.push(e),Xc(a,o.getCompare())}else return Nr;else{let a=t.get(e.name),c=s;return a&&(c=c.remove(new ge(e.name,a))),c.insert(e,e.node)}});return new i(n,this.indexSet_)}removeFromIndexes(e,t){let n=da(this.indexes_,s=>{if(s===Nr)return s;{let r=t.get(e.name);return r?s.remove(new ge(e.name,r)):s}});return new i(n,this.indexSet_)}};var ga,ue=(()=>{class i{constructor(t,n,s){this.children_=t,this.priorityNode_=n,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&dE(this.priorityNode_),this.children_.isEmpty()&&B(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return ga||(ga=new i(new Rn(Op),null,Vr.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||ga}updatePriority(t){return this.children_.isEmpty()?this:new i(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let n=this.children_.get(t);return n===null?ga:n}}getChild(t){let n=pe(t);return n===null?this:this.getImmediateChild(n).getChild(Oe(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,n){if(B(n,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(n);{let s=new ge(t,n),r,o;n.isEmpty()?(r=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(s,this.children_)):(r=this.children_.insert(t,n),o=this.indexMap_.addToIndexes(s,this.children_));let a=r.isEmpty()?ga:this.priorityNode_;return new i(r,a,o)}}updateChild(t,n){let s=pe(t);if(s===null)return n;{B(pe(t)!==".priority"||Ki(t)===1,".priority must be the last token in a path");let r=this.getImmediateChild(s).updateChild(Oe(t),n);return this.updateImmediateChild(s,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let n={},s=0,r=0,o=!0;if(this.forEachChild(Fe,(a,c)=>{n[a]=c.val(t),s++,o&&i.INTEGER_REGEXP_.test(a)?r=Math.max(r,Number(a)):o=!1}),!t&&o&&r<2*s){let a=[];for(let c in n)a[c]=n[c];return a}else return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+hE(this.getPriority().val())+":"),this.forEachChild(Fe,(n,s)=>{let r=s.hash();r!==""&&(t+=":"+n+":"+r)}),this.lazyHash_=t===""?"":jw(t)}return this.lazyHash_}getPredecessorChildName(t,n,s){let r=this.resolveIndex_(s);if(r){let o=r.getPredecessorKey(new ge(t,n));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let n=this.resolveIndex_(t);if(n){let s=n.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(t){let n=this.getFirstChildName(t);return n?new ge(n,this.children_.get(n)):null}getLastChildName(t){let n=this.resolveIndex_(t);if(n){let s=n.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(t){let n=this.getLastChildName(t);return n?new ge(n,this.children_.get(n)):null}forEachChild(t,n){let s=this.resolveIndex_(t);return s?s.inorderTraversal(r=>n(r.name,r.node)):this.children_.inorderTraversal(n)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,n){let s=this.resolveIndex_(n);if(s)return s.getIteratorFrom(t,r=>r);{let r=this.children_.getIteratorFrom(t.name,ge.Wrap),o=r.peek();for(;o!=null&&n.compare(o,t)<0;)r.getNext(),o=r.peek();return r}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,n){let s=this.resolveIndex_(n);if(s)return s.getReverseIteratorFrom(t,r=>r);{let r=this.children_.getReverseIteratorFrom(t.name,ge.Wrap),o=r.peek();for(;o!=null&&n.compare(o,t)>0;)r.getNext(),o=r.peek();return r}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Ba?-1:0}withIndex(t){if(t===$n||this.indexMap_.hasIndex(t))return this;{let n=this.indexMap_.addIndex(t,this.children_);return new i(this.children_,this.priorityNode_,n)}}isIndexed(t){return t===$n||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let n=t;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){let s=this.getIterator(Fe),r=n.getIterator(Fe),o=s.getNext(),a=r.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=s.getNext(),a=r.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===$n?null:this.indexMap_.get(t.toString())}}return i.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,i})(),Uf=class extends ue{constructor(){super(new Rn(Op),ue.EMPTY_NODE,Vr.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return ue.EMPTY_NODE}isEmpty(){return!1}},Ba=new Uf;Object.defineProperties(ge,{MIN:{value:new ge(Hi,ue.EMPTY_NODE)},MAX:{value:new ge(wi,Ba)}});Yc.__EMPTY_NODE=ue.EMPTY_NODE;Lr.__childrenNodeConstructor=ue;kA(Ba);MA(Ba);var LA=!0;function Qe(i,e=null){if(i===null)return ue.EMPTY_NODE;if(typeof i=="object"&&".priority"in i&&(e=i[".priority"]),B(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof i=="object"&&".value"in i&&i[".value"]!==null&&(i=i[".value"]),typeof i!="object"||".sv"in i){let t=i;return new Lr(t,Qe(e))}if(!(i instanceof Array)&&LA){let t=[],n=!1;if(Tt(i,(o,a)=>{if(o.substring(0,1)!=="."){let c=Qe(a);c.isEmpty()||(n=n||!c.getPriority().isEmpty(),t.push(new ge(o,c)))}}),t.length===0)return ue.EMPTY_NODE;let r=Xc(t,NA,o=>o.name,Op);if(n){let o=Xc(t,Fe.getCompare());return new ue(r,Qe(e),new Vr({".priority":o},{".priority":Fe}))}else return new ue(r,Qe(e),Vr.Default)}else{let t=ue.EMPTY_NODE;return Tt(i,(n,s)=>{if(bn(i,n)&&n.substring(0,1)!=="."){let r=Qe(s);(r.isLeafNode()||!r.isEmpty())&&(t=t.updateImmediateChild(n,r))}}),t.updatePriority(Qe(e))}}OA(Qe);var ba=class extends Fr{constructor(e){super(),this.indexPath_=e,B(!me(e)&&pe(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let n=this.extractChild(e.node),s=this.extractChild(t.node),r=n.compareTo(s);return r===0?Fs(e.name,t.name):r}makePost(e,t){let n=Qe(e),s=ue.EMPTY_NODE.updateChild(this.indexPath_,n);return new ge(t,s)}maxPost(){let e=ue.EMPTY_NODE.updateChild(this.indexPath_,Ba);return new ge(wi,e)}toString(){return Ca(this.indexPath_,0).join("/")}};var qf=class extends Fr{compare(e,t){let n=e.node.compareTo(t.node);return n===0?Fs(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return ge.MIN}maxPost(){return ge.MAX}makePost(e,t){let n=Qe(e);return new ge(t,n)}toString(){return".value"}},Mp=new qf;function mE(i){return{type:"value",snapshotNode:i}}function Br(i,e){return{type:"child_added",snapshotNode:e,childName:i}}function Sa(i,e){return{type:"child_removed",snapshotNode:e,childName:i}}function Aa(i,e,t){return{type:"child_changed",snapshotNode:e,childName:i,oldSnap:t}}function VA(i,e){return{type:"child_moved",snapshotNode:e,childName:i}}var Ra=class{constructor(e){this.index_=e}updateChild(e,t,n,s,r,o){B(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(s).equals(n.getChild(s))&&a.isEmpty()===n.isEmpty()||(o!=null&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(Sa(t,a)):B(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Br(t,n)):o.trackChildChange(Aa(t,n,a))),e.isLeafNode()&&n.isEmpty())?e:e.updateImmediateChild(t,n).withIndex(this.index_)}updateFullNode(e,t,n){return n!=null&&(e.isLeafNode()||e.forEachChild(Fe,(s,r)=>{t.hasChild(s)||n.trackChildChange(Sa(s,r))}),t.isLeafNode()||t.forEachChild(Fe,(s,r)=>{if(e.hasChild(s)){let o=e.getImmediateChild(s);o.equals(r)||n.trackChildChange(Aa(s,r,o))}else n.trackChildChange(Br(s,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?ue.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var Jc=class i{constructor(e){this.indexedFilter_=new Ra(e.getIndex()),this.index_=e.getIndex(),this.startPost_=i.getStartPost_(e),this.endPost_=i.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,s,r,o){return this.matches(new ge(t,n))||(n=ue.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,s,r,o)}updateFullNode(e,t,n){t.isLeafNode()&&(t=ue.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(ue.EMPTY_NODE);let r=this;return t.forEachChild(Fe,(o,a)=>{r.matches(new ge(o,a))||(s=s.updateImmediateChild(o,ue.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var zf=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let n=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?n<=0:n<0},this.withinEndPost=t=>{let n=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?n<=0:n<0},this.rangedFilter_=new Jc(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,s,r,o){return this.rangedFilter_.matches(new ge(t,n))||(n=ue.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,s,r,o):this.fullLimitUpdateChild_(e,t,n,r,o)}updateFullNode(e,t,n){let s;if(t.isLeafNode()||t.isEmpty())s=ue.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){s=ue.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){let a=r.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=t.withIndex(this.index_),s=s.updatePriority(ue.EMPTY_NODE);let r;this.reverse_?r=s.getReverseIterator(this.index_):r=s.getIterator(this.index_);let o=0;for(;r.hasNext();){let a=r.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,ue.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,s,r){let o;if(this.reverse_){let f=this.index_.getCompare();o=(m,_)=>f(_,m)}else o=this.index_.getCompare();let a=e;B(a.numChildren()===this.limit_,"");let c=new ge(t,n),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),d=this.rangedFilter_.matches(c);if(a.hasChild(t)){let f=a.getImmediateChild(t),m=s.getChildAfterChild(this.index_,u,this.reverse_);for(;m!=null&&(m.name===t||a.hasChild(m.name));)m=s.getChildAfterChild(this.index_,m,this.reverse_);let _=m==null?1:o(m,c);if(d&&!n.isEmpty()&&_>=0)return r?.trackChildChange(Aa(t,n,f)),a.updateImmediateChild(t,n);{r?.trackChildChange(Sa(t,f));let C=a.updateImmediateChild(t,ue.EMPTY_NODE);return m!=null&&this.rangedFilter_.matches(m)?(r?.trackChildChange(Br(m.name,m.node)),C.updateImmediateChild(m.name,m.node)):C}}else return n.isEmpty()?e:d&&o(u,c)>=0?(r!=null&&(r.trackChildChange(Sa(u.name,u.node)),r.trackChildChange(Br(t,n))),a.updateImmediateChild(t,n).updateImmediateChild(u.name,ue.EMPTY_NODE)):e}};var xa=class i{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Fe}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return B(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return B(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Hi}hasEnd(){return this.endSet_}getIndexEndValue(){return B(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return B(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:wi}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return B(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Fe}copy(){let e=new i;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function BA(i){return i.loadsAllData()?new Ra(i.getIndex()):i.hasLimit()?new zf(i):new Jc(i)}function UA(i,e){let t=i.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function qA(i,e){let t=i.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function jf(i,e,t){let n=i.copy();return n.startSet_=!0,e===void 0&&(e=null),n.indexStartValue_=e,t!=null?(n.startNameSet_=!0,n.indexStartName_=t):(n.startNameSet_=!1,n.indexStartName_=""),n}function zA(i,e,t){let n;return i.index_===$n||t?n=jf(i,e,t):n=jf(i,e,wi),n.startAfterSet_=!0,n}function Gf(i,e,t){let n=i.copy();return n.endSet_=!0,e===void 0&&(e=null),n.indexEndValue_=e,t!==void 0?(n.endNameSet_=!0,n.indexEndName_=t):(n.endNameSet_=!1,n.indexEndName_=""),n}function jA(i,e,t){let n;return i.index_===$n||t?n=Gf(i,e,t):n=Gf(i,e,Hi),n.endBeforeSet_=!0,n}function _u(i,e){let t=i.copy();return t.index_=e,t}function bw(i){let e={};if(i.isDefault())return e;let t;if(i.index_===Fe?t="$priority":i.index_===Mp?t="$value":i.index_===$n?t="$key":(B(i.index_ instanceof ba,"Unrecognized index type!"),t=i.index_.toString()),e.orderBy=ct(t),i.startSet_){let n=i.startAfterSet_?"startAfter":"startAt";e[n]=ct(i.indexStartValue_),i.startNameSet_&&(e[n]+=","+ct(i.indexStartName_))}if(i.endSet_){let n=i.endBeforeSet_?"endBefore":"endAt";e[n]=ct(i.indexEndValue_),i.endNameSet_&&(e[n]+=","+ct(i.indexEndName_))}return i.limitSet_&&(i.isViewFromLeft()?e.limitToFirst=i.limit_:e.limitToLast=i.limit_),e}function Sw(i){let e={};if(i.startSet_&&(e.sp=i.indexStartValue_,i.startNameSet_&&(e.sn=i.indexStartName_),e.sin=!i.startAfterSet_),i.endSet_&&(e.ep=i.indexEndValue_,i.endNameSet_&&(e.en=i.indexEndName_),e.ein=!i.endBeforeSet_),i.limitSet_){e.l=i.limit_;let t=i.viewFrom_;t===""&&(i.isViewFromLeft()?t="l":t="r"),e.vf=t}return i.index_!==Fe&&(e.i=i.index_.toString()),e}var Wf=class i extends Kc{constructor(e,t,n,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=s,this.log_=Va("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(B(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,s){let r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);let o=i.getListenId_(e,n),a={};this.listens_[o]=a;let c=bw(e._queryParams);this.restRequest_(r+".json",c,(u,d)=>{let f=d;if(u===404&&(f=null,u=null),u===null&&this.onDataUpdate_(r,f,!1,n),qi(this.listens_,o)===a){let m;u?u===401?m="permission_denied":m="rest_error:"+u:m="ok",s(m,null)}})}unlisten(e,t){let n=i.getListenId_(e,t);delete this.listens_[n]}get(e){let t=bw(e._queryParams),n=e._path.toString(),s=new jt;return this.restRequest_(n+".json",t,(r,o)=>{let a=o;r===404&&(a=null,r=null),r===null?(this.onDataUpdate_(n,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,r])=>{s&&s.accessToken&&(t.auth=s.accessToken),r&&r.token&&(t.ac=r.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+$v(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(n&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=Tc(a.responseText)}catch{Mt("Failed to parse JSON response for "+o+": "+a.responseText)}n(null,c)}else a.status!==401&&a.status!==404&&Mt("Got unsuccessful REST response for "+o+" Status: "+a.status),n(a.status);n=null}},a.open("GET",o,!0),a.send()})}};var Hf=class{constructor(){this.rootNode_=ue.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function Zc(){return{value:null,children:new Map}}function Wr(i,e,t){if(me(e))i.value=t,i.children.clear();else if(i.value!==null)i.value=i.value.updateChild(e,t);else{let n=pe(e);i.children.has(n)||i.children.set(n,Zc());let s=i.children.get(n);e=Oe(e),Wr(s,e,t)}}function Kf(i,e){if(me(e))return i.value=null,i.children.clear(),!0;if(i.value!==null){if(i.value.isLeafNode())return!1;{let t=i.value;return i.value=null,t.forEachChild(Fe,(n,s)=>{Wr(i,new Pe(n),s)}),Kf(i,e)}}else if(i.children.size>0){let t=pe(e);return e=Oe(e),i.children.has(t)&&Kf(i.children.get(t),e)&&i.children.delete(t),i.children.size===0}else return!0}function Qf(i,e,t){i.value!==null?t(e,i.value):GA(i,(n,s)=>{let r=new Pe(e.toString()+"/"+n);Qf(s,r,t)})}function GA(i,e){i.children.forEach((t,n)=>{e(n,t)})}var $f=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&Tt(this.last_,(n,s)=>{t[n]=t[n]-s}),this.last_=e,t}};var Aw=10*1e3,WA=30*1e3,HA=5*60*1e3,Yf=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new $f(e);let n=Aw+(WA-Aw)*Math.random();ya(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){let e=this.statsListener_.get(),t={},n=!1;Tt(e,(s,r)=>{r>0&&bn(this.statsToReport_,s)&&(t[s]=r,n=!0)}),n&&this.server_.reportStats(t),ya(this.reportStats_.bind(this),Math.floor(Math.random()*2*HA))}};var Qn=function(i){return i[i.OVERWRITE=0]="OVERWRITE",i[i.MERGE=1]="MERGE",i[i.ACK_USER_WRITE=2]="ACK_USER_WRITE",i[i.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",i}(Qn||{});function Fp(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Lp(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Vp(i){return{fromUser:!1,fromServer:!0,queryId:i,tagged:!0}}var Xf=class i{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=Qn.ACK_USER_WRITE,this.source=Fp()}operationForChild(e){if(me(this.path)){if(this.affectedTree.value!=null)return B(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new Pe(e));return new i(xe(),t,this.revert)}}else return B(pe(this.path)===e,"operationForChild called for unrelated child."),new i(Oe(this.path),this.affectedTree,this.revert)}};var eu=class i{constructor(e,t){this.source=e,this.path=t,this.type=Qn.LISTEN_COMPLETE}operationForChild(e){return me(this.path)?new i(this.source,xe()):new i(this.source,Oe(this.path))}};var Ur=class i{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=Qn.OVERWRITE}operationForChild(e){return me(this.path)?new i(this.source,xe(),this.snap.getImmediateChild(e)):new i(this.source,Oe(this.path),this.snap)}};var Pa=class i{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=Qn.MERGE}operationForChild(e){if(me(this.path)){let t=this.children.subtree(new Pe(e));return t.isEmpty()?null:t.value?new Ur(this.source,xe(),t.value):new i(this.source,xe(),t)}else return B(pe(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new i(this.source,Oe(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var Xn=class{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(me(e))return this.isFullyInitialized()&&!this.filtered_;let t=pe(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var Jf=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function KA(i,e,t,n){let s=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&i.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(VA(o.childName,o.snapshotNode))}),_a(i,s,"child_removed",e,n,t),_a(i,s,"child_added",e,n,t),_a(i,s,"child_moved",r,n,t),_a(i,s,"child_changed",e,n,t),_a(i,s,"value",e,n,t),s}function _a(i,e,t,n,s,r){let o=n.filter(a=>a.type===t);o.sort((a,c)=>$A(i,a,c)),o.forEach(a=>{let c=QA(i,a,r);s.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(c,i.query_))})})}function QA(i,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,i.index_)),e}function $A(i,e,t){if(e.childName==null||t.childName==null)throw xr("Should only compare child_ events.");let n=new ge(e.childName,e.snapshotNode),s=new ge(t.childName,t.snapshotNode);return i.index_.compare(n,s)}function yu(i,e){return{eventCache:i,serverCache:e}}function wa(i,e,t,n){return yu(new Xn(e,t,n),i.serverCache)}function gE(i,e,t,n){return yu(i.eventCache,new Xn(e,t,n))}function tu(i){return i.eventCache.isFullyInitialized()?i.eventCache.getNode():null}function Ms(i){return i.serverCache.isFullyInitialized()?i.serverCache.getNode():null}var wf,YA=()=>(wf||(wf=new Rn(QS)),wf),Wt=class i{constructor(e,t=YA()){this.value=e,this.children=t}static fromObject(e){let t=new i(null);return Tt(e,(n,s)=>{t=t.set(new Pe(n),s)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:xe(),value:this.value};if(me(e))return null;{let n=pe(e),s=this.children.get(n);if(s!==null){let r=s.findRootMostMatchingPathAndValue(Oe(e),t);return r!=null?{path:We(new Pe(n),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(me(e))return this;{let t=pe(e),n=this.children.get(t);return n!==null?n.subtree(Oe(e)):new i(null)}}set(e,t){if(me(e))return new i(t,this.children);{let n=pe(e),r=(this.children.get(n)||new i(null)).set(Oe(e),t),o=this.children.insert(n,r);return new i(this.value,o)}}remove(e){if(me(e))return this.children.isEmpty()?new i(null):new i(null,this.children);{let t=pe(e),n=this.children.get(t);if(n){let s=n.remove(Oe(e)),r;return s.isEmpty()?r=this.children.remove(t):r=this.children.insert(t,s),this.value===null&&r.isEmpty()?new i(null):new i(this.value,r)}else return this}}get(e){if(me(e))return this.value;{let t=pe(e),n=this.children.get(t);return n?n.get(Oe(e)):null}}setTree(e,t){if(me(e))return t;{let n=pe(e),r=(this.children.get(n)||new i(null)).setTree(Oe(e),t),o;return r.isEmpty()?o=this.children.remove(n):o=this.children.insert(n,r),new i(this.value,o)}}fold(e){return this.fold_(xe(),e)}fold_(e,t){let n={};return this.children.inorderTraversal((s,r)=>{n[s]=r.fold_(We(e,s),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,xe(),t)}findOnPath_(e,t,n){let s=this.value?n(t,this.value):!1;if(s)return s;if(me(e))return null;{let r=pe(e),o=this.children.get(r);return o?o.findOnPath_(Oe(e),We(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,xe(),t)}foreachOnPath_(e,t,n){if(me(e))return this;{this.value&&n(t,this.value);let s=pe(e),r=this.children.get(s);return r?r.foreachOnPath_(Oe(e),We(t,s),n):new i(null)}}foreach(e){this.foreach_(xe(),e)}foreach_(e,t){this.children.inorderTraversal((n,s)=>{s.foreach_(We(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}};var Vn=class i{constructor(e){this.writeTree_=e}static empty(){return new i(new Wt(null))}};function Ea(i,e,t){if(me(e))return new Vn(new Wt(t));{let n=i.writeTree_.findRootMostValueAndPath(e);if(n!=null){let s=n.path,r=n.value,o=Gt(s,e);return r=r.updateChild(o,t),new Vn(i.writeTree_.set(s,r))}else{let s=new Wt(t),r=i.writeTree_.setTree(e,s);return new Vn(r)}}}function Zf(i,e,t){let n=i;return Tt(t,(s,r)=>{n=Ea(n,We(e,s),r)}),n}function Rw(i,e){if(me(e))return Vn.empty();{let t=i.writeTree_.setTree(e,new Wt(null));return new Vn(t)}}function ep(i,e){return Ls(i,e)!=null}function Ls(i,e){let t=i.writeTree_.findRootMostValueAndPath(e);return t!=null?i.writeTree_.get(t.path).getChild(Gt(t.path,e)):null}function xw(i){let e=[],t=i.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(Fe,(n,s)=>{e.push(new ge(n,s))}):i.writeTree_.children.inorderTraversal((n,s)=>{s.value!=null&&e.push(new ge(n,s.value))}),e}function Gi(i,e){if(me(e))return i;{let t=Ls(i,e);return t!=null?new Vn(new Wt(t)):new Vn(i.writeTree_.subtree(e))}}function tp(i){return i.writeTree_.isEmpty()}function qr(i,e){return _E(xe(),i.writeTree_,e)}function _E(i,e,t){if(e.value!=null)return t.updateChild(i,e.value);{let n=null;return e.children.inorderTraversal((s,r)=>{s===".priority"?(B(r.value!==null,"Priority writes must always be leaf nodes"),n=r.value):t=_E(We(i,s),r,t)}),!t.getChild(i).isEmpty()&&n!==null&&(t=t.updateChild(We(i,".priority"),n)),t}}function vu(i,e){return EE(e,i)}function XA(i,e,t,n,s){B(n>i.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),i.allWrites.push({path:e,snap:t,writeId:n,visible:s}),s&&(i.visibleWrites=Ea(i.visibleWrites,e,t)),i.lastWriteId=n}function JA(i,e,t,n){B(n>i.lastWriteId,"Stacking an older merge on top of newer ones"),i.allWrites.push({path:e,children:t,writeId:n,visible:!0}),i.visibleWrites=Zf(i.visibleWrites,e,t),i.lastWriteId=n}function ZA(i,e){for(let t=0;t<i.allWrites.length;t++){let n=i.allWrites[t];if(n.writeId===e)return n}return null}function eR(i,e){let t=i.allWrites.findIndex(a=>a.writeId===e);B(t>=0,"removeWrite called with nonexistent writeId.");let n=i.allWrites[t];i.allWrites.splice(t,1);let s=n.visible,r=!1,o=i.allWrites.length-1;for(;s&&o>=0;){let a=i.allWrites[o];a.visible&&(o>=t&&tR(a,n.path)?s=!1:An(n.path,a.path)&&(r=!0)),o--}if(s){if(r)return nR(i),!0;if(n.snap)i.visibleWrites=Rw(i.visibleWrites,n.path);else{let a=n.children;Tt(a,c=>{i.visibleWrites=Rw(i.visibleWrites,We(n.path,c))})}return!0}else return!1}function tR(i,e){if(i.snap)return An(i.path,e);for(let t in i.children)if(i.children.hasOwnProperty(t)&&An(We(i.path,t),e))return!0;return!1}function nR(i){i.visibleWrites=yE(i.allWrites,iR,xe()),i.allWrites.length>0?i.lastWriteId=i.allWrites[i.allWrites.length-1].writeId:i.lastWriteId=-1}function iR(i){return i.visible}function yE(i,e,t){let n=Vn.empty();for(let s=0;s<i.length;++s){let r=i[s];if(e(r)){let o=r.path,a;if(r.snap)An(t,o)?(a=Gt(t,o),n=Ea(n,a,r.snap)):An(o,t)&&(a=Gt(o,t),n=Ea(n,xe(),r.snap.getChild(a)));else if(r.children){if(An(t,o))a=Gt(t,o),n=Zf(n,a,r.children);else if(An(o,t))if(a=Gt(o,t),me(a))n=Zf(n,xe(),r.children);else{let c=qi(r.children,pe(a));if(c){let u=c.getChild(Oe(a));n=Ea(n,xe(),u)}}}else throw xr("WriteRecord should have .snap or .children")}}return n}function vE(i,e,t,n,s){if(!n&&!s){let r=Ls(i.visibleWrites,e);if(r!=null)return r;{let o=Gi(i.visibleWrites,e);if(tp(o))return t;if(t==null&&!ep(o,xe()))return null;{let a=t||ue.EMPTY_NODE;return qr(o,a)}}}else{let r=Gi(i.visibleWrites,e);if(!s&&tp(r))return t;if(!s&&t==null&&!ep(r,xe()))return null;{let o=function(u){return(u.visible||s)&&(!n||!~n.indexOf(u.writeId))&&(An(u.path,e)||An(e,u.path))},a=yE(i.allWrites,o,e),c=t||ue.EMPTY_NODE;return qr(a,c)}}}function sR(i,e,t){let n=ue.EMPTY_NODE,s=Ls(i.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(Fe,(r,o)=>{n=n.updateImmediateChild(r,o)}),n;if(t){let r=Gi(i.visibleWrites,e);return t.forEachChild(Fe,(o,a)=>{let c=qr(Gi(r,new Pe(o)),a);n=n.updateImmediateChild(o,c)}),xw(r).forEach(o=>{n=n.updateImmediateChild(o.name,o.node)}),n}else{let r=Gi(i.visibleWrites,e);return xw(r).forEach(o=>{n=n.updateImmediateChild(o.name,o.node)}),n}}function rR(i,e,t,n,s){B(n||s,"Either existingEventSnap or existingServerSnap must exist");let r=We(e,t);if(ep(i.visibleWrites,r))return null;{let o=Gi(i.visibleWrites,r);return tp(o)?s.getChild(t):qr(o,s.getChild(t))}}function oR(i,e,t,n){let s=We(e,t),r=Ls(i.visibleWrites,s);if(r!=null)return r;if(n.isCompleteForChild(t)){let o=Gi(i.visibleWrites,s);return qr(o,n.getNode().getImmediateChild(t))}else return null}function aR(i,e){return Ls(i.visibleWrites,e)}function lR(i,e,t,n,s,r,o){let a,c=Gi(i.visibleWrites,e),u=Ls(c,xe());if(u!=null)a=u;else if(t!=null)a=qr(c,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let d=[],f=o.getCompare(),m=r?a.getReverseIteratorFrom(n,o):a.getIteratorFrom(n,o),_=m.getNext();for(;_&&d.length<s;)f(_,n)!==0&&d.push(_),_=m.getNext();return d}else return[]}function cR(){return{visibleWrites:Vn.empty(),allWrites:[],lastWriteId:-1}}function nu(i,e,t,n){return vE(i.writeTree,i.treePath,e,t,n)}function Bp(i,e){return sR(i.writeTree,i.treePath,e)}function Pw(i,e,t,n){return rR(i.writeTree,i.treePath,e,t,n)}function iu(i,e){return aR(i.writeTree,We(i.treePath,e))}function uR(i,e,t,n,s,r){return lR(i.writeTree,i.treePath,e,t,n,s,r)}function Up(i,e,t){return oR(i.writeTree,i.treePath,e,t)}function wE(i,e){return EE(We(i.treePath,e),i.writeTree)}function EE(i,e){return{treePath:i,writeTree:e}}var np=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,n=e.childName;B(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),B(n!==".priority","Only non-priority child changes can be tracked.");let s=this.changeMap.get(n);if(s){let r=s.type;if(t==="child_added"&&r==="child_removed")this.changeMap.set(n,Aa(n,e.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&r==="child_added")this.changeMap.delete(n);else if(t==="child_removed"&&r==="child_changed")this.changeMap.set(n,Sa(n,s.oldSnap));else if(t==="child_changed"&&r==="child_added")this.changeMap.set(n,Br(n,e.snapshotNode));else if(t==="child_changed"&&r==="child_changed")this.changeMap.set(n,Aa(n,e.snapshotNode,s.oldSnap));else throw xr("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}};var ip=class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}},TE=new ip,Da=class{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let n=this.optCompleteServerCache_!=null?new Xn(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Up(this.writes_,e,n)}}getChildAfterChild(e,t,n){let s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Ms(this.viewCache_),r=uR(this.writes_,s,t,1,n,e);return r.length===0?null:r[0]}};function hR(i){return{filter:i}}function dR(i,e){B(e.eventCache.getNode().isIndexed(i.filter.getIndex()),"Event snap not indexed"),B(e.serverCache.getNode().isIndexed(i.filter.getIndex()),"Server snap not indexed")}function fR(i,e,t,n,s){let r=new np,o,a;if(t.type===Qn.OVERWRITE){let u=t;u.source.fromUser?o=sp(i,e,u.path,u.snap,n,s,r):(B(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!me(u.path),o=su(i,e,u.path,u.snap,n,s,a,r))}else if(t.type===Qn.MERGE){let u=t;u.source.fromUser?o=mR(i,e,u.path,u.children,n,s,r):(B(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=rp(i,e,u.path,u.children,n,s,a,r))}else if(t.type===Qn.ACK_USER_WRITE){let u=t;u.revert?o=yR(i,e,u.path,n,s,r):o=gR(i,e,u.path,u.affectedTree,n,s,r)}else if(t.type===Qn.LISTEN_COMPLETE)o=_R(i,e,t.path,n,r);else throw xr("Unknown operation type: "+t.type);let c=r.getChanges();return pR(e,o,c),{viewCache:o,changes:c}}function pR(i,e,t){let n=e.eventCache;if(n.isFullyInitialized()){let s=n.getNode().isLeafNode()||n.getNode().isEmpty(),r=tu(i);(t.length>0||!i.eventCache.isFullyInitialized()||s&&!n.getNode().equals(r)||!n.getNode().getPriority().equals(r.getPriority()))&&t.push(mE(tu(e)))}}function IE(i,e,t,n,s,r){let o=e.eventCache;if(iu(n,t)!=null)return e;{let a,c;if(me(t))if(B(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let u=Ms(e),d=u instanceof ue?u:ue.EMPTY_NODE,f=Bp(n,d);a=i.filter.updateFullNode(e.eventCache.getNode(),f,r)}else{let u=nu(n,Ms(e));a=i.filter.updateFullNode(e.eventCache.getNode(),u,r)}else{let u=pe(t);if(u===".priority"){B(Ki(t)===1,"Can't have a priority with additional path components");let d=o.getNode();c=e.serverCache.getNode();let f=Pw(n,t,d,c);f!=null?a=i.filter.updatePriority(d,f):a=o.getNode()}else{let d=Oe(t),f;if(o.isCompleteForChild(u)){c=e.serverCache.getNode();let m=Pw(n,t,o.getNode(),c);m!=null?f=o.getNode().getImmediateChild(u).updateChild(d,m):f=o.getNode().getImmediateChild(u)}else f=Up(n,u,e.serverCache);f!=null?a=i.filter.updateChild(o.getNode(),u,f,d,s,r):a=o.getNode()}}return wa(e,a,o.isFullyInitialized()||me(t),i.filter.filtersNodes())}}function su(i,e,t,n,s,r,o,a){let c=e.serverCache,u,d=o?i.filter:i.filter.getIndexedFilter();if(me(t))u=d.updateFullNode(c.getNode(),n,null);else if(d.filtersNodes()&&!c.isFiltered()){let _=c.getNode().updateChild(t,n);u=d.updateFullNode(c.getNode(),_,null)}else{let _=pe(t);if(!c.isCompleteForPath(t)&&Ki(t)>1)return e;let v=Oe(t),R=c.getNode().getImmediateChild(_).updateChild(v,n);_===".priority"?u=d.updatePriority(c.getNode(),R):u=d.updateChild(c.getNode(),_,R,v,TE,null)}let f=gE(e,u,c.isFullyInitialized()||me(t),d.filtersNodes()),m=new Da(s,f,r);return IE(i,f,t,s,m,a)}function sp(i,e,t,n,s,r,o){let a=e.eventCache,c,u,d=new Da(s,e,r);if(me(t))u=i.filter.updateFullNode(e.eventCache.getNode(),n,o),c=wa(e,u,!0,i.filter.filtersNodes());else{let f=pe(t);if(f===".priority")u=i.filter.updatePriority(e.eventCache.getNode(),n),c=wa(e,u,a.isFullyInitialized(),a.isFiltered());else{let m=Oe(t),_=a.getNode().getImmediateChild(f),v;if(me(m))v=n;else{let C=d.getCompleteChild(f);C!=null?Dp(m)===".priority"&&C.getChild(cE(m)).isEmpty()?v=C:v=C.updateChild(m,n):v=ue.EMPTY_NODE}if(_.equals(v))c=e;else{let C=i.filter.updateChild(a.getNode(),f,v,m,d,o);c=wa(e,C,a.isFullyInitialized(),i.filter.filtersNodes())}}}return c}function Dw(i,e){return i.eventCache.isCompleteForChild(e)}function mR(i,e,t,n,s,r,o){let a=e;return n.foreach((c,u)=>{let d=We(t,c);Dw(e,pe(d))&&(a=sp(i,a,d,u,s,r,o))}),n.foreach((c,u)=>{let d=We(t,c);Dw(e,pe(d))||(a=sp(i,a,d,u,s,r,o))}),a}function Nw(i,e,t){return t.foreach((n,s)=>{e=e.updateChild(n,s)}),e}function rp(i,e,t,n,s,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,u;me(t)?u=n:u=new Wt(null).setTree(t,n);let d=e.serverCache.getNode();return u.children.inorderTraversal((f,m)=>{if(d.hasChild(f)){let _=e.serverCache.getNode().getImmediateChild(f),v=Nw(i,_,m);c=su(i,c,new Pe(f),v,s,r,o,a)}}),u.children.inorderTraversal((f,m)=>{let _=!e.serverCache.isCompleteForChild(f)&&m.value===null;if(!d.hasChild(f)&&!_){let v=e.serverCache.getNode().getImmediateChild(f),C=Nw(i,v,m);c=su(i,c,new Pe(f),C,s,r,o,a)}}),c}function gR(i,e,t,n,s,r,o){if(iu(s,t)!=null)return e;let a=e.serverCache.isFiltered(),c=e.serverCache;if(n.value!=null){if(me(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return su(i,e,t,c.getNode().getChild(t),s,r,a,o);if(me(t)){let u=new Wt(null);return c.getNode().forEachChild($n,(d,f)=>{u=u.set(new Pe(d),f)}),rp(i,e,t,u,s,r,a,o)}else return e}else{let u=new Wt(null);return n.foreach((d,f)=>{let m=We(t,d);c.isCompleteForPath(m)&&(u=u.set(d,c.getNode().getChild(m)))}),rp(i,e,t,u,s,r,a,o)}}function _R(i,e,t,n,s){let r=e.serverCache,o=gE(e,r.getNode(),r.isFullyInitialized()||me(t),r.isFiltered());return IE(i,o,t,n,TE,s)}function yR(i,e,t,n,s,r){let o;if(iu(n,t)!=null)return e;{let a=new Da(n,e,s),c=e.eventCache.getNode(),u;if(me(t)||pe(t)===".priority"){let d;if(e.serverCache.isFullyInitialized())d=nu(n,Ms(e));else{let f=e.serverCache.getNode();B(f instanceof ue,"serverChildren would be complete if leaf node"),d=Bp(n,f)}d=d,u=i.filter.updateFullNode(c,d,r)}else{let d=pe(t),f=Up(n,d,e.serverCache);f==null&&e.serverCache.isCompleteForChild(d)&&(f=c.getImmediateChild(d)),f!=null?u=i.filter.updateChild(c,d,f,Oe(t),a,r):e.eventCache.getNode().hasChild(d)?u=i.filter.updateChild(c,d,ue.EMPTY_NODE,Oe(t),a,r):u=c,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=nu(n,Ms(e)),o.isLeafNode()&&(u=i.filter.updateFullNode(u,o,r)))}return o=e.serverCache.isFullyInitialized()||iu(n,xe())!=null,wa(e,u,o,i.filter.filtersNodes())}}var op=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let n=this.query_._queryParams,s=new Ra(n.getIndex()),r=BA(n);this.processor_=hR(r);let o=t.serverCache,a=t.eventCache,c=s.updateFullNode(ue.EMPTY_NODE,o.getNode(),null),u=r.updateFullNode(ue.EMPTY_NODE,a.getNode(),null),d=new Xn(c,o.isFullyInitialized(),s.filtersNodes()),f=new Xn(u,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=yu(f,d),this.eventGenerator_=new Jf(this.query_)}get query(){return this.query_}};function vR(i){return i.viewCache_.serverCache.getNode()}function wR(i){return tu(i.viewCache_)}function ER(i,e){let t=Ms(i.viewCache_);return t&&(i.query._queryParams.loadsAllData()||!me(e)&&!t.getImmediateChild(pe(e)).isEmpty())?t.getChild(e):null}function kw(i){return i.eventRegistrations_.length===0}function TR(i,e){i.eventRegistrations_.push(e)}function Ow(i,e,t){let n=[];if(t){B(e==null,"A cancel should cancel all event registrations.");let s=i.query._path;i.eventRegistrations_.forEach(r=>{let o=r.createCancelEvent(t,s);o&&n.push(o)})}if(e){let s=[];for(let r=0;r<i.eventRegistrations_.length;++r){let o=i.eventRegistrations_[r];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(i.eventRegistrations_.slice(r+1));break}}i.eventRegistrations_=s}else i.eventRegistrations_=[];return n}function Mw(i,e,t,n){e.type===Qn.MERGE&&e.source.queryId!==null&&(B(Ms(i.viewCache_),"We should always have a full cache before handling merges"),B(tu(i.viewCache_),"Missing event cache, even though we have a server cache"));let s=i.viewCache_,r=fR(i.processor_,s,e,t,n);return dR(i.processor_,r.viewCache),B(r.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),i.viewCache_=r.viewCache,CE(i,r.changes,r.viewCache.eventCache.getNode(),null)}function IR(i,e){let t=i.viewCache_.eventCache,n=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(Fe,(r,o)=>{n.push(Br(r,o))}),t.isFullyInitialized()&&n.push(mE(t.getNode())),CE(i,n,t.getNode(),e)}function CE(i,e,t,n){let s=n?[n]:i.eventRegistrations_;return KA(i.eventGenerator_,e,t,s)}var ru,ou=class{constructor(){this.views=new Map}};function CR(i){B(!ru,"__referenceConstructor has already been defined"),ru=i}function bR(){return B(ru,"Reference.ts has not been loaded"),ru}function SR(i){return i.views.size===0}function qp(i,e,t,n){let s=e.source.queryId;if(s!==null){let r=i.views.get(s);return B(r!=null,"SyncTree gave us an op for an invalid query."),Mw(r,e,t,n)}else{let r=[];for(let o of i.views.values())r=r.concat(Mw(o,e,t,n));return r}}function bE(i,e,t,n,s){let r=e._queryIdentifier,o=i.views.get(r);if(!o){let a=nu(t,s?n:null),c=!1;a?c=!0:n instanceof ue?(a=Bp(t,n),c=!1):(a=ue.EMPTY_NODE,c=!1);let u=yu(new Xn(a,c,!1),new Xn(n,s,!1));return new op(e,u)}return o}function AR(i,e,t,n,s,r){let o=bE(i,e,n,s,r);return i.views.has(e._queryIdentifier)||i.views.set(e._queryIdentifier,o),TR(o,t),IR(o,t)}function RR(i,e,t,n){let s=e._queryIdentifier,r=[],o=[],a=Qi(i);if(s==="default")for(let[c,u]of i.views.entries())o=o.concat(Ow(u,t,n)),kw(u)&&(i.views.delete(c),u.query._queryParams.loadsAllData()||r.push(u.query));else{let c=i.views.get(s);c&&(o=o.concat(Ow(c,t,n)),kw(c)&&(i.views.delete(s),c.query._queryParams.loadsAllData()||r.push(c.query)))}return a&&!Qi(i)&&r.push(new(bR())(e._repo,e._path)),{removed:r,events:o}}function SE(i){let e=[];for(let t of i.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Wi(i,e){let t=null;for(let n of i.views.values())t=t||ER(n,e);return t}function AE(i,e){if(e._queryParams.loadsAllData())return wu(i);{let n=e._queryIdentifier;return i.views.get(n)}}function RE(i,e){return AE(i,e)!=null}function Qi(i){return wu(i)!=null}function wu(i){for(let e of i.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var au;function xR(i){B(!au,"__referenceConstructor has already been defined"),au=i}function PR(){return B(au,"Reference.ts has not been loaded"),au}var DR=1,lu=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Wt(null),this.pendingWriteTree_=cR(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function zp(i,e,t,n,s){return XA(i.pendingWriteTree_,e,t,n,s),s?Hr(i,new Ur(Fp(),e,t)):[]}function NR(i,e,t,n){JA(i.pendingWriteTree_,e,t,n);let s=Wt.fromObject(t);return Hr(i,new Pa(Fp(),e,s))}function ji(i,e,t=!1){let n=ZA(i.pendingWriteTree_,e);if(eR(i.pendingWriteTree_,e)){let r=new Wt(null);return n.snap!=null?r=r.set(xe(),!0):Tt(n.children,o=>{r=r.set(new Pe(o),!0)}),Hr(i,new Xf(n.path,r,t))}else return[]}function Ua(i,e,t){return Hr(i,new Ur(Lp(),e,t))}function kR(i,e,t){let n=Wt.fromObject(t);return Hr(i,new Pa(Lp(),e,n))}function OR(i,e){return Hr(i,new eu(Lp(),e))}function MR(i,e,t){let n=jp(i,t);if(n){let s=Gp(n),r=s.path,o=s.queryId,a=Gt(r,e),c=new eu(Vp(o),a);return Wp(i,r,c)}else return[]}function cu(i,e,t,n,s=!1){let r=e._path,o=i.syncPointTree_.get(r),a=[];if(o&&(e._queryIdentifier==="default"||RE(o,e))){let c=RR(o,e,t,n);SR(o)&&(i.syncPointTree_=i.syncPointTree_.remove(r));let u=c.removed;if(a=c.events,!s){let d=u.findIndex(m=>m._queryParams.loadsAllData())!==-1,f=i.syncPointTree_.findOnPath(r,(m,_)=>Qi(_));if(d&&!f){let m=i.syncPointTree_.subtree(r);if(!m.isEmpty()){let _=VR(m);for(let v=0;v<_.length;++v){let C=_[v],R=C.query,U=NE(i,C);i.listenProvider_.startListening(Ta(R),Na(i,R),U.hashFn,U.onComplete)}}}!f&&u.length>0&&!n&&(d?i.listenProvider_.stopListening(Ta(e),null):u.forEach(m=>{let _=i.queryToTagMap.get(Tu(m));i.listenProvider_.stopListening(Ta(m),_)}))}BR(i,u)}return a}function xE(i,e,t,n){let s=jp(i,n);if(s!=null){let r=Gp(s),o=r.path,a=r.queryId,c=Gt(o,e),u=new Ur(Vp(a),c,t);return Wp(i,o,u)}else return[]}function FR(i,e,t,n){let s=jp(i,n);if(s){let r=Gp(s),o=r.path,a=r.queryId,c=Gt(o,e),u=Wt.fromObject(t),d=new Pa(Vp(a),c,u);return Wp(i,o,d)}else return[]}function ap(i,e,t,n=!1){let s=e._path,r=null,o=!1;i.syncPointTree_.foreachOnPath(s,(m,_)=>{let v=Gt(m,s);r=r||Wi(_,v),o=o||Qi(_)});let a=i.syncPointTree_.get(s);a?(o=o||Qi(a),r=r||Wi(a,xe())):(a=new ou,i.syncPointTree_=i.syncPointTree_.set(s,a));let c;r!=null?c=!0:(c=!1,r=ue.EMPTY_NODE,i.syncPointTree_.subtree(s).foreachChild((_,v)=>{let C=Wi(v,xe());C&&(r=r.updateImmediateChild(_,C))}));let u=RE(a,e);if(!u&&!e._queryParams.loadsAllData()){let m=Tu(e);B(!i.queryToTagMap.has(m),"View does not exist, but we have a tag");let _=UR();i.queryToTagMap.set(m,_),i.tagToQueryMap.set(_,m)}let d=vu(i.pendingWriteTree_,s),f=AR(a,e,t,d,r,c);if(!u&&!o&&!n){let m=AE(a,e);f=f.concat(qR(i,e,m))}return f}function Eu(i,e,t){let s=i.pendingWriteTree_,r=i.syncPointTree_.findOnPath(e,(o,a)=>{let c=Gt(o,e),u=Wi(a,c);if(u)return u});return vE(s,e,r,t,!0)}function LR(i,e){let t=e._path,n=null;i.syncPointTree_.foreachOnPath(t,(u,d)=>{let f=Gt(u,t);n=n||Wi(d,f)});let s=i.syncPointTree_.get(t);s?n=n||Wi(s,xe()):(s=new ou,i.syncPointTree_=i.syncPointTree_.set(t,s));let r=n!=null,o=r?new Xn(n,!0,!1):null,a=vu(i.pendingWriteTree_,e._path),c=bE(s,e,a,r?o.getNode():ue.EMPTY_NODE,r);return wR(c)}function Hr(i,e){return PE(e,i.syncPointTree_,null,vu(i.pendingWriteTree_,xe()))}function PE(i,e,t,n){if(me(i.path))return DE(i,e,t,n);{let s=e.get(xe());t==null&&s!=null&&(t=Wi(s,xe()));let r=[],o=pe(i.path),a=i.operationForChild(o),c=e.children.get(o);if(c&&a){let u=t?t.getImmediateChild(o):null,d=wE(n,o);r=r.concat(PE(a,c,u,d))}return s&&(r=r.concat(qp(s,i,n,t))),r}}function DE(i,e,t,n){let s=e.get(xe());t==null&&s!=null&&(t=Wi(s,xe()));let r=[];return e.children.inorderTraversal((o,a)=>{let c=t?t.getImmediateChild(o):null,u=wE(n,o),d=i.operationForChild(o);d&&(r=r.concat(DE(d,a,c,u)))}),s&&(r=r.concat(qp(s,i,n,t))),r}function NE(i,e){let t=e.query,n=Na(i,t);return{hashFn:()=>(vR(e)||ue.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return n?MR(i,t._path,n):OR(i,t._path);{let r=XS(s,t);return cu(i,t,null,r)}}}}function Na(i,e){let t=Tu(e);return i.queryToTagMap.get(t)}function Tu(i){return i._path.toString()+"$"+i._queryIdentifier}function jp(i,e){return i.tagToQueryMap.get(e)}function Gp(i){let e=i.indexOf("$");return B(e!==-1&&e<i.length-1,"Bad queryKey."),{queryId:i.substr(e+1),path:new Pe(i.substr(0,e))}}function Wp(i,e,t){let n=i.syncPointTree_.get(e);B(n,"Missing sync point for query tag that we're tracking");let s=vu(i.pendingWriteTree_,e);return qp(n,t,s,null)}function VR(i){return i.fold((e,t,n)=>{if(t&&Qi(t))return[wu(t)];{let s=[];return t&&(s=SE(t)),Tt(n,(r,o)=>{s=s.concat(o)}),s}})}function Ta(i){return i._queryParams.loadsAllData()&&!i._queryParams.isDefault()?new(PR())(i._repo,i._path):i}function BR(i,e){for(let t=0;t<e.length;++t){let n=e[t];if(!n._queryParams.loadsAllData()){let s=Tu(n),r=i.queryToTagMap.get(s);i.queryToTagMap.delete(s),i.tagToQueryMap.delete(r)}}}function UR(){return DR++}function qR(i,e,t){let n=e._path,s=Na(i,e),r=NE(i,t),o=i.listenProvider_.startListening(Ta(e),s,r.hashFn,r.onComplete),a=i.syncPointTree_.subtree(n);if(s)B(!Qi(a.value),"If we're adding a query, it shouldn't be shadowed");else{let c=a.fold((u,d,f)=>{if(!me(u)&&d&&Qi(d))return[wu(d).query];{let m=[];return d&&(m=m.concat(SE(d).map(_=>_.query))),Tt(f,(_,v)=>{m=m.concat(v)}),m}});for(let u=0;u<c.length;++u){let d=c[u];i.listenProvider_.stopListening(Ta(d),Na(i,d))}}return o}var lp=class i{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new i(t)}node(){return this.node_}},cp=class i{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=We(this.path_,e);return new i(this.syncTree_,t)}node(){return Eu(this.syncTree_,this.path_)}},zR=function(i){return i=i||{},i.timestamp=i.timestamp||new Date().getTime(),i},Fw=function(i,e,t){if(!i||typeof i!="object")return i;if(B(".sv"in i,"Unexpected leaf node or priority contents"),typeof i[".sv"]=="string")return jR(i[".sv"],e,t);if(typeof i[".sv"]=="object")return GR(i[".sv"],e);B(!1,"Unexpected server value: "+JSON.stringify(i,null,2))},jR=function(i,e,t){switch(i){case"timestamp":return t.timestamp;default:B(!1,"Unexpected server value: "+i)}},GR=function(i,e,t){i.hasOwnProperty("increment")||B(!1,"Unexpected server value: "+JSON.stringify(i,null,2));let n=i.increment;typeof n!="number"&&B(!1,"Unexpected increment value: "+n);let s=e.node();if(B(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return n;let o=s.getValue();return typeof o!="number"?n:o+n},kE=function(i,e,t,n){return Kp(e,new cp(t,i),n)},Hp=function(i,e,t){return Kp(i,new lp(e),t)};function Kp(i,e,t){let n=i.getPriority().val(),s=Fw(n,e.getImmediateChild(".priority"),t),r;if(i.isLeafNode()){let o=i,a=Fw(o.getValue(),e,t);return a!==o.getValue()||s!==o.getPriority().val()?new Lr(a,Qe(s)):i}else{let o=i;return r=o,s!==o.getPriority().val()&&(r=r.updatePriority(new Lr(s))),o.forEachChild(Fe,(a,c)=>{let u=Kp(c,e.getImmediateChild(a),t);u!==c&&(r=r.updateImmediateChild(a,u))}),r}}var ka=class{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}};function Iu(i,e){let t=e instanceof Pe?e:new Pe(e),n=i,s=pe(t);for(;s!==null;){let r=qi(n.node.children,s)||{children:{},childCount:0};n=new ka(s,n,r),t=Oe(t),s=pe(t)}return n}function Vs(i){return i.node.value}function Qp(i,e){i.node.value=e,up(i)}function OE(i){return i.node.childCount>0}function WR(i){return Vs(i)===void 0&&!OE(i)}function Cu(i,e){Tt(i.node.children,(t,n)=>{e(new ka(t,i,n))})}function ME(i,e,t,n){t&&!n&&e(i),Cu(i,s=>{ME(s,e,!0,n)}),t&&n&&e(i)}function HR(i,e,t){let n=t?i:i.parent;for(;n!==null;){if(e(n))return!0;n=n.parent}return!1}function qa(i){return new Pe(i.parent===null?i.name:qa(i.parent)+"/"+i.name)}function up(i){i.parent!==null&&KR(i.parent,i.name,i)}function KR(i,e,t){let n=WR(t),s=bn(i.node.children,e);n&&s?(delete i.node.children[e],i.node.childCount--,up(i)):!n&&!s&&(i.node.children[e]=t.node,i.node.childCount++,up(i))}var QR=/[\[\].#$\/\u0000-\u001F\u007F]/,$R=/[\[\].#$\u0000-\u001F\u007F]/,Ef=10*1024*1024,bu=function(i){return typeof i=="string"&&i.length!==0&&!QR.test(i)},FE=function(i){return typeof i=="string"&&i.length!==0&&!$R.test(i)},YR=function(i){return i&&(i=i.replace(/^\/*\.info(\/|$)/,"/")),FE(i)},Oa=function(i){return i===null||typeof i=="string"||typeof i=="number"&&!gu(i)||i&&typeof i=="object"&&bn(i,".sv")},Jn=function(i,e,t,n){n&&e===void 0||za(en(i,"value"),e,t)},za=function(i,e,t){let n=t instanceof Pe?new Of(t,i):t;if(e===void 0)throw new Error(i+"contains undefined "+Ns(n));if(typeof e=="function")throw new Error(i+"contains a function "+Ns(n)+" with contents = "+e.toString());if(gu(e))throw new Error(i+"contains "+e.toString()+" "+Ns(n));if(typeof e=="string"&&e.length>Ef/3&&fa(e)>Ef)throw new Error(i+"contains a string greater than "+Ef+" utf8 bytes "+Ns(n)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,r=!1;if(Tt(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!bu(o)))throw new Error(i+" contains an invalid key ("+o+") "+Ns(n)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);SA(n,o),za(i,a,n),AA(n)}),s&&r)throw new Error(i+' contains ".value" child '+Ns(n)+" in addition to actual children.")}},XR=function(i,e){let t,n;for(t=0;t<e.length;t++){n=e[t];let r=Ca(n);for(let o=0;o<r.length;o++)if(!(r[o]===".priority"&&o===r.length-1)){if(!bu(r[o]))throw new Error(i+"contains an invalid key ("+r[o]+") in path "+n.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(bA);let s=null;for(t=0;t<e.length;t++){if(n=e[t],s!==null&&An(s,n))throw new Error(i+"contains a path "+s.toString()+" that is ancestor of another path "+n.toString());s=n}},LE=function(i,e,t,n){if(n&&e===void 0)return;let s=en(i,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");let r=[];Tt(e,(o,a)=>{let c=new Pe(o);if(za(s,a,We(t,c)),Dp(c)===".priority"&&!Oa(a))throw new Error(s+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(c)}),XR(s,r)},$p=function(i,e,t){if(!(t&&e===void 0)){if(gu(e))throw new Error(en(i,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Oa(e))throw new Error(en(i,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},ja=function(i,e,t,n){if(!(n&&t===void 0)&&!bu(t))throw new Error(en(i,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},Kr=function(i,e,t,n){if(!(n&&t===void 0)&&!FE(t))throw new Error(en(i,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},JR=function(i,e,t,n){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Kr(i,e,t,n)},on=function(i,e){if(pe(e)===".info")throw new Error(i+" failed = Can't modify data under /.info/")},VE=function(i,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!bu(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!YR(t))throw new Error(en(i,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var hp=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function Su(i,e){let t=null;for(let n=0;n<e.length;n++){let s=e[n],r=s.getPath();t!==null&&!Np(r,t.path)&&(i.eventLists_.push(t),t=null),t===null&&(t={events:[],path:r}),t.events.push(s)}t&&i.eventLists_.push(t)}function BE(i,e,t){Su(i,t),UE(i,n=>Np(n,e))}function an(i,e,t){Su(i,t),UE(i,n=>An(n,e)||An(e,n))}function UE(i,e){i.recursionDepth_++;let t=!0;for(let n=0;n<i.eventLists_.length;n++){let s=i.eventLists_[n];if(s){let r=s.path;e(r)?(ZR(i.eventLists_[n]),i.eventLists_[n]=null):t=!1}}t&&(i.eventLists_=[]),i.recursionDepth_--}function ZR(i){for(let e=0;e<i.events.length;e++){let t=i.events[e];if(t!==null){i.events[e]=null;let n=t.getEventRunner();Os&&Et("event: "+t.toString()),Gr(n)}}}var qE="repo_interrupt",ex=25,dp=class{constructor(e,t,n,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new hp,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Zc(),this.transactionQueueTree_=new ka,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function tx(i,e,t){if(i.stats_=Pp(i.repoInfo_),i.forceRestClient_||tA())i.server_=new Wf(i.repoInfo_,(n,s,r,o)=>{Lw(i,n,s,r,o)},i.authTokenProvider_,i.appCheckProvider_),setTimeout(()=>Vw(i,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{ct(t)}catch(n){throw new Error("Invalid authOverride provided: "+n)}}i.persistentConnection_=new kp(i.repoInfo_,e,(n,s,r,o)=>{Lw(i,n,s,r,o)},n=>{Vw(i,n)},n=>{nx(i,n)},i.authTokenProvider_,i.appCheckProvider_,t),i.server_=i.persistentConnection_}i.authTokenProvider_.addTokenChangeListener(n=>{i.server_.refreshAuthToken(n)}),i.appCheckProvider_.addTokenChangeListener(n=>{i.server_.refreshAppCheckToken(n.token)}),i.statsReporter_=iA(i.repoInfo_,()=>new Yf(i.stats_,i.server_)),i.infoData_=new Hf,i.infoSyncTree_=new lu({startListening:(n,s,r,o)=>{let a=[],c=i.infoData_.getNode(n._path);return c.isEmpty()||(a=Ua(i.infoSyncTree_,n._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Yp(i,"connected",!1),i.serverSyncTree_=new lu({startListening:(n,s,r,o)=>(i.server_.listen(n,r,s,(a,c)=>{let u=o(a,c);an(i.eventQueue_,n._path,u)}),[]),stopListening:(n,s)=>{i.server_.unlisten(n,s)}})}function zE(i){let t=i.infoData_.getNode(new Pe(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Ga(i){return zR({timestamp:zE(i)})}function Lw(i,e,t,n,s){i.dataUpdateCount++;let r=new Pe(e);t=i.interceptServerDataCallback_?i.interceptServerDataCallback_(e,t):t;let o=[];if(s)if(n){let c=da(t,u=>Qe(u));o=FR(i.serverSyncTree_,r,c,s)}else{let c=Qe(t);o=xE(i.serverSyncTree_,r,c,s)}else if(n){let c=da(t,u=>Qe(u));o=kR(i.serverSyncTree_,r,c)}else{let c=Qe(t);o=Ua(i.serverSyncTree_,r,c)}let a=r;o.length>0&&(a=zr(i,r)),an(i.eventQueue_,a,o)}function Vw(i,e){Yp(i,"connected",e),e===!1&&rx(i)}function nx(i,e){Tt(e,(t,n)=>{Yp(i,t,n)})}function Yp(i,e,t){let n=new Pe("/.info/"+e),s=Qe(t);i.infoData_.updateSnapshot(n,s);let r=Ua(i.infoSyncTree_,n,s);an(i.eventQueue_,n,r)}function Au(i){return i.nextWriteId_++}function ix(i,e,t){let n=LR(i.serverSyncTree_,e);return n!=null?Promise.resolve(n):i.server_.get(e).then(s=>{let r=Qe(s).withIndex(e._queryParams.getIndex());ap(i.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=Ua(i.serverSyncTree_,e._path,r);else{let a=Na(i.serverSyncTree_,e);o=xE(i.serverSyncTree_,e._path,r,a)}return an(i.eventQueue_,e._path,o),cu(i.serverSyncTree_,e,t,null,!0),r},s=>(Qr(i,"get for query "+ct(e)+" failed: "+s),Promise.reject(new Error(s))))}function Xp(i,e,t,n,s){Qr(i,"set",{path:e.toString(),value:t,priority:n});let r=Ga(i),o=Qe(t,n),a=Eu(i.serverSyncTree_,e),c=Hp(o,a,r),u=Au(i),d=zp(i.serverSyncTree_,e,c,u,!0);Su(i.eventQueue_,d),i.server_.put(e.toString(),o.val(!0),(m,_)=>{let v=m==="ok";v||Mt("set at "+e+" failed: "+m);let C=ji(i.serverSyncTree_,u,!v);an(i.eventQueue_,e,C),$i(i,s,m,_)});let f=Zp(i,e);zr(i,f),an(i.eventQueue_,f,[])}function sx(i,e,t,n){Qr(i,"update",{path:e.toString(),value:t});let s=!0,r=Ga(i),o={};if(Tt(t,(a,c)=>{s=!1,o[a]=kE(We(e,a),Qe(c),i.serverSyncTree_,r)}),s)Et("update() called with empty data.  Don't do anything."),$i(i,n,"ok",void 0);else{let a=Au(i),c=NR(i.serverSyncTree_,e,o,a);Su(i.eventQueue_,c),i.server_.merge(e.toString(),t,(u,d)=>{let f=u==="ok";f||Mt("update at "+e+" failed: "+u);let m=ji(i.serverSyncTree_,a,!f),_=m.length>0?zr(i,e):e;an(i.eventQueue_,_,m),$i(i,n,u,d)}),Tt(t,u=>{let d=Zp(i,We(e,u));zr(i,d)}),an(i.eventQueue_,e,[])}}function rx(i){Qr(i,"onDisconnectEvents");let e=Ga(i),t=Zc();Qf(i.onDisconnect_,xe(),(s,r)=>{let o=kE(s,r,i.serverSyncTree_,e);Wr(t,s,o)});let n=[];Qf(t,xe(),(s,r)=>{n=n.concat(Ua(i.serverSyncTree_,s,r));let o=Zp(i,s);zr(i,o)}),i.onDisconnect_=Zc(),an(i.eventQueue_,xe(),n)}function ox(i,e,t){i.server_.onDisconnectCancel(e.toString(),(n,s)=>{n==="ok"&&Kf(i.onDisconnect_,e),$i(i,t,n,s)})}function Bw(i,e,t,n){let s=Qe(t);i.server_.onDisconnectPut(e.toString(),s.val(!0),(r,o)=>{r==="ok"&&Wr(i.onDisconnect_,e,s),$i(i,n,r,o)})}function ax(i,e,t,n,s){let r=Qe(t,n);i.server_.onDisconnectPut(e.toString(),r.val(!0),(o,a)=>{o==="ok"&&Wr(i.onDisconnect_,e,r),$i(i,s,o,a)})}function lx(i,e,t,n){if(Ic(t)){Et("onDisconnect().update() called with empty data.  Don't do anything."),$i(i,n,"ok",void 0);return}i.server_.onDisconnectMerge(e.toString(),t,(s,r)=>{s==="ok"&&Tt(t,(o,a)=>{let c=Qe(a);Wr(i.onDisconnect_,We(e,o),c)}),$i(i,n,s,r)})}function cx(i,e,t){let n;pe(e._path)===".info"?n=ap(i.infoSyncTree_,e,t):n=ap(i.serverSyncTree_,e,t),BE(i.eventQueue_,e._path,n)}function fp(i,e,t){let n;pe(e._path)===".info"?n=cu(i.infoSyncTree_,e,t):n=cu(i.serverSyncTree_,e,t),BE(i.eventQueue_,e._path,n)}function jE(i){i.persistentConnection_&&i.persistentConnection_.interrupt(qE)}function ux(i){i.persistentConnection_&&i.persistentConnection_.resume(qE)}function Qr(i,...e){let t="";i.persistentConnection_&&(t=i.persistentConnection_.id+":"),Et(t,...e)}function $i(i,e,t,n){e&&Gr(()=>{if(t==="ok")e(null);else{let s=(t||"error").toUpperCase(),r=s;n&&(r+=": "+n);let o=new Error(r);o.code=s,e(o)}})}function hx(i,e,t,n,s,r){Qr(i,"transaction on "+e);let o={path:e,update:t,onComplete:n,status:null,order:zw(),applyLocally:r,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=Jp(i,e,void 0);o.currentInputSnapshot=a;let c=o.update(a.val());if(c===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{za("transaction failed: Data returned ",c,o.path),o.status=0;let u=Iu(i.transactionQueueTree_,e),d=Vs(u)||[];d.push(o),Qp(u,d);let f;typeof c=="object"&&c!==null&&bn(c,".priority")?(f=qi(c,".priority"),B(Oa(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):f=(Eu(i.serverSyncTree_,e)||ue.EMPTY_NODE).getPriority().val();let m=Ga(i),_=Qe(c,f),v=Hp(_,a,m);o.currentOutputSnapshotRaw=_,o.currentOutputSnapshotResolved=v,o.currentWriteId=Au(i);let C=zp(i.serverSyncTree_,e,v,o.currentWriteId,o.applyLocally);an(i.eventQueue_,e,C),Ru(i,i.transactionQueueTree_)}}function Jp(i,e,t){return Eu(i.serverSyncTree_,e,t)||ue.EMPTY_NODE}function Ru(i,e=i.transactionQueueTree_){if(e||xu(i,e),Vs(e)){let t=WE(i,e);B(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&dx(i,qa(e),t)}else OE(e)&&Cu(e,t=>{Ru(i,t)})}function dx(i,e,t){let n=t.map(u=>u.currentWriteId),s=Jp(i,e,n),r=s,o=s.hash();for(let u=0;u<t.length;u++){let d=t[u];B(d.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;let f=Gt(e,d.path);r=r.updateChild(f,d.currentOutputSnapshotRaw)}let a=r.val(!0),c=e;i.server_.put(c.toString(),a,u=>{Qr(i,"transaction put response",{path:c.toString(),status:u});let d=[];if(u==="ok"){let f=[];for(let m=0;m<t.length;m++)t[m].status=2,d=d.concat(ji(i.serverSyncTree_,t[m].currentWriteId)),t[m].onComplete&&f.push(()=>t[m].onComplete(null,!0,t[m].currentOutputSnapshotResolved)),t[m].unwatcher();xu(i,Iu(i.transactionQueueTree_,e)),Ru(i,i.transactionQueueTree_),an(i.eventQueue_,e,d);for(let m=0;m<f.length;m++)Gr(f[m])}else{if(u==="datastale")for(let f=0;f<t.length;f++)t[f].status===3?t[f].status=4:t[f].status=0;else{Mt("transaction at "+c.toString()+" failed: "+u);for(let f=0;f<t.length;f++)t[f].status=4,t[f].abortReason=u}zr(i,e)}},o)}function zr(i,e){let t=GE(i,e),n=qa(t),s=WE(i,t);return fx(i,s,n),n}function fx(i,e,t){if(e.length===0)return;let n=[],s=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let c=e[a],u=Gt(t,c.path),d=!1,f;if(B(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)d=!0,f=c.abortReason,s=s.concat(ji(i.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=ex)d=!0,f="maxretry",s=s.concat(ji(i.serverSyncTree_,c.currentWriteId,!0));else{let m=Jp(i,c.path,o);c.currentInputSnapshot=m;let _=e[a].update(m.val());if(_!==void 0){za("transaction failed: Data returned ",_,c.path);let v=Qe(_);typeof _=="object"&&_!=null&&bn(_,".priority")||(v=v.updatePriority(m.getPriority()));let R=c.currentWriteId,U=Ga(i),q=Hp(v,m,U);c.currentOutputSnapshotRaw=v,c.currentOutputSnapshotResolved=q,c.currentWriteId=Au(i),o.splice(o.indexOf(R),1),s=s.concat(zp(i.serverSyncTree_,c.path,q,c.currentWriteId,c.applyLocally)),s=s.concat(ji(i.serverSyncTree_,R,!0))}else d=!0,f="nodata",s=s.concat(ji(i.serverSyncTree_,c.currentWriteId,!0))}an(i.eventQueue_,t,s),s=[],d&&(e[a].status=2,function(m){setTimeout(m,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(f==="nodata"?n.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):n.push(()=>e[a].onComplete(new Error(f),!1,null))))}xu(i,i.transactionQueueTree_);for(let a=0;a<n.length;a++)Gr(n[a]);Ru(i,i.transactionQueueTree_)}function GE(i,e){let t,n=i.transactionQueueTree_;for(t=pe(e);t!==null&&Vs(n)===void 0;)n=Iu(n,t),e=Oe(e),t=pe(e);return n}function WE(i,e){let t=[];return HE(i,e,t),t.sort((n,s)=>n.order-s.order),t}function HE(i,e,t){let n=Vs(e);if(n)for(let s=0;s<n.length;s++)t.push(n[s]);Cu(e,s=>{HE(i,s,t)})}function xu(i,e){let t=Vs(e);if(t){let n=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[n]=t[s],n++);t.length=n,Qp(e,t.length>0?t:void 0)}Cu(e,n=>{xu(i,n)})}function Zp(i,e){let t=qa(GE(i,e)),n=Iu(i.transactionQueueTree_,e);return HR(n,s=>{Tf(i,s)}),Tf(i,n),ME(n,s=>{Tf(i,s)}),t}function Tf(i,e){let t=Vs(e);if(t){let n=[],s=[],r=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(B(r===o-1,"All SENT items should be at beginning of queue."),r=o,t[o].status=3,t[o].abortReason="set"):(B(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),s=s.concat(ji(i.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&n.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?Qp(e,void 0):t.length=r+1,an(i.eventQueue_,qa(e),s);for(let o=0;o<n.length;o++)Gr(n[o])}}function px(i){let e="",t=i.split("/");for(let n=0;n<t.length;n++)if(t[n].length>0){let s=t[n];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function mx(i){let e={};i.charAt(0)==="?"&&(i=i.substring(1));for(let t of i.split("&")){if(t.length===0)continue;let n=t.split("=");n.length===2?e[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):Mt(`Invalid query segment '${t}' in query '${i}'`)}return e}var pp=function(i,e){let t=gx(i),n=t.namespace;t.domain==="firebase.com"&&Yn(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!n||n==="undefined")&&t.domain!=="localhost"&&Yn("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||HS();let s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new Wc(t.host,t.secure,n,s,e,"",n!==t.subdomain),path:new Pe(t.pathString)}},gx=function(i){let e="",t="",n="",s="",r="",o=!0,a="https",c=443;if(typeof i=="string"){let u=i.indexOf("//");u>=0&&(a=i.substring(0,u-1),i=i.substring(u+2));let d=i.indexOf("/");d===-1&&(d=i.length);let f=i.indexOf("?");f===-1&&(f=i.length),e=i.substring(0,Math.min(d,f)),d<f&&(s=px(i.substring(d,f)));let m=mx(i.substring(Math.min(i.length,f)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",c=parseInt(e.substring(u+1),10)):u=e.length;let _=e.slice(0,u);if(_.toLowerCase()==="localhost")t="localhost";else if(_.split(".").length<=2)t=_;else{let v=e.indexOf(".");n=e.substring(0,v).toLowerCase(),t=e.substring(v+1),r=n}"ns"in m&&(r=m.ns)}return{host:e,port:c,domain:t,subdomain:n,secure:o,scheme:a,pathString:s,namespace:r}};var Uw="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",_x=function(){let i=0,e=[];return function(t){let n=t===i;i=t;let s,r=new Array(8);for(s=7;s>=0;s--)r[s]=Uw.charAt(t%64),t=Math.floor(t/64);B(t===0,"Cannot push at time == 0");let o=r.join("");if(n){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=Uw.charAt(e[s]);return B(o.length===20,"nextPushId: Length should be 20."),o}}();var uu=class{constructor(e,t,n,s){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=s}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+ct(this.snapshot.exportVal())}},hu=class{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var Ma=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return B(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var du=class{constructor(e,t){this._repo=e,this._path=t}cancel(){let e=new jt;return ox(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){on("OnDisconnect.remove",this._path);let e=new jt;return Bw(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){on("OnDisconnect.set",this._path),Jn("OnDisconnect.set",e,this._path,!1);let t=new jt;return Bw(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){on("OnDisconnect.setWithPriority",this._path),Jn("OnDisconnect.setWithPriority",e,this._path,!1),$p("OnDisconnect.setWithPriority",t,!1);let n=new jt;return ax(this._repo,this._path,e,t,n.wrapCallback(()=>{})),n.promise}update(e){on("OnDisconnect.update",this._path),LE("OnDisconnect.update",e,this._path,!1);let t=new jt;return lx(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};var Ht=class i{constructor(e,t,n,s){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=s}get key(){return me(this._path)?null:Dp(this._path)}get ref(){return new ln(this._repo,this._path)}get _queryIdentifier(){let e=Sw(this._queryParams),t=xp(e);return t==="{}"?"default":t}get _queryObject(){return Sw(this._queryParams)}isEqual(e){if(e=ve(e),!(e instanceof i))return!1;let t=this._repo===e._repo,n=Np(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&n&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+CA(this._path)}};function Pu(i,e){if(i._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function Xi(i){let e=null,t=null;if(i.hasStart()&&(e=i.getIndexStartValue()),i.hasEnd()&&(t=i.getIndexEndValue()),i.getIndex()===$n){let n="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",s="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(i.hasStart()){if(i.getIndexStartName()!==Hi)throw new Error(n);if(typeof e!="string")throw new Error(s)}if(i.hasEnd()){if(i.getIndexEndName()!==wi)throw new Error(n);if(typeof t!="string")throw new Error(s)}}else if(i.getIndex()===Fe){if(e!=null&&!Oa(e)||t!=null&&!Oa(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(B(i.getIndex()instanceof ba||i.getIndex()===Mp,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Du(i){if(i.hasStart()&&i.hasEnd()&&i.hasLimit()&&!i.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var ln=class i extends Ht{constructor(e,t){super(e,t,new xa,!1)}get parent(){let e=cE(this._path);return e===null?null:new i(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},jr=class i{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new Pe(e),n=Yi(this.ref,e);return new i(this._node.getChild(t),n,Fe)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(n,s)=>e(new i(s,Yi(this.ref,n),Fe)))}hasChild(e){let t=new Pe(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function em(i,e){return i=ve(i),i._checkNotDeleted("ref"),e!==void 0?Yi(i._root,e):i._root}function tm(i,e){i=ve(i),i._checkNotDeleted("refFromURL");let t=pp(e,i._repo.repoInfo_.nodeAdmin);VE("refFromURL",t);let n=t.repoInfo;return!i._repo.repoInfo_.isCustomHost()&&n.host!==i._repo.repoInfo_.host&&Yn("refFromURL: Host name does not match the current database: (found "+n.host+" but expected "+i._repo.repoInfo_.host+")"),em(i,t.path.toString())}function Yi(i,e){return i=ve(i),pe(i._path)===null?JR("child","path",e,!1):Kr("child","path",e,!1),new ln(i._repo,We(i._path,e))}function KE(i,e){i=ve(i),on("push",i._path),Jn("push",e,i._path,!0);let t=zE(i._repo),n=_x(t),s=Yi(i,n),r=Yi(i,n),o;return e!=null?o=Nu(r,e).then(()=>r):o=Promise.resolve(r),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function QE(i){return on("remove",i._path),Nu(i,null)}function Nu(i,e){i=ve(i),on("set",i._path),Jn("set",e,i._path,!1);let t=new jt;return Xp(i._repo,i._path,e,null,t.wrapCallback(()=>{})),t.promise}function $E(i,e){i=ve(i),on("setPriority",i._path),$p("setPriority",e,!1);let t=new jt;return Xp(i._repo,We(i._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function YE(i,e,t){if(on("setWithPriority",i._path),Jn("setWithPriority",e,i._path,!1),$p("setWithPriority",t,!1),i.key===".length"||i.key===".keys")throw"setWithPriority failed: "+i.key+" is a read-only object.";let n=new jt;return Xp(i._repo,i._path,e,t,n.wrapCallback(()=>{})),n.promise}function XE(i,e){LE("update",e,i._path,!1);let t=new jt;return sx(i._repo,i._path,e,t.wrapCallback(()=>{})),t.promise}function JE(i){i=ve(i);let e=new Ma(()=>{}),t=new Fa(e);return ix(i._repo,i,t).then(n=>new jr(n,new ln(i._repo,i._path),i._queryParams.getIndex()))}var Fa=class i{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let n=t._queryParams.getIndex();return new uu("value",this,new jr(e.snapshotNode,new ln(t._repo,t._path),n))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new hu(this,e,t):null}matches(e){return e instanceof i?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},fu=class i{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new hu(this,e,t):null}createEvent(e,t){B(e.childName!=null,"Child events should have a childName.");let n=Yi(new ln(t._repo,t._path),e.childName),s=t._queryParams.getIndex();return new uu(e.type,this,new jr(e.snapshotNode,n,s),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof i?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function Wa(i,e,t,n,s){let r;if(typeof n=="object"&&(r=void 0,s=n),typeof n=="function"&&(r=n),s&&s.onlyOnce){let c=t,u=(d,f)=>{fp(i._repo,i,a),c(d,f)};u.userCallback=t.userCallback,u.context=t.context,t=u}let o=new Ma(t,r||void 0),a=e==="value"?new Fa(o):new fu(e,o);return cx(i._repo,i,a),()=>fp(i._repo,i,a)}function ku(i,e,t,n){return Wa(i,"value",e,t,n)}function nm(i,e,t,n){return Wa(i,"child_added",e,t,n)}function im(i,e,t,n){return Wa(i,"child_changed",e,t,n)}function sm(i,e,t,n){return Wa(i,"child_moved",e,t,n)}function rm(i,e,t,n){return Wa(i,"child_removed",e,t,n)}function om(i,e,t){let n=null,s=t?new Ma(t):null;e==="value"?n=new Fa(s):e&&(n=new fu(e,s)),fp(i._repo,i,n)}var cn=class{},pu=class extends cn{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){Jn("endAt",this._value,e._path,!0);let t=Gf(e._queryParams,this._value,this._key);if(Du(t),Xi(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Ht(e._repo,e._path,t,e._orderByCalled)}};function ZE(i,e){return ja("endAt","key",e,!0),new pu(i,e)}var mp=class extends cn{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){Jn("endBefore",this._value,e._path,!1);let t=jA(e._queryParams,this._value,this._key);if(Du(t),Xi(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Ht(e._repo,e._path,t,e._orderByCalled)}};function eT(i,e){return ja("endBefore","key",e,!0),new mp(i,e)}var mu=class extends cn{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){Jn("startAt",this._value,e._path,!0);let t=jf(e._queryParams,this._value,this._key);if(Du(t),Xi(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Ht(e._repo,e._path,t,e._orderByCalled)}};function tT(i=null,e){return ja("startAt","key",e,!0),new mu(i,e)}var gp=class extends cn{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){Jn("startAfter",this._value,e._path,!1);let t=zA(e._queryParams,this._value,this._key);if(Du(t),Xi(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Ht(e._repo,e._path,t,e._orderByCalled)}};function nT(i,e){return ja("startAfter","key",e,!0),new gp(i,e)}var _p=class extends cn{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Ht(e._repo,e._path,UA(e._queryParams,this._limit),e._orderByCalled)}};function iT(i){if(typeof i!="number"||Math.floor(i)!==i||i<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new _p(i)}var yp=class extends cn{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Ht(e._repo,e._path,qA(e._queryParams,this._limit),e._orderByCalled)}};function sT(i){if(typeof i!="number"||Math.floor(i)!==i||i<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new yp(i)}var vp=class extends cn{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){Pu(e,"orderByChild");let t=new Pe(this._path);if(me(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let n=new ba(t),s=_u(e._queryParams,n);return Xi(s),new Ht(e._repo,e._path,s,!0)}};function rT(i){if(i==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(i==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(i==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Kr("orderByChild","path",i,!1),new vp(i)}var wp=class extends cn{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){Pu(e,"orderByKey");let t=_u(e._queryParams,$n);return Xi(t),new Ht(e._repo,e._path,t,!0)}};function oT(){return new wp}var Ep=class extends cn{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){Pu(e,"orderByPriority");let t=_u(e._queryParams,Fe);return Xi(t),new Ht(e._repo,e._path,t,!0)}};function aT(){return new Ep}var Tp=class extends cn{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){Pu(e,"orderByValue");let t=_u(e._queryParams,Mp);return Xi(t),new Ht(e._repo,e._path,t,!0)}};function lT(){return new Tp}var Ip=class extends cn{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(Jn("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new pu(this._value,this._key)._apply(new mu(this._value,this._key)._apply(e))}};function cT(i,e){return ja("equalTo","key",e,!0),new Ip(i,e)}function xn(i,...e){let t=ve(i);for(let n of e)t=n._apply(t);return t}CR(ln);xR(ln);var yx="FIREBASE_DATABASE_EMULATOR_HOST",Cp={},vx=!1;function wx(i,e,t,n){i.repoInfo_=new Wc(`${e}:${t}`,!1,i.repoInfo_.namespace,i.repoInfo_.webSocketOnly,i.repoInfo_.nodeAdmin,i.repoInfo_.persistenceKey,i.repoInfo_.includeNamespaceInQueryParams,!0),n&&(i.authTokenProvider_=n)}function am(i,e,t,n,s){let r=n||i.options.databaseURL;r===void 0&&(i.options.projectId||Yn("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Et("Using default host for project ",i.options.projectId),r=`${i.options.projectId}-default-rtdb.firebaseio.com`);let o=pp(r,s),a=o.repoInfo,c,u;typeof process<"u"&&process.env&&(u=process.env[yx]),u?(c=!0,r=`http://${u}?ns=${a.namespace}`,o=pp(r,s),a=o.repoInfo):c=!o.repoInfo.secure;let d=s&&c?new va(va.OWNER):new Rf(i.name,i.options,e);VE("Invalid Firebase Database URL",o),me(o.path)||Yn("Database URL must point to the root of a Firebase Database (not including a child path).");let f=Tx(a,i,d,new Af(i.name,t));return new bp(f,i)}function Ex(i,e){let t=Cp[e];(!t||t[i.key]!==i)&&Yn(`Database ${e}(${i.repoInfo_}) has already been deleted.`),jE(i),delete t[i.key]}function Tx(i,e,t,n){let s=Cp[e.name];s||(s={},Cp[e.name]=s);let r=s[i.toURLString()];return r&&Yn("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new dp(i,vx,t,n),s[i.toURLString()]=r,r}var bp=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(tx(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new ln(this._repo,xe())),this._rootInternal}_delete(){return this._rootInternal!==null&&(Ex(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Yn("Cannot call "+e+" on a deleted database.")}};function uT(){lE.IS_TRANSPORT_INITIALIZED&&Mt("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function hT(){uT(),Ia.forceDisallow()}function dT(){uT(),kr.forceDisallow(),Ia.forceAllow()}function fT(i,e,t,n={}){i=ve(i),i._checkNotDeleted("useEmulator"),i._instanceStarted&&Yn("Cannot call useEmulator() after instance has already been initialized.");let s=i._repoInternal,r;if(s.repoInfo_.nodeAdmin)n.mockUserToken&&Yn('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new va(va.OWNER);else if(n.mockUserToken){let o=typeof n.mockUserToken=="string"?n.mockUserToken:Ec(n.mockUserToken,i.app.options.projectId);r=new va(o)}wx(s,e,t,r)}function pT(i){i=ve(i),i._checkNotDeleted("goOffline"),jE(i._repo)}function mT(i){i=ve(i),i._checkNotDeleted("goOnline"),ux(i._repo)}function gT(i,e){Gw(i,e)}function Ix(i){Rp(Sc),bc(new Kn("database",(e,{instanceIdentifier:t})=>{let n=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return am(n,s,r,t)},"PUBLIC").setMultipleInstances(!0)),Dr(cw,uw,i),Dr(cw,uw,"esm2017")}var Cx={".sv":"timestamp"};function _T(){return Cx}function yT(i){return{".sv":{increment:i}}}var Sp=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function vT(i,e,t){var n;if(i=ve(i),on("Reference.transaction",i._path),i.key===".length"||i.key===".keys")throw"Reference.transaction failed: "+i.key+" is a read-only object.";let s=(n=t?.applyLocally)!==null&&n!==void 0?n:!0,r=new jt,o=(c,u,d)=>{let f=null;c?r.reject(c):(f=new jr(d,new ln(i._repo,i._path),Fe),r.resolve(new Sp(u,f)))},a=ku(i,()=>{});return hx(i._repo,i._path,e,o,a,s),r.promise}kp.prototype.simpleListen=function(i,e){this.sendRequest("q",{p:i},e)};kp.prototype.echo=function(i,e){this.sendRequest("echo",{d:i},e)};Ix();var bx="@firebase/database-compat",Sx="1.0.8";var Ax=new Pr("@firebase/database-compat"),wT=function(i){let e="FIREBASE WARNING: "+i;Ax.warn(e)};var Rx=function(i,e,t,n){if(!(n&&t===void 0)&&typeof t!="boolean")throw new Error(en(i,e)+"must be a boolean.")},xx=function(i,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(en(i,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var lm=class{constructor(e){this._delegate=e}cancel(e){re("OnDisconnect.cancel",0,1,arguments.length),_t("OnDisconnect.cancel","onComplete",e,!0);let t=this._delegate.cancel();return e&&t.then(()=>e(null),n=>e(n)),t}remove(e){re("OnDisconnect.remove",0,1,arguments.length),_t("OnDisconnect.remove","onComplete",e,!0);let t=this._delegate.remove();return e&&t.then(()=>e(null),n=>e(n)),t}set(e,t){re("OnDisconnect.set",1,2,arguments.length),_t("OnDisconnect.set","onComplete",t,!0);let n=this._delegate.set(e);return t&&n.then(()=>t(null),s=>t(s)),n}setWithPriority(e,t,n){re("OnDisconnect.setWithPriority",2,3,arguments.length),_t("OnDisconnect.setWithPriority","onComplete",n,!0);let s=this._delegate.setWithPriority(e,t);return n&&s.then(()=>n(null),r=>n(r)),s}update(e,t){if(re("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let s={};for(let r=0;r<e.length;++r)s[""+r]=e[r];e=s,wT("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}_t("OnDisconnect.update","onComplete",t,!0);let n=this._delegate.update(e);return t&&n.then(()=>t(null),s=>t(s)),n}};var cm=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return re("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}};var Bs=class i{constructor(e,t){this._database=e,this._delegate=t}val(){return re("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return re("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return re("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return re("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return re("DataSnapshot.child",0,1,arguments.length),e=String(e),Kr("DataSnapshot.child","path",e,!1),new i(this._database,this._delegate.child(e))}hasChild(e){return re("DataSnapshot.hasChild",1,1,arguments.length),Kr("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return re("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return re("DataSnapshot.forEach",1,1,arguments.length),_t("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new i(this._database,t)))}hasChildren(){return re("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return re("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return re("DataSnapshot.ref",0,0,arguments.length),new Ei(this._database,this._delegate.ref)}get ref(){return this.getRef()}},Ou=class i{constructor(e,t){this.database=e,this._delegate=t}on(e,t,n,s){var r;re("Query.on",2,4,arguments.length),_t("Query.on","callback",t,!1);let o=i.getCancelAndContextArgs_("Query.on",n,s),a=(u,d)=>{t.call(o.context,new Bs(this.database,u),d)};a.userCallback=t,a.context=o.context;let c=(r=o.cancel)===null||r===void 0?void 0:r.bind(o.context);switch(e){case"value":return ku(this._delegate,a,c),t;case"child_added":return nm(this._delegate,a,c),t;case"child_removed":return rm(this._delegate,a,c),t;case"child_changed":return im(this._delegate,a,c),t;case"child_moved":return sm(this._delegate,a,c),t;default:throw new Error(en("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,n){if(re("Query.off",0,3,arguments.length),xx("Query.off",e,!0),_t("Query.off","callback",t,!0),df("Query.off","context",n,!0),t){let s=()=>{};s.userCallback=t,s.context=n,om(this._delegate,e,s)}else om(this._delegate,e)}get(){return JE(this._delegate).then(e=>new Bs(this.database,e))}once(e,t,n,s){re("Query.once",1,4,arguments.length),_t("Query.once","callback",t,!0);let r=i.getCancelAndContextArgs_("Query.once",n,s),o=new jt,a=(u,d)=>{let f=new Bs(this.database,u);t&&t.call(r.context,f,d),o.resolve(f)};a.userCallback=t,a.context=r.context;let c=u=>{r.cancel&&r.cancel.call(r.context,u),o.reject(u)};switch(e){case"value":ku(this._delegate,a,c,{onlyOnce:!0});break;case"child_added":nm(this._delegate,a,c,{onlyOnce:!0});break;case"child_removed":rm(this._delegate,a,c,{onlyOnce:!0});break;case"child_changed":im(this._delegate,a,c,{onlyOnce:!0});break;case"child_moved":sm(this._delegate,a,c,{onlyOnce:!0});break;default:throw new Error(en("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return re("Query.limitToFirst",1,1,arguments.length),new i(this.database,xn(this._delegate,iT(e)))}limitToLast(e){return re("Query.limitToLast",1,1,arguments.length),new i(this.database,xn(this._delegate,sT(e)))}orderByChild(e){return re("Query.orderByChild",1,1,arguments.length),new i(this.database,xn(this._delegate,rT(e)))}orderByKey(){return re("Query.orderByKey",0,0,arguments.length),new i(this.database,xn(this._delegate,oT()))}orderByPriority(){return re("Query.orderByPriority",0,0,arguments.length),new i(this.database,xn(this._delegate,aT()))}orderByValue(){return re("Query.orderByValue",0,0,arguments.length),new i(this.database,xn(this._delegate,lT()))}startAt(e=null,t){return re("Query.startAt",0,2,arguments.length),new i(this.database,xn(this._delegate,tT(e,t)))}startAfter(e=null,t){return re("Query.startAfter",0,2,arguments.length),new i(this.database,xn(this._delegate,nT(e,t)))}endAt(e=null,t){return re("Query.endAt",0,2,arguments.length),new i(this.database,xn(this._delegate,ZE(e,t)))}endBefore(e=null,t){return re("Query.endBefore",0,2,arguments.length),new i(this.database,xn(this._delegate,eT(e,t)))}equalTo(e,t){return re("Query.equalTo",1,2,arguments.length),new i(this.database,xn(this._delegate,cT(e,t)))}toString(){return re("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return re("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(re("Query.isEqual",1,1,arguments.length),!(e instanceof i)){let t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,n){let s={cancel:void 0,context:void 0};if(t&&n)s.cancel=t,_t(e,"cancel",s.cancel,!0),s.context=n,df(e,"context",s.context,!0);else if(t)if(typeof t=="object"&&t!==null)s.context=t;else if(typeof t=="function")s.cancel=t;else throw new Error(en(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return s}get ref(){return new Ei(this.database,new ln(this._delegate._repo,this._delegate._path))}},Ei=class i extends Ou{constructor(e,t){super(e,new Ht(t._repo,t._path,new xa,!1)),this.database=e,this._delegate=t}getKey(){return re("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return re("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new i(this.database,Yi(this._delegate,e))}getParent(){re("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new i(this.database,e):null}getRoot(){return re("Reference.root",0,0,arguments.length),new i(this.database,this._delegate.root)}set(e,t){re("Reference.set",1,2,arguments.length),_t("Reference.set","onComplete",t,!0);let n=Nu(this._delegate,e);return t&&n.then(()=>t(null),s=>t(s)),n}update(e,t){if(re("Reference.update",1,2,arguments.length),Array.isArray(e)){let s={};for(let r=0;r<e.length;++r)s[""+r]=e[r];e=s,wT("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}on("Reference.update",this._delegate._path),_t("Reference.update","onComplete",t,!0);let n=XE(this._delegate,e);return t&&n.then(()=>t(null),s=>t(s)),n}setWithPriority(e,t,n){re("Reference.setWithPriority",2,3,arguments.length),_t("Reference.setWithPriority","onComplete",n,!0);let s=YE(this._delegate,e,t);return n&&s.then(()=>n(null),r=>n(r)),s}remove(e){re("Reference.remove",0,1,arguments.length),_t("Reference.remove","onComplete",e,!0);let t=QE(this._delegate);return e&&t.then(()=>e(null),n=>e(n)),t}transaction(e,t,n){re("Reference.transaction",1,3,arguments.length),_t("Reference.transaction","transactionUpdate",e,!1),_t("Reference.transaction","onComplete",t,!0),Rx("Reference.transaction","applyLocally",n,!0);let s=vT(this._delegate,e,{applyLocally:n}).then(r=>new cm(r.committed,new Bs(this.database,r.snapshot)));return t&&s.then(r=>t(null,r.committed,r.snapshot),r=>t(r,!1,null)),s}setPriority(e,t){re("Reference.setPriority",1,2,arguments.length),_t("Reference.setPriority","onComplete",t,!0);let n=$E(this._delegate,e);return t&&n.then(()=>t(null),s=>t(s)),n}push(e,t){re("Reference.push",0,2,arguments.length),_t("Reference.push","onComplete",t,!0);let n=KE(this._delegate,e),s=n.then(o=>new i(this.database,o));t&&s.then(()=>t(null),o=>t(o));let r=new i(this.database,n);return r.then=s.then.bind(s),r.catch=s.catch.bind(s,void 0),r}onDisconnect(){return on("Reference.onDisconnect",this._delegate._path),new lm(new du(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};var Us=class{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:hT,forceLongPolling:dT}}useEmulator(e,t,n={}){fT(this._delegate,e,t,n)}ref(e){if(re("database.ref",0,1,arguments.length),e instanceof Ei){let t=tm(this._delegate,e.toString());return new Ei(this,t)}else{let t=em(this._delegate,e);return new Ei(this,t)}}refFromURL(e){re("database.refFromURL",1,1,arguments.length);let n=tm(this._delegate,e);return new Ei(this,n)}goOffline(){return re("database.goOffline",0,0,arguments.length),pT(this._delegate)}goOnline(){return re("database.goOnline",0,0,arguments.length),mT(this._delegate)}};Us.ServerValue={TIMESTAMP:_T(),increment:i=>yT(i)};function Px({app:i,url:e,version:t,customAuthImpl:n,customAppCheckImpl:s,namespace:r,nodeAdmin:o=!1}){Rp(t);let a=new ff("database-standalone"),c=new Cc("auth-internal",a);c.setComponent(new Kn("auth-internal",()=>n,"PRIVATE"));let u;return s&&(u=new Cc("app-check-internal",a),u.setComponent(new Kn("app-check-internal",()=>s,"PRIVATE"))),{instance:new Us(am(i,c,u,e,o),i),namespace:r}}var Dx=Object.freeze({__proto__:null,initStandalone:Px});var Nx=Us.ServerValue;function kx(i){i.INTERNAL.registerComponent(new Kn("database-compat",(e,{instanceIdentifier:t})=>{let n=e.getProvider("app-compat").getImmediate(),s=e.getProvider("database").getImmediate({identifier:t});return new Us(s,n)},"PUBLIC").setServiceProps({Reference:Ei,Query:Ou,Database:Us,DataSnapshot:Bs,enableLogging:gT,INTERNAL:Dx,ServerValue:Nx}).setMultipleInstances(!0)),i.registerVersion(bx,Sx)}kx(zi);function Ha(i,e,t="on",n=rc){return new sc(s=>{let r=null;return r=i[t](e,(o,a)=>{n.schedule(()=>{s.next({snapshot:o,prevKey:a})}),t==="once"&&n.schedule(()=>s.complete())},o=>{n.schedule(()=>s.error(o))}),t==="on"?{unsubscribe(){r!=null&&i.off(e,r)}}:{unsubscribe(){}}}).pipe(at(s=>{let{snapshot:r,prevKey:o}=s,a=null;return r.exists()&&(a=r.key),{type:e,payload:r,prevKey:o,key:a}}),hv())}function Lx(i){return typeof i=="string"}function Vx(i){return typeof i.exportVal=="function"}function bT(i){return i==null}function ST(i){return typeof i.set=="function"}function ET(i,e){return ST(e)?e:i.ref(e)}function AT(i,e){if(Lx(i))return e.stringCase();if(ST(i))return e.firebaseCase();if(Vx(i))return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof i}`)}function RT(i){return(bT(i)||i.length===0)&&(i=["child_added","child_removed","child_changed","child_moved"]),i}function xT(i,e,t){e=RT(e);let n=e.map(s=>Ha(i,s,"on",t));return rf(...n)}function Bx(i,e,t){let n=xT(i,e).pipe(bs((s,r)=>[...s,r],[]));return qx(i,n,t)}function Ux(i,e){return Ha(i,"value","on",e).pipe(at(t=>{let n;return t.payload.forEach(s=>(n=s.key,!1)),{data:t,lastKeyToLoad:n}}))}function qx(i,e,t){return Ux(i,t).pipe(pv(e),at(([s,r])=>{let o=s.lastKeyToLoad,a=r.map(c=>c.key);return{actions:r,lastKeyToLoad:o,loadedKeys:a}}),dv(s=>s.loadedKeys.indexOf(s.lastKeyToLoad)===-1),at(s=>s.actions))}function TT(i,e){return function(n,s){return AT(n,{stringCase:()=>i.child(n)[e](s),firebaseCase:()=>n[e](s),snapshotCase:()=>n.ref[e](s)})}}function zx(i){return function(t){return t?AT(t,{stringCase:()=>i.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):i.remove()}}function jx(i,e,t){return Ha(i,"value","once",t).pipe(fv(n=>{let s=[aa(n)];return e.forEach(r=>s.push(Ha(i,r,"on",t))),rf(...s).pipe(bs(Wx,[]))}),oc())}function PT(i,e){let t=i.length;for(let n=0;n<t;n++)if(i[n].payload.key===e)return n;return-1}function Gx(i,e){if(bT(e))return 0;{let t=PT(i,e);return t===-1?i.length:t+1}}function Wx(i,e){let{payload:t,prevKey:n,key:s}=e,r=PT(i,s),o=Gx(i,n);switch(e.type){case"value":if(e.payload?.exists()){let a=null;e.payload.forEach(c=>{let u={payload:c,type:"value",prevKey:a,key:c.key};return a=c.key,i=[...i,u],!1})}return i;case"child_added":if(r>-1)(i[r-1]?.key||null)!==n&&(i=i.filter(c=>c.payload.key!==t.key),i.splice(o,0,e));else{if(n==null)return[e,...i];i=i.slice(),i.splice(o,0,e)}return i;case"child_removed":return i.filter(a=>a.payload.key!==t.key);case"child_changed":return i.map(a=>a.payload.key===s?e:a);case"child_moved":if(r>-1){let a=i.splice(r,1)[0];return i=i.slice(),i.splice(o,0,a),i}return i;default:return i}}function IT(i,e,t){return e=RT(e),jx(i,e,t)}function Hx(i,e){let t=e.schedulers.outsideAngular,n=e.schedulers.ngZone.run(()=>i.ref);return{query:i,update:TT(n,"update"),set:TT(n,"set"),push:s=>n.push(s),remove:zx(n),snapshotChanges(s){return IT(i,s,t).pipe(yt)},stateChanges(s){return xT(i,s,t).pipe(yt)},auditTrail(s){return Bx(i,s,t).pipe(yt)},valueChanges(s,r){return IT(i,s,t).pipe(at(a=>a.map(c=>r&&r.idField?sn(Ce({},c.payload.val()),{[r.idField]:c.key}):c.payload.val())),yt)}}}function CT(i,e){return function(){return Ha(i,"value","on",e)}}function Kx(i,e){return{query:i,snapshotChanges(){return CT(i,e.schedulers.outsideAngular)().pipe(yt)},update(t){return i.ref.update(t)},set(t){return i.ref.set(t)},remove(){return i.ref.remove()},valueChanges(){return CT(i,e.schedulers.outsideAngular)().pipe(yt,at(n=>n.payload.exists()?n.payload.val():null))}}}var Qx=new Wn("angularfire2.realtimeDatabaseURL"),$x=new Wn("angularfire2.database.use-emulator"),Yx=(()=>{class i{schedulers;database;constructor(t,n,s,r,o,a,c,u,d,f,m,_,v,C,R){this.schedulers=a;let U=c,q=Nc(t,o,n);u&&Uc(q,o,d,m,_,v,f,C),this.database=kc(`${q.name}.database.${s}`,"AngularFireDatabase",q.name,()=>{let z=o.runOutsideAngular(()=>q.database(s||void 0));return U&&z.useEmulator(...U),z},[U])}list(t,n){let s=this.schedulers.ngZone.runOutsideAngular(()=>ET(this.database,t)),r=s;return n&&(r=n(s)),Hx(r,this)}object(t){let n=this.schedulers.ngZone.runOutsideAngular(()=>ET(this.database,t));return Kx(n,this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}static \u0275fac=function(n){return new(n||i)(ne(Pc),ne(Dc,8),ne(Qx,8),ne(_n),ne(zt),ne(xc),ne($x,8),ne(qc,8),ne(Oc,8),ne(Mc,8),ne(Fc,8),ne(Lc,8),ne(Vc,8),ne(Bc,8),ne(Rc,8))};static \u0275prov=pt({token:i,factory:i.\u0275fac,providedIn:"any"})}return i})(),DT=(()=>{class i{constructor(){zi.registerVersion("angularfire",Ac.full,"rtdb-compat")}static \u0275fac=function(n){return new(n||i)};static \u0275mod=gt({type:i});static \u0275inj=mt({providers:[Yx]})}return i})();var NT=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},kT={};var Ji,um;(function(){var i;function e(T,y){function E(){}E.prototype=y.prototype,T.D=y.prototype,T.prototype=new E,T.prototype.constructor=T,T.C=function(I,b,A){for(var w=Array(arguments.length-2),pn=2;pn<arguments.length;pn++)w[pn-2]=arguments[pn];return y.prototype[b].apply(I,w)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(T,y,E){E||(E=0);var I=Array(16);if(typeof y=="string")for(var b=0;16>b;++b)I[b]=y.charCodeAt(E++)|y.charCodeAt(E++)<<8|y.charCodeAt(E++)<<16|y.charCodeAt(E++)<<24;else for(b=0;16>b;++b)I[b]=y[E++]|y[E++]<<8|y[E++]<<16|y[E++]<<24;y=T.g[0],E=T.g[1],b=T.g[2];var A=T.g[3],w=y+(A^E&(b^A))+I[0]+3614090360&4294967295;y=E+(w<<7&4294967295|w>>>25),w=A+(b^y&(E^b))+I[1]+3905402710&4294967295,A=y+(w<<12&4294967295|w>>>20),w=b+(E^A&(y^E))+I[2]+606105819&4294967295,b=A+(w<<17&4294967295|w>>>15),w=E+(y^b&(A^y))+I[3]+3250441966&4294967295,E=b+(w<<22&4294967295|w>>>10),w=y+(A^E&(b^A))+I[4]+4118548399&4294967295,y=E+(w<<7&4294967295|w>>>25),w=A+(b^y&(E^b))+I[5]+1200080426&4294967295,A=y+(w<<12&4294967295|w>>>20),w=b+(E^A&(y^E))+I[6]+2821735955&4294967295,b=A+(w<<17&4294967295|w>>>15),w=E+(y^b&(A^y))+I[7]+4249261313&4294967295,E=b+(w<<22&4294967295|w>>>10),w=y+(A^E&(b^A))+I[8]+1770035416&4294967295,y=E+(w<<7&4294967295|w>>>25),w=A+(b^y&(E^b))+I[9]+2336552879&4294967295,A=y+(w<<12&4294967295|w>>>20),w=b+(E^A&(y^E))+I[10]+4294925233&4294967295,b=A+(w<<17&4294967295|w>>>15),w=E+(y^b&(A^y))+I[11]+2304563134&4294967295,E=b+(w<<22&4294967295|w>>>10),w=y+(A^E&(b^A))+I[12]+1804603682&4294967295,y=E+(w<<7&4294967295|w>>>25),w=A+(b^y&(E^b))+I[13]+4254626195&4294967295,A=y+(w<<12&4294967295|w>>>20),w=b+(E^A&(y^E))+I[14]+2792965006&4294967295,b=A+(w<<17&4294967295|w>>>15),w=E+(y^b&(A^y))+I[15]+1236535329&4294967295,E=b+(w<<22&4294967295|w>>>10),w=y+(b^A&(E^b))+I[1]+4129170786&4294967295,y=E+(w<<5&4294967295|w>>>27),w=A+(E^b&(y^E))+I[6]+3225465664&4294967295,A=y+(w<<9&4294967295|w>>>23),w=b+(y^E&(A^y))+I[11]+643717713&4294967295,b=A+(w<<14&4294967295|w>>>18),w=E+(A^y&(b^A))+I[0]+3921069994&4294967295,E=b+(w<<20&4294967295|w>>>12),w=y+(b^A&(E^b))+I[5]+3593408605&4294967295,y=E+(w<<5&4294967295|w>>>27),w=A+(E^b&(y^E))+I[10]+38016083&4294967295,A=y+(w<<9&4294967295|w>>>23),w=b+(y^E&(A^y))+I[15]+3634488961&4294967295,b=A+(w<<14&4294967295|w>>>18),w=E+(A^y&(b^A))+I[4]+3889429448&4294967295,E=b+(w<<20&4294967295|w>>>12),w=y+(b^A&(E^b))+I[9]+568446438&4294967295,y=E+(w<<5&4294967295|w>>>27),w=A+(E^b&(y^E))+I[14]+3275163606&4294967295,A=y+(w<<9&4294967295|w>>>23),w=b+(y^E&(A^y))+I[3]+4107603335&4294967295,b=A+(w<<14&4294967295|w>>>18),w=E+(A^y&(b^A))+I[8]+1163531501&4294967295,E=b+(w<<20&4294967295|w>>>12),w=y+(b^A&(E^b))+I[13]+2850285829&4294967295,y=E+(w<<5&4294967295|w>>>27),w=A+(E^b&(y^E))+I[2]+4243563512&4294967295,A=y+(w<<9&4294967295|w>>>23),w=b+(y^E&(A^y))+I[7]+1735328473&4294967295,b=A+(w<<14&4294967295|w>>>18),w=E+(A^y&(b^A))+I[12]+2368359562&4294967295,E=b+(w<<20&4294967295|w>>>12),w=y+(E^b^A)+I[5]+4294588738&4294967295,y=E+(w<<4&4294967295|w>>>28),w=A+(y^E^b)+I[8]+2272392833&4294967295,A=y+(w<<11&4294967295|w>>>21),w=b+(A^y^E)+I[11]+1839030562&4294967295,b=A+(w<<16&4294967295|w>>>16),w=E+(b^A^y)+I[14]+4259657740&4294967295,E=b+(w<<23&4294967295|w>>>9),w=y+(E^b^A)+I[1]+2763975236&4294967295,y=E+(w<<4&4294967295|w>>>28),w=A+(y^E^b)+I[4]+1272893353&4294967295,A=y+(w<<11&4294967295|w>>>21),w=b+(A^y^E)+I[7]+4139469664&4294967295,b=A+(w<<16&4294967295|w>>>16),w=E+(b^A^y)+I[10]+3200236656&4294967295,E=b+(w<<23&4294967295|w>>>9),w=y+(E^b^A)+I[13]+681279174&4294967295,y=E+(w<<4&4294967295|w>>>28),w=A+(y^E^b)+I[0]+3936430074&4294967295,A=y+(w<<11&4294967295|w>>>21),w=b+(A^y^E)+I[3]+3572445317&4294967295,b=A+(w<<16&4294967295|w>>>16),w=E+(b^A^y)+I[6]+76029189&4294967295,E=b+(w<<23&4294967295|w>>>9),w=y+(E^b^A)+I[9]+3654602809&4294967295,y=E+(w<<4&4294967295|w>>>28),w=A+(y^E^b)+I[12]+3873151461&4294967295,A=y+(w<<11&4294967295|w>>>21),w=b+(A^y^E)+I[15]+530742520&4294967295,b=A+(w<<16&4294967295|w>>>16),w=E+(b^A^y)+I[2]+3299628645&4294967295,E=b+(w<<23&4294967295|w>>>9),w=y+(b^(E|~A))+I[0]+4096336452&4294967295,y=E+(w<<6&4294967295|w>>>26),w=A+(E^(y|~b))+I[7]+1126891415&4294967295,A=y+(w<<10&4294967295|w>>>22),w=b+(y^(A|~E))+I[14]+2878612391&4294967295,b=A+(w<<15&4294967295|w>>>17),w=E+(A^(b|~y))+I[5]+4237533241&4294967295,E=b+(w<<21&4294967295|w>>>11),w=y+(b^(E|~A))+I[12]+1700485571&4294967295,y=E+(w<<6&4294967295|w>>>26),w=A+(E^(y|~b))+I[3]+2399980690&4294967295,A=y+(w<<10&4294967295|w>>>22),w=b+(y^(A|~E))+I[10]+4293915773&4294967295,b=A+(w<<15&4294967295|w>>>17),w=E+(A^(b|~y))+I[1]+2240044497&4294967295,E=b+(w<<21&4294967295|w>>>11),w=y+(b^(E|~A))+I[8]+1873313359&4294967295,y=E+(w<<6&4294967295|w>>>26),w=A+(E^(y|~b))+I[15]+4264355552&4294967295,A=y+(w<<10&4294967295|w>>>22),w=b+(y^(A|~E))+I[6]+2734768916&4294967295,b=A+(w<<15&4294967295|w>>>17),w=E+(A^(b|~y))+I[13]+1309151649&4294967295,E=b+(w<<21&4294967295|w>>>11),w=y+(b^(E|~A))+I[4]+4149444226&4294967295,y=E+(w<<6&4294967295|w>>>26),w=A+(E^(y|~b))+I[11]+3174756917&4294967295,A=y+(w<<10&4294967295|w>>>22),w=b+(y^(A|~E))+I[2]+718787259&4294967295,b=A+(w<<15&4294967295|w>>>17),w=E+(A^(b|~y))+I[9]+3951481745&4294967295,T.g[0]=T.g[0]+y&4294967295,T.g[1]=T.g[1]+(b+(w<<21&4294967295|w>>>11))&4294967295,T.g[2]=T.g[2]+b&4294967295,T.g[3]=T.g[3]+A&4294967295}n.prototype.u=function(T,y){y===void 0&&(y=T.length);for(var E=y-this.blockSize,I=this.B,b=this.h,A=0;A<y;){if(b==0)for(;A<=E;)s(this,T,A),A+=this.blockSize;if(typeof T=="string"){for(;A<y;)if(I[b++]=T.charCodeAt(A++),b==this.blockSize){s(this,I),b=0;break}}else for(;A<y;)if(I[b++]=T[A++],b==this.blockSize){s(this,I),b=0;break}}this.h=b,this.o+=y},n.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var y=1;y<T.length-8;++y)T[y]=0;var E=8*this.o;for(y=T.length-8;y<T.length;++y)T[y]=E&255,E/=256;for(this.u(T),T=Array(16),y=E=0;4>y;++y)for(var I=0;32>I;I+=8)T[E++]=this.g[y]>>>I&255;return T};function r(T,y){var E=a;return Object.prototype.hasOwnProperty.call(E,T)?E[T]:E[T]=y(T)}function o(T,y){this.h=y;for(var E=[],I=!0,b=T.length-1;0<=b;b--){var A=T[b]|0;I&&A==y||(E[b]=A,I=!1)}this.g=E}var a={};function c(T){return-128<=T&&128>T?r(T,function(y){return new o([y|0],0>y?-1:0)}):new o([T|0],0>T?-1:0)}function u(T){if(isNaN(T)||!isFinite(T))return f;if(0>T)return R(u(-T));for(var y=[],E=1,I=0;T>=E;I++)y[I]=T/E|0,E*=4294967296;return new o(y,0)}function d(T,y){if(T.length==0)throw Error("number format error: empty string");if(y=y||10,2>y||36<y)throw Error("radix out of range: "+y);if(T.charAt(0)=="-")return R(d(T.substring(1),y));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var E=u(Math.pow(y,8)),I=f,b=0;b<T.length;b+=8){var A=Math.min(8,T.length-b),w=parseInt(T.substring(b,b+A),y);8>A?(A=u(Math.pow(y,A)),I=I.j(A).add(u(w))):(I=I.j(E),I=I.add(u(w)))}return I}var f=c(0),m=c(1),_=c(16777216);i=o.prototype,i.m=function(){if(C(this))return-R(this).m();for(var T=0,y=1,E=0;E<this.g.length;E++){var I=this.i(E);T+=(0<=I?I:4294967296+I)*y,y*=4294967296}return T},i.toString=function(T){if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(v(this))return"0";if(C(this))return"-"+R(this).toString(T);for(var y=u(Math.pow(T,6)),E=this,I="";;){var b=Y(E,y).g;E=U(E,b.j(y));var A=((0<E.g.length?E.g[0]:E.h)>>>0).toString(T);if(E=b,v(E))return A+I;for(;6>A.length;)A="0"+A;I=A+I}},i.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h};function v(T){if(T.h!=0)return!1;for(var y=0;y<T.g.length;y++)if(T.g[y]!=0)return!1;return!0}function C(T){return T.h==-1}i.l=function(T){return T=U(this,T),C(T)?-1:v(T)?0:1};function R(T){for(var y=T.g.length,E=[],I=0;I<y;I++)E[I]=~T.g[I];return new o(E,~T.h).add(m)}i.abs=function(){return C(this)?R(this):this},i.add=function(T){for(var y=Math.max(this.g.length,T.g.length),E=[],I=0,b=0;b<=y;b++){var A=I+(this.i(b)&65535)+(T.i(b)&65535),w=(A>>>16)+(this.i(b)>>>16)+(T.i(b)>>>16);I=w>>>16,A&=65535,w&=65535,E[b]=w<<16|A}return new o(E,E[E.length-1]&-2147483648?-1:0)};function U(T,y){return T.add(R(y))}i.j=function(T){if(v(this)||v(T))return f;if(C(this))return C(T)?R(this).j(R(T)):R(R(this).j(T));if(C(T))return R(this.j(R(T)));if(0>this.l(_)&&0>T.l(_))return u(this.m()*T.m());for(var y=this.g.length+T.g.length,E=[],I=0;I<2*y;I++)E[I]=0;for(I=0;I<this.g.length;I++)for(var b=0;b<T.g.length;b++){var A=this.i(I)>>>16,w=this.i(I)&65535,pn=T.i(b)>>>16,Oi=T.i(b)&65535;E[2*I+2*b]+=w*Oi,q(E,2*I+2*b),E[2*I+2*b+1]+=A*Oi,q(E,2*I+2*b+1),E[2*I+2*b+1]+=w*pn,q(E,2*I+2*b+1),E[2*I+2*b+2]+=A*pn,q(E,2*I+2*b+2)}for(I=0;I<y;I++)E[I]=E[2*I+1]<<16|E[2*I];for(I=y;I<2*y;I++)E[I]=0;return new o(E,0)};function q(T,y){for(;(T[y]&65535)!=T[y];)T[y+1]+=T[y]>>>16,T[y]&=65535,y++}function z(T,y){this.g=T,this.h=y}function Y(T,y){if(v(y))throw Error("division by zero");if(v(T))return new z(f,f);if(C(T))return y=Y(R(T),y),new z(R(y.g),R(y.h));if(C(y))return y=Y(T,R(y)),new z(R(y.g),y.h);if(30<T.g.length){if(C(T)||C(y))throw Error("slowDivide_ only works with positive integers.");for(var E=m,I=y;0>=I.l(T);)E=he(E),I=he(I);var b=ee(E,1),A=ee(I,1);for(I=ee(I,2),E=ee(E,2);!v(I);){var w=A.add(I);0>=w.l(T)&&(b=b.add(E),A=w),I=ee(I,1),E=ee(E,1)}return y=U(T,b.j(y)),new z(b,y)}for(b=f;0<=T.l(y);){for(E=Math.max(1,Math.floor(T.m()/y.m())),I=Math.ceil(Math.log(E)/Math.LN2),I=48>=I?1:Math.pow(2,I-48),A=u(E),w=A.j(y);C(w)||0<w.l(T);)E-=I,A=u(E),w=A.j(y);v(A)&&(A=m),b=b.add(A),T=U(T,w)}return new z(b,T)}i.A=function(T){return Y(this,T).h},i.and=function(T){for(var y=Math.max(this.g.length,T.g.length),E=[],I=0;I<y;I++)E[I]=this.i(I)&T.i(I);return new o(E,this.h&T.h)},i.or=function(T){for(var y=Math.max(this.g.length,T.g.length),E=[],I=0;I<y;I++)E[I]=this.i(I)|T.i(I);return new o(E,this.h|T.h)},i.xor=function(T){for(var y=Math.max(this.g.length,T.g.length),E=[],I=0;I<y;I++)E[I]=this.i(I)^T.i(I);return new o(E,this.h^T.h)};function he(T){for(var y=T.g.length+1,E=[],I=0;I<y;I++)E[I]=T.i(I)<<1|T.i(I-1)>>>31;return new o(E,T.h)}function ee(T,y){var E=y>>5;y%=32;for(var I=T.g.length-E,b=[],A=0;A<I;A++)b[A]=0<y?T.i(A+E)>>>y|T.i(A+E+1)<<32-y:T.i(A+E);return new o(b,T.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,um=kT.Md5=n,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=d,Ji=kT.Integer=o}).apply(typeof NT<"u"?NT:typeof self<"u"?self:typeof window<"u"?window:{});var Mu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ti={};var hm,Xx,$r,dm,Ka,Fu,fm,pm,mm;(function(){var i,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(l,h,p){return l==Array.prototype||l==Object.prototype||(l[h]=p.value),l};function t(l){l=[typeof globalThis=="object"&&globalThis,l,typeof window=="object"&&window,typeof self=="object"&&self,typeof Mu=="object"&&Mu];for(var h=0;h<l.length;++h){var p=l[h];if(p&&p.Math==Math)return p}throw Error("Cannot find global object")}var n=t(this);function s(l,h){if(h)e:{var p=n;l=l.split(".");for(var g=0;g<l.length-1;g++){var S=l[g];if(!(S in p))break e;p=p[S]}l=l[l.length-1],g=p[l],h=h(g),h!=g&&h!=null&&e(p,l,{configurable:!0,writable:!0,value:h})}}function r(l,h){l instanceof String&&(l+="");var p=0,g=!1,S={next:function(){if(!g&&p<l.length){var P=p++;return{value:h(P,l[P]),done:!1}}return g=!0,{done:!0,value:void 0}}};return S[Symbol.iterator]=function(){return S},S}s("Array.prototype.values",function(l){return l||function(){return r(this,function(h,p){return p})}});var o=o||{},a=this||self;function c(l){var h=typeof l;return h=h!="object"?h:l?Array.isArray(l)?"array":h:"null",h=="array"||h=="object"&&typeof l.length=="number"}function u(l){var h=typeof l;return h=="object"&&l!=null||h=="function"}function d(l,h,p){return l.call.apply(l.bind,arguments)}function f(l,h,p){if(!l)throw Error();if(2<arguments.length){var g=Array.prototype.slice.call(arguments,2);return function(){var S=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(S,g),l.apply(h,S)}}return function(){return l.apply(h,arguments)}}function m(l,h,p){return m=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:f,m.apply(null,arguments)}function _(l,h){var p=Array.prototype.slice.call(arguments,1);return function(){var g=p.slice();return g.push.apply(g,arguments),l.apply(this,g)}}function v(l,h){function p(){}p.prototype=h.prototype,l.aa=h.prototype,l.prototype=new p,l.prototype.constructor=l,l.Qb=function(g,S,P){for(var j=Array(arguments.length-2),ke=2;ke<arguments.length;ke++)j[ke-2]=arguments[ke];return h.prototype[S].apply(g,j)}}function C(l){let h=l.length;if(0<h){let p=Array(h);for(let g=0;g<h;g++)p[g]=l[g];return p}return[]}function R(l,h){for(let p=1;p<arguments.length;p++){let g=arguments[p];if(c(g)){let S=l.length||0,P=g.length||0;l.length=S+P;for(let j=0;j<P;j++)l[S+j]=g[j]}else l.push(g)}}class U{constructor(h,p){this.i=h,this.j=p,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function q(l){return/^[\s\xa0]*$/.test(l)}function z(){var l=a.navigator;return l&&(l=l.userAgent)?l:""}function Y(l){return Y[" "](l),l}Y[" "]=function(){};var he=z().indexOf("Gecko")!=-1&&!(z().toLowerCase().indexOf("webkit")!=-1&&z().indexOf("Edge")==-1)&&!(z().indexOf("Trident")!=-1||z().indexOf("MSIE")!=-1)&&z().indexOf("Edge")==-1;function ee(l,h,p){for(let g in l)h.call(p,l[g],g,l)}function T(l,h){for(let p in l)h.call(void 0,l[p],p,l)}function y(l){let h={};for(let p in l)h[p]=l[p];return h}let E="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function I(l,h){let p,g;for(let S=1;S<arguments.length;S++){g=arguments[S];for(p in g)l[p]=g[p];for(let P=0;P<E.length;P++)p=E[P],Object.prototype.hasOwnProperty.call(g,p)&&(l[p]=g[p])}}function b(l){var h=1;l=l.split(":");let p=[];for(;0<h&&l.length;)p.push(l.shift()),h--;return l.length&&p.push(l.join(":")),p}function A(l){a.setTimeout(()=>{throw l},0)}function w(){var l=_e;let h=null;return l.g&&(h=l.g,l.g=l.g.next,l.g||(l.h=null),h.next=null),h}class pn{constructor(){this.h=this.g=null}add(h,p){let g=Oi.get();g.set(h,p),this.h?this.h.next=g:this.g=g,this.h=g}}var Oi=new U(()=>new K,l=>l.reset());class K{constructor(){this.next=this.g=this.h=null}set(h,p){this.h=h,this.g=p,this.next=null}reset(){this.next=this.g=this.h=null}}let X,Z=!1,_e=new pn,tt=()=>{let l=a.Promise.resolve(void 0);X=()=>{l.then(mn)}};var mn=()=>{for(var l;l=w();){try{l.h.call(l.g)}catch(p){A(p)}var h=Oi;h.j(l),100>h.h&&(h.h++,l.next=h.g,h.g=l)}Z=!1};function Xe(){this.s=this.s,this.C=this.C}Xe.prototype.s=!1,Xe.prototype.ma=function(){this.s||(this.s=!0,this.N())},Xe.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Be(l,h){this.type=l,this.g=this.target=h,this.defaultPrevented=!1}Be.prototype.h=function(){this.defaultPrevented=!0};var Ue=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var l=!1,h=Object.defineProperty({},"passive",{get:function(){l=!0}});try{let p=()=>{};a.addEventListener("test",p,h),a.removeEventListener("test",p,h)}catch{}return l}();function Mi(l,h){if(Be.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l){var p=this.type=l.type,g=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;if(this.target=l.target||l.srcElement,this.g=h,h=l.relatedTarget){if(he){e:{try{Y(h.nodeName);var S=!0;break e}catch{}S=!1}S||(h=null)}}else p=="mouseover"?h=l.fromElement:p=="mouseout"&&(h=l.toElement);this.relatedTarget=h,g?(this.clientX=g.clientX!==void 0?g.clientX:g.pageX,this.clientY=g.clientY!==void 0?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0):(this.clientX=l.clientX!==void 0?l.clientX:l.pageX,this.clientY=l.clientY!==void 0?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType=typeof l.pointerType=="string"?l.pointerType:Nd[l.pointerType]||"",this.state=l.state,this.i=l,l.defaultPrevented&&Mi.aa.h.call(this)}}v(Mi,Be);var Nd={2:"touch",3:"pen",4:"mouse"};Mi.prototype.h=function(){Mi.aa.h.call(this);var l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var Je="closure_listenable_"+(1e6*Math.random()|0),di=0;function Xt(l,h,p,g,S){this.listener=l,this.proxy=null,this.src=h,this.type=p,this.capture=!!g,this.ha=S,this.key=++di,this.da=this.fa=!1}function fi(l){l.da=!0,l.listener=null,l.proxy=null,l.src=null,l.ha=null}function Fi(l){this.src=l,this.g={},this.h=0}Fi.prototype.add=function(l,h,p,g,S){var P=l.toString();l=this.g[P],l||(l=this.g[P]=[],this.h++);var j=Od(l,h,g,S);return-1<j?(h=l[j],p||(h.fa=!1)):(h=new Xt(h,this.src,P,!!g,S),h.fa=p,l.push(h)),h};function kd(l,h){var p=h.type;if(p in l.g){var g=l.g[p],S=Array.prototype.indexOf.call(g,h,void 0),P;(P=0<=S)&&Array.prototype.splice.call(g,S,1),P&&(fi(h),l.g[p].length==0&&(delete l.g[p],l.h--))}}function Od(l,h,p,g){for(var S=0;S<l.length;++S){var P=l[S];if(!P.da&&P.listener==h&&P.capture==!!p&&P.ha==g)return S}return-1}var Md="closure_lm_"+(1e6*Math.random()|0),Fd={};function u0(l,h,p,g,S){if(g&&g.once)return d0(l,h,p,g,S);if(Array.isArray(h)){for(var P=0;P<h.length;P++)u0(l,h[P],p,g,S);return null}return p=Ud(p),l&&l[Je]?l.K(h,p,u(g)?!!g.capture:!!g,S):h0(l,h,p,!1,g,S)}function h0(l,h,p,g,S,P){if(!h)throw Error("Invalid event type");var j=u(S)?!!S.capture:!!S,ke=Vd(l);if(ke||(l[Md]=ke=new Fi(l)),p=ke.add(h,p,g,j,P),p.proxy)return p;if(g=mS(),p.proxy=g,g.src=l,g.listener=p,l.addEventListener)Ue||(S=j),S===void 0&&(S=!1),l.addEventListener(h.toString(),g,S);else if(l.attachEvent)l.attachEvent(p0(h.toString()),g);else if(l.addListener&&l.removeListener)l.addListener(g);else throw Error("addEventListener and attachEvent are unavailable.");return p}function mS(){function l(p){return h.call(l.src,l.listener,p)}let h=gS;return l}function d0(l,h,p,g,S){if(Array.isArray(h)){for(var P=0;P<h.length;P++)d0(l,h[P],p,g,S);return null}return p=Ud(p),l&&l[Je]?l.L(h,p,u(g)?!!g.capture:!!g,S):h0(l,h,p,!0,g,S)}function f0(l,h,p,g,S){if(Array.isArray(h))for(var P=0;P<h.length;P++)f0(l,h[P],p,g,S);else g=u(g)?!!g.capture:!!g,p=Ud(p),l&&l[Je]?(l=l.i,h=String(h).toString(),h in l.g&&(P=l.g[h],p=Od(P,p,g,S),-1<p&&(fi(P[p]),Array.prototype.splice.call(P,p,1),P.length==0&&(delete l.g[h],l.h--)))):l&&(l=Vd(l))&&(h=l.g[h.toString()],l=-1,h&&(l=Od(h,p,g,S)),(p=-1<l?h[l]:null)&&Ld(p))}function Ld(l){if(typeof l!="number"&&l&&!l.da){var h=l.src;if(h&&h[Je])kd(h.i,l);else{var p=l.type,g=l.proxy;h.removeEventListener?h.removeEventListener(p,g,l.capture):h.detachEvent?h.detachEvent(p0(p),g):h.addListener&&h.removeListener&&h.removeListener(g),(p=Vd(h))?(kd(p,l),p.h==0&&(p.src=null,h[Md]=null)):fi(l)}}}function p0(l){return l in Fd?Fd[l]:Fd[l]="on"+l}function gS(l,h){if(l.da)l=!0;else{h=new Mi(h,this);var p=l.listener,g=l.ha||l.src;l.fa&&Ld(l),l=p.call(g,h)}return l}function Vd(l){return l=l[Md],l instanceof Fi?l:null}var Bd="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ud(l){return typeof l=="function"?l:(l[Bd]||(l[Bd]=function(h){return l.handleEvent(h)}),l[Bd])}function xt(){Xe.call(this),this.i=new Fi(this),this.M=this,this.F=null}v(xt,Xe),xt.prototype[Je]=!0,xt.prototype.removeEventListener=function(l,h,p,g){f0(this,l,h,p,g)};function Ut(l,h){var p,g=l.F;if(g)for(p=[];g;g=g.F)p.push(g);if(l=l.M,g=h.type||h,typeof h=="string")h=new Be(h,l);else if(h instanceof Be)h.target=h.target||l;else{var S=h;h=new Be(g,l),I(h,S)}if(S=!0,p)for(var P=p.length-1;0<=P;P--){var j=h.g=p[P];S=jl(j,g,!0,h)&&S}if(j=h.g=l,S=jl(j,g,!0,h)&&S,S=jl(j,g,!1,h)&&S,p)for(P=0;P<p.length;P++)j=h.g=p[P],S=jl(j,g,!1,h)&&S}xt.prototype.N=function(){if(xt.aa.N.call(this),this.i){var l=this.i,h;for(h in l.g){for(var p=l.g[h],g=0;g<p.length;g++)fi(p[g]);delete l.g[h],l.h--}}this.F=null},xt.prototype.K=function(l,h,p,g){return this.i.add(String(l),h,!1,p,g)},xt.prototype.L=function(l,h,p,g){return this.i.add(String(l),h,!0,p,g)};function jl(l,h,p,g){if(h=l.i.g[String(h)],!h)return!0;h=h.concat();for(var S=!0,P=0;P<h.length;++P){var j=h[P];if(j&&!j.da&&j.capture==p){var ke=j.listener,It=j.ha||j.src;j.fa&&kd(l.i,j),S=ke.call(It,g)!==!1&&S}}return S&&!g.defaultPrevented}function m0(l,h,p){if(typeof l=="function")p&&(l=m(l,p));else if(l&&typeof l.handleEvent=="function")l=m(l.handleEvent,l);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:a.setTimeout(l,h||0)}function g0(l){l.g=m0(()=>{l.g=null,l.i&&(l.i=!1,g0(l))},l.l);let h=l.h;l.h=null,l.m.apply(null,h)}class _S extends Xe{constructor(h,p){super(),this.m=h,this.l=p,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:g0(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ho(l){Xe.call(this),this.h=l,this.g={}}v(Ho,Xe);var _0=[];function y0(l){ee(l.g,function(h,p){this.g.hasOwnProperty(p)&&Ld(h)},l),l.g={}}Ho.prototype.N=function(){Ho.aa.N.call(this),y0(this)},Ho.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var qd=a.JSON.stringify,yS=a.JSON.parse,vS=class{stringify(l){return a.JSON.stringify(l,void 0)}parse(l){return a.JSON.parse(l,void 0)}};function zd(){}zd.prototype.h=null;function v0(l){return l.h||(l.h=l.i())}function w0(){}var Ko={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function jd(){Be.call(this,"d")}v(jd,Be);function Gd(){Be.call(this,"c")}v(Gd,Be);var Es={},E0=null;function Gl(){return E0=E0||new xt}Es.La="serverreachability";function T0(l){Be.call(this,Es.La,l)}v(T0,Be);function Qo(l){let h=Gl();Ut(h,new T0(h))}Es.STAT_EVENT="statevent";function I0(l,h){Be.call(this,Es.STAT_EVENT,l),this.stat=h}v(I0,Be);function qt(l){let h=Gl();Ut(h,new I0(h,l))}Es.Ma="timingevent";function C0(l,h){Be.call(this,Es.Ma,l),this.size=h}v(C0,Be);function $o(l,h){if(typeof l!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){l()},h)}function Yo(){this.g=!0}Yo.prototype.xa=function(){this.g=!1};function wS(l,h,p,g,S,P){l.info(function(){if(l.g)if(P)for(var j="",ke=P.split("&"),It=0;It<ke.length;It++){var Ae=ke[It].split("=");if(1<Ae.length){var Pt=Ae[0];Ae=Ae[1];var Dt=Pt.split("_");j=2<=Dt.length&&Dt[1]=="type"?j+(Pt+"="+Ae+"&"):j+(Pt+"=redacted&")}}else j=null;else j=P;return"XMLHTTP REQ ("+g+") [attempt "+S+"]: "+h+`
`+p+`
`+j})}function ES(l,h,p,g,S,P,j){l.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+S+"]: "+h+`
`+p+`
`+P+" "+j})}function Er(l,h,p,g){l.info(function(){return"XMLHTTP TEXT ("+h+"): "+IS(l,p)+(g?" "+g:"")})}function TS(l,h){l.info(function(){return"TIMEOUT: "+h})}Yo.prototype.info=function(){};function IS(l,h){if(!l.g)return h;if(!h)return null;try{var p=JSON.parse(h);if(p){for(l=0;l<p.length;l++)if(Array.isArray(p[l])){var g=p[l];if(!(2>g.length)){var S=g[1];if(Array.isArray(S)&&!(1>S.length)){var P=S[0];if(P!="noop"&&P!="stop"&&P!="close")for(var j=1;j<S.length;j++)S[j]=""}}}}return qd(p)}catch{return h}}var Wl={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},b0={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Wd;function Hl(){}v(Hl,zd),Hl.prototype.g=function(){return new XMLHttpRequest},Hl.prototype.i=function(){return{}},Wd=new Hl;function Li(l,h,p,g){this.j=l,this.i=h,this.l=p,this.R=g||1,this.U=new Ho(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new S0}function S0(){this.i=null,this.g="",this.h=!1}var A0={},Hd={};function Kd(l,h,p){l.L=1,l.v=Yl(pi(h)),l.m=p,l.P=!0,R0(l,null)}function R0(l,h){l.F=Date.now(),Kl(l),l.A=pi(l.v);var p=l.A,g=l.R;Array.isArray(g)||(g=[String(g)]),z0(p.i,"t",g),l.C=0,p=l.j.J,l.h=new S0,l.g=ov(l.j,p?h:null,!l.m),0<l.O&&(l.M=new _S(m(l.Y,l,l.g),l.O)),h=l.U,p=l.g,g=l.ca;var S="readystatechange";Array.isArray(S)||(S&&(_0[0]=S.toString()),S=_0);for(var P=0;P<S.length;P++){var j=u0(p,S[P],g||h.handleEvent,!1,h.h||h);if(!j)break;h.g[j.key]=j}h=l.H?y(l.H):{},l.m?(l.u||(l.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",l.g.ea(l.A,l.u,l.m,h)):(l.u="GET",l.g.ea(l.A,l.u,null,h)),Qo(),wS(l.i,l.u,l.A,l.l,l.R,l.m)}Li.prototype.ca=function(l){l=l.target;let h=this.M;h&&mi(l)==3?h.j():this.Y(l)},Li.prototype.Y=function(l){try{if(l==this.g)e:{let Dt=mi(this.g);var h=this.g.Ba();let Cr=this.g.Z();if(!(3>Dt)&&(Dt!=3||this.g&&(this.h.h||this.g.oa()||$0(this.g)))){this.J||Dt!=4||h==7||(h==8||0>=Cr?Qo(3):Qo(2)),Qd(this);var p=this.g.Z();this.X=p;t:if(x0(this)){var g=$0(this.g);l="";var S=g.length,P=mi(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ts(this),Xo(this);var j="";break t}this.h.i=new a.TextDecoder}for(h=0;h<S;h++)this.h.h=!0,l+=this.h.i.decode(g[h],{stream:!(P&&h==S-1)});g.length=0,this.h.g+=l,this.C=0,j=this.h.g}else j=this.g.oa();if(this.o=p==200,ES(this.i,this.u,this.A,this.l,this.R,Dt,p),this.o){if(this.T&&!this.K){t:{if(this.g){var ke,It=this.g;if((ke=It.g?It.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!q(ke)){var Ae=ke;break t}}Ae=null}if(p=Ae)Er(this.i,this.l,p,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,$d(this,p);else{this.o=!1,this.s=3,qt(12),Ts(this),Xo(this);break e}}if(this.P){p=!0;let On;for(;!this.J&&this.C<j.length;)if(On=CS(this,j),On==Hd){Dt==4&&(this.s=4,qt(14),p=!1),Er(this.i,this.l,null,"[Incomplete Response]");break}else if(On==A0){this.s=4,qt(15),Er(this.i,this.l,j,"[Invalid Chunk]"),p=!1;break}else Er(this.i,this.l,On,null),$d(this,On);if(x0(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Dt!=4||j.length!=0||this.h.h||(this.s=1,qt(16),p=!1),this.o=this.o&&p,!p)Er(this.i,this.l,j,"[Invalid Chunked Response]"),Ts(this),Xo(this);else if(0<j.length&&!this.W){this.W=!0;var Pt=this.j;Pt.g==this&&Pt.ba&&!Pt.M&&(Pt.j.info("Great, no buffering proxy detected. Bytes received: "+j.length),tf(Pt),Pt.M=!0,qt(11))}}else Er(this.i,this.l,j,null),$d(this,j);Dt==4&&Ts(this),this.o&&!this.J&&(Dt==4?nv(this.j,this):(this.o=!1,Kl(this)))}else qS(this.g),p==400&&0<j.indexOf("Unknown SID")?(this.s=3,qt(12)):(this.s=0,qt(13)),Ts(this),Xo(this)}}}catch{}finally{}};function x0(l){return l.g?l.u=="GET"&&l.L!=2&&l.j.Ca:!1}function CS(l,h){var p=l.C,g=h.indexOf(`
`,p);return g==-1?Hd:(p=Number(h.substring(p,g)),isNaN(p)?A0:(g+=1,g+p>h.length?Hd:(h=h.slice(g,g+p),l.C=g+p,h)))}Li.prototype.cancel=function(){this.J=!0,Ts(this)};function Kl(l){l.S=Date.now()+l.I,P0(l,l.I)}function P0(l,h){if(l.B!=null)throw Error("WatchDog timer not null");l.B=$o(m(l.ba,l),h)}function Qd(l){l.B&&(a.clearTimeout(l.B),l.B=null)}Li.prototype.ba=function(){this.B=null;let l=Date.now();0<=l-this.S?(TS(this.i,this.A),this.L!=2&&(Qo(),qt(17)),Ts(this),this.s=2,Xo(this)):P0(this,this.S-l)};function Xo(l){l.j.G==0||l.J||nv(l.j,l)}function Ts(l){Qd(l);var h=l.M;h&&typeof h.ma=="function"&&h.ma(),l.M=null,y0(l.U),l.g&&(h=l.g,l.g=null,h.abort(),h.ma())}function $d(l,h){try{var p=l.j;if(p.G!=0&&(p.g==l||Yd(p.h,l))){if(!l.K&&Yd(p.h,l)&&p.G==3){try{var g=p.Da.g.parse(h)}catch{g=null}if(Array.isArray(g)&&g.length==3){var S=g;if(S[0]==0){e:if(!p.u){if(p.g)if(p.g.F+3e3<l.F)tc(p),Zl(p);else break e;ef(p),qt(18)}}else p.za=S[1],0<p.za-p.T&&37500>S[2]&&p.F&&p.v==0&&!p.C&&(p.C=$o(m(p.Za,p),6e3));if(1>=k0(p.h)&&p.ca){try{p.ca()}catch{}p.ca=void 0}}else Cs(p,11)}else if((l.K||p.g==l)&&tc(p),!q(h))for(S=p.Da.g.parse(h),h=0;h<S.length;h++){let Ae=S[h];if(p.T=Ae[0],Ae=Ae[1],p.G==2)if(Ae[0]=="c"){p.K=Ae[1],p.ia=Ae[2];let Pt=Ae[3];Pt!=null&&(p.la=Pt,p.j.info("VER="+p.la));let Dt=Ae[4];Dt!=null&&(p.Aa=Dt,p.j.info("SVER="+p.Aa));let Cr=Ae[5];Cr!=null&&typeof Cr=="number"&&0<Cr&&(g=1.5*Cr,p.L=g,p.j.info("backChannelRequestTimeoutMs_="+g)),g=p;let On=l.g;if(On){let ic=On.g?On.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ic){var P=g.h;P.g||ic.indexOf("spdy")==-1&&ic.indexOf("quic")==-1&&ic.indexOf("h2")==-1||(P.j=P.l,P.g=new Set,P.h&&(Xd(P,P.h),P.h=null))}if(g.D){let nf=On.g?On.g.getResponseHeader("X-HTTP-Session-Id"):null;nf&&(g.ya=nf,qe(g.I,g.D,nf))}}p.G=3,p.l&&p.l.ua(),p.ba&&(p.R=Date.now()-l.F,p.j.info("Handshake RTT: "+p.R+"ms")),g=p;var j=l;if(g.qa=rv(g,g.J?g.ia:null,g.W),j.K){O0(g.h,j);var ke=j,It=g.L;It&&(ke.I=It),ke.B&&(Qd(ke),Kl(ke)),g.g=j}else ev(g);0<p.i.length&&ec(p)}else Ae[0]!="stop"&&Ae[0]!="close"||Cs(p,7);else p.G==3&&(Ae[0]=="stop"||Ae[0]=="close"?Ae[0]=="stop"?Cs(p,7):Zd(p):Ae[0]!="noop"&&p.l&&p.l.ta(Ae),p.v=0)}}Qo(4)}catch{}}var bS=class{constructor(l,h){this.g=l,this.map=h}};function D0(l){this.l=l||10,a.PerformanceNavigationTiming?(l=a.performance.getEntriesByType("navigation"),l=0<l.length&&(l[0].nextHopProtocol=="hq"||l[0].nextHopProtocol=="h2")):l=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=l?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function N0(l){return l.h?!0:l.g?l.g.size>=l.j:!1}function k0(l){return l.h?1:l.g?l.g.size:0}function Yd(l,h){return l.h?l.h==h:l.g?l.g.has(h):!1}function Xd(l,h){l.g?l.g.add(h):l.h=h}function O0(l,h){l.h&&l.h==h?l.h=null:l.g&&l.g.has(h)&&l.g.delete(h)}D0.prototype.cancel=function(){if(this.i=M0(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let l of this.g.values())l.cancel();this.g.clear()}};function M0(l){if(l.h!=null)return l.i.concat(l.h.D);if(l.g!=null&&l.g.size!==0){let h=l.i;for(let p of l.g.values())h=h.concat(p.D);return h}return C(l.i)}function SS(l){if(l.V&&typeof l.V=="function")return l.V();if(typeof Map<"u"&&l instanceof Map||typeof Set<"u"&&l instanceof Set)return Array.from(l.values());if(typeof l=="string")return l.split("");if(c(l)){for(var h=[],p=l.length,g=0;g<p;g++)h.push(l[g]);return h}h=[],p=0;for(g in l)h[p++]=l[g];return h}function AS(l){if(l.na&&typeof l.na=="function")return l.na();if(!l.V||typeof l.V!="function"){if(typeof Map<"u"&&l instanceof Map)return Array.from(l.keys());if(!(typeof Set<"u"&&l instanceof Set)){if(c(l)||typeof l=="string"){var h=[];l=l.length;for(var p=0;p<l;p++)h.push(p);return h}h=[],p=0;for(let g in l)h[p++]=g;return h}}}function F0(l,h){if(l.forEach&&typeof l.forEach=="function")l.forEach(h,void 0);else if(c(l)||typeof l=="string")Array.prototype.forEach.call(l,h,void 0);else for(var p=AS(l),g=SS(l),S=g.length,P=0;P<S;P++)h.call(void 0,g[P],p&&p[P],l)}var L0=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function RS(l,h){if(l){l=l.split("&");for(var p=0;p<l.length;p++){var g=l[p].indexOf("="),S=null;if(0<=g){var P=l[p].substring(0,g);S=l[p].substring(g+1)}else P=l[p];h(P,S?decodeURIComponent(S.replace(/\+/g," ")):"")}}}function Is(l){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,l instanceof Is){this.h=l.h,Ql(this,l.j),this.o=l.o,this.g=l.g,$l(this,l.s),this.l=l.l;var h=l.i,p=new ea;p.i=h.i,h.g&&(p.g=new Map(h.g),p.h=h.h),V0(this,p),this.m=l.m}else l&&(h=String(l).match(L0))?(this.h=!1,Ql(this,h[1]||"",!0),this.o=Jo(h[2]||""),this.g=Jo(h[3]||"",!0),$l(this,h[4]),this.l=Jo(h[5]||"",!0),V0(this,h[6]||"",!0),this.m=Jo(h[7]||"")):(this.h=!1,this.i=new ea(null,this.h))}Is.prototype.toString=function(){var l=[],h=this.j;h&&l.push(Zo(h,B0,!0),":");var p=this.g;return(p||h=="file")&&(l.push("//"),(h=this.o)&&l.push(Zo(h,B0,!0),"@"),l.push(encodeURIComponent(String(p)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),p=this.s,p!=null&&l.push(":",String(p))),(p=this.l)&&(this.g&&p.charAt(0)!="/"&&l.push("/"),l.push(Zo(p,p.charAt(0)=="/"?DS:PS,!0))),(p=this.i.toString())&&l.push("?",p),(p=this.m)&&l.push("#",Zo(p,kS)),l.join("")};function pi(l){return new Is(l)}function Ql(l,h,p){l.j=p?Jo(h,!0):h,l.j&&(l.j=l.j.replace(/:$/,""))}function $l(l,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);l.s=h}else l.s=null}function V0(l,h,p){h instanceof ea?(l.i=h,OS(l.i,l.h)):(p||(h=Zo(h,NS)),l.i=new ea(h,l.h))}function qe(l,h,p){l.i.set(h,p)}function Yl(l){return qe(l,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),l}function Jo(l,h){return l?h?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function Zo(l,h,p){return typeof l=="string"?(l=encodeURI(l).replace(h,xS),p&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function xS(l){return l=l.charCodeAt(0),"%"+(l>>4&15).toString(16)+(l&15).toString(16)}var B0=/[#\/\?@]/g,PS=/[#\?:]/g,DS=/[#\?]/g,NS=/[#\?@]/g,kS=/#/g;function ea(l,h){this.h=this.g=null,this.i=l||null,this.j=!!h}function Vi(l){l.g||(l.g=new Map,l.h=0,l.i&&RS(l.i,function(h,p){l.add(decodeURIComponent(h.replace(/\+/g," ")),p)}))}i=ea.prototype,i.add=function(l,h){Vi(this),this.i=null,l=Tr(this,l);var p=this.g.get(l);return p||this.g.set(l,p=[]),p.push(h),this.h+=1,this};function U0(l,h){Vi(l),h=Tr(l,h),l.g.has(h)&&(l.i=null,l.h-=l.g.get(h).length,l.g.delete(h))}function q0(l,h){return Vi(l),h=Tr(l,h),l.g.has(h)}i.forEach=function(l,h){Vi(this),this.g.forEach(function(p,g){p.forEach(function(S){l.call(h,S,g,this)},this)},this)},i.na=function(){Vi(this);let l=Array.from(this.g.values()),h=Array.from(this.g.keys()),p=[];for(let g=0;g<h.length;g++){let S=l[g];for(let P=0;P<S.length;P++)p.push(h[g])}return p},i.V=function(l){Vi(this);let h=[];if(typeof l=="string")q0(this,l)&&(h=h.concat(this.g.get(Tr(this,l))));else{l=Array.from(this.g.values());for(let p=0;p<l.length;p++)h=h.concat(l[p])}return h},i.set=function(l,h){return Vi(this),this.i=null,l=Tr(this,l),q0(this,l)&&(this.h-=this.g.get(l).length),this.g.set(l,[h]),this.h+=1,this},i.get=function(l,h){return l?(l=this.V(l),0<l.length?String(l[0]):h):h};function z0(l,h,p){U0(l,h),0<p.length&&(l.i=null,l.g.set(Tr(l,h),C(p)),l.h+=p.length)}i.toString=function(){if(this.i)return this.i;if(!this.g)return"";let l=[],h=Array.from(this.g.keys());for(var p=0;p<h.length;p++){var g=h[p];let P=encodeURIComponent(String(g)),j=this.V(g);for(g=0;g<j.length;g++){var S=P;j[g]!==""&&(S+="="+encodeURIComponent(String(j[g]))),l.push(S)}}return this.i=l.join("&")};function Tr(l,h){return h=String(h),l.j&&(h=h.toLowerCase()),h}function OS(l,h){h&&!l.j&&(Vi(l),l.i=null,l.g.forEach(function(p,g){var S=g.toLowerCase();g!=S&&(U0(this,g),z0(this,S,p))},l)),l.j=h}function MS(l,h){let p=new Yo;if(a.Image){let g=new Image;g.onload=_(Bi,p,"TestLoadImage: loaded",!0,h,g),g.onerror=_(Bi,p,"TestLoadImage: error",!1,h,g),g.onabort=_(Bi,p,"TestLoadImage: abort",!1,h,g),g.ontimeout=_(Bi,p,"TestLoadImage: timeout",!1,h,g),a.setTimeout(function(){g.ontimeout&&g.ontimeout()},1e4),g.src=l}else h(!1)}function FS(l,h){let p=new Yo,g=new AbortController,S=setTimeout(()=>{g.abort(),Bi(p,"TestPingServer: timeout",!1,h)},1e4);fetch(l,{signal:g.signal}).then(P=>{clearTimeout(S),P.ok?Bi(p,"TestPingServer: ok",!0,h):Bi(p,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(S),Bi(p,"TestPingServer: error",!1,h)})}function Bi(l,h,p,g,S){try{S&&(S.onload=null,S.onerror=null,S.onabort=null,S.ontimeout=null),g(p)}catch{}}function LS(){this.g=new vS}function VS(l,h,p){let g=p||"";try{F0(l,function(S,P){let j=S;u(S)&&(j=qd(S)),h.push(g+P+"="+encodeURIComponent(j))})}catch(S){throw h.push(g+"type="+encodeURIComponent("_badmap")),S}}function ta(l){this.l=l.Ub||null,this.j=l.eb||!1}v(ta,zd),ta.prototype.g=function(){return new Xl(this.l,this.j)},ta.prototype.i=function(l){return function(){return l}}({});function Xl(l,h){xt.call(this),this.D=l,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}v(Xl,xt),i=Xl.prototype,i.open=function(l,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=l,this.A=h,this.readyState=1,ia(this)},i.send=function(l){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};l&&(h.body=l),(this.D||a).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},i.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,na(this)),this.readyState=0},i.Sa=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,ia(this)),this.g&&(this.readyState=3,ia(this),this.g)))if(this.responseType==="arraybuffer")l.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in l){if(this.j=l.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;j0(this)}else l.text().then(this.Ra.bind(this),this.ga.bind(this))};function j0(l){l.j.read().then(l.Pa.bind(l)).catch(l.ga.bind(l))}i.Pa=function(l){if(this.g){if(this.o&&l.value)this.response.push(l.value);else if(!this.o){var h=l.value?l.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!l.done}))&&(this.response=this.responseText+=h)}l.done?na(this):ia(this),this.readyState==3&&j0(this)}},i.Ra=function(l){this.g&&(this.response=this.responseText=l,na(this))},i.Qa=function(l){this.g&&(this.response=l,na(this))},i.ga=function(){this.g&&na(this)};function na(l){l.readyState=4,l.l=null,l.j=null,l.v=null,ia(l)}i.setRequestHeader=function(l,h){this.u.append(l,h)},i.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},i.getAllResponseHeaders=function(){if(!this.h)return"";let l=[],h=this.h.entries();for(var p=h.next();!p.done;)p=p.value,l.push(p[0]+": "+p[1]),p=h.next();return l.join(`\r
`)};function ia(l){l.onreadystatechange&&l.onreadystatechange.call(l)}Object.defineProperty(Xl.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(l){this.m=l?"include":"same-origin"}});function G0(l){let h="";return ee(l,function(p,g){h+=g,h+=":",h+=p,h+=`\r
`}),h}function Jd(l,h,p){e:{for(g in p){var g=!1;break e}g=!0}g||(p=G0(p),typeof l=="string"?p!=null&&encodeURIComponent(String(p)):qe(l,h,p))}function Ze(l){xt.call(this),this.headers=new Map,this.o=l||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}v(Ze,xt);var BS=/^https?$/i,US=["POST","PUT"];i=Ze.prototype,i.Ha=function(l){this.J=l},i.ea=function(l,h,p,g){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+l);h=h?h.toUpperCase():"GET",this.D=l,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Wd.g(),this.v=this.o?v0(this.o):v0(Wd),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(h,String(l),!0),this.B=!1}catch(P){W0(this,P);return}if(l=p||"",p=new Map(this.headers),g)if(Object.getPrototypeOf(g)===Object.prototype)for(var S in g)p.set(S,g[S]);else if(typeof g.keys=="function"&&typeof g.get=="function")for(let P of g.keys())p.set(P,g.get(P));else throw Error("Unknown input type for opt_headers: "+String(g));g=Array.from(p.keys()).find(P=>P.toLowerCase()=="content-type"),S=a.FormData&&l instanceof a.FormData,!(0<=Array.prototype.indexOf.call(US,h,void 0))||g||S||p.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[P,j]of p)this.g.setRequestHeader(P,j);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Q0(this),this.u=!0,this.g.send(l),this.u=!1}catch(P){W0(this,P)}};function W0(l,h){l.h=!1,l.g&&(l.j=!0,l.g.abort(),l.j=!1),l.l=h,l.m=5,H0(l),Jl(l)}function H0(l){l.A||(l.A=!0,Ut(l,"complete"),Ut(l,"error"))}i.abort=function(l){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=l||7,Ut(this,"complete"),Ut(this,"abort"),Jl(this))},i.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Jl(this,!0)),Ze.aa.N.call(this)},i.Ea=function(){this.s||(this.B||this.u||this.j?K0(this):this.bb())},i.bb=function(){K0(this)};function K0(l){if(l.h&&typeof o<"u"&&(!l.v[1]||mi(l)!=4||l.Z()!=2)){if(l.u&&mi(l)==4)m0(l.Ea,0,l);else if(Ut(l,"readystatechange"),mi(l)==4){l.h=!1;try{let j=l.Z();e:switch(j){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var p;if(!(p=h)){var g;if(g=j===0){var S=String(l.D).match(L0)[1]||null;!S&&a.self&&a.self.location&&(S=a.self.location.protocol.slice(0,-1)),g=!BS.test(S?S.toLowerCase():"")}p=g}if(p)Ut(l,"complete"),Ut(l,"success");else{l.m=6;try{var P=2<mi(l)?l.g.statusText:""}catch{P=""}l.l=P+" ["+l.Z()+"]",H0(l)}}finally{Jl(l)}}}}function Jl(l,h){if(l.g){Q0(l);let p=l.g,g=l.v[0]?()=>{}:null;l.g=null,l.v=null,h||Ut(l,"ready");try{p.onreadystatechange=g}catch{}}}function Q0(l){l.I&&(a.clearTimeout(l.I),l.I=null)}i.isActive=function(){return!!this.g};function mi(l){return l.g?l.g.readyState:0}i.Z=function(){try{return 2<mi(this)?this.g.status:-1}catch{return-1}},i.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},i.Oa=function(l){if(this.g){var h=this.g.responseText;return l&&h.indexOf(l)==0&&(h=h.substring(l.length)),yS(h)}};function $0(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.H){case"":case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch{return null}}function qS(l){let h={};l=(l.g&&2<=mi(l)&&l.g.getAllResponseHeaders()||"").split(`\r
`);for(let g=0;g<l.length;g++){if(q(l[g]))continue;var p=b(l[g]);let S=p[0];if(p=p[1],typeof p!="string")continue;p=p.trim();let P=h[S]||[];h[S]=P,P.push(p)}T(h,function(g){return g.join(", ")})}i.Ba=function(){return this.m},i.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function sa(l,h,p){return p&&p.internalChannelParams&&p.internalChannelParams[l]||h}function Y0(l){this.Aa=0,this.i=[],this.j=new Yo,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=sa("failFast",!1,l),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=sa("baseRetryDelayMs",5e3,l),this.cb=sa("retryDelaySeedMs",1e4,l),this.Wa=sa("forwardChannelMaxRetries",2,l),this.wa=sa("forwardChannelRequestTimeoutMs",2e4,l),this.pa=l&&l.xmlHttpFactory||void 0,this.Xa=l&&l.Tb||void 0,this.Ca=l&&l.useFetchStreams||!1,this.L=void 0,this.J=l&&l.supportsCrossDomainXhr||!1,this.K="",this.h=new D0(l&&l.concurrentRequestLimit),this.Da=new LS,this.P=l&&l.fastHandshake||!1,this.O=l&&l.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=l&&l.Rb||!1,l&&l.xa&&this.j.xa(),l&&l.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&l&&l.detectBufferingProxy||!1,this.ja=void 0,l&&l.longPollingTimeout&&0<l.longPollingTimeout&&(this.ja=l.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}i=Y0.prototype,i.la=8,i.G=1,i.connect=function(l,h,p,g){qt(0),this.W=l,this.H=h||{},p&&g!==void 0&&(this.H.OSID=p,this.H.OAID=g),this.F=this.X,this.I=rv(this,null,this.W),ec(this)};function Zd(l){if(X0(l),l.G==3){var h=l.U++,p=pi(l.I);if(qe(p,"SID",l.K),qe(p,"RID",h),qe(p,"TYPE","terminate"),ra(l,p),h=new Li(l,l.j,h),h.L=2,h.v=Yl(pi(p)),p=!1,a.navigator&&a.navigator.sendBeacon)try{p=a.navigator.sendBeacon(h.v.toString(),"")}catch{}!p&&a.Image&&(new Image().src=h.v,p=!0),p||(h.g=ov(h.j,null),h.g.ea(h.v)),h.F=Date.now(),Kl(h)}sv(l)}function Zl(l){l.g&&(tf(l),l.g.cancel(),l.g=null)}function X0(l){Zl(l),l.u&&(a.clearTimeout(l.u),l.u=null),tc(l),l.h.cancel(),l.s&&(typeof l.s=="number"&&a.clearTimeout(l.s),l.s=null)}function ec(l){if(!N0(l.h)&&!l.s){l.s=!0;var h=l.Ga;X||tt(),Z||(X(),Z=!0),_e.add(h,l),l.B=0}}function zS(l,h){return k0(l.h)>=l.h.j-(l.s?1:0)?!1:l.s?(l.i=h.D.concat(l.i),!0):l.G==1||l.G==2||l.B>=(l.Va?0:l.Wa)?!1:(l.s=$o(m(l.Ga,l,h),iv(l,l.B)),l.B++,!0)}i.Ga=function(l){if(this.s)if(this.s=null,this.G==1){if(!l){this.U=Math.floor(1e5*Math.random()),l=this.U++;let S=new Li(this,this.j,l),P=this.o;if(this.S&&(P?(P=y(P),I(P,this.S)):P=this.S),this.m!==null||this.O||(S.H=P,P=null),this.P)e:{for(var h=0,p=0;p<this.i.length;p++){t:{var g=this.i[p];if("__data__"in g.map&&(g=g.map.__data__,typeof g=="string")){g=g.length;break t}g=void 0}if(g===void 0)break;if(h+=g,4096<h){h=p;break e}if(h===4096||p===this.i.length-1){h=p+1;break e}}h=1e3}else h=1e3;h=Z0(this,S,h),p=pi(this.I),qe(p,"RID",l),qe(p,"CVER",22),this.D&&qe(p,"X-HTTP-Session-Id",this.D),ra(this,p),P&&(this.O?h="headers="+encodeURIComponent(String(G0(P)))+"&"+h:this.m&&Jd(p,this.m,P)),Xd(this.h,S),this.Ua&&qe(p,"TYPE","init"),this.P?(qe(p,"$req",h),qe(p,"SID","null"),S.T=!0,Kd(S,p,null)):Kd(S,p,h),this.G=2}}else this.G==3&&(l?J0(this,l):this.i.length==0||N0(this.h)||J0(this))};function J0(l,h){var p;h?p=h.l:p=l.U++;let g=pi(l.I);qe(g,"SID",l.K),qe(g,"RID",p),qe(g,"AID",l.T),ra(l,g),l.m&&l.o&&Jd(g,l.m,l.o),p=new Li(l,l.j,p,l.B+1),l.m===null&&(p.H=l.o),h&&(l.i=h.D.concat(l.i)),h=Z0(l,p,1e3),p.I=Math.round(.5*l.wa)+Math.round(.5*l.wa*Math.random()),Xd(l.h,p),Kd(p,g,h)}function ra(l,h){l.H&&ee(l.H,function(p,g){qe(h,g,p)}),l.l&&F0({},function(p,g){qe(h,g,p)})}function Z0(l,h,p){p=Math.min(l.i.length,p);var g=l.l?m(l.l.Na,l.l,l):null;e:{var S=l.i;let P=-1;for(;;){let j=["count="+p];P==-1?0<p?(P=S[0].g,j.push("ofs="+P)):P=0:j.push("ofs="+P);let ke=!0;for(let It=0;It<p;It++){let Ae=S[It].g,Pt=S[It].map;if(Ae-=P,0>Ae)P=Math.max(0,S[It].g-100),ke=!1;else try{VS(Pt,j,"req"+Ae+"_")}catch{g&&g(Pt)}}if(ke){g=j.join("&");break e}}}return l=l.i.splice(0,p),h.D=l,g}function ev(l){if(!l.g&&!l.u){l.Y=1;var h=l.Fa;X||tt(),Z||(X(),Z=!0),_e.add(h,l),l.v=0}}function ef(l){return l.g||l.u||3<=l.v?!1:(l.Y++,l.u=$o(m(l.Fa,l),iv(l,l.v)),l.v++,!0)}i.Fa=function(){if(this.u=null,tv(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var l=2*this.R;this.j.info("BP detection timer enabled: "+l),this.A=$o(m(this.ab,this),l)}},i.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,qt(10),Zl(this),tv(this))};function tf(l){l.A!=null&&(a.clearTimeout(l.A),l.A=null)}function tv(l){l.g=new Li(l,l.j,"rpc",l.Y),l.m===null&&(l.g.H=l.o),l.g.O=0;var h=pi(l.qa);qe(h,"RID","rpc"),qe(h,"SID",l.K),qe(h,"AID",l.T),qe(h,"CI",l.F?"0":"1"),!l.F&&l.ja&&qe(h,"TO",l.ja),qe(h,"TYPE","xmlhttp"),ra(l,h),l.m&&l.o&&Jd(h,l.m,l.o),l.L&&(l.g.I=l.L);var p=l.g;l=l.ia,p.L=1,p.v=Yl(pi(h)),p.m=null,p.P=!0,R0(p,l)}i.Za=function(){this.C!=null&&(this.C=null,Zl(this),ef(this),qt(19))};function tc(l){l.C!=null&&(a.clearTimeout(l.C),l.C=null)}function nv(l,h){var p=null;if(l.g==h){tc(l),tf(l),l.g=null;var g=2}else if(Yd(l.h,h))p=h.D,O0(l.h,h),g=1;else return;if(l.G!=0){if(h.o)if(g==1){p=h.m?h.m.length:0,h=Date.now()-h.F;var S=l.B;g=Gl(),Ut(g,new C0(g,p)),ec(l)}else ev(l);else if(S=h.s,S==3||S==0&&0<h.X||!(g==1&&zS(l,h)||g==2&&ef(l)))switch(p&&0<p.length&&(h=l.h,h.i=h.i.concat(p)),S){case 1:Cs(l,5);break;case 4:Cs(l,10);break;case 3:Cs(l,6);break;default:Cs(l,2)}}}function iv(l,h){let p=l.Ta+Math.floor(Math.random()*l.cb);return l.isActive()||(p*=2),p*h}function Cs(l,h){if(l.j.info("Error code "+h),h==2){var p=m(l.fb,l),g=l.Xa;let S=!g;g=new Is(g||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Ql(g,"https"),Yl(g),S?MS(g.toString(),p):FS(g.toString(),p)}else qt(2);l.G=0,l.l&&l.l.sa(h),sv(l),X0(l)}i.fb=function(l){l?(this.j.info("Successfully pinged google.com"),qt(2)):(this.j.info("Failed to ping google.com"),qt(1))};function sv(l){if(l.G=0,l.ka=[],l.l){let h=M0(l.h);(h.length!=0||l.i.length!=0)&&(R(l.ka,h),R(l.ka,l.i),l.h.i.length=0,C(l.i),l.i.length=0),l.l.ra()}}function rv(l,h,p){var g=p instanceof Is?pi(p):new Is(p);if(g.g!="")h&&(g.g=h+"."+g.g),$l(g,g.s);else{var S=a.location;g=S.protocol,h=h?h+"."+S.hostname:S.hostname,S=+S.port;var P=new Is(null);g&&Ql(P,g),h&&(P.g=h),S&&$l(P,S),p&&(P.l=p),g=P}return p=l.D,h=l.ya,p&&h&&qe(g,p,h),qe(g,"VER",l.la),ra(l,g),g}function ov(l,h,p){if(h&&!l.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=l.Ca&&!l.pa?new Ze(new ta({eb:p})):new Ze(l.pa),h.Ha(l.J),h}i.isActive=function(){return!!this.l&&this.l.isActive(this)};function av(){}i=av.prototype,i.ua=function(){},i.ta=function(){},i.sa=function(){},i.ra=function(){},i.isActive=function(){return!0},i.Na=function(){};function nc(){}nc.prototype.g=function(l,h){return new nn(l,h)};function nn(l,h){xt.call(this),this.g=new Y0(h),this.l=l,this.h=h&&h.messageUrlParams||null,l=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.o=l,l=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(l?l["X-WebChannel-Content-Type"]=h.messageContentType:l={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(l?l["X-WebChannel-Client-Profile"]=h.va:l={"X-WebChannel-Client-Profile":h.va}),this.g.S=l,(l=h&&h.Sb)&&!q(l)&&(this.g.m=l),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!q(h)&&(this.g.D=h,l=this.h,l!==null&&h in l&&(l=this.h,h in l&&delete l[h])),this.j=new Ir(this)}v(nn,xt),nn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},nn.prototype.close=function(){Zd(this.g)},nn.prototype.o=function(l){var h=this.g;if(typeof l=="string"){var p={};p.__data__=l,l=p}else this.u&&(p={},p.__data__=qd(l),l=p);h.i.push(new bS(h.Ya++,l)),h.G==3&&ec(h)},nn.prototype.N=function(){this.g.l=null,delete this.j,Zd(this.g),delete this.g,nn.aa.N.call(this)};function lv(l){jd.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var h=l.__sm__;if(h){e:{for(let p in h){l=p;break e}l=void 0}(this.i=l)&&(l=this.i,h=h!==null&&l in h?h[l]:void 0),this.data=h}else this.data=l}v(lv,jd);function cv(){Gd.call(this),this.status=1}v(cv,Gd);function Ir(l){this.g=l}v(Ir,av),Ir.prototype.ua=function(){Ut(this.g,"a")},Ir.prototype.ta=function(l){Ut(this.g,new lv(l))},Ir.prototype.sa=function(l){Ut(this.g,new cv)},Ir.prototype.ra=function(){Ut(this.g,"b")},nc.prototype.createWebChannel=nc.prototype.g,nn.prototype.send=nn.prototype.o,nn.prototype.open=nn.prototype.m,nn.prototype.close=nn.prototype.close,mm=Ti.createWebChannelTransport=function(){return new nc},pm=Ti.getStatEventTarget=function(){return Gl()},fm=Ti.Event=Es,Fu=Ti.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Wl.NO_ERROR=0,Wl.TIMEOUT=8,Wl.HTTP_ERROR=6,Ka=Ti.ErrorCode=Wl,b0.COMPLETE="complete",dm=Ti.EventType=b0,w0.EventType=Ko,Ko.OPEN="a",Ko.CLOSE="b",Ko.ERROR="c",Ko.MESSAGE="d",xt.prototype.listen=xt.prototype.K,$r=Ti.WebChannel=w0,Xx=Ti.FetchXmlHttpFactory=ta,Ze.prototype.listenOnce=Ze.prototype.L,Ze.prototype.getLastError=Ze.prototype.Ka,Ze.prototype.getLastErrorCode=Ze.prototype.Ba,Ze.prototype.getStatus=Ze.prototype.Z,Ze.prototype.getResponseJson=Ze.prototype.Oa,Ze.prototype.getResponseText=Ze.prototype.oa,Ze.prototype.send=Ze.prototype.ea,Ze.prototype.setWithCredentials=Ze.prototype.Ha,hm=Ti.XhrIo=Ze}).apply(typeof Mu<"u"?Mu:typeof self<"u"?self:typeof window<"u"?window:{});var OT="@firebase/firestore";var dt=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};dt.UNAUTHENTICATED=new dt(null),dt.GOOGLE_CREDENTIALS=new dt("google-credentials-uid"),dt.FIRST_PARTY=new dt("first-party-uid"),dt.MOCK_USER=new dt("mock-user");var Ao="10.14.0";var rs=new Pr("@firebase/firestore");function eo(){return rs.logLevel}function L1(i){rs.setLogLevel(i)}function F(i,...e){if(rs.logLevel<=Sn.DEBUG){let t=e.map(w_);rs.debug(`Firestore (${Ao}): ${i}`,...t)}}function it(i,...e){if(rs.logLevel<=Sn.ERROR){let t=e.map(w_);rs.error(`Firestore (${Ao}): ${i}`,...t)}}function Bn(i,...e){if(rs.logLevel<=Sn.WARN){let t=e.map(w_);rs.warn(`Firestore (${Ao}): ${i}`,...t)}}function w_(i){if(typeof i=="string")return i;try{return function(t){return JSON.stringify(t)}(i)}catch{return i}}function H(i="Unexpected state"){let e=`FIRESTORE (${Ao}) INTERNAL ASSERTION FAILED: `+i;throw it(e),new Error(e)}function $(i,e){i||H()}function V1(i,e){i||H()}function G(i,e){return i}var D={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},M=class extends Hv{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var vt=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Hu=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Em=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(dt.UNAUTHENTICATED))}shutdown(){}},Tm=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Im=class{constructor(e){this.t=e,this.currentUser=dt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){$(this.o===void 0);let n=this.i,s=c=>this.i!==n?(n=this.i,t(c)):Promise.resolve(),r=new vt;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new vt,e.enqueueRetryable(()=>s(this.currentUser))};let o=()=>{let c=r;e.enqueueRetryable(()=>N(this,null,function*(){yield c.promise,yield s(this.currentUser)}))},a=c=>{F("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?a(c):(F("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new vt)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(F("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?($(typeof n.accessToken=="string"),new Hu(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return $(e===null||typeof e=="string"),new dt(e)}},Cm=class{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=dt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},bm=class{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new Cm(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(dt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Sm=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Am=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){$(this.o===void 0);let n=r=>{r.error!=null&&F("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${r.error.message}`);let o=r.token!==this.R;return this.R=r.token,F("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(r.token):Promise.resolve()};this.o=r=>{e.enqueueRetryable(()=>n(r))};let s=r=>{F("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=r,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(r=>s(r)),setTimeout(()=>{if(!this.appCheck){let r=this.A.getImmediate({optional:!0});r?s(r):F("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?($(typeof t.token=="string"),this.R=t.token,new Sm(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function Jx(i){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(i);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<i;n++)t[n]=Math.floor(256*Math.random());return t}var Ku=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";for(;n.length<20;){let s=Jx(40);for(let r=0;r<s.length;++r)n.length<20&&s[r]<t&&(n+=e.charAt(s[r]%e.length))}return n}};function ce(i,e){return i<e?-1:i>e?1:0}function co(i,e,t){return i.length===e.length&&i.every((n,s)=>t(n,e[s]))}function B1(i){return i+"\0"}var $e=class i{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new M(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new M(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new M(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new M(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return i.fromMillis(Date.now())}static fromDate(e){return i.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new i(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ce(this.nanoseconds,e.nanoseconds):ce(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var J=class i{constructor(e){this.timestamp=e}static fromTimestamp(e){return new i(e)}static min(){return new i(new $e(0,0))}static max(){return new i(new $e(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Qu=class i{constructor(e,t,n){t===void 0?t=0:t>e.length&&H(),n===void 0?n=e.length-t:n>e.length-t&&H(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return i.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof i?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let s=0;s<n;s++){let r=e.get(s),o=t.get(s);if(r<o)return-1;if(r>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},Ie=class i extends Qu{construct(e,t,n){return new i(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new M(D.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(s=>s.length>0))}return new i(t)}static emptyPath(){return new i([])}},Zx=/^[_a-zA-Z][_a-zA-Z0-9]*$/,st=class i extends Qu{construct(e,t,n){return new i(e,t,n)}static isValidIdentifier(e){return Zx.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),i.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new i(["__name__"])}static fromServerFormat(e){let t=[],n="",s=0,r=()=>{if(n.length===0)throw new M(D.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},o=!1;for(;s<e.length;){let a=e[s];if(a==="\\"){if(s+1===e.length)throw new M(D.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let c=e[s+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new M(D.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=c,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(n+=a,s++):(r(),s++)}if(r(),o)throw new M(D.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new i(t)}static emptyPath(){return new i([])}};var W=class i{constructor(e){this.path=e}static fromPath(e){return new i(Ie.fromString(e))}static fromName(e){return new i(Ie.fromString(e).popFirst(5))}static empty(){return new i(Ie.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ie.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Ie.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new i(new Ie(e.slice()))}};var uo=class{constructor(e,t,n,s){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=s}};function Rm(i){return i.fields.find(e=>e.kind===2)}function zs(i){return i.fields.filter(e=>e.kind!==2)}uo.UNKNOWN_ID=-1;var oo=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var rl=class i{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new i(0,Dn.min())}};function U1(i,e){let t=i.toTimestamp().seconds,n=i.toTimestamp().nanoseconds+1,s=J.fromTimestamp(n===1e9?new $e(t+1,0):new $e(t,n));return new Dn(s,W.empty(),e)}function q1(i){return new Dn(i.readTime,i.key,-1)}var Dn=class i{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new i(J.min(),W.empty(),-1)}static max(){return new i(J.max(),W.empty(),-1)}};function E_(i,e){let t=i.readTime.compareTo(e.readTime);return t!==0?t:(t=W.comparator(i.documentKey,e.documentKey),t!==0?t:ce(i.largestBatchId,e.largestBatchId))}var z1="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",$u=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function ms(i){return N(this,null,function*(){if(i.code!==D.FAILED_PRECONDITION||i.message!==z1)throw i;F("LocalStore","Unexpectedly lost primary lease")})}var x=class i{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&H(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new i((n,s)=>{this.nextCallback=r=>{this.wrapSuccess(e,r).next(n,s)},this.catchCallback=r=>{this.wrapFailure(t,r).next(n,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof i?t:i.resolve(t)}catch(t){return i.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):i.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):i.reject(t)}static resolve(e){return new i((t,n)=>{t(e)})}static reject(e){return new i((t,n)=>{n(e)})}static waitFor(e){return new i((t,n)=>{let s=0,r=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++r,o&&r===s&&t()},c=>n(c))}),o=!0,r===s&&t()})}static or(e){let t=i.resolve(!1);for(let n of e)t=t.next(s=>s?i.resolve(s):n());return t}static forEach(e,t){let n=[];return e.forEach((s,r)=>{n.push(t.call(this,s,r))}),this.waitFor(n)}static mapArray(e,t){return new i((n,s)=>{let r=e.length,o=new Array(r),a=0;for(let c=0;c<r;c++){let u=c;t(e[u]).next(d=>{o[u]=d,++a,a===r&&n(o)},d=>s(d))}})}static doWhile(e,t){return new i((n,s)=>{let r=()=>{e()===!0?t().next(()=>{r()},s):n()};r()})}};var Yu=class i{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new vt,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Qs(e,t.error)):this.V.resolve()},this.transaction.onerror=n=>{let s=T_(n.target.error);this.V.reject(new Qs(e,s))}}static open(e,t,n,s){try{return new i(t,e.transaction(s,n))}catch(r){throw new Qs(t,r)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(F("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new Pm(t)}},os=class i{constructor(e,t,n){this.name=e,this.version=t,this.p=n,i.S(ha())===12.2&&it("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return F("SimpleDb","Removing database:",e),js(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!Wv())return!1;if(i.v())return!0;let e=ha(),t=i.S(e),n=0<t&&t<10,s=j1(e),r=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||r)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}M(e){return N(this,null,function*(){return this.db||(F("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,n)=>{let s=indexedDB.open(this.name,this.version);s.onsuccess=r=>{let o=r.target.result;t(o)},s.onblocked=()=>{n(new Qs(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=r=>{let o=r.target.error;o.name==="VersionError"?n(new M(D.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?n(new M(D.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):n(new Qs(e,o))},s.onupgradeneeded=r=>{F("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',r.oldVersion);let o=r.target.result;this.p.O(o,s.transaction,r.oldVersion,this.version).next(()=>{F("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db})}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,n,s){return N(this,null,function*(){let r=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.M(e);let a=Yu.open(this.db,e,r?"readonly":"readwrite",n),c=s(a).next(u=>(a.g(),u)).catch(u=>(a.abort(u),x.reject(u))).toPromise();return c.catch(()=>{}),yield a.m,c}catch(a){let c=a,u=c.name!=="FirebaseError"&&o<3;if(F("SimpleDb","Transaction failed with error:",c.message,"Retrying:",u),this.close(),!u)return Promise.reject(c)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function j1(i){let e=i.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var xm=class{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return js(this.B.delete())}},Qs=class extends M{constructor(e,t){super(D.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function gs(i){return i.name==="IndexedDbTransactionError"}var Pm=class{constructor(e){this.store=e}put(e,t){let n;return t!==void 0?(F("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(F("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),js(n)}add(e){return F("SimpleDb","ADD",this.store.name,e,e),js(this.store.add(e))}get(e){return js(this.store.get(e)).next(t=>(t===void 0&&(t=null),F("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return F("SimpleDb","DELETE",this.store.name,e),js(this.store.delete(e))}count(){return F("SimpleDb","COUNT",this.store.name),js(this.store.count())}U(e,t){let n=this.options(e,t),s=n.index?this.store.index(n.index):this.store;if(typeof s.getAll=="function"){let r=s.getAll(n.range);return new x((o,a)=>{r.onerror=c=>{a(c.target.error)},r.onsuccess=c=>{o(c.target.result)}})}{let r=this.cursor(n),o=[];return this.W(r,(a,c)=>{o.push(c)}).next(()=>o)}}G(e,t){let n=this.store.getAll(e,t===null?void 0:t);return new x((s,r)=>{n.onerror=o=>{r(o.target.error)},n.onsuccess=o=>{s(o.target.result)}})}j(e,t){F("SimpleDb","DELETE ALL",this.store.name);let n=this.options(e,t);n.H=!1;let s=this.cursor(n);return this.W(s,(r,o,a)=>a.delete())}J(e,t){let n;t?n=e:(n={},t=e);let s=this.cursor(n);return this.W(s,t)}Y(e){let t=this.cursor({});return new x((n,s)=>{t.onerror=r=>{let o=T_(r.target.error);s(o)},t.onsuccess=r=>{let o=r.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():n()}):n()}})}W(e,t){let n=[];return new x((s,r)=>{e.onerror=o=>{r(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a)return void s();let c=new xm(a),u=t(a.primaryKey,a.value,c);if(u instanceof x){let d=u.catch(f=>(c.done(),x.reject(f)));n.push(d)}c.isDone?s():c.K===null?a.continue():a.continue(c.K)}}).next(()=>x.waitFor(n))}options(e,t){let n;return e!==void 0&&(typeof e=="string"?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function js(i){return new x((e,t)=>{i.onsuccess=n=>{let s=n.target.result;e(s)},i.onerror=n=>{let s=T_(n.target.error);t(s)}})}var MT=!1;function T_(i){let e=os.S(ha());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(i.message.indexOf(t)>=0){let n=new M("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return MT||(MT=!0,setTimeout(()=>{throw n},0)),n}}return i}var Dm=class{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){F("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>N(this,null,function*(){this.task=null;try{F("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(t){gs(t)?F("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield ms(t)}yield this.X(6e4)}))}},Nm=class{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){return N(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))})}te(e,t){let n=new Set,s=t,r=!0;return x.doWhile(()=>r===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!n.has(o))return F("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,s).next(a=>{s-=a,n.add(o)});r=!1})).next(()=>t-s)}ne(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,n).next(r=>{let o=r.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(s,r)).next(a=>(F("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let n=e;return t.changes.forEach((s,r)=>{let o=q1(r);E_(o,n)>0&&(n=o)}),new Dn(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}};var un=(()=>{class i{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=s=>this.ie(s),this.se=s=>n.writeSequenceNumber(s))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return i.oe=-1,i})();function Sl(i){return i==null}function ol(i){return i===0&&1/i==-1/0}function G1(i){return typeof i=="number"&&Number.isInteger(i)&&!ol(i)&&i<=Number.MAX_SAFE_INTEGER&&i>=Number.MIN_SAFE_INTEGER}function Kt(i){let e="";for(let t=0;t<i.length;t++)e.length>0&&(e=FT(e)),e=eP(i.get(t),e);return FT(e)}function eP(i,e){let t=e,n=i.length;for(let s=0;s<n;s++){let r=i.charAt(s);switch(r){case"\0":t+="";break;case"":t+="";break;default:t+=r}}return t}function FT(i){return i+""}function Zn(i){let e=i.length;if($(e>=2),e===2)return $(i.charAt(0)===""&&i.charAt(1)===""),Ie.emptyPath();let t=e-2,n=[],s="";for(let r=0;r<e;){let o=i.indexOf("",r);switch((o<0||o>t)&&H(),i.charAt(o+1)){case"":let a=i.substring(r,o),c;s.length===0?c=a:(s+=a,c=s,s=""),n.push(c);break;case"":s+=i.substring(r,o),s+="\0";break;case"":s+=i.substring(r,o+1);break;default:H()}r=o+2}return new Ie(n)}var LT=["userId","batchId"];function qu(i,e){return[i,Kt(e)]}function W1(i,e,t){return[i,Kt(e),t]}var tP={},nP=["prefixPath","collectionGroup","readTime","documentId"],iP=["prefixPath","collectionGroup","documentId"],sP=["collectionGroup","readTime","prefixPath","documentId"],rP=["canonicalId","targetId"],oP=["targetId","path"],aP=["path","targetId"],lP=["collectionId","parent"],cP=["indexId","uid"],uP=["uid","sequenceNumber"],hP=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],dP=["indexId","uid","orderedDocumentKey"],fP=["userId","collectionPath","documentId"],pP=["userId","collectionPath","largestBatchId"],mP=["userId","collectionGroup","largestBatchId"],H1=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],gP=[...H1,"documentOverlays"],K1=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Q1=K1,I_=[...Q1,"indexConfiguration","indexState","indexEntries"],_P=I_,yP=[...I_,"globals"];var al=class extends $u{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}};function wt(i,e){let t=G(i);return os.F(t._e,e)}function VT(i){let e=0;for(let t in i)Object.prototype.hasOwnProperty.call(i,t)&&e++;return e}function or(i,e){for(let t in i)Object.prototype.hasOwnProperty.call(i,t)&&e(t,i[t])}function $1(i){for(let e in i)if(Object.prototype.hasOwnProperty.call(i,e))return!1;return!0}var Ge=class i{constructor(e,t){this.comparator=e,this.root=t||ti.EMPTY}insert(e,t){return new i(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ti.BLACK,null,null))}remove(e){return new i(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ti.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let s=this.comparator(e,n.key);if(s===0)return t+n.left.size;s<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ro(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ro(this.root,e,this.comparator,!1)}getReverseIterator(){return new ro(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ro(this.root,e,this.comparator,!0)}},ro=class{constructor(e,t,n,s){this.isReverse=s,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,t&&s&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(r===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},ti=class i{constructor(e,t,n,s,r){this.key=e,this.value=t,this.color=n??i.RED,this.left=s??i.EMPTY,this.right=r??i.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,s,r){return new i(e??this.key,t??this.value,n??this.color,s??this.left,r??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let s=this,r=n(e,s.key);return s=r<0?s.copy(null,null,null,s.left.insert(e,t,n),null):r===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return i.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return i.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,i.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,i.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw H();let e=this.left.check();if(e!==this.right.check())throw H();return e+(this.isRed()?0:1)}};ti.EMPTY=null,ti.RED=!0,ti.BLACK=!1;ti.EMPTY=new class{constructor(){this.size=0}get key(){throw H()}get value(){throw H()}get color(){throw H()}get left(){throw H()}get right(){throw H()}copy(e,t,n,s,r){return this}insert(e,t,n){return new ti(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var Me=class i{constructor(e){this.comparator=e,this.data=new Ge(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let s=n.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Xu(this.data.getIterator())}getIteratorFrom(e){return new Xu(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof i)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let s=t.getNext().key,r=n.getNext().key;if(this.comparator(s,r)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new i(this.comparator);return t.data=e,t}},Xu=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Yr(i){return i.hasNext()?i.getNext():void 0}var hn=class i{constructor(e){this.fields=e,e.sort(st.comparator)}static empty(){return new i([])}unionWith(e){let t=new Me(st.comparator);for(let n of this.fields)t=t.add(n);for(let n of e)t=t.add(n);return new i(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return co(this.fields,e.fields,(t,n)=>t.isEqual(n))}};var Ju=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function Y1(){return typeof atob<"u"}var ot=class i{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(s){try{return atob(s)}catch(r){throw typeof DOMException<"u"&&r instanceof DOMException?new Ju("Invalid base64 string: "+r):r}}(e);return new i(t)}static fromUint8Array(e){let t=function(s){let r="";for(let o=0;o<s.length;++o)r+=String.fromCharCode(s[o]);return r}(e);return new i(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let n=new Uint8Array(t.length);for(let s=0;s<t.length;s++)n[s]=t.charCodeAt(s);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ce(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};ot.EMPTY_BYTE_STRING=new ot("");var vP=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function bi(i){if($(!!i),typeof i=="string"){let e=0,t=vP.exec(i);if($(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}let n=new Date(i);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:He(i.seconds),nanos:He(i.nanos)}}function He(i){return typeof i=="number"?i:typeof i=="string"?Number(i):0}function as(i){return typeof i=="string"?ot.fromBase64String(i):ot.fromUint8Array(i)}function jh(i){var e,t;return((t=(((e=i?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function C_(i){let e=i.mapValue.fields.__previous_value__;return jh(e)?C_(e):e}function ll(i){let e=bi(i.mapValue.fields.__local_write_time__.timestampValue);return new $e(e.seconds,e.nanos)}var km=class{constructor(e,t,n,s,r,o,a,c,u){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=s,this.ssl=r,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=u}},ls=class i{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new i("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof i&&e.projectId===this.projectId&&e.database===this.database}};var is={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},zu={nullValue:"NULL_VALUE"};function $s(i){return"nullValue"in i?0:"booleanValue"in i?1:"integerValue"in i||"doubleValue"in i?2:"timestampValue"in i?3:"stringValue"in i?5:"bytesValue"in i?6:"referenceValue"in i?7:"geoPointValue"in i?8:"arrayValue"in i?9:"mapValue"in i?jh(i)?4:X1(i)?9007199254740991:Gh(i)?10:11:H()}function si(i,e){if(i===e)return!0;let t=$s(i);if(t!==$s(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return i.booleanValue===e.booleanValue;case 4:return ll(i).isEqual(ll(e));case 3:return function(s,r){if(typeof s.timestampValue=="string"&&typeof r.timestampValue=="string"&&s.timestampValue.length===r.timestampValue.length)return s.timestampValue===r.timestampValue;let o=bi(s.timestampValue),a=bi(r.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(i,e);case 5:return i.stringValue===e.stringValue;case 6:return function(s,r){return as(s.bytesValue).isEqual(as(r.bytesValue))}(i,e);case 7:return i.referenceValue===e.referenceValue;case 8:return function(s,r){return He(s.geoPointValue.latitude)===He(r.geoPointValue.latitude)&&He(s.geoPointValue.longitude)===He(r.geoPointValue.longitude)}(i,e);case 2:return function(s,r){if("integerValue"in s&&"integerValue"in r)return He(s.integerValue)===He(r.integerValue);if("doubleValue"in s&&"doubleValue"in r){let o=He(s.doubleValue),a=He(r.doubleValue);return o===a?ol(o)===ol(a):isNaN(o)&&isNaN(a)}return!1}(i,e);case 9:return co(i.arrayValue.values||[],e.arrayValue.values||[],si);case 10:case 11:return function(s,r){let o=s.mapValue.fields||{},a=r.mapValue.fields||{};if(VT(o)!==VT(a))return!1;for(let c in o)if(o.hasOwnProperty(c)&&(a[c]===void 0||!si(o[c],a[c])))return!1;return!0}(i,e);default:return H()}}function cl(i,e){return(i.values||[]).find(t=>si(t,e))!==void 0}function cs(i,e){if(i===e)return 0;let t=$s(i),n=$s(e);if(t!==n)return ce(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return ce(i.booleanValue,e.booleanValue);case 2:return function(r,o){let a=He(r.integerValue||r.doubleValue),c=He(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1}(i,e);case 3:return BT(i.timestampValue,e.timestampValue);case 4:return BT(ll(i),ll(e));case 5:return ce(i.stringValue,e.stringValue);case 6:return function(r,o){let a=as(r),c=as(o);return a.compareTo(c)}(i.bytesValue,e.bytesValue);case 7:return function(r,o){let a=r.split("/"),c=o.split("/");for(let u=0;u<a.length&&u<c.length;u++){let d=ce(a[u],c[u]);if(d!==0)return d}return ce(a.length,c.length)}(i.referenceValue,e.referenceValue);case 8:return function(r,o){let a=ce(He(r.latitude),He(o.latitude));return a!==0?a:ce(He(r.longitude),He(o.longitude))}(i.geoPointValue,e.geoPointValue);case 9:return UT(i.arrayValue,e.arrayValue);case 10:return function(r,o){var a,c,u,d;let f=r.fields||{},m=o.fields||{},_=(a=f.value)===null||a===void 0?void 0:a.arrayValue,v=(c=m.value)===null||c===void 0?void 0:c.arrayValue,C=ce(((u=_?.values)===null||u===void 0?void 0:u.length)||0,((d=v?.values)===null||d===void 0?void 0:d.length)||0);return C!==0?C:UT(_,v)}(i.mapValue,e.mapValue);case 11:return function(r,o){if(r===is.mapValue&&o===is.mapValue)return 0;if(r===is.mapValue)return 1;if(o===is.mapValue)return-1;let a=r.fields||{},c=Object.keys(a),u=o.fields||{},d=Object.keys(u);c.sort(),d.sort();for(let f=0;f<c.length&&f<d.length;++f){let m=ce(c[f],d[f]);if(m!==0)return m;let _=cs(a[c[f]],u[d[f]]);if(_!==0)return _}return ce(c.length,d.length)}(i.mapValue,e.mapValue);default:throw H()}}function BT(i,e){if(typeof i=="string"&&typeof e=="string"&&i.length===e.length)return ce(i,e);let t=bi(i),n=bi(e),s=ce(t.seconds,n.seconds);return s!==0?s:ce(t.nanos,n.nanos)}function UT(i,e){let t=i.values||[],n=e.values||[];for(let s=0;s<t.length&&s<n.length;++s){let r=cs(t[s],n[s]);if(r)return r}return ce(t.length,n.length)}function ho(i){return Om(i)}function Om(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?function(t){let n=bi(t);return`time(${n.seconds},${n.nanos})`}(i.timestampValue):"stringValue"in i?i.stringValue:"bytesValue"in i?function(t){return as(t).toBase64()}(i.bytesValue):"referenceValue"in i?function(t){return W.fromName(t).toString()}(i.referenceValue):"geoPointValue"in i?function(t){return`geo(${t.latitude},${t.longitude})`}(i.geoPointValue):"arrayValue"in i?function(t){let n="[",s=!0;for(let r of t.values||[])s?s=!1:n+=",",n+=Om(r);return n+"]"}(i.arrayValue):"mapValue"in i?function(t){let n=Object.keys(t.fields||{}).sort(),s="{",r=!0;for(let o of n)r?r=!1:s+=",",s+=`${o}:${Om(t.fields[o])}`;return s+"}"}(i.mapValue):H()}function Ys(i,e){return{referenceValue:`projects/${i.projectId}/databases/${i.database}/documents/${e.path.canonicalString()}`}}function Mm(i){return!!i&&"integerValue"in i}function ul(i){return!!i&&"arrayValue"in i}function qT(i){return!!i&&"nullValue"in i}function zT(i){return!!i&&"doubleValue"in i&&isNaN(Number(i.doubleValue))}function ju(i){return!!i&&"mapValue"in i}function Gh(i){var e,t;return((t=(((e=i?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function el(i){if(i.geoPointValue)return{geoPointValue:Object.assign({},i.geoPointValue)};if(i.timestampValue&&typeof i.timestampValue=="object")return{timestampValue:Object.assign({},i.timestampValue)};if(i.mapValue){let e={mapValue:{fields:{}}};return or(i.mapValue.fields,(t,n)=>e.mapValue.fields[t]=el(n)),e}if(i.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(i.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=el(i.arrayValue.values[t]);return e}return Object.assign({},i)}function X1(i){return(((i.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var J1={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function wP(i){return"nullValue"in i?zu:"booleanValue"in i?{booleanValue:!1}:"integerValue"in i||"doubleValue"in i?{doubleValue:NaN}:"timestampValue"in i?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in i?{stringValue:""}:"bytesValue"in i?{bytesValue:""}:"referenceValue"in i?Ys(ls.empty(),W.empty()):"geoPointValue"in i?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in i?{arrayValue:{}}:"mapValue"in i?Gh(i)?J1:{mapValue:{}}:H()}function EP(i){return"nullValue"in i?{booleanValue:!1}:"booleanValue"in i?{doubleValue:NaN}:"integerValue"in i||"doubleValue"in i?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in i?{stringValue:""}:"stringValue"in i?{bytesValue:""}:"bytesValue"in i?Ys(ls.empty(),W.empty()):"referenceValue"in i?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in i?{arrayValue:{}}:"arrayValue"in i?J1:"mapValue"in i?Gh(i)?{mapValue:{}}:is:H()}function jT(i,e){let t=cs(i.value,e.value);return t!==0?t:i.inclusive&&!e.inclusive?-1:!i.inclusive&&e.inclusive?1:0}function GT(i,e){let t=cs(i.value,e.value);return t!==0?t:i.inclusive&&!e.inclusive?1:!i.inclusive&&e.inclusive?-1:0}var Lt=class i{constructor(e){this.value=e}static empty(){return new i({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!ju(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=el(t)}setAll(e){let t=st.emptyPath(),n={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let c=this.getFieldsMap(t);this.applyChanges(c,n,s),n={},s=[],t=a.popLast()}o?n[a.lastSegment()]=el(o):s.push(a.lastSegment())});let r=this.getFieldsMap(t);this.applyChanges(r,n,s)}delete(e){let t=this.field(e.popLast());ju(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return si(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let s=t.mapValue.fields[e.get(n)];ju(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,n){or(t,(s,r)=>e[s]=r);for(let s of n)delete e[s]}clone(){return new i(el(this.value))}};function Z1(i){let e=[];return or(i.fields,(t,n)=>{let s=new st([t]);if(ju(n)){let r=Z1(n.mapValue).fields;if(r.length===0)e.push(s);else for(let o of r)e.push(s.child(o))}else e.push(s)}),new hn(e)}var ft=class i{constructor(e,t,n,s,r,o,a){this.key=e,this.documentType=t,this.version=n,this.readTime=s,this.createTime=r,this.data=o,this.documentState=a}static newInvalidDocument(e){return new i(e,0,J.min(),J.min(),J.min(),Lt.empty(),0)}static newFoundDocument(e,t,n,s){return new i(e,1,t,J.min(),n,s,0)}static newNoDocument(e,t){return new i(e,2,t,J.min(),J.min(),Lt.empty(),0)}static newUnknownDocument(e,t){return new i(e,3,t,J.min(),J.min(),Lt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(J.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Lt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Lt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=J.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof i&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new i(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var ri=class{constructor(e,t){this.position=e,this.inclusive=t}};function WT(i,e,t){let n=0;for(let s=0;s<i.position.length;s++){let r=e[s],o=i.position[s];if(r.field.isKeyField()?n=W.comparator(W.fromName(o.referenceValue),t.key):n=cs(o,t.data.field(r.field)),r.dir==="desc"&&(n*=-1),n!==0)break}return n}function HT(i,e){if(i===null)return e===null;if(e===null||i.inclusive!==e.inclusive||i.position.length!==e.position.length)return!1;for(let t=0;t<i.position.length;t++)if(!si(i.position[t],e.position[t]))return!1;return!0}var Xs=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function TP(i,e){return i.dir===e.dir&&i.field.isEqual(e.field)}var Zu=class{},we=class i extends Zu{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new Vm(e,t,n):t==="array-contains"?new qm(e,n):t==="in"?new eh(e,n):t==="not-in"?new zm(e,n):t==="array-contains-any"?new jm(e,n):new i(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new Bm(e,n):new Um(e,n)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(cs(t,this.value)):t!==null&&$s(this.value)===$s(t)&&this.matchesComparison(cs(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return H()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Ne=class i extends Zu{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new i(e,t)}matches(e){return fo(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function fo(i){return i.op==="and"}function Fm(i){return i.op==="or"}function b_(i){return eI(i)&&fo(i)}function eI(i){for(let e of i.filters)if(e instanceof Ne)return!1;return!0}function Lm(i){if(i instanceof we)return i.field.canonicalString()+i.op.toString()+ho(i.value);if(b_(i))return i.filters.map(e=>Lm(e)).join(",");{let e=i.filters.map(t=>Lm(t)).join(",");return`${i.op}(${e})`}}function tI(i,e){return i instanceof we?function(n,s){return s instanceof we&&n.op===s.op&&n.field.isEqual(s.field)&&si(n.value,s.value)}(i,e):i instanceof Ne?function(n,s){return s instanceof Ne&&n.op===s.op&&n.filters.length===s.filters.length?n.filters.reduce((r,o,a)=>r&&tI(o,s.filters[a]),!0):!1}(i,e):void H()}function nI(i,e){let t=i.filters.concat(e);return Ne.create(t,i.op)}function iI(i){return i instanceof we?function(t){return`${t.field.canonicalString()} ${t.op} ${ho(t.value)}`}(i):i instanceof Ne?function(t){return t.op.toString()+" {"+t.getFilters().map(iI).join(" ,")+"}"}(i):"Filter"}var Vm=class extends we{constructor(e,t,n){super(e,t,n),this.key=W.fromName(n.referenceValue)}matches(e){let t=W.comparator(e.key,this.key);return this.matchesComparison(t)}},Bm=class extends we{constructor(e,t){super(e,"in",t),this.keys=sI("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Um=class extends we{constructor(e,t){super(e,"not-in",t),this.keys=sI("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function sI(i,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(n=>W.fromName(n.referenceValue))}var qm=class extends we{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return ul(t)&&cl(t.arrayValue,this.value)}},eh=class extends we{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&cl(this.value.arrayValue,t)}},zm=class extends we{constructor(e,t){super(e,"not-in",t)}matches(e){if(cl(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!cl(this.value.arrayValue,t)}},jm=class extends we{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!ul(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>cl(this.value.arrayValue,n))}};var Gm=class{constructor(e,t=null,n=[],s=[],r=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=s,this.limit=r,this.startAt=o,this.endAt=a,this.ue=null}};function Wm(i,e=null,t=[],n=[],s=null,r=null,o=null){return new Gm(i,e,t,n,s,r,o)}function Js(i){let e=G(i);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>Lm(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>function(r){return r.field.canonicalString()+r.dir}(n)).join(","),Sl(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>ho(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>ho(n)).join(",")),e.ue=t}return e.ue}function Al(i,e){if(i.limit!==e.limit||i.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<i.orderBy.length;t++)if(!TP(i.orderBy[t],e.orderBy[t]))return!1;if(i.filters.length!==e.filters.length)return!1;for(let t=0;t<i.filters.length;t++)if(!tI(i.filters[t],e.filters[t]))return!1;return i.collectionGroup===e.collectionGroup&&!!i.path.isEqual(e.path)&&!!HT(i.startAt,e.startAt)&&HT(i.endAt,e.endAt)}function th(i){return W.isDocumentKey(i.path)&&i.collectionGroup===null&&i.filters.length===0}function nh(i,e){return i.filters.filter(t=>t instanceof we&&t.field.isEqual(e))}function KT(i,e,t){let n=zu,s=!0;for(let r of nh(i,e)){let o=zu,a=!0;switch(r.op){case"<":case"<=":o=wP(r.value);break;case"==":case"in":case">=":o=r.value;break;case">":o=r.value,a=!1;break;case"!=":case"not-in":o=zu}jT({value:n,inclusive:s},{value:o,inclusive:a})<0&&(n=o,s=a)}if(t!==null){for(let r=0;r<i.orderBy.length;++r)if(i.orderBy[r].field.isEqual(e)){let o=t.position[r];jT({value:n,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(n=o,s=t.inclusive);break}}return{value:n,inclusive:s}}function QT(i,e,t){let n=is,s=!0;for(let r of nh(i,e)){let o=is,a=!0;switch(r.op){case">=":case">":o=EP(r.value),a=!1;break;case"==":case"in":case"<=":o=r.value;break;case"<":o=r.value,a=!1;break;case"!=":case"not-in":o=is}GT({value:n,inclusive:s},{value:o,inclusive:a})>0&&(n=o,s=a)}if(t!==null){for(let r=0;r<i.orderBy.length;++r)if(i.orderBy[r].field.isEqual(e)){let o=t.position[r];GT({value:n,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(n=o,s=t.inclusive);break}}return{value:n,inclusive:s}}var Un=class{constructor(e,t=null,n=[],s=[],r=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=s,this.limit=r,this.limitType=o,this.startAt=a,this.endAt=c,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function rI(i,e,t,n,s,r,o,a){return new Un(i,e,t,n,s,r,o,a)}function Ro(i){return new Un(i)}function $T(i){return i.filters.length===0&&i.limit===null&&i.startAt==null&&i.endAt==null&&(i.explicitOrderBy.length===0||i.explicitOrderBy.length===1&&i.explicitOrderBy[0].field.isKeyField())}function S_(i){return i.collectionGroup!==null}function ao(i){let e=G(i);if(e.ce===null){e.ce=[];let t=new Set;for(let r of e.explicitOrderBy)e.ce.push(r),t.add(r.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Me(st.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(r=>{t.has(r.canonicalString())||r.isKeyField()||e.ce.push(new Xs(r,n))}),t.has(st.keyField().canonicalString())||e.ce.push(new Xs(st.keyField(),n))}return e.ce}function Qt(i){let e=G(i);return e.le||(e.le=IP(e,ao(i))),e.le}function IP(i,e){if(i.limitType==="F")return Wm(i.path,i.collectionGroup,e,i.filters,i.limit,i.startAt,i.endAt);{e=e.map(s=>{let r=s.dir==="desc"?"asc":"desc";return new Xs(s.field,r)});let t=i.endAt?new ri(i.endAt.position,i.endAt.inclusive):null,n=i.startAt?new ri(i.startAt.position,i.startAt.inclusive):null;return Wm(i.path,i.collectionGroup,e,i.filters,i.limit,t,n)}}function Hm(i,e){let t=i.filters.concat([e]);return new Un(i.path,i.collectionGroup,i.explicitOrderBy.slice(),t,i.limit,i.limitType,i.startAt,i.endAt)}function ih(i,e,t){return new Un(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),e,t,i.startAt,i.endAt)}function Rl(i,e){return Al(Qt(i),Qt(e))&&i.limitType===e.limitType}function oI(i){return`${Js(Qt(i))}|lt:${i.limitType}`}function to(i){return`Query(target=${function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(s=>iI(s)).join(", ")}]`),Sl(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(s=>ho(s)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(s=>ho(s)).join(",")),`Target(${n})`}(Qt(i))}; limitType=${i.limitType})`}function xl(i,e){return e.isFoundDocument()&&function(n,s){let r=s.key.path;return n.collectionGroup!==null?s.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(r):W.isDocumentKey(n.path)?n.path.isEqual(r):n.path.isImmediateParentOf(r)}(i,e)&&function(n,s){for(let r of ao(n))if(!r.field.isKeyField()&&s.data.field(r.field)===null)return!1;return!0}(i,e)&&function(n,s){for(let r of n.filters)if(!r.matches(s))return!1;return!0}(i,e)&&function(n,s){return!(n.startAt&&!function(o,a,c){let u=WT(o,a,c);return o.inclusive?u<=0:u<0}(n.startAt,ao(n),s)||n.endAt&&!function(o,a,c){let u=WT(o,a,c);return o.inclusive?u>=0:u>0}(n.endAt,ao(n),s))}(i,e)}function aI(i){return i.collectionGroup||(i.path.length%2==1?i.path.lastSegment():i.path.get(i.path.length-2))}function lI(i){return(e,t)=>{let n=!1;for(let s of ao(i)){let r=CP(s,e,t);if(r!==0)return r;n=n||s.field.isKeyField()}return 0}}function CP(i,e,t){let n=i.field.isKeyField()?W.comparator(e.key,t.key):function(r,o,a){let c=o.data.field(r),u=a.data.field(r);return c!==null&&u!==null?cs(c,u):H()}(i.field,e,t);switch(i.dir){case"asc":return n;case"desc":return-1*n;default:return H()}}var oi=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(let[s,r]of n)if(this.equalsFn(s,e))return r}}has(e){return this.get(e)!==void 0}set(e,t){let n=this.mapKeyFn(e),s=this.inner[n];if(s===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return void(s[r]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],e))return n.length===1?delete this.inner[t]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(e){or(this.inner,(t,n)=>{for(let[s,r]of n)e(s,r)})}isEmpty(){return $1(this.inner)}size(){return this.innerSize}};var bP=new Ge(W.comparator);function tn(){return bP}var cI=new Ge(W.comparator);function Ja(...i){let e=cI;for(let t of i)e=e.insert(t.key,t);return e}function uI(i){let e=cI;return i.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function ei(){return tl()}function hI(){return tl()}function tl(){return new oi(i=>i.toString(),(i,e)=>i.isEqual(e))}var SP=new Ge(W.comparator),AP=new Me(W.comparator);function fe(...i){let e=AP;for(let t of i)e=e.add(t);return e}var RP=new Me(ce);function A_(){return RP}function R_(i,e){if(i.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ol(e)?"-0":e}}function dI(i){return{integerValue:""+i}}function fI(i,e){return G1(e)?dI(e):R_(i,e)}var po=class{constructor(){this._=void 0}};function xP(i,e,t){return i instanceof us?function(s,r){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return r&&jh(r)&&(r=C_(r)),r&&(o.fields.__previous_value__=r),{mapValue:o}}(t,e):i instanceof Si?mI(i,e):i instanceof Ai?gI(i,e):function(s,r){let o=pI(s,r),a=YT(o)+YT(s.Pe);return Mm(o)&&Mm(s.Pe)?dI(a):R_(s.serializer,a)}(i,e)}function PP(i,e,t){return i instanceof Si?mI(i,e):i instanceof Ai?gI(i,e):t}function pI(i,e){return i instanceof hs?function(n){return Mm(n)||function(r){return!!r&&"doubleValue"in r}(n)}(e)?e:{integerValue:0}:null}var us=class extends po{},Si=class extends po{constructor(e){super(),this.elements=e}};function mI(i,e){let t=_I(e);for(let n of i.elements)t.some(s=>si(s,n))||t.push(n);return{arrayValue:{values:t}}}var Ai=class extends po{constructor(e){super(),this.elements=e}};function gI(i,e){let t=_I(e);for(let n of i.elements)t=t.filter(s=>!si(s,n));return{arrayValue:{values:t}}}var hs=class extends po{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function YT(i){return He(i.integerValue||i.doubleValue)}function _I(i){return ul(i)&&i.arrayValue.values?i.arrayValue.values.slice():[]}var Zs=class{constructor(e,t){this.field=e,this.transform=t}};function DP(i,e){return i.field.isEqual(e.field)&&function(n,s){return n instanceof Si&&s instanceof Si||n instanceof Ai&&s instanceof Ai?co(n.elements,s.elements,si):n instanceof hs&&s instanceof hs?si(n.Pe,s.Pe):n instanceof us&&s instanceof us}(i.transform,e.transform)}var Km=class{constructor(e,t){this.version=e,this.transformResults=t}},et=class i{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new i}static exists(e){return new i(void 0,e)}static updateTime(e){return new i(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Gu(i,e){return i.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(i.updateTime):i.exists===void 0||i.exists===e.isFoundDocument()}var mo=class{};function yI(i,e){if(!i.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return i.isNoDocument()?new fs(i.key,et.none()):new ds(i.key,i.data,et.none());{let t=i.data,n=Lt.empty(),s=new Me(st.comparator);for(let r of e.fields)if(!s.has(r)){let o=t.field(r);o===null&&r.length>1&&(r=r.popLast(),o=t.field(r)),o===null?n.delete(r):n.set(r,o),s=s.add(r)}return new qn(i.key,n,new hn(s.toArray()),et.none())}}function NP(i,e,t){i instanceof ds?function(s,r,o){let a=s.value.clone(),c=JT(s.fieldTransforms,r,o.transformResults);a.setAll(c),r.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(i,e,t):i instanceof qn?function(s,r,o){if(!Gu(s.precondition,r))return void r.convertToUnknownDocument(o.version);let a=JT(s.fieldTransforms,r,o.transformResults),c=r.data;c.setAll(vI(s)),c.setAll(a),r.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(i,e,t):function(s,r,o){r.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function nl(i,e,t,n){return i instanceof ds?function(r,o,a,c){if(!Gu(r.precondition,o))return a;let u=r.value.clone(),d=ZT(r.fieldTransforms,c,o);return u.setAll(d),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(i,e,t,n):i instanceof qn?function(r,o,a,c){if(!Gu(r.precondition,o))return a;let u=ZT(r.fieldTransforms,c,o),d=o.data;return d.setAll(vI(r)),d.setAll(u),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(r.fieldMask.fields).unionWith(r.fieldTransforms.map(f=>f.field))}(i,e,t,n):function(r,o,a){return Gu(r.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(i,e,t)}function kP(i,e){let t=null;for(let n of i.fieldTransforms){let s=e.data.field(n.field),r=pI(n.transform,s||null);r!=null&&(t===null&&(t=Lt.empty()),t.set(n.field,r))}return t||null}function XT(i,e){return i.type===e.type&&!!i.key.isEqual(e.key)&&!!i.precondition.isEqual(e.precondition)&&!!function(n,s){return n===void 0&&s===void 0||!(!n||!s)&&co(n,s,(r,o)=>DP(r,o))}(i.fieldTransforms,e.fieldTransforms)&&(i.type===0?i.value.isEqual(e.value):i.type!==1||i.data.isEqual(e.data)&&i.fieldMask.isEqual(e.fieldMask))}var ds=class extends mo{constructor(e,t,n,s=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}},qn=class extends mo{constructor(e,t,n,s,r=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=s,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}};function vI(i){let e=new Map;return i.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let n=i.data.field(t);e.set(t,n)}}),e}function JT(i,e,t){let n=new Map;$(i.length===t.length);for(let s=0;s<t.length;s++){let r=i[s],o=r.transform,a=e.data.field(r.field);n.set(r.field,PP(o,a,t[s]))}return n}function ZT(i,e,t){let n=new Map;for(let s of i){let r=s.transform,o=t.data.field(s.field);n.set(s.field,xP(r,o,e))}return n}var fs=class extends mo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},hl=class extends mo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var dl=class{constructor(e,t,n,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let s=0;s<this.mutations.length;s++){let r=this.mutations[s];r.key.isEqual(e.key)&&NP(r,e,n[s])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=nl(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=nl(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=hI();return this.mutations.forEach(s=>{let r=e.get(s.key),o=r.overlayedDocument,a=this.applyToLocalView(o,r.mutatedFields);a=t.has(s.key)?null:a;let c=yI(o,a);c!==null&&n.set(s.key,c),o.isValidDocument()||o.convertToNoDocument(J.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),fe())}isEqual(e){return this.batchId===e.batchId&&co(this.mutations,e.mutations,(t,n)=>XT(t,n))&&co(this.baseMutations,e.baseMutations,(t,n)=>XT(t,n))}},Qm=class i{constructor(e,t,n,s){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=s}static from(e,t,n){$(e.mutations.length===n.length);let s=function(){return SP}(),r=e.mutations;for(let o=0;o<r.length;o++)s=s.insert(r[o].key,n[o].version);return new i(e,t,n,s)}};var fl=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var $m=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var ut,Te;function wI(i){switch(i){default:return H();case D.CANCELLED:case D.UNKNOWN:case D.DEADLINE_EXCEEDED:case D.RESOURCE_EXHAUSTED:case D.INTERNAL:case D.UNAVAILABLE:case D.UNAUTHENTICATED:return!1;case D.INVALID_ARGUMENT:case D.NOT_FOUND:case D.ALREADY_EXISTS:case D.PERMISSION_DENIED:case D.FAILED_PRECONDITION:case D.ABORTED:case D.OUT_OF_RANGE:case D.UNIMPLEMENTED:case D.DATA_LOSS:return!0}}function EI(i){if(i===void 0)return it("GRPC error has no .code"),D.UNKNOWN;switch(i){case ut.OK:return D.OK;case ut.CANCELLED:return D.CANCELLED;case ut.UNKNOWN:return D.UNKNOWN;case ut.DEADLINE_EXCEEDED:return D.DEADLINE_EXCEEDED;case ut.RESOURCE_EXHAUSTED:return D.RESOURCE_EXHAUSTED;case ut.INTERNAL:return D.INTERNAL;case ut.UNAVAILABLE:return D.UNAVAILABLE;case ut.UNAUTHENTICATED:return D.UNAUTHENTICATED;case ut.INVALID_ARGUMENT:return D.INVALID_ARGUMENT;case ut.NOT_FOUND:return D.NOT_FOUND;case ut.ALREADY_EXISTS:return D.ALREADY_EXISTS;case ut.PERMISSION_DENIED:return D.PERMISSION_DENIED;case ut.FAILED_PRECONDITION:return D.FAILED_PRECONDITION;case ut.ABORTED:return D.ABORTED;case ut.OUT_OF_RANGE:return D.OUT_OF_RANGE;case ut.UNIMPLEMENTED:return D.UNIMPLEMENTED;case ut.DATA_LOSS:return D.DATA_LOSS;default:return H()}}(Te=ut||(ut={}))[Te.OK=0]="OK",Te[Te.CANCELLED=1]="CANCELLED",Te[Te.UNKNOWN=2]="UNKNOWN",Te[Te.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Te[Te.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Te[Te.NOT_FOUND=5]="NOT_FOUND",Te[Te.ALREADY_EXISTS=6]="ALREADY_EXISTS",Te[Te.PERMISSION_DENIED=7]="PERMISSION_DENIED",Te[Te.UNAUTHENTICATED=16]="UNAUTHENTICATED",Te[Te.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Te[Te.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Te[Te.ABORTED=10]="ABORTED",Te[Te.OUT_OF_RANGE=11]="OUT_OF_RANGE",Te[Te.UNIMPLEMENTED=12]="UNIMPLEMENTED",Te[Te.INTERNAL=13]="INTERNAL",Te[Te.UNAVAILABLE=14]="UNAVAILABLE",Te[Te.DATA_LOSS=15]="DATA_LOSS";var e1=null;function TI(){return new TextEncoder}var OP=new Ji([4294967295,4294967295],0);function t1(i){let e=TI().encode(i),t=new um;return t.update(e),new Uint8Array(t.digest())}function n1(i){let e=new DataView(i.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),s=e.getUint32(8,!0),r=e.getUint32(12,!0);return[new Ji([t,n],0),new Ji([s,r],0)]}var Ym=class i{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Ks(`Invalid padding: ${t}`);if(n<0)throw new Ks(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new Ks(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new Ks(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Ji.fromNumber(this.Ie)}Ee(e,t,n){let s=e.add(t.multiply(Ji.fromNumber(n)));return s.compare(OP)===1&&(s=new Ji([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=t1(e),[n,s]=n1(t);for(let r=0;r<this.hashCount;r++){let o=this.Ee(n,s,r);if(!this.de(o))return!1}return!0}static create(e,t,n){let s=e%8==0?0:8-e%8,r=new Uint8Array(Math.ceil(e/8)),o=new i(r,s,t);return n.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;let t=t1(e),[n,s]=n1(t);for(let r=0;r<this.hashCount;r++){let o=this.Ee(n,s,r);this.Ae(o)}}Ae(e){let t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}},Ks=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var pl=class i{constructor(e,t,n,s,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let s=new Map;return s.set(e,ml.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new i(J.min(),s,new Ge(ce),tn(),fe())}},ml=class i{constructor(e,t,n,s,r){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new i(n,t,fe(),fe(),fe())}};var lo=class{constructor(e,t,n,s){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=s}},sh=class{constructor(e,t){this.targetId=e,this.me=t}},rh=class{constructor(e,t,n=ot.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=s}},oh=class{constructor(){this.fe=0,this.ge=s1(),this.pe=ot.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=fe(),t=fe(),n=fe();return this.ge.forEach((s,r)=>{switch(r){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:n=n.add(s);break;default:H()}}),new ml(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=s1()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,$(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},Xm=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=tn(),this.qe=i1(),this.Qe=new Ge(ce)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:H()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,s)=>{this.ze(s)&&t(s)})}He(e){let t=e.targetId,n=e.me.count,s=this.Je(t);if(s){let r=s.target;if(th(r))if(n===0){let o=new W(r.path);this.Ue(t,o,ft.newNoDocument(o,J.min()))}else $(n===1);else{let o=this.Ye(t);if(o!==n){let a=this.Ze(e),c=a?this.Xe(a,e,o):1;if(c!==0){this.je(t);let u=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,u)}e1?.et(function(d,f,m,_,v){var C,R,U,q,z,Y;let he={localCacheCount:d,existenceFilterCount:f.count,databaseId:m.database,projectId:m.projectId},ee=f.unchangedNames;return ee&&(he.bloomFilter={applied:v===0,hashCount:(C=ee?.hashCount)!==null&&C!==void 0?C:0,bitmapLength:(q=(U=(R=ee?.bits)===null||R===void 0?void 0:R.bitmap)===null||U===void 0?void 0:U.length)!==null&&q!==void 0?q:0,padding:(Y=(z=ee?.bits)===null||z===void 0?void 0:z.padding)!==null&&Y!==void 0?Y:0,mightContain:T=>{var y;return(y=_?.mightContain(T))!==null&&y!==void 0&&y}}),he}(o,e.me,this.Le.tt(),a,c))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:n="",padding:s=0},hashCount:r=0}=t,o,a;try{o=as(n).toUint8Array()}catch(c){if(c instanceof Ju)return Bn("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{a=new Ym(o,s,r)}catch(c){return Bn(c instanceof Ks?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return a.Ie===0?null:a}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){let n=this.Le.getRemoteKeysForTarget(t),s=0;return n.forEach(r=>{let o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${r.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,r,null),s++)}),s}rt(e){let t=new Map;this.Be.forEach((r,o)=>{let a=this.Je(o);if(a){if(r.current&&th(a.target)){let c=new W(a.target.path);this.ke.get(c)!==null||this.it(o,c)||this.Ue(o,c,ft.newNoDocument(c,e))}r.be&&(t.set(o,r.ve()),r.Ce())}});let n=fe();this.qe.forEach((r,o)=>{let a=!0;o.forEachWhile(c=>{let u=this.Je(c);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(n=n.add(r))}),this.ke.forEach((r,o)=>o.setReadTime(e));let s=new pl(e,t,this.Qe,this.ke,n);return this.ke=tn(),this.qe=i1(),this.Qe=new Ge(ce),s}$e(e,t){if(!this.ze(e))return;let n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;let s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new oh,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Me(ce),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||F("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new oh),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function i1(){return new Ge(W.comparator)}function s1(){return new Ge(W.comparator)}var MP={asc:"ASCENDING",desc:"DESCENDING"},FP={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},LP={and:"AND",or:"OR"},Jm=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Zm(i,e){return i.useProto3Json||Sl(e)?e:{value:e}}function go(i,e){return i.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function II(i,e){return i.useProto3Json?e.toBase64():e.toUint8Array()}function VP(i,e){return go(i,e.toTimestamp())}function rt(i){return $(!!i),J.fromTimestamp(function(t){let n=bi(t);return new $e(n.seconds,n.nanos)}(i))}function x_(i,e){return eg(i,e).canonicalString()}function eg(i,e){let t=function(s){return new Ie(["projects",s.projectId,"databases",s.database])}(i).child("documents");return e===void 0?t:t.child(e)}function CI(i){let e=Ie.fromString(i);return $(OI(e)),e}function gl(i,e){return x_(i.databaseId,e.path)}function ni(i,e){let t=CI(e);if(t.get(1)!==i.databaseId.projectId)throw new M(D.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+i.databaseId.projectId);if(t.get(3)!==i.databaseId.database)throw new M(D.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+i.databaseId.database);return new W(AI(t))}function bI(i,e){return x_(i.databaseId,e)}function SI(i){let e=CI(i);return e.length===4?Ie.emptyPath():AI(e)}function tg(i){return new Ie(["projects",i.databaseId.projectId,"databases",i.databaseId.database]).canonicalString()}function AI(i){return $(i.length>4&&i.get(4)==="documents"),i.popFirst(5)}function r1(i,e,t){return{name:gl(i,e),fields:t.value.mapValue.fields}}function RI(i,e,t){let n=ni(i,e.name),s=rt(e.updateTime),r=e.createTime?rt(e.createTime):J.min(),o=new Lt({mapValue:{fields:e.fields}}),a=ft.newFoundDocument(n,s,r,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function BP(i,e){return"found"in e?function(n,s){$(!!s.found),s.found.name,s.found.updateTime;let r=ni(n,s.found.name),o=rt(s.found.updateTime),a=s.found.createTime?rt(s.found.createTime):J.min(),c=new Lt({mapValue:{fields:s.found.fields}});return ft.newFoundDocument(r,o,a,c)}(i,e):"missing"in e?function(n,s){$(!!s.missing),$(!!s.readTime);let r=ni(n,s.missing),o=rt(s.readTime);return ft.newNoDocument(r,o)}(i,e):H()}function UP(i,e){let t;if("targetChange"in e){e.targetChange;let n=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:H()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],r=function(u,d){return u.useProto3Json?($(d===void 0||typeof d=="string"),ot.fromBase64String(d||"")):($(d===void 0||d instanceof Buffer||d instanceof Uint8Array),ot.fromUint8Array(d||new Uint8Array))}(i,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){let d=u.code===void 0?D.UNKNOWN:EI(u.code);return new M(d,u.message||"")}(o);t=new rh(n,s,r,a||null)}else if("documentChange"in e){e.documentChange;let n=e.documentChange;n.document,n.document.name,n.document.updateTime;let s=ni(i,n.document.name),r=rt(n.document.updateTime),o=n.document.createTime?rt(n.document.createTime):J.min(),a=new Lt({mapValue:{fields:n.document.fields}}),c=ft.newFoundDocument(s,r,o,a),u=n.targetIds||[],d=n.removedTargetIds||[];t=new lo(u,d,c.key,c)}else if("documentDelete"in e){e.documentDelete;let n=e.documentDelete;n.document;let s=ni(i,n.document),r=n.readTime?rt(n.readTime):J.min(),o=ft.newNoDocument(s,r),a=n.removedTargetIds||[];t=new lo([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let n=e.documentRemove;n.document;let s=ni(i,n.document),r=n.removedTargetIds||[];t=new lo([],r,s,null)}else{if(!("filter"in e))return H();{e.filter;let n=e.filter;n.targetId;let{count:s=0,unchangedNames:r}=n,o=new $m(s,r),a=n.targetId;t=new sh(a,o)}}return t}function _l(i,e){let t;if(e instanceof ds)t={update:r1(i,e.key,e.value)};else if(e instanceof fs)t={delete:gl(i,e.key)};else if(e instanceof qn)t={update:r1(i,e.key,e.data),updateMask:HP(e.fieldMask)};else{if(!(e instanceof hl))return H();t={verify:gl(i,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(r,o){let a=o.transform;if(a instanceof us)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Si)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Ai)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof hs)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw H()}(0,n))),e.precondition.isNone||(t.currentDocument=function(s,r){return r.updateTime!==void 0?{updateTime:VP(s,r.updateTime)}:r.exists!==void 0?{exists:r.exists}:H()}(i,e.precondition)),t}function ng(i,e){let t=e.currentDocument?function(r){return r.updateTime!==void 0?et.updateTime(rt(r.updateTime)):r.exists!==void 0?et.exists(r.exists):et.none()}(e.currentDocument):et.none(),n=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let c=null;if("setToServerValue"in a)$(a.setToServerValue==="REQUEST_TIME"),c=new us;else if("appendMissingElements"in a){let d=a.appendMissingElements.values||[];c=new Si(d)}else if("removeAllFromArray"in a){let d=a.removeAllFromArray.values||[];c=new Ai(d)}else"increment"in a?c=new hs(o,a.increment):H();let u=st.fromServerFormat(a.fieldPath);return new Zs(u,c)}(i,s)):[];if(e.update){e.update.name;let s=ni(i,e.update.name),r=new Lt({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(c){let u=c.fieldPaths||[];return new hn(u.map(d=>st.fromServerFormat(d)))}(e.updateMask);return new qn(s,r,o,t,n)}return new ds(s,r,t,n)}if(e.delete){let s=ni(i,e.delete);return new fs(s,t)}if(e.verify){let s=ni(i,e.verify);return new hl(s,t)}return H()}function qP(i,e){return i&&i.length>0?($(e!==void 0),i.map(t=>function(s,r){let o=s.updateTime?rt(s.updateTime):rt(r);return o.isEqual(J.min())&&(o=rt(r)),new Km(o,s.transformResults||[])}(t,e))):[]}function xI(i,e){return{documents:[bI(i,e.path)]}}function PI(i,e){let t={structuredQuery:{}},n=e.path,s;e.collectionGroup!==null?(s=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=bI(i,s);let r=function(u){if(u.length!==0)return kI(Ne.create(u,"and"))}(e.filters);r&&(t.structuredQuery.where=r);let o=function(u){if(u.length!==0)return u.map(d=>function(m){return{field:no(m.field),direction:jP(m.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=Zm(i,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{_t:t,parent:s}}function DI(i){let e=SI(i.parent),t=i.structuredQuery,n=t.from?t.from.length:0,s=null;if(n>0){$(n===1);let d=t.from[0];d.allDescendants?s=d.collectionId:e=e.child(d.collectionId)}let r=[];t.where&&(r=function(f){let m=NI(f);return m instanceof Ne&&b_(m)?m.getFilters():[m]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(m=>function(v){return new Xs(io(v.field),function(R){switch(R){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(v.direction))}(m))}(t.orderBy));let a=null;t.limit&&(a=function(f){let m;return m=typeof f=="object"?f.value:f,Sl(m)?null:m}(t.limit));let c=null;t.startAt&&(c=function(f){let m=!!f.before,_=f.values||[];return new ri(_,m)}(t.startAt));let u=null;return t.endAt&&(u=function(f){let m=!f.before,_=f.values||[];return new ri(_,m)}(t.endAt)),rI(e,s,o,r,a,"F",c,u)}function zP(i,e){let t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return H()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function NI(i){return i.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let n=io(t.unaryFilter.field);return we.create(n,"==",{doubleValue:NaN});case"IS_NULL":let s=io(t.unaryFilter.field);return we.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=io(t.unaryFilter.field);return we.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=io(t.unaryFilter.field);return we.create(o,"!=",{nullValue:"NULL_VALUE"});default:return H()}}(i):i.fieldFilter!==void 0?function(t){return we.create(io(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return H()}}(t.fieldFilter.op),t.fieldFilter.value)}(i):i.compositeFilter!==void 0?function(t){return Ne.create(t.compositeFilter.filters.map(n=>NI(n)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return H()}}(t.compositeFilter.op))}(i):H()}function jP(i){return MP[i]}function GP(i){return FP[i]}function WP(i){return LP[i]}function no(i){return{fieldPath:i.canonicalString()}}function io(i){return st.fromServerFormat(i.fieldPath)}function kI(i){return i instanceof we?function(t){if(t.op==="=="){if(zT(t.value))return{unaryFilter:{field:no(t.field),op:"IS_NAN"}};if(qT(t.value))return{unaryFilter:{field:no(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(zT(t.value))return{unaryFilter:{field:no(t.field),op:"IS_NOT_NAN"}};if(qT(t.value))return{unaryFilter:{field:no(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:no(t.field),op:GP(t.op),value:t.value}}}(i):i instanceof Ne?function(t){let n=t.getFilters().map(s=>kI(s));return n.length===1?n[0]:{compositeFilter:{op:WP(t.op),filters:n}}}(i):H()}function HP(i){let e=[];return i.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function OI(i){return i.length>=4&&i.get(0)==="projects"&&i.get(2)==="databases"}var _o=class i{constructor(e,t,n,s,r=J.min(),o=J.min(),a=ot.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(e){return new i(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new i(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new i(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new i(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var ah=class{constructor(e){this.ct=e}};function KP(i,e){let t;if(e.document)t=RI(i.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let n=W.fromSegments(e.noDocument.path),s=tr(e.noDocument.readTime);t=ft.newNoDocument(n,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return H();{let n=W.fromSegments(e.unknownDocument.path),s=tr(e.unknownDocument.version);t=ft.newUnknownDocument(n,s)}}return e.readTime&&t.setReadTime(function(s){let r=new $e(s[0],s[1]);return J.fromTimestamp(r)}(e.readTime)),t}function o1(i,e){let t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:lh(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document=function(r,o){return{name:gl(r,o.key),fields:o.data.value.mapValue.fields,updateTime:go(r,o.version.toTimestamp()),createTime:go(r,o.createTime.toTimestamp())}}(i.ct,e);else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:er(e.version)};else{if(!e.isUnknownDocument())return H();n.unknownDocument={path:t.path.toArray(),version:er(e.version)}}return n}function lh(i){let e=i.toTimestamp();return[e.seconds,e.nanoseconds]}function er(i){let e=i.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function tr(i){let e=new $e(i.seconds,i.nanoseconds);return J.fromTimestamp(e)}function Gs(i,e){let t=(e.baseMutations||[]).map(r=>ng(i.ct,r));for(let r=0;r<e.mutations.length-1;++r){let o=e.mutations[r];if(r+1<e.mutations.length&&e.mutations[r+1].transform!==void 0){let a=e.mutations[r+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(r+1,1),++r}}let n=e.mutations.map(r=>ng(i.ct,r)),s=$e.fromMillis(e.localWriteTimeMs);return new dl(e.batchId,s,t,n)}function Za(i){let e=tr(i.readTime),t=i.lastLimboFreeSnapshotVersion!==void 0?tr(i.lastLimboFreeSnapshotVersion):J.min(),n;return n=function(r){return r.documents!==void 0}(i.query)?function(r){return $(r.documents.length===1),Qt(Ro(SI(r.documents[0])))}(i.query):function(r){return Qt(DI(r))}(i.query),new _o(n,i.targetId,"TargetPurposeListen",i.lastListenSequenceNumber,e,t,ot.fromBase64String(i.resumeToken))}function MI(i,e){let t=er(e.snapshotVersion),n=er(e.lastLimboFreeSnapshotVersion),s;s=th(e.target)?xI(i.ct,e.target):PI(i.ct,e.target)._t;let r=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Js(e.target),readTime:t,resumeToken:r,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:s}}function P_(i){let e=DI({parent:i.parent,structuredQuery:i.structuredQuery});return i.limitType==="LAST"?ih(e,e.limit,"L"):e}function gm(i,e){return new fl(e.largestBatchId,ng(i.ct,e.overlayMutation))}function a1(i,e){let t=e.path.lastSegment();return[i,Kt(e.path.popLast()),t]}function l1(i,e,t,n){return{indexId:i,uid:e,sequenceNumber:t,readTime:er(n.readTime),documentKey:Kt(n.documentKey.path),largestBatchId:n.largestBatchId}}var ig=class{getBundleMetadata(e,t){return c1(e).get(t).next(n=>{if(n)return function(r){return{id:r.bundleId,createTime:tr(r.createTime),version:r.version}}(n)})}saveBundleMetadata(e,t){return c1(e).put(function(s){return{bundleId:s.id,createTime:er(rt(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return u1(e).get(t).next(n=>{if(n)return function(r){return{name:r.name,query:P_(r.bundledQuery),readTime:tr(r.readTime)}}(n)})}saveNamedQuery(e,t){return u1(e).put(function(s){return{name:s.name,readTime:er(rt(s.readTime)),bundledQuery:s.bundledQuery}}(t))}};function c1(i){return wt(i,"bundles")}function u1(i){return wt(i,"namedQueries")}var ch=class i{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){let n=t.uid||"";return new i(e,n)}getOverlay(e,t){return Qa(e).get(a1(this.userId,t)).next(n=>n?gm(this.serializer,n):null)}getOverlays(e,t){let n=ei();return x.forEach(t,s=>this.getOverlay(e,s).next(r=>{r!==null&&n.set(s,r)})).next(()=>n)}saveOverlays(e,t,n){let s=[];return n.forEach((r,o)=>{let a=new fl(t,o);s.push(this.ht(e,a))}),x.waitFor(s)}removeOverlaysForBatchId(e,t,n){let s=new Set;t.forEach(o=>s.add(Kt(o.getCollectionPath())));let r=[];return s.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,n],[this.userId,o,n+1],!1,!0);r.push(Qa(e).j("collectionPathOverlayIndex",a))}),x.waitFor(r)}getOverlaysForCollection(e,t,n){let s=ei(),r=Kt(t),o=IDBKeyRange.bound([this.userId,r,n],[this.userId,r,Number.POSITIVE_INFINITY],!0);return Qa(e).U("collectionPathOverlayIndex",o).next(a=>{for(let c of a){let u=gm(this.serializer,c);s.set(u.getKey(),u)}return s})}getOverlaysForCollectionGroup(e,t,n,s){let r=ei(),o,a=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Qa(e).J({index:"collectionGroupOverlayIndex",range:a},(c,u,d)=>{let f=gm(this.serializer,u);r.size()<s||f.largestBatchId===o?(r.set(f.getKey(),f),o=f.largestBatchId):d.done()}).next(()=>r)}ht(e,t){return Qa(e).put(function(s,r,o){let[a,c,u]=a1(r,o.mutation.key);return{userId:r,collectionPath:c,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:_l(s.ct,o.mutation)}}(this.serializer,this.userId,t))}};function Qa(i){return wt(i,"documentOverlays")}var sg=class{Pt(e){return wt(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{let n=t?.value;return n?ot.fromUint8Array(n):ot.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}};var Ii=class{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(He(e.integerValue));else if("doubleValue"in e){let n=He(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),ol(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),typeof n=="string"&&(n=bi(n)),t.Rt(`${n.seconds||""}`),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(as(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?X1(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Gh(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):H()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){let n=e.fields||{};this.dt(t,55);for(let s of Object.keys(n))this.Vt(s,t),this.Tt(n[s],t)}wt(e,t){var n,s;let r=e.fields||{};this.dt(t,53);let o="value",a=((s=(n=r[o].arrayValue)===null||n===void 0?void 0:n.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At(He(a)),this.Vt(o,t),this.Tt(r[o],t)}bt(e,t){let n=e.values||[];this.dt(t,50);for(let s of n)this.Tt(s,t)}yt(e,t){this.dt(t,37),W.fromName(e).path.forEach(n=>{this.dt(t,60),this.Dt(n,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}};Ii.vt=new Ii;function QP(i){if(i===0)return 8;let e=0;return!(i>>4)&&(e+=4,i<<=4),!(i>>6)&&(e+=2,i<<=2),!(i>>7)&&(e+=1),e}function h1(i){let e=64-function(n){let s=0;for(let r=0;r<8;++r){let o=QP(255&n[r]);if(s+=o,o!==8)break}return s}(i);return Math.ceil(e/8)}var rg=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Ft(n.value),n=t.next();this.Mt()}xt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Ot(n.value),n=t.next();this.Nt()}Lt(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.Ft(n);else if(n<2048)this.Ft(960|n>>>6),this.Ft(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|n>>>12),this.Ft(128|63&n>>>6),this.Ft(128|63&n);else{let s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.Ot(n);else if(n<2048)this.Ot(960|n>>>6),this.Ot(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|n>>>12),this.Ot(128|63&n>>>6),this.Ot(128|63&n);else{let s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){let t=this.qt(e),n=h1(t);this.Qt(1+n),this.buffer[this.position++]=255&n;for(let s=t.length-n;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){let t=this.qt(e),n=h1(t);this.Qt(1+n),this.buffer[this.position++]=~(255&n);for(let s=t.length-n;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){let t=function(r){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,r,!1),new Uint8Array(o.buffer)}(e),n=(128&t[0])!=0;t[0]^=n?255:128;for(let s=1;s<t.length;++s)t[s]^=n?255:0;return t}Ft(e){let t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){let t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let s=new Uint8Array(n);s.set(this.buffer),this.buffer=s}},og=class{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}},ag=class{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}},Ws=class{constructor(){this.jt=new rg,this.Ht=new og(this.jt),this.Jt=new ag(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}};var Hs=class i{constructor(e,t,n,s){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=s}Zt(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new i(this.indexId,this.documentKey,this.arrayValue,n)}};function Zi(i,e){let t=i.indexId-e.indexId;return t!==0?t:(t=d1(i.arrayValue,e.arrayValue),t!==0?t:(t=d1(i.directionalValue,e.directionalValue),t!==0?t:W.comparator(i.documentKey,e.documentKey)))}function d1(i,e){for(let t=0;t<i.length&&t<e.length;++t){let n=i[t]-e[t];if(n!==0)return n}return i.length-e.length}var uh=class{constructor(e){this.Xt=new Me((t,n)=>st.comparator(t.field,n.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(let t of e.filters){let n=t;n.isInequality()?this.Xt=this.Xt.add(n):this.tn.push(n)}}get nn(){return this.Xt.size>1}rn(e){if($(e.collectionGroup===this.collectionId),this.nn)return!1;let t=Rm(e);if(t!==void 0&&!this.sn(t))return!1;let n=zs(e),s=new Set,r=0,o=0;for(;r<n.length&&this.sn(n[r]);++r)s=s.add(n[r].fieldPath.canonicalString());if(r===n.length)return!0;if(this.Xt.size>0){let a=this.Xt.getIterator().getNext();if(!s.has(a.field.canonicalString())){let c=n[r];if(!this.on(a,c)||!this._n(this.en[o++],c))return!1}++r}for(;r<n.length;++r){let a=n[r];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new Me(st.comparator),t=[];for(let n of this.tn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")t.push(new oo(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new oo(n.field,0))}for(let n of this.en)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new oo(n.field,n.dir==="asc"?0:1)));return new uo(uo.UNKNOWN_ID,this.collectionId,t,rl.empty())}sn(e){for(let t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let n=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===n}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function FI(i){var e,t;if($(i instanceof we||i instanceof Ne),i instanceof we){if(i instanceof eh){let s=((t=(e=i.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(r=>we.create(i.field,"==",r)))||[];return Ne.create(s,"or")}return i}let n=i.filters.map(s=>FI(s));return Ne.create(n,i.op)}function $P(i){if(i.getFilters().length===0)return[];let e=ug(FI(i));return $(LI(e)),lg(e)||cg(e)?[e]:e.getFilters()}function lg(i){return i instanceof we}function cg(i){return i instanceof Ne&&b_(i)}function LI(i){return lg(i)||cg(i)||function(t){if(t instanceof Ne&&Fm(t)){for(let n of t.getFilters())if(!lg(n)&&!cg(n))return!1;return!0}return!1}(i)}function ug(i){if($(i instanceof we||i instanceof Ne),i instanceof we)return i;if(i.filters.length===1)return ug(i.filters[0]);let e=i.filters.map(n=>ug(n)),t=Ne.create(e,i.op);return t=hh(t),LI(t)?t:($(t instanceof Ne),$(fo(t)),$(t.filters.length>1),t.filters.reduce((n,s)=>D_(n,s)))}function D_(i,e){let t;return $(i instanceof we||i instanceof Ne),$(e instanceof we||e instanceof Ne),t=i instanceof we?e instanceof we?function(s,r){return Ne.create([s,r],"and")}(i,e):f1(i,e):e instanceof we?f1(e,i):function(s,r){if($(s.filters.length>0&&r.filters.length>0),fo(s)&&fo(r))return nI(s,r.getFilters());let o=Fm(s)?s:r,a=Fm(s)?r:s,c=o.filters.map(u=>D_(u,a));return Ne.create(c,"or")}(i,e),hh(t)}function f1(i,e){if(fo(e))return nI(e,i.getFilters());{let t=e.filters.map(n=>D_(i,n));return Ne.create(t,"or")}}function hh(i){if($(i instanceof we||i instanceof Ne),i instanceof we)return i;let e=i.getFilters();if(e.length===1)return hh(e[0]);if(eI(i))return i;let t=e.map(s=>hh(s)),n=[];return t.forEach(s=>{s instanceof we?n.push(s):s instanceof Ne&&(s.op===i.op?n.push(...s.filters):n.push(s))}),n.length===1?n[0]:Ne.create(n,i.op)}var hg=class{constructor(){this.un=new yl}addToCollectionParentIndex(e,t){return this.un.add(t),x.resolve()}getCollectionParents(e,t){return x.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return x.resolve()}deleteFieldIndex(e,t){return x.resolve()}deleteAllFieldIndexes(e){return x.resolve()}createTargetIndexes(e,t){return x.resolve()}getDocumentsMatchingTarget(e,t){return x.resolve(null)}getIndexType(e,t){return x.resolve(0)}getFieldIndexes(e,t){return x.resolve([])}getNextCollectionGroupToUpdate(e){return x.resolve(null)}getMinOffset(e,t){return x.resolve(Dn.min())}getMinOffsetFromCollectionGroup(e,t){return x.resolve(Dn.min())}updateCollectionGroup(e,t,n){return x.resolve()}updateIndexEntries(e,t){return x.resolve()}},yl=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),s=this.index[t]||new Me(Ie.comparator),r=!s.has(n);return this.index[t]=s.add(n),r}has(e){let t=e.lastSegment(),n=e.popLast(),s=this.index[t];return s&&s.has(n)}getEntries(e){return(this.index[e]||new Me(Ie.comparator)).toArray()}};var Lu=new Uint8Array(0),dg=class{constructor(e,t){this.databaseId=t,this.cn=new yl,this.ln=new oi(n=>Js(n),(n,s)=>Al(n,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){let n=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});let r={collectionId:n,parent:Kt(s)};return p1(e).put(r)}return x.resolve()}getCollectionParents(e,t){let n=[],s=IDBKeyRange.bound([t,""],[B1(t),""],!1,!0);return p1(e).U(s).next(r=>{for(let o of r){if(o.collectionId!==t)break;n.push(Zn(o.parent))}return n})}addFieldIndex(e,t){let n=$a(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(t);delete s.indexId;let r=n.add(s);if(t.indexState){let o=Jr(e);return r.next(a=>{o.put(l1(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return r.next()}deleteFieldIndex(e,t){let n=$a(e),s=Jr(e),r=Xr(e);return n.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=$a(e),n=Xr(e),s=Jr(e);return t.j().next(()=>n.j()).next(()=>s.j())}createTargetIndexes(e,t){return x.forEach(this.hn(t),n=>this.getIndexType(e,n).next(s=>{if(s===0||s===1){let r=new uh(n).an();if(r!=null)return this.addFieldIndex(e,r)}}))}getDocumentsMatchingTarget(e,t){let n=Xr(e),s=!0,r=new Map;return x.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{s&&(s=!!a),r.set(o,a)})).next(()=>{if(s){let o=fe(),a=[];return x.forEach(r,(c,u)=>{F("IndexedDbIndexManager",`Using index ${function(z){return`id=${z.indexId}|cg=${z.collectionGroup}|f=${z.fields.map(Y=>`${Y.fieldPath}:${Y.kind}`).join(",")}`}(c)} to execute ${Js(t)}`);let d=function(z,Y){let he=Rm(Y);if(he===void 0)return null;for(let ee of nh(z,he.fieldPath))switch(ee.op){case"array-contains-any":return ee.value.arrayValue.values||[];case"array-contains":return[ee.value]}return null}(u,c),f=function(z,Y){let he=new Map;for(let ee of zs(Y))for(let T of nh(z,ee.fieldPath))switch(T.op){case"==":case"in":he.set(ee.fieldPath.canonicalString(),T.value);break;case"not-in":case"!=":return he.set(ee.fieldPath.canonicalString(),T.value),Array.from(he.values())}return null}(u,c),m=function(z,Y){let he=[],ee=!0;for(let T of zs(Y)){let y=T.kind===0?KT(z,T.fieldPath,z.startAt):QT(z,T.fieldPath,z.startAt);he.push(y.value),ee&&(ee=y.inclusive)}return new ri(he,ee)}(u,c),_=function(z,Y){let he=[],ee=!0;for(let T of zs(Y)){let y=T.kind===0?QT(z,T.fieldPath,z.endAt):KT(z,T.fieldPath,z.endAt);he.push(y.value),ee&&(ee=y.inclusive)}return new ri(he,ee)}(u,c),v=this.In(c,u,m),C=this.In(c,u,_),R=this.Tn(c,u,f),U=this.En(c.indexId,d,v,m.inclusive,C,_.inclusive,R);return x.forEach(U,q=>n.G(q,t.limit).next(z=>{z.forEach(Y=>{let he=W.fromSegments(Y.documentKey);o.has(he)||(o=o.add(he),a.push(he))})}))}).next(()=>a)}return x.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=$P(Ne.create(e.filters,"and")).map(n=>Wm(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,n,s,r,o,a){let c=(t!=null?t.length:1)*Math.max(n.length,r.length),u=c/(t!=null?t.length:1),d=[];for(let f=0;f<c;++f){let m=t?this.dn(t[f/u]):Lu,_=this.An(e,m,n[f%u],s),v=this.Rn(e,m,r[f%u],o),C=a.map(R=>this.An(e,m,R,!0));d.push(...this.createRange(_,v,C))}return d}An(e,t,n,s){let r=new Hs(e,W.empty(),t,n);return s?r:r.Zt()}Rn(e,t,n,s){let r=new Hs(e,W.empty(),t,n);return s?r.Zt():r}Pn(e,t){let n=new uh(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(r=>{let o=null;for(let a of r)n.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let n=2,s=this.hn(t);return x.forEach(s,r=>this.Pn(e,r).next(o=>{o?n!==0&&o.fields.length<function(c){let u=new Me(st.comparator),d=!1;for(let f of c.filters)for(let m of f.getFlattenedFilters())m.field.isKeyField()||(m.op==="array-contains"||m.op==="array-contains-any"?d=!0:u=u.add(m.field));for(let f of c.orderBy)f.field.isKeyField()||(u=u.add(f.field));return u.size+(d?1:0)}(r)&&(n=1):n=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&n===2?1:n)}Vn(e,t){let n=new Ws;for(let s of zs(e)){let r=t.data.field(s.fieldPath);if(r==null)return null;let o=n.Yt(s.kind);Ii.vt.It(r,o)}return n.zt()}dn(e){let t=new Ws;return Ii.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){let n=new Ws;return Ii.vt.It(Ys(this.databaseId,t),n.Yt(function(r){let o=zs(r);return o.length===0?0:o[o.length-1].kind}(e))),n.zt()}Tn(e,t,n){if(n===null)return[];let s=[];s.push(new Ws);let r=0;for(let o of zs(e)){let a=n[r++];for(let c of s)if(this.fn(t,o.fieldPath)&&ul(a))s=this.gn(s,o,a);else{let u=c.Yt(o.kind);Ii.vt.It(a,u)}}return this.pn(s)}In(e,t,n){return this.Tn(e,t,n.position)}pn(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].zt();return t}gn(e,t,n){let s=[...e],r=[];for(let o of n.arrayValue.values||[])for(let a of s){let c=new Ws;c.seed(a.zt()),Ii.vt.It(o,c.Yt(t.kind)),r.push(c)}return r}fn(e,t){return!!e.filters.find(n=>n instanceof we&&n.field.isEqual(t)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(e,t){let n=$a(e),s=Jr(e);return(t?n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.U()).next(r=>{let o=[];return x.forEach(r,a=>s.get([a.indexId,this.uid]).next(c=>{o.push(function(d,f){let m=f?new rl(f.sequenceNumber,new Dn(tr(f.readTime),new W(Zn(f.documentKey)),f.largestBatchId)):rl.empty(),_=d.fields.map(([v,C])=>new oo(st.fromServerFormat(v),C));return new uo(d.indexId,d.collectionGroup,_,m)}(a,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((n,s)=>{let r=n.indexState.sequenceNumber-s.indexState.sequenceNumber;return r!==0?r:ce(n.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,n){let s=$a(e),r=Jr(e);return this.yn(e).next(o=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>x.forEach(a,c=>r.put(l1(c.indexId,this.uid,o,n)))))}updateIndexEntries(e,t){let n=new Map;return x.forEach(t,(s,r)=>{let o=n.get(s.collectionGroup);return(o?x.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(n.set(s.collectionGroup,a),x.forEach(a,c=>this.wn(e,s,c).next(u=>{let d=this.Sn(r,c);return u.isEqual(d)?x.resolve():this.bn(e,r,c,u,d)}))))})}Dn(e,t,n,s){return Xr(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(n,t.key),documentKey:t.key.path.toArray()})}vn(e,t,n,s){return Xr(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(n,t.key),t.key.path.toArray()])}wn(e,t,n){let s=Xr(e),r=new Me(Zi);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.mn(n,t)])},(o,a)=>{r=r.add(new Hs(n.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>r)}Sn(e,t){let n=new Me(Zi),s=this.Vn(t,e);if(s==null)return n;let r=Rm(t);if(r!=null){let o=e.data.field(r.fieldPath);if(ul(o))for(let a of o.arrayValue.values||[])n=n.add(new Hs(t.indexId,e.key,this.dn(a),s))}else n=n.add(new Hs(t.indexId,e.key,Lu,s));return n}bn(e,t,n,s,r){F("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let o=[];return function(c,u,d,f,m){let _=c.getIterator(),v=u.getIterator(),C=Yr(_),R=Yr(v);for(;C||R;){let U=!1,q=!1;if(C&&R){let z=d(C,R);z<0?q=!0:z>0&&(U=!0)}else C!=null?q=!0:U=!0;U?(f(R),R=Yr(v)):q?(m(C),C=Yr(_)):(C=Yr(_),R=Yr(v))}}(s,r,Zi,a=>{o.push(this.Dn(e,t,n,a))},a=>{o.push(this.vn(e,t,n,a))}),x.waitFor(o)}yn(e){let t=1;return Jr(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,s,r)=>{r.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((o,a)=>Zi(o,a)).filter((o,a,c)=>!a||Zi(o,c[a-1])!==0);let s=[];s.push(e);for(let o of n){let a=Zi(o,e),c=Zi(o,t);if(a===0)s[0]=e.Zt();else if(a>0&&c<0)s.push(o),s.push(o.Zt());else if(c>0)break}s.push(t);let r=[];for(let o=0;o<s.length;o+=2){if(this.Cn(s[o],s[o+1]))return[];let a=[s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,Lu,[]],c=[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,Lu,[]];r.push(IDBKeyRange.bound(a,c))}return r}Cn(e,t){return Zi(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(m1)}getMinOffset(e,t){return x.mapArray(this.hn(t),n=>this.Pn(e,n).next(s=>s||H())).next(m1)}};function p1(i){return wt(i,"collectionParents")}function Xr(i){return wt(i,"indexEntries")}function $a(i){return wt(i,"indexConfiguration")}function Jr(i){return wt(i,"indexState")}function m1(i){$(i.length!==0);let e=i[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<i.length;n++){let s=i[n].indexState.offset;E_(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new Dn(e.readTime,e.documentKey,t)}var g1={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Pn=class i{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new i(e,i.DEFAULT_COLLECTION_PERCENTILE,i.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function VI(i,e,t){let n=i.store("mutations"),s=i.store("documentMutations"),r=[],o=IDBKeyRange.only(t.batchId),a=0,c=n.J({range:o},(d,f,m)=>(a++,m.delete()));r.push(c.next(()=>{$(a===1)}));let u=[];for(let d of t.mutations){let f=W1(e,d.key.path,t.batchId);r.push(s.delete(f)),u.push(d.key)}return x.waitFor(r).next(()=>u)}function dh(i){if(!i)return 0;let e;if(i.document)e=i.document;else if(i.unknownDocument)e=i.unknownDocument;else{if(!i.noDocument)throw H();e=i.noDocument}return JSON.stringify(e).length}Pn.DEFAULT_COLLECTION_PERCENTILE=10,Pn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Pn.DEFAULT=new Pn(41943040,Pn.DEFAULT_COLLECTION_PERCENTILE,Pn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Pn.DISABLED=new Pn(-1,0,0);var fh=class i{constructor(e,t,n,s){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=s,this.Fn={}}static lt(e,t,n,s){$(e.uid!=="");let r=e.isAuthenticated()?e.uid:"";return new i(r,t,n,s)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return es(e).J({index:"userMutationsIndex",range:n},(s,r,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,n,s){let r=so(e),o=es(e);return o.add({}).next(a=>{$(typeof a=="number");let c=new dl(a,t,n,s),u=function(_,v,C){let R=C.baseMutations.map(q=>_l(_.ct,q)),U=C.mutations.map(q=>_l(_.ct,q));return{userId:v,batchId:C.batchId,localWriteTimeMs:C.localWriteTime.toMillis(),baseMutations:R,mutations:U}}(this.serializer,this.userId,c),d=[],f=new Me((m,_)=>ce(m.canonicalString(),_.canonicalString()));for(let m of s){let _=W1(this.userId,m.key.path,a);f=f.add(m.key.path.popLast()),d.push(o.put(u)),d.push(r.put(_,tP))}return f.forEach(m=>{d.push(this.indexManager.addToCollectionParentIndex(e,m))}),e.addOnCommittedListener(()=>{this.Fn[a]=c.keys()}),x.waitFor(d).next(()=>c)})}lookupMutationBatch(e,t){return es(e).get(t).next(n=>n?($(n.userId===this.userId),Gs(this.serializer,n)):null)}Mn(e,t){return this.Fn[t]?x.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(n=>{if(n){let s=n.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,s=IDBKeyRange.lowerBound([this.userId,n]),r=null;return es(e).J({index:"userMutationsIndex",range:s},(o,a,c)=>{a.userId===this.userId&&($(a.batchId>=n),r=Gs(this.serializer,a)),c.done()}).next(()=>r)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return es(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,r,o)=>{n=r.batchId,o.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return es(e).U("userMutationsIndex",t).next(n=>n.map(s=>Gs(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=qu(this.userId,t.path),s=IDBKeyRange.lowerBound(n),r=[];return so(e).J({range:s},(o,a,c)=>{let[u,d,f]=o,m=Zn(d);if(u===this.userId&&t.path.isEqual(m))return es(e).get(f).next(_=>{if(!_)throw H();$(_.userId===this.userId),r.push(Gs(this.serializer,_))});c.done()}).next(()=>r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Me(ce),s=[];return t.forEach(r=>{let o=qu(this.userId,r.path),a=IDBKeyRange.lowerBound(o),c=so(e).J({range:a},(u,d,f)=>{let[m,_,v]=u,C=Zn(_);m===this.userId&&r.path.isEqual(C)?n=n.add(v):f.done()});s.push(c)}),x.waitFor(s).next(()=>this.xn(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,s=n.length+1,r=qu(this.userId,n),o=IDBKeyRange.lowerBound(r),a=new Me(ce);return so(e).J({range:o},(c,u,d)=>{let[f,m,_]=c,v=Zn(m);f===this.userId&&n.isPrefixOf(v)?v.length===s&&(a=a.add(_)):d.done()}).next(()=>this.xn(e,a))}xn(e,t){let n=[],s=[];return t.forEach(r=>{s.push(es(e).get(r).next(o=>{if(o===null)throw H();$(o.userId===this.userId),n.push(Gs(this.serializer,o))}))}),x.waitFor(s).next(()=>n)}removeMutationBatch(e,t){return VI(e._e,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),x.forEach(n,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return x.resolve();let n=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return so(e).J({range:n},(r,o,a)=>{if(r[0]===this.userId){let c=Zn(r[1]);s.push(c)}else a.done()}).next(()=>{$(s.length===0)})})}containsKey(e,t){return BI(e,this.userId,t)}Nn(e){return UI(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function BI(i,e,t){let n=qu(e,t.path),s=n[1],r=IDBKeyRange.lowerBound(n),o=!1;return so(i).J({range:r,H:!0},(a,c,u)=>{let[d,f,m]=a;d===e&&f===s&&(o=!0),u.done()}).next(()=>o)}function es(i){return wt(i,"mutations")}function so(i){return wt(i,"documentMutations")}function UI(i){return wt(i,"mutationQueues")}var yo=class i{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new i(0)}static kn(){return new i(-1)}};var fg=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{let n=new yo(t.highestTargetId);return t.highestTargetId=n.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>J.fromTimestamp(new $e(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,n&&(s.lastRemoteSnapshotVersion=n.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(n=>(n.targetCount+=1,this.$n(t,n),this.Qn(e,n))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Zr(e).delete(t.targetId)).next(()=>this.qn(e)).next(n=>($(n.targetCount>0),n.targetCount-=1,this.Qn(e,n)))}removeTargets(e,t,n){let s=0,r=[];return Zr(e).J((o,a)=>{let c=Za(a);c.sequenceNumber<=t&&n.get(c.targetId)===null&&(s++,r.push(this.removeTargetData(e,c)))}).next(()=>x.waitFor(r)).next(()=>s)}forEachTarget(e,t){return Zr(e).J((n,s)=>{let r=Za(s);t(r)})}qn(e){return _1(e).get("targetGlobalKey").next(t=>($(t!==null),t))}Qn(e,t){return _1(e).put("targetGlobalKey",t)}Kn(e,t){return Zr(e).put(MI(this.serializer,t))}$n(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){let n=Js(t),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),r=null;return Zr(e).J({range:s,index:"queryTargetsIndex"},(o,a,c)=>{let u=Za(a);Al(t,u.target)&&(r=u,c.done())}).next(()=>r)}addMatchingKeys(e,t,n){let s=[],r=ts(e);return t.forEach(o=>{let a=Kt(o.path);s.push(r.put({targetId:n,path:a})),s.push(this.referenceDelegate.addReference(e,n,o))}),x.waitFor(s)}removeMatchingKeys(e,t,n){let s=ts(e);return x.forEach(t,r=>{let o=Kt(r.path);return x.waitFor([s.delete([n,o]),this.referenceDelegate.removeReference(e,n,r)])})}removeMatchingKeysForTargetId(e,t){let n=ts(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(s)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),s=ts(e),r=fe();return s.J({range:n,H:!0},(o,a,c)=>{let u=Zn(o[1]),d=new W(u);r=r.add(d)}).next(()=>r)}containsKey(e,t){let n=Kt(t.path),s=IDBKeyRange.bound([n],[B1(n)],!1,!0),r=0;return ts(e).J({index:"documentTargetsIndex",H:!0,range:s},([o,a],c,u)=>{o!==0&&(r++,u.done())}).next(()=>r>0)}ot(e,t){return Zr(e).get(t).next(n=>n?Za(n):null)}};function Zr(i){return wt(i,"targets")}function _1(i){return wt(i,"targetGlobal")}function ts(i){return wt(i,"targetDocuments")}function y1([i,e],[t,n]){let s=ce(i,t);return s===0?ce(e,n):s}var pg=class{constructor(e){this.Un=e,this.buffer=new Me(y1),this.Wn=0}Gn(){return++this.Wn}zn(e){let t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{let n=this.buffer.last();y1(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}},mg=class{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){F("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>N(this,null,function*(){this.jn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){gs(t)?F("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield ms(t)}yield this.Hn(3e5)}))}},gg=class{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(t===0)return x.resolve(un.oe);let n=new pg(t);return this.Jn.forEachTarget(e,s=>n.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>n.zn(s))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(F("LruGarbageCollector","Garbage collection skipped; disabled"),x.resolve(g1)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(F("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),g1):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let n,s,r,o,a,c,u,d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(F("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(n=f,a=Date.now(),this.removeTargets(e,n,t))).next(f=>(r=f,c=Date.now(),this.removeOrphanedDocuments(e,n))).next(f=>(u=Date.now(),eo()<=Sn.DEBUG&&F("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${r} targets in `+(c-a)+`ms
	Removed ${f} documents in `+(u-c)+`ms
Total Duration: ${u-d}ms`),x.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:r,documentsRemoved:f})))}};function YP(i,e){return new gg(i,e)}var _g=class{constructor(e,t){this.db=e,this.garbageCollector=YP(this,t)}Yn(e){let t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(n=>t.next(s=>n+s))}er(e){let t=0;return this.Zn(e,n=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(n,s)=>t(s))}addReference(e,t,n){return Vu(e,n)}removeReference(e,t,n){return Vu(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Vu(e,t)}nr(e,t){return function(s,r){let o=!1;return UI(s).Y(a=>BI(s,a,r).next(c=>(c&&(o=!0),x.resolve(!c)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],r=0;return this.tr(e,(o,a)=>{if(a<=t){let c=this.nr(e,o).next(u=>{if(!u)return r++,n.getEntry(e,o).next(()=>(n.removeEntry(o,J.min()),ts(e).delete(function(f){return[0,Kt(f.path)]}(o))))});s.push(c)}}).next(()=>x.waitFor(s)).next(()=>n.apply(e)).next(()=>r)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Vu(e,t)}tr(e,t){let n=ts(e),s,r=un.oe;return n.J({index:"documentTargetsIndex"},([o,a],{path:c,sequenceNumber:u})=>{o===0?(r!==un.oe&&t(new W(Zn(s)),r),r=u,s=c):r=un.oe}).next(()=>{r!==un.oe&&t(new W(Zn(s)),r)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function Vu(i,e){return ts(i).put(function(n,s){return{targetId:0,path:Kt(n.path),sequenceNumber:s}}(e,i.currentSequenceNumber))}var ph=class{constructor(){this.changes=new oi(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ft.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return n!==void 0?x.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var yg=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return qs(e).put(n)}removeEntry(e,t,n){return qs(e).delete(function(r,o){let a=r.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],lh(o),a[a.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.rr(e,n)))}getEntry(e,t){let n=ft.newInvalidDocument(t);return qs(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Ya(t))},(s,r)=>{n=this.ir(t,r)}).next(()=>n)}sr(e,t){let n={size:0,document:ft.newInvalidDocument(t)};return qs(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Ya(t))},(s,r)=>{n={document:this.ir(t,r),size:dh(r)}}).next(()=>n)}getEntries(e,t){let n=tn();return this._r(e,t,(s,r)=>{let o=this.ir(s,r);n=n.insert(s,o)}).next(()=>n)}ar(e,t){let n=tn(),s=new Ge(W.comparator);return this._r(e,t,(r,o)=>{let a=this.ir(r,o);n=n.insert(r,a),s=s.insert(r,dh(o))}).next(()=>({documents:n,ur:s}))}_r(e,t,n){if(t.isEmpty())return x.resolve();let s=new Me(E1);t.forEach(c=>s=s.add(c));let r=IDBKeyRange.bound(Ya(s.first()),Ya(s.last())),o=s.getIterator(),a=o.getNext();return qs(e).J({index:"documentKeyIndex",range:r},(c,u,d)=>{let f=W.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&E1(a,f)<0;)n(a,null),a=o.getNext();a&&a.isEqual(f)&&(n(a,u),a=o.hasNext()?o.getNext():null),a?d.$(Ya(a)):d.done()}).next(()=>{for(;a;)n(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,n,s,r){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),lh(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],c=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return qs(e).U(IDBKeyRange.bound(a,c,!0)).next(u=>{r?.incrementDocumentReadCount(u.length);let d=tn();for(let f of u){let m=this.ir(W.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);m.isFoundDocument()&&(xl(t,m)||s.has(m.key))&&(d=d.insert(m.key,m))}return d})}getAllFromCollectionGroup(e,t,n,s){let r=tn(),o=w1(t,n),a=w1(t,Dn.max());return qs(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(c,u,d)=>{let f=this.ir(W.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);r=r.insert(f.key,f),r.size===s&&d.done()}).next(()=>r)}newChangeBuffer(e){return new vg(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return v1(e).get("remoteDocumentGlobalKey").next(t=>($(!!t),t))}rr(e,t){return v1(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){let n=KP(this.serializer,t);if(!(n.isNoDocument()&&n.version.isEqual(J.min())))return n}return ft.newInvalidDocument(e)}};function qI(i){return new yg(i)}var vg=class extends ph{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new oi(n=>n.toString(),(n,s)=>n.isEqual(s))}applyChanges(e){let t=[],n=0,s=new Me((r,o)=>ce(r.canonicalString(),o.canonicalString()));return this.changes.forEach((r,o)=>{let a=this.lr.get(r);if(t.push(this.cr.removeEntry(e,r,a.readTime)),o.isValidDocument()){let c=o1(this.cr.serializer,o);s=s.add(r.path.popLast());let u=dh(c);n+=u-a.size,t.push(this.cr.addEntry(e,r,c))}else if(n-=a.size,this.trackRemovals){let c=o1(this.cr.serializer,o.convertToNoDocument(J.min()));t.push(this.cr.addEntry(e,r,c))}}),s.forEach(r=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,r))}),t.push(this.cr.updateMetadata(e,n)),x.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(n=>(this.lr.set(t,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:n,ur:s})=>(s.forEach((r,o)=>{this.lr.set(r,{size:o,readTime:n.get(r).readTime})}),n))}};function v1(i){return wt(i,"remoteDocumentGlobal")}function qs(i){return wt(i,"remoteDocumentsV14")}function Ya(i){let e=i.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function w1(i,e){let t=e.documentKey.path.toArray();return[i,lh(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function E1(i,e){let t=i.path.toArray(),n=e.path.toArray(),s=0;for(let r=0;r<t.length-2&&r<n.length-2;++r)if(s=ce(t[r],n[r]),s)return s;return s=ce(t.length,n.length),s||(s=ce(t[t.length-2],n[n.length-2]),s||ce(t[t.length-1],n[n.length-1]))}var wg=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var mh=class{constructor(e,t,n,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=s}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(n=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(n!==null&&nl(n.mutation,s,hn.empty(),$e.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,fe()).next(()=>n))}getLocalViewOfDocuments(e,t,n=fe()){let s=ei();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,n).next(r=>{let o=Ja();return r.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let n=ei();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,fe()))}populateOverlays(e,t,n){let s=[];return n.forEach(r=>{t.has(r)||s.push(r)}),this.documentOverlayCache.getOverlays(e,s).next(r=>{r.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,n,s){let r=tn(),o=tl(),a=function(){return tl()}();return t.forEach((c,u)=>{let d=n.get(u.key);s.has(u.key)&&(d===void 0||d.mutation instanceof qn)?r=r.insert(u.key,u):d!==void 0?(o.set(u.key,d.mutation.getFieldMask()),nl(d.mutation,u,d.mutation.getFieldMask(),$e.now())):o.set(u.key,hn.empty())}),this.recalculateAndSaveOverlays(e,r).next(c=>(c.forEach((u,d)=>o.set(u,d)),t.forEach((u,d)=>{var f;return a.set(u,new wg(d,(f=o.get(u))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){let n=tl(),s=new Ge((o,a)=>o-a),r=fe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(c=>{let u=t.get(c);if(u===null)return;let d=n.get(c)||hn.empty();d=a.applyToLocalView(u,d),n.set(c,d);let f=(s.get(a.batchId)||fe()).add(c);s=s.insert(a.batchId,f)})}).next(()=>{let o=[],a=s.getReverseIterator();for(;a.hasNext();){let c=a.getNext(),u=c.key,d=c.value,f=hI();d.forEach(m=>{if(!r.has(m)){let _=yI(t.get(m),n.get(m));_!==null&&f.set(m,_),r=r.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,f))}return x.waitFor(o)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,s){return function(o){return W.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):S_(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,s):this.getDocumentsMatchingCollectionQuery(e,t,n,s)}getNextDocuments(e,t,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,s).next(r=>{let o=s-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,s-r.size):x.resolve(ei()),a=-1,c=r;return o.next(u=>x.forEach(u,(d,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),r.get(d)?x.resolve():this.remoteDocumentCache.getEntry(e,d).next(m=>{c=c.insert(d,m)}))).next(()=>this.populateOverlays(e,u,r)).next(()=>this.computeViews(e,c,u,fe())).next(d=>({batchId:a,changes:uI(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new W(t)).next(n=>{let s=Ja();return n.isFoundDocument()&&(s=s.insert(n.key,n)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,n,s){let r=t.collectionGroup,o=Ja();return this.indexManager.getCollectionParents(e,r).next(a=>x.forEach(a,c=>{let u=function(f,m){return new Un(m,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,c.child(r));return this.getDocumentsMatchingCollectionQuery(e,u,n,s).next(d=>{d.forEach((f,m)=>{o=o.insert(f,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,n,s){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(o=>(r=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r,s))).next(o=>{r.forEach((c,u)=>{let d=u.getKey();o.get(d)===null&&(o=o.insert(d,ft.newInvalidDocument(d)))});let a=Ja();return o.forEach((c,u)=>{let d=r.get(c);d!==void 0&&nl(d.mutation,u,hn.empty(),$e.now()),xl(t,u)&&(a=a.insert(c,u))}),a})}};var Eg=class{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return x.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:rt(s.createTime)}}(t)),x.resolve()}getNamedQuery(e,t){return x.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:P_(s.bundledQuery),readTime:rt(s.readTime)}}(t)),x.resolve()}};var Tg=class{constructor(){this.overlays=new Ge(W.comparator),this.Ir=new Map}getOverlay(e,t){return x.resolve(this.overlays.get(t))}getOverlays(e,t){let n=ei();return x.forEach(t,s=>this.getOverlay(e,s).next(r=>{r!==null&&n.set(s,r)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((s,r)=>{this.ht(e,t,r)}),x.resolve()}removeOverlaysForBatchId(e,t,n){let s=this.Ir.get(n);return s!==void 0&&(s.forEach(r=>this.overlays=this.overlays.remove(r)),this.Ir.delete(n)),x.resolve()}getOverlaysForCollection(e,t,n){let s=ei(),r=t.length+1,o=new W(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===r&&c.largestBatchId>n&&s.set(c.getKey(),c)}return x.resolve(s)}getOverlaysForCollectionGroup(e,t,n,s){let r=new Ge((u,d)=>u-d),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>n){let d=r.get(u.largestBatchId);d===null&&(d=ei(),r=r.insert(u.largestBatchId,d)),d.set(u.getKey(),u)}}let a=ei(),c=r.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((u,d)=>a.set(u,d)),!(a.size()>=s)););return x.resolve(a)}ht(e,t,n){let s=this.overlays.get(n.key);if(s!==null){let o=this.Ir.get(s.largestBatchId).delete(n.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(n.key,new fl(t,n));let r=this.Ir.get(t);r===void 0&&(r=fe(),this.Ir.set(t,r)),this.Ir.set(t,r.add(n.key))}};var Ig=class{constructor(){this.sessionToken=ot.EMPTY_BYTE_STRING}getSessionToken(e){return x.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,x.resolve()}};var vl=class{constructor(){this.Tr=new Me(ht.Er),this.dr=new Me(ht.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){let n=new ht(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Vr(new ht(e,t))}mr(e,t){e.forEach(n=>this.removeReference(n,t))}gr(e){let t=new W(new Ie([])),n=new ht(t,e),s=new ht(t,e+1),r=[];return this.dr.forEachInRange([n,s],o=>{this.Vr(o),r.push(o.key)}),r}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){let t=new W(new Ie([])),n=new ht(t,e),s=new ht(t,e+1),r=fe();return this.dr.forEachInRange([n,s],o=>{r=r.add(o.key)}),r}containsKey(e){let t=new ht(e,0),n=this.Tr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}},ht=class{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return W.comparator(e.key,t.key)||ce(e.wr,t.wr)}static Ar(e,t){return ce(e.wr,t.wr)||W.comparator(e.key,t.key)}};var Cg=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Me(ht.Er)}checkEmpty(e){return x.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,s){let r=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new dl(r,t,n,s);this.mutationQueue.push(o);for(let a of s)this.br=this.br.add(new ht(a.key,r)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return x.resolve(o)}lookupMutationBatch(e,t){return x.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){let n=t+1,s=this.vr(n),r=s<0?0:s;return x.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return x.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return x.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new ht(t,0),s=new ht(t,Number.POSITIVE_INFINITY),r=[];return this.br.forEachInRange([n,s],o=>{let a=this.Dr(o.wr);r.push(a)}),x.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Me(ce);return t.forEach(s=>{let r=new ht(s,0),o=new ht(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([r,o],a=>{n=n.add(a.wr)})}),x.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,s=n.length+1,r=n;W.isDocumentKey(r)||(r=r.child(""));let o=new ht(new W(r),0),a=new Me(ce);return this.br.forEachWhile(c=>{let u=c.key.path;return!!n.isPrefixOf(u)&&(u.length===s&&(a=a.add(c.wr)),!0)},o),x.resolve(this.Cr(a))}Cr(e){let t=[];return e.forEach(n=>{let s=this.Dr(n);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){$(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let n=this.br;return x.forEach(t.mutations,s=>{let r=new ht(s.key,t.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){let n=new ht(t,0),s=this.br.firstAfterOrEqual(n);return x.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,x.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){let t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var bg=class{constructor(e){this.Mr=e,this.docs=function(){return new Ge(W.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,s=this.docs.get(n),r=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-r,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return x.resolve(n?n.document.mutableCopy():ft.newInvalidDocument(t))}getEntries(e,t){let n=tn();return t.forEach(s=>{let r=this.docs.get(s);n=n.insert(s,r?r.document.mutableCopy():ft.newInvalidDocument(s))}),x.resolve(n)}getDocumentsMatchingQuery(e,t,n,s){let r=tn(),o=t.path,a=new W(o.child("")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){let{key:u,value:{document:d}}=c.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||E_(q1(d),n)<=0||(s.has(d.key)||xl(t,d))&&(r=r.insert(d.key,d.mutableCopy()))}return x.resolve(r)}getAllFromCollectionGroup(e,t,n,s){H()}Or(e,t){return x.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new Sg(this)}getSize(e){return x.resolve(this.size)}},Sg=class extends ph{constructor(e){super(),this.cr=e}applyChanges(e){let t=[];return this.changes.forEach((n,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(n)}),x.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}};var Ag=class{constructor(e){this.persistence=e,this.Nr=new oi(t=>Js(t),Al),this.lastRemoteSnapshotVersion=J.min(),this.highestTargetId=0,this.Lr=0,this.Br=new vl,this.targetCount=0,this.kr=yo.Bn()}forEachTarget(e,t){return this.Nr.forEach((n,s)=>t(s)),x.resolve()}getLastRemoteSnapshotVersion(e){return x.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return x.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),x.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),x.resolve()}Kn(e){this.Nr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.kr=new yo(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,x.resolve()}updateTargetData(e,t){return this.Kn(t),x.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,x.resolve()}removeTargets(e,t,n){let s=0,r=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&n.get(a.targetId)===null&&(this.Nr.delete(o),r.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),x.waitFor(r).next(()=>s)}getTargetCount(e){return x.resolve(this.targetCount)}getTargetData(e,t){let n=this.Nr.get(t)||null;return x.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),x.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);let s=this.persistence.referenceDelegate,r=[];return s&&t.forEach(o=>{r.push(s.markPotentiallyOrphaned(e,o))}),x.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),x.resolve()}getMatchingKeysForTargetId(e,t){let n=this.Br.yr(t);return x.resolve(n)}containsKey(e,t){return x.resolve(this.Br.containsKey(t))}};var gh=class{constructor(e,t){this.qr={},this.overlays={},this.Qr=new un(0),this.Kr=!1,this.Kr=!0,this.$r=new Ig,this.referenceDelegate=e(this),this.Ur=new Ag(this),this.indexManager=new hg,this.remoteDocumentCache=function(s){return new bg(s)}(n=>this.referenceDelegate.Wr(n)),this.serializer=new ah(t),this.Gr=new Eg(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Tg,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new Cg(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){F("MemoryPersistence","Starting transaction:",e);let s=new Rg(this.Qr.next());return this.referenceDelegate.zr(),n(s).next(r=>this.referenceDelegate.jr(s).next(()=>r)).toPromise().then(r=>(s.raiseOnCommittedEvent(),r))}Hr(e,t){return x.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}},Rg=class extends $u{constructor(e){super(),this.currentSequenceNumber=e}},_h=class i{constructor(e){this.persistence=e,this.Jr=new vl,this.Yr=null}static Zr(e){return new i(e)}get Xr(){if(this.Yr)return this.Yr;throw H()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),x.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),x.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),x.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(r=>this.Xr.add(r.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return x.forEach(this.Xr,n=>{let s=W.fromPath(n);return this.ei(e,s).next(r=>{r||t.removeEntry(s,J.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(n=>{n?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return x.or([()=>x.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}};var xg=class{constructor(e){this.serializer=e}O(e,t,n,s){let r=new Yu("createOrUpgrade",t);n<1&&s>=1&&(function(c){c.createObjectStore("owner")}(e),function(c){c.createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",LT,{unique:!0}),c.createObjectStore("documentMutations")}(e),T1(e),function(c){c.createObjectStore("remoteDocuments")}(e));let o=x.resolve();return n<3&&s>=3&&(n!==0&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(e),T1(e)),o=o.next(()=>function(c){let u=c.store("targetGlobal"),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:J.min().toTimestamp(),targetCount:0};return u.put("targetGlobalKey",d)}(r))),n<4&&s>=4&&(n!==0&&(o=o.next(()=>function(c,u){return u.store("mutations").U().next(d=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",LT,{unique:!0});let f=u.store("mutations"),m=d.map(_=>f.put(_));return x.waitFor(m)})}(e,r))),o=o.next(()=>{(function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),n<5&&s>=5&&(o=o.next(()=>this.ni(r))),n<6&&s>=6&&(o=o.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(e),this.ri(r)))),n<7&&s>=7&&(o=o.next(()=>this.ii(r))),n<8&&s>=8&&(o=o.next(()=>this.si(e,r))),n<9&&s>=9&&(o=o.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),n<10&&s>=10&&(o=o.next(()=>this.oi(r))),n<11&&s>=11&&(o=o.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&s>=12&&(o=o.next(()=>{(function(c){let u=c.createObjectStore("documentOverlays",{keyPath:fP});u.createIndex("collectionPathOverlayIndex",pP,{unique:!1}),u.createIndex("collectionGroupOverlayIndex",mP,{unique:!1})})(e)})),n<13&&s>=13&&(o=o.next(()=>function(c){let u=c.createObjectStore("remoteDocumentsV14",{keyPath:nP});u.createIndex("documentKeyIndex",iP),u.createIndex("collectionGroupIndex",sP)}(e)).next(()=>this._i(e,r)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&s>=14&&(o=o.next(()=>this.ai(e,r))),n<15&&s>=15&&(o=o.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:cP}).createIndex("sequenceNumberIndex",uP,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:hP}).createIndex("documentKeyIndex",dP,{unique:!1})}(e))),n<16&&s>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),n<17&&s>=17&&(o=o.next(()=>{(function(c){c.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((n,s)=>{t+=dh(s)}).next(()=>{let n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}ni(e){let t=e.store("mutationQueues"),n=e.store("mutations");return t.U().next(s=>x.forEach(s,r=>{let o=IDBKeyRange.bound([r.userId,-1],[r.userId,r.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",o).next(a=>x.forEach(a,c=>{$(c.userId===r.userId);let u=Gs(this.serializer,c);return VI(e,r.userId,u).next(()=>{})}))}))}ii(e){let t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{let r=[];return n.J((o,a)=>{let c=new Ie(o),u=function(f){return[0,Kt(f)]}(c);r.push(t.get(u).next(d=>d?x.resolve():(f=>t.put({targetId:0,path:Kt(f),sequenceNumber:s.highestListenSequenceNumber}))(c)))}).next(()=>x.waitFor(r))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:lP});let n=t.store("collectionParents"),s=new yl,r=o=>{if(s.add(o)){let a=o.lastSegment(),c=o.popLast();return n.put({collectionId:a,parent:Kt(c)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{let c=new Ie(o);return r(c.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,c],u)=>{let d=Zn(a);return r(d.popLast())}))}oi(e){let t=e.store("targets");return t.J((n,s)=>{let r=Za(s),o=MI(this.serializer,r);return t.put(o)})}_i(e,t){let n=t.store("remoteDocuments"),s=[];return n.J((r,o)=>{let a=t.store("remoteDocumentsV14"),c=function(f){return f.document?new W(Ie.fromString(f.document.name).popFirst(5)):f.noDocument?W.fromSegments(f.noDocument.path):f.unknownDocument?W.fromSegments(f.unknownDocument.path):H()}(o).path.toArray(),u={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(u))}).next(()=>x.waitFor(s))}ai(e,t){let n=t.store("mutations"),s=qI(this.serializer),r=new gh(_h.Zr,this.serializer.ct);return n.U().next(o=>{let a=new Map;return o.forEach(c=>{var u;let d=(u=a.get(c.userId))!==null&&u!==void 0?u:fe();Gs(this.serializer,c).keys().forEach(f=>d=d.add(f)),a.set(c.userId,d)}),x.forEach(a,(c,u)=>{let d=new dt(u),f=ch.lt(this.serializer,d),m=r.getIndexManager(d),_=fh.lt(d,this.serializer,m,r.referenceDelegate);return new mh(s,_,f,m).recalculateAndSaveOverlaysForDocumentKeys(new al(t,un.oe),c).next()})})}};function T1(i){i.createObjectStore("targetDocuments",{keyPath:oP}).createIndex("documentTargetsIndex",aP,{unique:!0}),i.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",rP,{unique:!0}),i.createObjectStore("targetGlobal")}var _m="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Pg=class i{constructor(e,t,n,s,r,o,a,c,u,d,f=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.ui=r,this.window=o,this.document=a,this.ci=u,this.li=d,this.hi=f,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=m=>Promise.resolve(),!i.D())throw new M(D.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new _g(this,s),this.Ai=t+"main",this.serializer=new ah(c),this.Ri=new os(this.Ai,this.hi,new xg(this.serializer)),this.$r=new sg,this.Ur=new fg(this.referenceDelegate,this.serializer),this.remoteDocumentCache=qI(this.serializer),this.Gr=new ig,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,d===!1&&it("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new M(D.FAILED_PRECONDITION,_m);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new un(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=t=>N(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(t=>N(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(()=>N(this,null,function*(){this.started&&(yield this.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Bu(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(gs(e))return F("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return F("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return Xa(e).get("owner").next(t=>x.resolve(this.vi(t)))}Ci(e){return Bu(e).delete(this.clientId)}Fi(){return N(this,null,function*(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let n=wt(t,"clientMetadata");return n.U().next(s=>{let r=this.xi(s,18e5),o=s.filter(a=>r.indexOf(a)===-1);return x.forEach(o,a=>n.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(let t of e)this.Vi.removeItem(this.Oi(t.clientId))}})}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?x.resolve(!0):Xa(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new M(D.FAILED_PRECONDITION,_m);return!1}}return!(!this.networkEnabled||!this.inForeground)||Bu(e).U().next(n=>this.xi(n,5e3).find(s=>{if(this.clientId!==s.clientId){let r=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(r||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&F("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return N(this,null,function*(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),yield this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new al(e,un.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()})}xi(e,t){return e.filter(n=>this.Mi(n.updateTimeMs,t)&&!this.Ni(n.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>Bu(e).U().next(t=>this.xi(t,18e5).map(n=>n.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return fh.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new dg(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return ch.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,n){F("IndexedDbPersistence","Starting transaction:",e);let s=t==="readonly"?"readonly":"readwrite",r=function(c){return c===17?yP:c===16?_P:c===15?I_:c===14?Q1:c===13?K1:c===12?gP:c===11?H1:void H()}(this.hi),o;return this.Ri.runTransaction(e,s,r,a=>(o=new al(a,this.Qr?this.Qr.next():un.oe),t==="readwrite-primary"?this.wi(o).next(c=>!!c||this.Si(o)).next(c=>{if(!c)throw it(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new M(D.FAILED_PRECONDITION,z1);return n(o)}).next(c=>this.Di(o).next(()=>c)):this.Ki(o).next(()=>n(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return Xa(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new M(D.FAILED_PRECONDITION,_m)})}Di(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Xa(e).put("owner",t)}static D(){return os.D()}bi(e){let t=Xa(e);return t.get("owner").next(n=>this.vi(n)?(F("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):x.resolve())}Mi(e,t){let n=Date.now();return!(e<n-t)&&(!(e>n)||(it(`Detected an update time that is in the future: ${e} > ${n}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();let t=/(?:Version|Mobile)\/1[456]/;uf()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{let n=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return F("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return it("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){it("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function Xa(i){return wt(i,"owner")}function Bu(i){return wt(i,"clientMetadata")}function N_(i,e){let t=i.projectId;return i.isDefaultDatabase||(t+="."+i.database),"firestore/"+e+"/"+t+"/"}var Dg=class i{constructor(e,t,n,s){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=s}static Wi(e,t){let n=fe(),s=fe();for(let r of t.docChanges)switch(r.type){case 0:n=n.add(r.doc.key);break;case 1:s=s.add(r.doc.key)}return new i(e,t.fromCache,n,s)}};var Ng=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var yh=class{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return uf()?8:j1(ha())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,s){let r={result:null};return this.Yi(e,t).next(o=>{r.result=o}).next(()=>{if(!r.result)return this.Zi(e,t,s,n).next(o=>{r.result=o})}).next(()=>{if(r.result)return;let o=new Ng;return this.Xi(e,t,o).next(a=>{if(r.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>r.result)}es(e,t,n,s){return n.documentReadCount<this.ji?(eo()<=Sn.DEBUG&&F("QueryEngine","SDK will not create cache indexes for query:",to(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),x.resolve()):(eo()<=Sn.DEBUG&&F("QueryEngine","Query:",to(t),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.Hi*s?(eo()<=Sn.DEBUG&&F("QueryEngine","The SDK decides to create cache indexes for query:",to(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Qt(t))):x.resolve())}Yi(e,t){if($T(t))return x.resolve(null);let n=Qt(t);return this.indexManager.getIndexType(e,n).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=ih(t,null,"F"),n=Qt(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{let o=fe(...r);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,n).next(c=>{let u=this.ts(t,a);return this.ns(t,u,o,c.readTime)?this.Yi(e,ih(t,null,"F")):this.rs(e,u,t,c)}))})))}Zi(e,t,n,s){return $T(t)||s.isEqual(J.min())?x.resolve(null):this.Ji.getDocuments(e,n).next(r=>{let o=this.ts(t,r);return this.ns(t,o,n,s)?x.resolve(null):(eo()<=Sn.DEBUG&&F("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),to(t)),this.rs(e,o,t,U1(s,-1)).next(a=>a))})}ts(e,t){let n=new Me(lI(e));return t.forEach((s,r)=>{xl(e,r)&&(n=n.add(r))}),n}ns(e,t,n,s){if(e.limit===null)return!1;if(n.size!==t.size)return!0;let r=e.limitType==="F"?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(s)>0)}Xi(e,t,n){return eo()<=Sn.DEBUG&&F("QueryEngine","Using full collection scan to execute query:",to(t)),this.Ji.getDocumentsMatchingQuery(e,t,Dn.min(),n)}rs(e,t,n,s){return this.Ji.getDocumentsMatchingQuery(e,n,s).next(r=>(t.forEach(o=>{r=r.insert(o.key,o)}),r))}};var kg=class{constructor(e,t,n,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new Ge(ce),this._s=new oi(r=>Js(r),Al),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new mh(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}};function zI(i,e,t,n){return new kg(i,e,t,n)}function jI(i,e){return N(this,null,function*(){let t=G(i);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let s;return t.mutationQueue.getAllMutationBatches(n).next(r=>(s=r,t.ls(e),t.mutationQueue.getAllMutationBatches(n))).next(r=>{let o=[],a=[],c=fe();for(let u of s){o.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}for(let u of r){a.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}return t.localDocuments.getDocuments(n,c).next(u=>({hs:u,removedBatchIds:o,addedBatchIds:a}))})})})}function XP(i,e){let t=G(i);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let s=e.batch.keys(),r=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,c,u,d){let f=u.batch,m=f.keys(),_=x.resolve();return m.forEach(v=>{_=_.next(()=>d.getEntry(c,v)).next(C=>{let R=u.docVersions.get(v);$(R!==null),C.version.compareTo(R)<0&&(f.applyToRemoteDocument(C,u),C.isValidDocument()&&(C.setReadTime(u.commitVersion),d.addEntry(C)))})}),_.next(()=>a.mutationQueue.removeMutationBatch(c,f))}(t,n,e,r).next(()=>r.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(a){let c=fe();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(c=c.add(a.batch.mutations[u].key));return c}(e))).next(()=>t.localDocuments.getDocuments(n,s))})}function GI(i){let e=G(i);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function JP(i,e){let t=G(i),n=e.snapshotVersion,s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",r=>{let o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;let a=[];e.targetChanges.forEach((d,f)=>{let m=s.get(f);if(!m)return;a.push(t.Ur.removeMatchingKeys(r,d.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(r,d.addedDocuments,f)));let _=m.withSequenceNumber(r.currentSequenceNumber);e.targetMismatches.get(f)!==null?_=_.withResumeToken(ot.EMPTY_BYTE_STRING,J.min()).withLastLimboFreeSnapshotVersion(J.min()):d.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(d.resumeToken,n)),s=s.insert(f,_),function(C,R,U){return C.resumeToken.approximateByteSize()===0||R.snapshotVersion.toMicroseconds()-C.snapshotVersion.toMicroseconds()>=3e8?!0:U.addedDocuments.size+U.modifiedDocuments.size+U.removedDocuments.size>0}(m,_,d)&&a.push(t.Ur.updateTargetData(r,_))});let c=tn(),u=fe();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(r,d))}),a.push(WI(r,o,e.documentUpdates).next(d=>{c=d.Ps,u=d.Is})),!n.isEqual(J.min())){let d=t.Ur.getLastRemoteSnapshotVersion(r).next(f=>t.Ur.setTargetsMetadata(r,r.currentSequenceNumber,n));a.push(d)}return x.waitFor(a).next(()=>o.apply(r)).next(()=>t.localDocuments.getLocalViewOfDocuments(r,c,u)).next(()=>c)}).then(r=>(t.os=s,r))}function WI(i,e,t){let n=fe(),s=fe();return t.forEach(r=>n=n.add(r)),e.getEntries(i,n).next(r=>{let o=tn();return t.forEach((a,c)=>{let u=r.get(a);c.isFoundDocument()!==u.isFoundDocument()&&(s=s.add(a)),c.isNoDocument()&&c.version.isEqual(J.min())?(e.removeEntry(a,c.readTime),o=o.insert(a,c)):!u.isValidDocument()||c.version.compareTo(u.version)>0||c.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(c),o=o.insert(a,c)):F("LocalStore","Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",c.version)}),{Ps:o,Is:s}})}function ZP(i,e){let t=G(i);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function vo(i,e){let t=G(i);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let s;return t.Ur.getTargetData(n,e).next(r=>r?(s=r,x.resolve(s)):t.Ur.allocateTargetId(n).next(o=>(s=new _o(e,o,"TargetPurposeListen",n.currentSequenceNumber),t.Ur.addTargetData(n,s).next(()=>s))))}).then(n=>{let s=t.os.get(n.targetId);return(s===null||n.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(n.targetId,n),t._s.set(e,n.targetId)),n})}function wo(i,e,t){return N(this,null,function*(){let n=G(i),s=n.os.get(e),r=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",r,o=>n.persistence.referenceDelegate.removeTarget(o,s)))}catch(o){if(!gs(o))throw o;F("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}n.os=n.os.remove(e),n._s.delete(s.target)})}function vh(i,e,t){let n=G(i),s=J.min(),r=fe();return n.persistence.runTransaction("Execute query","readwrite",o=>function(c,u,d){let f=G(c),m=f._s.get(d);return m!==void 0?x.resolve(f.os.get(m)):f.Ur.getTargetData(u,d)}(n,o,Qt(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(o,a.targetId).next(c=>{r=c})}).next(()=>n.ss.getDocumentsMatchingQuery(o,e,t?s:J.min(),t?r:fe())).next(a=>(QI(n,aI(e),a),{documents:a,Ts:r})))}function HI(i,e){let t=G(i),n=G(t.Ur),s=t.os.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",r=>n.ot(r,e).next(o=>o?o.target:null))}function KI(i,e){let t=G(i),n=t.us.get(e)||J.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.cs.getAllFromCollectionGroup(s,e,U1(n,-1),Number.MAX_SAFE_INTEGER)).then(s=>(QI(t,e,s),s))}function QI(i,e,t){let n=i.us.get(e)||J.min();t.forEach((s,r)=>{r.readTime.compareTo(n)>0&&(n=r.readTime)}),i.us.set(e,n)}function eD(i,e,t,n){return N(this,null,function*(){let s=G(i),r=fe(),o=tn();for(let u of t){let d=e.Es(u.metadata.name);u.document&&(r=r.add(d));let f=e.ds(u);f.setReadTime(e.As(u.metadata.readTime)),o=o.insert(d,f)}let a=s.cs.newChangeBuffer({trackRemovals:!0}),c=yield vo(s,function(d){return Qt(Ro(Ie.fromString(`__bundle__/docs/${d}`)))}(n));return s.persistence.runTransaction("Apply bundle documents","readwrite",u=>WI(u,a,o).next(d=>(a.apply(u),d)).next(d=>s.Ur.removeMatchingKeysForTargetId(u,c.targetId).next(()=>s.Ur.addMatchingKeys(u,r,c.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(u,d.Ps,d.Is)).next(()=>d.Ps)))})}function tD(n,s){return N(this,arguments,function*(i,e,t=fe()){let r=yield vo(i,Qt(P_(e.bundledQuery))),o=G(i);return o.persistence.runTransaction("Save named query","readwrite",a=>{let c=rt(e.readTime);if(r.snapshotVersion.compareTo(c)>=0)return o.Gr.saveNamedQuery(a,e);let u=r.withResumeToken(ot.EMPTY_BYTE_STRING,c);return o.os=o.os.insert(u.targetId,u),o.Ur.updateTargetData(a,u).next(()=>o.Ur.removeMatchingKeysForTargetId(a,r.targetId)).next(()=>o.Ur.addMatchingKeys(a,t,r.targetId)).next(()=>o.Gr.saveNamedQuery(a,e))})})}function I1(i,e){return`firestore_clients_${i}_${e}`}function C1(i,e,t){let n=`firestore_mutations_${i}_${t}`;return e.isAuthenticated()&&(n+=`_${e.uid}`),n}function ym(i,e){return`firestore_targets_${i}_${e}`}var wh=class i{constructor(e,t,n,s){this.user=e,this.batchId=t,this.state=n,this.error=s}static Rs(e,t,n){let s=JSON.parse(n),r,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(r=new M(s.error.code,s.error.message))),o?new i(e,t,s.state,r):(it("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},il=class i{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Rs(e,t){let n=JSON.parse(t),s,r=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return r&&n.error&&(r=typeof n.error.message=="string"&&typeof n.error.code=="string",r&&(s=new M(n.error.code,n.error.message))),r?new i(e,n.state,s):(it("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Eh=class i{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){let n=JSON.parse(t),s=typeof n=="object"&&n.activeTargetIds instanceof Array,r=A_();for(let o=0;s&&o<n.activeTargetIds.length;++o)s=G1(n.activeTargetIds[o]),r=r.add(n.activeTargetIds[o]);return s?new i(e,r):(it("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},Og=class i{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new i(t.clientId,t.onlineState):(it("SharedClientState",`Failed to parse online state: ${e}`),null)}},wl=class{constructor(){this.activeTargetIds=A_()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},sl=class{constructor(e,t,n,s,r){this.window=e,this.ui=t,this.persistenceKey=n,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Ge(ce),this.started=!1,this.bs=[];let o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=r,this.Ds=I1(this.persistenceKey,this.ps),this.vs=function(c){return`firestore_sequence_number_${c}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new wl),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(c){return`firestore_online_state_${c}`}(this.persistenceKey),this.Os=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}start(){return N(this,null,function*(){let e=yield this.syncEngine.Qi();for(let n of e){if(n===this.ps)continue;let s=this.getItem(I1(this.persistenceKey,n));if(s){let r=Eh.Rs(n,s);r&&(this.Ss=this.Ss.insert(r.clientId,r))}}this.Ns();let t=this.storage.getItem(this.xs);if(t){let n=this.Ls(t);n&&this.Bs(n)}for(let n of this.bs)this.ws(n);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((n,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,n){this.qs(e,t,n),this.Qs(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){let s=this.storage.getItem(ym(this.persistenceKey,e));if(s){let r=il.Rs(e,s);r&&(n=r.state)}}return t&&this.Ks.fs(e),this.Ns(),n}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(ym(this.persistenceKey,e))}updateQueryState(e,t,n){this.$s(e,t,n)}handleUserChange(e,t,n){t.forEach(s=>{this.Qs(s)}),this.currentUser=e,n.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return F("SharedClientState","READ",e,t),t}setItem(e,t){F("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){F("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){let t=e;if(t.storageArea===this.storage){if(F("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void it("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(()=>N(this,null,function*(){if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){let n=this.Gs(t.key);return this.zs(n,null)}{let n=this.js(t.key,t.newValue);if(n)return this.zs(n.clientId,n)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){let n=this.Hs(t.key,t.newValue);if(n)return this.Js(n)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){let n=this.Ys(t.key,t.newValue);if(n)return this.Zs(n)}}else if(t.key===this.xs){if(t.newValue!==null){let n=this.Ls(t.newValue);if(n)return this.Bs(n)}}else if(t.key===this.vs){let n=function(r){let o=un.oe;if(r!=null)try{let a=JSON.parse(r);$(typeof a=="number"),o=a}catch(a){it("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);n!==un.oe&&this.sequenceNumberHandler(n)}else if(t.key===this.Os){let n=this.Xs(t.newValue);yield Promise.all(n.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(t)}))}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,n){let s=new wh(this.currentUser,e,t,n),r=C1(this.persistenceKey,this.currentUser,e);this.setItem(r,s.Vs())}Qs(e){let t=C1(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){let t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,n){let s=ym(this.persistenceKey,e),r=new il(e,t,n);this.setItem(s,r.Vs())}Ws(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){let t=this.Cs.exec(e);return t?t[1]:null}js(e,t){let n=this.Gs(e);return Eh.Rs(n,t)}Hs(e,t){let n=this.Fs.exec(e),s=Number(n[1]),r=n[2]!==void 0?n[2]:null;return wh.Rs(new dt(r),s,t)}Ys(e,t){let n=this.Ms.exec(e),s=Number(n[1]);return il.Rs(s,t)}Ls(e){return Og.Rs(e)}Xs(e){return JSON.parse(e)}Js(e){return N(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);F("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){let n=t?this.Ss.insert(e,t):this.Ss.remove(e),s=this.ks(this.Ss),r=this.ks(n),o=[],a=[];return r.forEach(c=>{s.has(c)||o.push(c)}),s.forEach(c=>{r.has(c)||a.push(c)}),this.syncEngine.io(o,a).then(()=>{this.Ss=n})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=A_();return e.forEach((n,s)=>{t=t.unionWith(s.activeTargetIds)}),t}},Th=class{constructor(){this.so=new wl,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new wl,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Mg=class{_o(e){}shutdown(){}};var Ih=class{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){F("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.ho)e(0)}lo(){F("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Uu=null;function vm(){return Uu===null?Uu=function(){return 268435456+Math.round(2147483648*Math.random())}():Uu++,"0x"+Uu.toString(16)}var nD={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var Fg=class{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}};var Ft="WebChannelConnection",Lg=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let n=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+t.host,this.vo=`projects/${s}/databases/${r}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${r}`}get Fo(){return!1}Mo(t,n,s,r,o){let a=vm(),c=this.xo(t,n.toUriEncodedString());F("RestConnection",`Sending RPC '${t}' ${a}:`,c,s);let u={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(u,r,o),this.No(t,c,u,s).then(d=>(F("RestConnection",`Received RPC '${t}' ${a}: `,d),d),d=>{throw Bn("RestConnection",`RPC '${t}' ${a} failed with error: `,d,"url: ",c,"request:",s),d})}Lo(t,n,s,r,o,a){return this.Mo(t,n,s,r,o)}Oo(t,n,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ao}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((r,o)=>t[o]=r),s&&s.headers.forEach((r,o)=>t[o]=r)}xo(t,n){let s=nD[t];return`${this.Do}/v1/${n}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,s){let r=vm();return new Promise((o,a)=>{let c=new hm;c.setWithCredentials(!0),c.listenOnce(dm.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Ka.NO_ERROR:let d=c.getResponseJson();F(Ft,`XHR for RPC '${e}' ${r} received:`,JSON.stringify(d)),o(d);break;case Ka.TIMEOUT:F(Ft,`RPC '${e}' ${r} timed out`),a(new M(D.DEADLINE_EXCEEDED,"Request time out"));break;case Ka.HTTP_ERROR:let f=c.getStatus();if(F(Ft,`RPC '${e}' ${r} failed with status:`,f,"response text:",c.getResponseText()),f>0){let m=c.getResponseJson();Array.isArray(m)&&(m=m[0]);let _=m?.error;if(_&&_.status&&_.message){let v=function(R){let U=R.toLowerCase().replace(/_/g,"-");return Object.values(D).indexOf(U)>=0?U:D.UNKNOWN}(_.status);a(new M(v,_.message))}else a(new M(D.UNKNOWN,"Server responded with status "+c.getStatus()))}else a(new M(D.UNAVAILABLE,"Connection failed."));break;default:H()}}finally{F(Ft,`RPC '${e}' ${r} completed.`)}});let u=JSON.stringify(s);F(Ft,`RPC '${e}' ${r} sending request:`,s),c.send(t,"POST",u,n,15)})}Bo(e,t,n){let s=vm(),r=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=mm(),a=pm(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(c.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Oo(c.initMessageHeaders,t,n),c.encodeInitMessageHeaders=!0;let d=r.join("");F(Ft,`Creating RPC '${e}' stream ${s}: ${d}`,c);let f=o.createWebChannel(d,c),m=!1,_=!1,v=new Fg({Io:R=>{_?F(Ft,`Not sending because RPC '${e}' stream ${s} is closed:`,R):(m||(F(Ft,`Opening RPC '${e}' stream ${s} transport.`),f.open(),m=!0),F(Ft,`RPC '${e}' stream ${s} sending:`,R),f.send(R))},To:()=>f.close()}),C=(R,U,q)=>{R.listen(U,z=>{try{q(z)}catch(Y){setTimeout(()=>{throw Y},0)}})};return C(f,$r.EventType.OPEN,()=>{_||(F(Ft,`RPC '${e}' stream ${s} transport opened.`),v.yo())}),C(f,$r.EventType.CLOSE,()=>{_||(_=!0,F(Ft,`RPC '${e}' stream ${s} transport closed`),v.So())}),C(f,$r.EventType.ERROR,R=>{_||(_=!0,Bn(Ft,`RPC '${e}' stream ${s} transport errored:`,R),v.So(new M(D.UNAVAILABLE,"The operation could not be completed")))}),C(f,$r.EventType.MESSAGE,R=>{var U;if(!_){let q=R.data[0];$(!!q);let z=q,Y=z.error||((U=z[0])===null||U===void 0?void 0:U.error);if(Y){F(Ft,`RPC '${e}' stream ${s} received error:`,Y);let he=Y.status,ee=function(E){let I=ut[E];if(I!==void 0)return EI(I)}(he),T=Y.message;ee===void 0&&(ee=D.INTERNAL,T="Unknown error status: "+he+" with message "+Y.message),_=!0,v.So(new M(ee,T)),f.close()}else F(Ft,`RPC '${e}' stream ${s} received:`,q),v.bo(q)}}),C(a,fm.STAT_EVENT,R=>{R.stat===Fu.PROXY?F(Ft,`RPC '${e}' stream ${s} detected buffering proxy`):R.stat===Fu.NOPROXY&&F(Ft,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{v.wo()},0),v}};function $I(){return typeof window<"u"?window:null}function Wu(){return typeof document<"u"?document:null}function Pl(i){return new Jm(i,!0)}var El=class{constructor(e,t,n=1e3,s=1.5,r=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=s,this.Qo=r,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();let t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-n);s>0&&F("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}};var Ch=class{constructor(e,t,n,s,r,o,a,c){this.ui=e,this.Ho=n,this.Jo=s,this.connection=r,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new El(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}stop(){return N(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){return N(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){return N(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===D.RESOURCE_EXHAUSTED?(it(t.toString()),it("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===D.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.mo(t)})}l_(){}auth(){this.state=1;let e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,s])=>{this.Yo===t&&this.P_(n,s)},n=>{e(()=>{let s=new M(D.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(s)})})}P_(e,t){let n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{n(()=>this.I_(s))}),this.stream.onMessage(s=>{n(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(()=>N(this,null,function*(){this.state=0,this.start()}))}I_(e){return F("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(F("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Vg=class extends Ch{constructor(e,t,n,s,r,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,s,o),this.serializer=r}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();let t=UP(this.serializer,e),n=function(r){if(!("targetChange"in r))return J.min();let o=r.targetChange;return o.targetIds&&o.targetIds.length?J.min():o.readTime?rt(o.readTime):J.min()}(e);return this.listener.d_(t,n)}A_(e){let t={};t.database=tg(this.serializer),t.addTarget=function(r,o){let a,c=o.target;if(a=th(c)?{documents:xI(r,c)}:{query:PI(r,c)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=II(r,o.resumeToken);let u=Zm(r,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(J.min())>0){a.readTime=go(r,o.snapshotVersion.toTimestamp());let u=Zm(r,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);let n=zP(this.serializer,e);n&&(t.labels=n),this.a_(t)}R_(e){let t={};t.database=tg(this.serializer),t.removeTarget=e,this.a_(t)}},Bg=class extends Ch{constructor(e,t,n,s,r,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,s,o),this.serializer=r}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return $(!!e.streamToken),this.lastStreamToken=e.streamToken,$(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){$(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();let t=qP(e.writeResults,e.commitTime),n=rt(e.commitTime);return this.listener.g_(n,t)}p_(){let e={};e.database=tg(this.serializer),this.a_(e)}m_(e){let t={streamToken:this.lastStreamToken,writes:e.map(n=>_l(this.serializer,n))};this.a_(t)}};var Ug=class extends class{}{constructor(e,t,n,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new M(D.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,o])=>this.connection.Mo(e,eg(t,n),s,r,o)).catch(r=>{throw r.name==="FirebaseError"?(r.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new M(D.UNKNOWN,r.toString())})}Lo(e,t,n,s,r){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,eg(t,n),s,o,a,r)).catch(o=>{throw o.name==="FirebaseError"?(o.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new M(D.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}},qg=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(it(t),this.D_=!1):F("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}};var zg=class{constructor(e,t,n,s,r){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=r,this.k_._o(o=>{n.enqueueAndForget(()=>N(this,null,function*(){_s(this)&&(F("RemoteStore","Restarting streams for network reachability change."),yield function(c){return N(this,null,function*(){let u=G(c);u.L_.add(4),yield xo(u),u.q_.set("Unknown"),u.L_.delete(4),yield Dl(u)})}(this))}))}),this.q_=new qg(n,s)}};function Dl(i){return N(this,null,function*(){if(_s(i))for(let e of i.B_)yield e(!0)})}function xo(i){return N(this,null,function*(){for(let e of i.B_)yield e(!1)})}function Wh(i,e){let t=G(i);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),M_(t)?O_(t):Do(t).r_()&&k_(t,e))}function Eo(i,e){let t=G(i),n=Do(t);t.N_.delete(e),n.r_()&&YI(t,e),t.N_.size===0&&(n.r_()?n.o_():_s(t)&&t.q_.set("Unknown"))}function k_(i,e){if(i.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(J.min())>0){let t=i.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Do(i).A_(e)}function YI(i,e){i.Q_.xe(e),Do(i).R_(e)}function O_(i){i.Q_=new Xm({getRemoteKeysForTarget:e=>i.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>i.N_.get(e)||null,tt:()=>i.datastore.serializer.databaseId}),Do(i).start(),i.q_.v_()}function M_(i){return _s(i)&&!Do(i).n_()&&i.N_.size>0}function _s(i){return G(i).L_.size===0}function XI(i){i.Q_=void 0}function iD(i){return N(this,null,function*(){i.q_.set("Online")})}function sD(i){return N(this,null,function*(){i.N_.forEach((e,t)=>{k_(i,e)})})}function rD(i,e){return N(this,null,function*(){XI(i),M_(i)?(i.q_.M_(e),O_(i)):i.q_.set("Unknown")})}function oD(i,e,t){return N(this,null,function*(){if(i.q_.set("Online"),e instanceof rh&&e.state===2&&e.cause)try{yield function(s,r){return N(this,null,function*(){let o=r.cause;for(let a of r.targetIds)s.N_.has(a)&&(yield s.remoteSyncer.rejectListen(a,o),s.N_.delete(a),s.Q_.removeTarget(a))})}(i,e)}catch(n){F("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield bh(i,n)}else if(e instanceof lo?i.Q_.Ke(e):e instanceof sh?i.Q_.He(e):i.Q_.We(e),!t.isEqual(J.min()))try{let n=yield GI(i.localStore);t.compareTo(n)>=0&&(yield function(r,o){let a=r.Q_.rt(o);return a.targetChanges.forEach((c,u)=>{if(c.resumeToken.approximateByteSize()>0){let d=r.N_.get(u);d&&r.N_.set(u,d.withResumeToken(c.resumeToken,o))}}),a.targetMismatches.forEach((c,u)=>{let d=r.N_.get(c);if(!d)return;r.N_.set(c,d.withResumeToken(ot.EMPTY_BYTE_STRING,d.snapshotVersion)),YI(r,c);let f=new _o(d.target,c,u,d.sequenceNumber);k_(r,f)}),r.remoteSyncer.applyRemoteEvent(a)}(i,t))}catch(n){F("RemoteStore","Failed to raise snapshot:",n),yield bh(i,n)}})}function bh(i,e,t){return N(this,null,function*(){if(!gs(e))throw e;i.L_.add(1),yield xo(i),i.q_.set("Offline"),t||(t=()=>GI(i.localStore)),i.asyncQueue.enqueueRetryable(()=>N(this,null,function*(){F("RemoteStore","Retrying IndexedDB access"),yield t(),i.L_.delete(1),yield Dl(i)}))})}function JI(i,e){return e().catch(t=>bh(i,t,e))}function Po(i){return N(this,null,function*(){let e=G(i),t=ps(e),n=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;aD(e);)try{let s=yield ZP(e.localStore,n);if(s===null){e.O_.length===0&&t.o_();break}n=s.batchId,lD(e,s)}catch(s){yield bh(e,s)}ZI(e)&&eC(e)})}function aD(i){return _s(i)&&i.O_.length<10}function lD(i,e){i.O_.push(e);let t=ps(i);t.r_()&&t.V_&&t.m_(e.mutations)}function ZI(i){return _s(i)&&!ps(i).n_()&&i.O_.length>0}function eC(i){ps(i).start()}function cD(i){return N(this,null,function*(){ps(i).p_()})}function uD(i){return N(this,null,function*(){let e=ps(i);for(let t of i.O_)e.m_(t.mutations)})}function hD(i,e,t){return N(this,null,function*(){let n=i.O_.shift(),s=Qm.from(n,e,t);yield JI(i,()=>i.remoteSyncer.applySuccessfulWrite(s)),yield Po(i)})}function dD(i,e){return N(this,null,function*(){e&&ps(i).V_&&(yield function(n,s){return N(this,null,function*(){if(function(o){return wI(o)&&o!==D.ABORTED}(s.code)){let r=n.O_.shift();ps(n).s_(),yield JI(n,()=>n.remoteSyncer.rejectFailedWrite(r.batchId,s)),yield Po(n)}})}(i,e)),ZI(i)&&eC(i)})}function b1(i,e){return N(this,null,function*(){let t=G(i);t.asyncQueue.verifyOperationInProgress(),F("RemoteStore","RemoteStore received new credentials");let n=_s(t);t.L_.add(3),yield xo(t),n&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield Dl(t)})}function jg(i,e){return N(this,null,function*(){let t=G(i);e?(t.L_.delete(2),yield Dl(t)):e||(t.L_.add(2),yield xo(t),t.q_.set("Unknown"))})}function Do(i){return i.K_||(i.K_=function(t,n,s){let r=G(t);return r.w_(),new Vg(n,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,s)}(i.datastore,i.asyncQueue,{Eo:iD.bind(null,i),Ro:sD.bind(null,i),mo:rD.bind(null,i),d_:oD.bind(null,i)}),i.B_.push(e=>N(this,null,function*(){e?(i.K_.s_(),M_(i)?O_(i):i.q_.set("Unknown")):(yield i.K_.stop(),XI(i))}))),i.K_}function ps(i){return i.U_||(i.U_=function(t,n,s){let r=G(t);return r.w_(),new Bg(n,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,s)}(i.datastore,i.asyncQueue,{Eo:()=>Promise.resolve(),Ro:cD.bind(null,i),mo:dD.bind(null,i),f_:uD.bind(null,i),g_:hD.bind(null,i)}),i.B_.push(e=>N(this,null,function*(){e?(i.U_.s_(),yield Po(i)):(yield i.U_.stop(),i.O_.length>0&&(F("RemoteStore",`Stopping write stream with ${i.O_.length} pending writes`),i.O_=[]))}))),i.U_}var Gg=class i{constructor(e,t,n,s,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=s,this.removalCallback=r,this.deferred=new vt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,s,r){let o=Date.now()+n,a=new i(e,t,o,s,r);return a.start(n),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new M(D.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function No(i,e){if(it("AsyncQueue",`${e}: ${i}`),gs(i))return new M(D.UNAVAILABLE,`${e}: ${i}`);throw i}var Sh=class i{constructor(e){this.comparator=e?(t,n)=>e(t,n)||W.comparator(t.key,n.key):(t,n)=>W.comparator(t.key,n.key),this.keyedMap=Ja(),this.sortedSet=new Ge(this.comparator)}static emptySet(e){return new i(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof i)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let s=t.getNext().key,r=n.getNext().key;if(!s.isEqual(r))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let n=new i;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}};var Ah=class{constructor(){this.W_=new Ge(W.comparator)}track(e){let t=e.doc.key,n=this.W_.get(t);n?e.type!==0&&n.type===3?this.W_=this.W_.insert(t,e):e.type===3&&n.type!==1?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.W_=this.W_.remove(t):e.type===1&&n.type===2?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):H():this.W_=this.W_.insert(t,e)}G_(){let e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}},To=class i{constructor(e,t,n,s,r,o,a,c,u){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=r,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=u}static fromInitialDocuments(e,t,n,s,r){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new i(e,t,Sh.emptySet(t),o,n,s,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Rl(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==n[s].type||!t[s].doc.isEqual(n[s].doc))return!1;return!0}};var Wg=class{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}},Hg=class{constructor(){this.queries=S1(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,n){let s=G(t),r=s.queries;s.queries=S1(),r.forEach((o,a)=>{for(let c of a.j_)c.onError(n)})})(this,new M(D.ABORTED,"Firestore shutting down"))}};function S1(){return new oi(i=>oI(i),Rl)}function F_(i,e){return N(this,null,function*(){let t=G(i),n=3,s=e.query,r=t.queries.get(s);r?!r.H_()&&e.J_()&&(n=2):(r=new Wg,n=e.J_()?0:1);try{switch(n){case 0:r.z_=yield t.onListen(s,!0);break;case 1:r.z_=yield t.onListen(s,!1);break;case 2:yield t.onFirstRemoteStoreListen(s)}}catch(o){let a=No(o,`Initialization of query '${to(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,r),r.j_.push(e),e.Z_(t.onlineState),r.z_&&e.X_(r.z_)&&V_(t)})}function L_(i,e){return N(this,null,function*(){let t=G(i),n=e.query,s=3,r=t.queries.get(n);if(r){let o=r.j_.indexOf(e);o>=0&&(r.j_.splice(o,1),r.j_.length===0?s=e.J_()?0:1:!r.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})}function fD(i,e){let t=G(i),n=!1;for(let s of e){let r=s.query,o=t.queries.get(r);if(o){for(let a of o.j_)a.X_(s)&&(n=!0);o.z_=s}}n&&V_(t)}function pD(i,e,t){let n=G(i),s=n.queries.get(e);if(s)for(let r of s.j_)r.onError(t);n.queries.delete(e)}function V_(i){i.Y_.forEach(e=>{e.next()})}var Kg,A1;(A1=Kg||(Kg={})).ea="default",A1.Cache="cache";var Tl=class{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){let n=[];for(let s of e.docChanges)s.type!==3&&n.push(s);e=new To(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;let n=t!=="Offline";return(!this.options._a||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;let t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=To.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Kg.Cache}};var Qg=class{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}};var Rh=class{constructor(e){this.serializer=e}Es(e){return ni(this.serializer,e)}ds(e){return e.metadata.exists?RI(this.serializer,e.document,!1):ft.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return rt(e)}},$g=class{constructor(e,t,n){this.ca=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=tC(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;let n=Ie.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){let t=new Map,n=new Rh(this.serializer);for(let s of e)if(s.metadata.queries){let r=n.Es(s.metadata.name);for(let o of s.metadata.queries){let a=(t.get(o)||fe()).add(r);t.set(o,a)}}return t}complete(){return N(this,null,function*(){let e=yield eD(this.localStore,new Rh(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(let n of this.queries)yield tD(this.localStore,n,t.get(n.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}})}};function tC(i){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:i.totalDocuments,totalBytes:i.totalBytes}}var xh=class{constructor(e){this.key=e}},Ph=class{constructor(e){this.key=e}},Dh=class{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=fe(),this.mutatedKeys=fe(),this.Aa=lI(e),this.Ra=new Sh(this.Aa)}get Va(){return this.Ta}ma(e,t){let n=t?t.fa:new Ah,s=t?t.Ra:this.Ra,r=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1,c=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,u=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((d,f)=>{let m=s.get(d),_=xl(this.query,f)?f:null,v=!!m&&this.mutatedKeys.has(m.key),C=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations),R=!1;m&&_?m.data.isEqual(_.data)?v!==C&&(n.track({type:3,doc:_}),R=!0):this.ga(m,_)||(n.track({type:2,doc:_}),R=!0,(c&&this.Aa(_,c)>0||u&&this.Aa(_,u)<0)&&(a=!0)):!m&&_?(n.track({type:0,doc:_}),R=!0):m&&!_&&(n.track({type:1,doc:m}),R=!0,(c||u)&&(a=!0)),R&&(_?(o=o.add(_),r=C?r.add(d):r.delete(d)):(o=o.delete(d),r=r.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),r=r.delete(d.key),n.track({type:1,doc:d})}return{Ra:o,fa:n,ns:a,mutatedKeys:r}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,s){let r=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;let o=e.fa.G_();o.sort((d,f)=>function(_,v){let C=R=>{switch(R){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return H()}};return C(_)-C(v)}(d.type,f.type)||this.Aa(d.doc,f.doc)),this.pa(n),s=s!=null&&s;let a=t&&!s?this.ya():[],c=this.da.size===0&&this.current&&!s?1:0,u=c!==this.Ea;return this.Ea=c,o.length!==0||u?{snapshot:new To(this.query,e.Ra,r,o,e.mutatedKeys,c===0,u,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Ah,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];let e=this.da;this.da=fe(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});let t=[];return e.forEach(n=>{this.da.has(n)||t.push(new Ph(n))}),this.da.forEach(n=>{e.has(n)||t.push(new xh(n))}),t}ba(e){this.Ta=e.Ts,this.da=fe();let t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return To.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}},Yg=class{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}},Xg=class{constructor(e){this.key=e,this.va=!1}},Jg=class{constructor(e,t,n,s,r,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=s,this.currentUser=r,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new oi(a=>oI(a),Rl),this.Ma=new Map,this.xa=new Set,this.Oa=new Ge(W.comparator),this.Na=new Map,this.La=new vl,this.Ba={},this.ka=new Map,this.qa=yo.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}};function mD(i,e,t=!0){return N(this,null,function*(){let n=Hh(i),s,r=n.Fa.get(e);return r?(n.sharedClientState.addLocalQueryTarget(r.targetId),s=r.view.Da()):s=yield nC(n,e,t,!0),s})}function gD(i,e){return N(this,null,function*(){let t=Hh(i);yield nC(t,e,!0,!1)})}function nC(i,e,t,n){return N(this,null,function*(){let s=yield vo(i.localStore,Qt(e)),r=s.targetId,o=i.sharedClientState.addLocalQueryTarget(r,t),a;return n&&(a=yield B_(i,e,r,o==="current",s.resumeToken)),i.isPrimaryClient&&t&&Wh(i.remoteStore,s),a})}function B_(i,e,t,n,s){return N(this,null,function*(){i.Ka=(f,m,_)=>function(C,R,U,q){return N(this,null,function*(){let z=R.view.ma(U);z.ns&&(z=yield vh(C.localStore,R.query,!1).then(({documents:T})=>R.view.ma(T,z)));let Y=q&&q.targetChanges.get(R.targetId),he=q&&q.targetMismatches.get(R.targetId)!=null,ee=R.view.applyChanges(z,C.isPrimaryClient,Y,he);return Zg(C,R.targetId,ee.wa),ee.snapshot})}(i,f,m,_);let r=yield vh(i.localStore,e,!0),o=new Dh(e,r.Ts),a=o.ma(r.documents),c=ml.createSynthesizedTargetChangeForCurrentChange(t,n&&i.onlineState!=="Offline",s),u=o.applyChanges(a,i.isPrimaryClient,c);Zg(i,t,u.wa);let d=new Yg(e,t,o);return i.Fa.set(e,d),i.Ma.has(t)?i.Ma.get(t).push(e):i.Ma.set(t,[e]),u.snapshot})}function _D(i,e,t){return N(this,null,function*(){let n=G(i),s=n.Fa.get(e),r=n.Ma.get(s.targetId);if(r.length>1)return n.Ma.set(s.targetId,r.filter(o=>!Rl(o,e))),void n.Fa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||(yield wo(n.localStore,s.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(s.targetId),t&&Eo(n.remoteStore,s.targetId),Io(n,s.targetId)}).catch(ms))):(Io(n,s.targetId),yield wo(n.localStore,s.targetId,!0))})}function yD(i,e){return N(this,null,function*(){let t=G(i),n=t.Fa.get(e),s=t.Ma.get(n.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Eo(t.remoteStore,n.targetId))})}function vD(i,e,t){return N(this,null,function*(){let n=j_(i);try{let s=yield function(o,a){let c=G(o),u=$e.now(),d=a.reduce((_,v)=>_.add(v.key),fe()),f,m;return c.persistence.runTransaction("Locally write mutations","readwrite",_=>{let v=tn(),C=fe();return c.cs.getEntries(_,d).next(R=>{v=R,v.forEach((U,q)=>{q.isValidDocument()||(C=C.add(U))})}).next(()=>c.localDocuments.getOverlayedDocuments(_,v)).next(R=>{f=R;let U=[];for(let q of a){let z=kP(q,f.get(q.key).overlayedDocument);z!=null&&U.push(new qn(q.key,z,Z1(z.value.mapValue),et.exists(!0)))}return c.mutationQueue.addMutationBatch(_,u,U,a)}).next(R=>{m=R;let U=R.applyToLocalDocumentSet(f,C);return c.documentOverlayCache.saveOverlays(_,R.batchId,U)})}).then(()=>({batchId:m.batchId,changes:uI(f)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(s.batchId),function(o,a,c){let u=o.Ba[o.currentUser.toKey()];u||(u=new Ge(ce)),u=u.insert(a,c),o.Ba[o.currentUser.toKey()]=u}(n,s.batchId,t),yield Pi(n,s.changes),yield Po(n.remoteStore)}catch(s){let r=No(s,"Failed to persist write");t.reject(r)}})}function iC(i,e){return N(this,null,function*(){let t=G(i);try{let n=yield JP(t.localStore,e);e.targetChanges.forEach((s,r)=>{let o=t.Na.get(r);o&&($(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?$(o.va):s.removedDocuments.size>0&&($(o.va),o.va=!1))}),yield Pi(t,n,e)}catch(n){yield ms(n)}})}function R1(i,e,t){let n=G(i);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){let s=[];n.Fa.forEach((r,o)=>{let a=o.view.Z_(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){let c=G(o);c.onlineState=a;let u=!1;c.queries.forEach((d,f)=>{for(let m of f.j_)m.Z_(a)&&(u=!0)}),u&&V_(c)}(n.eventManager,e),s.length&&n.Ca.d_(s),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function wD(i,e,t){return N(this,null,function*(){let n=G(i);n.sharedClientState.updateQueryState(e,"rejected",t);let s=n.Na.get(e),r=s&&s.key;if(r){let o=new Ge(W.comparator);o=o.insert(r,ft.newNoDocument(r,J.min()));let a=fe().add(r),c=new pl(J.min(),new Map,new Ge(ce),o,a);yield iC(n,c),n.Oa=n.Oa.remove(r),n.Na.delete(e),z_(n)}else yield wo(n.localStore,e,!1).then(()=>Io(n,e,t)).catch(ms)})}function ED(i,e){return N(this,null,function*(){let t=G(i),n=e.batch.batchId;try{let s=yield XP(t.localStore,e);q_(t,n,null),U_(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield Pi(t,s)}catch(s){yield ms(s)}})}function TD(i,e,t){return N(this,null,function*(){let n=G(i);try{let s=yield function(o,a){let c=G(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let d;return c.mutationQueue.lookupMutationBatch(u,a).next(f=>($(f!==null),d=f.keys(),c.mutationQueue.removeMutationBatch(u,f))).next(()=>c.mutationQueue.performConsistencyCheck(u)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(u,d,a)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,d)).next(()=>c.localDocuments.getDocuments(u,d))})}(n.localStore,e);q_(n,e,t),U_(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield Pi(n,s)}catch(s){yield ms(s)}})}function ID(i,e){return N(this,null,function*(){let t=G(i);_s(t.remoteStore)||F("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let n=yield function(o){let a=G(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>a.mutationQueue.getHighestUnacknowledgedBatchId(c))}(t.localStore);if(n===-1)return void e.resolve();let s=t.ka.get(n)||[];s.push(e),t.ka.set(n,s)}catch(n){let s=No(n,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}})}function U_(i,e){(i.ka.get(e)||[]).forEach(t=>{t.resolve()}),i.ka.delete(e)}function q_(i,e,t){let n=G(i),s=n.Ba[n.currentUser.toKey()];if(s){let r=s.get(e);r&&(t?r.reject(t):r.resolve(),s=s.remove(e)),n.Ba[n.currentUser.toKey()]=s}}function Io(i,e,t=null){i.sharedClientState.removeLocalQueryTarget(e);for(let n of i.Ma.get(e))i.Fa.delete(n),t&&i.Ca.$a(n,t);i.Ma.delete(e),i.isPrimaryClient&&i.La.gr(e).forEach(n=>{i.La.containsKey(n)||sC(i,n)})}function sC(i,e){i.xa.delete(e.path.canonicalString());let t=i.Oa.get(e);t!==null&&(Eo(i.remoteStore,t),i.Oa=i.Oa.remove(e),i.Na.delete(t),z_(i))}function Zg(i,e,t){for(let n of t)n instanceof xh?(i.La.addReference(n.key,e),CD(i,n)):n instanceof Ph?(F("SyncEngine","Document no longer in limbo: "+n.key),i.La.removeReference(n.key,e),i.La.containsKey(n.key)||sC(i,n.key)):H()}function CD(i,e){let t=e.key,n=t.path.canonicalString();i.Oa.get(t)||i.xa.has(n)||(F("SyncEngine","New document in limbo: "+t),i.xa.add(n),z_(i))}function z_(i){for(;i.xa.size>0&&i.Oa.size<i.maxConcurrentLimboResolutions;){let e=i.xa.values().next().value;i.xa.delete(e);let t=new W(Ie.fromString(e)),n=i.qa.next();i.Na.set(n,new Xg(t)),i.Oa=i.Oa.insert(t,n),Wh(i.remoteStore,new _o(Qt(Ro(t.path)),n,"TargetPurposeLimboResolution",un.oe))}}function Pi(i,e,t){return N(this,null,function*(){let n=G(i),s=[],r=[],o=[];n.Fa.isEmpty()||(n.Fa.forEach((a,c)=>{o.push(n.Ka(c,e,t).then(u=>{var d;if((u||t)&&n.isPrimaryClient){let f=u?!u.fromCache:(d=t?.targetChanges.get(c.targetId))===null||d===void 0?void 0:d.current;n.sharedClientState.updateQueryState(c.targetId,f?"current":"not-current")}if(u){s.push(u);let f=Dg.Wi(c.targetId,u);r.push(f)}}))}),yield Promise.all(o),n.Ca.d_(s),yield function(c,u){return N(this,null,function*(){let d=G(c);try{yield d.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>x.forEach(u,m=>x.forEach(m.$i,_=>d.persistence.referenceDelegate.addReference(f,m.targetId,_)).next(()=>x.forEach(m.Ui,_=>d.persistence.referenceDelegate.removeReference(f,m.targetId,_)))))}catch(f){if(!gs(f))throw f;F("LocalStore","Failed to update sequence numbers: "+f)}for(let f of u){let m=f.targetId;if(!f.fromCache){let _=d.os.get(m),v=_.snapshotVersion,C=_.withLastLimboFreeSnapshotVersion(v);d.os=d.os.insert(m,C)}}})}(n.localStore,r))})}function bD(i,e){return N(this,null,function*(){let t=G(i);if(!t.currentUser.isEqual(e)){F("SyncEngine","User change. New user:",e.toKey());let n=yield jI(t.localStore,e);t.currentUser=e,function(r,o){r.ka.forEach(a=>{a.forEach(c=>{c.reject(new M(D.CANCELLED,o))})}),r.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield Pi(t,n.hs)}})}function SD(i,e){let t=G(i),n=t.Na.get(e);if(n&&n.va)return fe().add(n.key);{let s=fe(),r=t.Ma.get(e);if(!r)return s;for(let o of r){let a=t.Fa.get(o);s=s.unionWith(a.view.Va)}return s}}function AD(i,e){return N(this,null,function*(){let t=G(i),n=yield vh(t.localStore,e.query,!0),s=e.view.ba(n);return t.isPrimaryClient&&Zg(t,e.targetId,s.wa),s})}function RD(i,e){return N(this,null,function*(){let t=G(i);return KI(t.localStore,e).then(n=>Pi(t,n))})}function xD(i,e,t,n){return N(this,null,function*(){let s=G(i),r=yield function(a,c){let u=G(a),d=G(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",f=>d.Mn(f,c).next(m=>m?u.localDocuments.getDocuments(f,m):x.resolve(null)))}(s.localStore,e);r!==null?(t==="pending"?yield Po(s.remoteStore):t==="acknowledged"||t==="rejected"?(q_(s,e,n||null),U_(s,e),function(a,c){G(G(a).mutationQueue).On(c)}(s.localStore,e)):H(),yield Pi(s,r)):F("SyncEngine","Cannot apply mutation batch with id: "+e)})}function PD(i,e){return N(this,null,function*(){let t=G(i);if(Hh(t),j_(t),e===!0&&t.Qa!==!0){let n=t.sharedClientState.getAllActiveQueryTargets(),s=yield x1(t,n.toArray());t.Qa=!0,yield jg(t.remoteStore,!0);for(let r of s)Wh(t.remoteStore,r)}else if(e===!1&&t.Qa!==!1){let n=[],s=Promise.resolve();t.Ma.forEach((r,o)=>{t.sharedClientState.isLocalQueryTarget(o)?n.push(o):s=s.then(()=>(Io(t,o),wo(t.localStore,o,!0))),Eo(t.remoteStore,o)}),yield s,yield x1(t,n),function(o){let a=G(o);a.Na.forEach((c,u)=>{Eo(a.remoteStore,u)}),a.La.pr(),a.Na=new Map,a.Oa=new Ge(W.comparator)}(t),t.Qa=!1,yield jg(t.remoteStore,!1)}})}function x1(i,e,t){return N(this,null,function*(){let n=G(i),s=[],r=[];for(let o of e){let a,c=n.Ma.get(o);if(c&&c.length!==0){a=yield vo(n.localStore,Qt(c[0]));for(let u of c){let d=n.Fa.get(u),f=yield AD(n,d);f.snapshot&&r.push(f.snapshot)}}else{let u=yield HI(n.localStore,o);a=yield vo(n.localStore,u),yield B_(n,rC(u),o,!1,a.resumeToken)}s.push(a)}return n.Ca.d_(r),s})}function rC(i){return rI(i.path,i.collectionGroup,i.orderBy,i.filters,i.limit,"F",i.startAt,i.endAt)}function DD(i){return function(t){return G(G(t).persistence).Qi()}(G(i).localStore)}function ND(i,e,t,n){return N(this,null,function*(){let s=G(i);if(s.Qa)return void F("SyncEngine","Ignoring unexpected query state notification.");let r=s.Ma.get(e);if(r&&r.length>0)switch(t){case"current":case"not-current":{let o=yield KI(s.localStore,aI(r[0])),a=pl.createSynthesizedRemoteEventForCurrentChange(e,t==="current",ot.EMPTY_BYTE_STRING);yield Pi(s,o,a);break}case"rejected":yield wo(s.localStore,e,!0),Io(s,e,n);break;default:H()}})}function kD(i,e,t){return N(this,null,function*(){let n=Hh(i);if(n.Qa){for(let s of e){if(n.Ma.has(s)&&n.sharedClientState.isActiveQueryTarget(s)){F("SyncEngine","Adding an already active target "+s);continue}let r=yield HI(n.localStore,s),o=yield vo(n.localStore,r);yield B_(n,rC(r),o.targetId,!1,o.resumeToken),Wh(n.remoteStore,o)}for(let s of t)n.Ma.has(s)&&(yield wo(n.localStore,s,!1).then(()=>{Eo(n.remoteStore,s),Io(n,s)}).catch(ms))}})}function Hh(i){let e=G(i);return e.remoteStore.remoteSyncer.applyRemoteEvent=iC.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=SD.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=wD.bind(null,e),e.Ca.d_=fD.bind(null,e.eventManager),e.Ca.$a=pD.bind(null,e.eventManager),e}function j_(i){let e=G(i);return e.remoteStore.remoteSyncer.applySuccessfulWrite=ED.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=TD.bind(null,e),e}function OD(i,e,t){let n=G(i);(function(r,o,a){return N(this,null,function*(){try{let c=yield o.getMetadata();if(yield function(_,v){let C=G(_),R=rt(v.createTime);return C.persistence.runTransaction("hasNewerBundle","readonly",U=>C.Gr.getBundleMetadata(U,v.id)).then(U=>!!U&&U.createTime.compareTo(R)>=0)}(r.localStore,c))return yield o.close(),a._completeWith(function(_){return{taskState:"Success",documentsLoaded:_.totalDocuments,bytesLoaded:_.totalBytes,totalDocuments:_.totalDocuments,totalBytes:_.totalBytes}}(c)),Promise.resolve(new Set);a._updateProgress(tC(c));let u=new $g(c,r.localStore,o.serializer),d=yield o.Ua();for(;d;){let m=yield u.la(d);m&&a._updateProgress(m),d=yield o.Ua()}let f=yield u.complete();return yield Pi(r,f.Ia,void 0),yield function(_,v){let C=G(_);return C.persistence.runTransaction("Save bundle","readwrite",R=>C.Gr.saveBundleMetadata(R,v))}(r.localStore,c),a._completeWith(f.progress),Promise.resolve(f.Pa)}catch(c){return Bn("SyncEngine",`Loading bundle failed with ${c}`),a._failWith(c),Promise.resolve(new Set)}})})(n,e,t).then(s=>{n.sharedClientState.notifyBundleLoaded(s)})}var e_=(()=>{class i{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return N(this,null,function*(){this.serializer=Pl(t.databaseInfo.databaseId),this.sharedClientState=this.Wa(t),this.persistence=this.Ga(t),yield this.persistence.start(),this.localStore=this.za(t),this.gcScheduler=this.ja(t,this.localStore),this.indexBackfillerScheduler=this.Ha(t,this.localStore)})}ja(t,n){return null}Ha(t,n){return null}za(t){return zI(this.persistence,new yh,t.initialUser,this.serializer)}Ga(t){return new gh(_h.Zr,this.serializer)}Wa(t){return new Th}terminate(){return N(this,null,function*(){var t,n;(t=this.gcScheduler)===null||t===void 0||t.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return i.provider={build:()=>new i},i})();var Nh=class i extends e_{constructor(e,t,n){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return N(this,null,function*(){yield sf(i.prototype,this,"initialize").call(this,e),yield this.Ja.initialize(this,e),yield j_(this.Ja.syncEngine),yield Po(this.Ja.remoteStore),yield this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}za(e){return zI(this.persistence,new yh,e.initialUser,this.serializer)}ja(e,t){let n=this.persistence.referenceDelegate.garbageCollector;return new mg(n,e.asyncQueue,t)}Ha(e,t){let n=new Nm(t,this.persistence);return new Dm(e.asyncQueue,n)}Ga(e){let t=N_(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?Pn.withCacheSize(this.cacheSizeBytes):Pn.DEFAULT;return new Pg(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,$I(),Wu(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new Th}},t_=class i extends Nh{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return N(this,null,function*(){yield sf(i.prototype,this,"initialize").call(this,e);let t=this.Ja.syncEngine;this.sharedClientState instanceof sl&&(this.sharedClientState.syncEngine={no:xD.bind(null,t),ro:ND.bind(null,t),io:kD.bind(null,t),Qi:DD.bind(null,t),eo:RD.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.yi(n=>N(this,null,function*(){yield PD(this.Ja.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())}))})}Wa(e){let t=$I();if(!sl.D(t))throw new M(D.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=N_(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new sl(t,e.asyncQueue,n,e.clientId,e.initialUser)}},G_=(()=>{class i{initialize(t,n){return N(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>R1(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=bD.bind(null,this.syncEngine),yield jg(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new Hg}()}createDatastore(t){let n=Pl(t.databaseInfo.databaseId),s=function(o){return new Lg(o)}(t.databaseInfo);return function(o,a,c,u){return new Ug(o,a,c,u)}(t.authCredentials,t.appCheckCredentials,s,n)}createRemoteStore(t){return function(s,r,o,a,c){return new zg(s,r,o,a,c)}(this.localStore,this.datastore,t.asyncQueue,n=>R1(this.syncEngine,n,0),function(){return Ih.D()?new Ih:new Mg}())}createSyncEngine(t,n){return function(r,o,a,c,u,d,f){let m=new Jg(r,o,a,c,u,d);return f&&(m.Qa=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,n)}terminate(){return N(this,null,function*(){var t,n;yield function(r){return N(this,null,function*(){let o=G(r);F("RemoteStore","RemoteStore shutting down."),o.L_.add(5),yield xo(o),o.k_.shutdown(),o.q_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()})}}return i.provider={build:()=>new i},i})();function P1(i,e=10240){let t=0;return{read(){return N(this,null,function*(){if(t<i.byteLength){let s={value:i.slice(t,t+e),done:!1};return t+=e,s}return{done:!0}})},cancel(){return N(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var Co=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):it("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var n_=class{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new vt,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(n=>{n&&n.ua()?this.metadata.resolve(n.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(n?.aa)}`))},n=>this.metadata.reject(n))}close(){return this.Xa.cancel()}getMetadata(){return N(this,null,function*(){return this.metadata.promise})}Ua(){return N(this,null,function*(){return yield this.getMetadata(),this.tu()})}tu(){return N(this,null,function*(){let e=yield this.nu();if(e===null)return null;let t=this.eu.decode(e),n=Number(t);isNaN(n)&&this.ru(`length string (${t}) is not valid number`);let s=yield this.iu(n);return new Qg(JSON.parse(s),e.length+n)})}su(){return this.buffer.findIndex(e=>e===123)}nu(){return N(this,null,function*(){for(;this.su()<0&&!(yield this.ou()););if(this.buffer.length===0)return null;let e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}iu(e){return N(this,null,function*(){for(;this.buffer.length<e;)(yield this.ou())&&this.ru("Reached the end of bundle when more is expected.");let t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}ou(){return N(this,null,function*(){let e=yield this.Xa.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var i_=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return N(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new M(D.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(s,r){return N(this,null,function*(){let o=G(s),a={documents:r.map(f=>gl(o.serializer,f))},c=yield o.Lo("BatchGetDocuments",o.serializer.databaseId,Ie.emptyPath(),a,r.length),u=new Map;c.forEach(f=>{let m=BP(o.serializer,f);u.set(m.key.toString(),m)});let d=[];return r.forEach(f=>{let m=u.get(f.toString());$(!!m),d.push(m)}),d})}(this.datastore,e);return t.forEach(n=>this.recordVersion(n)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(e.toString())}delete(e){this.write(new fs(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return N(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,n)=>{let s=W.fromPath(n);this.mutations.push(new hl(s,this.precondition(s)))}),yield function(n,s){return N(this,null,function*(){let r=G(n),o={writes:s.map(a=>_l(r.serializer,a))};yield r.Mo("Commit",r.serializer.databaseId,Ie.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw H();t=J.min()}let n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new M(D.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(J.min())?et.exists(!1):et.updateTime(t):et.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(J.min()))throw new M(D.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return et.updateTime(t)}return et.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var s_=class{constructor(e,t,n,s,r){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=s,this.deferred=r,this._u=n.maxAttempts,this.t_=new El(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(()=>N(this,null,function*(){let e=new i_(this.datastore),t=this.cu(e);t&&t.then(n=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(n)}).catch(s=>{this.lu(s)}))}).catch(n=>{this.lu(n)})}))}cu(e){try{let t=this.updateFunction(e);return!Sl(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!wI(t)}return!1}};var r_=class{constructor(e,t,n,s,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=s,this.user=dt.UNAUTHENTICATED,this.clientId=Ku.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=r,this.authCredentials.start(n,o=>N(this,null,function*(){F("FirestoreClient","Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(n,o=>(F("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new vt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>N(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let n=No(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}};function wm(i,e){return N(this,null,function*(){i.asyncQueue.verifyOperationInProgress(),F("FirestoreClient","Initializing OfflineComponentProvider");let t=i.configuration;yield e.initialize(t);let n=t.initialUser;i.setCredentialChangeListener(s=>N(this,null,function*(){n.isEqual(s)||(yield jI(e.localStore,s),n=s)})),e.persistence.setDatabaseDeletedListener(()=>i.terminate()),i._offlineComponents=e})}function D1(i,e){return N(this,null,function*(){i.asyncQueue.verifyOperationInProgress();let t=yield W_(i);F("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,i.configuration),i.setCredentialChangeListener(n=>b1(e.remoteStore,n)),i.setAppCheckTokenChangeListener((n,s)=>b1(e.remoteStore,s)),i._onlineComponents=e})}function W_(i){return N(this,null,function*(){if(!i._offlineComponents)if(i._uninitializedComponentsProvider){F("FirestoreClient","Using user provided OfflineComponentProvider");try{yield wm(i,i._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(s){return s.name==="FirebaseError"?s.code===D.FAILED_PRECONDITION||s.code===D.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;Bn("Error using user provided cache. Falling back to memory cache: "+t),yield wm(i,new e_)}}else F("FirestoreClient","Using default OfflineComponentProvider"),yield wm(i,new e_);return i._offlineComponents})}function Kh(i){return N(this,null,function*(){return i._onlineComponents||(i._uninitializedComponentsProvider?(F("FirestoreClient","Using user provided OnlineComponentProvider"),yield D1(i,i._uninitializedComponentsProvider._online)):(F("FirestoreClient","Using default OnlineComponentProvider"),yield D1(i,new G_))),i._onlineComponents})}function oC(i){return W_(i).then(e=>e.persistence)}function H_(i){return W_(i).then(e=>e.localStore)}function aC(i){return Kh(i).then(e=>e.remoteStore)}function K_(i){return Kh(i).then(e=>e.syncEngine)}function MD(i){return Kh(i).then(e=>e.datastore)}function bo(i){return N(this,null,function*(){let e=yield Kh(i),t=e.eventManager;return t.onListen=mD.bind(null,e.syncEngine),t.onUnlisten=_D.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=gD.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=yD.bind(null,e.syncEngine),t})}function FD(i){return i.asyncQueue.enqueue(()=>N(this,null,function*(){let e=yield oC(i),t=yield aC(i);return e.setNetworkEnabled(!0),function(s){let r=G(s);return r.L_.delete(0),Dl(r)}(t)}))}function LD(i){return i.asyncQueue.enqueue(()=>N(this,null,function*(){let e=yield oC(i),t=yield aC(i);return e.setNetworkEnabled(!1),function(s){return N(this,null,function*(){let r=G(s);r.L_.add(0),yield xo(r),r.q_.set("Offline")})}(t)}))}function VD(i,e){let t=new vt;return i.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(s,r,o){return N(this,null,function*(){try{let a=yield function(u,d){let f=G(u);return f.persistence.runTransaction("read document","readonly",m=>f.localDocuments.getDocument(m,d))}(s,r);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new M(D.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let c=No(a,`Failed to get document '${r} from cache`);o.reject(c)}})}(yield H_(i),e,t)})),t.promise}function lC(i,e,t={}){let n=new vt;return i.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(r,o,a,c,u){let d=new Co({next:m=>{d.Za(),o.enqueueAndForget(()=>L_(r,f));let _=m.docs.has(a);!_&&m.fromCache?u.reject(new M(D.UNAVAILABLE,"Failed to get document because the client is offline.")):_&&m.fromCache&&c&&c.source==="server"?u.reject(new M(D.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(m)},error:m=>u.reject(m)}),f=new Tl(Ro(a.path),d,{includeMetadataChanges:!0,_a:!0});return F_(r,f)}(yield bo(i),i.asyncQueue,e,t,n)})),n.promise}function BD(i,e){let t=new vt;return i.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(s,r,o){return N(this,null,function*(){try{let a=yield vh(s,r,!0),c=new Dh(r,a.Ts),u=c.ma(a.documents),d=c.applyChanges(u,!1);o.resolve(d.snapshot)}catch(a){let c=No(a,`Failed to execute query '${r} against cache`);o.reject(c)}})}(yield H_(i),e,t)})),t.promise}function cC(i,e,t={}){let n=new vt;return i.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(r,o,a,c,u){let d=new Co({next:m=>{d.Za(),o.enqueueAndForget(()=>L_(r,f)),m.fromCache&&c.source==="server"?u.reject(new M(D.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(m)},error:m=>u.reject(m)}),f=new Tl(a,d,{includeMetadataChanges:!0,_a:!0});return F_(r,f)}(yield bo(i),i.asyncQueue,e,t,n)})),n.promise}function UD(i,e){let t=new Co(e);return i.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(s,r){G(s).Y_.add(r),r.next()}(yield bo(i),t)})),()=>{t.Za(),i.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return function(s,r){G(s).Y_.delete(r)}(yield bo(i),t)}))}}function qD(i,e,t,n){let s=function(o,a){let c;return c=typeof o=="string"?TI().encode(o):o,function(d,f){return new n_(d,f)}(function(d,f){if(d instanceof Uint8Array)return P1(d,f);if(d instanceof ArrayBuffer)return P1(new Uint8Array(d),f);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),a)}(t,Pl(e));i.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){OD(yield K_(i),s,n)}))}function zD(i,e){return i.asyncQueue.enqueue(()=>N(this,null,function*(){return function(n,s){let r=G(n);return r.persistence.runTransaction("Get named query","readonly",o=>r.Gr.getNamedQuery(o,s))}(yield H_(i),e)}))}function uC(i){let e={};return i.timeoutSeconds!==void 0&&(e.timeoutSeconds=i.timeoutSeconds),e}var N1=new Map;function Q_(i,e,t){if(!t)throw new M(D.INVALID_ARGUMENT,`Function ${i}() cannot be called with an empty ${e}.`)}function $_(i,e,t,n){if(e===!0&&n===!0)throw new M(D.INVALID_ARGUMENT,`${i} and ${t} cannot be used together.`)}function k1(i){if(!W.isDocumentKey(i))throw new M(D.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${i} has ${i.length}.`)}function O1(i){if(W.isDocumentKey(i))throw new M(D.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${i} has ${i.length}.`)}function Qh(i){if(i===void 0)return"undefined";if(i===null)return"null";if(typeof i=="string")return i.length>20&&(i=`${i.substring(0,20)}...`),JSON.stringify(i);if(typeof i=="number"||typeof i=="boolean")return""+i;if(typeof i=="object"){if(i instanceof Array)return"an array";{let e=function(n){return n.constructor?n.constructor.name:null}(i);return e?`a custom ${e} object`:"an object"}}return typeof i=="function"?"a function":H()}function Se(i,e){if("_delegate"in i&&(i=i._delegate),!(i instanceof e)){if(e.name===i.constructor.name)throw new M(D.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Qh(i);throw new M(D.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return i}function hC(i,e){if(e<=0)throw new M(D.INVALID_ARGUMENT,`Function ${i}() requires a positive number, but it was: ${e}.`)}var kh=class{constructor(e){var t,n;if(e.host===void 0){if(e.ssl!==void 0)throw new M(D.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new M(D.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}$_("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=uC((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new M(D.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new M(D.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new M(D.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,s){return n.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},nr=class{constructor(e,t,n,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new kh({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new M(D.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new M(D.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new kh(e),e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new Em;switch(n.type){case"firstParty":return new bm(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new M(D.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return N(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let n=N1.get(t);n&&(F("ComponentProvider","Removing Datastore"),N1.delete(t),n.terminate())}(this),Promise.resolve()}};function dC(i,e,t,n={}){var s;let r=(i=Se(i,nr))._getSettings(),o=`${e}:${t}`;if(r.host!=="firestore.googleapis.com"&&r.host!==o&&Bn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),i._setSettings(Object.assign(Object.assign({},r),{host:o,ssl:!1})),n.mockUserToken){let a,c;if(typeof n.mockUserToken=="string")a=n.mockUserToken,c=dt.MOCK_USER;else{a=Ec(n.mockUserToken,(s=i._app)===null||s===void 0?void 0:s.options.projectId);let u=n.mockUserToken.sub||n.mockUserToken.user_id;if(!u)throw new M(D.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new dt(u)}i._authCredentials=new Tm(new Hu(a,c))}}var St=class i{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new i(this.firestore,e,this._query)}},Ve=class i{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ii(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new i(this.firestore,e,this._key)}},ii=class i extends St{constructor(e,t,n){super(e,t,Ro(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Ve(this.firestore,null,new W(e))}withConverter(e){return new i(this.firestore,e,this._path)}};function Y_(i,e,...t){if(i=ve(i),Q_("collection","path",e),i instanceof nr){let n=Ie.fromString(e,...t);return O1(n),new ii(i,null,n)}{if(!(i instanceof Ve||i instanceof ii))throw new M(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=i._path.child(Ie.fromString(e,...t));return O1(n),new ii(i.firestore,null,n)}}function fC(i,e){if(i=Se(i,nr),Q_("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new M(D.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new St(i,null,function(n){return new Un(Ie.emptyPath(),n)}(e))}function Nl(i,e,...t){if(i=ve(i),arguments.length===1&&(e=Ku.newId()),Q_("doc","path",e),i instanceof nr){let n=Ie.fromString(e,...t);return k1(n),new Ve(i,null,new W(n))}{if(!(i instanceof Ve||i instanceof ii))throw new M(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=i._path.child(Ie.fromString(e,...t));return k1(n),new Ve(i.firestore,i instanceof ii?i.converter:null,new W(n))}}function X_(i,e){return i=ve(i),e=ve(e),(i instanceof Ve||i instanceof ii)&&(e instanceof Ve||e instanceof ii)&&i.firestore===e.firestore&&i.path===e.path&&i.converter===e.converter}function J_(i,e){return i=ve(i),e=ve(e),i instanceof St&&e instanceof St&&i.firestore===e.firestore&&Rl(i._query,e._query)&&i.converter===e.converter}var Oh=class{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new El(this,"async_queue_retry"),this.Vu=()=>{let n=Wu();n&&F("AsyncQueue","Visibility state changed to "+n.visibilityState),this.t_.jo()},this.mu=e;let t=Wu();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;let t=Wu();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});let t=new vt;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}pu(){return N(this,null,function*(){if(this.Pu.length!==0){try{yield this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!gs(e))throw e;F("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}})}gu(e){let t=this.mu.then(()=>(this.du=!0,e().catch(n=>{this.Eu=n,this.du=!1;let s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(n);throw it("INTERNAL UNHANDLED ERROR: ",s),n}).then(n=>(this.du=!1,n))));return this.mu=t,t}enqueueAfterDelay(e,t,n){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);let s=Gg.createAndSchedule(this,e,t,n,r=>this.yu(r));return this.Tu.push(s),s}fu(){this.Eu&&H()}verifyOperationInProgress(){}wu(){return N(this,null,function*(){let e;do e=this.mu,yield e;while(e!==this.mu)})}Su(e){for(let t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(let t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){let t=this.Tu.indexOf(e);this.Tu.splice(t,1)}};function o_(i){return function(t,n){if(typeof t!="object"||t===null)return!1;let s=t;for(let r of n)if(r in s&&typeof s[r]=="function")return!0;return!1}(i,["next","error","complete"])}var a_=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new vt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var pC=-1,Ye=class extends nr{constructor(e,t,n,s){super(e,t,n,s),this.type="firestore",this._queue=new Oh,this._persistenceKey=s?.name||"[DEFAULT]"}_terminate(){return N(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new Oh(e),this._firestoreClient=void 0,yield e}})}};function At(i){if(i._terminated)throw new M(D.FAILED_PRECONDITION,"The client has already been terminated.");return i._firestoreClient||mC(i),i._firestoreClient}function mC(i){var e,t,n;let s=i._freezeSettings(),r=function(a,c,u,d){return new km(a,c,u,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,uC(d.experimentalLongPollingOptions),d.useFetchStreams)}(i._databaseId,((e=i._app)===null||e===void 0?void 0:e.options.appId)||"",i._persistenceKey,s);i._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((n=s.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(i._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),i._firestoreClient=new r_(i._authCredentials,i._appCheckCredentials,i._queue,r,i._componentsProvider&&function(a){let c=a?._online.build();return{_offline:a?._offline.build(c),_online:c}}(i._componentsProvider))}function gC(i,e){Bn("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=i._freezeSettings();return yC(i,G_.provider,{build:n=>new Nh(n,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}function _C(i){return N(this,null,function*(){Bn("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=i._freezeSettings();yC(i,G_.provider,{build:t=>new t_(t,e.cacheSizeBytes)})})}function yC(i,e,t){if((i=Se(i,Ye))._firestoreClient||i._terminated)throw new M(D.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(i._componentsProvider||i._getSettings().localCache)throw new M(D.FAILED_PRECONDITION,"SDK cache is already specified.");i._componentsProvider={_online:e,_offline:t},mC(i)}function vC(i){if(i._initialized&&!i._terminated)throw new M(D.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new vt;return i._queue.enqueueAndForgetEvenWhileRestricted(()=>N(this,null,function*(){try{yield function(n){return N(this,null,function*(){if(!os.D())return Promise.resolve();let s=n+"main";yield os.delete(s)})}(N_(i._databaseId,i._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function wC(i){return function(t){let n=new vt;return t.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return ID(yield K_(t),n)})),n.promise}(At(i=Se(i,Ye)))}function EC(i){return FD(At(i=Se(i,Ye)))}function TC(i){return LD(At(i=Se(i,Ye)))}function IC(i,e){let t=At(i=Se(i,Ye)),n=new a_;return qD(t,i._databaseId,e,n),n}function CC(i,e){return zD(At(i=Se(i,Ye)),e).then(t=>t?new St(i,null,t.query):null)}var ai=class i{constructor(e){this._byteString=e}static fromBase64String(e){try{return new i(ot.fromBase64String(e))}catch(t){throw new M(D.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new i(ot.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var zn=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new M(D.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new st(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Ri=class{constructor(e){this._methodName=e}};var ir=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new M(D.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new M(D.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ce(this._lat,e._lat)||ce(this._long,e._long)}};var Il=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,s){if(n.length!==s.length)return!1;for(let r=0;r<n.length;++r)if(n[r]!==s[r])return!1;return!0}(this._values,e._values)}};var jD=/^__.*__$/,l_=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new qn(e,this.data,this.fieldMask,t,this.fieldTransforms):new ds(e,this.data,t,this.fieldTransforms)}},Mh=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new qn(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function bC(i){switch(i){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw H()}}var Fh=class i{constructor(e,t,n,s,r,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=s,r===void 0&&this.vu(),this.fieldTransforms=r||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new i(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:n,xu:!1});return s.Ou(e),s}Nu(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:n,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Lh(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(bC(this.Cu)&&jD.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}},c_=class{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Pl(e)}Qu(e,t,n,s=!1){return new Fh({Cu:e,methodName:t,qu:n,path:st.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function ar(i){let e=i._freezeSettings(),t=Pl(i._databaseId);return new c_(i._databaseId,!!e.ignoreUndefinedProperties,t)}function $h(i,e,t,n,s,r={}){let o=i.Qu(r.merge||r.mergeFields?2:0,e,t,s);ty("Data must be an object, but it was:",o,n);let a=RC(n,o),c,u;if(r.merge)c=new hn(o.fieldMask),u=o.fieldTransforms;else if(r.mergeFields){let d=[];for(let f of r.mergeFields){let m=p_(e,f,t);if(!o.contains(m))throw new M(D.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);PC(d,m)||d.push(m)}c=new hn(d),u=o.fieldTransforms.filter(f=>c.covers(f.field))}else c=null,u=o.fieldTransforms;return new l_(new Lt(a),c,u)}var Cl=class i extends Ri{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof i}};function SC(i,e,t){return new Fh({Cu:3,qu:e.settings.qu,methodName:i._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var u_=class i extends Ri{_toFieldTransform(e){return new Zs(e.path,new us)}isEqual(e){return e instanceof i}},h_=class i extends Ri{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){let t=SC(this,e,!0),n=this.Ku.map(r=>lr(r,t)),s=new Si(n);return new Zs(e.path,s)}isEqual(e){return e instanceof i&&hf(this.Ku,e.Ku)}},d_=class i extends Ri{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){let t=SC(this,e,!0),n=this.Ku.map(r=>lr(r,t)),s=new Ai(n);return new Zs(e.path,s)}isEqual(e){return e instanceof i&&hf(this.Ku,e.Ku)}},f_=class i extends Ri{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){let t=new hs(e.serializer,fI(e.serializer,this.$u));return new Zs(e.path,t)}isEqual(e){return e instanceof i&&this.$u===e.$u}};function Z_(i,e,t,n){let s=i.Qu(1,e,t);ty("Data must be an object, but it was:",s,n);let r=[],o=Lt.empty();or(n,(c,u)=>{let d=ny(e,c,t);u=ve(u);let f=s.Nu(d);if(u instanceof Cl)r.push(d);else{let m=lr(u,f);m!=null&&(r.push(d),o.set(d,m))}});let a=new hn(r);return new Mh(o,a,s.fieldTransforms)}function ey(i,e,t,n,s,r){let o=i.Qu(1,e,t),a=[p_(e,n,t)],c=[s];if(r.length%2!=0)throw new M(D.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<r.length;m+=2)a.push(p_(e,r[m])),c.push(r[m+1]);let u=[],d=Lt.empty();for(let m=a.length-1;m>=0;--m)if(!PC(u,a[m])){let _=a[m],v=c[m];v=ve(v);let C=o.Nu(_);if(v instanceof Cl)u.push(_);else{let R=lr(v,C);R!=null&&(u.push(_),d.set(_,R))}}let f=new hn(u);return new Mh(d,f,o.fieldTransforms)}function AC(i,e,t,n=!1){return lr(t,i.Qu(n?4:3,e))}function lr(i,e){if(xC(i=ve(i)))return ty("Unsupported field value:",e,i),RC(i,e);if(i instanceof Ri)return function(n,s){if(!bC(s.Cu))throw s.Bu(`${n._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${n._methodName}() is not currently supported inside arrays`);let r=n._toFieldTransform(s);r&&s.fieldTransforms.push(r)}(i,e),null;if(i===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),i instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(n,s){let r=[],o=0;for(let a of n){let c=lr(a,s.Lu(o));c==null&&(c={nullValue:"NULL_VALUE"}),r.push(c),o++}return{arrayValue:{values:r}}}(i,e)}return function(n,s){if((n=ve(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return fI(s.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let r=$e.fromDate(n);return{timestampValue:go(s.serializer,r)}}if(n instanceof $e){let r=new $e(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:go(s.serializer,r)}}if(n instanceof ir)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof ai)return{bytesValue:II(s.serializer,n._byteString)};if(n instanceof Ve){let r=s.databaseId,o=n.firestore._databaseId;if(!o.isEqual(r))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:x_(n.firestore._databaseId||s.databaseId,n._key.path)}}if(n instanceof Il)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(c=>{if(typeof c!="number")throw a.Bu("VectorValues must only contain numeric values.");return R_(a.serializer,c)})}}}}}}(n,s);throw s.Bu(`Unsupported field value: ${Qh(n)}`)}(i,e)}function RC(i,e){let t={};return $1(i)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):or(i,(n,s)=>{let r=lr(s,e.Mu(n));r!=null&&(t[n]=r)}),{mapValue:{fields:t}}}function xC(i){return!(typeof i!="object"||i===null||i instanceof Array||i instanceof Date||i instanceof $e||i instanceof ir||i instanceof ai||i instanceof Ve||i instanceof Ri||i instanceof Il)}function ty(i,e,t){if(!xC(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){let n=Qh(t);throw n==="an object"?e.Bu(i+" a custom object"):e.Bu(i+" "+n)}}function p_(i,e,t){if((e=ve(e))instanceof zn)return e._internalPath;if(typeof e=="string")return ny(i,e);throw Lh("Field path arguments must be of type string or ",i,!1,void 0,t)}var GD=new RegExp("[~\\*/\\[\\]]");function ny(i,e,t){if(e.search(GD)>=0)throw Lh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,i,!1,void 0,t);try{return new zn(...e.split("."))._internalPath}catch{throw Lh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,i,!1,void 0,t)}}function Lh(i,e,t,n,s){let r=n&&!n.isEmpty(),o=s!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(r||o)&&(c+=" (found",r&&(c+=` in field ${n}`),o&&(c+=` in document ${s}`),c+=")"),new M(D.INVALID_ARGUMENT,a+i+c)}function PC(i,e){return i.some(t=>t.isEqual(e))}var sr=class{constructor(e,t,n,s,r){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=s,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new Ve(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new m_(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Yh("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},m_=class extends sr{data(){return super.data()}};function Yh(i,e){return typeof e=="string"?ny(i,e):e instanceof zn?e._internalPath:e._delegate._internalPath}function DC(i){if(i.limitType==="L"&&i.explicitOrderBy.length===0)throw new M(D.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var bl=class{},rr=class extends bl{};function Di(i,e,...t){let n=[];e instanceof bl&&n.push(e),n=n.concat(t),function(r){let o=r.filter(c=>c instanceof g_).length,a=r.filter(c=>c instanceof Vh).length;if(o>1||o>0&&a>0)throw new M(D.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(let s of n)i=s._apply(i);return i}var Vh=class i extends rr{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new i(e,t,n)}_apply(e){let t=this._parse(e);return qC(e._query,t),new St(e.firestore,e.converter,Hm(e._query,t))}_parse(e){let t=ar(e.firestore);return function(r,o,a,c,u,d,f){let m;if(u.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new M(D.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){F1(f,d);let _=[];for(let v of f)_.push(M1(c,r,v));m={arrayValue:{values:_}}}else m=M1(c,r,f)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||F1(f,d),m=AC(a,o,f,d==="in"||d==="not-in");return we.create(u,d,m)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function NC(i,e,t){let n=e,s=Yh("where",i);return Vh._create(s,n,t)}var g_=class i extends bl{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new i(e,t)}_parse(e){let t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return t.length===1?t[0]:Ne.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(s,r){let o=s,a=r.getFlattenedFilters();for(let c of a)qC(o,c),o=Hm(o,c)}(e._query,t),new St(e.firestore,e.converter,Hm(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var __=class i extends rr{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new i(e,t)}_apply(e){let t=function(s,r,o){if(s.startAt!==null)throw new M(D.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new M(D.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Xs(r,o)}(e._query,this._field,this._direction);return new St(e.firestore,e.converter,function(s,r){let o=s.explicitOrderBy.concat([r]);return new Un(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}};function kC(i,e="asc"){let t=e,n=Yh("orderBy",i);return __._create(n,t)}var Bh=class i extends rr{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new i(e,t,n)}_apply(e){return new St(e.firestore,e.converter,ih(e._query,this._limit,this._limitType))}};function OC(i){return hC("limit",i),Bh._create("limit",i,"F")}function MC(i){return hC("limitToLast",i),Bh._create("limitToLast",i,"L")}var Uh=class i extends rr{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new i(e,t,n)}_apply(e){let t=UC(e,this.type,this._docOrFields,this._inclusive);return new St(e.firestore,e.converter,function(s,r){return new Un(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,r,s.endAt)}(e._query,t))}};function FC(...i){return Uh._create("startAt",i,!0)}function LC(...i){return Uh._create("startAfter",i,!1)}var qh=class i extends rr{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new i(e,t,n)}_apply(e){let t=UC(e,this.type,this._docOrFields,this._inclusive);return new St(e.firestore,e.converter,function(s,r){return new Un(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,r)}(e._query,t))}};function VC(...i){return qh._create("endBefore",i,!1)}function BC(...i){return qh._create("endAt",i,!0)}function UC(i,e,t,n){if(t[0]=ve(t[0]),t[0]instanceof sr)return function(r,o,a,c,u){if(!c)throw new M(D.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let d=[];for(let f of ao(r))if(f.field.isKeyField())d.push(Ys(o,c.key));else{let m=c.data.field(f.field);if(jh(m))throw new M(D.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(m===null){let _=f.field.canonicalString();throw new M(D.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${_}' (used as the orderBy) does not exist.`)}d.push(m)}return new ri(d,u)}(i._query,i.firestore._databaseId,e,t[0]._document,n);{let s=ar(i.firestore);return function(o,a,c,u,d,f){let m=o.explicitOrderBy;if(d.length>m.length)throw new M(D.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let _=[];for(let v=0;v<d.length;v++){let C=d[v];if(m[v].field.isKeyField()){if(typeof C!="string")throw new M(D.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof C}`);if(!S_(o)&&C.indexOf("/")!==-1)throw new M(D.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${C}' contains a slash.`);let R=o.path.child(Ie.fromString(C));if(!W.isDocumentKey(R))throw new M(D.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${R}' is not because it contains an odd number of segments.`);let U=new W(R);_.push(Ys(a,U))}else{let R=AC(c,u,C);_.push(R)}}return new ri(_,f)}(i._query,i.firestore._databaseId,s,e,t,n)}}function M1(i,e,t){if(typeof(t=ve(t))=="string"){if(t==="")throw new M(D.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!S_(e)&&t.indexOf("/")!==-1)throw new M(D.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let n=e.path.child(Ie.fromString(t));if(!W.isDocumentKey(n))throw new M(D.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return Ys(i,new W(n))}if(t instanceof Ve)return Ys(i,t._key);throw new M(D.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Qh(t)}.`)}function F1(i,e){if(!Array.isArray(i)||i.length===0)throw new M(D.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function qC(i,e){let t=function(s,r){for(let o of s)for(let a of o.getFlattenedFilters())if(r.indexOf(a.op)>=0)return a.op;return null}(i.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new M(D.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new M(D.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var So=class{convertValue(e,t="none"){switch($s(e)){case 0:return null;case 1:return e.booleanValue;case 2:return He(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(as(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw H()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return or(e,(s,r)=>{n[s]=this.convertValue(r,t)}),n}convertVectorValue(e){var t,n,s;let r=(s=(n=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||n===void 0?void 0:n.values)===null||s===void 0?void 0:s.map(o=>He(o.doubleValue));return new Il(r)}convertGeoPoint(e){return new ir(He(e.latitude),He(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=C_(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(ll(e));default:return null}}convertTimestamp(e){let t=bi(e);return new $e(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=Ie.fromString(e);$(OI(n));let s=new ls(n.get(1),n.get(3)),r=new W(n.popFirst(5));return s.isEqual(t)||it(`Document ${r} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}};function Xh(i,e,t){let n;return n=i?t&&(t.merge||t.mergeFields)?i.toFirestore(e,t):i.toFirestore(e):e,n}var y_=class extends So{constructor(e){super(),this.firestore=e}convertBytes(e){return new ai(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ve(this.firestore,null,t)}};var Ci=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Nn=class extends sr{constructor(e,t,n,s,r,o){super(e,t,n,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new ss(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(Yh("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}},ss=class extends Nn{data(e={}){return super.data(e)}},jn=class{constructor(e,t,n,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Ci(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new ss(this._firestore,this._userDataWriter,n.key,n,new Ci(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new M(D.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,r){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{let c=new ss(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Ci(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>r||a.type!==3).map(a=>{let c=new ss(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Ci(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter),u=-1,d=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:WD(a.type),doc:c,oldIndex:u,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function WD(i){switch(i){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return H()}}function iy(i,e){return i instanceof Nn&&e instanceof Nn?i._firestore===e._firestore&&i._key.isEqual(e._key)&&(i._document===null?e._document===null:i._document.isEqual(e._document))&&i._converter===e._converter:i instanceof jn&&e instanceof jn&&i._firestore===e._firestore&&J_(i.query,e.query)&&i.metadata.isEqual(e.metadata)&&i._snapshot.isEqual(e._snapshot)}function zC(i){i=Se(i,Ve);let e=Se(i.firestore,Ye);return lC(At(e),i._key).then(t=>ay(e,i,t))}var xi=class extends So{constructor(e){super(),this.firestore=e}convertBytes(e){return new ai(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ve(this.firestore,null,t)}};function jC(i){i=Se(i,Ve);let e=Se(i.firestore,Ye),t=At(e),n=new xi(e);return VD(t,i._key).then(s=>new Nn(e,n,i._key,s,new Ci(s!==null&&s.hasLocalMutations,!0),i.converter))}function GC(i){i=Se(i,Ve);let e=Se(i.firestore,Ye);return lC(At(e),i._key,{source:"server"}).then(t=>ay(e,i,t))}function WC(i){i=Se(i,St);let e=Se(i.firestore,Ye),t=At(e),n=new xi(e);return DC(i._query),cC(t,i._query).then(s=>new jn(e,n,i,s))}function HC(i){i=Se(i,St);let e=Se(i.firestore,Ye),t=At(e),n=new xi(e);return BD(t,i._query).then(s=>new jn(e,n,i,s))}function KC(i){i=Se(i,St);let e=Se(i.firestore,Ye),t=At(e),n=new xi(e);return cC(t,i._query,{source:"server"}).then(s=>new jn(e,n,i,s))}function sy(i,e,t){i=Se(i,Ve);let n=Se(i.firestore,Ye),s=Xh(i.converter,e,t);return ko(n,[$h(ar(n),"setDoc",i._key,s,i.converter!==null,t).toMutation(i._key,et.none())])}function ry(i,e,t,...n){i=Se(i,Ve);let s=Se(i.firestore,Ye),r=ar(s),o;return o=typeof(e=ve(e))=="string"||e instanceof zn?ey(r,"updateDoc",i._key,e,t,n):Z_(r,"updateDoc",i._key,e),ko(s,[o.toMutation(i._key,et.exists(!0))])}function QC(i){return ko(Se(i.firestore,Ye),[new fs(i._key,et.none())])}function $C(i,e){let t=Se(i.firestore,Ye),n=Nl(i),s=Xh(i.converter,e);return ko(t,[$h(ar(i.firestore),"addDoc",n._key,s,i.converter!==null,{}).toMutation(n._key,et.exists(!1))]).then(()=>n)}function oy(i,...e){var t,n,s;i=ve(i);let r={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||o_(e[o])||(r=e[o],o++);let a={includeMetadataChanges:r.includeMetadataChanges,source:r.source};if(o_(e[o])){let f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(n=f.error)===null||n===void 0?void 0:n.bind(f),e[o+2]=(s=f.complete)===null||s===void 0?void 0:s.bind(f)}let c,u,d;if(i instanceof Ve)u=Se(i.firestore,Ye),d=Ro(i._key.path),c={next:f=>{e[o]&&e[o](ay(u,i,f))},error:e[o+1],complete:e[o+2]};else{let f=Se(i,St);u=Se(f.firestore,Ye),d=f._query;let m=new xi(u);c={next:_=>{e[o]&&e[o](new jn(u,m,f,_))},error:e[o+1],complete:e[o+2]},DC(i._query)}return function(m,_,v,C){let R=new Co(C),U=new Tl(_,R,v);return m.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return F_(yield bo(m),U)})),()=>{R.Za(),m.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return L_(yield bo(m),U)}))}}(At(u),d,a,c)}function YC(i,e){return UD(At(i=Se(i,Ye)),o_(e)?e:{next:e})}function ko(i,e){return function(n,s){let r=new vt;return n.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){return vD(yield K_(n),s,r)})),r.promise}(At(i),e)}function ay(i,e,t){let n=t.docs.get(e._key),s=new xi(i);return new Nn(i,s,e._key,n,new Ci(t.hasPendingWrites,t.fromCache),e.converter)}var HD={maxAttempts:5};var zh=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=ar(e)}set(e,t,n){this._verifyNotCommitted();let s=ns(e,this._firestore),r=Xh(s.converter,t,n),o=$h(this._dataReader,"WriteBatch.set",s._key,r,s.converter!==null,n);return this._mutations.push(o.toMutation(s._key,et.none())),this}update(e,t,n,...s){this._verifyNotCommitted();let r=ns(e,this._firestore),o;return o=typeof(t=ve(t))=="string"||t instanceof zn?ey(this._dataReader,"WriteBatch.update",r._key,t,n,s):Z_(this._dataReader,"WriteBatch.update",r._key,t),this._mutations.push(o.toMutation(r._key,et.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=ns(e,this._firestore);return this._mutations=this._mutations.concat(new fs(t._key,et.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new M(D.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function ns(i,e){if((i=ve(i)).firestore!==e)throw new M(D.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return i}var v_=class extends class{constructor(t,n){this._firestore=t,this._transaction=n,this._dataReader=ar(t)}get(t){let n=ns(t,this._firestore),s=new y_(this._firestore);return this._transaction.lookup([n._key]).then(r=>{if(!r||r.length!==1)return H();let o=r[0];if(o.isFoundDocument())return new sr(this._firestore,s,o.key,o,n.converter);if(o.isNoDocument())return new sr(this._firestore,s,n._key,null,n.converter);throw H()})}set(t,n,s){let r=ns(t,this._firestore),o=Xh(r.converter,n,s),a=$h(this._dataReader,"Transaction.set",r._key,o,r.converter!==null,s);return this._transaction.set(r._key,a),this}update(t,n,s,...r){let o=ns(t,this._firestore),a;return a=typeof(n=ve(n))=="string"||n instanceof zn?ey(this._dataReader,"Transaction.update",o._key,n,s,r):Z_(this._dataReader,"Transaction.update",o._key,n),this._transaction.update(o._key,a),this}delete(t){let n=ns(t,this._firestore);return this._transaction.delete(n._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=ns(e,this._firestore),n=new xi(this._firestore);return super.get(e).then(s=>new Nn(this._firestore,n,t._key,s._document,new Ci(!1,!1),t.converter))}};function XC(i,e,t){i=Se(i,Ye);let n=Object.assign(Object.assign({},HD),t);return function(r){if(r.maxAttempts<1)throw new M(D.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(r,o,a){let c=new vt;return r.asyncQueue.enqueueAndForget(()=>N(this,null,function*(){let u=yield MD(r);new s_(r.asyncQueue,u,a,o,c).au()})),c.promise}(At(i),s=>e(new v_(i,s)),n)}function JC(){return new Cl("deleteField")}function ZC(){return new u_("serverTimestamp")}function eb(...i){return new h_("arrayUnion",i)}function tb(...i){return new d_("arrayRemove",i)}function nb(i){return new f_("increment",i)}(function(e,t=!0){(function(s){Ao=s})(Sc),bc(new Kn("firestore",(n,{instanceIdentifier:s,options:r})=>{let o=n.getProvider("app").getImmediate(),a=new Ye(new Im(n.getProvider("auth-internal")),new Am(n.getProvider("app-check-internal")),function(u,d){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new M(D.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ls(u.options.projectId,d)}(o,s),o);return r=Object.assign({useFetchStreams:t},r),a._setSettings(r),a},"PUBLIC").setMultipleInstances(!0)),Dr(OT,"4.7.3",e),Dr(OT,"4.7.3","esm2017")})();var KD="@firebase/firestore-compat",QD="0.3.38";function fy(i,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new M("invalid-argument",`Invalid options passed to function ${i}(): You cannot specify both "merge" and "mergeFields".`);return e}function ib(){if(typeof Uint8Array>"u")throw new M("unimplemented","Uint8Arrays are not available in this environment.")}function sb(){if(!Y1())throw new M("unimplemented","Blobs are unavailable in Firestore in this environment.")}var Jh=class i{constructor(e){this._delegate=e}static fromBase64String(e){return sb(),new i(ai.fromBase64String(e))}static fromUint8Array(e){return ib(),new i(ai.fromUint8Array(e))}toBase64(){return sb(),this._delegate.toBase64()}toUint8Array(){return ib(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function ly(i){return $D(i,["next","error","complete"])}function $D(i,e){if(typeof i!="object"||i===null)return!1;let t=i;for(let n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}var cy=class{enableIndexedDbPersistence(e,t){return gC(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return _C(e._delegate)}clearIndexedDbPersistence(e){return vC(e._delegate)}},Zh=class{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof ls||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Bn("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,n={}){dC(this._delegate,e,t,n)}enableNetwork(){return EC(this._delegate)}disableNetwork(){return TC(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,$_("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return wC(this._delegate)}onSnapshotsInSync(e){return YC(this._delegate,e)}get app(){if(!this._appCompat)throw new M("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Fo(this,Y_(this._delegate,e))}catch(t){throw $t(t,"collection()","Firestore.collection()")}}doc(e){try{return new li(this,Nl(this._delegate,e))}catch(t){throw $t(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new dr(this,fC(this._delegate,e))}catch(t){throw $t(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return XC(this._delegate,t=>e(new ed(this,t)))}batch(){return At(this._delegate),new td(new zh(this._delegate,e=>ko(this._delegate,e)))}loadBundle(e){return IC(this._delegate,e)}namedQuery(e){return CC(this._delegate,e).then(t=>t?new dr(this,t):null)}},Oo=class extends So{constructor(e){super(),this.firestore=e}convertBytes(e){return new Jh(new ai(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return li.forKey(t,this.firestore,null)}};function YD(i){L1(i)}var ed=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Oo(e)}get(e){let t=cr(e);return this._delegate.get(t).then(n=>new ur(this._firestore,new Nn(this._firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,t.converter)))}set(e,t,n){let s=cr(e);return n?(fy("Transaction.set",n),this._delegate.set(s,t,n)):this._delegate.set(s,t),this}update(e,t,n,...s){let r=cr(e);return arguments.length===2?this._delegate.update(r,t):this._delegate.update(r,t,n,...s),this}delete(e){let t=cr(e);return this._delegate.delete(t),this}},td=class{constructor(e){this._delegate=e}set(e,t,n){let s=cr(e);return n?(fy("WriteBatch.set",n),this._delegate.set(s,t,n)):this._delegate.set(s,t),this}update(e,t,n,...s){let r=cr(e);return arguments.length===2?this._delegate.update(r,t):this._delegate.update(r,t,n,...s),this}delete(e){let t=cr(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},Mo=class i{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){let n=new ss(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new hr(this._firestore,n),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let n=i.INSTANCES,s=n.get(e);s||(s=new WeakMap,n.set(e,s));let r=s.get(t);return r||(r=new i(e,new Oo(e),t),s.set(t,r)),r}};Mo.INSTANCES=new WeakMap;var li=class i{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Oo(e)}static forPath(e,t,n){if(e.length%2!==0)throw new M("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new i(t,new Ve(t._delegate,n,new W(e)))}static forKey(e,t,n){return new i(t,new Ve(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new Fo(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Fo(this.firestore,Y_(this._delegate,e))}catch(t){throw $t(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=ve(e),e instanceof Ve?X_(this._delegate,e):!1}set(e,t){t=fy("DocumentReference.set",t);try{return t?sy(this._delegate,e,t):sy(this._delegate,e)}catch(n){throw $t(n,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return arguments.length===1?ry(this._delegate,e):ry(this._delegate,e,t,...n)}catch(s){throw $t(s,"updateDoc()","DocumentReference.update()")}}delete(){return QC(this._delegate)}onSnapshot(...e){let t=rb(e),n=ob(e,s=>new ur(this.firestore,new Nn(this.firestore._delegate,this._userDataWriter,s._key,s._document,s.metadata,this._delegate.converter)));return oy(this._delegate,t,n)}get(e){let t;return e?.source==="cache"?t=jC(this._delegate):e?.source==="server"?t=GC(this._delegate):t=zC(this._delegate),t.then(n=>new ur(this.firestore,new Nn(this.firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,this._delegate.converter)))}withConverter(e){return new i(this.firestore,e?this._delegate.withConverter(Mo.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function $t(i,e,t){return i.message=i.message.replace(e,t),i}function rb(i){for(let e of i)if(typeof e=="object"&&!ly(e))return e;return{}}function ob(i,e){var t,n;let s;return ly(i[0])?s=i[0]:ly(i[1])?s=i[1]:typeof i[0]=="function"?s={next:i[0],error:i[1],complete:i[2]}:s={next:i[1],error:i[2],complete:i[3]},{next:r=>{s.next&&s.next(e(r))},error:(t=s.error)===null||t===void 0?void 0:t.bind(s),complete:(n=s.complete)===null||n===void 0?void 0:n.bind(s)}}var ur=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new li(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return iy(this._delegate,e._delegate)}},hr=class extends ur{data(e){let t=this._delegate.data(e);return this._delegate._converter||V1(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},dr=class i{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Oo(e)}where(e,t,n){try{return new i(this.firestore,Di(this._delegate,NC(e,t,n)))}catch(s){throw $t(s,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new i(this.firestore,Di(this._delegate,kC(e,t)))}catch(n){throw $t(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new i(this.firestore,Di(this._delegate,OC(e)))}catch(t){throw $t(t,"limit()","Query.limit()")}}limitToLast(e){try{return new i(this.firestore,Di(this._delegate,MC(e)))}catch(t){throw $t(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new i(this.firestore,Di(this._delegate,FC(...e)))}catch(t){throw $t(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new i(this.firestore,Di(this._delegate,LC(...e)))}catch(t){throw $t(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new i(this.firestore,Di(this._delegate,VC(...e)))}catch(t){throw $t(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new i(this.firestore,Di(this._delegate,BC(...e)))}catch(t){throw $t(t,"endAt()","Query.endAt()")}}isEqual(e){return J_(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=HC(this._delegate):e?.source==="server"?t=KC(this._delegate):t=WC(this._delegate),t.then(n=>new kl(this.firestore,new jn(this.firestore._delegate,this._userDataWriter,this._delegate,n._snapshot)))}onSnapshot(...e){let t=rb(e),n=ob(e,s=>new kl(this.firestore,new jn(this.firestore._delegate,this._userDataWriter,this._delegate,s._snapshot)));return oy(this._delegate,t,n)}withConverter(e){return new i(this.firestore,e?this._delegate.withConverter(Mo.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},uy=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new hr(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},kl=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new dr(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new hr(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new uy(this._firestore,t))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new hr(this._firestore,n))})}isEqual(e){return iy(this._delegate,e._delegate)}},Fo=class i extends dr{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new li(this.firestore,e):null}doc(e){try{return e===void 0?new li(this.firestore,Nl(this._delegate)):new li(this.firestore,Nl(this._delegate,e))}catch(t){throw $t(t,"doc()","CollectionReference.doc()")}}add(e){return $C(this._delegate,e).then(t=>new li(this.firestore,t))}isEqual(e){return X_(this._delegate,e._delegate)}withConverter(e){return new i(this.firestore,e?this._delegate.withConverter(Mo.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function cr(i){return Se(i,Ve)}var hy=class i{constructor(...e){this._delegate=new zn(...e)}static documentId(){return new i(st.keyField().canonicalString())}isEqual(e){return e=ve(e),e instanceof zn?this._delegate._internalPath.isEqual(e._internalPath):!1}};var dy=class i{constructor(e){this._delegate=e}static serverTimestamp(){let e=ZC();return e._methodName="FieldValue.serverTimestamp",new i(e)}static delete(){let e=JC();return e._methodName="FieldValue.delete",new i(e)}static arrayUnion(...e){let t=eb(...e);return t._methodName="FieldValue.arrayUnion",new i(t)}static arrayRemove(...e){let t=tb(...e);return t._methodName="FieldValue.arrayRemove",new i(t)}static increment(e){let t=nb(e);return t._methodName="FieldValue.increment",new i(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var XD={Firestore:Zh,GeoPoint:ir,Timestamp:$e,Blob:Jh,Transaction:ed,WriteBatch:td,DocumentReference:li,DocumentSnapshot:ur,Query:dr,QueryDocumentSnapshot:hr,QuerySnapshot:kl,CollectionReference:Fo,FieldPath:hy,FieldValue:dy,setLogLevel:YD,CACHE_SIZE_UNLIMITED:pC};function JD(i,e){i.INTERNAL.registerComponent(new Kn("firestore-compat",t=>{let n=t.getProvider("app-compat").getImmediate(),s=t.getProvider("firestore").getImmediate();return e(n,s)},"PUBLIC").setServiceProps(Object.assign({},XD)))}function ZD(i){JD(i,(e,t)=>new Zh(e,t,new cy)),i.registerVersion(KD,QD)}ZD(zi);function e2(i,e=rc){return new sc(t=>{let n;return e!=null?e.schedule(()=>{n=i.onSnapshot({includeMetadataChanges:!0},t)}):n=i.onSnapshot({includeMetadataChanges:!0},t),()=>{n?.()}})}function ab(i,e){return e2(i,e)}function t2(i,e){return ab(i,e).pipe(lc(void 0),ac(),at(t=>{let[n,s]=t;return s.exists?n?.exists?{payload:s,type:"modified"}:{payload:s,type:"added"}:{payload:s,type:"removed"}}))}function gy(i,e){return ab(i,e).pipe(at(t=>({payload:t,type:"query"})))}var nd=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let n=this.ref.collection(e),{ref:s,query:r}=db(n,t);return new sd(s,r,this.afs)}snapshotChanges(){return t2(this.ref,this.afs.schedulers.outsideAngular).pipe(yt)}valueChanges(e={}){return this.snapshotChanges().pipe(at(({payload:t})=>e.idField?sn(Ce({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return oa(this.ref.get(e)).pipe(yt)}};function id(i,e){return gy(i,e).pipe(lc(void 0),ac(),at(t=>{let[n,s]=t,r=s.payload.docChanges(),o=r.map(a=>({type:a.type,payload:a}));return n&&JSON.stringify(n.payload.metadata)!==JSON.stringify(s.payload.metadata)&&s.payload.docs.forEach((a,c)=>{let u=r.find(f=>f.doc.ref.isEqual(a.ref)),d=n?.payload.docs.find(f=>f.ref.isEqual(a.ref));u&&JSON.stringify(u.doc.metadata)===JSON.stringify(a.metadata)||!u&&d&&JSON.stringify(d.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:c,newIndex:c,type:"modified",doc:a}})}),o}))}function lb(i,e,t){return id(i,t).pipe(bs((n,s)=>n2(n,s.map(r=>r.payload),e),[]),oc(),at(n=>n.map(s=>({type:s.type,payload:s}))))}function n2(i,e,t){return e.forEach(n=>{t.indexOf(n.type)>-1&&(i=i2(i,n))}),i}function py(i,e,t,...n){let s=i.slice();return s.splice(e,t,...n),s}function i2(i,e){switch(e.type){case"added":if(!(i[e.newIndex]&&i[e.newIndex].doc.ref.isEqual(e.doc.ref)))return py(i,e.newIndex,0,e);break;case"modified":if(i[e.oldIndex]==null||i[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=i.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return py(i,e.newIndex,1,e);break;case"removed":if(i[e.oldIndex]&&i[e.oldIndex].doc.ref.isEqual(e.doc.ref))return py(i,e.oldIndex,1);break}return i}function cb(i){return(!i||i.length===0)&&(i=["added","removed","modified"]),i}var sd=class{ref;query;afs;constructor(e,t,n){this.ref=e,this.query=t,this.afs=n}stateChanges(e){let t=id(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(at(n=>n.filter(s=>e.indexOf(s.type)>-1)))),t.pipe(lc(void 0),ac(),of(([n,s])=>s.length>0||!n),at(([,n])=>n),yt)}auditTrail(e){return this.stateChanges(e).pipe(bs((t,n)=>[...t,...n],[]))}snapshotChanges(e){let t=cb(e);return lb(this.query,t,this.afs.schedulers.outsideAngular).pipe(yt)}valueChanges(e={}){return gy(this.query,this.afs.schedulers.outsideAngular).pipe(at(t=>t.payload.docs.map(n=>e.idField?sn(Ce({},n.data()),{[e.idField]:n.id}):n.data())),yt)}get(e){return oa(this.query.get(e)).pipe(yt)}add(e){return this.ref.add(e)}doc(e){return new nd(this.ref.doc(e),this.afs)}},my=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?id(this.query,this.afs.schedulers.outsideAngular).pipe(yt):id(this.query,this.afs.schedulers.outsideAngular).pipe(at(t=>t.filter(n=>e.indexOf(n.type)>-1)),of(t=>t.length>0),yt)}auditTrail(e){return this.stateChanges(e).pipe(bs((t,n)=>[...t,...n],[]))}snapshotChanges(e){let t=cb(e);return lb(this.query,t,this.afs.schedulers.outsideAngular).pipe(yt)}valueChanges(e={}){return gy(this.query,this.afs.schedulers.outsideAngular).pipe(at(n=>n.payload.docs.map(s=>e.idField?Ce({[e.idField]:s.id},s.data()):s.data())),yt)}get(e){return oa(this.query.get(e)).pipe(yt)}},ub=new Wn("angularfire2.enableFirestorePersistence"),hb=new Wn("angularfire2.firestore.persistenceSettings"),s2=new Wn("angularfire2.firestore.settings"),r2=new Wn("angularfire2.firestore.use-emulator");function db(i,e=t=>t){return{query:e(i),ref:i}}var _y=(()=>{class i{schedulers;firestore;persistenceEnabled$;constructor(t,n,s,r,o,a,c,u,d,f,m,_,v,C,R,U,q){this.schedulers=c;let z=Nc(t,a,n),Y=d;f&&Uc(z,a,m,v,C,R,_,U),[this.firestore,this.persistenceEnabled$]=kc(`${z.name}.firestore`,"AngularFirestore",z.name,()=>{let he=a.runOutsideAngular(()=>z.firestore());if(r&&he.settings(r),Y&&he.useEmulator(...Y),s&&!Ov(o)){let ee=()=>{try{return oa(he.enablePersistence(u||void 0).then(()=>!0,()=>!1))}catch(T){return typeof console<"u"&&console.warn(T),aa(!1)}};return[he,a.runOutsideAngular(ee)]}else return[he,aa(!1)]},[r,Y,s])}collection(t,n){let s;typeof t=="string"?s=this.firestore.collection(t):s=t;let{ref:r,query:o}=db(s,n),a=this.schedulers.ngZone.run(()=>r);return new sd(a,o,this)}collectionGroup(t,n){let s=n||(o=>o),r=this.firestore.collectionGroup(t);return new my(s(r),this)}doc(t){let n;typeof t=="string"?n=this.firestore.doc(t):n=t;let s=this.schedulers.ngZone.run(()=>n);return new nd(s,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(n){return new(n||i)(ne(Pc),ne(Dc,8),ne(ub,8),ne(s2,8),ne(_n),ne(zt),ne(xc),ne(hb,8),ne(r2,8),ne(qc,8),ne(Oc,8),ne(Mc,8),ne(Fc,8),ne(Lc,8),ne(Vc,8),ne(Bc,8),ne(Rc,8))};static \u0275prov=pt({token:i,factory:i.\u0275fac,providedIn:"any"})}return i})(),fb=(()=>{class i{constructor(){zi.registerVersion("angularfire",Ac.full,"fst-compat")}static enablePersistence(t){return{ngModule:i,providers:[{provide:ub,useValue:!0},{provide:hb,useValue:t}]}}static \u0275fac=function(n){return new(n||i)};static \u0275mod=gt({type:i});static \u0275inj=mt({providers:[_y]})}return i})();var a2=["*"];function l2(i,e){if(i&1){let t=Ct();L(0,"div",1)(1,"div",2)(2,"span",3)(3,"button",4),De("click",function(){ze(t);let s=Q();return je(s.onClose())}),ae(4,"\xD7"),V()(),Rs(5),V()()}}var rd=class i{showModal=!1;closeModal=new gi;onClose(){this.closeModal.emit()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=ye({type:i,selectors:[["app-modal"]],inputs:{showModal:"showModal"},outputs:{closeModal:"closeModal"},standalone:!0,features:[Re],ngContentSelectors:a2,decls:1,vars:1,consts:[["class","fixed inset-0 z-50 overflow-auto bg-gray-900/60 flex",4,"ngIf"],[1,"fixed","inset-0","z-50","overflow-auto","bg-gray-900/60","flex"],[1,"relative","p-8","bg-white","w-full","max-w-md","m-auto","flex-col","flex","rounded-lg"],[1,"absolute","top-0","right-0","p-4"],[1,"text-black",3,"click"]],template:function(t,n){t&1&&(As(),de(0,l2,6,0,"div",0)),t&2&&O("ngIf",n.showModal)},dependencies:[rn]})};var od=class i{constructor(e){this.sanitizer=e}transform(e){return this.sanitizer.bypassSecurityTrustHtml(e)}static \u0275fac=function(t){return new(t||i)(ie(yc,16))};static \u0275pipe=mv({name:"safeHtml",type:i,pure:!0,standalone:!0})};var Lo=class i{static isArray(e,t=!0){return Array.isArray(e)&&(t||e.length!==0)}static isObject(e,t=!0){return typeof e=="object"&&!Array.isArray(e)&&e!=null&&(t||Object.keys(e).length!==0)}static equals(e,t,n){return n?this.resolveFieldData(e,n)===this.resolveFieldData(t,n):this.equalsByValue(e,t)}static equalsByValue(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),s=Array.isArray(t),r,o,a;if(n&&s){if(o=e.length,o!=t.length)return!1;for(r=o;r--!==0;)if(!this.equalsByValue(e[r],t[r]))return!1;return!0}if(n!=s)return!1;var c=this.isDate(e),u=this.isDate(t);if(c!=u)return!1;if(c&&u)return e.getTime()==t.getTime();var d=e instanceof RegExp,f=t instanceof RegExp;if(d!=f)return!1;if(d&&f)return e.toString()==t.toString();var m=Object.keys(e);if(o=m.length,o!==Object.keys(t).length)return!1;for(r=o;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,m[r]))return!1;for(r=o;r--!==0;)if(a=m[r],!this.equalsByValue(e[a],t[a]))return!1;return!0}return e!==e&&t!==t}static resolveFieldData(e,t){if(e&&t){if(this.isFunction(t))return t(e);if(t.indexOf(".")==-1)return e[t];{let n=t.split("."),s=e;for(let r=0,o=n.length;r<o;++r){if(s==null)return null;s=s[n[r]]}return s}}else return null}static isFunction(e){return!!(e&&e.constructor&&e.call&&e.apply)}static reorderArray(e,t,n){let s;e&&t!==n&&(n>=e.length&&(n%=e.length,t%=e.length),e.splice(n,0,e.splice(t,1)[0]))}static insertIntoOrderedArray(e,t,n,s){if(n.length>0){let r=!1;for(let o=0;o<n.length;o++)if(this.findIndexInList(n[o],s)>t){n.splice(o,0,e),r=!0;break}r||n.push(e)}else n.push(e)}static findIndexInList(e,t){let n=-1;if(t){for(let s=0;s<t.length;s++)if(t[s]==e){n=s;break}}return n}static contains(e,t){if(e!=null&&t&&t.length){for(let n of t)if(this.equals(e,n))return!0}return!1}static removeAccents(e){return e&&(e=e.normalize("NFKD").replace(new RegExp("\\p{Diacritic}","gu"),"")),e}static isDate(e){return Object.prototype.toString.call(e)==="[object Date]"}static isEmpty(e){return e==null||e===""||Array.isArray(e)&&e.length===0||!this.isDate(e)&&typeof e=="object"&&Object.keys(e).length===0}static isNotEmpty(e){return!this.isEmpty(e)}static compare(e,t,n,s=1){let r=-1,o=this.isEmpty(e),a=this.isEmpty(t);return o&&a?r=0:o?r=s:a?r=-s:typeof e=="string"&&typeof t=="string"?r=e.localeCompare(t,n,{numeric:!0}):r=e<t?-1:e>t?1:0,r}static sort(e,t,n=1,s,r=1){let o=i.compare(e,t,s,n),a=n;return(i.isEmpty(e)||i.isEmpty(t))&&(a=r===1?n:r),a*o}static merge(e,t){if(!(e==null&&t==null)){{if((e==null||typeof e=="object")&&(t==null||typeof t=="object"))return Ce(Ce({},e||{}),t||{});if((e==null||typeof e=="string")&&(t==null||typeof t=="string"))return[e||"",t||""].join(" ")}return t||e}}static isPrintableCharacter(e=""){return this.isNotEmpty(e)&&e.length===1&&e.match(/\S| /)}static getItemValue(e,...t){return this.isFunction(e)?e(...t):e}static findLastIndex(e,t){let n=-1;if(this.isNotEmpty(e))try{n=e.findLastIndex(t)}catch{n=e.lastIndexOf([...e].reverse().find(t))}return n}static findLast(e,t){let n;if(this.isNotEmpty(e))try{n=e.findLast(t)}catch{n=[...e].reverse().find(t)}return n}static deepEquals(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),s=Array.isArray(t),r,o,a;if(n&&s){if(o=e.length,o!=t.length)return!1;for(r=o;r--!==0;)if(!this.deepEquals(e[r],t[r]))return!1;return!0}if(n!=s)return!1;var c=e instanceof Date,u=t instanceof Date;if(c!=u)return!1;if(c&&u)return e.getTime()==t.getTime();var d=e instanceof RegExp,f=t instanceof RegExp;if(d!=f)return!1;if(d&&f)return e.toString()==t.toString();var m=Object.keys(e);if(o=m.length,o!==Object.keys(t).length)return!1;for(r=o;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,m[r]))return!1;for(r=o;r--!==0;)if(a=m[r],!this.deepEquals(e[a],t[a]))return!1;return!0}return e!==e&&t!==t}},pb=0;function Rt(i="pn_id_"){return pb++,`${i}${pb}`}function u2(){let i=[],e=(r,o)=>{let a=i.length>0?i[i.length-1]:{key:r,value:o},c=a.value+(a.key===r?0:o)+2;return i.push({key:r,value:c}),c},t=r=>{i=i.filter(o=>o.value!==r)},n=()=>i.length>0?i[i.length-1].value:0,s=r=>r&&parseInt(r.style.zIndex,10)||0;return{get:s,set:(r,o,a)=>{o&&(o.style.zIndex=String(e(r,a)))},clear:r=>{r&&(t(s(r)),r.style.zIndex="")},getCurrent:()=>n()}}var ys=u2();var Vt=(()=>{class i{static STARTS_WITH="startsWith";static CONTAINS="contains";static NOT_CONTAINS="notContains";static ENDS_WITH="endsWith";static EQUALS="equals";static NOT_EQUALS="notEquals";static IN="in";static LESS_THAN="lt";static LESS_THAN_OR_EQUAL_TO="lte";static GREATER_THAN="gt";static GREATER_THAN_OR_EQUAL_TO="gte";static BETWEEN="between";static IS="is";static IS_NOT="isNot";static BEFORE="before";static AFTER="after";static DATE_IS="dateIs";static DATE_IS_NOT="dateIsNot";static DATE_BEFORE="dateBefore";static DATE_AFTER="dateAfter"}return i})();var Vo=(()=>{class i{messageSource=new nt;clearSource=new nt;messageObserver=this.messageSource.asObservable();clearObserver=this.clearSource.asObservable();add(t){t&&this.messageSource.next(t)}addAll(t){t&&t.length&&this.messageSource.next(t)}clear(t){this.clearSource.next(t||null)}static \u0275fac=function(n){return new(n||i)};static \u0275prov=pt({token:i,factory:i.\u0275fac})}return i})();var fr=(()=>{class i{ripple=!1;inputStyle=Ui("outlined");overlayOptions={};csp=Ui({nonce:void 0});filterMatchModeOptions={text:[Vt.STARTS_WITH,Vt.CONTAINS,Vt.NOT_CONTAINS,Vt.ENDS_WITH,Vt.EQUALS,Vt.NOT_EQUALS],numeric:[Vt.EQUALS,Vt.NOT_EQUALS,Vt.LESS_THAN,Vt.LESS_THAN_OR_EQUAL_TO,Vt.GREATER_THAN,Vt.GREATER_THAN_OR_EQUAL_TO],date:[Vt.DATE_IS,Vt.DATE_IS_NOT,Vt.DATE_BEFORE,Vt.DATE_AFTER]};translation={startsWith:"Starts with",contains:"Contains",notContains:"Not contains",endsWith:"Ends with",equals:"Equals",notEquals:"Not equals",noFilter:"No Filter",lt:"Less than",lte:"Less than or equal to",gt:"Greater than",gte:"Greater than or equal to",is:"Is",isNot:"Is not",before:"Before",after:"After",dateIs:"Date is",dateIsNot:"Date is not",dateBefore:"Date is before",dateAfter:"Date is after",clear:"Clear",apply:"Apply",matchAll:"Match All",matchAny:"Match Any",addRule:"Add Rule",removeRule:"Remove Rule",accept:"Yes",reject:"No",choose:"Choose",upload:"Upload",cancel:"Cancel",pending:"Pending",fileSizeTypes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],chooseYear:"Choose Year",chooseMonth:"Choose Month",chooseDate:"Choose Date",prevDecade:"Previous Decade",nextDecade:"Next Decade",prevYear:"Previous Year",nextYear:"Next Year",prevMonth:"Previous Month",nextMonth:"Next Month",prevHour:"Previous Hour",nextHour:"Next Hour",prevMinute:"Previous Minute",nextMinute:"Next Minute",prevSecond:"Previous Second",nextSecond:"Next Second",am:"am",pm:"pm",dateFormat:"mm/dd/yy",firstDayOfWeek:0,today:"Today",weekHeader:"Wk",weak:"Weak",medium:"Medium",strong:"Strong",passwordPrompt:"Enter a password",emptyMessage:"No results found",searchMessage:"{0} results are available",selectionMessage:"{0} items selected",emptySelectionMessage:"No selected item",emptySearchMessage:"No results found",emptyFilterMessage:"No results found",aria:{trueLabel:"True",falseLabel:"False",nullLabel:"Not Selected",star:"1 star",stars:"{star} stars",selectAll:"All items selected",unselectAll:"All items unselected",close:"Close",previous:"Previous",next:"Next",navigation:"Navigation",scrollTop:"Scroll Top",moveTop:"Move Top",moveUp:"Move Up",moveDown:"Move Down",moveBottom:"Move Bottom",moveToTarget:"Move to Target",moveToSource:"Move to Source",moveAllToTarget:"Move All to Target",moveAllToSource:"Move All to Source",pageLabel:"{page}",firstPageLabel:"First Page",lastPageLabel:"Last Page",nextPageLabel:"Next Page",prevPageLabel:"Previous Page",rowsPerPageLabel:"Rows per page",previousPageLabel:"Previous Page",jumpToPageDropdownLabel:"Jump to Page Dropdown",jumpToPageInputLabel:"Jump to Page Input",selectRow:"Row Selected",unselectRow:"Row Unselected",expandRow:"Row Expanded",collapseRow:"Row Collapsed",showFilterMenu:"Show Filter Menu",hideFilterMenu:"Hide Filter Menu",filterOperator:"Filter Operator",filterConstraint:"Filter Constraint",editRow:"Row Edit",saveEdit:"Save Edit",cancelEdit:"Cancel Edit",listView:"List View",gridView:"Grid View",slide:"Slide",slideNumber:"{slideNumber}",zoomImage:"Zoom Image",zoomIn:"Zoom In",zoomOut:"Zoom Out",rotateRight:"Rotate Right",rotateLeft:"Rotate Left",listLabel:"Option List",selectColor:"Select a color",removeLabel:"Remove",browseFiles:"Browse Files",maximizeLabel:"Maximize"}};zIndex={modal:1100,overlay:1e3,menu:1e3,tooltip:1100};translationSource=new nt;translationObserver=this.translationSource.asObservable();getTranslation(t){return this.translation[t]}setTranslation(t){this.translation=Ce(Ce({},this.translation),t),this.translationSource.next(this.translation)}static \u0275fac=function(n){return new(n||i)};static \u0275prov=pt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var ad=(()=>{class i{template;type;name;constructor(t){this.template=t}getType(){return this.name}static \u0275fac=function(n){return new(n||i)(ie(wv))};static \u0275dir=gn({type:i,selectors:[["","pTemplate",""]],inputs:{type:"type",name:[0,"pTemplate","name"]},standalone:!0})}return i})(),pr=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=gt({type:i});static \u0275inj=mt({})}return i})(),mb=(()=>{class i{static STARTS_WITH="startsWith";static CONTAINS="contains";static NOT_CONTAINS="notContains";static ENDS_WITH="endsWith";static EQUALS="equals";static NOT_EQUALS="notEquals";static NO_FILTER="noFilter";static LT="lt";static LTE="lte";static GT="gt";static GTE="gte";static IS="is";static IS_NOT="isNot";static BEFORE="before";static AFTER="after";static CLEAR="clear";static APPLY="apply";static MATCH_ALL="matchAll";static MATCH_ANY="matchAny";static ADD_RULE="addRule";static REMOVE_RULE="removeRule";static ACCEPT="accept";static REJECT="reject";static CHOOSE="choose";static UPLOAD="upload";static CANCEL="cancel";static PENDING="pending";static FILE_SIZE_TYPES="fileSizeTypes";static DAY_NAMES="dayNames";static DAY_NAMES_SHORT="dayNamesShort";static DAY_NAMES_MIN="dayNamesMin";static MONTH_NAMES="monthNames";static MONTH_NAMES_SHORT="monthNamesShort";static FIRST_DAY_OF_WEEK="firstDayOfWeek";static TODAY="today";static WEEK_HEADER="weekHeader";static WEAK="weak";static MEDIUM="medium";static STRONG="strong";static PASSWORD_PROMPT="passwordPrompt";static EMPTY_MESSAGE="emptyMessage";static EMPTY_FILTER_MESSAGE="emptyFilterMessage";static SHOW_FILTER_MENU="showFilterMenu";static HIDE_FILTER_MENU="hideFilterMenu";static SELECTION_MESSAGE="selectionMessage";static ARIA="aria";static SELECT_COLOR="selectColor";static BROWSE_FILES="browseFiles"}return i})();var le=function(i){return i[i.State=0]="State",i[i.Transition=1]="Transition",i[i.Sequence=2]="Sequence",i[i.Group=3]="Group",i[i.Animate=4]="Animate",i[i.Keyframes=5]="Keyframes",i[i.Style=6]="Style",i[i.Trigger=7]="Trigger",i[i.Reference=8]="Reference",i[i.AnimateChild=9]="AnimateChild",i[i.AnimateRef=10]="AnimateRef",i[i.Query=11]="Query",i[i.Stagger=12]="Stagger",i}(le||{}),ci="*";function mr(i,e){return{type:le.Trigger,name:i,definitions:e,options:{}}}function Ni(i,e=null){return{type:le.Animate,styles:e,timings:i}}function gb(i,e=null){return{type:le.Sequence,steps:i,options:e}}function Yt(i){return{type:le.Style,styles:i,offset:null}}function Bo(i,e,t){return{type:le.State,name:i,styles:e,options:t}}function ui(i,e,t=null){return{type:le.Transition,expr:i,animation:e,options:t}}function vy(i,e=null){return{type:le.Reference,animation:i,options:e}}function _b(i=null){return{type:le.AnimateChild,options:i}}function wy(i,e=null){return{type:le.AnimateRef,animation:i,options:e}}function yb(i,e,t=null){return{type:le.Query,selector:i,animation:e,options:t}}var vs=class{constructor(e=0,t=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=e+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){let t=e=="start"?this._onStartFns:this._onDoneFns;t.forEach(n=>n()),t.length=0}},Ol=class{constructor(e){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=e;let t=0,n=0,s=0,r=this.players.length;r==0?queueMicrotask(()=>this._onFinish()):this.players.forEach(o=>{o.onDone(()=>{++t==r&&this._onFinish()}),o.onDestroy(()=>{++n==r&&this._onDestroy()}),o.onStart(()=>{++s==r&&this._onStart()})}),this.totalTime=this.players.reduce((o,a)=>Math.max(o,a.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){let t=e*this.totalTime;this.players.forEach(n=>{let s=n.totalTime?Math.min(1,t/n.totalTime):1;n.setPosition(s)})}getPosition(){let e=this.players.reduce((t,n)=>t===null||n.totalTime>t.totalTime?n:t,null);return e!=null?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){let t=e=="start"?this._onStartFns:this._onDoneFns;t.forEach(n=>n()),t.length=0}},cd="!";var h2=["*"],Bt=(()=>{class i{label;spin=!1;styleClass;role;ariaLabel;ariaHidden;ngOnInit(){this.getAttributes()}getAttributes(){let t=Lo.isEmpty(this.label);this.role=t?void 0:"img",this.ariaLabel=t?void 0:this.label,this.ariaHidden=t}getClassNames(){return`p-icon ${this.styleClass?this.styleClass+" ":""}${this.spin?"p-icon-spin":""}`}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=ye({type:i,selectors:[["ng-component"]],hostAttrs:[1,"p-element","p-icon-wrapper"],inputs:{label:"label",spin:[2,"spin","spin",lt],styleClass:"styleClass"},standalone:!0,features:[Mn,Re],ngContentSelectors:h2,decls:1,vars:0,template:function(n,s){n&1&&(As(),Rs(0))},encapsulation:2,changeDetection:0})}return i})();var Ey=(()=>{class i extends Bt{static \u0275fac=(()=>{let t;return function(s){return(t||(t=kt(i)))(s||i)}})();static \u0275cmp=ye({type:i,selectors:[["CheckIcon"]],standalone:!0,features:[Ot,Re],decls:2,vars:5,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M4.86199 11.5948C4.78717 11.5923 4.71366 11.5745 4.64596 11.5426C4.57826 11.5107 4.51779 11.4652 4.46827 11.4091L0.753985 7.69483C0.683167 7.64891 0.623706 7.58751 0.580092 7.51525C0.536478 7.44299 0.509851 7.36177 0.502221 7.27771C0.49459 7.19366 0.506156 7.10897 0.536046 7.03004C0.565935 6.95111 0.613367 6.88 0.674759 6.82208C0.736151 6.76416 0.8099 6.72095 0.890436 6.69571C0.970973 6.67046 1.05619 6.66385 1.13966 6.67635C1.22313 6.68886 1.30266 6.72017 1.37226 6.76792C1.44186 6.81567 1.4997 6.8786 1.54141 6.95197L4.86199 10.2503L12.6397 2.49483C12.7444 2.42694 12.8689 2.39617 12.9932 2.40745C13.1174 2.41873 13.2343 2.47141 13.3251 2.55705C13.4159 2.64268 13.4753 2.75632 13.4938 2.87973C13.5123 3.00315 13.4888 3.1292 13.4271 3.23768L5.2557 11.4091C5.20618 11.4652 5.14571 11.5107 5.07801 11.5426C5.01031 11.5745 4.9368 11.5923 4.86199 11.5948Z","fill","currentColor"]],template:function(n,s){n&1&&(Nt(),L(0,"svg",0),te(1,"path",1),V()),n&2&&(Ee(s.getClassNames()),se("aria-label",s.ariaLabel)("aria-hidden",s.ariaHidden)("role",s.role))},encapsulation:2})}return i})();var Ty=(()=>{class i extends Bt{pathId;ngOnInit(){this.pathId="url(#"+Rt()+")"}static \u0275fac=(()=>{let t;return function(s){return(t||(t=kt(i)))(s||i)}})();static \u0275cmp=ye({type:i,selectors:[["ExclamationTriangleIcon"]],standalone:!0,features:[Ot,Re],decls:8,vars:7,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M13.4018 13.1893H0.598161C0.49329 13.189 0.390283 13.1615 0.299143 13.1097C0.208003 13.0578 0.131826 12.9832 0.0780112 12.8932C0.0268539 12.8015 0 12.6982 0 12.5931C0 12.4881 0.0268539 12.3848 0.0780112 12.293L6.47985 1.08982C6.53679 1.00399 6.61408 0.933574 6.70484 0.884867C6.7956 0.836159 6.897 0.810669 7 0.810669C7.103 0.810669 7.2044 0.836159 7.29516 0.884867C7.38592 0.933574 7.46321 1.00399 7.52015 1.08982L13.922 12.293C13.9731 12.3848 14 12.4881 14 12.5931C14 12.6982 13.9731 12.8015 13.922 12.8932C13.8682 12.9832 13.792 13.0578 13.7009 13.1097C13.6097 13.1615 13.5067 13.189 13.4018 13.1893ZM1.63046 11.989H12.3695L7 2.59425L1.63046 11.989Z","fill","currentColor"],["d","M6.99996 8.78801C6.84143 8.78594 6.68997 8.72204 6.57787 8.60993C6.46576 8.49782 6.40186 8.34637 6.39979 8.18784V5.38703C6.39979 5.22786 6.46302 5.0752 6.57557 4.96265C6.68813 4.85009 6.84078 4.78686 6.99996 4.78686C7.15914 4.78686 7.31179 4.85009 7.42435 4.96265C7.5369 5.0752 7.60013 5.22786 7.60013 5.38703V8.18784C7.59806 8.34637 7.53416 8.49782 7.42205 8.60993C7.30995 8.72204 7.15849 8.78594 6.99996 8.78801Z","fill","currentColor"],["d","M6.99996 11.1887C6.84143 11.1866 6.68997 11.1227 6.57787 11.0106C6.46576 10.8985 6.40186 10.7471 6.39979 10.5885V10.1884C6.39979 10.0292 6.46302 9.87658 6.57557 9.76403C6.68813 9.65147 6.84078 9.58824 6.99996 9.58824C7.15914 9.58824 7.31179 9.65147 7.42435 9.76403C7.5369 9.87658 7.60013 10.0292 7.60013 10.1884V10.5885C7.59806 10.7471 7.53416 10.8985 7.42205 11.0106C7.30995 11.1227 7.15849 11.1866 6.99996 11.1887Z","fill","currentColor"],[3,"id"],["width","14","height","14","fill","white"]],template:function(n,s){n&1&&(Nt(),L(0,"svg",0)(1,"g"),te(2,"path",1)(3,"path",2)(4,"path",3),V(),L(5,"defs")(6,"clipPath",4),te(7,"rect",5),V()()()),n&2&&(Ee(s.getClassNames()),se("aria-label",s.ariaLabel)("aria-hidden",s.ariaHidden)("role",s.role),k(),se("clip-path",s.pathId),k(5),O("id",s.pathId))},encapsulation:2})}return i})();var Iy=(()=>{class i extends Bt{pathId;ngOnInit(){this.pathId="url(#"+Rt()+")"}static \u0275fac=(()=>{let t;return function(s){return(t||(t=kt(i)))(s||i)}})();static \u0275cmp=ye({type:i,selectors:[["InfoCircleIcon"]],standalone:!0,features:[Ot,Re],decls:6,vars:7,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["fill-rule","evenodd","clip-rule","evenodd","d","M3.11101 12.8203C4.26215 13.5895 5.61553 14 7 14C8.85652 14 10.637 13.2625 11.9497 11.9497C13.2625 10.637 14 8.85652 14 7C14 5.61553 13.5895 4.26215 12.8203 3.11101C12.0511 1.95987 10.9579 1.06266 9.67879 0.532846C8.3997 0.00303296 6.99224 -0.13559 5.63437 0.134506C4.2765 0.404603 3.02922 1.07129 2.05026 2.05026C1.07129 3.02922 0.404603 4.2765 0.134506 5.63437C-0.13559 6.99224 0.00303296 8.3997 0.532846 9.67879C1.06266 10.9579 1.95987 12.0511 3.11101 12.8203ZM3.75918 2.14976C4.71846 1.50879 5.84628 1.16667 7 1.16667C8.5471 1.16667 10.0308 1.78125 11.1248 2.87521C12.2188 3.96918 12.8333 5.45291 12.8333 7C12.8333 8.15373 12.4912 9.28154 11.8502 10.2408C11.2093 11.2001 10.2982 11.9478 9.23232 12.3893C8.16642 12.8308 6.99353 12.9463 5.86198 12.7212C4.73042 12.4962 3.69102 11.9406 2.87521 11.1248C2.05941 10.309 1.50384 9.26958 1.27876 8.13803C1.05367 7.00647 1.16919 5.83358 1.61071 4.76768C2.05222 3.70178 2.79989 2.79074 3.75918 2.14976ZM7.00002 4.8611C6.84594 4.85908 6.69873 4.79698 6.58977 4.68801C6.48081 4.57905 6.4187 4.43185 6.41669 4.27776V3.88888C6.41669 3.73417 6.47815 3.58579 6.58754 3.4764C6.69694 3.367 6.84531 3.30554 7.00002 3.30554C7.15473 3.30554 7.3031 3.367 7.4125 3.4764C7.52189 3.58579 7.58335 3.73417 7.58335 3.88888V4.27776C7.58134 4.43185 7.51923 4.57905 7.41027 4.68801C7.30131 4.79698 7.1541 4.85908 7.00002 4.8611ZM7.00002 10.6945C6.84594 10.6925 6.69873 10.6304 6.58977 10.5214C6.48081 10.4124 6.4187 10.2652 6.41669 10.1111V6.22225C6.41669 6.06754 6.47815 5.91917 6.58754 5.80977C6.69694 5.70037 6.84531 5.63892 7.00002 5.63892C7.15473 5.63892 7.3031 5.70037 7.4125 5.80977C7.52189 5.91917 7.58335 6.06754 7.58335 6.22225V10.1111C7.58134 10.2652 7.51923 10.4124 7.41027 10.5214C7.30131 10.6304 7.1541 10.6925 7.00002 10.6945Z","fill","currentColor"],[3,"id"],["width","14","height","14","fill","white"]],template:function(n,s){n&1&&(Nt(),L(0,"svg",0)(1,"g"),te(2,"path",1),V(),L(3,"defs")(4,"clipPath",2),te(5,"rect",3),V()()()),n&2&&(Ee(s.getClassNames()),se("aria-label",s.ariaLabel)("aria-hidden",s.ariaHidden)("role",s.role),k(),se("clip-path",s.pathId),k(3),O("id",s.pathId))},encapsulation:2})}return i})();var Uo=(()=>{class i extends Bt{static \u0275fac=(()=>{let t;return function(s){return(t||(t=kt(i)))(s||i)}})();static \u0275cmp=ye({type:i,selectors:[["TimesIcon"]],standalone:!0,features:[Ot,Re],decls:2,vars:5,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M8.01186 7.00933L12.27 2.75116C12.341 2.68501 12.398 2.60524 12.4375 2.51661C12.4769 2.42798 12.4982 2.3323 12.4999 2.23529C12.5016 2.13827 12.4838 2.0419 12.4474 1.95194C12.4111 1.86197 12.357 1.78024 12.2884 1.71163C12.2198 1.64302 12.138 1.58893 12.0481 1.55259C11.9581 1.51625 11.8617 1.4984 11.7647 1.50011C11.6677 1.50182 11.572 1.52306 11.4834 1.56255C11.3948 1.60204 11.315 1.65898 11.2488 1.72997L6.99067 5.98814L2.7325 1.72997C2.59553 1.60234 2.41437 1.53286 2.22718 1.53616C2.03999 1.53946 1.8614 1.61529 1.72901 1.74767C1.59663 1.88006 1.5208 2.05865 1.5175 2.24584C1.5142 2.43303 1.58368 2.61419 1.71131 2.75116L5.96948 7.00933L1.71131 11.2675C1.576 11.403 1.5 11.5866 1.5 11.7781C1.5 11.9696 1.576 12.1532 1.71131 12.2887C1.84679 12.424 2.03043 12.5 2.2219 12.5C2.41338 12.5 2.59702 12.424 2.7325 12.2887L6.99067 8.03052L11.2488 12.2887C11.3843 12.424 11.568 12.5 11.7594 12.5C11.9509 12.5 12.1346 12.424 12.27 12.2887C12.4053 12.1532 12.4813 11.9696 12.4813 11.7781C12.4813 11.5866 12.4053 11.403 12.27 11.2675L8.01186 7.00933Z","fill","currentColor"]],template:function(n,s){n&1&&(Nt(),L(0,"svg",0),te(1,"path",1),V()),n&2&&(Ee(s.getClassNames()),se("aria-label",s.ariaLabel)("aria-hidden",s.ariaHidden)("role",s.role))},encapsulation:2})}return i})();var Cy=(()=>{class i extends Bt{pathId;ngOnInit(){this.pathId="url(#"+Rt()+")"}static \u0275fac=(()=>{let t;return function(s){return(t||(t=kt(i)))(s||i)}})();static \u0275cmp=ye({type:i,selectors:[["TimesCircleIcon"]],standalone:!0,features:[Ot,Re],decls:6,vars:7,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["fill-rule","evenodd","clip-rule","evenodd","d","M7 14C5.61553 14 4.26215 13.5895 3.11101 12.8203C1.95987 12.0511 1.06266 10.9579 0.532846 9.67879C0.00303296 8.3997 -0.13559 6.99224 0.134506 5.63437C0.404603 4.2765 1.07129 3.02922 2.05026 2.05026C3.02922 1.07129 4.2765 0.404603 5.63437 0.134506C6.99224 -0.13559 8.3997 0.00303296 9.67879 0.532846C10.9579 1.06266 12.0511 1.95987 12.8203 3.11101C13.5895 4.26215 14 5.61553 14 7C14 8.85652 13.2625 10.637 11.9497 11.9497C10.637 13.2625 8.85652 14 7 14ZM7 1.16667C5.84628 1.16667 4.71846 1.50879 3.75918 2.14976C2.79989 2.79074 2.05222 3.70178 1.61071 4.76768C1.16919 5.83358 1.05367 7.00647 1.27876 8.13803C1.50384 9.26958 2.05941 10.309 2.87521 11.1248C3.69102 11.9406 4.73042 12.4962 5.86198 12.7212C6.99353 12.9463 8.16642 12.8308 9.23232 12.3893C10.2982 11.9478 11.2093 11.2001 11.8502 10.2408C12.4912 9.28154 12.8333 8.15373 12.8333 7C12.8333 5.45291 12.2188 3.96918 11.1248 2.87521C10.0308 1.78125 8.5471 1.16667 7 1.16667ZM4.66662 9.91668C4.58998 9.91704 4.51404 9.90209 4.44325 9.87271C4.37246 9.84333 4.30826 9.8001 4.2544 9.74557C4.14516 9.6362 4.0838 9.48793 4.0838 9.33335C4.0838 9.17876 4.14516 9.0305 4.2544 8.92113L6.17553 7L4.25443 5.07891C4.15139 4.96832 4.09529 4.82207 4.09796 4.67094C4.10063 4.51982 4.16185 4.37563 4.26872 4.26876C4.3756 4.16188 4.51979 4.10066 4.67091 4.09799C4.82204 4.09532 4.96829 4.15142 5.07887 4.25446L6.99997 6.17556L8.92106 4.25446C9.03164 4.15142 9.1779 4.09532 9.32903 4.09799C9.48015 4.10066 9.62434 4.16188 9.73121 4.26876C9.83809 4.37563 9.89931 4.51982 9.90198 4.67094C9.90464 4.82207 9.84855 4.96832 9.74551 5.07891L7.82441 7L9.74554 8.92113C9.85478 9.0305 9.91614 9.17876 9.91614 9.33335C9.91614 9.48793 9.85478 9.6362 9.74554 9.74557C9.69168 9.8001 9.62748 9.84333 9.55669 9.87271C9.4859 9.90209 9.40996 9.91704 9.33332 9.91668C9.25668 9.91704 9.18073 9.90209 9.10995 9.87271C9.03916 9.84333 8.97495 9.8001 8.9211 9.74557L6.99997 7.82444L5.07884 9.74557C5.02499 9.8001 4.96078 9.84333 4.88999 9.87271C4.81921 9.90209 4.74326 9.91704 4.66662 9.91668Z","fill","currentColor"],[3,"id"],["width","14","height","14","fill","white"]],template:function(n,s){n&1&&(Nt(),L(0,"svg",0)(1,"g"),te(2,"path",1),V(),L(3,"defs")(4,"clipPath",2),te(5,"rect",3),V()()()),n&2&&(Ee(s.getClassNames()),se("aria-label",s.ariaLabel)("aria-hidden",s.ariaHidden)("role",s.role),k(),se("clip-path",s.pathId),k(3),O("id",s.pathId))},encapsulation:2})}return i})();var oe=(()=>{class i{static zindex=1e3;static calculatedScrollbarWidth=null;static calculatedScrollbarHeight=null;static browser;static addClass(t,n){t&&n&&(t.classList?t.classList.add(n):t.className+=" "+n)}static addMultipleClasses(t,n){if(t&&n)if(t.classList){let s=n.trim().split(" ");for(let r=0;r<s.length;r++)t.classList.add(s[r])}else{let s=n.split(" ");for(let r=0;r<s.length;r++)t.className+=" "+s[r]}}static removeClass(t,n){t&&n&&(t.classList?t.classList.remove(n):t.className=t.className.replace(new RegExp("(^|\\b)"+n.split(" ").join("|")+"(\\b|$)","gi")," "))}static removeMultipleClasses(t,n){t&&n&&[n].flat().filter(Boolean).forEach(s=>s.split(" ").forEach(r=>this.removeClass(t,r)))}static hasClass(t,n){return t&&n?t.classList?t.classList.contains(n):new RegExp("(^| )"+n+"( |$)","gi").test(t.className):!1}static siblings(t){return Array.prototype.filter.call(t.parentNode.children,function(n){return n!==t})}static find(t,n){return Array.from(t.querySelectorAll(n))}static findSingle(t,n){return this.isElement(t)?t.querySelector(n):null}static index(t){let n=t.parentNode.childNodes,s=0;for(var r=0;r<n.length;r++){if(n[r]==t)return s;n[r].nodeType==1&&s++}return-1}static indexWithinGroup(t,n){let s=t.parentNode?t.parentNode.childNodes:[],r=0;for(var o=0;o<s.length;o++){if(s[o]==t)return r;s[o].attributes&&s[o].attributes[n]&&s[o].nodeType==1&&r++}return-1}static appendOverlay(t,n,s="self"){s!=="self"&&t&&n&&this.appendChild(t,n)}static alignOverlay(t,n,s="self",r=!0){t&&n&&(r&&(t.style.minWidth=`${i.getOuterWidth(n)}px`),s==="self"?this.relativePosition(t,n):this.absolutePosition(t,n))}static relativePosition(t,n,s=!0){let r=q=>{if(q)return getComputedStyle(q).getPropertyValue("position")==="relative"?q:r(q.parentElement)},o=t.offsetParent?{width:t.offsetWidth,height:t.offsetHeight}:this.getHiddenElementDimensions(t),a=n.offsetHeight??n.getBoundingClientRect().height,c=n.getBoundingClientRect(),u=this.getWindowScrollTop(),d=this.getWindowScrollLeft(),f=this.getViewport(),_=r(t)?.getBoundingClientRect()||{top:-1*u,left:-1*d},v,C;c.top+a+o.height>f.height?(v=c.top-_.top-o.height,t.style.transformOrigin="bottom",c.top+v<0&&(v=-1*c.top)):(v=a+c.top-_.top,t.style.transformOrigin="top");let R=c.left+o.width-f.width,U=c.left-_.left;o.width>f.width?C=(c.left-_.left)*-1:R>0?C=U-R:C=c.left-_.left,t.style.top=v+"px",t.style.left=C+"px",s&&(t.style.marginTop=origin==="bottom"?"calc(var(--p-anchor-gutter) * -1)":"calc(var(--p-anchor-gutter))")}static absolutePosition(t,n,s=!0){let r=t.offsetParent?{width:t.offsetWidth,height:t.offsetHeight}:this.getHiddenElementDimensions(t),o=r.height,a=r.width,c=n.offsetHeight??n.getBoundingClientRect().height,u=n.offsetWidth??n.getBoundingClientRect().width,d=n.getBoundingClientRect(),f=this.getWindowScrollTop(),m=this.getWindowScrollLeft(),_=this.getViewport(),v,C;d.top+c+o>_.height?(v=d.top+f-o,t.style.transformOrigin="bottom",v<0&&(v=f)):(v=c+d.top+f,t.style.transformOrigin="top"),d.left+a>_.width?C=Math.max(0,d.left+m+u-a):C=d.left+m,t.style.top=v+"px",t.style.left=C+"px",s&&(t.style.marginTop=origin==="bottom"?"calc(var(--p-anchor-gutter) * -1)":"calc(var(--p-anchor-gutter))")}static getParents(t,n=[]){return t.parentNode===null?n:this.getParents(t.parentNode,n.concat([t.parentNode]))}static getScrollableParents(t){let n=[];if(t){let s=this.getParents(t),r=/(auto|scroll)/,o=a=>{let c=window.getComputedStyle(a,null);return r.test(c.getPropertyValue("overflow"))||r.test(c.getPropertyValue("overflowX"))||r.test(c.getPropertyValue("overflowY"))};for(let a of s){let c=a.nodeType===1&&a.dataset.scrollselectors;if(c){let u=c.split(",");for(let d of u){let f=this.findSingle(a,d);f&&o(f)&&n.push(f)}}a.nodeType!==9&&o(a)&&n.push(a)}}return n}static getHiddenElementOuterHeight(t){t.style.visibility="hidden",t.style.display="block";let n=t.offsetHeight;return t.style.display="none",t.style.visibility="visible",n}static getHiddenElementOuterWidth(t){t.style.visibility="hidden",t.style.display="block";let n=t.offsetWidth;return t.style.display="none",t.style.visibility="visible",n}static getHiddenElementDimensions(t){let n={};return t.style.visibility="hidden",t.style.display="block",n.width=t.offsetWidth,n.height=t.offsetHeight,t.style.display="none",t.style.visibility="visible",n}static scrollInView(t,n){let s=getComputedStyle(t).getPropertyValue("borderTopWidth"),r=s?parseFloat(s):0,o=getComputedStyle(t).getPropertyValue("paddingTop"),a=o?parseFloat(o):0,c=t.getBoundingClientRect(),d=n.getBoundingClientRect().top+document.body.scrollTop-(c.top+document.body.scrollTop)-r-a,f=t.scrollTop,m=t.clientHeight,_=this.getOuterHeight(n);d<0?t.scrollTop=f+d:d+_>m&&(t.scrollTop=f+d-m+_)}static fadeIn(t,n){t.style.opacity=0;let s=+new Date,r=0,o=function(){r=+t.style.opacity.replace(",",".")+(new Date().getTime()-s)/n,t.style.opacity=r,s=+new Date,+r<1&&(window.requestAnimationFrame&&requestAnimationFrame(o)||setTimeout(o,16))};o()}static fadeOut(t,n){var s=1,r=50,o=n,a=r/o;let c=setInterval(()=>{s=s-a,s<=0&&(s=0,clearInterval(c)),t.style.opacity=s},r)}static getWindowScrollTop(){let t=document.documentElement;return(window.pageYOffset||t.scrollTop)-(t.clientTop||0)}static getWindowScrollLeft(){let t=document.documentElement;return(window.pageXOffset||t.scrollLeft)-(t.clientLeft||0)}static matches(t,n){var s=Element.prototype,r=s.matches||s.webkitMatchesSelector||s.mozMatchesSelector||s.msMatchesSelector||function(o){return[].indexOf.call(document.querySelectorAll(o),this)!==-1};return r.call(t,n)}static getOuterWidth(t,n){let s=t.offsetWidth;if(n){let r=getComputedStyle(t);s+=parseFloat(r.marginLeft)+parseFloat(r.marginRight)}return s}static getHorizontalPadding(t){let n=getComputedStyle(t);return parseFloat(n.paddingLeft)+parseFloat(n.paddingRight)}static getHorizontalMargin(t){let n=getComputedStyle(t);return parseFloat(n.marginLeft)+parseFloat(n.marginRight)}static innerWidth(t){let n=t.offsetWidth,s=getComputedStyle(t);return n+=parseFloat(s.paddingLeft)+parseFloat(s.paddingRight),n}static width(t){let n=t.offsetWidth,s=getComputedStyle(t);return n-=parseFloat(s.paddingLeft)+parseFloat(s.paddingRight),n}static getInnerHeight(t){let n=t.offsetHeight,s=getComputedStyle(t);return n+=parseFloat(s.paddingTop)+parseFloat(s.paddingBottom),n}static getOuterHeight(t,n){let s=t.offsetHeight;if(n){let r=getComputedStyle(t);s+=parseFloat(r.marginTop)+parseFloat(r.marginBottom)}return s}static getHeight(t){let n=t.offsetHeight,s=getComputedStyle(t);return n-=parseFloat(s.paddingTop)+parseFloat(s.paddingBottom)+parseFloat(s.borderTopWidth)+parseFloat(s.borderBottomWidth),n}static getWidth(t){let n=t.offsetWidth,s=getComputedStyle(t);return n-=parseFloat(s.paddingLeft)+parseFloat(s.paddingRight)+parseFloat(s.borderLeftWidth)+parseFloat(s.borderRightWidth),n}static getViewport(){let t=window,n=document,s=n.documentElement,r=n.getElementsByTagName("body")[0],o=t.innerWidth||s.clientWidth||r.clientWidth,a=t.innerHeight||s.clientHeight||r.clientHeight;return{width:o,height:a}}static getOffset(t){var n=t.getBoundingClientRect();return{top:n.top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0),left:n.left+(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0)}}static replaceElementWith(t,n){let s=t.parentNode;if(!s)throw"Can't replace element";return s.replaceChild(n,t)}static getUserAgent(){if(navigator&&this.isClient())return navigator.userAgent}static isIE(){var t=window.navigator.userAgent,n=t.indexOf("MSIE ");if(n>0)return!0;var s=t.indexOf("Trident/");if(s>0){var r=t.indexOf("rv:");return!0}var o=t.indexOf("Edge/");return o>0}static isIOS(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}static isAndroid(){return/(android)/i.test(navigator.userAgent)}static isTouchDevice(){return"ontouchstart"in window||navigator.maxTouchPoints>0}static appendChild(t,n){if(this.isElement(n))n.appendChild(t);else if(n&&n.el&&n.el.nativeElement)n.el.nativeElement.appendChild(t);else throw"Cannot append "+n+" to "+t}static removeChild(t,n){if(this.isElement(n))n.removeChild(t);else if(n.el&&n.el.nativeElement)n.el.nativeElement.removeChild(t);else throw"Cannot remove "+t+" from "+n}static removeElement(t){"remove"in Element.prototype?t.remove():t.parentNode.removeChild(t)}static isElement(t){return typeof HTMLElement=="object"?t instanceof HTMLElement:t&&typeof t=="object"&&t!==null&&t.nodeType===1&&typeof t.nodeName=="string"}static calculateScrollbarWidth(t){if(t){let n=getComputedStyle(t);return t.offsetWidth-t.clientWidth-parseFloat(n.borderLeftWidth)-parseFloat(n.borderRightWidth)}else{if(this.calculatedScrollbarWidth!==null)return this.calculatedScrollbarWidth;let n=document.createElement("div");n.className="p-scrollbar-measure",document.body.appendChild(n);let s=n.offsetWidth-n.clientWidth;return document.body.removeChild(n),this.calculatedScrollbarWidth=s,s}}static calculateScrollbarHeight(){if(this.calculatedScrollbarHeight!==null)return this.calculatedScrollbarHeight;let t=document.createElement("div");t.className="p-scrollbar-measure",document.body.appendChild(t);let n=t.offsetHeight-t.clientHeight;return document.body.removeChild(t),this.calculatedScrollbarWidth=n,n}static invokeElementMethod(t,n,s){t[n].apply(t,s)}static clearSelection(){if(window.getSelection)window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().rangeCount>0&&window.getSelection().getRangeAt(0).getClientRects().length>0&&window.getSelection().removeAllRanges();else if(document.selection&&document.selection.empty)try{document.selection.empty()}catch{}}static getBrowser(){if(!this.browser){let t=this.resolveUserAgent();this.browser={},t.browser&&(this.browser[t.browser]=!0,this.browser.version=t.version),this.browser.chrome?this.browser.webkit=!0:this.browser.webkit&&(this.browser.safari=!0)}return this.browser}static resolveUserAgent(){let t=navigator.userAgent.toLowerCase(),n=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return{browser:n[1]||"",version:n[2]||"0"}}static isInteger(t){return Number.isInteger?Number.isInteger(t):typeof t=="number"&&isFinite(t)&&Math.floor(t)===t}static isHidden(t){return!t||t.offsetParent===null}static isVisible(t){return t&&t.offsetParent!=null}static isExist(t){return t!==null&&typeof t<"u"&&t.nodeName&&t.parentNode}static focus(t,n){t&&document.activeElement!==t&&t.focus(n)}static getFocusableSelectorString(t=""){return`button:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${t},
        [href][clientHeight][clientWidth]:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${t},
        input:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${t},
        select:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${t},
        textarea:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${t},
        [tabIndex]:not([tabIndex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${t},
        [contenteditable]:not([tabIndex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${t},
        .p-inputtext:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${t},
        .p-button:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${t}`}static getFocusableElements(t,n=""){let s=this.find(t,this.getFocusableSelectorString(n)),r=[];for(let o of s){let a=getComputedStyle(o);this.isVisible(o)&&a.display!="none"&&a.visibility!="hidden"&&r.push(o)}return r}static getFocusableElement(t,n=""){let s=this.findSingle(t,this.getFocusableSelectorString(n));if(s){let r=getComputedStyle(s);if(this.isVisible(s)&&r.display!="none"&&r.visibility!="hidden")return s}return null}static getFirstFocusableElement(t,n=""){let s=this.getFocusableElements(t,n);return s.length>0?s[0]:null}static getLastFocusableElement(t,n){let s=this.getFocusableElements(t,n);return s.length>0?s[s.length-1]:null}static getNextFocusableElement(t,n=!1){let s=i.getFocusableElements(t),r=0;if(s&&s.length>0){let o=s.indexOf(s[0].ownerDocument.activeElement);n?o==-1||o===0?r=s.length-1:r=o-1:o!=-1&&o!==s.length-1&&(r=o+1)}return s[r]}static generateZIndex(){return this.zindex=this.zindex||999,++this.zindex}static getSelection(){return window.getSelection?window.getSelection().toString():document.getSelection?document.getSelection().toString():document.selection?document.selection.createRange().text:null}static getTargetElement(t,n){if(!t)return null;switch(t){case"document":return document;case"window":return window;case"@next":return n?.nextElementSibling;case"@prev":return n?.previousElementSibling;case"@parent":return n?.parentElement;case"@grandparent":return n?.parentElement.parentElement;default:let s=typeof t;if(s==="string")return document.querySelector(t);if(s==="object"&&t.hasOwnProperty("nativeElement"))return this.isExist(t.nativeElement)?t.nativeElement:void 0;let o=(a=>!!(a&&a.constructor&&a.call&&a.apply))(t)?t():t;return o&&o.nodeType===9||this.isExist(o)?o:null}}static isClient(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}static getAttribute(t,n){if(t){let s=t.getAttribute(n);return isNaN(s)?s==="true"||s==="false"?s==="true":s:+s}}static calculateBodyScrollbarWidth(){return window.innerWidth-document.documentElement.offsetWidth}static blockBodyScroll(t="p-overflow-hidden"){document.body.style.setProperty("--scrollbar-width",this.calculateBodyScrollbarWidth()+"px"),this.addClass(document.body,t)}static unblockBodyScroll(t="p-overflow-hidden"){document.body.style.removeProperty("--scrollbar-width"),this.removeClass(document.body,t)}static createElement(t,n={},...s){if(t){let r=document.createElement(t);return this.setAttributes(r,n),r.append(...s),r}}static setAttribute(t,n="",s){this.isElement(t)&&s!==null&&s!==void 0&&t.setAttribute(n,s)}static setAttributes(t,n={}){if(this.isElement(t)){let s=(r,o)=>{let a=t?.$attrs?.[r]?[t?.$attrs?.[r]]:[];return[o].flat().reduce((c,u)=>{if(u!=null){let d=typeof u;if(d==="string"||d==="number")c.push(u);else if(d==="object"){let f=Array.isArray(u)?s(r,u):Object.entries(u).map(([m,_])=>r==="style"&&(_||_===0)?`${m.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}:${_}`:_?m:void 0);c=f.length?c.concat(f.filter(m=>!!m)):c}}return c},a)};Object.entries(n).forEach(([r,o])=>{if(o!=null){let a=r.match(/^on(.+)/);a?t.addEventListener(a[1].toLowerCase(),o):r==="pBind"?this.setAttributes(t,o):(o=r==="class"?[...new Set(s("class",o))].join(" ").trim():r==="style"?s("style",o).join(";").trim():o,(t.$attrs=t.$attrs||{})&&(t.$attrs[r]=o),t.setAttribute(r,o))}})}}static isFocusableElement(t,n=""){return this.isElement(t)?t.matches(`button:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${n},
                [href][clientHeight][clientWidth]:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${n},
                input:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${n},
                select:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${n},
                textarea:not([tabindex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${n},
                [tabIndex]:not([tabIndex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${n},
                [contenteditable]:not([tabIndex = "-1"]):not([disabled]):not([style*="display:none"]):not([hidden])${n}`):!1}}return i})();var ud=(()=>{class i{document;platformId;renderer;el;zone;config;constructor(t,n,s,r,o,a){this.document=t,this.platformId=n,this.renderer=s,this.el=r,this.zone=o,this.config=a}animationListener;mouseDownListener;timeout;ngAfterViewInit(){Cn(this.platformId)&&this.config&&this.config.ripple&&this.zone.runOutsideAngular(()=>{this.create(),this.mouseDownListener=this.renderer.listen(this.el.nativeElement,"mousedown",this.onMouseDown.bind(this))})}onMouseDown(t){let n=this.getInk();if(!n||this.document.defaultView?.getComputedStyle(n,null).display==="none")return;if(oe.removeClass(n,"p-ink-active"),!oe.getHeight(n)&&!oe.getWidth(n)){let a=Math.max(oe.getOuterWidth(this.el.nativeElement),oe.getOuterHeight(this.el.nativeElement));n.style.height=a+"px",n.style.width=a+"px"}let s=oe.getOffset(this.el.nativeElement),r=t.pageX-s.left+this.document.body.scrollTop-oe.getWidth(n)/2,o=t.pageY-s.top+this.document.body.scrollLeft-oe.getHeight(n)/2;this.renderer.setStyle(n,"top",o+"px"),this.renderer.setStyle(n,"left",r+"px"),oe.addClass(n,"p-ink-active"),this.timeout=setTimeout(()=>{let a=this.getInk();a&&oe.removeClass(a,"p-ink-active")},401)}getInk(){let t=this.el.nativeElement.children;for(let n=0;n<t.length;n++)if(typeof t[n].className=="string"&&t[n].className.indexOf("p-ink")!==-1)return t[n];return null}resetInk(){let t=this.getInk();t&&oe.removeClass(t,"p-ink-active")}onAnimationEnd(t){this.timeout&&clearTimeout(this.timeout),oe.removeClass(t.currentTarget,"p-ink-active")}create(){let t=this.renderer.createElement("span");this.renderer.addClass(t,"p-ink"),this.renderer.appendChild(this.el.nativeElement,t),this.renderer.setAttribute(t,"aria-hidden","true"),this.renderer.setAttribute(t,"role","presentation"),this.animationListener||(this.animationListener=this.renderer.listen(t,"animationend",this.onAnimationEnd.bind(this)))}remove(){let t=this.getInk();t&&(this.mouseDownListener&&this.mouseDownListener(),this.animationListener&&this.animationListener(),this.mouseDownListener=null,this.animationListener=null,oe.removeElement(t))}ngOnDestroy(){this.config&&this.config.ripple&&this.remove()}static \u0275fac=function(n){return new(n||i)(ie(bt),ie(_n),ie(Sr),ie(_i),ie(zt),ie(fr,8))};static \u0275dir=gn({type:i,selectors:[["","pRipple",""]],hostAttrs:[1,"p-ripple","p-element"],standalone:!0})}return i})(),vb=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=gt({type:i});static \u0275inj=mt({})}return i})();var wb=["container"],f2=i=>[i,"p-toast-message"],p2=(i,e,t,n)=>({showTransformParams:i,hideTransformParams:e,showTransitionParams:t,hideTransitionParams:n}),m2=i=>({value:"visible",params:i}),g2=(i,e)=>({$implicit:i,closeFn:e}),_2=i=>({$implicit:i});function y2(i,e){i&1&&yn(0)}function v2(i,e){if(i&1&&(Jt(0),de(1,y2,1,0,"ng-container",4),Zt()),i&2){let t=Q();k(),O("ngTemplateOutlet",t.headlessTemplate)("ngTemplateOutletContext",dc(2,g2,t.message,t.onCloseIconClick))}}function w2(i,e){if(i&1&&te(0,"span"),i&2){let t=Q(3);Ee("p-toast-message-icon pi "+t.message.icon)}}function E2(i,e){i&1&&te(0,"CheckIcon"),i&2&&se("aria-hidden",!0)("data-pc-section","icon")}function T2(i,e){i&1&&te(0,"InfoCircleIcon"),i&2&&se("aria-hidden",!0)("data-pc-section","icon")}function I2(i,e){i&1&&te(0,"TimesCircleIcon"),i&2&&se("aria-hidden",!0)("data-pc-section","icon")}function C2(i,e){i&1&&te(0,"ExclamationTriangleIcon"),i&2&&se("aria-hidden",!0)("data-pc-section","icon")}function b2(i,e){if(i&1&&(L(0,"span",13),Jt(1),de(2,E2,1,2,"CheckIcon",6)(3,T2,1,2,"InfoCircleIcon",6)(4,I2,1,2,"TimesCircleIcon",6)(5,C2,1,2,"ExclamationTriangleIcon",6),Zt(),V()),i&2){let t=Q(3);se("aria-hidden",!0)("data-pc-section","icon"),k(2),O("ngIf",t.message.severity==="success"),k(),O("ngIf",t.message.severity==="info"),k(),O("ngIf",t.message.severity==="error"),k(),O("ngIf",t.message.severity==="warn")}}function S2(i,e){if(i&1&&(Jt(0),de(1,w2,1,2,"span",8)(2,b2,6,6,"span",9),L(3,"div",10)(4,"div",11),ae(5),V(),L(6,"div",12),ae(7),V()(),Zt()),i&2){let t=Q(2);k(),O("ngIf",t.message.icon),k(),O("ngIf",!t.message.icon),k(),se("data-pc-section","text"),k(),se("data-pc-section","summary"),k(),En(t.message.summary),k(),se("data-pc-section","detail"),k(),En(t.message.detail)}}function A2(i,e){i&1&&yn(0)}function R2(i,e){if(i&1&&te(0,"span"),i&2){let t=Q(3);Ee("pt-1 text-base p-toast-message-icon pi "+t.message.closeIcon)}}function x2(i,e){i&1&&te(0,"TimesIcon",16),i&2&&(O("styleClass","p-toast-icon-close-icon"),se("aria-hidden",!0)("data-pc-section","closeicon"))}function P2(i,e){if(i&1){let t=Ct();L(0,"button",14),De("click",function(s){ze(t);let r=Q(2);return je(r.onCloseIconClick(s))})("keydown.enter",function(s){ze(t);let r=Q(2);return je(r.onCloseIconClick(s))}),de(1,R2,1,2,"span",8)(2,x2,1,3,"TimesIcon",15),V()}if(i&2){let t=Q(2);se("aria-label",t.closeAriaLabel)("data-pc-section","closebutton"),k(),O("ngIf",t.message.closeIcon),k(),O("ngIf",!t.message.closeIcon)}}function D2(i,e){if(i&1&&(L(0,"div",5),de(1,S2,8,7,"ng-container",6)(2,A2,1,0,"ng-container",4)(3,P2,3,4,"button",7),V()),i&2){let t=Q();O("ngClass",t.message==null?null:t.message.contentStyleClass),se("data-pc-section","content"),k(),O("ngIf",!t.template),k(),O("ngTemplateOutlet",t.template)("ngTemplateOutletContext",Fn(6,_2,t.message)),k(),O("ngIf",(t.message==null?null:t.message.closable)!==!1)}}function N2(i,e){if(i&1){let t=Ct();L(0,"p-toastItem",3),De("onClose",function(s){ze(t);let r=Q();return je(r.onMessageClose(s))})("@toastAnimation.start",function(s){ze(t);let r=Q();return je(r.onAnimationStart(s))})("@toastAnimation.done",function(s){ze(t);let r=Q();return je(r.onAnimationEnd(s))}),V()}if(i&2){let t=e.$implicit,n=e.index,s=Q();O("message",t)("index",n)("life",s.life)("template",s.template)("headlessTemplate",s.headlessTemplate)("@toastAnimation",void 0)("showTransformOptions",s.showTransformOptions)("hideTransformOptions",s.hideTransformOptions)("showTransitionOptions",s.showTransitionOptions)("hideTransitionOptions",s.hideTransitionOptions)}}var k2=(()=>{class i{zone;config;message;index;life;template;headlessTemplate;showTransformOptions;hideTransformOptions;showTransitionOptions;hideTransitionOptions;onClose=new gi;containerViewChild;timeout;constructor(t,n){this.zone=t,this.config=n}ngAfterViewInit(){this.initTimeout()}initTimeout(){this.message?.sticky||this.zone.runOutsideAngular(()=>{this.timeout=setTimeout(()=>{this.onClose.emit({index:this.index,message:this.message})},this.message?.life||this.life||3e3)})}clearTimeout(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null)}onMouseEnter(){this.clearTimeout()}onMouseLeave(){this.initTimeout()}onCloseIconClick=t=>{this.clearTimeout(),this.onClose.emit({index:this.index,message:this.message}),t.preventDefault()};get closeAriaLabel(){return this.config.translation.aria?this.config.translation.aria.close:void 0}ngOnDestroy(){this.clearTimeout()}static \u0275fac=function(n){return new(n||i)(ie(zt),ie(fr))};static \u0275cmp=ye({type:i,selectors:[["p-toastItem"]],viewQuery:function(n,s){if(n&1&&yi(wb,5),n&2){let r;vn(r=wn())&&(s.containerViewChild=r.first)}},hostAttrs:[1,"p-element"],inputs:{message:"message",index:[2,"index","index",Ps],life:[2,"life","life",Ps],template:"template",headlessTemplate:"headlessTemplate",showTransformOptions:"showTransformOptions",hideTransformOptions:"hideTransformOptions",showTransitionOptions:"showTransitionOptions",hideTransitionOptions:"hideTransitionOptions"},outputs:{onClose:"onClose"},features:[Mn],decls:5,vars:18,consts:[["container",""],["notHeadless",""],["role","alert","aria-live","assertive","aria-atomic","true",3,"mouseenter","mouseleave","ngClass"],[4,"ngIf","ngIfElse"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"p-toast-message-content",3,"ngClass"],[4,"ngIf"],["type","button","class","p-toast-icon-close p-link","pRipple","",3,"click","keydown.enter",4,"ngIf"],[3,"class",4,"ngIf"],["class","p-toast-message-icon",4,"ngIf"],[1,"p-toast-message-text"],[1,"p-toast-summary"],[1,"p-toast-detail"],[1,"p-toast-message-icon"],["type","button","pRipple","",1,"p-toast-icon-close","p-link",3,"click","keydown.enter"],[3,"styleClass",4,"ngIf"],[3,"styleClass"]],template:function(n,s){if(n&1){let r=Ct();L(0,"div",2,0),De("mouseenter",function(){return ze(r),je(s.onMouseEnter())})("mouseleave",function(){return ze(r),je(s.onMouseLeave())}),de(2,v2,2,5,"ng-container",3)(3,D2,4,8,"ng-template",null,1,xv),V()}if(n&2){let r=Av(4);Ee(s.message==null?null:s.message.styleClass),O("ngClass",Fn(9,f2,"p-toast-message-"+(s.message==null?null:s.message.severity)))("@messageState",Fn(16,m2,fc(11,p2,s.showTransformOptions,s.hideTransformOptions,s.showTransitionOptions,s.hideTransitionOptions))),se("id",s.message==null?null:s.message.id)("data-pc-name","toast")("data-pc-section","root"),k(2),O("ngIf",s.headlessTemplate)("ngIfElse",r)}},dependencies:()=>[Ds,rn,gc,ud,Ey,Iy,Cy,Ty,Uo],encapsulation:2,data:{animation:[mr("messageState",[Bo("visible",Yt({transform:"translateY(0)",opacity:1})),ui("void => *",[Yt({transform:"{{showTransformParams}}",opacity:0}),Ni("{{showTransitionParams}}")]),ui("* => void",[Ni("{{hideTransitionParams}}",Yt({height:0,opacity:0,transform:"{{hideTransformParams}}"}))])])]},changeDetection:0})}return i})(),Eb=(()=>{class i{document;renderer;messageService;cd;config;key;autoZIndex=!0;baseZIndex=0;life=3e3;style;styleClass;get position(){return this._position}set position(t){this._position=t,this.cd.markForCheck()}preventOpenDuplicates=!1;preventDuplicates=!1;showTransformOptions="translateY(100%)";hideTransformOptions="translateY(-100%)";showTransitionOptions="300ms ease-out";hideTransitionOptions="250ms ease-in";breakpoints;onClose=new gi;containerViewChild;templates;messageSubscription;clearSubscription;messages;messagesArchieve;template;headlessTemplate;_position="top-right";constructor(t,n,s,r,o){this.document=t,this.renderer=n,this.messageService=s,this.cd=r,this.config=o}styleElement;id=Rt();ngOnInit(){this.messageSubscription=this.messageService.messageObserver.subscribe(t=>{if(t)if(Array.isArray(t)){let n=t.filter(s=>this.canAdd(s));this.add(n)}else this.canAdd(t)&&this.add([t])}),this.clearSubscription=this.messageService.clearObserver.subscribe(t=>{t?this.key===t&&(this.messages=null):this.messages=null,this.cd.markForCheck()})}ngAfterViewInit(){this.breakpoints&&this.createStyle()}add(t){this.messages=this.messages?[...this.messages,...t]:[...t],this.preventDuplicates&&(this.messagesArchieve=this.messagesArchieve?[...this.messagesArchieve,...t]:[...t]),this.cd.markForCheck()}canAdd(t){let n=this.key===t.key;return n&&this.preventOpenDuplicates&&(n=!this.containsMessage(this.messages,t)),n&&this.preventDuplicates&&(n=!this.containsMessage(this.messagesArchieve,t)),n}containsMessage(t,n){return t?t.find(s=>s.summary===n.summary&&s.detail==n.detail&&s.severity===n.severity)!=null:!1}ngAfterContentInit(){this.templates?.forEach(t=>{switch(t.getType()){case"message":this.template=t.template;break;case"headless":this.headlessTemplate=t.template;break;default:this.template=t.template;break}})}onMessageClose(t){this.messages?.splice(t.index,1),this.onClose.emit({message:t.message}),this.cd.detectChanges()}onAnimationStart(t){t.fromState==="void"&&(this.renderer.setAttribute(this.containerViewChild?.nativeElement,this.id,""),this.autoZIndex&&this.containerViewChild?.nativeElement.style.zIndex===""&&ys.set("modal",this.containerViewChild?.nativeElement,this.baseZIndex||this.config.zIndex.modal))}onAnimationEnd(t){t.toState==="void"&&this.autoZIndex&&Lo.isEmpty(this.messages)&&ys.clear(this.containerViewChild?.nativeElement)}createStyle(){if(!this.styleElement){this.styleElement=this.renderer.createElement("style"),this.styleElement.type="text/css",oe.setAttribute(this.styleElement,"nonce",this.config?.csp()?.nonce),this.renderer.appendChild(this.document.head,this.styleElement);let t="";for(let n in this.breakpoints){let s="";for(let r in this.breakpoints[n])s+=r+":"+this.breakpoints[n][r]+" !important;";t+=`
                    @media screen and (max-width: ${n}) {
                        .p-toast[${this.id}] {
                           ${s}
                        }
                    }
                `}this.renderer.setProperty(this.styleElement,"innerHTML",t)}}destroyStyle(){this.styleElement&&(this.renderer.removeChild(this.document.head,this.styleElement),this.styleElement=null)}ngOnDestroy(){this.messageSubscription&&this.messageSubscription.unsubscribe(),this.containerViewChild&&this.autoZIndex&&ys.clear(this.containerViewChild.nativeElement),this.clearSubscription&&this.clearSubscription.unsubscribe(),this.destroyStyle()}static \u0275fac=function(n){return new(n||i)(ie(bt),ie(Sr),ie(Vo),ie(pc),ie(fr))};static \u0275cmp=ye({type:i,selectors:[["p-toast"]],contentQueries:function(n,s,r){if(n&1&&cc(r,ad,4),n&2){let o;vn(o=wn())&&(s.templates=o)}},viewQuery:function(n,s){if(n&1&&yi(wb,5),n&2){let r;vn(r=wn())&&(s.containerViewChild=r.first)}},hostAttrs:[1,"p-element"],inputs:{key:"key",autoZIndex:[2,"autoZIndex","autoZIndex",lt],baseZIndex:[2,"baseZIndex","baseZIndex",Ps],life:[2,"life","life",Ps],style:"style",styleClass:"styleClass",position:"position",preventOpenDuplicates:[2,"preventOpenDuplicates","preventOpenDuplicates",lt],preventDuplicates:[2,"preventDuplicates","preventDuplicates",lt],showTransformOptions:"showTransformOptions",hideTransformOptions:"hideTransformOptions",showTransitionOptions:"showTransitionOptions",hideTransitionOptions:"hideTransitionOptions",breakpoints:"breakpoints"},outputs:{onClose:"onClose"},features:[Mn],decls:3,vars:5,consts:[["container",""],[1,"p-toast","p-component",3,"ngClass","ngStyle"],[3,"message","index","life","template","headlessTemplate","showTransformOptions","hideTransformOptions","showTransitionOptions","hideTransitionOptions","onClose",4,"ngFor","ngForOf"],[3,"onClose","message","index","life","template","headlessTemplate","showTransformOptions","hideTransformOptions","showTransitionOptions","hideTransitionOptions"]],template:function(n,s){n&1&&(L(0,"div",1,0),de(2,N2,1,10,"p-toastItem",2),V()),n&2&&(Ee(s.styleClass),O("ngClass","p-toast-"+s._position)("ngStyle",s.style),k(2),O("ngForOf",s.messages))},dependencies:[Ds,mc,Rr,k2],styles:[`@layer primeng{.p-toast{position:fixed;width:25rem}.p-toast-message{overflow:hidden}.p-toast-message-content{display:flex;align-items:flex-start}.p-toast-message-text{flex:1 1 auto}.p-toast-top-right{top:20px;right:20px}.p-toast-top-left{top:20px;left:20px}.p-toast-bottom-left{bottom:20px;left:20px}.p-toast-bottom-right{bottom:20px;right:20px}.p-toast-top-center{top:20px;left:50%;transform:translate(-50%)}.p-toast-bottom-center{bottom:20px;left:50%;transform:translate(-50%)}.p-toast-center{left:50%;top:50%;min-width:20vw;transform:translate(-50%,-50%)}.p-toast-icon-close{display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative;flex:none}.p-toast-icon-close.p-link{cursor:pointer}}
`],encapsulation:2,data:{animation:[mr("toastAnimation",[ui(":enter, :leave",[yb("@*",_b())])])]},changeDetection:0})}return i})(),hd=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=gt({type:i});static \u0275inj=mt({imports:[In,vb,Ey,Iy,Cy,Ty,Uo,pr]})}return i})();var Tb=(()=>{class i{autofocus=!1;focused=!1;platformId=Ke(_n);document=Ke(bt);host=Ke(_i);ngAfterContentChecked(){this.autofocus===!1?this.host.nativeElement.removeAttribute("autofocus"):this.host.nativeElement.setAttribute("autofocus",!0),this.focused||this.autoFocus()}ngAfterViewChecked(){this.focused||this.autoFocus()}autoFocus(){Cn(this.platformId)&&this.autofocus&&setTimeout(()=>{let t=oe.getFocusableElements(this.host?.nativeElement);t.length===0&&this.host.nativeElement.focus(),t.length>0&&t[0].focus(),this.focused=!0})}static \u0275fac=function(n){return new(n||i)};static \u0275dir=gn({type:i,selectors:[["","pAutoFocus",""]],hostAttrs:[1,"p-element"],inputs:{autofocus:[2,"autofocus","autofocus",lt]},standalone:!0,features:[Mn]})}return i})();var Ib=(()=>{class i extends Bt{pathId;ngOnInit(){this.pathId="url(#"+Rt()+")"}static \u0275fac=(()=>{let t;return function(s){return(t||(t=kt(i)))(s||i)}})();static \u0275cmp=ye({type:i,selectors:[["SpinnerIcon"]],standalone:!0,features:[Ot,Re],decls:6,vars:7,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M6.99701 14C5.85441 13.999 4.72939 13.7186 3.72012 13.1832C2.71084 12.6478 1.84795 11.8737 1.20673 10.9284C0.565504 9.98305 0.165424 8.89526 0.041387 7.75989C-0.0826496 6.62453 0.073125 5.47607 0.495122 4.4147C0.917119 3.35333 1.59252 2.4113 2.46241 1.67077C3.33229 0.930247 4.37024 0.413729 5.4857 0.166275C6.60117 -0.0811796 7.76026 -0.0520535 8.86188 0.251112C9.9635 0.554278 10.9742 1.12227 11.8057 1.90555C11.915 2.01493 11.9764 2.16319 11.9764 2.31778C11.9764 2.47236 11.915 2.62062 11.8057 2.73C11.7521 2.78503 11.688 2.82877 11.6171 2.85864C11.5463 2.8885 11.4702 2.90389 11.3933 2.90389C11.3165 2.90389 11.2404 2.8885 11.1695 2.85864C11.0987 2.82877 11.0346 2.78503 10.9809 2.73C9.9998 1.81273 8.73246 1.26138 7.39226 1.16876C6.05206 1.07615 4.72086 1.44794 3.62279 2.22152C2.52471 2.99511 1.72683 4.12325 1.36345 5.41602C1.00008 6.70879 1.09342 8.08723 1.62775 9.31926C2.16209 10.5513 3.10478 11.5617 4.29713 12.1803C5.48947 12.7989 6.85865 12.988 8.17414 12.7157C9.48963 12.4435 10.6711 11.7264 11.5196 10.6854C12.3681 9.64432 12.8319 8.34282 12.8328 7C12.8328 6.84529 12.8943 6.69692 13.0038 6.58752C13.1132 6.47812 13.2616 6.41667 13.4164 6.41667C13.5712 6.41667 13.7196 6.47812 13.8291 6.58752C13.9385 6.69692 14 6.84529 14 7C14 8.85651 13.2622 10.637 11.9489 11.9497C10.6356 13.2625 8.85432 14 6.99701 14Z","fill","currentColor"],[3,"id"],["width","14","height","14","fill","white"]],template:function(n,s){n&1&&(Nt(),L(0,"svg",0)(1,"g"),te(2,"path",1),V(),L(3,"defs")(4,"clipPath",2),te(5,"rect",3),V()()()),n&2&&(Ee(s.getClassNames()),se("aria-label",s.ariaLabel)("aria-hidden",s.ariaHidden)("role",s.role),k(),se("clip-path",s.pathId),k(3),O("id",s.pathId))},encapsulation:2})}return i})();var M2=["*"],Cb=i=>({class:i});function F2(i,e){i&1&&yn(0)}function L2(i,e){if(i&1&&te(0,"span",8),i&2){let t=Q(3);O("ngClass",t.iconClass()),se("aria-hidden",!0)("data-pc-section","loadingicon")}}function V2(i,e){if(i&1&&te(0,"SpinnerIcon",9),i&2){let t=Q(3);O("styleClass",t.spinnerIconClass())("spin",!0),se("aria-hidden",!0)("data-pc-section","loadingicon")}}function B2(i,e){if(i&1&&(Jt(0),de(1,L2,1,3,"span",6)(2,V2,1,4,"SpinnerIcon",7),Zt()),i&2){let t=Q(2);k(),O("ngIf",t.loadingIcon),k(),O("ngIf",!t.loadingIcon)}}function U2(i,e){}function q2(i,e){if(i&1&&de(0,U2,0,0,"ng-template",10),i&2){let t=Q(2);O("ngIf",t.loadingIconTemplate)}}function z2(i,e){if(i&1&&(Jt(0),de(1,B2,3,2,"ng-container",2)(2,q2,1,1,null,5),Zt()),i&2){let t=Q();k(),O("ngIf",!t.loadingIconTemplate),k(),O("ngTemplateOutlet",t.loadingIconTemplate)("ngTemplateOutletContext",Fn(3,Cb,t.iconClass()))}}function j2(i,e){if(i&1&&te(0,"span",8),i&2){let t=Q(2);O("ngClass",t.iconClass()),se("data-pc-section","icon")}}function G2(i,e){}function W2(i,e){if(i&1&&de(0,G2,0,0,"ng-template",10),i&2){let t=Q(2);O("ngIf",!t.icon&&t.iconTemplate)}}function H2(i,e){if(i&1&&(Jt(0),de(1,j2,1,2,"span",6)(2,W2,1,1,null,5),Zt()),i&2){let t=Q();k(),O("ngIf",t.icon&&!t.iconTemplate),k(),O("ngTemplateOutlet",t.iconTemplate)("ngTemplateOutletContext",Fn(3,Cb,t.iconClass()))}}function K2(i,e){if(i&1&&(L(0,"span",11),ae(1),V()),i&2){let t=Q();se("aria-hidden",t.icon&&!t.label)("data-pc-section","label"),k(),En(t.label)}}function Q2(i,e){if(i&1&&(L(0,"span",8),ae(1),V()),i&2){let t=Q();Ee(t.badgeClass),O("ngClass",t.badgeStyleClass()),se("data-pc-section","badge"),k(),En(t.badge)}}var Sy=(()=>{class i{el;type="button";iconPos="left";icon;badge;label;disabled;loading=!1;loadingIcon;raised=!1;rounded=!1;text=!1;plain=!1;severity;outlined=!1;link=!1;tabindex;size;style;styleClass;badgeClass;ariaLabel;autofocus;onClick=new gi;onFocus=new gi;onBlur=new gi;contentTemplate;loadingIconTemplate;iconTemplate;templates;constructor(t){this.el=t}spinnerIconClass(){return Object.entries(this.iconClass()).filter(([,t])=>!!t).reduce((t,[n])=>t+` ${n}`,"p-button-loading-icon")}iconClass(){let t={"p-button-icon":!0,"p-button-icon-left":this.iconPos==="left"&&this.label,"p-button-icon-right":this.iconPos==="right"&&this.label,"p-button-icon-top":this.iconPos==="top"&&this.label,"p-button-icon-bottom":this.iconPos==="bottom"&&this.label};return this.loading?t[`p-button-loading-icon pi-spin ${this.loadingIcon??""}`]=!0:this.icon&&(t[this.icon]=!0),t}get buttonClass(){return{"p-button p-component":!0,"p-button-icon-only":(this.icon||this.iconTemplate||this.loadingIcon||this.loadingIconTemplate)&&!this.label,"p-button-vertical":(this.iconPos==="top"||this.iconPos==="bottom")&&this.label,"p-button-loading":this.loading,"p-button-loading-label-only":this.loading&&!this.icon&&this.label&&!this.loadingIcon&&this.iconPos==="left","p-button-link":this.link,[`p-button-${this.severity}`]:this.severity,"p-button-raised":this.raised,"p-button-rounded":this.rounded,"p-button-text":this.text,"p-button-outlined":this.outlined,"p-button-sm":this.size==="small","p-button-lg":this.size==="large","p-button-plain":this.plain,[`${this.styleClass}`]:this.styleClass}}ngAfterContentInit(){this.templates?.forEach(t=>{switch(t.getType()){case"content":this.contentTemplate=t.template;break;case"icon":this.iconTemplate=t.template;break;case"loadingicon":this.loadingIconTemplate=t.template;break;default:this.contentTemplate=t.template;break}})}badgeStyleClass(){return{"p-badge p-component":!0,"p-badge-no-gutter":this.badge&&String(this.badge).length===1}}focus(){this.el.nativeElement.firstChild.focus()}static \u0275fac=function(n){return new(n||i)(ie(_i))};static \u0275cmp=ye({type:i,selectors:[["p-button"]],contentQueries:function(n,s,r){if(n&1&&cc(r,ad,4),n&2){let o;vn(o=wn())&&(s.templates=o)}},hostAttrs:[1,"p-element"],hostVars:2,hostBindings:function(n,s){n&2&&bv("p-disabled",s.disabled)},inputs:{type:"type",iconPos:"iconPos",icon:"icon",badge:"badge",label:"label",disabled:[2,"disabled","disabled",lt],loading:[2,"loading","loading",lt],loadingIcon:"loadingIcon",raised:[2,"raised","raised",lt],rounded:[2,"rounded","rounded",lt],text:[2,"text","text",lt],plain:[2,"plain","plain",lt],severity:"severity",outlined:[2,"outlined","outlined",lt],link:[2,"link","link",lt],tabindex:[2,"tabindex","tabindex",Ps],size:"size",style:"style",styleClass:"styleClass",badgeClass:"badgeClass",ariaLabel:"ariaLabel",autofocus:[2,"autofocus","autofocus",lt]},outputs:{onClick:"onClick",onFocus:"onFocus",onBlur:"onBlur"},standalone:!0,features:[Mn,Re],ngContentSelectors:M2,decls:7,vars:14,consts:[["pRipple","","pAutoFocus","",3,"click","focus","blur","ngStyle","disabled","ngClass","autofocus"],[4,"ngTemplateOutlet"],[4,"ngIf"],["class","p-button-label",4,"ngIf"],[3,"ngClass","class",4,"ngIf"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"ngClass",4,"ngIf"],[3,"styleClass","spin",4,"ngIf"],[3,"ngClass"],[3,"styleClass","spin"],[3,"ngIf"],[1,"p-button-label"]],template:function(n,s){n&1&&(As(),L(0,"button",0),De("click",function(o){return s.onClick.emit(o)})("focus",function(o){return s.onFocus.emit(o)})("blur",function(o){return s.onBlur.emit(o)}),Rs(1),de(2,F2,1,0,"ng-container",1)(3,z2,3,5,"ng-container",2)(4,H2,3,5,"ng-container",2)(5,K2,2,3,"span",3)(6,Q2,2,5,"span",4),V()),n&2&&(O("ngStyle",s.style)("disabled",s.disabled||s.loading)("ngClass",s.buttonClass)("autofocus",s.autofocus),se("type",s.type)("aria-label",s.ariaLabel)("data-pc-name","button")("data-pc-section","root")("tabindex",s.tabindex),k(2),O("ngTemplateOutlet",s.contentTemplate),k(),O("ngIf",s.loading),k(),O("ngIf",!s.loading),k(),O("ngIf",!s.contentTemplate&&s.label),k(),O("ngIf",!s.contentTemplate&&s.badge))},dependencies:[rn,gc,Rr,Ds,ud,Tb,Ib],encapsulation:2,changeDetection:0})}return i})(),bb=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=gt({type:i});static \u0275inj=mt({imports:[Sy,pr]})}return i})();var Sb=["toast-component",""];function Y2(i,e){if(i&1){let t=Ct();L(0,"button",5),De("click",function(){ze(t);let s=Q();return je(s.remove())}),L(1,"span",6),ae(2,"\xD7"),V()()}}function X2(i,e){if(i&1&&(Jt(0),ae(1),Zt()),i&2){let t=Q(2);k(),Tn("[",t.duplicatesCount+1,"]")}}function J2(i,e){if(i&1&&(L(0,"div"),ae(1),de(2,X2,2,1,"ng-container",4),V()),i&2){let t=Q();Ee(t.options.titleClass),se("aria-label",t.title),k(),Tn(" ",t.title," "),k(),O("ngIf",t.duplicatesCount)}}function Z2(i,e){if(i&1&&te(0,"div",7),i&2){let t=Q();Ee(t.options.messageClass),O("innerHTML",t.message,la)}}function eN(i,e){if(i&1&&(L(0,"div",8),ae(1),V()),i&2){let t=Q();Ee(t.options.messageClass),se("aria-label",t.message),k(),Tn(" ",t.message," ")}}function tN(i,e){if(i&1&&(L(0,"div"),te(1,"div",9),V()),i&2){let t=Q();k(),ca("width",t.width()+"%")}}function nN(i,e){if(i&1){let t=Ct();L(0,"button",5),De("click",function(){ze(t);let s=Q();return je(s.remove())}),L(1,"span",6),ae(2,"\xD7"),V()()}}function iN(i,e){if(i&1&&(Jt(0),ae(1),Zt()),i&2){let t=Q(2);k(),Tn("[",t.duplicatesCount+1,"]")}}function sN(i,e){if(i&1&&(L(0,"div"),ae(1),de(2,iN,2,1,"ng-container",4),V()),i&2){let t=Q();Ee(t.options.titleClass),se("aria-label",t.title),k(),Tn(" ",t.title," "),k(),O("ngIf",t.duplicatesCount)}}function rN(i,e){if(i&1&&te(0,"div",7),i&2){let t=Q();Ee(t.options.messageClass),O("innerHTML",t.message,la)}}function oN(i,e){if(i&1&&(L(0,"div",8),ae(1),V()),i&2){let t=Q();Ee(t.options.messageClass),se("aria-label",t.message),k(),Tn(" ",t.message," ")}}function aN(i,e){if(i&1&&(L(0,"div"),te(1,"div",9),V()),i&2){let t=Q();k(),ca("width",t.width()+"%")}}var Ay=class{_attachedHost;component;viewContainerRef;injector;constructor(e,t){this.component=e,this.injector=t}attach(e,t){return this._attachedHost=e,e.attach(this,t)}detach(){let e=this._attachedHost;if(e)return this._attachedHost=void 0,e.detach()}get isAttached(){return this._attachedHost!=null}setAttachedHost(e){this._attachedHost=e}},Ry=class{_attachedPortal;_disposeFn;attach(e,t){return this._attachedPortal=e,this.attachComponentPortal(e,t)}detach(){this._attachedPortal&&this._attachedPortal.setAttachedHost(),this._attachedPortal=void 0,this._disposeFn&&(this._disposeFn(),this._disposeFn=void 0)}setDisposeFn(e){this._disposeFn=e}},xy=class{_overlayRef;componentInstance;duplicatesCount=0;_afterClosed=new nt;_activate=new nt;_manualClose=new nt;_resetTimeout=new nt;_countDuplicate=new nt;constructor(e){this._overlayRef=e}manualClose(){this._manualClose.next(),this._manualClose.complete()}manualClosed(){return this._manualClose.asObservable()}timeoutReset(){return this._resetTimeout.asObservable()}countDuplicate(){return this._countDuplicate.asObservable()}close(){this._overlayRef.detach(),this._afterClosed.next(),this._manualClose.next(),this._afterClosed.complete(),this._manualClose.complete(),this._activate.complete(),this._resetTimeout.complete(),this._countDuplicate.complete()}afterClosed(){return this._afterClosed.asObservable()}isInactive(){return this._activate.isStopped}activate(){this._activate.next(),this._activate.complete()}afterActivate(){return this._activate.asObservable()}onDuplicate(e,t){e&&this._resetTimeout.next(),t&&this._countDuplicate.next(++this.duplicatesCount)}},qo=class{toastId;config;message;title;toastType;toastRef;_onTap=new nt;_onAction=new nt;constructor(e,t,n,s,r,o){this.toastId=e,this.config=t,this.message=n,this.title=s,this.toastType=r,this.toastRef=o,this.toastRef.afterClosed().subscribe(()=>{this._onAction.complete(),this._onTap.complete()})}triggerTap(){this._onTap.next(),this.config.tapToDismiss&&this._onTap.complete()}onTap(){return this._onTap.asObservable()}triggerAction(e){this._onAction.next(e)}onAction(){return this._onAction.asObservable()}},Ab={maxOpened:0,autoDismiss:!1,newestOnTop:!0,preventDuplicates:!1,countDuplicates:!1,resetTimeoutOnDuplicate:!1,includeTitleDuplicates:!1,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},closeButton:!1,disableTimeOut:!1,timeOut:5e3,extendedTimeOut:1e3,enableHtml:!1,progressBar:!1,toastClass:"ngx-toastr",positionClass:"toast-top-right",titleClass:"toast-title",messageClass:"toast-message",easing:"ease-in",easeTime:300,tapToDismiss:!0,onActivateTick:!1,progressAnimation:"decreasing"},Rb=new Wn("ToastConfig"),Py=class extends Ry{_hostDomElement;_componentFactoryResolver;_appRef;constructor(e,t,n){super(),this._hostDomElement=e,this._componentFactoryResolver=t,this._appRef=n}attachComponentPortal(e,t){let n=this._componentFactoryResolver.resolveComponentFactory(e.component),s;return s=n.create(e.injector),this._appRef.attachView(s.hostView),this.setDisposeFn(()=>{this._appRef.detachView(s.hostView),s.destroy()}),t?this._hostDomElement.insertBefore(this._getComponentRootNode(s),this._hostDomElement.firstChild):this._hostDomElement.appendChild(this._getComponentRootNode(s)),s}_getComponentRootNode(e){return e.hostView.rootNodes[0]}},lN=(()=>{class i{_document=Ke(bt);_containerElement;ngOnDestroy(){this._containerElement&&this._containerElement.parentNode&&this._containerElement.parentNode.removeChild(this._containerElement)}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){let t=this._document.createElement("div");t.classList.add("overlay-container"),t.setAttribute("aria-live","polite"),this._document.body.appendChild(t),this._containerElement=t}static \u0275fac=function(n){return new(n||i)};static \u0275prov=pt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),Dy=class{_portalHost;constructor(e){this._portalHost=e}attach(e,t=!0){return this._portalHost.attach(e,t)}detach(){return this._portalHost.detach()}},cN=(()=>{class i{_overlayContainer=Ke(lN);_componentFactoryResolver=Ke(Ev);_appRef=Ke(Ar);_document=Ke(bt);_paneElements=new Map;create(t,n){return this._createOverlayRef(this.getPaneElement(t,n))}getPaneElement(t="",n){return this._paneElements.get(n)||this._paneElements.set(n,{}),this._paneElements.get(n)[t]||(this._paneElements.get(n)[t]=this._createPaneElement(t,n)),this._paneElements.get(n)[t]}_createPaneElement(t,n){let s=this._document.createElement("div");return s.id="toast-container",s.classList.add(t),s.classList.add("toast-container"),n?n.getContainerElement().appendChild(s):this._overlayContainer.getContainerElement().appendChild(s),s}_createPortalHost(t){return new Py(t,this._componentFactoryResolver,this._appRef)}_createOverlayRef(t){return new Dy(this._createPortalHost(t))}static \u0275fac=function(n){return new(n||i)};static \u0275prov=pt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),zo=(()=>{class i{overlay;_injector;sanitizer;ngZone;toastrConfig;currentlyActive=0;toasts=[];overlayContainer;previousToastMessage;index=0;constructor(t,n,s,r,o){this.overlay=n,this._injector=s,this.sanitizer=r,this.ngZone=o,this.toastrConfig=Ce(Ce({},t.default),t.config),t.config.iconClasses&&(this.toastrConfig.iconClasses=Ce(Ce({},t.default.iconClasses),t.config.iconClasses))}show(t,n,s={},r=""){return this._preBuildNotification(r,t,n,this.applyConfig(s))}success(t,n,s={}){let r=this.toastrConfig.iconClasses.success||"";return this._preBuildNotification(r,t,n,this.applyConfig(s))}error(t,n,s={}){let r=this.toastrConfig.iconClasses.error||"";return this._preBuildNotification(r,t,n,this.applyConfig(s))}info(t,n,s={}){let r=this.toastrConfig.iconClasses.info||"";return this._preBuildNotification(r,t,n,this.applyConfig(s))}warning(t,n,s={}){let r=this.toastrConfig.iconClasses.warning||"";return this._preBuildNotification(r,t,n,this.applyConfig(s))}clear(t){for(let n of this.toasts)if(t!==void 0){if(n.toastId===t){n.toastRef.manualClose();return}}else n.toastRef.manualClose()}remove(t){let n=this._findToast(t);if(!n||(n.activeToast.toastRef.close(),this.toasts.splice(n.index,1),this.currentlyActive=this.currentlyActive-1,!this.toastrConfig.maxOpened||!this.toasts.length))return!1;if(this.currentlyActive<this.toastrConfig.maxOpened&&this.toasts[this.currentlyActive]){let s=this.toasts[this.currentlyActive].toastRef;s.isInactive()||(this.currentlyActive=this.currentlyActive+1,s.activate())}return!0}findDuplicate(t="",n="",s,r){let{includeTitleDuplicates:o}=this.toastrConfig;for(let a of this.toasts){let c=o&&a.title===t;if((!o||c)&&a.message===n)return a.toastRef.onDuplicate(s,r),a}return null}applyConfig(t={}){return Ce(Ce({},this.toastrConfig),t)}_findToast(t){for(let n=0;n<this.toasts.length;n++)if(this.toasts[n].toastId===t)return{index:n,activeToast:this.toasts[n]};return null}_preBuildNotification(t,n,s,r){return r.onActivateTick?this.ngZone.run(()=>this._buildNotification(t,n,s,r)):this._buildNotification(t,n,s,r)}_buildNotification(t,n,s,r){if(!r.toastComponent)throw new Error("toastComponent required");let o=this.findDuplicate(s,n,this.toastrConfig.resetTimeoutOnDuplicate&&r.timeOut>0,this.toastrConfig.countDuplicates);if((this.toastrConfig.includeTitleDuplicates&&s||n)&&this.toastrConfig.preventDuplicates&&o!==null)return o;this.previousToastMessage=n;let a=!1;this.toastrConfig.maxOpened&&this.currentlyActive>=this.toastrConfig.maxOpened&&(a=!0,this.toastrConfig.autoDismiss&&this.clear(this.toasts[0].toastId));let c=this.overlay.create(r.positionClass,this.overlayContainer);this.index=this.index+1;let u=n;n&&r.enableHtml&&(u=this.sanitizer.sanitize(vv.HTML,n));let d=new xy(c),f=new qo(this.index,r,u,s,t,d),m=[{provide:qo,useValue:f}],_=br.create({providers:m,parent:this._injector}),v=new Ay(r.toastComponent,_),C=c.attach(v,r.newestOnTop);d.componentInstance=C.instance;let R={toastId:this.index,title:s||"",message:n||"",toastRef:d,onShown:d.afterActivate(),onHidden:d.afterClosed(),onTap:f.onTap(),onAction:f.onAction(),portal:C};return a||(this.currentlyActive=this.currentlyActive+1,setTimeout(()=>{R.toastRef.activate()})),this.toasts.push(R),R}static \u0275fac=function(n){return new(n||i)(ne(Rb),ne(cN),ne(br),ne(yc),ne(zt))};static \u0275prov=pt({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),uN=(()=>{class i{toastrService;toastPackage;ngZone;message;title;options;duplicatesCount;originalTimeout;width=Ui(-1);toastClasses="";state;get _state(){return this.state()}get displayStyle(){if(this.state().value==="inactive")return"none"}timeout;intervalId;hideTime;sub;sub1;sub2;sub3;constructor(t,n,s){this.toastrService=t,this.toastPackage=n,this.ngZone=s,this.message=n.message,this.title=n.title,this.options=n.config,this.originalTimeout=n.config.timeOut,this.toastClasses=`${n.toastType} ${n.config.toastClass}`,this.sub=n.toastRef.afterActivate().subscribe(()=>{this.activateToast()}),this.sub1=n.toastRef.manualClosed().subscribe(()=>{this.remove()}),this.sub2=n.toastRef.timeoutReset().subscribe(()=>{this.resetTimeout()}),this.sub3=n.toastRef.countDuplicate().subscribe(r=>{this.duplicatesCount=r}),this.state=Ui({value:"inactive",params:{easeTime:this.toastPackage.config.easeTime,easing:"ease-in"}})}ngOnDestroy(){this.sub.unsubscribe(),this.sub1.unsubscribe(),this.sub2.unsubscribe(),this.sub3.unsubscribe(),clearInterval(this.intervalId),clearTimeout(this.timeout)}activateToast(){this.state.update(t=>sn(Ce({},t),{value:"active"})),!(this.options.disableTimeOut===!0||this.options.disableTimeOut==="timeOut")&&this.options.timeOut&&(this.outsideTimeout(()=>this.remove(),this.options.timeOut),this.hideTime=new Date().getTime()+this.options.timeOut,this.options.progressBar&&this.outsideInterval(()=>this.updateProgress(),10))}updateProgress(){if(this.width()===0||this.width()===100||!this.options.timeOut)return;let t=new Date().getTime(),n=this.hideTime-t;this.width.set(n/this.options.timeOut*100),this.options.progressAnimation==="increasing"&&this.width.update(s=>100-s),this.width()<=0&&this.width.set(0),this.width()>=100&&this.width.set(100)}resetTimeout(){clearTimeout(this.timeout),clearInterval(this.intervalId),this.state.update(t=>sn(Ce({},t),{value:"active"})),this.outsideTimeout(()=>this.remove(),this.originalTimeout),this.options.timeOut=this.originalTimeout,this.hideTime=new Date().getTime()+(this.options.timeOut||0),this.width.set(-1),this.options.progressBar&&this.outsideInterval(()=>this.updateProgress(),10)}remove(){this.state().value!=="removed"&&(clearTimeout(this.timeout),this.state.update(t=>sn(Ce({},t),{value:"removed"})),this.outsideTimeout(()=>this.toastrService.remove(this.toastPackage.toastId),+this.toastPackage.config.easeTime))}tapToast(){this.state().value!=="removed"&&(this.toastPackage.triggerTap(),this.options.tapToDismiss&&this.remove())}stickAround(){this.state().value!=="removed"&&this.options.disableTimeOut!=="extendedTimeOut"&&(clearTimeout(this.timeout),this.options.timeOut=0,this.hideTime=0,clearInterval(this.intervalId),this.width.set(0))}delayedHideToast(){this.options.disableTimeOut===!0||this.options.disableTimeOut==="extendedTimeOut"||this.options.extendedTimeOut===0||this.state().value==="removed"||(this.outsideTimeout(()=>this.remove(),this.options.extendedTimeOut),this.options.timeOut=this.options.extendedTimeOut,this.hideTime=new Date().getTime()+(this.options.timeOut||0),this.width.set(-1),this.options.progressBar&&this.outsideInterval(()=>this.updateProgress(),10))}outsideTimeout(t,n){this.ngZone?this.ngZone.runOutsideAngular(()=>this.timeout=setTimeout(()=>this.runInsideAngular(t),n)):this.timeout=setTimeout(()=>t(),n)}outsideInterval(t,n){this.ngZone?this.ngZone.runOutsideAngular(()=>this.intervalId=setInterval(()=>this.runInsideAngular(t),n)):this.intervalId=setInterval(()=>t(),n)}runInsideAngular(t){this.ngZone?this.ngZone.run(()=>t()):t()}static \u0275fac=function(n){return new(n||i)(ie(zo),ie(qo),ie(zt))};static \u0275cmp=ye({type:i,selectors:[["","toast-component",""]],hostVars:5,hostBindings:function(n,s){n&1&&De("click",function(){return s.tapToast()})("mouseenter",function(){return s.stickAround()})("mouseleave",function(){return s.delayedHideToast()}),n&2&&(Sv("@flyInOut",s._state),Ee(s.toastClasses),ca("display",s.displayStyle))},standalone:!0,features:[Re],attrs:Sb,decls:5,vars:5,consts:[["type","button","class","toast-close-button","aria-label","Close",3,"click",4,"ngIf"],[3,"class",4,"ngIf"],["role","alert",3,"class","innerHTML",4,"ngIf"],["role","alert",3,"class",4,"ngIf"],[4,"ngIf"],["type","button","aria-label","Close",1,"toast-close-button",3,"click"],["aria-hidden","true"],["role","alert",3,"innerHTML"],["role","alert"],[1,"toast-progress"]],template:function(n,s){n&1&&de(0,Y2,3,0,"button",0)(1,J2,3,5,"div",1)(2,Z2,1,3,"div",2)(3,eN,2,4,"div",3)(4,tN,2,2,"div",4),n&2&&(O("ngIf",s.options.closeButton),k(),O("ngIf",s.title),k(),O("ngIf",s.message&&s.options.enableHtml),k(),O("ngIf",s.message&&!s.options.enableHtml),k(),O("ngIf",s.options.progressBar))},dependencies:[rn],encapsulation:2,data:{animation:[mr("flyInOut",[Bo("inactive",Yt({opacity:0})),Bo("active",Yt({opacity:1})),Bo("removed",Yt({opacity:0})),ui("inactive => active",Ni("{{ easeTime }}ms {{ easing }}")),ui("active => removed",Ni("{{ easeTime }}ms {{ easing }}"))])]},changeDetection:0})}return i})(),hN=sn(Ce({},Ab),{toastComponent:uN}),xb=(i={})=>gv([{provide:Rb,useValue:{default:hN,config:i}}]);var dN=(()=>{class i{toastrService;toastPackage;appRef;message;title;options;duplicatesCount;originalTimeout;width=Ui(-1);toastClasses="";get displayStyle(){return this.state()==="inactive"?"none":null}state=Ui("inactive");timeout;intervalId;hideTime;sub;sub1;sub2;sub3;constructor(t,n,s){this.toastrService=t,this.toastPackage=n,this.appRef=s,this.message=n.message,this.title=n.title,this.options=n.config,this.originalTimeout=n.config.timeOut,this.toastClasses=`${n.toastType} ${n.config.toastClass}`,this.sub=n.toastRef.afterActivate().subscribe(()=>{this.activateToast()}),this.sub1=n.toastRef.manualClosed().subscribe(()=>{this.remove()}),this.sub2=n.toastRef.timeoutReset().subscribe(()=>{this.resetTimeout()}),this.sub3=n.toastRef.countDuplicate().subscribe(r=>{this.duplicatesCount=r})}ngOnDestroy(){this.sub.unsubscribe(),this.sub1.unsubscribe(),this.sub2.unsubscribe(),this.sub3.unsubscribe(),clearInterval(this.intervalId),clearTimeout(this.timeout)}activateToast(){this.state.set("active"),!(this.options.disableTimeOut===!0||this.options.disableTimeOut==="timeOut")&&this.options.timeOut&&(this.timeout=setTimeout(()=>{this.remove()},this.options.timeOut),this.hideTime=new Date().getTime()+this.options.timeOut,this.options.progressBar&&(this.intervalId=setInterval(()=>this.updateProgress(),10))),this.options.onActivateTick&&this.appRef.tick()}updateProgress(){if(this.width()===0||this.width()===100||!this.options.timeOut)return;let t=new Date().getTime(),n=this.hideTime-t;this.width.set(n/this.options.timeOut*100),this.options.progressAnimation==="increasing"&&this.width.update(s=>100-s),this.width()<=0&&this.width.set(0),this.width()>=100&&this.width.set(100)}resetTimeout(){clearTimeout(this.timeout),clearInterval(this.intervalId),this.state.set("active"),this.options.timeOut=this.originalTimeout,this.timeout=setTimeout(()=>this.remove(),this.originalTimeout),this.hideTime=new Date().getTime()+(this.originalTimeout||0),this.width.set(-1),this.options.progressBar&&(this.intervalId=setInterval(()=>this.updateProgress(),10))}remove(){this.state()!=="removed"&&(clearTimeout(this.timeout),this.state.set("removed"),this.timeout=setTimeout(()=>this.toastrService.remove(this.toastPackage.toastId)))}tapToast(){this.state()!=="removed"&&(this.toastPackage.triggerTap(),this.options.tapToDismiss&&this.remove())}stickAround(){this.state()!=="removed"&&(clearTimeout(this.timeout),this.options.timeOut=0,this.hideTime=0,clearInterval(this.intervalId),this.width.set(0))}delayedHideToast(){this.options.disableTimeOut===!0||this.options.disableTimeOut==="extendedTimeOut"||this.options.extendedTimeOut===0||this.state()==="removed"||(this.timeout=setTimeout(()=>this.remove(),this.options.extendedTimeOut),this.options.timeOut=this.options.extendedTimeOut,this.hideTime=new Date().getTime()+(this.options.timeOut||0),this.width.set(-1),this.options.progressBar&&(this.intervalId=setInterval(()=>this.updateProgress(),10)))}static \u0275fac=function(n){return new(n||i)(ie(zo),ie(qo),ie(Ar))};static \u0275cmp=ye({type:i,selectors:[["","toast-component",""]],hostVars:4,hostBindings:function(n,s){n&1&&De("click",function(){return s.tapToast()})("mouseenter",function(){return s.stickAround()})("mouseleave",function(){return s.delayedHideToast()}),n&2&&(Ee(s.toastClasses),ca("display",s.displayStyle))},standalone:!0,features:[Re],attrs:Sb,decls:5,vars:5,consts:[["type","button","class","toast-close-button","aria-label","Close",3,"click",4,"ngIf"],[3,"class",4,"ngIf"],["role","alert",3,"class","innerHTML",4,"ngIf"],["role","alert",3,"class",4,"ngIf"],[4,"ngIf"],["type","button","aria-label","Close",1,"toast-close-button",3,"click"],["aria-hidden","true"],["role","alert",3,"innerHTML"],["role","alert"],[1,"toast-progress"]],template:function(n,s){n&1&&de(0,nN,3,0,"button",0)(1,sN,3,5,"div",1)(2,rN,1,3,"div",2)(3,oN,2,4,"div",3)(4,aN,2,2,"div",4),n&2&&(O("ngIf",s.options.closeButton),k(),O("ngIf",s.title),k(),O("ngIf",s.message&&s.options.enableHtml),k(),O("ngIf",s.message&&!s.options.enableHtml),k(),O("ngIf",s.options.progressBar))},dependencies:[rn],encapsulation:2,changeDetection:0})}return i})(),UL=sn(Ce({},Ab),{toastComponent:dN});var jo=class i{constructor(e,t){this.afs=e;this.toastr=t}getAllExpenses(){return this.afs.collection("expenses").snapshotChanges().pipe(at(e=>e.map(t=>{let n=t.payload.doc.data(),s=t.payload.doc.id;return n.key=s,Ce({},n)})))}getExpense(e){return this.afs.collection("expenses").doc(e).valueChanges()}addExpense(e){this.afs.collection("expenses").add(e).catch(t=>{this.toastr.error(t.message,"An error occurred",{timeOut:1e4,positionClass:"toast-top-right",closeButton:!0,progressBar:!0})})}updateExpense(e,t){this.afs.collection("expenses").doc(e).update(t).catch(n=>{this.toastr.error(n.message,"An error occurred",{timeOut:1e4,positionClass:"toast-top-right",closeButton:!0,progressBar:!0})})}deleteExpense(e){this.afs.doc("expenses/"+e).delete().catch(t=>{this.toastr.error(t.message,"An error occurred",{timeOut:1e4,positionClass:"toast-top-right",closeButton:!0,progressBar:!0})})}static \u0275fac=function(t){return new(t||i)(ne(_y),ne(zo))};static \u0275prov=pt({token:i,factory:i.\u0275fac,providedIn:"root"})};var Nb=(()=>{class i{pFocusTrapDisabled=!1;platformId=Ke(_n);host=Ke(_i);document=Ke(bt);firstHiddenFocusableElement;lastHiddenFocusableElement;ngOnInit(){Cn(this.platformId)&&!this.pFocusTrapDisabled&&!this.firstHiddenFocusableElement&&!this.lastHiddenFocusableElement&&this.createHiddenFocusableElements()}ngOnChanges(t){t.pFocusTrapDisabled&&Cn(this.platformId)&&(t.pFocusTrapDisabled.currentValue?this.removeHiddenFocusableElements():this.createHiddenFocusableElements())}removeHiddenFocusableElements(){this.firstHiddenFocusableElement&&this.firstHiddenFocusableElement.parentNode&&this.firstHiddenFocusableElement.parentNode.removeChild(this.firstHiddenFocusableElement),this.lastHiddenFocusableElement&&this.lastHiddenFocusableElement.parentNode&&this.lastHiddenFocusableElement.parentNode.removeChild(this.lastHiddenFocusableElement)}getComputedSelector(t){return`:not(.p-hidden-focusable):not([data-p-hidden-focusable="true"])${t??""}`}createHiddenFocusableElements(){let t="0",n=s=>oe.createElement("span",{class:"p-hidden-accessible p-hidden-focusable",tabindex:t,role:"presentation","data-p-hidden-accessible":!0,"data-p-hidden-focusable":!0,onFocus:s?.bind(this)});this.firstHiddenFocusableElement=n(this.onFirstHiddenElementFocus),this.lastHiddenFocusableElement=n(this.onLastHiddenElementFocus),this.firstHiddenFocusableElement.setAttribute("data-pc-section","firstfocusableelement"),this.lastHiddenFocusableElement.setAttribute("data-pc-section","lastfocusableelement"),this.host.nativeElement.prepend(this.firstHiddenFocusableElement),this.host.nativeElement.append(this.lastHiddenFocusableElement)}onFirstHiddenElementFocus(t){let{currentTarget:n,relatedTarget:s}=t,r=s===this.lastHiddenFocusableElement||!this.host.nativeElement?.contains(s)?oe.getFirstFocusableElement(n.parentElement,":not(.p-hidden-focusable)"):this.lastHiddenFocusableElement;oe.focus(r)}onLastHiddenElementFocus(t){let{currentTarget:n,relatedTarget:s}=t,r=s===this.firstHiddenFocusableElement||!this.host.nativeElement?.contains(s)?oe.getLastFocusableElement(n.parentElement,":not(.p-hidden-focusable)"):this.firstHiddenFocusableElement;oe.focus(r)}static \u0275fac=function(n){return new(n||i)};static \u0275dir=gn({type:i,selectors:[["","pFocusTrap",""]],hostAttrs:[1,"p-element"],inputs:{pFocusTrapDisabled:[2,"pFocusTrapDisabled","pFocusTrapDisabled",lt]},features:[Mn,yv]})}return i})(),kb=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=gt({type:i});static \u0275inj=mt({imports:[In]})}return i})();var Ny=(()=>{class i extends Bt{pathId;ngOnInit(){this.pathId="url(#"+Rt()+")"}static \u0275fac=(()=>{let t;return function(s){return(t||(t=kt(i)))(s||i)}})();static \u0275cmp=ye({type:i,selectors:[["WindowMaximizeIcon"]],standalone:!0,features:[Ot,Re],decls:6,vars:7,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["fill-rule","evenodd","clip-rule","evenodd","d","M7 14H11.8C12.3835 14 12.9431 13.7682 13.3556 13.3556C13.7682 12.9431 14 12.3835 14 11.8V2.2C14 1.61652 13.7682 1.05694 13.3556 0.644365C12.9431 0.231785 12.3835 0 11.8 0H2.2C1.61652 0 1.05694 0.231785 0.644365 0.644365C0.231785 1.05694 0 1.61652 0 2.2V7C0 7.15913 0.063214 7.31174 0.175736 7.42426C0.288258 7.53679 0.44087 7.6 0.6 7.6C0.75913 7.6 0.911742 7.53679 1.02426 7.42426C1.13679 7.31174 1.2 7.15913 1.2 7V2.2C1.2 1.93478 1.30536 1.68043 1.49289 1.49289C1.68043 1.30536 1.93478 1.2 2.2 1.2H11.8C12.0652 1.2 12.3196 1.30536 12.5071 1.49289C12.6946 1.68043 12.8 1.93478 12.8 2.2V11.8C12.8 12.0652 12.6946 12.3196 12.5071 12.5071C12.3196 12.6946 12.0652 12.8 11.8 12.8H7C6.84087 12.8 6.68826 12.8632 6.57574 12.9757C6.46321 13.0883 6.4 13.2409 6.4 13.4C6.4 13.5591 6.46321 13.7117 6.57574 13.8243C6.68826 13.9368 6.84087 14 7 14ZM9.77805 7.42192C9.89013 7.534 10.0415 7.59788 10.2 7.59995C10.3585 7.59788 10.5099 7.534 10.622 7.42192C10.7341 7.30985 10.798 7.15844 10.8 6.99995V3.94242C10.8066 3.90505 10.8096 3.86689 10.8089 3.82843C10.8079 3.77159 10.7988 3.7157 10.7824 3.6623C10.756 3.55552 10.701 3.45698 10.622 3.37798C10.5099 3.2659 10.3585 3.20202 10.2 3.19995H7.00002C6.84089 3.19995 6.68828 3.26317 6.57576 3.37569C6.46324 3.48821 6.40002 3.64082 6.40002 3.79995C6.40002 3.95908 6.46324 4.11169 6.57576 4.22422C6.68828 4.33674 6.84089 4.39995 7.00002 4.39995H8.80006L6.19997 7.00005C6.10158 7.11005 6.04718 7.25246 6.04718 7.40005C6.04718 7.54763 6.10158 7.69004 6.19997 7.80005C6.30202 7.91645 6.44561 7.98824 6.59997 8.00005C6.75432 7.98824 6.89791 7.91645 6.99997 7.80005L9.60002 5.26841V6.99995C9.6021 7.15844 9.66598 7.30985 9.77805 7.42192ZM1.4 14H3.8C4.17066 13.9979 4.52553 13.8498 4.78763 13.5877C5.04973 13.3256 5.1979 12.9707 5.2 12.6V10.2C5.1979 9.82939 5.04973 9.47452 4.78763 9.21242C4.52553 8.95032 4.17066 8.80215 3.8 8.80005H1.4C1.02934 8.80215 0.674468 8.95032 0.412371 9.21242C0.150274 9.47452 0.00210008 9.82939 0 10.2V12.6C0.00210008 12.9707 0.150274 13.3256 0.412371 13.5877C0.674468 13.8498 1.02934 13.9979 1.4 14ZM1.25858 10.0586C1.29609 10.0211 1.34696 10 1.4 10H3.8C3.85304 10 3.90391 10.0211 3.94142 10.0586C3.97893 10.0961 4 10.147 4 10.2V12.6C4 12.6531 3.97893 12.704 3.94142 12.7415C3.90391 12.779 3.85304 12.8 3.8 12.8H1.4C1.34696 12.8 1.29609 12.779 1.25858 12.7415C1.22107 12.704 1.2 12.6531 1.2 12.6V10.2C1.2 10.147 1.22107 10.0961 1.25858 10.0586Z","fill","currentColor"],[3,"id"],["width","14","height","14","fill","white"]],template:function(n,s){n&1&&(Nt(),L(0,"svg",0)(1,"g"),te(2,"path",1),V(),L(3,"defs")(4,"clipPath",2),te(5,"rect",3),V()()()),n&2&&(Ee(s.getClassNames()),se("aria-label",s.ariaLabel)("aria-hidden",s.ariaHidden)("role",s.role),k(),se("clip-path",s.pathId),k(3),O("id",s.pathId))},encapsulation:2})}return i})();var ky=(()=>{class i extends Bt{pathId;ngOnInit(){this.pathId="url(#"+Rt()+")"}static \u0275fac=(()=>{let t;return function(s){return(t||(t=kt(i)))(s||i)}})();static \u0275cmp=ye({type:i,selectors:[["WindowMinimizeIcon"]],standalone:!0,features:[Ot,Re],decls:6,vars:7,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["fill-rule","evenodd","clip-rule","evenodd","d","M11.8 0H2.2C1.61652 0 1.05694 0.231785 0.644365 0.644365C0.231785 1.05694 0 1.61652 0 2.2V7C0 7.15913 0.063214 7.31174 0.175736 7.42426C0.288258 7.53679 0.44087 7.6 0.6 7.6C0.75913 7.6 0.911742 7.53679 1.02426 7.42426C1.13679 7.31174 1.2 7.15913 1.2 7V2.2C1.2 1.93478 1.30536 1.68043 1.49289 1.49289C1.68043 1.30536 1.93478 1.2 2.2 1.2H11.8C12.0652 1.2 12.3196 1.30536 12.5071 1.49289C12.6946 1.68043 12.8 1.93478 12.8 2.2V11.8C12.8 12.0652 12.6946 12.3196 12.5071 12.5071C12.3196 12.6946 12.0652 12.8 11.8 12.8H7C6.84087 12.8 6.68826 12.8632 6.57574 12.9757C6.46321 13.0883 6.4 13.2409 6.4 13.4C6.4 13.5591 6.46321 13.7117 6.57574 13.8243C6.68826 13.9368 6.84087 14 7 14H11.8C12.3835 14 12.9431 13.7682 13.3556 13.3556C13.7682 12.9431 14 12.3835 14 11.8V2.2C14 1.61652 13.7682 1.05694 13.3556 0.644365C12.9431 0.231785 12.3835 0 11.8 0ZM6.368 7.952C6.44137 7.98326 6.52025 7.99958 6.6 8H9.8C9.95913 8 10.1117 7.93678 10.2243 7.82426C10.3368 7.71174 10.4 7.55913 10.4 7.4C10.4 7.24087 10.3368 7.08826 10.2243 6.97574C10.1117 6.86321 9.95913 6.8 9.8 6.8H8.048L10.624 4.224C10.73 4.11026 10.7877 3.95982 10.7849 3.80438C10.7822 3.64894 10.7192 3.50063 10.6093 3.3907C10.4994 3.28077 10.3511 3.2178 10.1956 3.21506C10.0402 3.21232 9.88974 3.27002 9.776 3.376L7.2 5.952V4.2C7.2 4.04087 7.13679 3.88826 7.02426 3.77574C6.91174 3.66321 6.75913 3.6 6.6 3.6C6.44087 3.6 6.28826 3.66321 6.17574 3.77574C6.06321 3.88826 6 4.04087 6 4.2V7.4C6.00042 7.47975 6.01674 7.55862 6.048 7.632C6.07656 7.70442 6.11971 7.7702 6.17475 7.82524C6.2298 7.88029 6.29558 7.92344 6.368 7.952ZM1.4 8.80005H3.8C4.17066 8.80215 4.52553 8.95032 4.78763 9.21242C5.04973 9.47452 5.1979 9.82939 5.2 10.2V12.6C5.1979 12.9707 5.04973 13.3256 4.78763 13.5877C4.52553 13.8498 4.17066 13.9979 3.8 14H1.4C1.02934 13.9979 0.674468 13.8498 0.412371 13.5877C0.150274 13.3256 0.00210008 12.9707 0 12.6V10.2C0.00210008 9.82939 0.150274 9.47452 0.412371 9.21242C0.674468 8.95032 1.02934 8.80215 1.4 8.80005ZM3.94142 12.7415C3.97893 12.704 4 12.6531 4 12.6V10.2C4 10.147 3.97893 10.0961 3.94142 10.0586C3.90391 10.0211 3.85304 10 3.8 10H1.4C1.34696 10 1.29609 10.0211 1.25858 10.0586C1.22107 10.0961 1.2 10.147 1.2 10.2V12.6C1.2 12.6531 1.22107 12.704 1.25858 12.7415C1.29609 12.779 1.34696 12.8 1.4 12.8H3.8C3.85304 12.8 3.90391 12.779 3.94142 12.7415Z","fill","currentColor"],[3,"id"],["width","14","height","14","fill","white"]],template:function(n,s){n&1&&(Nt(),L(0,"svg",0)(1,"g"),te(2,"path",1),V(),L(3,"defs")(4,"clipPath",2),te(5,"rect",3),V()()()),n&2&&(Ee(s.getClassNames()),se("aria-label",s.ariaLabel)("aria-hidden",s.ariaHidden)("role",s.role),k(),se("clip-path",s.pathId),k(3),O("id",s.pathId))},encapsulation:2})}return i})();var pN=["mask"],mN=["content"],gN=["footer"],_N=["titlebar"],yN=(i,e,t,n,s,r,o,a,c)=>({"p-dialog-mask":!0,"p-component-overlay p-component-overlay-enter p-dialog-mask-scrollblocker":i,"p-dialog-left":e,"p-dialog-right":t,"p-dialog-top":n,"p-dialog-bottom":s,"p-dialog-top-left":r,"p-dialog-top-right":o,"p-dialog-bottom-left":a,"p-dialog-bottom-right":c}),vN=(i,e,t,n)=>({"p-dialog p-dynamic-dialog p-component":!0,"p-dialog-rtl":i,"p-dialog-resizable":e,"p-dialog-draggable":t,"p-dialog-maximized":n}),wN=(i,e)=>({transform:i,transition:e}),EN=i=>({value:"visible",params:i}),TN=()=>({"p-dialog-header-icon p-dialog-header-maximize p-link":!0});function IN(i,e){if(i&1){let t=Ct();L(0,"div",14),De("mousedown",function(s){ze(t);let r=Q(2);return je(r.initResize(s))}),V()}}function CN(i,e){i&1&&yn(0)}function bN(i,e){if(i&1&&te(0,"span",23),i&2){let t=Q(5);O("ngClass",t.maximized?t.minimizeIcon:t.maximizeIcon)}}function SN(i,e){i&1&&te(0,"WindowMaximizeIcon",24),i&2&&O("styleClass","p-dialog-header-maximize-icon")}function AN(i,e){i&1&&te(0,"WindowMinimizeIcon",24),i&2&&O("styleClass","p-dialog-header-maximize-icon")}function RN(i,e){i&1&&yn(0)}function xN(i,e){i&1&&yn(0)}function PN(i,e){if(i&1){let t=Ct();L(0,"button",20),De("click",function(){ze(t);let s=Q(4);return je(s.maximize())})("keydown.enter",function(){ze(t);let s=Q(4);return je(s.maximize())}),de(1,bN,1,1,"span",21)(2,SN,1,1,"WindowMaximizeIcon",22)(3,AN,1,1,"WindowMinimizeIcon",22)(4,RN,1,0,"ng-container",12)(5,xN,1,0,"ng-container",12),V()}if(i&2){let t=Q(4);O("ngClass",hc(6,TN)),k(),O("ngIf",!t.maximizeIconTemplate||!t.minimizeIconTemplate),k(),O("ngIf",!t.maximized&&!t.maximizeIcon&&!t.maximizeIconTemplate),k(),O("ngIf",t.maximized&&!t.minimizeIcon&&!t.minimizeIconTemplate),k(),O("ngComponentOutlet",t.maximizeIconTemplate),k(),O("ngComponentOutlet",t.minimizeIconTemplate)}}function DN(i,e){i&1&&te(0,"TimesIcon",24),i&2&&O("styleClass","p-dialog-header-close-icon")}function NN(i,e){i&1&&yn(0)}function kN(i,e){if(i&1){let t=Ct();L(0,"button",25),De("click",function(){ze(t);let s=Q(4);return je(s.hide())})("keydown.enter",function(){ze(t);let s=Q(4);return je(s.hide())}),de(1,DN,1,1,"TimesIcon",22)(2,NN,1,0,"ng-container",12),V()}if(i&2){let t=Q(4);O("ngClass","p-dialog-header-icon p-dialog-header-maximize p-link"),se("aria-label",t.closeAriaLabel),k(),O("ngIf",!t.closeIconTemplate),k(),O("ngComponentOutlet",t.closeIconTemplate)}}function ON(i,e){if(i&1&&(Jt(0),L(1,"span",16),ae(2),V(),L(3,"div",17),de(4,PN,6,7,"button",18)(5,kN,3,4,"button",19),V(),Zt()),i&2){let t=Q(3);k(),O("id",t.ariaLabelledBy),k(),En(t.config.header),k(2),O("ngIf",t.config.maximizable),k(),O("ngIf",t.config.closable!==!1)}}function MN(i,e){if(i&1){let t=Ct();L(0,"div",15,3),De("mousedown",function(s){ze(t);let r=Q(2);return je(r.initDrag(s))}),de(2,CN,1,0,"ng-container",12)(3,ON,6,4,"ng-container",11),V()}if(i&2){let t=Q(2);k(2),O("ngComponentOutlet",t.headerTemplate),k(),O("ngIf",!t.headerTemplate)}}function FN(i,e){}function LN(i,e){i&1&&de(0,FN,0,0,"ng-template",26)}function VN(i,e){i&1&&yn(0)}function BN(i,e){if(i&1&&(Jt(0),ae(1),Zt()),i&2){let t=Q(3);k(),Tn(" ",t.config.footer," ")}}function UN(i,e){i&1&&yn(0)}function qN(i,e){if(i&1&&(L(0,"div",27,4),de(2,BN,2,1,"ng-container",11)(3,UN,1,0,"ng-container",12),V()),i&2){let t=Q(2);k(2),O("ngIf",!t.footerTemplate),k(),O("ngComponentOutlet",t.footerTemplate)}}function zN(i,e){if(i&1){let t=Ct();L(0,"div",7,1),De("@animation.start",function(s){ze(t);let r=Q();return je(r.onAnimationStart(s))})("@animation.done",function(s){ze(t);let r=Q();return je(r.onAnimationEnd(s))}),de(2,IN,1,0,"div",8)(3,MN,4,2,"div",9),L(4,"div",10,2),de(6,LN,1,0,null,11)(7,VN,1,0,"ng-container",12),V(),de(8,qN,4,2,"div",13),V()}if(i&2){let t=Q();Ee(t.config.styleClass),O("ngClass",fc(14,vN,t.config.rtl,t.config.resizable,t.config.draggable,t.maximized))("ngStyle",t.containerStyle)("@animation",Fn(22,EN,dc(19,wN,t.transformOptions,t.config.transitionOptions||"150ms cubic-bezier(0, 0, 0.2, 1)")))("pFocusTrapDisabled",t.config.focusTrap===!1),se("aria-labelledby",t.ariaLabelledBy)("aria-modal",!0),k(2),O("ngIf",t.config.resizable),k(),O("ngIf",t.config.showHeader!==!1),k(),O("ngStyle",t.config.contentStyle),k(2),O("ngIf",!t.contentTemplate),k(),O("ngComponentOutlet",t.contentTemplate),k(),O("ngIf",t.config.footer||t.footerTemplate)}}var Ob=(()=>{class i{viewContainerRef;constructor(t){this.viewContainerRef=t}static \u0275fac=function(n){return new(n||i)(ie(Iv))};static \u0275dir=gn({type:i,selectors:[["","pDynamicDialogContent",""]],hostAttrs:[1,"p-element"]})}return i})(),dd=class{data;header;ariaLabelledBy;footer;width;height;closeOnEscape;focusOnShow=!0;focusOnClose=!0;focusTrap=!0;baseZIndex;autoZIndex;dismissableMask;rtl;style;contentStyle;styleClass;transitionOptions;closable;showHeader;modal;maskStyleClass;resizable;draggable;keepInViewport;minX;minY;maximizable;maximizeIcon;minimizeIcon;position;closeAriaLabel;appendTo;duplicate;breakpoints;templates},Ml=class{constructor(){}close(e){this._onClose.next(e),setTimeout(()=>{this._onClose.complete()},1e3)}destroy(){this._onDestroy.next(null)}dragStart(e){this._onDragStart.next(e)}dragEnd(e){this._onDragEnd.next(e)}resizeInit(e){this._onResizeInit.next(e)}resizeEnd(e){this._onResizeEnd.next(e)}maximize(e){this._onMaximize.next(e)}_onClose=new nt;onClose=this._onClose.asObservable();_onDestroy=new nt;onDestroy=this._onDestroy.asObservable();_onDragStart=new nt;onDragStart=this._onDragStart.asObservable();_onDragEnd=new nt;onDragEnd=this._onDragEnd.asObservable();_onResizeInit=new nt;onResizeInit=this._onResizeInit.asObservable();_onResizeEnd=new nt;onResizeEnd=this._onResizeEnd.asObservable();_onMaximize=new nt;onMaximize=this._onMaximize.asObservable();onChildComponentLoaded=new nt},jN=vy([Yt({transform:"{{transform}}",opacity:0}),Ni("{{transition}}",Yt({transform:"none",opacity:1}))]),GN=vy([Ni("{{transition}}",Yt({transform:"{{transform}}",opacity:0}))]),WN=(()=>{class i{document;platformId;cd;renderer;config;dialogRef;zone;primeNGConfig;parentDialog;visible=!0;componentRef;mask;resizing;dragging;maximized;_style={};originalStyle;lastPageX;lastPageY;ariaLabelledBy;id=Rt();styleElement;insertionPoint;maskViewChild;contentViewChild;footerViewChild;headerViewChild;childComponentType;container;wrapper;documentKeydownListener;documentEscapeListener;maskClickListener;transformOptions="scale(0.7)";documentResizeListener;documentResizeEndListener;documentDragListener;documentDragEndListener;get minX(){return this.config.minX?this.config.minX:0}get minY(){return this.config.minY?this.config.minY:0}get keepInViewport(){return this.config.keepInViewport}get maximizable(){return this.config.maximizable}get maximizeIcon(){return this.config.maximizeIcon}get minimizeIcon(){return this.config.minimizeIcon}get style(){return this._style}get position(){return this.config.position}get closeAriaLabel(){return this.primeNGConfig.getTranslation(mb.ARIA).close}set style(t){t&&(this._style=Ce({},t),this.originalStyle=t)}get parent(){let t=Array.from(this.document.getElementsByClassName("p-dialog"));if(t.length>1)return t.pop()}get parentContent(){let t=Array.from(this.document.getElementsByClassName("p-dialog"));if(t.length>0){let n=t[t.length-1].querySelector(".p-dialog-content");if(n)return Array.isArray(n)?n[0]:n}}get header(){return this.config.header}get data(){return this.config.data}get breakpoints(){return this.config.breakpoints}get footerTemplate(){return this.config?.templates?.footer}get headerTemplate(){return this.config?.templates?.header}get contentTemplate(){return this.config?.templates?.content}get minimizeIconTemplate(){return this.config?.templates?.minimizeicon}get maximizeIconTemplate(){return this.config?.templates?.maximizeicon}get closeIconTemplate(){return this.config?.templates?.closeicon}get dynamicDialogCount(){return this.document.querySelectorAll("p-dynamicdialog")?.length}get containerStyle(){return sn(Ce({},this.config.style),{width:this.config.width,height:this.config.height})}constructor(t,n,s,r,o,a,c,u,d){this.document=t,this.platformId=n,this.cd=s,this.renderer=r,this.config=o,this.dialogRef=a,this.zone=c,this.primeNGConfig=u,this.parentDialog=d}ngOnInit(){this.breakpoints&&this.createStyle()}createStyle(){if(Cn(this.platformId)&&!this.styleElement){this.styleElement=this.renderer.createElement("style"),this.styleElement.type="text/css",oe.setAttribute(this.styleElement,"nonce",this.primeNGConfig?.csp()?.nonce),this.renderer.appendChild(this.document.head,this.styleElement);let t="";for(let n in this.breakpoints)t+=`
                        @media screen and (max-width: ${n}) {
                            .p-dialog[${this.id}]:not(.p-dialog-maximized) {
                                width: ${this.breakpoints[n]} !important;
                            }
                        }
                    `;this.renderer.setProperty(this.styleElement,"innerHTML",t)}}destroyStyle(){this.styleElement&&(this.renderer.removeChild(this.document.head,this.styleElement),this.styleElement=null)}ngAfterViewInit(){this.loadChildComponent(this.childComponentType),this.ariaLabelledBy=this.getAriaLabelledBy(),this.cd.detectChanges()}getAriaLabelledBy(){return this.header!==null?Rt()+"_header":null}loadChildComponent(t){let n=this.insertionPoint?.viewContainerRef;n?.clear(),this.componentRef=n?.createComponent(t),this.dialogRef.onChildComponentLoaded.next(this.componentRef.instance)}moveOnTop(){this.config.autoZIndex!==!1&&(ys.set("modal",this.container,(this.config.baseZIndex||0)+this.primeNGConfig.zIndex.modal),this.wrapper.style.zIndex=String(parseInt(this.container.style.zIndex,10)-1))}onAnimationStart(t){switch(t.toState){case"visible":this.container=t.element,this.wrapper=this.container.parentElement,this.moveOnTop(),this.parent&&this.unbindGlobalListeners(),this.bindGlobalListeners(),this.container?.setAttribute(this.id,""),this.config.modal!==!1&&this.enableModality(),this.config.focusOnShow!==!1&&this.focus();break;case"void":this.wrapper&&this.config.modal!==!1&&oe.addClass(this.wrapper,"p-component-overlay-leave");break}}onAnimationEnd(t){t.toState==="void"&&(this.parentContent&&this.config.focusOnClose!==!1&&this.focus(this.parentContent),this.onContainerDestroy(),this.dialogRef.destroy())}onContainerDestroy(){this.unbindGlobalListeners(),this.container&&this.config.autoZIndex!==!1&&ys.clear(this.container),this.config.modal!==!1&&this.disableModality(),this.container=null}close(){this.visible=!1,this.cd.markForCheck()}hide(){this.dialogRef&&this.dialogRef.close()}enableModality(){this.config.dismissableMask&&(this.maskClickListener=this.renderer.listen(this.wrapper,"mousedown",t=>{this.wrapper&&this.wrapper.isSameNode(t.target)&&this.hide()})),this.dynamicDialogCount===1&&oe.addClass(this.document.body,"p-overflow-hidden")}disableModality(){this.wrapper&&(this.config.dismissableMask&&this.unbindMaskClickListener(),this.dynamicDialogCount===1&&oe.removeClass(this.document.body,"p-overflow-hidden"),this.cd.destroyed||this.cd.detectChanges())}focus(t=this.contentViewChild.nativeElement){if(!oe.getFocusableElements(t).length)return;let s=oe.getFocusableElement(t,"[autofocus]");if(s){this.zone.runOutsideAngular(()=>{setTimeout(()=>s.focus(),5)});return}let r=oe.getFocusableElement(t);r?this.zone.runOutsideAngular(()=>{setTimeout(()=>r.focus(),5)}):this.footerViewChild?this.focus(this.footerViewChild.nativeElement):!r&&this.headerViewChild&&this.focus(this.headerViewChild.nativeElement)}maximize(){this.maximized=!this.maximized,this.maximized?oe.addClass(this.document.body,"p-overflow-hidden"):oe.removeClass(this.document.body,"p-overflow-hidden"),this.dialogRef.maximize({maximized:this.maximized})}initResize(t){this.config.resizable&&(this.documentResizeListener||this.bindDocumentResizeListeners(),this.resizing=!0,this.lastPageX=t.pageX,this.lastPageY=t.pageY,oe.addClass(this.document.body,"p-unselectable-text"),this.dialogRef.resizeInit(t))}onResize(t){if(this.resizing){let n=t.pageX-this.lastPageX,s=t.pageY-this.lastPageY,r=oe.getOuterWidth(this.container),o=oe.getOuterHeight(this.container),a=oe.getOuterHeight(this.contentViewChild.nativeElement),c=r+n,u=o+s,d=this.container.style.minWidth,f=this.container.style.minHeight,m=this.container.getBoundingClientRect(),_=oe.getViewport();(!parseInt(this.container.style.top)||!parseInt(this.container.style.left))&&(c+=n,u+=s),(!d||c>parseInt(d))&&m.left+c<_.width&&(this._style.width=c+"px",this.container.style.width=this._style.width),(!f||u>parseInt(f))&&m.top+u<_.height&&(this.contentViewChild.nativeElement.style.height=a+u-o+"px",this._style.height&&(this._style.height=u+"px",this.container.style.height=this._style.height)),this.lastPageX=t.pageX,this.lastPageY=t.pageY}}resizeEnd(t){this.resizing&&(this.resizing=!1,oe.removeClass(this.document.body,"p-unselectable-text"),this.dialogRef.resizeEnd(t))}initDrag(t){oe.hasClass(t.target,"p-dialog-header-icon")||oe.hasClass(t.target.parentElement,"p-dialog-header-icon")||this.config.draggable&&(this.dragging=!0,this.lastPageX=t.pageX,this.lastPageY=t.pageY,this.container.style.margin="0",oe.addClass(this.document.body,"p-unselectable-text"),this.dialogRef.dragStart(t))}onDrag(t){if(this.dragging){let n=oe.getOuterWidth(this.container),s=oe.getOuterHeight(this.container),r=t.pageX-this.lastPageX,o=t.pageY-this.lastPageY,a=this.container.getBoundingClientRect(),c=a.left+r,u=a.top+o,d=oe.getViewport();this.container.style.position="fixed",this.keepInViewport?(c>=this.minX&&c+n<d.width&&(this._style.left=c+"px",this.lastPageX=t.pageX,this.container.style.left=c+"px"),u>=this.minY&&u+s<d.height&&(this._style.top=u+"px",this.lastPageY=t.pageY,this.container.style.top=u+"px")):(this.lastPageX=t.pageX,this.container.style.left=c+"px",this.lastPageY=t.pageY,this.container.style.top=u+"px")}}endDrag(t){this.dragging&&(this.dragging=!1,oe.removeClass(this.document.body,"p-unselectable-text"),this.dialogRef.dragEnd(t),this.cd.detectChanges())}resetPosition(){this.container.style.position="",this.container.style.left="",this.container.style.top="",this.container.style.margin=""}bindDocumentDragListener(){Cn(this.platformId)&&this.zone.runOutsideAngular(()=>{this.documentDragListener=this.renderer.listen(this.document,"mousemove",this.onDrag.bind(this))})}bindDocumentDragEndListener(){Cn(this.platformId)&&this.zone.runOutsideAngular(()=>{this.documentDragEndListener=this.renderer.listen(this.document,"mouseup",this.endDrag.bind(this))})}unbindDocumentDragEndListener(){this.documentDragEndListener&&(this.documentDragEndListener(),this.documentDragListener=null)}unbindDocumentDragListener(){this.documentDragListener&&(this.documentDragListener(),this.documentDragListener=null)}bindDocumentResizeListeners(){Cn(this.platformId)&&this.zone.runOutsideAngular(()=>{this.documentResizeListener=this.renderer.listen(this.document,"mousemove",this.onResize.bind(this)),this.documentResizeEndListener=this.renderer.listen(this.document,"mouseup",this.resizeEnd.bind(this))})}unbindDocumentResizeListeners(){this.documentResizeListener&&this.documentResizeEndListener&&(this.documentResizeListener(),this.documentResizeEndListener(),this.documentResizeListener=null,this.documentResizeEndListener=null)}bindGlobalListeners(){this.config.closeOnEscape!==!1&&this.bindDocumentEscapeListener(),this.config.resizable&&this.bindDocumentResizeListeners(),this.config.draggable&&(this.bindDocumentDragListener(),this.bindDocumentDragEndListener())}unbindGlobalListeners(){this.unbindDocumentEscapeListener(),this.unbindDocumentResizeListeners(),this.unbindDocumentDragListener(),this.unbindDocumentDragEndListener()}bindDocumentEscapeListener(){let t=this.maskViewChild?this.maskViewChild.nativeElement.ownerDocument:"document";this.documentEscapeListener=this.renderer.listen(t,"keydown",n=>{n.which==27&&parseInt(this.container.style.zIndex)==ys.getCurrent()&&this.hide()})}unbindDocumentEscapeListener(){this.documentEscapeListener&&(this.documentEscapeListener(),this.documentEscapeListener=null)}unbindMaskClickListener(){this.maskClickListener&&(this.maskClickListener(),this.maskClickListener=null)}ngOnDestroy(){this.onContainerDestroy(),this.componentRef&&this.componentRef.destroy(),this.destroyStyle()}static \u0275fac=function(n){return new(n||i)(ie(bt),ie(_n),ie(pc),ie(Sr),ie(dd),ie(Ml),ie(zt),ie(fr),ie(i,12))};static \u0275cmp=ye({type:i,selectors:[["p-dynamicDialog"]],viewQuery:function(n,s){if(n&1&&(yi(Ob,5),yi(pN,5),yi(mN,5),yi(gN,5),yi(_N,5)),n&2){let r;vn(r=wn())&&(s.insertionPoint=r.first),vn(r=wn())&&(s.maskViewChild=r.first),vn(r=wn())&&(s.contentViewChild=r.first),vn(r=wn())&&(s.footerViewChild=r.first),vn(r=wn())&&(s.headerViewChild=r.first)}},hostAttrs:[1,"p-element"],decls:3,vars:14,consts:[["mask",""],["container",""],["content",""],["titlebar",""],["footer",""],[3,"ngClass"],["role","dialog","pFocusTrap","",3,"ngClass","ngStyle","class","pFocusTrapDisabled",4,"ngIf"],["role","dialog","pFocusTrap","",3,"ngClass","ngStyle","pFocusTrapDisabled"],["class","p-resizable-handle",3,"mousedown",4,"ngIf"],["class","p-dialog-header",3,"mousedown",4,"ngIf"],[1,"p-dialog-content",3,"ngStyle"],[4,"ngIf"],[4,"ngComponentOutlet"],["class","p-dialog-footer",4,"ngIf"],[1,"p-resizable-handle",3,"mousedown"],[1,"p-dialog-header",3,"mousedown"],[1,"p-dialog-title",3,"id"],[1,"p-dialog-header-icons"],["type","button","tabindex","-1","pRipple","",3,"ngClass","click","keydown.enter",4,"ngIf"],["type","button","role","button",3,"ngClass","click","keydown.enter",4,"ngIf"],["type","button","tabindex","-1","pRipple","",3,"click","keydown.enter","ngClass"],["class","p-dialog-header-maximize-icon",3,"ngClass",4,"ngIf"],[3,"styleClass",4,"ngIf"],[1,"p-dialog-header-maximize-icon",3,"ngClass"],[3,"styleClass"],["type","button","role","button",3,"click","keydown.enter","ngClass"],["pDynamicDialogContent",""],[1,"p-dialog-footer"]],template:function(n,s){n&1&&(L(0,"div",5,0),de(2,zN,9,24,"div",6),V()),n&2&&(Ee(s.config.maskStyleClass),O("ngClass",Rv(4,yN,[s.config.modal!==!1,s.position==="left",s.position==="right",s.position==="top",s.position==="bottom",s.position==="topleft"||s.position==="top-left",s.position==="topright"||s.position==="top-right",s.position==="bottomleft"||s.position==="bottom-left",s.position==="bottomright"||s.position==="bottom-right"])),k(2),O("ngIf",s.visible))},dependencies:()=>[Ds,Nv,rn,Rr,Ny,ky,Uo,Nb,Ob],styles:[`@layer primeng{.p-dialog-mask{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;pointer-events:none}.p-dialog-mask.p-component-overlay{pointer-events:auto}.p-dialog{display:flex;flex-direction:column;pointer-events:auto;max-height:90%;transform:scale(1);position:relative}.p-dialog-content{overflow-y:auto;flex-grow:1}.p-dialog-header{display:flex;align-items:center;justify-content:space-between;flex-shrink:0}.p-dialog-draggable .p-dialog-header{cursor:move}.p-dialog-footer{flex-shrink:0}.p-dialog .p-dialog-header-icons{display:flex;align-items:center}.p-dialog .p-dialog-header-icon{display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative}.p-fluid .p-dialog-footer .p-button{width:auto}.p-dialog-top .p-dialog,.p-dialog-bottom .p-dialog,.p-dialog-left .p-dialog,.p-dialog-right .p-dialog,.p-dialog-top-left .p-dialog,.p-dialog-top-right .p-dialog,.p-dialog-bottom-left .p-dialog,.p-dialog-bottom-right .p-dialog{margin:.75rem;transform:translateZ(0)}.p-dialog-maximized{-webkit-transition:none;transition:none;transform:none;width:100vw!important;height:100vh!important;top:0!important;left:0!important;max-height:100%;height:100%}.p-dialog-maximized .p-dialog-content{flex-grow:1}.p-dialog-left{justify-content:flex-start}.p-dialog-right{justify-content:flex-end}.p-dialog-top{align-items:flex-start}.p-dialog-top-left{justify-content:flex-start;align-items:flex-start}.p-dialog-top-right{justify-content:flex-end;align-items:flex-start}.p-dialog-bottom{align-items:flex-end}.p-dialog-bottom-left{justify-content:flex-start;align-items:flex-end}.p-dialog-bottom-right{justify-content:flex-end;align-items:flex-end}.p-dialog .p-resizable-handle{position:absolute;font-size:.1px;display:block;cursor:se-resize;width:12px;height:12px;right:1px;bottom:1px}.p-confirm-dialog .p-dialog-content{display:flex;align-items:center}}
`],encapsulation:2,data:{animation:[mr("animation",[ui("void => visible",[wy(jN)]),ui("visible => void",[wy(GN)])])]}})}return i})(),Mb=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=gt({type:i});static \u0275inj=mt({imports:[In,Ny,ky,Uo,pr,kb,pr]})}return i})(),Oy=class{_parentInjector;_additionalTokens;constructor(e,t){this._parentInjector=e,this._additionalTokens=t}get(e,t,n){let s=this._additionalTokens.get(e);return s||this._parentInjector.get(e,t)}},fd=(()=>{class i{appRef;injector;document;dialogComponentRefMap=new Map;constructor(t,n,s){this.appRef=t,this.injector=n,this.document=s}open(t,n){if(!this.duplicationPermission(t,n))return null;let s=this.appendDialogComponentToBody(n,t);return this.dialogComponentRefMap.get(s).instance.childComponentType=t,s}getInstance(t){return this.dialogComponentRefMap.get(t).instance}appendDialogComponentToBody(t,n){let s=new WeakMap;s.set(dd,t);let r=new Ml;s.set(Ml,r);let o=r.onClose.subscribe(()=>{this.dialogComponentRefMap.get(r).instance.close()}),a=r.onDestroy.subscribe(()=>{this.removeDialogComponentFromBody(r),a.unsubscribe(),o.unsubscribe()}),c=Dv(WN,{environmentInjector:this.appRef.injector,elementInjector:new Oy(this.injector,s)});this.appRef.attachView(c.hostView);let u=c.hostView.rootNodes[0];return!t.appendTo||t.appendTo==="body"?this.document.body.appendChild(u):oe.appendChild(u,t.appendTo),this.dialogComponentRefMap.set(r,c),r}removeDialogComponentFromBody(t){if(!t||!this.dialogComponentRefMap.has(t))return;let n=this.dialogComponentRefMap.get(t);this.appRef.detachView(n.hostView),n.destroy(),this.dialogComponentRefMap.delete(t)}duplicationPermission(t,n){if(n.duplicate)return!0;let s=!0;for(let[r,o]of this.dialogComponentRefMap)if(o.instance.childComponentType===t){s=!1;break}return s}static \u0275fac=function(n){return new(n||i)(ne(Ar),ne(br),ne(bt))};static \u0275prov=pt({token:i,factory:i.\u0275fac})}return i})();var QN=()=>({width:"100%",right:"0",left:"0"}),$N=i=>({"920px":i});function YN(i,e){i&1&&(L(0,"div",4),ae(1,"Unauthorised! Please login to add/update items."),V())}function XN(i,e){if(i&1){let t=Ct();L(0,"div",12)(1,"div",13)(2,"div",14)(3,"div",15)(4,"h5",16),ae(5),V(),L(6,"h2",17),ae(7),xs(8,"number"),V(),te(9,"p",18),xs(10,"safeHtml"),L(11,"div",19)(12,"button",20),De("click",function(){let s=ze(t).$implicit,r=Q();return je(r.editExpense(s.key))}),ae(13,"Edit"),V(),L(14,"button",21),De("click",function(){let s=ze(t).$implicit,r=Q();return je(r.deleteExpense(s.key))}),ae(15,"Remove"),V()()()()()()}if(i&2){let t=e.$implicit;k(5),En(t.title),k(2),Tn("\xA3",lf(8,3,t.price,"1.2-2"),""),k(2),O("innerHTML",ua(10,6,t.description),la)}}var pd=class i{constructor(e,t,n,s){this.expenseService=e;this.router=t;this.messageService=n;this.dialogService=s;this.items=this.getAllDocuments(),this.isLoggedIn.subscribe(r=>{this.authorised=r}),this.items.subscribe(r=>{this.totalPrice=0,r.forEach(o=>{this.totalPrice+=Number(o.price)})})}items;totalPrice=0;isLoggedIn=Ke(vi).isLoggedIn();authorised;authService=Ke(vi);unauthorised=!1;isLoginFormModelOpen=!1;openDialog(){let e=this.dialogService.open(mf,{header:"Choose a car",width:"70%"})}show(){this.messageService.add({severity:"error",summary:"Oops!",detail:"Looks like something went wrong.",life:5e3})}getAllDocuments(){return this.expenseService.getAllExpenses()}editExpense(e){this.router.navigate(["/expense-form/"+e])}deleteExpense(e){this.authorised?this.expenseService.deleteExpense(e):this.unauthorised=!0}addExpense(){this.authorised?this.router.navigate(["/expense-form"]):this.unauthorised=!0}ngOnInit(){}ngOnDestroy(){}static \u0275fac=function(t){return new(t||i)(ie(jo),ie(vc),ie(Vo),ie(fd))};static \u0275cmp=ye({type:i,selectors:[["app-expense"]],standalone:!0,features:[uc([Vo]),Re],decls:18,vars:13,consts:[[1,"mb-4","d-flex","justify-content-between","align-items-center"],["type","button","routerLink","/expense-form",1,"btn","btn-primary",3,"click"],[1,"fw-bold","align-items-center"],[1,"text-success"],[1,"form-text","text-danger","fw-bold"],["class","mt-4",4,"ngFor","ngForOf"],[1,"btn","btn-info",3,"click"],[3,"closeModal","showModal"],[3,"formSubmit"],[1,"card","flex","justify-content-center"],[3,"breakpoints"],["label","Show",3,"onClick"],[1,"mt-4"],[1,"d-flex","flex-column","gap-3"],[1,"card"],[1,"card-body"],[1,"card-title"],[1,"fw-bold","text-success"],[1,"card-text",3,"innerHTML"],[1,"d-flex","gap-2"],[1,"btn","btn-sm","btn-success",3,"click"],[1,"btn","btn-sm","btn-danger",3,"click"]],template:function(t,n){t&1&&(L(0,"div",0)(1,"button",1),De("click",function(){return n.addExpense()}),ae(2,"Add Expense"),V(),L(3,"h5",2),ae(4,"Total Expenses: "),L(5,"strong",3),ae(6),xs(7,"number"),V()()(),de(8,YN,2,0,"div",4)(9,XN,16,8,"div",5),xs(10,"async"),L(11,"button",6),De("click",function(){return n.openDialog()}),ae(12,"Modal"),V(),L(13,"app-modal",7),De("closeModal",function(){return n.isLoginFormModelOpen=!1}),L(14,"app-login-form",8),De("formSubmit",function(){return n.isLoginFormModelOpen=!1}),V()(),L(15,"div",9),te(16,"p-toast",10),L(17,"p-button",11),De("onClick",function(){return n.show()}),V()()),t&2&&(k(6),Tn("\xA3",lf(7,5,n.totalPrice,"1.2-2"),""),k(2),Ss(n.unauthorised?8:-1),k(),O("ngForOf",ua(10,8,n.items)),k(4),O("showModal",n.isLoginFormModelOpen),k(3),O("breakpoints",Fn(11,$N,hc(10,QN))))},dependencies:[In,mc,_c,kv,wc,Bv,rd,mf,od,hd,Eb,bb,Sy]})};function Fb(i){return e=>i.test(e.value)?{forbiddenName:{value:e.value}}:null}function JN(i,e){i&1&&(L(0,"div",6),ae(1,"Title is a required field"),V())}function ZN(i,e){i&1&&(L(0,"div",6),ae(1,"Price is a required field"),V())}function ek(i,e){i&1&&(L(0,"div",6),ae(1,"Contains an illegal name"),V())}function tk(i,e){i&1&&(L(0,"div",6),ae(1,"Unauthorised! Please login to add/update items."),V())}var Fl=class i{constructor(e,t,n,s){this.fb=e;this.afs=t;this.activatedRoute=n;this.router=s;this.expenseForm=this.fb.group({price:new zc("",[pf.required]),title:new zc("",[pf.required]),description:new zc("",[Fb(/craig/i)])})}expenseForm;expenseId;isLoggedIn=Ke(vi).isLoggedIn();authorised;authService=Ke(vi);unauthorised=!1;ngOnInit(){this.isLoggedIn.subscribe(e=>{this.authorised=e}),this.activatedRoute.params.subscribe({next:e=>this.expenseId=e.id}),this.getExpense(this.expenseId)}getExpense(e){this.afs.getExpense(e).subscribe(t=>{this.expenseForm.patchValue(t)})}addExpense(){this.authorised?(this.afs.addExpense(this.expenseForm.value),this.router.navigate(["./"])):this.unauthorised=!0}updateExpense(){this.expenseForm.valid&&this.authorised?(this.activatedRoute.params.subscribe({next:e=>e.id?this.afs.updateExpense(e.id,this.expenseForm.value):this.afs.addExpense(this.expenseForm.value)}),this.router.navigate(["./"])):(this.expenseForm.markAllAsTouched(),this.expenseForm.hasError,this.unauthorised=!0)}static \u0275fac=function(t){return new(t||i)(ie(aw),ie(jo),ie(Lv),ie(vc))};static \u0275cmp=ye({type:i,selectors:[["app-expense-form"]],standalone:!0,features:[Re],decls:23,vars:5,consts:[[1,"row"],[1,"col-lg-6"],[3,"formGroup"],[1,"mb-3"],["for","title",1,"form-label"],["type","text","id","title","placeholder","Title","formControlName","title",1,"form-control"],[1,"form-text","text-danger","fw-bold"],["for","price",1,"form-label"],["type","number","id","price","placeholder","Price","formControlName","price",1,"form-control"],["for","description",1,"form-label"],["type","password","id","description","formControlName","description",1,"form-control"],["type","submit",1,"btn","btn-success",3,"click"]],template:function(t,n){if(t&1&&(L(0,"div",0)(1,"div",1)(2,"h4"),ae(3,"Expense Form"),V(),L(4,"form",2)(5,"div",3)(6,"label",4),ae(7,"Title"),V(),te(8,"input",5),de(9,JN,2,0,"div",6),V(),L(10,"div",3)(11,"label",7),ae(12,"Price"),V(),te(13,"input",8),de(14,ZN,2,0,"div",6),V(),L(15,"div",3)(16,"label",9),ae(17,"Description"),V(),te(18,"textarea",10),de(19,ek,2,0,"div",6),V(),L(20,"button",11),De("click",function(r){return r.preventDefault(),n.updateExpense()}),ae(21,"Save Changes"),V()(),de(22,tk,2,0,"div",6),V()()),t&2){let s,r,o;k(4),O("formGroup",n.expenseForm),k(5),Ss((s=n.expenseForm.get("title"))!=null&&s.hasError("required")&&((s=n.expenseForm.get("title"))!=null&&s.touched)?9:-1),k(5),Ss((r=n.expenseForm.get("price"))!=null&&r.hasError("required")&&((r=n.expenseForm.get("price"))!=null&&r.touched)?14:-1),k(5),Ss((o=n.expenseForm.get("description"))!=null&&o.hasError("forbiddenName")&&((o=n.expenseForm.get("description"))!=null&&o.touched)?19:-1),k(3),Ss(n.unauthorised?22:-1)}},dependencies:[In,lw,iw,ew,sw,tw,nw,rw,ow,wc]})};var Lb=[{path:"",component:pd},{path:"expense-form",component:Fl},{path:"expense-form/:id",component:Fl},{path:"login",loadComponent:()=>import("./chunk-VYCNKWEF.js").then(i=>i.LoginComponent)},{path:"signup",loadComponent:()=>import("./chunk-ISMI6C2S.js").then(i=>i.SignupComponent)},{path:"reset",loadComponent:()=>import("./chunk-UMEFS2HI.js").then(i=>i.ResetComponent)}];function Vb(i){return new be(3e3,!1)}function nk(){return new be(3100,!1)}function ik(){return new be(3101,!1)}function sk(i){return new be(3001,!1)}function rk(i){return new be(3003,!1)}function ok(i){return new be(3004,!1)}function ak(i,e){return new be(3005,!1)}function lk(){return new be(3006,!1)}function ck(){return new be(3007,!1)}function uk(i,e){return new be(3008,!1)}function hk(i){return new be(3002,!1)}function dk(i,e,t,n,s){return new be(3010,!1)}function fk(){return new be(3011,!1)}function pk(){return new be(3012,!1)}function mk(){return new be(3200,!1)}function gk(){return new be(3202,!1)}function _k(){return new be(3013,!1)}function yk(i){return new be(3014,!1)}function vk(i){return new be(3015,!1)}function wk(i){return new be(3016,!1)}function Ek(i,e){return new be(3404,!1)}function Tk(i){return new be(3502,!1)}function Ik(i){return new be(3503,!1)}function Ck(){return new be(3300,!1)}function bk(i){return new be(3504,!1)}function Sk(i){return new be(3301,!1)}function Ak(i,e){return new be(3302,!1)}function Rk(i){return new be(3303,!1)}function xk(i,e){return new be(3400,!1)}function Pk(i){return new be(3401,!1)}function Dk(i){return new be(3402,!1)}function Nk(i,e){return new be(3505,!1)}function ws(i){switch(i.length){case 0:return new vs;case 1:return i[0];default:return new Ol(i)}}function Jb(i,e,t=new Map,n=new Map){let s=[],r=[],o=-1,a=null;if(e.forEach(c=>{let u=c.get("offset"),d=u==o,f=d&&a||new Map;c.forEach((m,_)=>{let v=_,C=m;if(_!=="offset")switch(v=i.normalizePropertyName(v,s),C){case cd:C=t.get(_);break;case ci:C=n.get(_);break;default:C=i.normalizeStyleValue(_,v,C,s);break}f.set(v,C)}),d||r.push(f),a=f,o=u}),s.length)throw Tk(s);return r}function i0(i,e,t,n){switch(e){case"start":i.onStart(()=>n(t&&My(t,"start",i)));break;case"done":i.onDone(()=>n(t&&My(t,"done",i)));break;case"destroy":i.onDestroy(()=>n(t&&My(t,"destroy",i)));break}}function My(i,e,t){let n=t.totalTime,s=!!t.disabled,r=s0(i.element,i.triggerName,i.fromState,i.toState,e||i.phaseName,n??i.totalTime,s),o=i._data;return o!=null&&(r._data=o),r}function s0(i,e,t,n,s="",r=0,o){return{element:i,triggerName:e,fromState:t,toState:n,phaseName:s,totalTime:r,disabled:!!o}}function fn(i,e,t){let n=i.get(e);return n||i.set(e,n=t),n}function Bb(i){let e=i.indexOf(":"),t=i.substring(1,e),n=i.slice(e+1);return[t,n]}var kk=typeof document>"u"?null:document.documentElement;function r0(i){let e=i.parentNode||i.host||null;return e===kk?null:e}function Ok(i){return i.substring(1,6)=="ebkit"}var gr=null,Ub=!1;function Mk(i){gr||(gr=Fk()||{},Ub=gr.style?"WebkitAppearance"in gr.style:!1);let e=!0;return gr.style&&!Ok(i)&&(e=i in gr.style,!e&&Ub&&(e="Webkit"+i.charAt(0).toUpperCase()+i.slice(1)in gr.style)),e}function Fk(){return typeof document<"u"?document.body:null}function Zb(i,e){for(;e;){if(e===i)return!0;e=r0(e)}return!1}function eS(i,e,t){if(t)return Array.from(i.querySelectorAll(e));let n=i.querySelector(e);return n?[n]:[]}var o0=(()=>{class i{validateStyleProperty(t){return Mk(t)}containsElement(t,n){return Zb(t,n)}getParentElement(t){return r0(t)}query(t,n,s){return eS(t,n,s)}computeStyle(t,n,s){return s||""}animate(t,n,s,r,o,a=[],c){return new vs(s,r)}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=pt({token:i,factory:i.\u0275fac})}}return i})(),vr=class{static{this.NOOP=new o0}},wr=class{};var Lk=1e3,tS="{{",Vk="}}",nS="ng-enter",qy="ng-leave",md="ng-trigger",wd=".ng-trigger",qb="ng-animating",zy=".ng-animating";function ki(i){if(typeof i=="number")return i;let e=i.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:jy(parseFloat(e[1]),e[2])}function jy(i,e){switch(e){case"s":return i*Lk;default:return i}}function Ed(i,e,t){return i.hasOwnProperty("duration")?i:Bk(i,e,t)}function Bk(i,e,t){let n=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i,s,r=0,o="";if(typeof i=="string"){let a=i.match(n);if(a===null)return e.push(Vb(i)),{duration:0,delay:0,easing:""};s=jy(parseFloat(a[1]),a[2]);let c=a[3];c!=null&&(r=jy(parseFloat(c),a[4]));let u=a[5];u&&(o=u)}else s=i;if(!t){let a=!1,c=e.length;s<0&&(e.push(nk()),a=!0),r<0&&(e.push(ik()),a=!0),a&&e.splice(c,0,Vb(i))}return{duration:s,delay:r,easing:o}}function Uk(i){return i.length?i[0]instanceof Map?i:i.map(e=>new Map(Object.entries(e))):[]}function hi(i,e,t){e.forEach((n,s)=>{let r=a0(s);t&&!t.has(s)&&t.set(s,i.style[r]),i.style[r]=n})}function yr(i,e){e.forEach((t,n)=>{let s=a0(n);i.style[s]=""})}function Ll(i){return Array.isArray(i)?i.length==1?i[0]:gb(i):i}function qk(i,e,t){let n=e.params||{},s=iS(i);s.length&&s.forEach(r=>{n.hasOwnProperty(r)||t.push(sk(r))})}var Gy=new RegExp(`${tS}\\s*(.+?)\\s*${Vk}`,"g");function iS(i){let e=[];if(typeof i=="string"){let t;for(;t=Gy.exec(i);)e.push(t[1]);Gy.lastIndex=0}return e}function Bl(i,e,t){let n=`${i}`,s=n.replace(Gy,(r,o)=>{let a=e[o];return a==null&&(t.push(rk(o)),a=""),a.toString()});return s==n?i:s}var zk=/-+([a-z0-9])/g;function a0(i){return i.replace(zk,(...e)=>e[1].toUpperCase())}function jk(i,e){return i===0||e===0}function Gk(i,e,t){if(t.size&&e.length){let n=e[0],s=[];if(t.forEach((r,o)=>{n.has(o)||s.push(o),n.set(o,r)}),s.length)for(let r=1;r<e.length;r++){let o=e[r];s.forEach(a=>o.set(a,l0(i,a)))}}return e}function dn(i,e,t){switch(e.type){case le.Trigger:return i.visitTrigger(e,t);case le.State:return i.visitState(e,t);case le.Transition:return i.visitTransition(e,t);case le.Sequence:return i.visitSequence(e,t);case le.Group:return i.visitGroup(e,t);case le.Animate:return i.visitAnimate(e,t);case le.Keyframes:return i.visitKeyframes(e,t);case le.Style:return i.visitStyle(e,t);case le.Reference:return i.visitReference(e,t);case le.AnimateChild:return i.visitAnimateChild(e,t);case le.AnimateRef:return i.visitAnimateRef(e,t);case le.Query:return i.visitQuery(e,t);case le.Stagger:return i.visitStagger(e,t);default:throw ok(e.type)}}function l0(i,e){return window.getComputedStyle(i)[e]}var Wk=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]),Td=class extends wr{normalizePropertyName(e,t){return a0(e)}normalizeStyleValue(e,t,n,s){let r="",o=n.toString().trim();if(Wk.has(t)&&n!==0&&n!=="0")if(typeof n=="number")r="px";else{let a=n.match(/^[+-]?[\d\.]+([a-z]*)$/);a&&a[1].length==0&&s.push(ak(e,n))}return o+r}};var Id="*";function Hk(i,e){let t=[];return typeof i=="string"?i.split(/\s*,\s*/).forEach(n=>Kk(n,t,e)):t.push(i),t}function Kk(i,e,t){if(i[0]==":"){let c=Qk(i,t);if(typeof c=="function"){e.push(c);return}i=c}let n=i.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(n==null||n.length<4)return t.push(vk(i)),e;let s=n[1],r=n[2],o=n[3];e.push(zb(s,o));let a=s==Id&&o==Id;r[0]=="<"&&!a&&e.push(zb(o,s))}function Qk(i,e){switch(i){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,n)=>parseFloat(n)>parseFloat(t);case":decrement":return(t,n)=>parseFloat(n)<parseFloat(t);default:return e.push(wk(i)),"* => *"}}var gd=new Set(["true","1"]),_d=new Set(["false","0"]);function zb(i,e){let t=gd.has(i)||_d.has(i),n=gd.has(e)||_d.has(e);return(s,r)=>{let o=i==Id||i==s,a=e==Id||e==r;return!o&&t&&typeof s=="boolean"&&(o=s?gd.has(i):_d.has(i)),!a&&n&&typeof r=="boolean"&&(a=r?gd.has(e):_d.has(e)),o&&a}}var sS=":self",$k=new RegExp(`s*${sS}s*,?`,"g");function rS(i,e,t,n){return new Wy(i).build(e,t,n)}var jb="",Wy=class{constructor(e){this._driver=e}build(e,t,n){let s=new Hy(t);return this._resetContextStyleTimingState(s),dn(this,Ll(e),s)}_resetContextStyleTimingState(e){e.currentQuerySelector=jb,e.collectedStyles=new Map,e.collectedStyles.set(jb,new Map),e.currentTime=0}visitTrigger(e,t){let n=t.queryCount=0,s=t.depCount=0,r=[],o=[];return e.name.charAt(0)=="@"&&t.errors.push(lk()),e.definitions.forEach(a=>{if(this._resetContextStyleTimingState(t),a.type==le.State){let c=a,u=c.name;u.toString().split(/\s*,\s*/).forEach(d=>{c.name=d,r.push(this.visitState(c,t))}),c.name=u}else if(a.type==le.Transition){let c=this.visitTransition(a,t);n+=c.queryCount,s+=c.depCount,o.push(c)}else t.errors.push(ck())}),{type:le.Trigger,name:e.name,states:r,transitions:o,queryCount:n,depCount:s,options:null}}visitState(e,t){let n=this.visitStyle(e.styles,t),s=e.options&&e.options.params||null;if(n.containsDynamicStyles){let r=new Set,o=s||{};n.styles.forEach(a=>{a instanceof Map&&a.forEach(c=>{iS(c).forEach(u=>{o.hasOwnProperty(u)||r.add(u)})})}),r.size&&t.errors.push(uk(e.name,[...r.values()]))}return{type:le.State,name:e.name,style:n,options:s?{params:s}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;let n=dn(this,Ll(e.animation),t),s=Hk(e.expr,t.errors);return{type:le.Transition,matchers:s,animation:n,queryCount:t.queryCount,depCount:t.depCount,options:_r(e.options)}}visitSequence(e,t){return{type:le.Sequence,steps:e.steps.map(n=>dn(this,n,t)),options:_r(e.options)}}visitGroup(e,t){let n=t.currentTime,s=0,r=e.steps.map(o=>{t.currentTime=n;let a=dn(this,o,t);return s=Math.max(s,t.currentTime),a});return t.currentTime=s,{type:le.Group,steps:r,options:_r(e.options)}}visitAnimate(e,t){let n=Zk(e.timings,t.errors);t.currentAnimateTimings=n;let s,r=e.styles?e.styles:Yt({});if(r.type==le.Keyframes)s=this.visitKeyframes(r,t);else{let o=e.styles,a=!1;if(!o){a=!0;let u={};n.easing&&(u.easing=n.easing),o=Yt(u)}t.currentTime+=n.duration+n.delay;let c=this.visitStyle(o,t);c.isEmptyStep=a,s=c}return t.currentAnimateTimings=null,{type:le.Animate,timings:n,style:s,options:null}}visitStyle(e,t){let n=this._makeStyleAst(e,t);return this._validateStyleAst(n,t),n}_makeStyleAst(e,t){let n=[],s=Array.isArray(e.styles)?e.styles:[e.styles];for(let a of s)typeof a=="string"?a===ci?n.push(a):t.errors.push(hk(a)):n.push(new Map(Object.entries(a)));let r=!1,o=null;return n.forEach(a=>{if(a instanceof Map&&(a.has("easing")&&(o=a.get("easing"),a.delete("easing")),!r)){for(let c of a.values())if(c.toString().indexOf(tS)>=0){r=!0;break}}}),{type:le.Style,styles:n,easing:o,offset:e.offset,containsDynamicStyles:r,options:null}}_validateStyleAst(e,t){let n=t.currentAnimateTimings,s=t.currentTime,r=t.currentTime;n&&r>0&&(r-=n.duration+n.delay),e.styles.forEach(o=>{typeof o!="string"&&o.forEach((a,c)=>{let u=t.collectedStyles.get(t.currentQuerySelector),d=u.get(c),f=!0;d&&(r!=s&&r>=d.startTime&&s<=d.endTime&&(t.errors.push(dk(c,d.startTime,d.endTime,r,s)),f=!1),r=d.startTime),f&&u.set(c,{startTime:r,endTime:s}),t.options&&qk(a,t.options,t.errors)})})}visitKeyframes(e,t){let n={type:le.Keyframes,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push(fk()),n;let s=1,r=0,o=[],a=!1,c=!1,u=0,d=e.steps.map(U=>{let q=this._makeStyleAst(U,t),z=q.offset!=null?q.offset:Jk(q.styles),Y=0;return z!=null&&(r++,Y=q.offset=z),c=c||Y<0||Y>1,a=a||Y<u,u=Y,o.push(Y),q});c&&t.errors.push(pk()),a&&t.errors.push(mk());let f=e.steps.length,m=0;r>0&&r<f?t.errors.push(gk()):r==0&&(m=s/(f-1));let _=f-1,v=t.currentTime,C=t.currentAnimateTimings,R=C.duration;return d.forEach((U,q)=>{let z=m>0?q==_?1:m*q:o[q],Y=z*R;t.currentTime=v+C.delay+Y,C.duration=Y,this._validateStyleAst(U,t),U.offset=z,n.styles.push(U)}),n}visitReference(e,t){return{type:le.Reference,animation:dn(this,Ll(e.animation),t),options:_r(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:le.AnimateChild,options:_r(e.options)}}visitAnimateRef(e,t){return{type:le.AnimateRef,animation:this.visitReference(e.animation,t),options:_r(e.options)}}visitQuery(e,t){let n=t.currentQuerySelector,s=e.options||{};t.queryCount++,t.currentQuery=e;let[r,o]=Yk(e.selector);t.currentQuerySelector=n.length?n+" "+r:r,fn(t.collectedStyles,t.currentQuerySelector,new Map);let a=dn(this,Ll(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=n,{type:le.Query,selector:r,limit:s.limit||0,optional:!!s.optional,includeSelf:o,animation:a,originalSelector:e.selector,options:_r(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push(_k());let n=e.timings==="full"?{duration:0,delay:0,easing:"full"}:Ed(e.timings,t.errors,!0);return{type:le.Stagger,animation:dn(this,Ll(e.animation),t),timings:n,options:null}}};function Yk(i){let e=!!i.split(/\s*,\s*/).find(t=>t==sS);return e&&(i=i.replace($k,"")),i=i.replace(/@\*/g,wd).replace(/@\w+/g,t=>wd+"-"+t.slice(1)).replace(/:animating/g,zy),[i,e]}function Xk(i){return i?Ce({},i):null}var Hy=class{constructor(e){this.errors=e,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}};function Jk(i){if(typeof i=="string")return null;let e=null;if(Array.isArray(i))i.forEach(t=>{if(t instanceof Map&&t.has("offset")){let n=t;e=parseFloat(n.get("offset")),n.delete("offset")}});else if(i instanceof Map&&i.has("offset")){let t=i;e=parseFloat(t.get("offset")),t.delete("offset")}return e}function Zk(i,e){if(i.hasOwnProperty("duration"))return i;if(typeof i=="number"){let r=Ed(i,e).duration;return Fy(r,0,"")}let t=i;if(t.split(/\s+/).some(r=>r.charAt(0)=="{"&&r.charAt(1)=="{")){let r=Fy(0,0,"");return r.dynamic=!0,r.strValue=t,r}let s=Ed(t,e);return Fy(s.duration,s.delay,s.easing)}function _r(i){return i?(i=Ce({},i),i.params&&(i.params=Xk(i.params))):i={},i}function Fy(i,e,t){return{duration:i,delay:e,easing:t}}function c0(i,e,t,n,s,r,o=null,a=!1){return{type:1,element:i,keyframes:e,preStyleProps:t,postStyleProps:n,duration:s,delay:r,totalTime:s+r,easing:o,subTimeline:a}}var Ul=class{constructor(){this._map=new Map}get(e){return this._map.get(e)||[]}append(e,t){let n=this._map.get(e);n||this._map.set(e,n=[]),n.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}},eO=1,tO=":enter",nO=new RegExp(tO,"g"),iO=":leave",sO=new RegExp(iO,"g");function oS(i,e,t,n,s,r=new Map,o=new Map,a,c,u=[]){return new Ky().buildKeyframes(i,e,t,n,s,r,o,a,c,u)}var Ky=class{buildKeyframes(e,t,n,s,r,o,a,c,u,d=[]){u=u||new Ul;let f=new Qy(e,t,u,s,r,d,[]);f.options=c;let m=c.delay?ki(c.delay):0;f.currentTimeline.delayNextStep(m),f.currentTimeline.setStyles([o],null,f.errors,c),dn(this,n,f);let _=f.timelines.filter(v=>v.containsAnimation());if(_.length&&a.size){let v;for(let C=_.length-1;C>=0;C--){let R=_[C];if(R.element===t){v=R;break}}v&&!v.allowOnlyTimelineStyles()&&v.setStyles([a],null,f.errors,c)}return _.length?_.map(v=>v.buildKeyframes()):[c0(t,[],[],[],0,m,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){let n=t.subInstructions.get(t.element);if(n){let s=t.createSubContext(e.options),r=t.currentTimeline.currentTime,o=this._visitSubInstructions(n,s,s.options);r!=o&&t.transformIntoNewTimeline(o)}t.previousNode=e}visitAnimateRef(e,t){let n=t.createSubContext(e.options);n.transformIntoNewTimeline(),this._applyAnimationRefDelays([e.options,e.animation.options],t,n),this.visitReference(e.animation,n),t.transformIntoNewTimeline(n.currentTimeline.currentTime),t.previousNode=e}_applyAnimationRefDelays(e,t,n){for(let s of e){let r=s?.delay;if(r){let o=typeof r=="number"?r:ki(Bl(r,s?.params??{},t.errors));n.delayNextStep(o)}}}_visitSubInstructions(e,t,n){let r=t.currentTimeline.currentTime,o=n.duration!=null?ki(n.duration):null,a=n.delay!=null?ki(n.delay):null;return o!==0&&e.forEach(c=>{let u=t.appendInstructionToTimeline(c,o,a);r=Math.max(r,u.duration+u.delay)}),r}visitReference(e,t){t.updateOptions(e.options,!0),dn(this,e.animation,t),t.previousNode=e}visitSequence(e,t){let n=t.subContextCount,s=t,r=e.options;if(r&&(r.params||r.delay)&&(s=t.createSubContext(r),s.transformIntoNewTimeline(),r.delay!=null)){s.previousNode.type==le.Style&&(s.currentTimeline.snapshotCurrentStyles(),s.previousNode=Cd);let o=ki(r.delay);s.delayNextStep(o)}e.steps.length&&(e.steps.forEach(o=>dn(this,o,s)),s.currentTimeline.applyStylesToKeyframe(),s.subContextCount>n&&s.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){let n=[],s=t.currentTimeline.currentTime,r=e.options&&e.options.delay?ki(e.options.delay):0;e.steps.forEach(o=>{let a=t.createSubContext(e.options);r&&a.delayNextStep(r),dn(this,o,a),s=Math.max(s,a.currentTimeline.currentTime),n.push(a.currentTimeline)}),n.forEach(o=>t.currentTimeline.mergeTimelineCollectedStyles(o)),t.transformIntoNewTimeline(s),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){let n=e.strValue,s=t.params?Bl(n,t.params,t.errors):n;return Ed(s,t.errors)}else return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){let n=t.currentAnimateTimings=this._visitTiming(e.timings,t),s=t.currentTimeline;n.delay&&(t.incrementTime(n.delay),s.snapshotCurrentStyles());let r=e.style;r.type==le.Keyframes?this.visitKeyframes(r,t):(t.incrementTime(n.duration),this.visitStyle(r,t),s.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){let n=t.currentTimeline,s=t.currentAnimateTimings;!s&&n.hasCurrentStyleProperties()&&n.forwardFrame();let r=s&&s.easing||e.easing;e.isEmptyStep?n.applyEmptyStep(r):n.setStyles(e.styles,r,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){let n=t.currentAnimateTimings,s=t.currentTimeline.duration,r=n.duration,a=t.createSubContext().currentTimeline;a.easing=n.easing,e.styles.forEach(c=>{let u=c.offset||0;a.forwardTime(u*r),a.setStyles(c.styles,c.easing,t.errors,t.options),a.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(a),t.transformIntoNewTimeline(s+r),t.previousNode=e}visitQuery(e,t){let n=t.currentTimeline.currentTime,s=e.options||{},r=s.delay?ki(s.delay):0;r&&(t.previousNode.type===le.Style||n==0&&t.currentTimeline.hasCurrentStyleProperties())&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=Cd);let o=n,a=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!s.optional,t.errors);t.currentQueryTotal=a.length;let c=null;a.forEach((u,d)=>{t.currentQueryIndex=d;let f=t.createSubContext(e.options,u);r&&f.delayNextStep(r),u===t.element&&(c=f.currentTimeline),dn(this,e.animation,f),f.currentTimeline.applyStylesToKeyframe();let m=f.currentTimeline.currentTime;o=Math.max(o,m)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(o),c&&(t.currentTimeline.mergeTimelineCollectedStyles(c),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){let n=t.parentContext,s=t.currentTimeline,r=e.timings,o=Math.abs(r.duration),a=o*(t.currentQueryTotal-1),c=o*t.currentQueryIndex;switch(r.duration<0?"reverse":r.easing){case"reverse":c=a-c;break;case"full":c=n.currentStaggerTime;break}let d=t.currentTimeline;c&&d.delayNextStep(c);let f=d.currentTime;dn(this,e.animation,t),t.previousNode=e,n.currentStaggerTime=s.currentTime-f+(s.startTime-n.currentTimeline.startTime)}},Cd={},Qy=class i{constructor(e,t,n,s,r,o,a,c){this._driver=e,this.element=t,this.subInstructions=n,this._enterClassName=s,this._leaveClassName=r,this.errors=o,this.timelines=a,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=Cd,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=c||new bd(this._driver,t,0),a.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;let n=e,s=this.options;n.duration!=null&&(s.duration=ki(n.duration)),n.delay!=null&&(s.delay=ki(n.delay));let r=n.params;if(r){let o=s.params;o||(o=this.options.params={}),Object.keys(r).forEach(a=>{(!t||!o.hasOwnProperty(a))&&(o[a]=Bl(r[a],o,this.errors))})}}_copyOptions(){let e={};if(this.options){let t=this.options.params;if(t){let n=e.params={};Object.keys(t).forEach(s=>{n[s]=t[s]})}}return e}createSubContext(e=null,t,n){let s=t||this.element,r=new i(this._driver,s,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(s,n||0));return r.previousNode=this.previousNode,r.currentAnimateTimings=this.currentAnimateTimings,r.options=this._copyOptions(),r.updateOptions(e),r.currentQueryIndex=this.currentQueryIndex,r.currentQueryTotal=this.currentQueryTotal,r.parentContext=this,this.subContextCount++,r}transformIntoNewTimeline(e){return this.previousNode=Cd,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,n){let s={duration:t??e.duration,delay:this.currentTimeline.currentTime+(n??0)+e.delay,easing:""},r=new $y(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,s,e.stretchStartingKeyframe);return this.timelines.push(r),s}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,n,s,r,o){let a=[];if(s&&a.push(this.element),e.length>0){e=e.replace(nO,"."+this._enterClassName),e=e.replace(sO,"."+this._leaveClassName);let c=n!=1,u=this._driver.query(this.element,e,c);n!==0&&(u=n<0?u.slice(u.length+n,u.length):u.slice(0,n)),a.push(...u)}return!r&&a.length==0&&o.push(yk(t)),a}},bd=class i{constructor(e,t,n,s){this._driver=e,this.element=t,this.startTime=n,this._elementTimelineStylesLookup=s,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(e){let t=this._keyframes.size===1&&this._pendingStyles.size;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new i(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=eO,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles.set(e,t),this._globalTimelineStyles.set(e,t),this._styleSummary.set(e,{time:this.currentTime,value:t})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&this._previousKeyframe.set("easing",e);for(let[t,n]of this._globalTimelineStyles)this._backFill.set(t,n||ci),this._currentKeyframe.set(t,ci);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,n,s){t&&this._previousKeyframe.set("easing",t);let r=s&&s.params||{},o=rO(e,this._globalTimelineStyles);for(let[a,c]of o){let u=Bl(c,r,n);this._pendingStyles.set(a,u),this._localTimelineStyles.has(a)||this._backFill.set(a,this._globalTimelineStyles.get(a)??ci),this._updateStyle(a,u)}}applyStylesToKeyframe(){this._pendingStyles.size!=0&&(this._pendingStyles.forEach((e,t)=>{this._currentKeyframe.set(t,e)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((e,t)=>{this._currentKeyframe.has(t)||this._currentKeyframe.set(t,e)}))}snapshotCurrentStyles(){for(let[e,t]of this._localTimelineStyles)this._pendingStyles.set(e,t),this._updateStyle(e,t)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){let e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){e._styleSummary.forEach((t,n)=>{let s=this._styleSummary.get(n);(!s||t.time>s.time)&&this._updateStyle(n,t.value)})}buildKeyframes(){this.applyStylesToKeyframe();let e=new Set,t=new Set,n=this._keyframes.size===1&&this.duration===0,s=[];this._keyframes.forEach((a,c)=>{let u=new Map([...this._backFill,...a]);u.forEach((d,f)=>{d===cd?e.add(f):d===ci&&t.add(f)}),n||u.set("offset",c/this.duration),s.push(u)});let r=[...e.values()],o=[...t.values()];if(n){let a=s[0],c=new Map(a);a.set("offset",0),c.set("offset",1),s=[a,c]}return c0(this.element,s,r,o,this.duration,this.startTime,this.easing,!1)}},$y=class extends bd{constructor(e,t,n,s,r,o,a=!1){super(e,t,o.delay),this.keyframes=n,this.preStyleProps=s,this.postStyleProps=r,this._stretchStartingKeyframe=a,this.timings={duration:o.duration,delay:o.delay,easing:o.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:n,easing:s}=this.timings;if(this._stretchStartingKeyframe&&t){let r=[],o=n+t,a=t/o,c=new Map(e[0]);c.set("offset",0),r.push(c);let u=new Map(e[0]);u.set("offset",Gb(a)),r.push(u);let d=e.length-1;for(let f=1;f<=d;f++){let m=new Map(e[f]),_=m.get("offset"),v=t+_*n;m.set("offset",Gb(v/o)),r.push(m)}n=o,t=0,s="",e=r}return c0(this.element,e,this.preStyleProps,this.postStyleProps,n,t,s,!0)}};function Gb(i,e=3){let t=Math.pow(10,e-1);return Math.round(i*t)/t}function rO(i,e){let t=new Map,n;return i.forEach(s=>{if(s==="*"){n??=e.keys();for(let r of n)t.set(r,ci)}else for(let[r,o]of s)t.set(r,o)}),t}function Wb(i,e,t,n,s,r,o,a,c,u,d,f,m){return{type:0,element:i,triggerName:e,isRemovalTransition:s,fromState:t,fromStyles:r,toState:n,toStyles:o,timelines:a,queriedElements:c,preStyleProps:u,postStyleProps:d,totalTime:f,errors:m}}var Ly={},Sd=class{constructor(e,t,n){this._triggerName=e,this.ast=t,this._stateStyles=n}match(e,t,n,s){return oO(this.ast.matchers,e,t,n,s)}buildStyles(e,t,n){let s=this._stateStyles.get("*");return e!==void 0&&(s=this._stateStyles.get(e?.toString())||s),s?s.buildStyles(t,n):new Map}build(e,t,n,s,r,o,a,c,u,d){let f=[],m=this.ast.options&&this.ast.options.params||Ly,_=a&&a.params||Ly,v=this.buildStyles(n,_,f),C=c&&c.params||Ly,R=this.buildStyles(s,C,f),U=new Set,q=new Map,z=new Map,Y=s==="void",he={params:aS(C,m),delay:this.ast.options?.delay},ee=d?[]:oS(e,t,this.ast.animation,r,o,v,R,he,u,f),T=0;return ee.forEach(y=>{T=Math.max(y.duration+y.delay,T)}),f.length?Wb(t,this._triggerName,n,s,Y,v,R,[],[],q,z,T,f):(ee.forEach(y=>{let E=y.element,I=fn(q,E,new Set);y.preStyleProps.forEach(A=>I.add(A));let b=fn(z,E,new Set);y.postStyleProps.forEach(A=>b.add(A)),E!==t&&U.add(E)}),Wb(t,this._triggerName,n,s,Y,v,R,ee,[...U.values()],q,z,T))}};function oO(i,e,t,n,s){return i.some(r=>r(e,t,n,s))}function aS(i,e){let t=Ce({},e);return Object.entries(i).forEach(([n,s])=>{s!=null&&(t[n]=s)}),t}var Yy=class{constructor(e,t,n){this.styles=e,this.defaultParams=t,this.normalizer=n}buildStyles(e,t){let n=new Map,s=aS(e,this.defaultParams);return this.styles.styles.forEach(r=>{typeof r!="string"&&r.forEach((o,a)=>{o&&(o=Bl(o,s,t));let c=this.normalizer.normalizePropertyName(a,t);o=this.normalizer.normalizeStyleValue(a,c,o,t),n.set(a,o)})}),n}};function aO(i,e,t){return new Xy(i,e,t)}var Xy=class{constructor(e,t,n){this.name=e,this.ast=t,this._normalizer=n,this.transitionFactories=[],this.states=new Map,t.states.forEach(s=>{let r=s.options&&s.options.params||{};this.states.set(s.name,new Yy(s.style,r,n))}),Hb(this.states,"true","1"),Hb(this.states,"false","0"),t.transitions.forEach(s=>{this.transitionFactories.push(new Sd(e,s,this.states))}),this.fallbackTransition=lO(e,this.states,this._normalizer)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,n,s){return this.transitionFactories.find(o=>o.match(e,t,n,s))||null}matchStyles(e,t,n){return this.fallbackTransition.buildStyles(e,t,n)}};function lO(i,e,t){let n=[(o,a)=>!0],s={type:le.Sequence,steps:[],options:null},r={type:le.Transition,animation:s,matchers:n,options:null,queryCount:0,depCount:0};return new Sd(i,r,e)}function Hb(i,e,t){i.has(e)?i.has(t)||i.set(t,i.get(e)):i.has(t)&&i.set(e,i.get(t))}var cO=new Ul,Jy=class{constructor(e,t,n){this.bodyNode=e,this._driver=t,this._normalizer=n,this._animations=new Map,this._playersById=new Map,this.players=[]}register(e,t){let n=[],s=[],r=rS(this._driver,t,n,s);if(n.length)throw Ik(n);s.length&&void 0,this._animations.set(e,r)}_buildPlayer(e,t,n){let s=e.element,r=Jb(this._normalizer,e.keyframes,t,n);return this._driver.animate(s,r,e.duration,e.delay,e.easing,[],!0)}create(e,t,n={}){let s=[],r=this._animations.get(e),o,a=new Map;if(r?(o=oS(this._driver,t,r,nS,qy,new Map,new Map,n,cO,s),o.forEach(d=>{let f=fn(a,d.element,new Map);d.postStyleProps.forEach(m=>f.set(m,null))})):(s.push(Ck()),o=[]),s.length)throw bk(s);a.forEach((d,f)=>{d.forEach((m,_)=>{d.set(_,this._driver.computeStyle(f,_,ci))})});let c=o.map(d=>{let f=a.get(d.element);return this._buildPlayer(d,new Map,f)}),u=ws(c);return this._playersById.set(e,u),u.onDestroy(()=>this.destroy(e)),this.players.push(u),u}destroy(e){let t=this._getPlayer(e);t.destroy(),this._playersById.delete(e);let n=this.players.indexOf(t);n>=0&&this.players.splice(n,1)}_getPlayer(e){let t=this._playersById.get(e);if(!t)throw Sk(e);return t}listen(e,t,n,s){let r=s0(t,"","","");return i0(this._getPlayer(e),n,r,s),()=>{}}command(e,t,n,s){if(n=="register"){this.register(e,s[0]);return}if(n=="create"){let o=s[0]||{};this.create(e,t,o);return}let r=this._getPlayer(e);switch(n){case"play":r.play();break;case"pause":r.pause();break;case"reset":r.reset();break;case"restart":r.restart();break;case"finish":r.finish();break;case"init":r.init();break;case"setPosition":r.setPosition(parseFloat(s[0]));break;case"destroy":this.destroy(e);break}}},Kb="ng-animate-queued",uO=".ng-animate-queued",Vy="ng-animate-disabled",hO=".ng-animate-disabled",dO="ng-star-inserted",fO=".ng-star-inserted",pO=[],lS={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},mO={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Gn="__ng_removed",ql=class{get params(){return this.options.params}constructor(e,t=""){this.namespaceId=t;let n=e&&e.hasOwnProperty("value"),s=n?e.value:e;if(this.value=_O(s),n){let r=e,{value:o}=r,a=uv(r,["value"]);this.options=a}else this.options={};this.options.params||(this.options.params={})}absorbOptions(e){let t=e.params;if(t){let n=this.options.params;Object.keys(t).forEach(s=>{n[s]==null&&(n[s]=t[s])})}}},Vl="void",By=new ql(Vl),Zy=class{constructor(e,t,n){this.id=e,this.hostElement=t,this._engine=n,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+e,kn(t,this._hostClassName)}listen(e,t,n,s){if(!this._triggers.has(t))throw Ak(n,t);if(n==null||n.length==0)throw Rk(t);if(!yO(n))throw xk(n,t);let r=fn(this._elementListeners,e,[]),o={name:t,phase:n,callback:s};r.push(o);let a=fn(this._engine.statesByElement,e,new Map);return a.has(t)||(kn(e,md),kn(e,md+"-"+t),a.set(t,By)),()=>{this._engine.afterFlush(()=>{let c=r.indexOf(o);c>=0&&r.splice(c,1),this._triggers.has(t)||a.delete(t)})}}register(e,t){return this._triggers.has(e)?!1:(this._triggers.set(e,t),!0)}_getTrigger(e){let t=this._triggers.get(e);if(!t)throw Pk(e);return t}trigger(e,t,n,s=!0){let r=this._getTrigger(t),o=new zl(this.id,t,e),a=this._engine.statesByElement.get(e);a||(kn(e,md),kn(e,md+"-"+t),this._engine.statesByElement.set(e,a=new Map));let c=a.get(t),u=new ql(n,this.id);if(!(n&&n.hasOwnProperty("value"))&&c&&u.absorbOptions(c.options),a.set(t,u),c||(c=By),!(u.value===Vl)&&c.value===u.value){if(!EO(c.params,u.params)){let C=[],R=r.matchStyles(c.value,c.params,C),U=r.matchStyles(u.value,u.params,C);C.length?this._engine.reportError(C):this._engine.afterFlush(()=>{yr(e,R),hi(e,U)})}return}let m=fn(this._engine.playersByElement,e,[]);m.forEach(C=>{C.namespaceId==this.id&&C.triggerName==t&&C.queued&&C.destroy()});let _=r.matchTransition(c.value,u.value,e,u.params),v=!1;if(!_){if(!s)return;_=r.fallbackTransition,v=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:_,fromState:c,toState:u,player:o,isFallbackTransition:v}),v||(kn(e,Kb),o.onStart(()=>{Go(e,Kb)})),o.onDone(()=>{let C=this.players.indexOf(o);C>=0&&this.players.splice(C,1);let R=this._engine.playersByElement.get(e);if(R){let U=R.indexOf(o);U>=0&&R.splice(U,1)}}),this.players.push(o),m.push(o),o}deregister(e){this._triggers.delete(e),this._engine.statesByElement.forEach(t=>t.delete(e)),this._elementListeners.forEach((t,n)=>{this._elementListeners.set(n,t.filter(s=>s.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);let t=this._engine.playersByElement.get(e);t&&(t.forEach(n=>n.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){let n=this._engine.driver.query(e,wd,!0);n.forEach(s=>{if(s[Gn])return;let r=this._engine.fetchNamespacesByElement(s);r.size?r.forEach(o=>o.triggerLeaveAnimation(s,t,!1,!0)):this.clearElementCache(s)}),this._engine.afterFlushAnimationsDone(()=>n.forEach(s=>this.clearElementCache(s)))}triggerLeaveAnimation(e,t,n,s){let r=this._engine.statesByElement.get(e),o=new Map;if(r){let a=[];if(r.forEach((c,u)=>{if(o.set(u,c.value),this._triggers.has(u)){let d=this.trigger(e,u,Vl,s);d&&a.push(d)}}),a.length)return this._engine.markElementAsRemoved(this.id,e,!0,t,o),n&&ws(a).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){let t=this._elementListeners.get(e),n=this._engine.statesByElement.get(e);if(t&&n){let s=new Set;t.forEach(r=>{let o=r.name;if(s.has(o))return;s.add(o);let c=this._triggers.get(o).fallbackTransition,u=n.get(o)||By,d=new ql(Vl),f=new zl(this.id,o,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:o,transition:c,fromState:u,toState:d,player:f,isFallbackTransition:!0})})}}removeNode(e,t){let n=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let s=!1;if(n.totalAnimations){let r=n.players.length?n.playersByQueriedElement.get(e):[];if(r&&r.length)s=!0;else{let o=e;for(;o=o.parentNode;)if(n.statesByElement.get(o)){s=!0;break}}}if(this.prepareLeaveAnimationListeners(e),s)n.markElementAsRemoved(this.id,e,!1,t);else{let r=e[Gn];(!r||r===lS)&&(n.afterFlush(()=>this.clearElementCache(e)),n.destroyInnerAnimations(e),n._onRemovalComplete(e,t))}}insertNode(e,t){kn(e,this._hostClassName)}drainQueuedTransitions(e){let t=[];return this._queue.forEach(n=>{let s=n.player;if(s.destroyed)return;let r=n.element,o=this._elementListeners.get(r);o&&o.forEach(a=>{if(a.name==n.triggerName){let c=s0(r,n.triggerName,n.fromState.value,n.toState.value);c._data=e,i0(n.player,a.phase,c,a.callback)}}),s.markedForDestroy?this._engine.afterFlush(()=>{s.destroy()}):t.push(n)}),this._queue=[],t.sort((n,s)=>{let r=n.transition.ast.depCount,o=s.transition.ast.depCount;return r==0||o==0?r-o:this._engine.driver.containsElement(n.element,s.element)?1:-1})}destroy(e){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}},e0=class{_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}constructor(e,t,n){this.bodyNode=e,this.driver=t,this._normalizer=n,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(s,r)=>{}}get queuedPlayers(){let e=[];return this._namespaceList.forEach(t=>{t.players.forEach(n=>{n.queued&&e.push(n)})}),e}createNamespace(e,t){let n=new Zy(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(n,t):(this.newHostElements.set(t,n),this.collectEnterElement(t)),this._namespaceLookup[e]=n}_balanceNamespaceList(e,t){let n=this._namespaceList,s=this.namespacesByHostElement;if(n.length-1>=0){let o=!1,a=this.driver.getParentElement(t);for(;a;){let c=s.get(a);if(c){let u=n.indexOf(c);n.splice(u+1,0,e),o=!0;break}a=this.driver.getParentElement(a)}o||n.unshift(e)}else n.push(e);return s.set(t,e),e}register(e,t){let n=this._namespaceLookup[e];return n||(n=this.createNamespace(e,t)),n}registerTrigger(e,t,n){let s=this._namespaceLookup[e];s&&s.register(t,n)&&this.totalAnimations++}destroy(e,t){e&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{let n=this._fetchNamespace(e);this.namespacesByHostElement.delete(n.hostElement);let s=this._namespaceList.indexOf(n);s>=0&&this._namespaceList.splice(s,1),n.destroy(t),delete this._namespaceLookup[e]}))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){let t=new Set,n=this.statesByElement.get(e);if(n){for(let s of n.values())if(s.namespaceId){let r=this._fetchNamespace(s.namespaceId);r&&t.add(r)}}return t}trigger(e,t,n,s){if(yd(t)){let r=this._fetchNamespace(e);if(r)return r.trigger(t,n,s),!0}return!1}insertNode(e,t,n,s){if(!yd(t))return;let r=t[Gn];if(r&&r.setForRemoval){r.setForRemoval=!1,r.setForMove=!0;let o=this.collectedLeaveElements.indexOf(t);o>=0&&this.collectedLeaveElements.splice(o,1)}if(e){let o=this._fetchNamespace(e);o&&o.insertNode(t,n)}s&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),kn(e,Vy)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),Go(e,Vy))}removeNode(e,t,n){if(yd(t)){let s=e?this._fetchNamespace(e):null;s?s.removeNode(t,n):this.markElementAsRemoved(e,t,!1,n);let r=this.namespacesByHostElement.get(t);r&&r.id!==e&&r.removeNode(t,n)}else this._onRemovalComplete(t,n)}markElementAsRemoved(e,t,n,s,r){this.collectedLeaveElements.push(t),t[Gn]={namespaceId:e,setForRemoval:s,hasAnimation:n,removedBeforeQueried:!1,previousTriggersValues:r}}listen(e,t,n,s,r){return yd(t)?this._fetchNamespace(e).listen(t,n,s,r):()=>{}}_buildInstruction(e,t,n,s,r){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,n,s,e.fromState.options,e.toState.options,t,r)}destroyInnerAnimations(e){let t=this.driver.query(e,wd,!0);t.forEach(n=>this.destroyActiveAnimationsForElement(n)),this.playersByQueriedElement.size!=0&&(t=this.driver.query(e,zy,!0),t.forEach(n=>this.finishActiveQueriedAnimationOnElement(n)))}destroyActiveAnimationsForElement(e){let t=this.playersByElement.get(e);t&&t.forEach(n=>{n.queued?n.markedForDestroy=!0:n.destroy()})}finishActiveQueriedAnimationOnElement(e){let t=this.playersByQueriedElement.get(e);t&&t.forEach(n=>n.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return ws(this.players).onDone(()=>e());e()})}processLeaveNode(e){let t=e[Gn];if(t&&t.setForRemoval){if(e[Gn]=lS,t.namespaceId){this.destroyInnerAnimations(e);let n=this._fetchNamespace(t.namespaceId);n&&n.clearElementCache(e)}this._onRemovalComplete(e,t.setForRemoval)}e.classList?.contains(Vy)&&this.markElementAsDisabled(e,!1),this.driver.query(e,hO,!0).forEach(n=>{this.markElementAsDisabled(n,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((n,s)=>this._balanceNamespaceList(n,s)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let n=0;n<this.collectedEnterElements.length;n++){let s=this.collectedEnterElements[n];kn(s,dO)}if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){let n=[];try{t=this._flushAnimations(n,e)}finally{for(let s=0;s<n.length;s++)n[s]()}}else for(let n=0;n<this.collectedLeaveElements.length;n++){let s=this.collectedLeaveElements[n];this.processLeaveNode(s)}if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(n=>n()),this._flushFns=[],this._whenQuietFns.length){let n=this._whenQuietFns;this._whenQuietFns=[],t.length?ws(t).onDone(()=>{n.forEach(s=>s())}):n.forEach(s=>s())}}reportError(e){throw Dk(e)}_flushAnimations(e,t){let n=new Ul,s=[],r=new Map,o=[],a=new Map,c=new Map,u=new Map,d=new Set;this.disabledNodes.forEach(K=>{d.add(K);let X=this.driver.query(K,uO,!0);for(let Z=0;Z<X.length;Z++)d.add(X[Z])});let f=this.bodyNode,m=Array.from(this.statesByElement.keys()),_=Yb(m,this.collectedEnterElements),v=new Map,C=0;_.forEach((K,X)=>{let Z=nS+C++;v.set(X,Z),K.forEach(_e=>kn(_e,Z))});let R=[],U=new Set,q=new Set;for(let K=0;K<this.collectedLeaveElements.length;K++){let X=this.collectedLeaveElements[K],Z=X[Gn];Z&&Z.setForRemoval&&(R.push(X),U.add(X),Z.hasAnimation?this.driver.query(X,fO,!0).forEach(_e=>U.add(_e)):q.add(X))}let z=new Map,Y=Yb(m,Array.from(U));Y.forEach((K,X)=>{let Z=qy+C++;z.set(X,Z),K.forEach(_e=>kn(_e,Z))}),e.push(()=>{_.forEach((K,X)=>{let Z=v.get(X);K.forEach(_e=>Go(_e,Z))}),Y.forEach((K,X)=>{let Z=z.get(X);K.forEach(_e=>Go(_e,Z))}),R.forEach(K=>{this.processLeaveNode(K)})});let he=[],ee=[];for(let K=this._namespaceList.length-1;K>=0;K--)this._namespaceList[K].drainQueuedTransitions(t).forEach(Z=>{let _e=Z.player,tt=Z.element;if(he.push(_e),this.collectedEnterElements.length){let Je=tt[Gn];if(Je&&Je.setForMove){if(Je.previousTriggersValues&&Je.previousTriggersValues.has(Z.triggerName)){let di=Je.previousTriggersValues.get(Z.triggerName),Xt=this.statesByElement.get(Z.element);if(Xt&&Xt.has(Z.triggerName)){let fi=Xt.get(Z.triggerName);fi.value=di,Xt.set(Z.triggerName,fi)}}_e.destroy();return}}let mn=!f||!this.driver.containsElement(f,tt),Xe=z.get(tt),Be=v.get(tt),Ue=this._buildInstruction(Z,n,Be,Xe,mn);if(Ue.errors&&Ue.errors.length){ee.push(Ue);return}if(mn){_e.onStart(()=>yr(tt,Ue.fromStyles)),_e.onDestroy(()=>hi(tt,Ue.toStyles)),s.push(_e);return}if(Z.isFallbackTransition){_e.onStart(()=>yr(tt,Ue.fromStyles)),_e.onDestroy(()=>hi(tt,Ue.toStyles)),s.push(_e);return}let Mi=[];Ue.timelines.forEach(Je=>{Je.stretchStartingKeyframe=!0,this.disabledNodes.has(Je.element)||Mi.push(Je)}),Ue.timelines=Mi,n.append(tt,Ue.timelines);let Nd={instruction:Ue,player:_e,element:tt};o.push(Nd),Ue.queriedElements.forEach(Je=>fn(a,Je,[]).push(_e)),Ue.preStyleProps.forEach((Je,di)=>{if(Je.size){let Xt=c.get(di);Xt||c.set(di,Xt=new Set),Je.forEach((fi,Fi)=>Xt.add(Fi))}}),Ue.postStyleProps.forEach((Je,di)=>{let Xt=u.get(di);Xt||u.set(di,Xt=new Set),Je.forEach((fi,Fi)=>Xt.add(Fi))})});if(ee.length){let K=[];ee.forEach(X=>{K.push(Nk(X.triggerName,X.errors))}),he.forEach(X=>X.destroy()),this.reportError(K)}let T=new Map,y=new Map;o.forEach(K=>{let X=K.element;n.has(X)&&(y.set(X,X),this._beforeAnimationBuild(K.player.namespaceId,K.instruction,T))}),s.forEach(K=>{let X=K.element;this._getPreviousPlayers(X,!1,K.namespaceId,K.triggerName,null).forEach(_e=>{fn(T,X,[]).push(_e),_e.destroy()})});let E=R.filter(K=>Xb(K,c,u)),I=new Map;$b(I,this.driver,q,u,ci).forEach(K=>{Xb(K,c,u)&&E.push(K)});let A=new Map;_.forEach((K,X)=>{$b(A,this.driver,new Set(K),c,cd)}),E.forEach(K=>{let X=I.get(K),Z=A.get(K);I.set(K,new Map([...X?.entries()??[],...Z?.entries()??[]]))});let w=[],pn=[],Oi={};o.forEach(K=>{let{element:X,player:Z,instruction:_e}=K;if(n.has(X)){if(d.has(X)){Z.onDestroy(()=>hi(X,_e.toStyles)),Z.disabled=!0,Z.overrideTotalTime(_e.totalTime),s.push(Z);return}let tt=Oi;if(y.size>1){let Xe=X,Be=[];for(;Xe=Xe.parentNode;){let Ue=y.get(Xe);if(Ue){tt=Ue;break}Be.push(Xe)}Be.forEach(Ue=>y.set(Ue,tt))}let mn=this._buildAnimation(Z.namespaceId,_e,T,r,A,I);if(Z.setRealPlayer(mn),tt===Oi)w.push(Z);else{let Xe=this.playersByElement.get(tt);Xe&&Xe.length&&(Z.parentPlayer=ws(Xe)),s.push(Z)}}else yr(X,_e.fromStyles),Z.onDestroy(()=>hi(X,_e.toStyles)),pn.push(Z),d.has(X)&&s.push(Z)}),pn.forEach(K=>{let X=r.get(K.element);if(X&&X.length){let Z=ws(X);K.setRealPlayer(Z)}}),s.forEach(K=>{K.parentPlayer?K.syncPlayerEvents(K.parentPlayer):K.destroy()});for(let K=0;K<R.length;K++){let X=R[K],Z=X[Gn];if(Go(X,qy),Z&&Z.hasAnimation)continue;let _e=[];if(a.size){let mn=a.get(X);mn&&mn.length&&_e.push(...mn);let Xe=this.driver.query(X,zy,!0);for(let Be=0;Be<Xe.length;Be++){let Ue=a.get(Xe[Be]);Ue&&Ue.length&&_e.push(...Ue)}}let tt=_e.filter(mn=>!mn.destroyed);tt.length?vO(this,X,tt):this.processLeaveNode(X)}return R.length=0,w.forEach(K=>{this.players.push(K),K.onDone(()=>{K.destroy();let X=this.players.indexOf(K);this.players.splice(X,1)}),K.play()}),w}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,n,s,r){let o=[];if(t){let a=this.playersByQueriedElement.get(e);a&&(o=a)}else{let a=this.playersByElement.get(e);if(a){let c=!r||r==Vl;a.forEach(u=>{u.queued||!c&&u.triggerName!=s||o.push(u)})}}return(n||s)&&(o=o.filter(a=>!(n&&n!=a.namespaceId||s&&s!=a.triggerName))),o}_beforeAnimationBuild(e,t,n){let s=t.triggerName,r=t.element,o=t.isRemovalTransition?void 0:e,a=t.isRemovalTransition?void 0:s;for(let c of t.timelines){let u=c.element,d=u!==r,f=fn(n,u,[]);this._getPreviousPlayers(u,d,o,a,t.toState).forEach(_=>{let v=_.getRealPlayer();v.beforeDestroy&&v.beforeDestroy(),_.destroy(),f.push(_)})}yr(r,t.fromStyles)}_buildAnimation(e,t,n,s,r,o){let a=t.triggerName,c=t.element,u=[],d=new Set,f=new Set,m=t.timelines.map(v=>{let C=v.element;d.add(C);let R=C[Gn];if(R&&R.removedBeforeQueried)return new vs(v.duration,v.delay);let U=C!==c,q=wO((n.get(C)||pO).map(T=>T.getRealPlayer())).filter(T=>{let y=T;return y.element?y.element===C:!1}),z=r.get(C),Y=o.get(C),he=Jb(this._normalizer,v.keyframes,z,Y),ee=this._buildPlayer(v,he,q);if(v.subTimeline&&s&&f.add(C),U){let T=new zl(e,a,C);T.setRealPlayer(ee),u.push(T)}return ee});u.forEach(v=>{fn(this.playersByQueriedElement,v.element,[]).push(v),v.onDone(()=>gO(this.playersByQueriedElement,v.element,v))}),d.forEach(v=>kn(v,qb));let _=ws(m);return _.onDestroy(()=>{d.forEach(v=>Go(v,qb)),hi(c,t.toStyles)}),f.forEach(v=>{fn(s,v,[]).push(_)}),_}_buildPlayer(e,t,n){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,n):new vs(e.duration,e.delay)}},zl=class{constructor(e,t,n){this.namespaceId=e,this.triggerName=t,this.element=n,this._player=new vs,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(e){this._containsRealPlayer||(this._player=e,this._queuedCallbacks.forEach((t,n)=>{t.forEach(s=>i0(e,n,void 0,s))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){let t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){fn(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return this.queued?!1:this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){let t=this._player;t.triggerCallback&&t.triggerCallback(e)}};function gO(i,e,t){let n=i.get(e);if(n){if(n.length){let s=n.indexOf(t);n.splice(s,1)}n.length==0&&i.delete(e)}return n}function _O(i){return i??null}function yd(i){return i&&i.nodeType===1}function yO(i){return i=="start"||i=="done"}function Qb(i,e){let t=i.style.display;return i.style.display=e??"none",t}function $b(i,e,t,n,s){let r=[];t.forEach(c=>r.push(Qb(c)));let o=[];n.forEach((c,u)=>{let d=new Map;c.forEach(f=>{let m=e.computeStyle(u,f,s);d.set(f,m),(!m||m.length==0)&&(u[Gn]=mO,o.push(u))}),i.set(u,d)});let a=0;return t.forEach(c=>Qb(c,r[a++])),o}function Yb(i,e){let t=new Map;if(i.forEach(a=>t.set(a,[])),e.length==0)return t;let n=1,s=new Set(e),r=new Map;function o(a){if(!a)return n;let c=r.get(a);if(c)return c;let u=a.parentNode;return t.has(u)?c=u:s.has(u)?c=n:c=o(u),r.set(a,c),c}return e.forEach(a=>{let c=o(a);c!==n&&t.get(c).push(a)}),t}function kn(i,e){i.classList?.add(e)}function Go(i,e){i.classList?.remove(e)}function vO(i,e,t){ws(t).onDone(()=>i.processLeaveNode(e))}function wO(i){let e=[];return cS(i,e),e}function cS(i,e){for(let t=0;t<i.length;t++){let n=i[t];n instanceof Ol?cS(n.players,e):e.push(n)}}function EO(i,e){let t=Object.keys(i),n=Object.keys(e);if(t.length!=n.length)return!1;for(let s=0;s<t.length;s++){let r=t[s];if(!e.hasOwnProperty(r)||i[r]!==e[r])return!1}return!0}function Xb(i,e,t){let n=t.get(i);if(!n)return!1;let s=e.get(i);return s?n.forEach(r=>s.add(r)):e.set(i,n),t.delete(i),!0}var Wo=class{constructor(e,t,n){this._driver=t,this._normalizer=n,this._triggerCache={},this.onRemovalComplete=(s,r)=>{},this._transitionEngine=new e0(e.body,t,n),this._timelineEngine=new Jy(e.body,t,n),this._transitionEngine.onRemovalComplete=(s,r)=>this.onRemovalComplete(s,r)}registerTrigger(e,t,n,s,r){let o=e+"-"+s,a=this._triggerCache[o];if(!a){let c=[],u=[],d=rS(this._driver,r,c,u);if(c.length)throw Ek(s,c);u.length&&void 0,a=aO(s,d,this._normalizer),this._triggerCache[o]=a}this._transitionEngine.registerTrigger(t,s,a)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,n,s){this._transitionEngine.insertNode(e,t,n,s)}onRemove(e,t,n){this._transitionEngine.removeNode(e,t,n)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,n,s){if(n.charAt(0)=="@"){let[r,o]=Bb(n),a=s;this._timelineEngine.command(r,t,o,a)}else this._transitionEngine.trigger(e,t,n,s)}listen(e,t,n,s,r){if(n.charAt(0)=="@"){let[o,a]=Bb(n);return this._timelineEngine.listen(o,t,a,r)}return this._transitionEngine.listen(e,t,n,s,r)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(e){this._transitionEngine.afterFlushAnimationsDone(e)}};function TO(i,e){let t=null,n=null;return Array.isArray(e)&&e.length?(t=Uy(e[0]),e.length>1&&(n=Uy(e[e.length-1]))):e instanceof Map&&(t=Uy(e)),t||n?new t0(i,t,n):null}var t0=class i{static{this.initialStylesByElement=new WeakMap}constructor(e,t,n){this._element=e,this._startStyles=t,this._endStyles=n,this._state=0;let s=i.initialStylesByElement.get(e);s||i.initialStylesByElement.set(e,s=new Map),this._initialStyles=s}start(){this._state<1&&(this._startStyles&&hi(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(hi(this._element,this._initialStyles),this._endStyles&&(hi(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(i.initialStylesByElement.delete(this._element),this._startStyles&&(yr(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(yr(this._element,this._endStyles),this._endStyles=null),hi(this._element,this._initialStyles),this._state=3)}};function Uy(i){let e=null;return i.forEach((t,n)=>{IO(n)&&(e=e||new Map,e.set(n,t))}),e}function IO(i){return i==="display"||i==="position"}var Ad=class{constructor(e,t,n,s){this.element=e,this.keyframes=t,this.options=n,this._specialStyles=s,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=n.duration,this._delay=n.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;let e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:new Map;let t=()=>this._onFinish();this.domPlayer.addEventListener("finish",t),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",t)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(e){let t=[];return e.forEach(n=>{t.push(Object.fromEntries(n))}),t}_triggerWebAnimation(e,t,n){return e.animate(this._convertKeyframesToObject(t),n)}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){this.domPlayer===void 0&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){let e=new Map;this.hasStarted()&&this._finalKeyframe.forEach((n,s)=>{s!=="offset"&&e.set(s,this._finished?n:l0(this.element,s))}),this.currentSnapshot=e}triggerCallback(e){let t=e==="start"?this._onStartFns:this._onDoneFns;t.forEach(n=>n()),t.length=0}},Rd=class{validateStyleProperty(e){return!0}validateAnimatableStyleProperty(e){return!0}containsElement(e,t){return Zb(e,t)}getParentElement(e){return r0(e)}query(e,t,n){return eS(e,t,n)}computeStyle(e,t,n){return l0(e,t)}animate(e,t,n,s,r,o=[]){let a=s==0?"both":"forwards",c={duration:n,delay:s,fill:a};r&&(c.easing=r);let u=new Map,d=o.filter(_=>_ instanceof Ad);jk(n,s)&&d.forEach(_=>{_.currentSnapshot.forEach((v,C)=>u.set(C,v))});let f=Uk(t).map(_=>new Map(_));f=Gk(e,f,u);let m=TO(e,f);return new Ad(e,f,c,m)}};var vd="@",uS="@.disabled",xd=class{constructor(e,t,n,s){this.namespaceId=e,this.delegate=t,this.engine=n,this._onDestroy=s,this.\u0275type=0}get data(){return this.delegate.data}destroyNode(e){this.delegate.destroyNode?.(e)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,n,s=!0){this.delegate.insertBefore(e,t,n),this.engine.onInsert(this.namespaceId,t,e,s)}removeChild(e,t,n){this.parentNode(t)&&this.engine.onRemove(this.namespaceId,t,this.delegate)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,n,s){this.delegate.setAttribute(e,t,n,s)}removeAttribute(e,t,n){this.delegate.removeAttribute(e,t,n)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,n,s){this.delegate.setStyle(e,t,n,s)}removeStyle(e,t,n){this.delegate.removeStyle(e,t,n)}setProperty(e,t,n){t.charAt(0)==vd&&t==uS?this.disableAnimations(e,!!n):this.delegate.setProperty(e,t,n)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,n){return this.delegate.listen(e,t,n)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}},n0=class extends xd{constructor(e,t,n,s,r){super(t,n,s,r),this.factory=e,this.namespaceId=t}setProperty(e,t,n){t.charAt(0)==vd?t.charAt(1)=="."&&t==uS?(n=n===void 0?!0:!!n,this.disableAnimations(e,n)):this.engine.process(this.namespaceId,e,t.slice(1),n):this.delegate.setProperty(e,t,n)}listen(e,t,n){if(t.charAt(0)==vd){let s=CO(e),r=t.slice(1),o="";return r.charAt(0)!=vd&&([r,o]=bO(r)),this.engine.listen(this.namespaceId,s,r,o,a=>{let c=a._data||-1;this.factory.scheduleListenerCallback(c,n,a)})}return this.delegate.listen(e,t,n)}};function CO(i){switch(i){case"body":return document.body;case"document":return document;case"window":return window;default:return i}}function bO(i){let e=i.indexOf("."),t=i.substring(0,e),n=i.slice(e+1);return[t,n]}var Pd=class{constructor(e,t,n){this.delegate=e,this.engine=t,this._zone=n,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,t.onRemovalComplete=(s,r)=>{r?.removeChild(null,s)}}createRenderer(e,t){let n="",s=this.delegate.createRenderer(e,t);if(!e||!t?.data?.animation){let u=this._rendererCache,d=u.get(s);if(!d){let f=()=>u.delete(s);d=new xd(n,s,this.engine,f),u.set(s,d)}return d}let r=t.id,o=t.id+"-"+this._currentId;this._currentId++,this.engine.register(o,e);let a=u=>{Array.isArray(u)?u.forEach(a):this.engine.registerTrigger(r,o,e,u.name,u)};return t.data.animation.forEach(a),new n0(this,o,s,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(e,t,n){if(e>=0&&e<this._microtaskId){this._zone.run(()=>t(n));return}let s=this._animationCallbacksBuffer;s.length==0&&queueMicrotask(()=>{this._zone.run(()=>{s.forEach(r=>{let[o,a]=r;o(a)}),this._animationCallbacksBuffer=[]})}),s.push([t,n])}end(){this._cdRecurDepth--,this._cdRecurDepth==0&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}};var AO=(()=>{class i extends Wo{constructor(t,n,s){super(t,n,s)}ngOnDestroy(){this.flush()}static{this.\u0275fac=function(n){return new(n||i)(ne(bt),ne(vr),ne(wr))}}static{this.\u0275prov=pt({token:i,factory:i.\u0275fac})}}return i})();function RO(){return new Td}function xO(i,e,t){return new Pd(i,e,t)}var hS=[{provide:wr,useFactory:RO},{provide:Wo,useClass:AO},{provide:Tv,useFactory:xO,deps:[Mv,Wo,zt]}],PO=[{provide:vr,useFactory:()=>new Rd},{provide:af,useValue:"BrowserAnimations"},...hS],yV=[{provide:vr,useClass:o0},{provide:af,useValue:"NoopAnimations"},...hS];function dS(){return Cv("NgEagerAnimations"),[...PO]}var fS={apiKey:"AIzaSyAdWLVOkP8pLrNZkELpC8Mm1fVdbkd1kEk",authDomain:"expenses-5d437.firebaseapp.com",projectId:"expenses-5d437",storageBucket:"expenses-5d437.appspot.com",messagingSenderId:"202582971776",appId:"1:202582971776:web:6b55340bb59e17d4565d65"};var pS={providers:[Pv({eventCoalescing:!0}),Uv(Lb),_v([Jv.initializeApp(fS),Zv,DT,fb,hd]),dS(),xb()]};function DO(i,e){if(i&1&&(L(0,"div",13),ae(1,"Logged on user: "),L(2,"strong"),ae(3),V()()),i&2){let t=Q();k(3),En(t.user)}}var Dd=class i{constructor(e){this.toastr=e}title="expenses";auth=Ke(vi);isLoginFormModelOpen=!1;isLoggedIn=Ke(vi).isLoggedIn();user;logOut(){this.auth.logout().then(()=>{this.toastr.warning("Logged out","User logged out successfully",{timeOut:5e3,positionClass:"toast-top-right",closeButton:!0,progressBar:!0})})}ngOnInit(){this.isLoggedIn.subscribe(e=>{if(e){let t=localStorage.getItem("user");if(t){let n=JSON.parse(t);this.user=n.email,this.toastr.success(this.user,"User logged in successfully",{timeOut:5e3,positionClass:"toast-top-right",closeButton:!0,progressBar:!0})}}})}static \u0275fac=function(t){return new(t||i)(ie(zo))};static \u0275cmp=ye({type:i,selectors:[["app-root"]],standalone:!0,features:[uc([fd]),Re],decls:21,vars:3,consts:[[1,"navbar","navbar-expand-lg","border-bottom","sticky-top","navbar-light","bg-light"],[1,"container-fluid"],["href","#",1,"navbar-brand"],["type","button","data-bs-toggle","collapse","data-bs-target","#navbarSupportedContent","aria-controls","navbarSupportedContent","aria-expanded","false","aria-label","Toggle navigation",1,"navbar-toggler"],[1,"navbar-toggler-icon"],["id","navbarSupportedContent",1,"collapse","navbar-collapse"],[1,"navbar-nav","me-auto","mb-2","mb-lg-0"],[1,"nav-item"],["aria-current","page","href","/",1,"nav-link","active"],["aria-current","page","href","/login",1,"nav-link","active"],["aria-current","page","href","/",1,"nav-link","active",3,"click"],["class","align-items-center",4,"ngIf"],[1,"container","my-4"],[1,"align-items-center"]],template:function(t,n){t&1&&(L(0,"nav",0)(1,"div",1)(2,"a",2),ae(3,"Expense Tracker"),V(),L(4,"button",3),te(5,"span",4),V(),L(6,"div",5)(7,"ul",6)(8,"li",7)(9,"a",8),ae(10,"Home"),V()(),L(11,"li",7)(12,"a",9),ae(13,"Login"),V()(),L(14,"li",7)(15,"a",10),De("click",function(){return n.logOut()}),ae(16,"Logout"),V()()(),de(17,DO,4,1,"div",11),xs(18,"async"),V()()(),L(19,"div",12),te(20,"router-outlet"),V()),t&2&&(k(17),O("ngIf",ua(18,1,n.isLoggedIn)))},dependencies:[Vv,In,rn,_c,Mb]})};Fv(Dd,pS).catch(i=>console.error(i));
